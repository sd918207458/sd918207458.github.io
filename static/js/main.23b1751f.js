/*! For license information please see main.23b1751f.js.LICENSE.txt */
(()=>{var e={646:(e,t,n)=>{"use strict";var a=n(5675),o={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var n,i,r,s,l,c,g=!1;t||(t={}),n=t.debug||!1;try{if(r=a(),s=document.createRange(),l=document.getSelection(),(c=document.createElement("span")).textContent=e,c.ariaHidden="true",c.style.all="unset",c.style.position="fixed",c.style.top=0,c.style.clip="rect(0, 0, 0, 0)",c.style.whiteSpace="pre",c.style.webkitUserSelect="text",c.style.MozUserSelect="text",c.style.msUserSelect="text",c.style.userSelect="text",c.addEventListener("copy",(function(a){if(a.stopPropagation(),t.format)if(a.preventDefault(),"undefined"===typeof a.clipboardData){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var i=o[t.format]||o.default;window.clipboardData.setData(i,e)}else a.clipboardData.clearData(),a.clipboardData.setData(t.format,e);t.onCopy&&(a.preventDefault(),t.onCopy(a.clipboardData))})),document.body.appendChild(c),s.selectNodeContents(c),l.addRange(s),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");g=!0}catch(u){n&&console.error("unable to copy using execCommand: ",u),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),g=!0}catch(u){n&&console.error("unable to copy using clipboardData: ",u),n&&console.error("falling back to prompt"),i=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(i,e)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(s):l.removeAllRanges()),c&&document.body.removeChild(c),r()}return g}},9993:(e,t,n)=>{"use strict";var a=n(5730);function o(){}function i(){}i.resetWarningCache=o,e.exports=function(){function e(e,t,n,o,i,r){if(r!==a){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:o};return n.PropTypes=n,n}},6405:(e,t,n)=>{e.exports=n(9993)()},5730:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},4191:(e,t,n)=>{var a=n(1717);function o(e){this.mode=a.MODE_8BIT_BYTE,this.data=e}o.prototype={getLength:function(e){return this.data.length},write:function(e){for(var t=0;t<this.data.length;t++)e.put(this.data.charCodeAt(t),8)}},e.exports=o},2125:e=>{function t(){this.buffer=new Array,this.length=0}t.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},9662:e=>{e.exports={L:1,M:0,Q:3,H:2}},9928:(e,t,n)=>{var a=n(6044);function o(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var a=0;a<e.length-n;a++)this.num[a]=e[a+n]}o.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var i=0;i<e.getLength();i++)t[n+i]^=a.gexp(a.glog(this.get(n))+a.glog(e.get(i)));return new o(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=a.glog(this.get(0))-a.glog(e.get(0)),n=new Array(this.getLength()),i=0;i<this.getLength();i++)n[i]=this.get(i);for(i=0;i<e.getLength();i++)n[i]^=a.gexp(a.glog(e.get(i))+t);return new o(n,0).mod(e)}},e.exports=o},7596:(e,t,n)=>{var a=n(4191),o=n(4812),i=n(2125),r=n(3498),s=n(9928);function l(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var c=l.prototype;c.addData=function(e){var t=new a(e);this.dataList.push(t),this.dataCache=null},c.isDark=function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},c.getModuleCount=function(){return this.moduleCount},c.make=function(){if(this.typeNumber<1){var e=1;for(e=1;e<40;e++){for(var t=o.getRSBlocks(e,this.errorCorrectLevel),n=new i,a=0,s=0;s<t.length;s++)a+=t[s].dataCount;for(s=0;s<this.dataList.length;s++){var l=this.dataList[s];n.put(l.mode,4),n.put(l.getLength(),r.getLengthInBits(l.mode,e)),l.write(n)}if(n.getLengthInBits()<=8*a)break}this.typeNumber=e}this.makeImpl(!1,this.getBestMaskPattern())},c.makeImpl=function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var a=0;a<this.moduleCount;a++)this.modules[n][a]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=l.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},c.setupPositionProbePattern=function(e,t){for(var n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(var a=-1;a<=7;a++)t+a<=-1||this.moduleCount<=t+a||(this.modules[e+n][t+a]=0<=n&&n<=6&&(0==a||6==a)||0<=a&&a<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=a&&a<=4)},c.getBestMaskPattern=function(){for(var e=0,t=0,n=0;n<8;n++){this.makeImpl(!0,n);var a=r.getLostPoint(this);(0==n||e>a)&&(e=a,t=n)}return t},c.createMovieClip=function(e,t,n){var a=e.createEmptyMovieClip(t,n);this.make();for(var o=0;o<this.modules.length;o++)for(var i=1*o,r=0;r<this.modules[o].length;r++){var s=1*r;this.modules[o][r]&&(a.beginFill(0,100),a.moveTo(s,i),a.lineTo(s+1,i),a.lineTo(s+1,i+1),a.lineTo(s,i+1),a.endFill())}return a},c.setupTimingPattern=function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},c.setupPositionAdjustPattern=function(){for(var e=r.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var a=e[t],o=e[n];if(null==this.modules[a][o])for(var i=-2;i<=2;i++)for(var s=-2;s<=2;s++)this.modules[a+i][o+s]=-2==i||2==i||-2==s||2==s||0==i&&0==s}},c.setupTypeNumber=function(e){for(var t=r.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var a=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=a}for(n=0;n<18;n++){a=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=a}},c.setupTypeInfo=function(e,t){for(var n=this.errorCorrectLevel<<3|t,a=r.getBCHTypeInfo(n),o=0;o<15;o++){var i=!e&&1==(a>>o&1);o<6?this.modules[o][8]=i:o<8?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(o=0;o<15;o++){i=!e&&1==(a>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=i:o<9?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!e},c.mapData=function(e,t){for(var n=-1,a=this.moduleCount-1,o=7,i=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var l=0;l<2;l++)if(null==this.modules[a][s-l]){var c=!1;i<e.length&&(c=1==(e[i]>>>o&1)),r.getMask(t,a,s-l)&&(c=!c),this.modules[a][s-l]=c,-1==--o&&(i++,o=7)}if((a+=n)<0||this.moduleCount<=a){a-=n,n=-n;break}}},l.PAD0=236,l.PAD1=17,l.createData=function(e,t,n){for(var a=o.getRSBlocks(e,t),s=new i,c=0;c<n.length;c++){var g=n[c];s.put(g.mode,4),s.put(g.getLength(),r.getLengthInBits(g.mode,e)),g.write(s)}var u=0;for(c=0;c<a.length;c++)u+=a[c].dataCount;if(s.getLengthInBits()>8*u)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*u+")");for(s.getLengthInBits()+4<=8*u&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*u)&&(s.put(l.PAD0,8),!(s.getLengthInBits()>=8*u));)s.put(l.PAD1,8);return l.createBytes(s,a)},l.createBytes=function(e,t){for(var n=0,a=0,o=0,i=new Array(t.length),l=new Array(t.length),c=0;c<t.length;c++){var g=t[c].dataCount,u=t[c].totalCount-g;a=Math.max(a,g),o=Math.max(o,u),i[c]=new Array(g);for(var d=0;d<i[c].length;d++)i[c][d]=255&e.buffer[d+n];n+=g;var h=r.getErrorCorrectPolynomial(u),p=new s(i[c],h.getLength()-1).mod(h);l[c]=new Array(h.getLength()-1);for(d=0;d<l[c].length;d++){var m=d+p.getLength()-l[c].length;l[c][d]=m>=0?p.get(m):0}}var I=0;for(d=0;d<t.length;d++)I+=t[d].totalCount;var C=new Array(I),f=0;for(d=0;d<a;d++)for(c=0;c<t.length;c++)d<i[c].length&&(C[f++]=i[c][d]);for(d=0;d<o;d++)for(c=0;c<t.length;c++)d<l[c].length&&(C[f++]=l[c][d]);return C},e.exports=l},4812:(e,t,n)=>{var a=n(9662);function o(e,t){this.totalCount=e,this.dataCount=t}o.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],o.getRSBlocks=function(e,t){var n=o.getRsBlockTable(e,t);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var a=n.length/3,i=new Array,r=0;r<a;r++)for(var s=n[3*r+0],l=n[3*r+1],c=n[3*r+2],g=0;g<s;g++)i.push(new o(l,c));return i},o.getRsBlockTable=function(e,t){switch(t){case a.L:return o.RS_BLOCK_TABLE[4*(e-1)+0];case a.M:return o.RS_BLOCK_TABLE[4*(e-1)+1];case a.Q:return o.RS_BLOCK_TABLE[4*(e-1)+2];case a.H:return o.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},e.exports=o},6044:e=>{for(var t={glog:function(e){if(e<1)throw new Error("glog("+e+")");return t.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return t.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},n=0;n<8;n++)t.EXP_TABLE[n]=1<<n;for(n=8;n<256;n++)t.EXP_TABLE[n]=t.EXP_TABLE[n-4]^t.EXP_TABLE[n-5]^t.EXP_TABLE[n-6]^t.EXP_TABLE[n-8];for(n=0;n<255;n++)t.LOG_TABLE[t.EXP_TABLE[n]]=n;e.exports=t},1717:e=>{e.exports={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}},3498:(e,t,n)=>{var a=n(1717),o=n(9928),i=n(6044),r=0,s=1,l=2,c=3,g=4,u=5,d=6,h=7,p={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;p.getBCHDigit(t)-p.getBCHDigit(p.G15)>=0;)t^=p.G15<<p.getBCHDigit(t)-p.getBCHDigit(p.G15);return(e<<10|t)^p.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;p.getBCHDigit(t)-p.getBCHDigit(p.G18)>=0;)t^=p.G18<<p.getBCHDigit(t)-p.getBCHDigit(p.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return p.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case r:return(t+n)%2==0;case s:return t%2==0;case l:return n%3==0;case c:return(t+n)%3==0;case g:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case u:return t*n%2+t*n%3==0;case d:return(t*n%2+t*n%3)%2==0;case h:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new o([1],0),n=0;n<e;n++)t=t.multiply(new o([1,i.gexp(n)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case a.MODE_NUMBER:return 10;case a.MODE_ALPHA_NUM:return 9;case a.MODE_8BIT_BYTE:case a.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case a.MODE_NUMBER:return 12;case a.MODE_ALPHA_NUM:return 11;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case a.MODE_NUMBER:return 14;case a.MODE_ALPHA_NUM:return 13;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,a=0;a<t;a++)for(var o=0;o<t;o++){for(var i=0,r=e.isDark(a,o),s=-1;s<=1;s++)if(!(a+s<0||t<=a+s))for(var l=-1;l<=1;l++)o+l<0||t<=o+l||0==s&&0==l||r==e.isDark(a+s,o+l)&&i++;i>5&&(n+=3+i-5)}for(a=0;a<t-1;a++)for(o=0;o<t-1;o++){var c=0;e.isDark(a,o)&&c++,e.isDark(a+1,o)&&c++,e.isDark(a,o+1)&&c++,e.isDark(a+1,o+1)&&c++,0!=c&&4!=c||(n+=3)}for(a=0;a<t;a++)for(o=0;o<t-6;o++)e.isDark(a,o)&&!e.isDark(a,o+1)&&e.isDark(a,o+2)&&e.isDark(a,o+3)&&e.isDark(a,o+4)&&!e.isDark(a,o+5)&&e.isDark(a,o+6)&&(n+=40);for(o=0;o<t;o++)for(a=0;a<t-6;a++)e.isDark(a,o)&&!e.isDark(a+1,o)&&e.isDark(a+2,o)&&e.isDark(a+3,o)&&e.isDark(a+4,o)&&!e.isDark(a+5,o)&&e.isDark(a+6,o)&&(n+=40);var g=0;for(o=0;o<t;o++)for(a=0;a<t;a++)e.isDark(a,o)&&g++;return n+=10*(Math.abs(100*g/t/t-50)/5)}};e.exports=p},7276:(e,t)=>{"use strict";var n,a=Symbol.for("react.element"),o=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),g=Symbol.for("react.server_context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),I=Symbol.for("react.offscreen");function C(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case a:switch(e=e.type){case i:case s:case r:case d:case h:return e;default:switch(e=e&&e.$$typeof){case g:case c:case u:case m:case p:case l:return e;default:return t}}case o:return t}}}n=Symbol.for("react.module.reference"),t.ForwardRef=u,t.isFragment=function(e){return C(e)===i},t.isMemo=function(e){return C(e)===p}},3808:(e,t,n)=>{"use strict";e.exports=n(7276)},5914:(e,t,n)=>{"use strict";var a=n(2483),o=n(3557);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)r.add(t[e])}var g=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function m(e,t,n,a,o,i,r){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=a,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=r}var I={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){I[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];I[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){I[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){I[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){I[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){I[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){I[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){I[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){I[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var C=/[\-:]([a-z])/g;function f(e){return e[1].toUpperCase()}function b(e,t,n,a){var o=I.hasOwnProperty(t)?I[t]:null;(null!==o?0!==o.type:a||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,a){if(null===t||"undefined"===typeof t||function(e,t,n,a){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!a&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,a))return!0;if(a)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,a)&&(n=null),a||null===o?function(e){return!!u.call(p,e)||!u.call(h,e)&&(d.test(e)?p[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,a=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,a?e.setAttributeNS(a,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(C,f);I[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(C,f);I[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(C,f);I[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){I[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),I.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){I[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),v=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),Z=Symbol.for("react.provider"),w=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),V=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var X=Symbol.iterator;function M(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=X&&e[X]||e["@@iterator"])?e:null}var T,E=Object.assign;function F(e){if(void 0===T)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);T=t&&t[1]||""}return"\n"+T+e}var H=!1;function J(e,t){if(!e||H)return"";H=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var a=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){a=c}e.call(t.prototype)}else{try{throw Error()}catch(c){a=c}e()}}catch(c){if(c&&a&&"string"===typeof c.stack){for(var o=c.stack.split("\n"),i=a.stack.split("\n"),r=o.length-1,s=i.length-1;1<=r&&0<=s&&o[r]!==i[s];)s--;for(;1<=r&&0<=s;r--,s--)if(o[r]!==i[s]){if(1!==r||1!==s)do{if(r--,0>--s||o[r]!==i[s]){var l="\n"+o[r].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=r&&0<=s);break}}}finally{H=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function Y(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=J(e.type,!1);case 11:return e=J(e.type.render,!1);case 1:return e=J(e.type,!0);default:return""}}function L(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case v:return"Portal";case G:return"Profiler";case x:return"StrictMode";case B:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case w:return(e.displayName||"Context")+".Consumer";case Z:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case W:return null!==(t=e.displayName||null)?t:L(e.type)||"Memo";case V:t=e._payload,e=e._init;try{return L(e(t))}catch(n){}}return null}function z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return L(t);case 8:return t===x?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function K(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function D(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function U(e){e._valueTracker||(e._valueTracker=function(e){var t=D(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){a=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(e){a=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function P(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),a="";return e&&(a=D(e)?e.checked?"true":"false":e.value),(e=a)!==n&&(t.setValue(e),!0)}function O(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function _(e,t){var n=t.checked;return E({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,a=null!=t.checked?t.checked:t.defaultChecked;n=K(null!=t.value?t.value:n),e._wrapperState={initialChecked:a,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function j(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function q(e,t){j(e,t);var n=K(t.value),a=t.type;if(null!=n)"number"===a?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===a||"reset"===a)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,K(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!("submit"!==a&&"reset"!==a||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&O(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,a){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&a&&(e[n].defaultSelected=!0)}else{for(n=""+K(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(a&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return E({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:K(n)}}function ie(e,t){var n=K(t.value),a=K(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=a&&(e.defaultValue=""+a)}function re(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ge,ue=(ge=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,a){MSApp.execUnsafeLocalFunction((function(){return ge(e,t)}))}:ge);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function Ie(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var a=0===n.indexOf("--"),o=me(n,t[n],a);"float"===n&&(n="cssFloat"),a?e.setProperty(n,o):e[n]=o}}Object.keys(he).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]}))}));var Ce=E({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fe(e,t){if(t){if(Ce[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function Ae(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ve=null,Se=null,xe=null;function Ge(e){if(e=yo(e)){if("function"!==typeof ve)throw Error(i(280));var t=e.stateNode;t&&(t=vo(t),ve(e.stateNode,e.type,t))}}function Ze(e){Se?xe?xe.push(e):xe=[e]:Se=e}function we(){if(Se){var e=Se,t=xe;if(xe=Se=null,Ge(e),t)for(e=0;e<t.length;e++)Ge(t[e])}}function ke(e,t){return e(t)}function Be(){}var Re=!1;function We(e,t,n){if(Re)return e(t,n);Re=!0;try{return ke(e,t,n)}finally{Re=!1,(null!==Se||null!==xe)&&(Be(),we())}}function Ve(e,t){var n=e.stateNode;if(null===n)return null;var a=vo(n);if(null===a)return null;n=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(a=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!a;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Ne=!1;if(g)try{var Xe={};Object.defineProperty(Xe,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",Xe,Xe),window.removeEventListener("test",Xe,Xe)}catch(ge){Ne=!1}function Me(e,t,n,a,o,i,r,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(g){this.onError(g)}}var Te=!1,Ee=null,Fe=!1,He=null,Je={onError:function(e){Te=!0,Ee=e}};function Ye(e,t,n,a,o,i,r,s,l){Te=!1,Ee=null,Me.apply(Je,arguments)}function Le(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ke(e){if(Le(e)!==e)throw Error(i(188))}function De(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Le(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,a=t;;){var o=n.return;if(null===o)break;var r=o.alternate;if(null===r){if(null!==(a=o.return)){n=a;continue}break}if(o.child===r.child){for(r=o.child;r;){if(r===n)return Ke(o),e;if(r===a)return Ke(o),t;r=r.sibling}throw Error(i(188))}if(n.return!==a.return)n=o,a=r;else{for(var s=!1,l=o.child;l;){if(l===n){s=!0,n=o,a=r;break}if(l===a){s=!0,a=o,n=r;break}l=l.sibling}if(!s){for(l=r.child;l;){if(l===n){s=!0,n=r,a=o;break}if(l===a){s=!0,a=r,n=o;break}l=l.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==a)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?Ue(e):null}function Ue(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ue(e);if(null!==t)return t;e=e.sibling}return null}var Pe=o.unstable_scheduleCallback,Oe=o.unstable_cancelCallback,_e=o.unstable_shouldYield,Qe=o.unstable_requestPaint,je=o.unstable_now,qe=o.unstable_getCurrentPriorityLevel,$e=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,at=o.unstable_IdlePriority,ot=null,it=null;var rt=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,gt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var a=0,o=e.suspendedLanes,i=e.pingedLanes,r=268435455&n;if(0!==r){var s=r&~o;0!==s?a=ut(s):0!==(i&=r)&&(a=ut(i))}else 0!==(r=n&~o)?a=ut(r):0!==i&&(a=ut(i));if(0===a)return 0;if(0!==t&&t!==a&&0===(t&o)&&((o=a&-a)>=(i=t&-t)||16===o&&0!==(4194240&i)))return t;if(0!==(4&a)&&(a|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=a;0<t;)o=1<<(n=31-rt(t)),a|=e[n],t&=~o;return a}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function It(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ct(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-rt(t)]=n}function ft(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var a=31-rt(n),o=1<<a;o&t|e[a]&t&&(e[a]|=t),n&=~o}}var bt=0;function yt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var At,vt,St,xt,Gt,Zt=!1,wt=[],kt=null,Bt=null,Rt=null,Wt=new Map,Vt=new Map,Nt=[],Xt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mt(e,t){switch(e){case"focusin":case"focusout":kt=null;break;case"dragenter":case"dragleave":Bt=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":Wt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vt.delete(t.pointerId)}}function Tt(e,t,n,a,o,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:a,nativeEvent:i,targetContainers:[o]},null!==t&&(null!==(t=yo(t))&&vt(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Et(e){var t=bo(e.target);if(null!==t){var n=Le(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=ze(n)))return e.blockedOn=t,void Gt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=_t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yo(n))&&vt(t),e.blockedOn=n,!1;var a=new(n=e.nativeEvent).constructor(n.type,n);ye=a,n.target.dispatchEvent(a),ye=null,t.shift()}return!0}function Ht(e,t,n){Ft(e)&&n.delete(t)}function Jt(){Zt=!1,null!==kt&&Ft(kt)&&(kt=null),null!==Bt&&Ft(Bt)&&(Bt=null),null!==Rt&&Ft(Rt)&&(Rt=null),Wt.forEach(Ht),Vt.forEach(Ht)}function Yt(e,t){e.blockedOn===t&&(e.blockedOn=null,Zt||(Zt=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Jt)))}function Lt(e){function t(t){return Yt(t,e)}if(0<wt.length){Yt(wt[0],e);for(var n=1;n<wt.length;n++){var a=wt[n];a.blockedOn===e&&(a.blockedOn=null)}}for(null!==kt&&Yt(kt,e),null!==Bt&&Yt(Bt,e),null!==Rt&&Yt(Rt,e),Wt.forEach(t),Vt.forEach(t),n=0;n<Nt.length;n++)(a=Nt[n]).blockedOn===e&&(a.blockedOn=null);for(;0<Nt.length&&null===(n=Nt[0]).blockedOn;)Et(n),null===n.blockedOn&&Nt.shift()}var zt=y.ReactCurrentBatchConfig,Kt=!0;function Dt(e,t,n,a){var o=bt,i=zt.transition;zt.transition=null;try{bt=1,Pt(e,t,n,a)}finally{bt=o,zt.transition=i}}function Ut(e,t,n,a){var o=bt,i=zt.transition;zt.transition=null;try{bt=4,Pt(e,t,n,a)}finally{bt=o,zt.transition=i}}function Pt(e,t,n,a){if(Kt){var o=_t(e,t,n,a);if(null===o)Ka(e,t,a,Ot,n),Mt(e,a);else if(function(e,t,n,a,o){switch(t){case"focusin":return kt=Tt(kt,e,t,n,a,o),!0;case"dragenter":return Bt=Tt(Bt,e,t,n,a,o),!0;case"mouseover":return Rt=Tt(Rt,e,t,n,a,o),!0;case"pointerover":var i=o.pointerId;return Wt.set(i,Tt(Wt.get(i)||null,e,t,n,a,o)),!0;case"gotpointercapture":return i=o.pointerId,Vt.set(i,Tt(Vt.get(i)||null,e,t,n,a,o)),!0}return!1}(o,e,t,n,a))a.stopPropagation();else if(Mt(e,a),4&t&&-1<Xt.indexOf(e)){for(;null!==o;){var i=yo(o);if(null!==i&&At(i),null===(i=_t(e,t,n,a))&&Ka(e,t,a,Ot,n),i===o)break;o=i}null!==o&&a.stopPropagation()}else Ka(e,t,a,null,n)}}var Ot=null;function _t(e,t,n,a){if(Ot=null,null!==(e=bo(e=Ae(a))))if(null===(t=Le(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ot=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case at:return 536870912;default:return 16}default:return 16}}var jt=null,qt=null,$t=null;function en(){if($t)return $t;var e,t,n=qt,a=n.length,o="value"in jt?jt.value:jt.textContent,i=o.length;for(e=0;e<a&&n[e]===o[e];e++);var r=a-e;for(t=1;t<=r&&n[a-t]===o[i-t];t++);return $t=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function an(){return!1}function on(e){function t(t,n,a,o,i){for(var r in this._reactName=t,this._targetInst=a,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(r)&&(t=e[r],this[r]=t?t(o):o[r]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:an,this.isPropagationStopped=an,this}return E(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var rn,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gn=on(cn),un=E({},cn,{view:0,detail:0}),dn=on(un),hn=E({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(rn=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=rn=0,ln=e),rn)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=on(hn),mn=on(E({},hn,{dataTransfer:0})),In=on(E({},un,{relatedTarget:0})),Cn=on(E({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),fn=E({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(fn),yn=on(E({},cn,{data:0})),An={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Gn(){return xn}var Zn=E({},un,{key:function(e){if(e.key){var t=An[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?vn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),wn=on(Zn),kn=on(E({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Bn=on(E({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gn})),Rn=on(E({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Wn=E({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Vn=on(Wn),Nn=[9,13,27,32],Xn=g&&"CompositionEvent"in window,Mn=null;g&&"documentMode"in document&&(Mn=document.documentMode);var Tn=g&&"TextEvent"in window&&!Mn,En=g&&(!Xn||Mn&&8<Mn&&11>=Mn),Fn=String.fromCharCode(32),Hn=!1;function Jn(e,t){switch(e){case"keyup":return-1!==Nn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Ln=!1;var zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zn[e.type]:"textarea"===t}function Dn(e,t,n,a){Ze(a),0<(t=Ua(t,"onChange")).length&&(n=new gn("onChange","change",null,n,a),e.push({event:n,listeners:t}))}var Un=null,Pn=null;function On(e){Fa(e,0)}function _n(e){if(P(Ao(e)))return e}function Qn(e,t){if("change"===e)return t}var jn=!1;if(g){var qn;if(g){var $n="oninput"in document;if(!$n){var ea=document.createElement("div");ea.setAttribute("oninput","return;"),$n="function"===typeof ea.oninput}qn=$n}else qn=!1;jn=qn&&(!document.documentMode||9<document.documentMode)}function ta(){Un&&(Un.detachEvent("onpropertychange",na),Pn=Un=null)}function na(e){if("value"===e.propertyName&&_n(Pn)){var t=[];Dn(t,Pn,e,Ae(e)),We(On,t)}}function aa(e,t,n){"focusin"===e?(ta(),Pn=n,(Un=t).attachEvent("onpropertychange",na)):"focusout"===e&&ta()}function oa(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return _n(Pn)}function ia(e,t){if("click"===e)return _n(t)}function ra(e,t){if("input"===e||"change"===e)return _n(t)}var sa="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function la(e,t){if(sa(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++){var o=n[a];if(!u.call(t,o)||!sa(e[o],t[o]))return!1}return!0}function ca(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ga(e,t){var n,a=ca(e);for(e=0;a;){if(3===a.nodeType){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=ca(a)}}function ua(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ua(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function da(){for(var e=window,t=O();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(a){n=!1}if(!n)break;t=O((e=t.contentWindow).document)}return t}function ha(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pa(e){var t=da(),n=e.focusedElem,a=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ua(n.ownerDocument.documentElement,n)){if(null!==a&&ha(n))if(t=a.start,void 0===(e=a.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(a.start,o);a=void 0===a.end?i:Math.min(a.end,o),!e.extend&&i>a&&(o=a,a=i,i=o),o=ga(n,i);var r=ga(n,a);o&&r&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==r.node||e.focusOffset!==r.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),i>a?(e.addRange(t),e.extend(r.node,r.offset)):(t.setEnd(r.node,r.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ma=g&&"documentMode"in document&&11>=document.documentMode,Ia=null,Ca=null,fa=null,ba=!1;function ya(e,t,n){var a=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ba||null==Ia||Ia!==O(a)||("selectionStart"in(a=Ia)&&ha(a)?a={start:a.selectionStart,end:a.selectionEnd}:a={anchorNode:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset},fa&&la(fa,a)||(fa=a,0<(a=Ua(Ca,"onSelect")).length&&(t=new gn("onSelect","select",null,t,n),e.push({event:t,listeners:a}),t.target=Ia)))}function Aa(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var va={animationend:Aa("Animation","AnimationEnd"),animationiteration:Aa("Animation","AnimationIteration"),animationstart:Aa("Animation","AnimationStart"),transitionend:Aa("Transition","TransitionEnd")},Sa={},xa={};function Ga(e){if(Sa[e])return Sa[e];if(!va[e])return e;var t,n=va[e];for(t in n)if(n.hasOwnProperty(t)&&t in xa)return Sa[e]=n[t];return e}g&&(xa=document.createElement("div").style,"AnimationEvent"in window||(delete va.animationend.animation,delete va.animationiteration.animation,delete va.animationstart.animation),"TransitionEvent"in window||delete va.transitionend.transition);var Za=Ga("animationend"),wa=Ga("animationiteration"),ka=Ga("animationstart"),Ba=Ga("transitionend"),Ra=new Map,Wa="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Va(e,t){Ra.set(e,t),l(t,[e])}for(var Na=0;Na<Wa.length;Na++){var Xa=Wa[Na];Va(Xa.toLowerCase(),"on"+(Xa[0].toUpperCase()+Xa.slice(1)))}Va(Za,"onAnimationEnd"),Va(wa,"onAnimationIteration"),Va(ka,"onAnimationStart"),Va("dblclick","onDoubleClick"),Va("focusin","onFocus"),Va("focusout","onBlur"),Va(Ba,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ma="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ta=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ma));function Ea(e,t,n){var a=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,a,o,r,s,l,c){if(Ye.apply(this,arguments),Te){if(!Te)throw Error(i(198));var g=Ee;Te=!1,Ee=null,Fe||(Fe=!0,He=g)}}(a,t,void 0,e),e.currentTarget=null}function Fa(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var a=e[n],o=a.event;a=a.listeners;e:{var i=void 0;if(t)for(var r=a.length-1;0<=r;r--){var s=a[r],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==i&&o.isPropagationStopped())break e;Ea(o,s,c),i=l}else for(r=0;r<a.length;r++){if(l=(s=a[r]).instance,c=s.currentTarget,s=s.listener,l!==i&&o.isPropagationStopped())break e;Ea(o,s,c),i=l}}}if(Fe)throw e=He,Fe=!1,He=null,e}function Ha(e,t){var n=t[Io];void 0===n&&(n=t[Io]=new Set);var a=e+"__bubble";n.has(a)||(za(t,e,2,!1),n.add(a))}function Ja(e,t,n){var a=0;t&&(a|=4),za(n,e,a,t)}var Ya="_reactListening"+Math.random().toString(36).slice(2);function La(e){if(!e[Ya]){e[Ya]=!0,r.forEach((function(t){"selectionchange"!==t&&(Ta.has(t)||Ja(t,!1,e),Ja(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ya]||(t[Ya]=!0,Ja("selectionchange",!1,t))}}function za(e,t,n,a){switch(Qt(t)){case 1:var o=Dt;break;case 4:o=Ut;break;default:o=Pt}n=o.bind(null,t,n,e),o=void 0,!Ne||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),a?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Ka(e,t,n,a,o){var i=a;if(0===(1&t)&&0===(2&t)&&null!==a)e:for(;;){if(null===a)return;var r=a.tag;if(3===r||4===r){var s=a.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===r)for(r=a.return;null!==r;){var l=r.tag;if((3===l||4===l)&&((l=r.stateNode.containerInfo)===o||8===l.nodeType&&l.parentNode===o))return;r=r.return}for(;null!==s;){if(null===(r=bo(s)))return;if(5===(l=r.tag)||6===l){a=i=r;continue e}s=s.parentNode}}a=a.return}We((function(){var a=i,o=Ae(n),r=[];e:{var s=Ra.get(e);if(void 0!==s){var l=gn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=wn;break;case"focusin":c="focus",l=In;break;case"focusout":c="blur",l=In;break;case"beforeblur":case"afterblur":l=In;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Bn;break;case Za:case wa:case ka:l=Cn;break;case Ba:l=Rn;break;case"scroll":l=dn;break;case"wheel":l=Vn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=kn}var g=0!==(4&t),u=!g&&"scroll"===e,d=g?null!==s?s+"Capture":null:s;g=[];for(var h,p=a;null!==p;){var m=(h=p).stateNode;if(5===h.tag&&null!==m&&(h=m,null!==d&&(null!=(m=Ve(p,d))&&g.push(Da(p,m,h)))),u)break;p=p.return}0<g.length&&(s=new l(s,c,null,n,o),r.push({event:s,listeners:g}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===ye||!(c=n.relatedTarget||n.fromElement)||!bo(c)&&!c[mo])&&(l||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=a,null!==(c=(c=n.relatedTarget||n.toElement)?bo(c):null)&&(c!==(u=Le(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=a),l!==c)){if(g=pn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(g=kn,m="onPointerLeave",d="onPointerEnter",p="pointer"),u=null==l?s:Ao(l),h=null==c?s:Ao(c),(s=new g(m,p+"leave",l,n,o)).target=u,s.relatedTarget=h,m=null,bo(o)===a&&((g=new g(d,p+"enter",c,n,o)).target=h,g.relatedTarget=u,m=g),u=m,l&&c)e:{for(d=c,p=0,h=g=l;h;h=Pa(h))p++;for(h=0,m=d;m;m=Pa(m))h++;for(;0<p-h;)g=Pa(g),p--;for(;0<h-p;)d=Pa(d),h--;for(;p--;){if(g===d||null!==d&&g===d.alternate)break e;g=Pa(g),d=Pa(d)}g=null}else g=null;null!==l&&Oa(r,s,l,g,!1),null!==c&&null!==u&&Oa(r,u,c,g,!0)}if("select"===(l=(s=a?Ao(a):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var I=Qn;else if(Kn(s))if(jn)I=ra;else{I=oa;var C=aa}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(I=ia);switch(I&&(I=I(e,a))?Dn(r,I,n,o):(C&&C(e,s,a),"focusout"===e&&(C=s._wrapperState)&&C.controlled&&"number"===s.type&&ee(s,"number",s.value)),C=a?Ao(a):window,e){case"focusin":(Kn(C)||"true"===C.contentEditable)&&(Ia=C,Ca=a,fa=null);break;case"focusout":fa=Ca=Ia=null;break;case"mousedown":ba=!0;break;case"contextmenu":case"mouseup":case"dragend":ba=!1,ya(r,n,o);break;case"selectionchange":if(ma)break;case"keydown":case"keyup":ya(r,n,o)}var f;if(Xn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Ln?Jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(En&&"ko"!==n.locale&&(Ln||"onCompositionStart"!==b?"onCompositionEnd"===b&&Ln&&(f=en()):(qt="value"in(jt=o)?jt.value:jt.textContent,Ln=!0)),0<(C=Ua(a,b)).length&&(b=new yn(b,e,null,n,o),r.push({event:b,listeners:C}),f?b.data=f:null!==(f=Yn(n))&&(b.data=f))),(f=Tn?function(e,t){switch(e){case"compositionend":return Yn(t);case"keypress":return 32!==t.which?null:(Hn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Hn?null:e;default:return null}}(e,n):function(e,t){if(Ln)return"compositionend"===e||!Xn&&Jn(e,t)?(e=en(),$t=qt=jt=null,Ln=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return En&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(a=Ua(a,"onBeforeInput")).length&&(o=new yn("onBeforeInput","beforeinput",null,n,o),r.push({event:o,listeners:a}),o.data=f))}Fa(r,t)}))}function Da(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ua(e,t){for(var n=t+"Capture",a=[];null!==e;){var o=e,i=o.stateNode;5===o.tag&&null!==i&&(o=i,null!=(i=Ve(e,n))&&a.unshift(Da(e,i,o)),null!=(i=Ve(e,t))&&a.push(Da(e,i,o))),e=e.return}return a}function Pa(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Oa(e,t,n,a,o){for(var i=t._reactName,r=[];null!==n&&n!==a;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===a)break;5===s.tag&&null!==c&&(s=c,o?null!=(l=Ve(n,i))&&r.unshift(Da(n,l,s)):o||null!=(l=Ve(n,i))&&r.push(Da(n,l,s))),n=n.return}0!==r.length&&e.push({event:t,listeners:r})}var _a=/\r\n?/g,Qa=/\u0000|\uFFFD/g;function ja(e){return("string"===typeof e?e:""+e).replace(_a,"\n").replace(Qa,"")}function qa(e,t,n){if(t=ja(t),ja(e)!==t&&n)throw Error(i(425))}function $a(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ao="function"===typeof setTimeout?setTimeout:void 0,oo="function"===typeof clearTimeout?clearTimeout:void 0,io="function"===typeof Promise?Promise:void 0,ro="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof io?function(e){return io.resolve(null).then(e).catch(so)}:ao;function so(e){setTimeout((function(){throw e}))}function lo(e,t){var n=t,a=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===a)return e.removeChild(o),void Lt(t);a--}else"$"!==n&&"$?"!==n&&"$!"!==n||a++;n=o}while(n);Lt(t)}function co(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function go(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var uo=Math.random().toString(36).slice(2),ho="__reactFiber$"+uo,po="__reactProps$"+uo,mo="__reactContainer$"+uo,Io="__reactEvents$"+uo,Co="__reactListeners$"+uo,fo="__reactHandles$"+uo;function bo(e){var t=e[ho];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mo]||n[ho]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=go(e);null!==e;){if(n=e[ho])return n;e=go(e)}return t}n=(e=n).parentNode}return null}function yo(e){return!(e=e[ho]||e[mo])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ao(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function vo(e){return e[po]||null}var So=[],xo=-1;function Go(e){return{current:e}}function Zo(e){0>xo||(e.current=So[xo],So[xo]=null,xo--)}function wo(e,t){xo++,So[xo]=e.current,e.current=t}var ko={},Bo=Go(ko),Ro=Go(!1),Wo=ko;function Vo(e,t){var n=e.type.contextTypes;if(!n)return ko;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var o,i={};for(o in n)i[o]=t[o];return a&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function No(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Xo(){Zo(Ro),Zo(Bo)}function Mo(e,t,n){if(Bo.current!==ko)throw Error(i(168));wo(Bo,t),wo(Ro,n)}function To(e,t,n){var a=e.stateNode;if(t=t.childContextTypes,"function"!==typeof a.getChildContext)return n;for(var o in a=a.getChildContext())if(!(o in t))throw Error(i(108,z(e)||"Unknown",o));return E({},n,a)}function Eo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ko,Wo=Bo.current,wo(Bo,e),wo(Ro,Ro.current),!0}function Fo(e,t,n){var a=e.stateNode;if(!a)throw Error(i(169));n?(e=To(e,t,Wo),a.__reactInternalMemoizedMergedChildContext=e,Zo(Ro),Zo(Bo),wo(Bo,e)):Zo(Ro),wo(Ro,n)}var Ho=null,Jo=!1,Yo=!1;function Lo(e){null===Ho?Ho=[e]:Ho.push(e)}function zo(){if(!Yo&&null!==Ho){Yo=!0;var e=0,t=bt;try{var n=Ho;for(bt=1;e<n.length;e++){var a=n[e];do{a=a(!0)}while(null!==a)}Ho=null,Jo=!1}catch(o){throw null!==Ho&&(Ho=Ho.slice(e+1)),Pe($e,zo),o}finally{bt=t,Yo=!1}}return null}var Ko=[],Do=0,Uo=null,Po=0,Oo=[],_o=0,Qo=null,jo=1,qo="";function $o(e,t){Ko[Do++]=Po,Ko[Do++]=Uo,Uo=e,Po=t}function ei(e,t,n){Oo[_o++]=jo,Oo[_o++]=qo,Oo[_o++]=Qo,Qo=e;var a=jo;e=qo;var o=32-rt(a)-1;a&=~(1<<o),n+=1;var i=32-rt(t)+o;if(30<i){var r=o-o%5;i=(a&(1<<r)-1).toString(32),a>>=r,o-=r,jo=1<<32-rt(t)+o|n<<o|a,qo=i+e}else jo=1<<i|n<<o|a,qo=e}function ti(e){null!==e.return&&($o(e,1),ei(e,1,0))}function ni(e){for(;e===Uo;)Uo=Ko[--Do],Ko[Do]=null,Po=Ko[--Do],Ko[Do]=null;for(;e===Qo;)Qo=Oo[--_o],Oo[_o]=null,qo=Oo[--_o],Oo[_o]=null,jo=Oo[--_o],Oo[_o]=null}var ai=null,oi=null,ii=!1,ri=null;function si(e,t){var n=Wc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function li(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ai=e,oi=co(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ai=e,oi=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qo?{id:jo,overflow:qo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Wc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ai=e,oi=null,!0);default:return!1}}function ci(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function gi(e){if(ii){var t=oi;if(t){var n=t;if(!li(e,t)){if(ci(e))throw Error(i(418));t=co(n.nextSibling);var a=ai;t&&li(e,t)?si(a,n):(e.flags=-4097&e.flags|2,ii=!1,ai=e)}}else{if(ci(e))throw Error(i(418));e.flags=-4097&e.flags|2,ii=!1,ai=e}}}function ui(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ai=e}function di(e){if(e!==ai)return!1;if(!ii)return ui(e),ii=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oi)){if(ci(e))throw hi(),Error(i(418));for(;t;)si(e,t),t=co(t.nextSibling)}if(ui(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oi=co(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oi=null}}else oi=ai?co(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=oi;e;)e=co(e.nextSibling)}function pi(){oi=ai=null,ii=!1}function mi(e){null===ri?ri=[e]:ri.push(e)}var Ii=y.ReactCurrentBatchConfig;function Ci(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var a=n.stateNode}if(!a)throw Error(i(147,e));var o=a,r=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===r?t.ref:(t=function(e){var t=o.refs;null===e?delete t[r]:t[r]=e},t._stringRef=r,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function fi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bi(e){return(0,e._init)(e._payload)}function yi(e){function t(t,n){if(e){var a=t.deletions;null===a?(t.deletions=[n],t.flags|=16):a.push(n)}}function n(n,a){if(!e)return null;for(;null!==a;)t(n,a),a=a.sibling;return null}function a(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Nc(e,t)).index=0,e.sibling=null,e}function r(t,n,a){return t.index=a,e?null!==(a=t.alternate)?(a=a.index)<n?(t.flags|=2,n):a:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,a){return null===t||6!==t.tag?((t=Ec(n,e.mode,a)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,a){var i=n.type;return i===S?u(e,t,n.props.children,a,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===V&&bi(i)===t.type)?((a=o(t,n.props)).ref=Ci(e,t,n),a.return=e,a):((a=Xc(n.type,n.key,n.props,null,e.mode,a)).ref=Ci(e,t,n),a.return=e,a)}function g(e,t,n,a){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,a)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function u(e,t,n,a,i){return null===t||7!==t.tag?((t=Mc(n,e.mode,a,i)).return=e,t):((t=o(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ec(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case A:return(n=Xc(t.type,t.key,t.props,null,e.mode,n)).ref=Ci(e,null,t),n.return=e,n;case v:return(t=Fc(t,e.mode,n)).return=e,t;case V:return d(e,(0,t._init)(t._payload),n)}if(te(t)||M(t))return(t=Mc(t,e.mode,n,null)).return=e,t;fi(e,t)}return null}function h(e,t,n,a){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==o?null:l(e,t,""+n,a);if("object"===typeof n&&null!==n){switch(n.$$typeof){case A:return n.key===o?c(e,t,n,a):null;case v:return n.key===o?g(e,t,n,a):null;case V:return h(e,t,(o=n._init)(n._payload),a)}if(te(n)||M(n))return null!==o?null:u(e,t,n,a,null);fi(e,n)}return null}function p(e,t,n,a,o){if("string"===typeof a&&""!==a||"number"===typeof a)return l(t,e=e.get(n)||null,""+a,o);if("object"===typeof a&&null!==a){switch(a.$$typeof){case A:return c(t,e=e.get(null===a.key?n:a.key)||null,a,o);case v:return g(t,e=e.get(null===a.key?n:a.key)||null,a,o);case V:return p(e,t,n,(0,a._init)(a._payload),o)}if(te(a)||M(a))return u(t,e=e.get(n)||null,a,o,null);fi(t,a)}return null}function m(o,i,s,l){for(var c=null,g=null,u=i,m=i=0,I=null;null!==u&&m<s.length;m++){u.index>m?(I=u,u=null):I=u.sibling;var C=h(o,u,s[m],l);if(null===C){null===u&&(u=I);break}e&&u&&null===C.alternate&&t(o,u),i=r(C,i,m),null===g?c=C:g.sibling=C,g=C,u=I}if(m===s.length)return n(o,u),ii&&$o(o,m),c;if(null===u){for(;m<s.length;m++)null!==(u=d(o,s[m],l))&&(i=r(u,i,m),null===g?c=u:g.sibling=u,g=u);return ii&&$o(o,m),c}for(u=a(o,u);m<s.length;m++)null!==(I=p(u,o,m,s[m],l))&&(e&&null!==I.alternate&&u.delete(null===I.key?m:I.key),i=r(I,i,m),null===g?c=I:g.sibling=I,g=I);return e&&u.forEach((function(e){return t(o,e)})),ii&&$o(o,m),c}function I(o,s,l,c){var g=M(l);if("function"!==typeof g)throw Error(i(150));if(null==(l=g.call(l)))throw Error(i(151));for(var u=g=null,m=s,I=s=0,C=null,f=l.next();null!==m&&!f.done;I++,f=l.next()){m.index>I?(C=m,m=null):C=m.sibling;var b=h(o,m,f.value,c);if(null===b){null===m&&(m=C);break}e&&m&&null===b.alternate&&t(o,m),s=r(b,s,I),null===u?g=b:u.sibling=b,u=b,m=C}if(f.done)return n(o,m),ii&&$o(o,I),g;if(null===m){for(;!f.done;I++,f=l.next())null!==(f=d(o,f.value,c))&&(s=r(f,s,I),null===u?g=f:u.sibling=f,u=f);return ii&&$o(o,I),g}for(m=a(o,m);!f.done;I++,f=l.next())null!==(f=p(m,o,I,f.value,c))&&(e&&null!==f.alternate&&m.delete(null===f.key?I:f.key),s=r(f,s,I),null===u?g=f:u.sibling=f,u=f);return e&&m.forEach((function(e){return t(o,e)})),ii&&$o(o,I),g}return function e(a,i,r,l){if("object"===typeof r&&null!==r&&r.type===S&&null===r.key&&(r=r.props.children),"object"===typeof r&&null!==r){switch(r.$$typeof){case A:e:{for(var c=r.key,g=i;null!==g;){if(g.key===c){if((c=r.type)===S){if(7===g.tag){n(a,g.sibling),(i=o(g,r.props.children)).return=a,a=i;break e}}else if(g.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===V&&bi(c)===g.type){n(a,g.sibling),(i=o(g,r.props)).ref=Ci(a,g,r),i.return=a,a=i;break e}n(a,g);break}t(a,g),g=g.sibling}r.type===S?((i=Mc(r.props.children,a.mode,l,r.key)).return=a,a=i):((l=Xc(r.type,r.key,r.props,null,a.mode,l)).ref=Ci(a,i,r),l.return=a,a=l)}return s(a);case v:e:{for(g=r.key;null!==i;){if(i.key===g){if(4===i.tag&&i.stateNode.containerInfo===r.containerInfo&&i.stateNode.implementation===r.implementation){n(a,i.sibling),(i=o(i,r.children||[])).return=a,a=i;break e}n(a,i);break}t(a,i),i=i.sibling}(i=Fc(r,a.mode,l)).return=a,a=i}return s(a);case V:return e(a,i,(g=r._init)(r._payload),l)}if(te(r))return m(a,i,r,l);if(M(r))return I(a,i,r,l);fi(a,r)}return"string"===typeof r&&""!==r||"number"===typeof r?(r=""+r,null!==i&&6===i.tag?(n(a,i.sibling),(i=o(i,r)).return=a,a=i):(n(a,i),(i=Ec(r,a.mode,l)).return=a,a=i),s(a)):n(a,i)}}var Ai=yi(!0),vi=yi(!1),Si=Go(null),xi=null,Gi=null,Zi=null;function wi(){Zi=Gi=xi=null}function ki(e){var t=Si.current;Zo(Si),e._currentValue=t}function Bi(e,t,n){for(;null!==e;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==a&&(a.childLanes|=t)):null!==a&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===n)break;e=e.return}}function Ri(e,t){xi=e,Zi=Gi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Wi(e){var t=e._currentValue;if(Zi!==e)if(e={context:e,memoizedValue:t,next:null},null===Gi){if(null===xi)throw Error(i(308));Gi=e,xi.dependencies={lanes:0,firstContext:e}}else Gi=Gi.next=e;return t}var Vi=null;function Ni(e){null===Vi?Vi=[e]:Vi.push(e)}function Xi(e,t,n,a){var o=t.interleaved;return null===o?(n.next=n,Ni(t)):(n.next=o.next,o.next=n),t.interleaved=n,Mi(e,a)}function Mi(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ti=!1;function Ei(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Hi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ji(e,t,n){var a=e.updateQueue;if(null===a)return null;if(a=a.shared,0!==(2&kl)){var o=a.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),a.pending=t,Mi(e,n)}return null===(o=a.interleaved)?(t.next=t,Ni(a)):(t.next=o.next,o.next=t),a.interleaved=t,Mi(e,n)}function Yi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,ft(e,n)}}function Li(e,t){var n=e.updateQueue,a=e.alternate;if(null!==a&&n===(a=a.updateQueue)){var o=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var r={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?o=i=r:i=i.next=r,n=n.next}while(null!==n);null===i?o=i=t:i=i.next=t}else o=i=t;return n={baseState:a.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:a.shared,effects:a.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function zi(e,t,n,a){var o=e.updateQueue;Ti=!1;var i=o.firstBaseUpdate,r=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var l=s,c=l.next;l.next=null,null===r?i=c:r.next=c,r=l;var g=e.alternate;null!==g&&((s=(g=g.updateQueue).lastBaseUpdate)!==r&&(null===s?g.firstBaseUpdate=c:s.next=c,g.lastBaseUpdate=l))}if(null!==i){var u=o.baseState;for(r=0,g=c=l=null,s=i;;){var d=s.lane,h=s.eventTime;if((a&d)===d){null!==g&&(g=g.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(d=t,h=n,m.tag){case 1:if("function"===typeof(p=m.payload)){u=p.call(h,u,d);break e}u=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=m.payload)?p.call(h,u,d):p)||void 0===d)break e;u=E({},u,d);break e;case 2:Ti=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=o.effects)?o.effects=[s]:d.push(s))}else h={eventTime:h,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===g?(c=g=h,l=u):g=g.next=h,r|=d;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(d=s).next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}if(null===g&&(l=u),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=g,null!==(t=o.shared.interleaved)){o=t;do{r|=o.lane,o=o.next}while(o!==t)}else null===i&&(o.shared.lanes=0);Tl|=r,e.lanes=r,e.memoizedState=u}}function Ki(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var a=e[t],o=a.callback;if(null!==o){if(a.callback=null,a=n,"function"!==typeof o)throw Error(i(191,o));o.call(a)}}}var Di={},Ui=Go(Di),Pi=Go(Di),Oi=Go(Di);function _i(e){if(e===Di)throw Error(i(174));return e}function Qi(e,t){switch(wo(Oi,t),wo(Pi,e),wo(Ui,Di),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Zo(Ui),wo(Ui,t)}function ji(){Zo(Ui),Zo(Pi),Zo(Oi)}function qi(e){_i(Oi.current);var t=_i(Ui.current),n=le(t,e.type);t!==n&&(wo(Pi,e),wo(Ui,n))}function $i(e){Pi.current===e&&(Zo(Ui),Zo(Pi))}var er=Go(0);function tr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var nr=[];function ar(){for(var e=0;e<nr.length;e++)nr[e]._workInProgressVersionPrimary=null;nr.length=0}var or=y.ReactCurrentDispatcher,ir=y.ReactCurrentBatchConfig,rr=0,sr=null,lr=null,cr=null,gr=!1,ur=!1,dr=0,hr=0;function pr(){throw Error(i(321))}function mr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sa(e[n],t[n]))return!1;return!0}function Ir(e,t,n,a,o,r){if(rr=r,sr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,or.current=null===e||null===e.memoizedState?$r:es,e=n(a,o),ur){r=0;do{if(ur=!1,dr=0,25<=r)throw Error(i(301));r+=1,cr=lr=null,t.updateQueue=null,or.current=ts,e=n(a,o)}while(ur)}if(or.current=qr,t=null!==lr&&null!==lr.next,rr=0,cr=lr=sr=null,gr=!1,t)throw Error(i(300));return e}function Cr(){var e=0!==dr;return dr=0,e}function fr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===cr?sr.memoizedState=cr=e:cr=cr.next=e,cr}function br(){if(null===lr){var e=sr.alternate;e=null!==e?e.memoizedState:null}else e=lr.next;var t=null===cr?sr.memoizedState:cr.next;if(null!==t)cr=t,lr=e;else{if(null===e)throw Error(i(310));e={memoizedState:(lr=e).memoizedState,baseState:lr.baseState,baseQueue:lr.baseQueue,queue:lr.queue,next:null},null===cr?sr.memoizedState=cr=e:cr=cr.next=e}return cr}function yr(e,t){return"function"===typeof t?t(e):t}function Ar(e){var t=br(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var a=lr,o=a.baseQueue,r=n.pending;if(null!==r){if(null!==o){var s=o.next;o.next=r.next,r.next=s}a.baseQueue=o=r,n.pending=null}if(null!==o){r=o.next,a=a.baseState;var l=s=null,c=null,g=r;do{var u=g.lane;if((rr&u)===u)null!==c&&(c=c.next={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null}),a=g.hasEagerState?g.eagerState:e(a,g.action);else{var d={lane:u,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};null===c?(l=c=d,s=a):c=c.next=d,sr.lanes|=u,Tl|=u}g=g.next}while(null!==g&&g!==r);null===c?s=a:c.next=l,sa(a,t.memoizedState)||(bs=!0),t.memoizedState=a,t.baseState=s,t.baseQueue=c,n.lastRenderedState=a}if(null!==(e=n.interleaved)){o=e;do{r=o.lane,sr.lanes|=r,Tl|=r,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function vr(e){var t=br(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var a=n.dispatch,o=n.pending,r=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{r=e(r,s.action),s=s.next}while(s!==o);sa(r,t.memoizedState)||(bs=!0),t.memoizedState=r,null===t.baseQueue&&(t.baseState=r),n.lastRenderedState=r}return[r,a]}function Sr(){}function xr(e,t){var n=sr,a=br(),o=t(),r=!sa(a.memoizedState,o);if(r&&(a.memoizedState=o,bs=!0),a=a.queue,Tr(wr.bind(null,n,a,e),[e]),a.getSnapshot!==t||r||null!==cr&&1&cr.memoizedState.tag){if(n.flags|=2048,Wr(9,Zr.bind(null,n,a,o,t),void 0,null),null===Bl)throw Error(i(349));0!==(30&rr)||Gr(n,t,o)}return o}function Gr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=sr.updateQueue)?(t={lastEffect:null,stores:null},sr.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Zr(e,t,n,a){t.value=n,t.getSnapshot=a,kr(t)&&Br(e)}function wr(e,t,n){return n((function(){kr(t)&&Br(e)}))}function kr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sa(e,n)}catch(a){return!0}}function Br(e){var t=Mi(e,1);null!==t&&nc(t,e,1,-1)}function Rr(e){var t=fr();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yr,lastRenderedState:e},t.queue=e,e=e.dispatch=Or.bind(null,sr,e),[t.memoizedState,e]}function Wr(e,t,n,a){return e={tag:e,create:t,destroy:n,deps:a,next:null},null===(t=sr.updateQueue)?(t={lastEffect:null,stores:null},sr.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(a=n.next,n.next=e,e.next=a,t.lastEffect=e),e}function Vr(){return br().memoizedState}function Nr(e,t,n,a){var o=fr();sr.flags|=e,o.memoizedState=Wr(1|t,n,void 0,void 0===a?null:a)}function Xr(e,t,n,a){var o=br();a=void 0===a?null:a;var i=void 0;if(null!==lr){var r=lr.memoizedState;if(i=r.destroy,null!==a&&mr(a,r.deps))return void(o.memoizedState=Wr(t,n,i,a))}sr.flags|=e,o.memoizedState=Wr(1|t,n,i,a)}function Mr(e,t){return Nr(8390656,8,e,t)}function Tr(e,t){return Xr(2048,8,e,t)}function Er(e,t){return Xr(4,2,e,t)}function Fr(e,t){return Xr(4,4,e,t)}function Hr(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Jr(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Xr(4,4,Hr.bind(null,t,e),n)}function Yr(){}function Lr(e,t){var n=br();t=void 0===t?null:t;var a=n.memoizedState;return null!==a&&null!==t&&mr(t,a[1])?a[0]:(n.memoizedState=[e,t],e)}function zr(e,t){var n=br();t=void 0===t?null:t;var a=n.memoizedState;return null!==a&&null!==t&&mr(t,a[1])?a[0]:(e=e(),n.memoizedState=[e,t],e)}function Kr(e,t,n){return 0===(21&rr)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(sa(n,t)||(n=mt(),sr.lanes|=n,Tl|=n,e.baseState=!0),t)}function Dr(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var a=ir.transition;ir.transition={};try{e(!1),t()}finally{bt=n,ir.transition=a}}function Ur(){return br().memoizedState}function Pr(e,t,n){var a=tc(e);if(n={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null},_r(e))Qr(t,n);else if(null!==(n=Xi(e,t,n,a))){nc(n,e,a,ec()),jr(n,t,a)}}function Or(e,t,n){var a=tc(e),o={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null};if(_r(e))Qr(t,o);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var r=t.lastRenderedState,s=i(r,n);if(o.hasEagerState=!0,o.eagerState=s,sa(s,r)){var l=t.interleaved;return null===l?(o.next=o,Ni(t)):(o.next=l.next,l.next=o),void(t.interleaved=o)}}catch(c){}null!==(n=Xi(e,t,o,a))&&(nc(n,e,a,o=ec()),jr(n,t,a))}}function _r(e){var t=e.alternate;return e===sr||null!==t&&t===sr}function Qr(e,t){ur=gr=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function jr(e,t,n){if(0!==(4194240&n)){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,ft(e,n)}}var qr={readContext:Wi,useCallback:pr,useContext:pr,useEffect:pr,useImperativeHandle:pr,useInsertionEffect:pr,useLayoutEffect:pr,useMemo:pr,useReducer:pr,useRef:pr,useState:pr,useDebugValue:pr,useDeferredValue:pr,useTransition:pr,useMutableSource:pr,useSyncExternalStore:pr,useId:pr,unstable_isNewReconciler:!1},$r={readContext:Wi,useCallback:function(e,t){return fr().memoizedState=[e,void 0===t?null:t],e},useContext:Wi,useEffect:Mr,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Nr(4194308,4,Hr.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Nr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Nr(4,2,e,t)},useMemo:function(e,t){var n=fr();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var a=fr();return t=void 0!==n?n(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=Pr.bind(null,sr,e),[a.memoizedState,e]},useRef:function(e){return e={current:e},fr().memoizedState=e},useState:Rr,useDebugValue:Yr,useDeferredValue:function(e){return fr().memoizedState=e},useTransition:function(){var e=Rr(!1),t=e[0];return e=Dr.bind(null,e[1]),fr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var a=sr,o=fr();if(ii){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Bl)throw Error(i(349));0!==(30&rr)||Gr(a,t,n)}o.memoizedState=n;var r={value:n,getSnapshot:t};return o.queue=r,Mr(wr.bind(null,a,r,e),[e]),a.flags|=2048,Wr(9,Zr.bind(null,a,r,n,t),void 0,null),n},useId:function(){var e=fr(),t=Bl.identifierPrefix;if(ii){var n=qo;t=":"+t+"R"+(n=(jo&~(1<<32-rt(jo)-1)).toString(32)+n),0<(n=dr++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=hr++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Wi,useCallback:Lr,useContext:Wi,useEffect:Tr,useImperativeHandle:Jr,useInsertionEffect:Er,useLayoutEffect:Fr,useMemo:zr,useReducer:Ar,useRef:Vr,useState:function(){return Ar(yr)},useDebugValue:Yr,useDeferredValue:function(e){return Kr(br(),lr.memoizedState,e)},useTransition:function(){return[Ar(yr)[0],br().memoizedState]},useMutableSource:Sr,useSyncExternalStore:xr,useId:Ur,unstable_isNewReconciler:!1},ts={readContext:Wi,useCallback:Lr,useContext:Wi,useEffect:Tr,useImperativeHandle:Jr,useInsertionEffect:Er,useLayoutEffect:Fr,useMemo:zr,useReducer:vr,useRef:Vr,useState:function(){return vr(yr)},useDebugValue:Yr,useDeferredValue:function(e){var t=br();return null===lr?t.memoizedState=e:Kr(t,lr.memoizedState,e)},useTransition:function(){return[vr(yr)[0],br().memoizedState]},useMutableSource:Sr,useSyncExternalStore:xr,useId:Ur,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=E({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function as(e,t,n,a){n=null===(n=n(a,t=e.memoizedState))||void 0===n?t:E({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&Le(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var a=ec(),o=tc(e),i=Hi(a,o);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Ji(e,i,o))&&(nc(t,e,o,a),Yi(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var a=ec(),o=tc(e),i=Hi(a,o);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Ji(e,i,o))&&(nc(t,e,o,a),Yi(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),a=tc(e),o=Hi(n,a);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=Ji(e,o,a))&&(nc(t,e,a,n),Yi(t,e,a))}};function is(e,t,n,a,o,i,r){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(a,i,r):!t.prototype||!t.prototype.isPureReactComponent||(!la(n,a)||!la(o,i))}function rs(e,t,n){var a=!1,o=ko,i=t.contextType;return"object"===typeof i&&null!==i?i=Wi(i):(o=No(t)?Wo:Bo.current,i=(a=null!==(a=t.contextTypes)&&void 0!==a)?Vo(e,o):ko),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,a&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function ss(e,t,n,a){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,a),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,a),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function ls(e,t,n,a){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Ei(e);var i=t.contextType;"object"===typeof i&&null!==i?o.context=Wi(i):(i=No(t)?Wo:Bo.current,o.context=Vo(e,i)),o.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(as(e,t,i,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&os.enqueueReplaceState(o,o.state,null),zi(e,n,o,a),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4194308)}function cs(e,t){try{var n="",a=t;do{n+=Y(a),a=a.return}while(a);var o=n}catch(i){o="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:o,digest:null}}function gs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function us(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=Hi(-1,n)).tag=3,n.payload={element:null};var a=t.value;return n.callback=function(){Kl||(Kl=!0,Dl=a),us(0,t)},n}function ps(e,t,n){(n=Hi(-1,n)).tag=3;var a=e.type.getDerivedStateFromError;if("function"===typeof a){var o=t.value;n.payload=function(){return a(o)},n.callback=function(){us(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){us(0,t),"function"!==typeof a&&(null===Ul?Ul=new Set([this]):Ul.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var a=e.pingCache;if(null===a){a=e.pingCache=new ds;var o=new Set;a.set(t,o)}else void 0===(o=a.get(t))&&(o=new Set,a.set(t,o));o.has(n)||(o.add(n),e=Gc.bind(null,e,t,n),t.then(e,e))}function Is(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Cs(e,t,n,a,o){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Hi(-1,1)).tag=2,Ji(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var fs=y.ReactCurrentOwner,bs=!1;function ys(e,t,n,a){t.child=null===e?vi(t,null,n,a):Ai(t,e.child,n,a)}function As(e,t,n,a,o){n=n.render;var i=t.ref;return Ri(t,o),a=Ir(e,t,n,a,i,o),n=Cr(),null===e||bs?(ii&&n&&ti(t),t.flags|=1,ys(e,t,a,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ks(e,t,o))}function vs(e,t,n,a,o){if(null===e){var i=n.type;return"function"!==typeof i||Vc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Xc(n.type,null,a,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ss(e,t,i,a,o))}if(i=e.child,0===(e.lanes&o)){var r=i.memoizedProps;if((n=null!==(n=n.compare)?n:la)(r,a)&&e.ref===t.ref)return Ks(e,t,o)}return t.flags|=1,(e=Nc(i,a)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,a,o){if(null!==e){var i=e.memoizedProps;if(la(i,a)&&e.ref===t.ref){if(bs=!1,t.pendingProps=a=i,0===(e.lanes&o))return t.lanes=e.lanes,Ks(e,t,o);0!==(131072&e.flags)&&(bs=!0)}}return Zs(e,t,n,a,o)}function xs(e,t,n){var a=t.pendingProps,o=a.children,i=null!==e?e.memoizedState:null;if("hidden"===a.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wo(Nl,Vl),Vl|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wo(Nl,Vl),Vl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=null!==i?i.baseLanes:n,wo(Nl,Vl),Vl|=a}else null!==i?(a=i.baseLanes|n,t.memoizedState=null):a=n,wo(Nl,Vl),Vl|=a;return ys(e,t,o,n),t.child}function Gs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Zs(e,t,n,a,o){var i=No(n)?Wo:Bo.current;return i=Vo(t,i),Ri(t,o),n=Ir(e,t,n,a,i,o),a=Cr(),null===e||bs?(ii&&a&&ti(t),t.flags|=1,ys(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ks(e,t,o))}function ws(e,t,n,a,o){if(No(n)){var i=!0;Eo(t)}else i=!1;if(Ri(t,o),null===t.stateNode)zs(e,t),rs(t,n,a),ls(t,n,a,o),a=!0;else if(null===e){var r=t.stateNode,s=t.memoizedProps;r.props=s;var l=r.context,c=n.contextType;"object"===typeof c&&null!==c?c=Wi(c):c=Vo(t,c=No(n)?Wo:Bo.current);var g=n.getDerivedStateFromProps,u="function"===typeof g||"function"===typeof r.getSnapshotBeforeUpdate;u||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(s!==a||l!==c)&&ss(t,r,a,c),Ti=!1;var d=t.memoizedState;r.state=d,zi(t,a,r,o),l=t.memoizedState,s!==a||d!==l||Ro.current||Ti?("function"===typeof g&&(as(t,n,g,a),l=t.memoizedState),(s=Ti||is(t,n,s,a,d,l,c))?(u||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||("function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"===typeof r.componentDidMount&&(t.flags|=4194308)):("function"===typeof r.componentDidMount&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=l),r.props=a,r.state=l,r.context=c,a=s):("function"===typeof r.componentDidMount&&(t.flags|=4194308),a=!1)}else{r=t.stateNode,Fi(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:ns(t.type,s),r.props=c,u=t.pendingProps,d=r.context,"object"===typeof(l=n.contextType)&&null!==l?l=Wi(l):l=Vo(t,l=No(n)?Wo:Bo.current);var h=n.getDerivedStateFromProps;(g="function"===typeof h||"function"===typeof r.getSnapshotBeforeUpdate)||"function"!==typeof r.UNSAFE_componentWillReceiveProps&&"function"!==typeof r.componentWillReceiveProps||(s!==u||d!==l)&&ss(t,r,a,l),Ti=!1,d=t.memoizedState,r.state=d,zi(t,a,r,o);var p=t.memoizedState;s!==u||d!==p||Ro.current||Ti?("function"===typeof h&&(as(t,n,h,a),p=t.memoizedState),(c=Ti||is(t,n,c,a,d,p,l)||!1)?(g||"function"!==typeof r.UNSAFE_componentWillUpdate&&"function"!==typeof r.componentWillUpdate||("function"===typeof r.componentWillUpdate&&r.componentWillUpdate(a,p,l),"function"===typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(a,p,l)),"function"===typeof r.componentDidUpdate&&(t.flags|=4),"function"===typeof r.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof r.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=p),r.props=a,r.state=p,r.context=l,a=c):("function"!==typeof r.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof r.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),a=!1)}return ks(e,t,n,a,i,o)}function ks(e,t,n,a,o,i){Gs(e,t);var r=0!==(128&t.flags);if(!a&&!r)return o&&Fo(t,n,!1),Ks(e,t,i);a=t.stateNode,fs.current=t;var s=r&&"function"!==typeof n.getDerivedStateFromError?null:a.render();return t.flags|=1,null!==e&&r?(t.child=Ai(t,e.child,null,i),t.child=Ai(t,null,s,i)):ys(e,t,s,i),t.memoizedState=a.state,o&&Fo(t,n,!0),t.child}function Bs(e){var t=e.stateNode;t.pendingContext?Mo(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Mo(0,t.context,!1),Qi(e,t.containerInfo)}function Rs(e,t,n,a,o){return pi(),mi(o),t.flags|=256,ys(e,t,n,a),t.child}var Ws,Vs,Ns,Xs,Ms={dehydrated:null,treeContext:null,retryLane:0};function Ts(e){return{baseLanes:e,cachePool:null,transitions:null}}function Es(e,t,n){var a,o=t.pendingProps,r=er.current,s=!1,l=0!==(128&t.flags);if((a=l)||(a=(null===e||null!==e.memoizedState)&&0!==(2&r)),a?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(r|=1),wo(er,1&r),null===e)return gi(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=o.children,e=o.fallback,s?(o=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&o)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Tc(l,o,0,null),e=Mc(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ts(n),t.memoizedState=Ms,e):Fs(t,l));if(null!==(r=e.memoizedState)&&null!==(a=r.dehydrated))return function(e,t,n,a,o,r,s){if(n)return 256&t.flags?(t.flags&=-257,Hs(e,t,s,a=gs(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(r=a.fallback,o=t.mode,a=Tc({mode:"visible",children:a.children},o,0,null),(r=Mc(r,o,s,null)).flags|=2,a.return=t,r.return=t,a.sibling=r,t.child=a,0!==(1&t.mode)&&Ai(t,e.child,null,s),t.child.memoizedState=Ts(s),t.memoizedState=Ms,r);if(0===(1&t.mode))return Hs(e,t,s,null);if("$!"===o.data){if(a=o.nextSibling&&o.nextSibling.dataset)var l=a.dgst;return a=l,Hs(e,t,s,a=gs(r=Error(i(419)),a,void 0))}if(l=0!==(s&e.childLanes),bs||l){if(null!==(a=Bl)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(a.suspendedLanes|s))?0:o)&&o!==r.retryLane&&(r.retryLane=o,Mi(e,o),nc(a,e,o,-1))}return mc(),Hs(e,t,s,a=gs(Error(i(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=wc.bind(null,e),o._reactRetry=t,null):(e=r.treeContext,oi=co(o.nextSibling),ai=t,ii=!0,ri=null,null!==e&&(Oo[_o++]=jo,Oo[_o++]=qo,Oo[_o++]=Qo,jo=e.id,qo=e.overflow,Qo=t),t=Fs(t,a.children),t.flags|=4096,t)}(e,t,l,o,a,r,n);if(s){s=o.fallback,l=t.mode,a=(r=e.child).sibling;var c={mode:"hidden",children:o.children};return 0===(1&l)&&t.child!==r?((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null):(o=Nc(r,c)).subtreeFlags=14680064&r.subtreeFlags,null!==a?s=Nc(a,s):(s=Mc(s,l,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,l=null===(l=e.child.memoizedState)?Ts(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Ms,o}return e=(s=e.child).sibling,o=Nc(s,{mode:"visible",children:o.children}),0===(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Fs(e,t){return(t=Tc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Hs(e,t,n,a){return null!==a&&mi(a),Ai(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Js(e,t,n){e.lanes|=t;var a=e.alternate;null!==a&&(a.lanes|=t),Bi(e.return,t,n)}function Ys(e,t,n,a,o){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=a,i.tail=n,i.tailMode=o)}function Ls(e,t,n){var a=t.pendingProps,o=a.revealOrder,i=a.tail;if(ys(e,t,a.children,n),0!==(2&(a=er.current)))a=1&a|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Js(e,n,t);else if(19===e.tag)Js(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(wo(er,a),0===(1&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===tr(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Ys(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===tr(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Ys(t,!0,n,null,i);break;case"together":Ys(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ks(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Tl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Nc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Nc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ds(e,t){if(!ii)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var a=null;null!==n;)null!==n.alternate&&(a=n),n=n.sibling;null===a?t||null===e.tail?e.tail=null:e.tail.sibling=null:a.sibling=null}}function Us(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,a=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,a|=14680064&o.subtreeFlags,a|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,a|=o.subtreeFlags,a|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=a,e.childLanes=n,t}function Ps(e,t,n){var a=t.pendingProps;switch(ni(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Us(t),null;case 1:case 17:return No(t.type)&&Xo(),Us(t),null;case 3:return a=t.stateNode,ji(),Zo(Ro),Zo(Bo),ar(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),null!==e&&null!==e.child||(di(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ri&&(rc(ri),ri=null))),Vs(e,t),Us(t),null;case 5:$i(t);var o=_i(Oi.current);if(n=t.type,null!==e&&null!=t.stateNode)Ns(e,t,n,a,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(null===t.stateNode)throw Error(i(166));return Us(t),null}if(e=_i(Ui.current),di(t)){a=t.stateNode,n=t.type;var r=t.memoizedProps;switch(a[ho]=t,a[po]=r,e=0!==(1&t.mode),n){case"dialog":Ha("cancel",a),Ha("close",a);break;case"iframe":case"object":case"embed":Ha("load",a);break;case"video":case"audio":for(o=0;o<Ma.length;o++)Ha(Ma[o],a);break;case"source":Ha("error",a);break;case"img":case"image":case"link":Ha("error",a),Ha("load",a);break;case"details":Ha("toggle",a);break;case"input":Q(a,r),Ha("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!r.multiple},Ha("invalid",a);break;case"textarea":oe(a,r),Ha("invalid",a)}for(var l in fe(n,r),o=null,r)if(r.hasOwnProperty(l)){var c=r[l];"children"===l?"string"===typeof c?a.textContent!==c&&(!0!==r.suppressHydrationWarning&&qa(a.textContent,c,e),o=["children",c]):"number"===typeof c&&a.textContent!==""+c&&(!0!==r.suppressHydrationWarning&&qa(a.textContent,c,e),o=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Ha("scroll",a)}switch(n){case"input":U(a),$(a,r,!0);break;case"textarea":U(a),re(a);break;case"select":case"option":break;default:"function"===typeof r.onClick&&(a.onclick=$a)}a=o,t.updateQueue=a,null!==a&&(t.flags|=4)}else{l=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof a.is?e=l.createElement(n,{is:a.is}):(e=l.createElement(n),"select"===n&&(l=e,a.multiple?l.multiple=!0:a.size&&(l.size=a.size))):e=l.createElementNS(e,n),e[ho]=t,e[po]=a,Ws(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,a),n){case"dialog":Ha("cancel",e),Ha("close",e),o=a;break;case"iframe":case"object":case"embed":Ha("load",e),o=a;break;case"video":case"audio":for(o=0;o<Ma.length;o++)Ha(Ma[o],e);o=a;break;case"source":Ha("error",e),o=a;break;case"img":case"image":case"link":Ha("error",e),Ha("load",e),o=a;break;case"details":Ha("toggle",e),o=a;break;case"input":Q(e,a),o=_(e,a),Ha("invalid",e);break;case"option":default:o=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},o=E({},a,{value:void 0}),Ha("invalid",e);break;case"textarea":oe(e,a),o=ae(e,a),Ha("invalid",e)}for(r in fe(n,o),c=o)if(c.hasOwnProperty(r)){var g=c[r];"style"===r?Ie(e,g):"dangerouslySetInnerHTML"===r?null!=(g=g?g.__html:void 0)&&ue(e,g):"children"===r?"string"===typeof g?("textarea"!==n||""!==g)&&de(e,g):"number"===typeof g&&de(e,""+g):"suppressContentEditableWarning"!==r&&"suppressHydrationWarning"!==r&&"autoFocus"!==r&&(s.hasOwnProperty(r)?null!=g&&"onScroll"===r&&Ha("scroll",e):null!=g&&b(e,r,g,l))}switch(n){case"input":U(e),$(e,a,!1);break;case"textarea":U(e),re(e);break;case"option":null!=a.value&&e.setAttribute("value",""+K(a.value));break;case"select":e.multiple=!!a.multiple,null!=(r=a.value)?ne(e,!!a.multiple,r,!1):null!=a.defaultValue&&ne(e,!!a.multiple,a.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=$a)}switch(n){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Us(t),null;case 6:if(e&&null!=t.stateNode)Xs(e,t,e.memoizedProps,a);else{if("string"!==typeof a&&null===t.stateNode)throw Error(i(166));if(n=_i(Oi.current),_i(Ui.current),di(t)){if(a=t.stateNode,n=t.memoizedProps,a[ho]=t,(r=a.nodeValue!==n)&&null!==(e=ai))switch(e.tag){case 3:qa(a.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&qa(a.nodeValue,n,0!==(1&e.mode))}r&&(t.flags|=4)}else(a=(9===n.nodeType?n:n.ownerDocument).createTextNode(a))[ho]=t,t.stateNode=a}return Us(t),null;case 13:if(Zo(er),a=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ii&&null!==oi&&0!==(1&t.mode)&&0===(128&t.flags))hi(),pi(),t.flags|=98560,r=!1;else if(r=di(t),null!==a&&null!==a.dehydrated){if(null===e){if(!r)throw Error(i(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(i(317));r[ho]=t}else pi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Us(t),r=!1}else null!==ri&&(rc(ri),ri=null),r=!0;if(!r)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((a=null!==a)!==(null!==e&&null!==e.memoizedState)&&a&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&er.current)?0===Xl&&(Xl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Us(t),null);case 4:return ji(),Vs(e,t),null===e&&La(t.stateNode.containerInfo),Us(t),null;case 10:return ki(t.type._context),Us(t),null;case 19:if(Zo(er),null===(r=t.memoizedState))return Us(t),null;if(a=0!==(128&t.flags),null===(l=r.rendering))if(a)Ds(r,!1);else{if(0!==Xl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=tr(e))){for(t.flags|=128,Ds(r,!1),null!==(a=l.updateQueue)&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=n,n=t.child;null!==n;)e=a,(r=n).flags&=14680066,null===(l=r.alternate)?(r.childLanes=0,r.lanes=e,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=l.childLanes,r.lanes=l.lanes,r.child=l.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=l.memoizedProps,r.memoizedState=l.memoizedState,r.updateQueue=l.updateQueue,r.type=l.type,e=l.dependencies,r.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return wo(er,1&er.current|2),t.child}e=e.sibling}null!==r.tail&&je()>Ll&&(t.flags|=128,a=!0,Ds(r,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=tr(l))){if(t.flags|=128,a=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ds(r,!0),null===r.tail&&"hidden"===r.tailMode&&!l.alternate&&!ii)return Us(t),null}else 2*je()-r.renderingStartTime>Ll&&1073741824!==n&&(t.flags|=128,a=!0,Ds(r,!1),t.lanes=4194304);r.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=r.last)?n.sibling=l:t.child=l,r.last=l)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=je(),t.sibling=null,n=er.current,wo(er,a?1&n|2:1&n),t):(Us(t),null);case 22:case 23:return uc(),a=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==a&&(t.flags|=8192),a&&0!==(1&t.mode)?0!==(1073741824&Vl)&&(Us(t),6&t.subtreeFlags&&(t.flags|=8192)):Us(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Os(e,t){switch(ni(t),t.tag){case 1:return No(t.type)&&Xo(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ji(),Zo(Ro),Zo(Bo),ar(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return $i(t),null;case 13:if(Zo(er),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));pi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Zo(er),null;case 4:return ji(),null;case 10:return ki(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Ws=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Vs=function(){},Ns=function(e,t,n,a){var o=e.memoizedProps;if(o!==a){e=t.stateNode,_i(Ui.current);var i,r=null;switch(n){case"input":o=_(e,o),a=_(e,a),r=[];break;case"select":o=E({},o,{value:void 0}),a=E({},a,{value:void 0}),r=[];break;case"textarea":o=ae(e,o),a=ae(e,a),r=[];break;default:"function"!==typeof o.onClick&&"function"===typeof a.onClick&&(e.onclick=$a)}for(g in fe(n,a),n=null,o)if(!a.hasOwnProperty(g)&&o.hasOwnProperty(g)&&null!=o[g])if("style"===g){var l=o[g];for(i in l)l.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==g&&"children"!==g&&"suppressContentEditableWarning"!==g&&"suppressHydrationWarning"!==g&&"autoFocus"!==g&&(s.hasOwnProperty(g)?r||(r=[]):(r=r||[]).push(g,null));for(g in a){var c=a[g];if(l=null!=o?o[g]:void 0,a.hasOwnProperty(g)&&c!==l&&(null!=c||null!=l))if("style"===g)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(r||(r=[]),r.push(g,n)),n=c;else"dangerouslySetInnerHTML"===g?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(r=r||[]).push(g,c)):"children"===g?"string"!==typeof c&&"number"!==typeof c||(r=r||[]).push(g,""+c):"suppressContentEditableWarning"!==g&&"suppressHydrationWarning"!==g&&(s.hasOwnProperty(g)?(null!=c&&"onScroll"===g&&Ha("scroll",e),r||l===c||(r=[])):(r=r||[]).push(g,c))}n&&(r=r||[]).push("style",n);var g=r;(t.updateQueue=g)&&(t.flags|=4)}},Xs=function(e,t,n,a){n!==a&&(t.flags|=4)};var _s=!1,Qs=!1,js="function"===typeof WeakSet?WeakSet:Set,qs=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(a){xc(e,t,a)}else n.current=null}function el(e,t,n){try{n()}catch(a){xc(e,t,a)}}var tl=!1;function nl(e,t,n){var a=t.updateQueue;if(null!==(a=null!==a?a.lastEffect:null)){var o=a=a.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,void 0!==i&&el(t,n,i)}o=o.next}while(o!==a)}}function al(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var a=n.create;n.destroy=a()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ho],delete t[po],delete t[Io],delete t[Co],delete t[fo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function rl(e){return 5===e.tag||3===e.tag||4===e.tag}function sl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||rl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$a));else if(4!==a&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==a&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var gl=null,ul=!1;function dl(e,t,n){for(n=n.child;null!==n;)hl(e,t,n),n=n.sibling}function hl(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(ot,n)}catch(s){}switch(n.tag){case 5:Qs||$s(n,t);case 6:var a=gl,o=ul;gl=null,dl(e,t,n),ul=o,null!==(gl=a)&&(ul?(e=gl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):gl.removeChild(n.stateNode));break;case 18:null!==gl&&(ul?(e=gl,n=n.stateNode,8===e.nodeType?lo(e.parentNode,n):1===e.nodeType&&lo(e,n),Lt(e)):lo(gl,n.stateNode));break;case 4:a=gl,o=ul,gl=n.stateNode.containerInfo,ul=!0,dl(e,t,n),gl=a,ul=o;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(a=n.updateQueue)&&null!==(a=a.lastEffect))){o=a=a.next;do{var i=o,r=i.destroy;i=i.tag,void 0!==r&&(0!==(2&i)||0!==(4&i))&&el(n,t,r),o=o.next}while(o!==a)}dl(e,t,n);break;case 1:if(!Qs&&($s(n,t),"function"===typeof(a=n.stateNode).componentWillUnmount))try{a.props=n.memoizedProps,a.state=n.memoizedState,a.componentWillUnmount()}catch(s){xc(n,t,s)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Qs=(a=Qs)||null!==n.memoizedState,dl(e,t,n),Qs=a):dl(e,t,n);break;default:dl(e,t,n)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new js),t.forEach((function(t){var a=kc.bind(null,e,t);n.has(t)||(n.add(t),t.then(a,a))}))}}function ml(e,t){var n=t.deletions;if(null!==n)for(var a=0;a<n.length;a++){var o=n[a];try{var r=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:gl=l.stateNode,ul=!1;break e;case 3:case 4:gl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===gl)throw Error(i(160));hl(r,s,o),gl=null,ul=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(g){xc(o,t,g)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)Il(t,e),t=t.sibling}function Il(e,t){var n=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),Cl(e),4&a){try{nl(3,e,e.return),al(3,e)}catch(I){xc(e,e.return,I)}try{nl(5,e,e.return)}catch(I){xc(e,e.return,I)}}break;case 1:ml(t,e),Cl(e),512&a&&null!==n&&$s(n,n.return);break;case 5:if(ml(t,e),Cl(e),512&a&&null!==n&&$s(n,n.return),32&e.flags){var o=e.stateNode;try{de(o,"")}catch(I){xc(e,e.return,I)}}if(4&a&&null!=(o=e.stateNode)){var r=e.memoizedProps,s=null!==n?n.memoizedProps:r,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===r.type&&null!=r.name&&j(o,r),be(l,s);var g=be(l,r);for(s=0;s<c.length;s+=2){var u=c[s],d=c[s+1];"style"===u?Ie(o,d):"dangerouslySetInnerHTML"===u?ue(o,d):"children"===u?de(o,d):b(o,u,d,g)}switch(l){case"input":q(o,r);break;case"textarea":ie(o,r);break;case"select":var h=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!r.multiple;var p=r.value;null!=p?ne(o,!!r.multiple,p,!1):h!==!!r.multiple&&(null!=r.defaultValue?ne(o,!!r.multiple,r.defaultValue,!0):ne(o,!!r.multiple,r.multiple?[]:"",!1))}o[po]=r}catch(I){xc(e,e.return,I)}}break;case 6:if(ml(t,e),Cl(e),4&a){if(null===e.stateNode)throw Error(i(162));o=e.stateNode,r=e.memoizedProps;try{o.nodeValue=r}catch(I){xc(e,e.return,I)}}break;case 3:if(ml(t,e),Cl(e),4&a&&null!==n&&n.memoizedState.isDehydrated)try{Lt(t.containerInfo)}catch(I){xc(e,e.return,I)}break;case 4:default:ml(t,e),Cl(e);break;case 13:ml(t,e),Cl(e),8192&(o=e.child).flags&&(r=null!==o.memoizedState,o.stateNode.isHidden=r,!r||null!==o.alternate&&null!==o.alternate.memoizedState||(Yl=je())),4&a&&pl(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(g=Qs)||u,ml(t,e),Qs=g):ml(t,e),Cl(e),8192&a){if(g=null!==e.memoizedState,(e.stateNode.isHidden=g)&&!u&&0!==(1&e.mode))for(qs=e,u=e.child;null!==u;){for(d=qs=u;null!==qs;){switch(p=(h=qs).child,h.tag){case 0:case 11:case 14:case 15:nl(4,h,h.return);break;case 1:$s(h,h.return);var m=h.stateNode;if("function"===typeof m.componentWillUnmount){a=h,n=h.return;try{t=a,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(I){xc(a,n,I)}}break;case 5:$s(h,h.return);break;case 22:if(null!==h.memoizedState){Al(d);continue}}null!==p?(p.return=h,qs=p):Al(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{o=d.stateNode,g?"function"===typeof(r=o.style).setProperty?r.setProperty("display","none","important"):r.display="none":(l=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",s))}catch(I){xc(e,e.return,I)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=g?"":d.memoizedProps}catch(I){xc(e,e.return,I)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(t,e),Cl(e),4&a&&pl(e);case 21:}}function Cl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(rl(n)){var a=n;break e}n=n.return}throw Error(i(160))}switch(a.tag){case 5:var o=a.stateNode;32&a.flags&&(de(o,""),a.flags&=-33),cl(e,sl(e),o);break;case 3:case 4:var r=a.stateNode.containerInfo;ll(e,sl(e),r);break;default:throw Error(i(161))}}catch(s){xc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function fl(e,t,n){qs=e,bl(e,t,n)}function bl(e,t,n){for(var a=0!==(1&e.mode);null!==qs;){var o=qs,i=o.child;if(22===o.tag&&a){var r=null!==o.memoizedState||_s;if(!r){var s=o.alternate,l=null!==s&&null!==s.memoizedState||Qs;s=_s;var c=Qs;if(_s=r,(Qs=l)&&!c)for(qs=o;null!==qs;)l=(r=qs).child,22===r.tag&&null!==r.memoizedState?vl(o):null!==l?(l.return=r,qs=l):vl(o);for(;null!==i;)qs=i,bl(i,t,n),i=i.sibling;qs=o,_s=s,Qs=c}yl(e)}else 0!==(8772&o.subtreeFlags)&&null!==i?(i.return=o,qs=i):yl(e)}}function yl(e){for(;null!==qs;){var t=qs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||al(5,t);break;case 1:var a=t.stateNode;if(4&t.flags&&!Qs)if(null===n)a.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);a.componentDidUpdate(o,n.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var r=t.updateQueue;null!==r&&Ki(t,r,a);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ki(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var g=t.alternate;if(null!==g){var u=g.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&Lt(d)}}}break;default:throw Error(i(163))}Qs||512&t.flags&&ol(t)}catch(h){xc(t,t.return,h)}}if(t===e){qs=null;break}if(null!==(n=t.sibling)){n.return=t.return,qs=n;break}qs=t.return}}function Al(e){for(;null!==qs;){var t=qs;if(t===e){qs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,qs=n;break}qs=t.return}}function vl(e){for(;null!==qs;){var t=qs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{al(4,t)}catch(l){xc(t,n,l)}break;case 1:var a=t.stateNode;if("function"===typeof a.componentDidMount){var o=t.return;try{a.componentDidMount()}catch(l){xc(t,o,l)}}var i=t.return;try{ol(t)}catch(l){xc(t,i,l)}break;case 5:var r=t.return;try{ol(t)}catch(l){xc(t,r,l)}}}catch(l){xc(t,t.return,l)}if(t===e){qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,qs=s;break}qs=t.return}}var Sl,xl=Math.ceil,Gl=y.ReactCurrentDispatcher,Zl=y.ReactCurrentOwner,wl=y.ReactCurrentBatchConfig,kl=0,Bl=null,Rl=null,Wl=0,Vl=0,Nl=Go(0),Xl=0,Ml=null,Tl=0,El=0,Fl=0,Hl=null,Jl=null,Yl=0,Ll=1/0,zl=null,Kl=!1,Dl=null,Ul=null,Pl=!1,Ol=null,_l=0,Ql=0,jl=null,ql=-1,$l=0;function ec(){return 0!==(6&kl)?je():-1!==ql?ql:ql=je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&kl)&&0!==Wl?Wl&-Wl:null!==Ii.transition?(0===$l&&($l=mt()),$l):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nc(e,t,n,a){if(50<Ql)throw Ql=0,jl=null,Error(i(185));Ct(e,n,a),0!==(2&kl)&&e===Bl||(e===Bl&&(0===(2&kl)&&(El|=n),4===Xl&&sc(e,Wl)),ac(e,a),1===n&&0===kl&&0===(1&t.mode)&&(Ll=je()+500,Jo&&zo()))}function ac(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,a=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var r=31-rt(i),s=1<<r,l=o[r];-1===l?0!==(s&n)&&0===(s&a)||(o[r]=ht(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var a=dt(e,e===Bl?Wl:0);if(0===a)null!==n&&Oe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(null!=n&&Oe(n),1===t)0===e.tag?function(e){Jo=!0,Lo(e)}(lc.bind(null,e)):Lo(lc.bind(null,e)),ro((function(){0===(6&kl)&&zo()})),n=null;else{switch(yt(a)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=at}n=Bc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(ql=-1,$l=0,0!==(6&kl))throw Error(i(327));var n=e.callbackNode;if(vc()&&e.callbackNode!==n)return null;var a=dt(e,e===Bl?Wl:0);if(0===a)return null;if(0!==(30&a)||0!==(a&e.expiredLanes)||t)t=Ic(e,a);else{t=a;var o=kl;kl|=2;var r=pc();for(Bl===e&&Wl===t||(zl=null,Ll=je()+500,dc(e,t));;)try{fc();break}catch(l){hc(e,l)}wi(),Gl.current=r,kl=o,null!==Rl?t=0:(Bl=null,Wl=0,t=Xl)}if(0!==t){if(2===t&&(0!==(o=pt(e))&&(a=o,t=ic(e,o))),1===t)throw n=Ml,dc(e,0),sc(e,a),ac(e,je()),n;if(6===t)sc(e,a);else{if(o=e.current.alternate,0===(30&a)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var a=0;a<n.length;a++){var o=n[a],i=o.getSnapshot;o=o.value;try{if(!sa(i(),o))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)&&(2===(t=Ic(e,a))&&(0!==(r=pt(e))&&(a=r,t=ic(e,r))),1===t))throw n=Ml,dc(e,0),sc(e,a),ac(e,je()),n;switch(e.finishedWork=o,e.finishedLanes=a,t){case 0:case 1:throw Error(i(345));case 2:case 5:Ac(e,Jl,zl);break;case 3:if(sc(e,a),(130023424&a)===a&&10<(t=Yl+500-je())){if(0!==dt(e,0))break;if(((o=e.suspendedLanes)&a)!==a){ec(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ao(Ac.bind(null,e,Jl,zl),t);break}Ac(e,Jl,zl);break;case 4:if(sc(e,a),(4194240&a)===a)break;for(t=e.eventTimes,o=-1;0<a;){var s=31-rt(a);r=1<<s,(s=t[s])>o&&(o=s),a&=~r}if(a=o,10<(a=(120>(a=je()-a)?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*xl(a/1960))-a)){e.timeoutHandle=ao(Ac.bind(null,e,Jl,zl),a);break}Ac(e,Jl,zl);break;default:throw Error(i(329))}}}return ac(e,je()),e.callbackNode===n?oc.bind(null,e):null}function ic(e,t){var n=Hl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=Ic(e,t))&&(t=Jl,Jl=n,null!==t&&rc(t)),e}function rc(e){null===Jl?Jl=e:Jl.push.apply(Jl,e)}function sc(e,t){for(t&=~Fl,t&=~El,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-rt(t),a=1<<n;e[n]=-1,t&=~a}}function lc(e){if(0!==(6&kl))throw Error(i(327));vc();var t=dt(e,0);if(0===(1&t))return ac(e,je()),null;var n=Ic(e,t);if(0!==e.tag&&2===n){var a=pt(e);0!==a&&(t=a,n=ic(e,a))}if(1===n)throw n=Ml,dc(e,0),sc(e,t),ac(e,je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ac(e,Jl,zl),ac(e,je()),null}function cc(e,t){var n=kl;kl|=1;try{return e(t)}finally{0===(kl=n)&&(Ll=je()+500,Jo&&zo())}}function gc(e){null!==Ol&&0===Ol.tag&&0===(6&kl)&&vc();var t=kl;kl|=1;var n=wl.transition,a=bt;try{if(wl.transition=null,bt=1,e)return e()}finally{bt=a,wl.transition=n,0===(6&(kl=t))&&zo()}}function uc(){Vl=Nl.current,Zo(Nl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==Rl)for(n=Rl.return;null!==n;){var a=n;switch(ni(a),a.tag){case 1:null!==(a=a.type.childContextTypes)&&void 0!==a&&Xo();break;case 3:ji(),Zo(Ro),Zo(Bo),ar();break;case 5:$i(a);break;case 4:ji();break;case 13:case 19:Zo(er);break;case 10:ki(a.type._context);break;case 22:case 23:uc()}n=n.return}if(Bl=e,Rl=e=Nc(e.current,null),Wl=Vl=t,Xl=0,Ml=null,Fl=El=Tl=0,Jl=Hl=null,null!==Vi){for(t=0;t<Vi.length;t++)if(null!==(a=(n=Vi[t]).interleaved)){n.interleaved=null;var o=a.next,i=n.pending;if(null!==i){var r=i.next;i.next=o,a.next=r}n.pending=a}Vi=null}return e}function hc(e,t){for(;;){var n=Rl;try{if(wi(),or.current=qr,gr){for(var a=sr.memoizedState;null!==a;){var o=a.queue;null!==o&&(o.pending=null),a=a.next}gr=!1}if(rr=0,cr=lr=sr=null,ur=!1,dr=0,Zl.current=null,null===n||null===n.return){Xl=1,Ml=t,Rl=null;break}e:{var r=e,s=n.return,l=n,c=t;if(t=Wl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var g=c,u=l,d=u.tag;if(0===(1&u.mode)&&(0===d||11===d||15===d)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Is(s);if(null!==p){p.flags&=-257,Cs(p,s,l,0,t),1&p.mode&&ms(r,g,t),c=g;var m=(t=p).updateQueue;if(null===m){var I=new Set;I.add(c),t.updateQueue=I}else m.add(c);break e}if(0===(1&t)){ms(r,g,t),mc();break e}c=Error(i(426))}else if(ii&&1&l.mode){var C=Is(s);if(null!==C){0===(65536&C.flags)&&(C.flags|=256),Cs(C,s,l,0,t),mi(cs(c,l));break e}}r=c=cs(c,l),4!==Xl&&(Xl=2),null===Hl?Hl=[r]:Hl.push(r),r=s;do{switch(r.tag){case 3:r.flags|=65536,t&=-t,r.lanes|=t,Li(r,hs(0,c,t));break e;case 1:l=c;var f=r.type,b=r.stateNode;if(0===(128&r.flags)&&("function"===typeof f.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Ul||!Ul.has(b)))){r.flags|=65536,t&=-t,r.lanes|=t,Li(r,ps(r,l,t));break e}}r=r.return}while(null!==r)}yc(n)}catch(y){t=y,Rl===n&&null!==n&&(Rl=n=n.return);continue}break}}function pc(){var e=Gl.current;return Gl.current=qr,null===e?qr:e}function mc(){0!==Xl&&3!==Xl&&2!==Xl||(Xl=4),null===Bl||0===(268435455&Tl)&&0===(268435455&El)||sc(Bl,Wl)}function Ic(e,t){var n=kl;kl|=2;var a=pc();for(Bl===e&&Wl===t||(zl=null,dc(e,t));;)try{Cc();break}catch(o){hc(e,o)}if(wi(),kl=n,Gl.current=a,null!==Rl)throw Error(i(261));return Bl=null,Wl=0,Xl}function Cc(){for(;null!==Rl;)bc(Rl)}function fc(){for(;null!==Rl&&!_e();)bc(Rl)}function bc(e){var t=Sl(e.alternate,e,Vl);e.memoizedProps=e.pendingProps,null===t?yc(e):Rl=t,Zl.current=null}function yc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ps(n,t,Vl)))return void(Rl=n)}else{if(null!==(n=Os(n,t)))return n.flags&=32767,void(Rl=n);if(null===e)return Xl=6,void(Rl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Rl=t);Rl=t=e}while(null!==t);0===Xl&&(Xl=5)}function Ac(e,t,n){var a=bt,o=wl.transition;try{wl.transition=null,bt=1,function(e,t,n,a){do{vc()}while(null!==Ol);if(0!==(6&kl))throw Error(i(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var r=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-rt(n),i=1<<o;t[o]=0,a[o]=-1,e[o]=-1,n&=~i}}(e,r),e===Bl&&(Rl=Bl=null,Wl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Pl||(Pl=!0,Bc(tt,(function(){return vc(),null}))),r=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||r){r=wl.transition,wl.transition=null;var s=bt;bt=1;var l=kl;kl|=4,Zl.current=null,function(e,t){if(eo=Kt,ha(e=da())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var a=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(a&&0!==a.rangeCount){n=a.anchorNode;var o=a.anchorOffset,r=a.focusNode;a=a.focusOffset;try{n.nodeType,r.nodeType}catch(A){n=null;break e}var s=0,l=-1,c=-1,g=0,u=0,d=e,h=null;t:for(;;){for(var p;d!==n||0!==o&&3!==d.nodeType||(l=s+o),d!==r||0!==a&&3!==d.nodeType||(c=s+a),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)h=d,d=p;for(;;){if(d===e)break t;if(h===n&&++g===o&&(l=s),h===r&&++u===a&&(c=s),null!==(p=d.nextSibling))break;h=(d=h).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Kt=!1,qs=t;null!==qs;)if(e=(t=qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,qs=e;else for(;null!==qs;){t=qs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var I=m.memoizedProps,C=m.memoizedState,f=t.stateNode,b=f.getSnapshotBeforeUpdate(t.elementType===t.type?I:ns(t.type,I),C);f.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(i(163))}}catch(A){xc(t,t.return,A)}if(null!==(e=t.sibling)){e.return=t.return,qs=e;break}qs=t.return}m=tl,tl=!1}(e,n),Il(n,e),pa(to),Kt=!!eo,to=eo=null,e.current=n,fl(n,e,o),Qe(),kl=l,bt=s,wl.transition=r}else e.current=n;if(Pl&&(Pl=!1,Ol=e,_l=o),r=e.pendingLanes,0===r&&(Ul=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ac(e,je()),null!==t)for(a=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],a(o.value,{componentStack:o.stack,digest:o.digest});if(Kl)throw Kl=!1,e=Dl,Dl=null,e;0!==(1&_l)&&0!==e.tag&&vc(),r=e.pendingLanes,0!==(1&r)?e===jl?Ql++:(Ql=0,jl=e):Ql=0,zo()}(e,t,n,a)}finally{wl.transition=o,bt=a}return null}function vc(){if(null!==Ol){var e=yt(_l),t=wl.transition,n=bt;try{if(wl.transition=null,bt=16>e?16:e,null===Ol)var a=!1;else{if(e=Ol,Ol=null,_l=0,0!==(6&kl))throw Error(i(331));var o=kl;for(kl|=4,qs=e.current;null!==qs;){var r=qs,s=r.child;if(0!==(16&qs.flags)){var l=r.deletions;if(null!==l){for(var c=0;c<l.length;c++){var g=l[c];for(qs=g;null!==qs;){var u=qs;switch(u.tag){case 0:case 11:case 15:nl(8,u,r)}var d=u.child;if(null!==d)d.return=u,qs=d;else for(;null!==qs;){var h=(u=qs).sibling,p=u.return;if(il(u),u===g){qs=null;break}if(null!==h){h.return=p,qs=h;break}qs=p}}}var m=r.alternate;if(null!==m){var I=m.child;if(null!==I){m.child=null;do{var C=I.sibling;I.sibling=null,I=C}while(null!==I)}}qs=r}}if(0!==(2064&r.subtreeFlags)&&null!==s)s.return=r,qs=s;else e:for(;null!==qs;){if(0!==(2048&(r=qs).flags))switch(r.tag){case 0:case 11:case 15:nl(9,r,r.return)}var f=r.sibling;if(null!==f){f.return=r.return,qs=f;break e}qs=r.return}}var b=e.current;for(qs=b;null!==qs;){var y=(s=qs).child;if(0!==(2064&s.subtreeFlags)&&null!==y)y.return=s,qs=y;else e:for(s=b;null!==qs;){if(0!==(2048&(l=qs).flags))try{switch(l.tag){case 0:case 11:case 15:al(9,l)}}catch(v){xc(l,l.return,v)}if(l===s){qs=null;break e}var A=l.sibling;if(null!==A){A.return=l.return,qs=A;break e}qs=l.return}}if(kl=o,zo(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(ot,e)}catch(v){}a=!0}return a}finally{bt=n,wl.transition=t}}return!1}function Sc(e,t,n){e=Ji(e,t=hs(0,t=cs(n,t),1),1),t=ec(),null!==e&&(Ct(e,1,t),ac(e,t))}function xc(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var a=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof a.componentDidCatch&&(null===Ul||!Ul.has(a))){t=Ji(t,e=ps(t,e=cs(n,e),1),1),e=ec(),null!==t&&(Ct(t,1,e),ac(t,e));break}}t=t.return}}function Gc(e,t,n){var a=e.pingCache;null!==a&&a.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Bl===e&&(Wl&n)===n&&(4===Xl||3===Xl&&(130023424&Wl)===Wl&&500>je()-Yl?dc(e,0):Fl|=n),ac(e,t)}function Zc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=gt,0===(130023424&(gt<<=1))&&(gt=4194304)));var n=ec();null!==(e=Mi(e,t))&&(Ct(e,t,n),ac(e,n))}function wc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Zc(e,n)}function kc(e,t){var n=0;switch(e.tag){case 13:var a=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(i(314))}null!==a&&a.delete(t),Zc(e,n)}function Bc(e,t){return Pe(e,t)}function Rc(e,t,n,a){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wc(e,t,n,a){return new Rc(e,t,n,a)}function Vc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Nc(e,t){var n=e.alternate;return null===n?((n=Wc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Xc(e,t,n,a,o,r){var s=2;if(a=e,"function"===typeof e)Vc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Mc(n.children,o,r,t);case x:s=8,o|=8;break;case G:return(e=Wc(12,n,t,2|o)).elementType=G,e.lanes=r,e;case B:return(e=Wc(13,n,t,o)).elementType=B,e.lanes=r,e;case R:return(e=Wc(19,n,t,o)).elementType=R,e.lanes=r,e;case N:return Tc(n,o,r,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case Z:s=10;break e;case w:s=9;break e;case k:s=11;break e;case W:s=14;break e;case V:s=16,a=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Wc(s,n,t,o)).elementType=e,t.type=a,t.lanes=r,t}function Mc(e,t,n,a){return(e=Wc(7,e,a,t)).lanes=n,e}function Tc(e,t,n,a){return(e=Wc(22,e,a,t)).elementType=N,e.lanes=n,e.stateNode={isHidden:!1},e}function Ec(e,t,n){return(e=Wc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=Wc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Hc(e,t,n,a,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=It(0),this.expirationTimes=It(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=It(0),this.identifierPrefix=a,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Jc(e,t,n,a,o,i,r,s,l){return e=new Hc(e,t,n,s,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Wc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:a,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ei(i),e}function Yc(e){if(!e)return ko;e:{if(Le(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(No(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(No(n))return To(e,n,t)}return t}function Lc(e,t,n,a,o,i,r,s,l){return(e=Jc(n,a,!0,e,0,i,0,s,l)).context=Yc(null),n=e.current,(i=Hi(a=ec(),o=tc(n))).callback=void 0!==t&&null!==t?t:null,Ji(n,i,o),e.current.lanes=o,Ct(e,o,a),ac(e,a),e}function zc(e,t,n,a){var o=t.current,i=ec(),r=tc(o);return n=Yc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Hi(i,r)).payload={element:e},null!==(a=void 0===a?null:a)&&(t.callback=a),null!==(e=Ji(o,t,r))&&(nc(e,o,r,i),Yi(e,o,r)),r}function Kc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Dc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Uc(e,t){Dc(e,t),(e=e.alternate)&&Dc(e,t)}Sl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ro.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Bs(t),pi();break;case 5:qi(t);break;case 1:No(t.type)&&Eo(t);break;case 4:Qi(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,o=t.memoizedProps.value;wo(Si,a._currentValue),a._currentValue=o;break;case 13:if(null!==(a=t.memoizedState))return null!==a.dehydrated?(wo(er,1&er.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Es(e,t,n):(wo(er,1&er.current),null!==(e=Ks(e,t,n))?e.sibling:null);wo(er,1&er.current);break;case 19:if(a=0!==(n&t.childLanes),0!==(128&e.flags)){if(a)return Ls(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),wo(er,er.current),a)break;return null;case 22:case 23:return t.lanes=0,xs(e,t,n)}return Ks(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,ii&&0!==(1048576&t.flags)&&ei(t,Po,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;zs(e,t),e=t.pendingProps;var o=Vo(t,Bo.current);Ri(t,n),o=Ir(null,t,a,e,o,n);var r=Cr();return t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,No(a)?(r=!0,Eo(t)):r=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Ei(t),o.updater=os,t.stateNode=o,o._reactInternals=t,ls(t,a,e,n),t=ks(null,t,a,!0,r,n)):(t.tag=0,ii&&r&&ti(t),ys(null,t,o,n),t=t.child),t;case 16:a=t.elementType;e:{switch(zs(e,t),e=t.pendingProps,a=(o=a._init)(a._payload),t.type=a,o=t.tag=function(e){if("function"===typeof e)return Vc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===k)return 11;if(e===W)return 14}return 2}(a),e=ns(a,e),o){case 0:t=Zs(null,t,a,e,n);break e;case 1:t=ws(null,t,a,e,n);break e;case 11:t=As(null,t,a,e,n);break e;case 14:t=vs(null,t,a,ns(a.type,e),n);break e}throw Error(i(306,a,""))}return t;case 0:return a=t.type,o=t.pendingProps,Zs(e,t,a,o=t.elementType===a?o:ns(a,o),n);case 1:return a=t.type,o=t.pendingProps,ws(e,t,a,o=t.elementType===a?o:ns(a,o),n);case 3:e:{if(Bs(t),null===e)throw Error(i(387));a=t.pendingProps,o=(r=t.memoizedState).element,Fi(e,t),zi(t,a,null,n);var s=t.memoizedState;if(a=s.element,r.isDehydrated){if(r={element:a,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=r,t.memoizedState=r,256&t.flags){t=Rs(e,t,a,n,o=cs(Error(i(423)),t));break e}if(a!==o){t=Rs(e,t,a,n,o=cs(Error(i(424)),t));break e}for(oi=co(t.stateNode.containerInfo.firstChild),ai=t,ii=!0,ri=null,n=vi(t,null,a,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pi(),a===o){t=Ks(e,t,n);break e}ys(e,t,a,n)}t=t.child}return t;case 5:return qi(t),null===e&&gi(t),a=t.type,o=t.pendingProps,r=null!==e?e.memoizedProps:null,s=o.children,no(a,o)?s=null:null!==r&&no(a,r)&&(t.flags|=32),Gs(e,t),ys(e,t,s,n),t.child;case 6:return null===e&&gi(t),null;case 13:return Es(e,t,n);case 4:return Qi(t,t.stateNode.containerInfo),a=t.pendingProps,null===e?t.child=Ai(t,null,a,n):ys(e,t,a,n),t.child;case 11:return a=t.type,o=t.pendingProps,As(e,t,a,o=t.elementType===a?o:ns(a,o),n);case 7:return ys(e,t,t.pendingProps,n),t.child;case 8:case 12:return ys(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(a=t.type._context,o=t.pendingProps,r=t.memoizedProps,s=o.value,wo(Si,a._currentValue),a._currentValue=s,null!==r)if(sa(r.value,s)){if(r.children===o.children&&!Ro.current){t=Ks(e,t,n);break e}}else for(null!==(r=t.child)&&(r.return=t);null!==r;){var l=r.dependencies;if(null!==l){s=r.child;for(var c=l.firstContext;null!==c;){if(c.context===a){if(1===r.tag){(c=Hi(-1,n&-n)).tag=2;var g=r.updateQueue;if(null!==g){var u=(g=g.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),g.pending=c}}r.lanes|=n,null!==(c=r.alternate)&&(c.lanes|=n),Bi(r.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===r.tag)s=r.type===t.type?null:r.child;else if(18===r.tag){if(null===(s=r.return))throw Error(i(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Bi(s,n,t),s=r.sibling}else s=r.child;if(null!==s)s.return=r;else for(s=r;null!==s;){if(s===t){s=null;break}if(null!==(r=s.sibling)){r.return=s.return,s=r;break}s=s.return}r=s}ys(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,a=t.pendingProps.children,Ri(t,n),a=a(o=Wi(o)),t.flags|=1,ys(e,t,a,n),t.child;case 14:return o=ns(a=t.type,t.pendingProps),vs(e,t,a,o=ns(a.type,o),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return a=t.type,o=t.pendingProps,o=t.elementType===a?o:ns(a,o),zs(e,t),t.tag=1,No(a)?(e=!0,Eo(t)):e=!1,Ri(t,n),rs(t,a,o),ls(t,a,o,n),ks(null,t,a,!0,e,n);case 19:return Ls(e,t,n);case 22:return xs(e,t,n)}throw Error(i(156,t.tag))};var Pc="function"===typeof reportError?reportError:function(e){console.error(e)};function Oc(e){this._internalRoot=e}function _c(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function qc(){}function $c(e,t,n,a,o){var i=n._reactRootContainer;if(i){var r=i;if("function"===typeof o){var s=o;o=function(){var e=Kc(r);s.call(e)}}zc(t,r,e,o)}else r=function(e,t,n,a,o){if(o){if("function"===typeof a){var i=a;a=function(){var e=Kc(r);i.call(e)}}var r=Lc(t,a,e,0,null,!1,0,"",qc);return e._reactRootContainer=r,e[mo]=r.current,La(8===e.nodeType?e.parentNode:e),gc(),r}for(;o=e.lastChild;)e.removeChild(o);if("function"===typeof a){var s=a;a=function(){var e=Kc(l);s.call(e)}}var l=Jc(e,0,!1,null,0,!1,0,"",qc);return e._reactRootContainer=l,e[mo]=l.current,La(8===e.nodeType?e.parentNode:e),gc((function(){zc(t,l,n,a)})),l}(n,t,e,o,a);return Kc(r)}_c.prototype.render=Oc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));zc(e,t,null,null)},_c.prototype.unmount=Oc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;gc((function(){zc(null,e,null,null)})),t[mo]=null}},_c.prototype.unstable_scheduleHydration=function(e){if(e){var t=xt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Nt.length&&0!==t&&t<Nt[n].priority;n++);Nt.splice(n,0,e),0===n&&Et(e)}},At=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(ft(t,1|n),ac(t,je()),0===(6&kl)&&(Ll=je()+500,zo()))}break;case 13:gc((function(){var t=Mi(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),Uc(e,1)}},vt=function(e){if(13===e.tag){var t=Mi(e,134217728);if(null!==t)nc(t,e,134217728,ec());Uc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),n=Mi(e,t);if(null!==n)nc(n,e,t,ec());Uc(e,t)}},xt=function(){return bt},Gt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},ve=function(e,t,n){switch(t){case"input":if(q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var a=n[t];if(a!==e&&a.form===e.form){var o=vo(a);if(!o)throw Error(i(90));P(a),q(a,o)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},ke=cc,Be=gc;var eg={usingClientEntryPoint:!1,Events:[yo,Ao,vo,Ze,we,cc]},tg={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ng={bundleType:tg.bundleType,version:tg.version,rendererPackageName:tg.rendererPackageName,rendererConfig:tg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=De(e))?null:e.stateNode},findFiberByHostInstance:tg.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ag=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ag.isDisabled&&ag.supportsFiber)try{ot=ag.inject(ng),it=ag}catch(ge){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eg,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(i(200));return function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:v,key:null==a?null:""+a,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(i(299));var n=!1,a="",o=Pc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(a=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Jc(e,1,!1,null,0,n,0,a,o),e[mo]=t.current,La(8===e.nodeType?e.parentNode:e),new Oc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=De(t))?null:e.stateNode},t.flushSync=function(e){return gc(e)},t.hydrate=function(e,t,n){if(!jc(t))throw Error(i(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(i(405));var a=null!=n&&n.hydratedSources||null,o=!1,r="",s=Pc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Lc(t,null,e,1,null!=n?n:null,o,0,r,s),e[mo]=t.current,La(e),a)for(e=0;e<a.length;e++)o=(o=(n=a[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new _c(t)},t.render=function(e,t,n){if(!jc(t))throw Error(i(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!jc(e))throw Error(i(40));return!!e._reactRootContainer&&(gc((function(){$c(null,null,e,!1,(function(){e._reactRootContainer=null,e[mo]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,a){if(!jc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return $c(e,t,n,!1,a)},t.version="18.3.1-next-f1338f8080-20240426"},775:(e,t,n)=>{"use strict";var a=n(9998);t.createRoot=a.createRoot,t.hydrateRoot=a.hydrateRoot},9998:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(5914)},9718:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=s(n(6405)),i=n(2483),r=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l={bgColor:o.default.oneOfType([o.default.object,o.default.string]).isRequired,bgD:o.default.string.isRequired,fgColor:o.default.oneOfType([o.default.object,o.default.string]).isRequired,fgD:o.default.string.isRequired,size:o.default.number.isRequired,title:o.default.string,viewBoxSize:o.default.number.isRequired,xmlns:o.default.string},c=(0,i.forwardRef)((function(e,t){var n=e.bgColor,o=e.bgD,i=e.fgD,s=e.fgColor,l=e.size,c=e.title,g=e.viewBoxSize,u=e.xmlns,d=void 0===u?"http://www.w3.org/2000/svg":u,h=function(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}(e,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return r.default.createElement("svg",a({},h,{height:l,ref:t,viewBox:"0 0 "+g+" "+g,width:l,xmlns:d}),c?r.default.createElement("title",null,c):null,r.default.createElement("path",{d:o,fill:n}),r.default.createElement("path",{d:i,fill:s}))}));c.displayName="QRCodeSvg",c.propTypes=l,t.default=c},3901:(e,t,n)=>{"use strict";var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=g(n(6405)),i=g(n(9662)),r=g(n(7596)),s=n(2483),l=g(s),c=g(n(9718));function g(e){return e&&e.__esModule?e:{default:e}}var u={bgColor:o.default.oneOfType([o.default.object,o.default.string]),fgColor:o.default.oneOfType([o.default.object,o.default.string]),level:o.default.string,size:o.default.number,value:o.default.string.isRequired},d=(0,s.forwardRef)((function(e,t){var n=e.bgColor,o=void 0===n?"#FFFFFF":n,s=e.fgColor,g=void 0===s?"#000000":s,u=e.level,d=void 0===u?"L":u,h=e.size,p=void 0===h?256:h,m=e.value,I=function(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}(e,["bgColor","fgColor","level","size","value"]),C=new r.default(-1,i.default[d]);C.addData(m),C.make();var f=C.modules;return l.default.createElement(c.default,a({},I,{bgColor:o,bgD:f.map((function(e,t){return e.map((function(e,n){return e?"":"M "+n+" "+t+" l 1 0 0 1 -1 0 Z"})).join(" ")})).join(" "),fgColor:g,fgD:f.map((function(e,t){return e.map((function(e,n){return e?"M "+n+" "+t+" l 1 0 0 1 -1 0 Z":""})).join(" ")})).join(" "),ref:t,size:p,viewBoxSize:f.length}))}));d.displayName="QRCode",d.propTypes=u,t.Ay=d},1757:function(e,t,n){e.exports=function(e){"use strict";function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n=t(e);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a.apply(this,arguments)}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){if(Array.isArray(e))return e}function r(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,o,i=[],r=!0,s=!1;try{for(n=n.call(e);!(r=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(l){s=!0,o=l}finally{try{r||null==n.return||n.return()}finally{if(s)throw o}}return i}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function l(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e,t){return i(e)||r(e,t)||l(e,t)||c()}function u(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}function d(e,t){if(null==e)return{};var n,a,o=u(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var h={exports:{}},p={exports:{}},m={},I="function"===typeof Symbol&&Symbol.for,C=I?Symbol.for("react.element"):60103,f=I?Symbol.for("react.portal"):60106,b=I?Symbol.for("react.fragment"):60107,y=I?Symbol.for("react.strict_mode"):60108,A=I?Symbol.for("react.profiler"):60114,v=I?Symbol.for("react.provider"):60109,S=I?Symbol.for("react.context"):60110,x=I?Symbol.for("react.async_mode"):60111,G=I?Symbol.for("react.concurrent_mode"):60111,Z=I?Symbol.for("react.forward_ref"):60112,w=I?Symbol.for("react.suspense"):60113,k=I?Symbol.for("react.suspense_list"):60120,B=I?Symbol.for("react.memo"):60115,R=I?Symbol.for("react.lazy"):60116,W=I?Symbol.for("react.block"):60121,V=I?Symbol.for("react.fundamental"):60117,N=I?Symbol.for("react.responder"):60118,X=I?Symbol.for("react.scope"):60119;function M(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case C:switch(e=e.type){case x:case G:case b:case A:case y:case w:return e;default:switch(e=e&&e.$$typeof){case S:case Z:case R:case B:case v:return e;default:return t}}case f:return t}}}function T(e){return M(e)===G}m.AsyncMode=x,m.ConcurrentMode=G,m.ContextConsumer=S,m.ContextProvider=v,m.Element=C,m.ForwardRef=Z,m.Fragment=b,m.Lazy=R,m.Memo=B,m.Portal=f,m.Profiler=A,m.StrictMode=y,m.Suspense=w,m.isAsyncMode=function(e){return T(e)||M(e)===x},m.isConcurrentMode=T,m.isContextConsumer=function(e){return M(e)===S},m.isContextProvider=function(e){return M(e)===v},m.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===C},m.isForwardRef=function(e){return M(e)===Z},m.isFragment=function(e){return M(e)===b},m.isLazy=function(e){return M(e)===R},m.isMemo=function(e){return M(e)===B},m.isPortal=function(e){return M(e)===f},m.isProfiler=function(e){return M(e)===A},m.isStrictMode=function(e){return M(e)===y},m.isSuspense=function(e){return M(e)===w},m.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===b||e===G||e===A||e===y||e===w||e===k||"object"===typeof e&&null!==e&&(e.$$typeof===R||e.$$typeof===B||e.$$typeof===v||e.$$typeof===S||e.$$typeof===Z||e.$$typeof===V||e.$$typeof===N||e.$$typeof===X||e.$$typeof===W)},m.typeOf=M,p.exports=m;Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;function E(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var a=Object.getOwnPropertyNames(t).map((function(e){return t[e]}));if("0123456789"!==a.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(e){o[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(i){return!1}}E()&&Object.assign;var F="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";function H(e,t,n,a,o){}Function.call.bind(Object.prototype.hasOwnProperty),H.resetWarningCache=function(){},p.exports;var J=F;function Y(){}function L(){}L.resetWarningCache=Y;var z=function(){function e(e,t,n,a,o,i){if(i!==J){var r=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw r.name="Invariant Violation",r}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:L,resetWarningCache:Y};return n.PropTypes=n,n};h.exports=z();var K=h.exports;function D(e,t){var n=atob(e);if(t){for(var a=new Uint8Array(n.length),o=0,i=n.length;o<i;++o)a[o]=n.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(a.buffer))}return n}function U(e,t,n){var a=void 0===t?null:t,o=D(e,void 0!==n&&n),i=o.indexOf("\n",10)+1,r=o.substring(i)+(a?"//# sourceMappingURL="+a:""),s=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(s)}function P(e,t,n){var a;return function(o){return a=a||U(e,t,n),new Worker(a,o)}}var O=P("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg==",null,!1),_=["constraints","onError","onLoad","onScan","resolution","qrArea"];function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(){return new O},$=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().forEach((function(t){e.removeTrack(t),t.stop()})),e.getAudioTracks().forEach((function(t){e.removeTrack(t),t.stop()}))):e.stop())},ee=function(e){var t=e.constraints,o=e.onError,i=e.onLoad,r=e.onScan,s=e.resolution,l=e.qrArea,c=d(e,_),u=n.useRef(null),h=n.useRef(null),p=n.useRef(document.createElement("canvas")),m=n.useRef(null),I=n.useRef(),C=g(n.useState(null),2),f=C[0],b=C[1],y=n.useRef(!1),A=n.useRef();n.useEffect((function(){A.current=q();var e=A.current;return e.onmessage=function(e){r&&r(e.data?j(j({},e.data),{},{canvas:p.current}):null),y.current=!1},function(){e.terminate()}}),[r]);var v=JSON.stringify(l),S=n.useCallback((function(){var e=JSON.parse(v),t=A.current,n=h.current&&h.current.readyState===h.current.HAVE_ENOUGH_DATA;if(!y.current&&n){y.current=!0;var a,o=h.current.videoWidth,i=h.current.videoHeight,r=o>i?o:i,l=Math.floor(s/r*100)/100;i=Math.floor(l*i),o=Math.floor(l*o),p.current.width=o,p.current.height=i,m.current=p.current.getContext("2d"),m.current.drawImage(h.current,0,0,o,i),a=e&&2===e.length&&e[0]>0&&e[1]>0?m.current.getImageData(Math.floor((o-e[0])/2),Math.floor((i-e[1])/2),e[0],e[1]):m.current.getImageData(0,0,o,i),t.postMessage(a)}I.current=requestAnimationFrame(S)}),[s,v]),x=JSON.stringify(t);return n.useEffect((function(){var e=JSON.parse(x),t=!0;return navigator.mediaDevices.getUserMedia(e).then((function(e){if(t){u.current=e;try{h.current&&(h.current.srcObject=e,h.current.setAttribute("playsinline",!0))}catch(n){b(window.URL.createObjectURL(e))}i&&i(),I.current=requestAnimationFrame(S)}else $(e)})).catch((function(e){return t?o(e):null})),function(){cancelAnimationFrame(I.current),t=!1,$(u.current),f&&window.URL.revokeObjectURL(f)}}),[S,x,o,i,f]),n.createElement("video",a({autoPlay:!0,playsInline:!0,src:f,ref:h},c))};return ee.propTypes={constraints:K.object,onError:K.func.isRequired,onLoad:K.func,onScan:K.func.isRequired,resolution:K.number,qrArea:K.array},ee.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]},ee}(n(2483))},9009:(e,t,n)=>{"use strict";var a=n(2483),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var a,i={},c=null,g=null;for(a in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(g=t.ref),t)r.call(t,a)&&!l.hasOwnProperty(a)&&(i[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===i[a]&&(i[a]=t[a]);return{$$typeof:o,type:e,key:c,ref:g,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},3146:(e,t)=>{"use strict";var n=Symbol.for("react.element"),a=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,I={};function C(e,t,n){this.props=e,this.context=t,this.refs=I,this.updater=n||p}function f(){}function b(e,t,n){this.props=e,this.context=t,this.refs=I,this.updater=n||p}C.prototype.isReactComponent={},C.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},C.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},f.prototype=C.prototype;var y=b.prototype=new f;y.constructor=b,m(y,C.prototype),y.isPureReactComponent=!0;var A=Array.isArray,v=Object.prototype.hasOwnProperty,S={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function G(e,t,a){var o,i={},r=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(r=""+t.key),t)v.call(t,o)&&!x.hasOwnProperty(o)&&(i[o]=t[o]);var l=arguments.length-2;if(1===l)i.children=a;else if(1<l){for(var c=Array(l),g=0;g<l;g++)c[g]=arguments[g+2];i.children=c}if(e&&e.defaultProps)for(o in l=e.defaultProps)void 0===i[o]&&(i[o]=l[o]);return{$$typeof:n,type:e,key:r,ref:s,props:i,_owner:S.current}}function Z(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var w=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function B(e,t,o,i,r){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case a:l=!0}}if(l)return r=r(l=e),e=""===i?"."+k(l,0):i,A(r)?(o="",null!=e&&(o=e.replace(w,"$&/")+"/"),B(r,t,o,"",(function(e){return e}))):null!=r&&(Z(r)&&(r=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(r,o+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(w,"$&/")+"/")+e)),t.push(r)),1;if(l=0,i=""===i?".":i+":",A(e))for(var c=0;c<e.length;c++){var g=i+k(s=e[c],c);l+=B(s,t,o,g,r)}else if(g=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof g)for(e=g.call(e),c=0;!(s=e.next()).done;)l+=B(s=s.value,t,o,g=i+k(s,c++),r);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function R(e,t,n){if(null==e)return e;var a=[],o=0;return B(e,a,"","",(function(e){return t.call(n,e,o++)})),a}function W(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var V={current:null},N={transition:null},X={ReactCurrentDispatcher:V,ReactCurrentBatchConfig:N,ReactCurrentOwner:S};function M(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:R,forEach:function(e,t,n){R(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!Z(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=C,t.Fragment=o,t.Profiler=r,t.PureComponent=b,t.StrictMode=i,t.Suspense=g,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,t.act=M,t.cloneElement=function(e,t,a){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=m({},e.props),i=e.key,r=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(r=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)v.call(t,c)&&!x.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=a;else if(1<c){l=Array(c);for(var g=0;g<c;g++)l[g]=arguments[g+2];o.children=l}return{$$typeof:n,type:e.type,key:i,ref:r,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=G,t.createFactory=function(e){var t=G.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=Z,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:W}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},t.unstable_act=M,t.useCallback=function(e,t){return V.current.useCallback(e,t)},t.useContext=function(e){return V.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return V.current.useDeferredValue(e)},t.useEffect=function(e,t){return V.current.useEffect(e,t)},t.useId=function(){return V.current.useId()},t.useImperativeHandle=function(e,t,n){return V.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return V.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return V.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return V.current.useMemo(e,t)},t.useReducer=function(e,t,n){return V.current.useReducer(e,t,n)},t.useRef=function(e){return V.current.useRef(e)},t.useState=function(e){return V.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return V.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return V.current.useTransition()},t.version="18.3.1"},2483:(e,t,n)=>{"use strict";e.exports=n(3146)},6723:(e,t,n)=>{"use strict";e.exports=n(9009)},7122:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var a=n-1>>>1,o=e[a];if(!(0<i(o,t)))break e;e[a]=t,e[n]=o,n=a}}function a(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var a=0,o=e.length,r=o>>>1;a<r;){var s=2*(a+1)-1,l=e[s],c=s+1,g=e[c];if(0>i(l,n))c<o&&0>i(g,l)?(e[a]=g,e[c]=n,a=c):(e[a]=l,e[s]=n,a=s);else{if(!(c<o&&0>i(g,n)))break e;e[a]=g,e[c]=n,a=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var r=performance;t.unstable_now=function(){return r.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],g=[],u=1,d=null,h=3,p=!1,m=!1,I=!1,C="function"===typeof setTimeout?setTimeout:null,f="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function y(e){for(var t=a(g);null!==t;){if(null===t.callback)o(g);else{if(!(t.startTime<=e))break;o(g),t.sortIndex=t.expirationTime,n(c,t)}t=a(g)}}function A(e){if(I=!1,y(e),!m)if(null!==a(c))m=!0,N(v);else{var t=a(g);null!==t&&X(A,t.startTime-e)}}function v(e,n){m=!1,I&&(I=!1,f(Z),Z=-1),p=!0;var i=h;try{for(y(n),d=a(c);null!==d&&(!(d.expirationTime>n)||e&&!B());){var r=d.callback;if("function"===typeof r){d.callback=null,h=d.priorityLevel;var s=r(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===a(c)&&o(c),y(n)}else o(c);d=a(c)}if(null!==d)var l=!0;else{var u=a(g);null!==u&&X(A,u.startTime-n),l=!1}return l}finally{d=null,h=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,x=!1,G=null,Z=-1,w=5,k=-1;function B(){return!(t.unstable_now()-k<w)}function R(){if(null!==G){var e=t.unstable_now();k=e;var n=!0;try{n=G(!0,e)}finally{n?S():(x=!1,G=null)}}else x=!1}if("function"===typeof b)S=function(){b(R)};else if("undefined"!==typeof MessageChannel){var W=new MessageChannel,V=W.port2;W.port1.onmessage=R,S=function(){V.postMessage(null)}}else S=function(){C(R,0)};function N(e){G=e,x||(x=!0,S())}function X(e,n){Z=C((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,N(v))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return a(c)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,o,i){var r=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?r+i:r:i=r,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:o,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>r?(e.sortIndex=i,n(g,e),null===a(c)&&e===a(g)&&(I?(f(Z),Z=-1):I=!0,X(A,i-r))):(e.sortIndex=s,n(c,e),m||p||(m=!0,N(v))),e},t.unstable_shouldYield=B,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},3557:(e,t,n)=>{"use strict";e.exports=n(7122)},5675:e=>{e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],a=0;a<e.rangeCount;a++)n.push(e.getRangeAt(a));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}}},1097:(e,t)=>{var n;!function(){"use strict";var a={}.hasOwnProperty;function o(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=r(e,i(n)))}return e}function i(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return o.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)a.call(e,n)&&e[n]&&(t=r(t,n));return t}function r(e,t){return t?e?e+" "+t:e+t:e}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(a,o){if(1&o&&(a=this(a)),8&o)return a;if("object"===typeof a&&a){if(4&o&&a.__esModule)return a;if(16&o&&"function"===typeof a.then)return a}var i=Object.create(null);n.r(i);var r={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&a;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>r[e]=()=>a[e]));return r.default=()=>a,n.d(i,r),i}})(),n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{"use strict";var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:()=>Lb,AddEquation:()=>ub,AddOperation:()=>Eb,AdditiveAnimationBlendMode:()=>CA,AdditiveBlending:()=>sb,AlphaFormat:()=>yy,AlwaysDepth:()=>kb,AlwaysStencilFunc:()=>UA,AmbientLight:()=>jW,AmbientLightProbe:()=>pV,AnimationAction:()=>LV,AnimationClip:()=>AW,AnimationLoader:()=>RW,AnimationMixer:()=>KV,AnimationObjectGroup:()=>YV,AnimationUtils:()=>lW,ArcCurve:()=>GB,ArrayCamera:()=>jw,ArrowHelper:()=>MN,Audio:()=>ZV,AudioAnalyser:()=>VV,AudioContext:()=>uV,AudioListener:()=>GV,AudioLoader:()=>dV,AxesHelper:()=>TN,BackSide:()=>nb,BasicDepthPacking:()=>SA,BasicShadowMap:()=>jf,Bone:()=>Jk,BooleanKeyframeTrack:()=>pW,Box2:()=>nN,Box3:()=>qv,Box3Helper:()=>RN,BoxBufferGeometry:()=>FN,BoxGeometry:()=>cG,BoxHelper:()=>BN,BufferAttribute:()=>Gx,BufferGeometry:()=>zx,BufferGeometryLoader:()=>oV,ByteType:()=>gy,Cache:()=>SW,Camera:()=>mG,CameraHelper:()=>ZN,CanvasTexture:()=>vB,CapsuleBufferGeometry:()=>HN,CapsuleGeometry:()=>UB,CatmullRomCurve3:()=>WB,CineonToneMapping:()=>Yb,CircleBufferGeometry:()=>JN,CircleGeometry:()=>PB,ClampToEdgeWrapping:()=>jb,Clock:()=>bV,Color:()=>mx,ColorKeyframeTrack:()=>mW,ColorManagement:()=>Xv,CompressedArrayTexture:()=>AB,CompressedTexture:()=>yB,CompressedTextureLoader:()=>WW,ConeBufferGeometry:()=>YN,ConeGeometry:()=>_B,CubeCamera:()=>fG,CubeReflectionMapping:()=>Db,CubeRefractionMapping:()=>Ub,CubeTexture:()=>bG,CubeTextureLoader:()=>NW,CubeUVReflectionMapping:()=>_b,CubicBezierCurve:()=>MB,CubicBezierCurve3:()=>TB,CubicInterpolant:()=>gW,CullFaceBack:()=>Of,CullFaceFront:()=>_f,CullFaceFrontBack:()=>Qf,CullFaceNone:()=>Pf,Curve:()=>SB,CurvePath:()=>zB,CustomBlending:()=>gb,CustomToneMapping:()=>zb,CylinderBufferGeometry:()=>LN,CylinderGeometry:()=>OB,Cylindrical:()=>eN,Data3DTexture:()=>Dv,DataArrayTexture:()=>zv,DataTexture:()=>Yk,DataTextureLoader:()=>XW,DataUtils:()=>vx,DecrementStencilOp:()=>MA,DecrementWrapStencilOp:()=>EA,DefaultLoadingManager:()=>GW,DepthFormat:()=>xy,DepthStencilFormat:()=>Gy,DepthTexture:()=>tk,DirectionalLight:()=>QW,DirectionalLightHelper:()=>SN,DiscreteInterpolant:()=>dW,DisplayP3ColorSpace:()=>RA,DodecahedronBufferGeometry:()=>zN,DodecahedronGeometry:()=>jB,DoubleSide:()=>ab,DstAlphaFactor:()=>vb,DstColorFactor:()=>xb,DynamicCopyUsage:()=>ev,DynamicDrawUsage:()=>OA,DynamicReadUsage:()=>jA,EdgesGeometry:()=>nR,EllipseCurve:()=>xB,EqualDepth:()=>Wb,EqualStencilFunc:()=>YA,EquirectangularReflectionMapping:()=>Pb,EquirectangularRefractionMapping:()=>Ob,Euler:()=>MS,EventDispatcher:()=>iv,ExtrudeBufferGeometry:()=>KN,ExtrudeGeometry:()=>VR,FileLoader:()=>BW,Float16BufferAttribute:()=>Nx,Float32BufferAttribute:()=>Xx,Float64BufferAttribute:()=>Mx,FloatType:()=>my,Fog:()=>ck,FogExp2:()=>lk,FramebufferTexture:()=>bB,FrontSide:()=>tb,Frustum:()=>wG,GLBufferAttribute:()=>_V,GLSL1:()=>nv,GLSL3:()=>av,GreaterDepth:()=>Nb,GreaterEqualDepth:()=>Vb,GreaterEqualStencilFunc:()=>DA,GreaterStencilFunc:()=>zA,GridHelper:()=>fN,Group:()=>qw,HalfFloatType:()=>Iy,HemisphereLight:()=>EW,HemisphereLightHelper:()=>CN,HemisphereLightProbe:()=>hV,IcosahedronBufferGeometry:()=>DN,IcosahedronGeometry:()=>XR,ImageBitmapLoader:()=>cV,ImageLoader:()=>VW,ImageUtils:()=>Tv,IncrementStencilOp:()=>XA,IncrementWrapStencilOp:()=>TA,InstancedBufferAttribute:()=>Dk,InstancedBufferGeometry:()=>aV,InstancedInterleavedBuffer:()=>OV,InstancedMesh:()=>$k,Int16BufferAttribute:()=>Bx,Int32BufferAttribute:()=>Wx,Int8BufferAttribute:()=>Zx,IntType:()=>hy,InterleavedBuffer:()=>uk,InterleavedBufferAttribute:()=>hk,Interpolant:()=>cW,InterpolateDiscrete:()=>gA,InterpolateLinear:()=>uA,InterpolateSmooth:()=>dA,InvertStencilOp:()=>FA,KeepStencilOp:()=>VA,KeyframeTrack:()=>hW,LOD:()=>Vk,LatheBufferGeometry:()=>UN,LatheGeometry:()=>DB,Layers:()=>TS,LessDepth:()=>Bb,LessEqualDepth:()=>Rb,LessEqualStencilFunc:()=>LA,LessStencilFunc:()=>JA,Light:()=>TW,LightProbe:()=>eV,Line:()=>rB,Line3:()=>iN,LineBasicMaterial:()=>eB,LineCurve:()=>EB,LineCurve3:()=>FB,LineDashedMaterial:()=>tW,LineLoop:()=>gB,LineSegments:()=>cB,LinearEncoding:()=>AA,LinearFilter:()=>oy,LinearInterpolant:()=>uW,LinearMipMapLinearFilter:()=>ly,LinearMipMapNearestFilter:()=>ry,LinearMipmapLinearFilter:()=>sy,LinearMipmapNearestFilter:()=>iy,LinearSRGBColorSpace:()=>BA,LinearToneMapping:()=>Hb,Loader:()=>ZW,LoaderUtils:()=>nV,LoadingManager:()=>xW,LoopOnce:()=>sA,LoopPingPong:()=>cA,LoopRepeat:()=>lA,LuminanceAlphaFormat:()=>Sy,LuminanceFormat:()=>vy,MOUSE:()=>Df,Material:()=>gx,MaterialLoader:()=>tV,MathUtils:()=>bv,Matrix3:()=>Av,Matrix4:()=>GS,MaxEquation:()=>mb,Mesh:()=>sG,MeshBasicMaterial:()=>Cx,MeshDepthMaterial:()=>Dw,MeshDistanceMaterial:()=>Uw,MeshLambertMaterial:()=>$R,MeshMatcapMaterial:()=>eW,MeshNormalMaterial:()=>qR,MeshPhongMaterial:()=>QR,MeshPhysicalMaterial:()=>_R,MeshStandardMaterial:()=>OR,MeshToonMaterial:()=>jR,MinEquation:()=>pb,MirroredRepeatWrapping:()=>qb,MixOperation:()=>Tb,MultiplyBlending:()=>cb,MultiplyOperation:()=>Mb,NearestFilter:()=>$b,NearestMipMapLinearFilter:()=>ay,NearestMipMapNearestFilter:()=>ty,NearestMipmapLinearFilter:()=>ny,NearestMipmapNearestFilter:()=>ey,NeverDepth:()=>wb,NeverStencilFunc:()=>HA,NoBlending:()=>ib,NoColorSpace:()=>wA,NoToneMapping:()=>Fb,NormalAnimationBlendMode:()=>IA,NormalBlending:()=>rb,NotEqualDepth:()=>Xb,NotEqualStencilFunc:()=>KA,NumberKeyframeTrack:()=>IW,Object3D:()=>QS,ObjectLoader:()=>iV,ObjectSpaceNormalMap:()=>ZA,OctahedronBufferGeometry:()=>PN,OctahedronGeometry:()=>MR,OneFactor:()=>Cb,OneMinusDstAlphaFactor:()=>Sb,OneMinusDstColorFactor:()=>Gb,OneMinusSrcAlphaFactor:()=>Ab,OneMinusSrcColorFactor:()=>bb,OrthographicCamera:()=>YG,PCFShadowMap:()=>qf,PCFSoftShadowMap:()=>$f,PMREMGenerator:()=>QG,Path:()=>KB,PerspectiveCamera:()=>IG,Plane:()=>xG,PlaneBufferGeometry:()=>ON,PlaneGeometry:()=>RG,PlaneHelper:()=>WN,PointLight:()=>OW,PointLightHelper:()=>hN,Points:()=>IB,PointsMaterial:()=>uB,PolarGridHelper:()=>bN,PolyhedronBufferGeometry:()=>_N,PolyhedronGeometry:()=>QB,PositionalAudio:()=>WV,PropertyBinding:()=>JV,PropertyMixer:()=>NV,QuadraticBezierCurve:()=>HB,QuadraticBezierCurve3:()=>JB,Quaternion:()=>Ov,QuaternionKeyframeTrack:()=>fW,QuaternionLinearInterpolant:()=>CW,RED_GREEN_RGTC2_Format:()=>iA,RED_RGTC1_Format:()=>aA,REVISION:()=>Kf,RGBADepthPacking:()=>xA,RGBAFormat:()=>Ay,RGBAIntegerFormat:()=>Ry,RGBA_ASTC_10x10_Format:()=>$y,RGBA_ASTC_10x5_Format:()=>Qy,RGBA_ASTC_10x6_Format:()=>jy,RGBA_ASTC_10x8_Format:()=>qy,RGBA_ASTC_12x10_Format:()=>eA,RGBA_ASTC_12x12_Format:()=>tA,RGBA_ASTC_4x4_Format:()=>Ly,RGBA_ASTC_5x4_Format:()=>zy,RGBA_ASTC_5x5_Format:()=>Ky,RGBA_ASTC_6x5_Format:()=>Dy,RGBA_ASTC_6x6_Format:()=>Uy,RGBA_ASTC_8x5_Format:()=>Py,RGBA_ASTC_8x6_Format:()=>Oy,RGBA_ASTC_8x8_Format:()=>_y,RGBA_BPTC_Format:()=>nA,RGBA_ETC2_EAC_Format:()=>Yy,RGBA_PVRTC_2BPPV1_Format:()=>Fy,RGBA_PVRTC_4BPPV1_Format:()=>Ey,RGBA_S3TC_DXT1_Format:()=>Vy,RGBA_S3TC_DXT3_Format:()=>Ny,RGBA_S3TC_DXT5_Format:()=>Xy,RGB_ETC1_Format:()=>Hy,RGB_ETC2_Format:()=>Jy,RGB_PVRTC_2BPPV1_Format:()=>Ty,RGB_PVRTC_4BPPV1_Format:()=>My,RGB_S3TC_DXT1_Format:()=>Wy,RGFormat:()=>ky,RGIntegerFormat:()=>By,RawShaderMaterial:()=>PR,Ray:()=>xS,Raycaster:()=>QV,RectAreaLight:()=>qW,RedFormat:()=>Zy,RedIntegerFormat:()=>wy,ReinhardToneMapping:()=>Jb,RepeatWrapping:()=>Qb,ReplaceStencilOp:()=>NA,ReverseSubtractEquation:()=>hb,RingBufferGeometry:()=>QN,RingGeometry:()=>TR,SIGNED_RED_GREEN_RGTC2_Format:()=>rA,SIGNED_RED_RGTC1_Format:()=>oA,SRGBColorSpace:()=>kA,Scene:()=>gk,ShaderChunk:()=>WG,ShaderLib:()=>NG,ShaderMaterial:()=>pG,ShadowMaterial:()=>UR,Shape:()=>aR,ShapeBufferGeometry:()=>jN,ShapeGeometry:()=>ER,ShapePath:()=>EN,ShapeUtils:()=>BR,ShortType:()=>uy,Skeleton:()=>Kk,SkeletonHelper:()=>uN,SkinnedMesh:()=>Hk,Source:()=>Ev,Sphere:()=>IS,SphereBufferGeometry:()=>qN,SphereGeometry:()=>FR,Spherical:()=>$V,SphericalHarmonics3:()=>$W,SplineCurve:()=>YB,SpotLight:()=>zW,SpotLightHelper:()=>sN,Sprite:()=>kk,SpriteMaterial:()=>pk,SrcAlphaFactor:()=>yb,SrcAlphaSaturateFactor:()=>Zb,SrcColorFactor:()=>fb,StaticCopyUsage:()=>$A,StaticDrawUsage:()=>PA,StaticReadUsage:()=>QA,StereoCamera:()=>fV,StreamCopyUsage:()=>tv,StreamDrawUsage:()=>_A,StreamReadUsage:()=>qA,StringKeyframeTrack:()=>bW,SubtractEquation:()=>db,SubtractiveBlending:()=>lb,TOUCH:()=>Uf,TangentSpaceNormalMap:()=>GA,TetrahedronBufferGeometry:()=>$N,TetrahedronGeometry:()=>HR,Texture:()=>Jv,TextureLoader:()=>MW,TorusBufferGeometry:()=>eX,TorusGeometry:()=>JR,TorusKnotBufferGeometry:()=>tX,TorusKnotGeometry:()=>YR,Triangle:()=>lx,TriangleFanDrawMode:()=>yA,TriangleStripDrawMode:()=>bA,TrianglesDrawMode:()=>fA,TubeBufferGeometry:()=>nX,TubeGeometry:()=>LR,TwoPassDoubleSide:()=>ob,UVMapping:()=>Kb,Uint16BufferAttribute:()=>Rx,Uint32BufferAttribute:()=>Vx,Uint8BufferAttribute:()=>wx,Uint8ClampedBufferAttribute:()=>kx,Uniform:()=>DV,UniformsGroup:()=>PV,UniformsLib:()=>VG,UniformsUtils:()=>hG,UnsignedByteType:()=>cy,UnsignedInt248Type:()=>by,UnsignedIntType:()=>py,UnsignedShort4444Type:()=>Cy,UnsignedShort5551Type:()=>fy,UnsignedShortType:()=>dy,VSMShadowMap:()=>eb,Vector2:()=>yv,Vector3:()=>_v,Vector4:()=>Yv,VectorKeyframeTrack:()=>yW,VideoTexture:()=>fB,WebGL1Renderer:()=>sk,WebGL3DRenderTarget:()=>Uv,WebGLArrayRenderTarget:()=>Kv,WebGLCubeRenderTarget:()=>yG,WebGLMultipleRenderTargets:()=>Pv,WebGLRenderTarget:()=>Lv,WebGLRenderer:()=>rk,WebGLUtils:()=>Qw,WireframeGeometry:()=>zR,WrapAroundEnding:()=>mA,ZeroCurvatureEnding:()=>hA,ZeroFactor:()=>Ib,ZeroSlopeEnding:()=>pA,ZeroStencilOp:()=>WA,_SRGBAFormat:()=>ov,sRGBEncoding:()=>vA});var t,a=n(2483),o=n.t(a,2),i=n(775);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(t||(t={}));const s="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function g(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,n,a){return void 0===n&&(n=null),r({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?h(t):t,{state:n,key:t&&t.key||a||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:n="",hash:a=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),a&&"#"!==a&&(t+="#"===a.charAt(0)?a:"#"+a),t}function h(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let a=e.indexOf("?");a>=0&&(t.search=e.substr(a),e=e.substr(0,a)),e&&(t.pathname=e)}return t}function p(e,n,a,o){void 0===o&&(o={});let{window:i=document.defaultView,v5Compat:c=!1}=o,h=i.history,p=t.Pop,m=null,I=C();function C(){return(h.state||{idx:null}).idx}function f(){p=t.Pop;let e=C(),n=null==e?null:e-I;I=e,m&&m({action:p,location:y.location,delta:n})}function b(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof e?e:d(e);return n=n.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==I&&(I=0,h.replaceState(r({},h.state,{idx:I}),""));let y={get action(){return p},get location(){return e(i,h)},listen(e){if(m)throw new Error("A history only accepts one active listener");return i.addEventListener(s,f),m=e,()=>{i.removeEventListener(s,f),m=null}},createHref:e=>n(i,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,n){p=t.Push;let o=u(y.location,e,n);a&&a(o,e),I=C()+1;let r=g(o,I),s=y.createHref(o);try{h.pushState(r,"",s)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;i.location.assign(s)}c&&m&&m({action:p,location:y.location,delta:1})},replace:function(e,n){p=t.Replace;let o=u(y.location,e,n);a&&a(o,e),I=C();let i=g(o,I),r=y.createHref(o);h.replaceState(i,"",r),c&&m&&m({action:p,location:y.location,delta:0})},go:e=>h.go(e)};return y}var m;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function I(e,t,n){void 0===n&&(n="/");let a=R(("string"===typeof t?h(t):t).pathname||"/",n);if(null==a)return null;let o=C(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(o);let i=null;for(let r=0;null==i&&r<o.length;++r){let e=B(a);i=w(o[r],e)}return i}function C(e,t,n,a){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===a&&(a="");let o=(e,o,i)=>{let r={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:o,route:e};r.relativePath.startsWith("/")&&(l(r.relativePath.startsWith(a),'Absolute route path "'+r.relativePath+'" nested under path "'+a+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),r.relativePath=r.relativePath.slice(a.length));let s=M([a,r.relativePath]),c=n.concat(r);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),C(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:Z(s,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let a of f(e.path))o(e,t,a);else o(e,t)})),t}function f(e){let t=e.split("/");if(0===t.length)return[];let[n,...a]=t,o=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===a.length)return o?[i,""]:[i];let r=f(a.join("/")),s=[];return s.push(...r.map((e=>""===e?i:[i,e].join("/")))),o&&s.push(...r),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const b=/^:[\w-]+$/,y=3,A=2,v=1,S=10,x=-2,G=e=>"*"===e;function Z(e,t){let n=e.split("/"),a=n.length;return n.some(G)&&(a+=x),t&&(a+=A),n.filter((e=>!G(e))).reduce(((e,t)=>e+(b.test(t)?y:""===t?v:S)),a)}function w(e,t){let{routesMeta:n}=e,a={},o="/",i=[];for(let r=0;r<n.length;++r){let e=n[r],s=r===n.length-1,l="/"===o?t:t.slice(o.length)||"/",c=k({path:e.relativePath,caseSensitive:e.caseSensitive,end:s},l);if(!c)return null;Object.assign(a,c.params);let g=e.route;i.push({params:a,pathname:M([o,c.pathname]),pathnameBase:T(M([o,c.pathnameBase])),route:g}),"/"!==c.pathnameBase&&(o=M([o,c.pathnameBase]))}return i}function k(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,a]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let a=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(a.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(a.push({paramName:"*"}),o+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==e&&"/"!==e&&(o+="(?:(?=\\/|$))");let i=new RegExp(o,t?void 0:"i");return[i,a]}(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let i=o[0],r=i.replace(/(.)\/+$/,"$1"),s=o.slice(1),l=a.reduce(((e,t,n)=>{let{paramName:a,isOptional:o}=t;if("*"===a){let e=s[n]||"";r=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const l=s[n];return e[a]=o&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{});return{params:l,pathname:i,pathnameBase:r,pattern:e}}function B(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function R(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,a=e.charAt(n);return a&&"/"!==a?null:e.slice(n)||"/"}function W(e,t,n,a){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(a)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function V(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function N(e,t){let n=V(e);return t?n.map(((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)):n.map((e=>e.pathnameBase))}function X(e,t,n,a){let o;void 0===a&&(a=!1),"string"===typeof e?o=h(e):(o=r({},e),l(!o.pathname||!o.pathname.includes("?"),W("?","pathname","search",o)),l(!o.pathname||!o.pathname.includes("#"),W("#","pathname","hash",o)),l(!o.search||!o.search.includes("#"),W("#","search","hash",o)));let i,s=""===e||""===o.pathname,c=s?"/":o.pathname;if(null==c)i=n;else{let e=t.length-1;if(!a&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}i=e>=0?t[e]:"/"}let g=function(e,t){void 0===t&&(t="/");let{pathname:n,search:a="",hash:o=""}="string"===typeof e?h(e):e,i=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:i,search:E(a),hash:F(o)}}(o,i),u=c&&"/"!==c&&c.endsWith("/"),d=(s||"."===c)&&n.endsWith("/");return g.pathname.endsWith("/")||!u&&!d||(g.pathname+="/"),g}const M=e=>e.join("/").replace(/\/\/+/g,"/"),T=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),E=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function H(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const J=["post","put","patch","delete"],Y=(new Set(J),["get",...J]);new Set(Y),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function L(){return L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},L.apply(this,arguments)}const z=a.createContext(null);const K=a.createContext(null);const D=a.createContext(null);const U=a.createContext(null);const P=a.createContext({outlet:null,matches:[],isDataRoute:!1});const O=a.createContext(null);function _(){return null!=a.useContext(U)}function Q(){return _()||l(!1),a.useContext(U).location}function j(e){a.useContext(D).static||a.useLayoutEffect(e)}function q(){let{isDataRoute:e}=a.useContext(P);return e?function(){let{router:e}=se(ie.UseNavigateStable),t=ce(re.UseNavigateStable),n=a.useRef(!1);j((()=>{n.current=!0}));let o=a.useCallback((function(a,o){void 0===o&&(o={}),n.current&&("number"===typeof a?e.navigate(a):e.navigate(a,L({fromRouteId:t},o)))}),[e,t]);return o}():function(){_()||l(!1);let e=a.useContext(z),{basename:t,future:n,navigator:o}=a.useContext(D),{matches:i}=a.useContext(P),{pathname:r}=Q(),s=JSON.stringify(N(i,n.v7_relativeSplatPath)),c=a.useRef(!1);j((()=>{c.current=!0}));let g=a.useCallback((function(n,a){if(void 0===a&&(a={}),!c.current)return;if("number"===typeof n)return void o.go(n);let i=X(n,JSON.parse(s),r,"path"===a.relative);null==e&&"/"!==t&&(i.pathname="/"===i.pathname?t:M([t,i.pathname])),(a.replace?o.replace:o.push)(i,a.state,a)}),[t,o,s,r,e]);return g}()}function $(e,n,o,i){_()||l(!1);let{navigator:r}=a.useContext(D),{matches:s}=a.useContext(P),c=s[s.length-1],g=c?c.params:{},u=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let d,p=Q();if(n){var m;let e="string"===typeof n?h(n):n;"/"===u||(null==(m=e.pathname)?void 0:m.startsWith(u))||l(!1),d=e}else d=p;let C=d.pathname||"/",f=C;if("/"!==u){let e=u.replace(/^\//,"").split("/");f="/"+C.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=I(e,{pathname:f});let y=oe(b&&b.map((e=>Object.assign({},e,{params:Object.assign({},g,e.params),pathname:M([u,r.encodeLocation?r.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:M([u,r.encodeLocation?r.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),s,o,i);return n&&y?a.createElement(U.Provider,{value:{location:L({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:t.Pop}},y):y}function ee(){let e=function(){var e;let t=a.useContext(O),n=le(re.UseRouteError),o=ce(re.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[o]}(),t=H(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:o};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},t),n?a.createElement("pre",{style:i},n):null,null)}const te=a.createElement(ee,null);class ne extends a.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?a.createElement(P.Provider,{value:this.props.routeContext},a.createElement(O.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ae(e){let{routeContext:t,match:n,children:o}=e,i=a.useContext(z);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),a.createElement(P.Provider,{value:t},o)}function oe(e,t,n,o){var i;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===o&&(o=null),null==e){var r;if(null==(r=n)||!r.errors)return null;e=n.matches}let s=e,c=null==(i=n)?void 0:i.errors;if(null!=c){let e=s.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||l(!1),s=s.slice(0,Math.min(s.length,e+1))}let g=!1,u=-1;if(n&&o&&o.v7_partialHydration)for(let a=0;a<s.length;a++){let e=s[a];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=a),e.route.id){let{loaderData:t,errors:a}=n,o=e.route.loader&&void 0===t[e.route.id]&&(!a||void 0===a[e.route.id]);if(e.route.lazy||o){g=!0,s=u>=0?s.slice(0,u+1):[s[0]];break}}}return s.reduceRight(((e,o,i)=>{let r,l=!1,d=null,h=null;var p;n&&(r=c&&o.route.id?c[o.route.id]:void 0,d=o.route.errorElement||te,g&&(u<0&&0===i?(p="route-fallback",!1||ge[p]||(ge[p]=!0),l=!0,h=null):u===i&&(l=!0,h=o.route.hydrateFallbackElement||null)));let m=t.concat(s.slice(0,i+1)),I=()=>{let t;return t=r?d:l?h:o.route.Component?a.createElement(o.route.Component,null):o.route.element?o.route.element:e,a.createElement(ae,{match:o,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(o.route.ErrorBoundary||o.route.errorElement||0===i)?a.createElement(ne,{location:n.location,revalidation:n.revalidation,component:d,error:r,children:I(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):I()}),null)}var ie=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ie||{}),re=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(re||{});function se(e){let t=a.useContext(z);return t||l(!1),t}function le(e){let t=a.useContext(K);return t||l(!1),t}function ce(e){let t=function(e){let t=a.useContext(P);return t||l(!1),t}(),n=t.matches[t.matches.length-1];return n.route.id||l(!1),n.route.id}const ge={};o.startTransition;function ue(e){l(!1)}function de(e){let{basename:n="/",children:o=null,location:i,navigationType:r=t.Pop,navigator:s,static:c=!1,future:g}=e;_()&&l(!1);let u=n.replace(/^\/*/,"/"),d=a.useMemo((()=>({basename:u,navigator:s,static:c,future:L({v7_relativeSplatPath:!1},g)})),[u,g,s,c]);"string"===typeof i&&(i=h(i));let{pathname:p="/",search:m="",hash:I="",state:C=null,key:f="default"}=i,b=a.useMemo((()=>{let e=R(p,u);return null==e?null:{location:{pathname:e,search:m,hash:I,state:C,key:f},navigationType:r}}),[u,p,m,I,C,f,r]);return null==b?null:a.createElement(D.Provider,{value:d},a.createElement(U.Provider,{children:o,value:b}))}function he(e){let{children:t,location:n}=e;return $(pe(t),n)}new Promise((()=>{}));a.Component;function pe(e,t){void 0===t&&(t=[]);let n=[];return a.Children.forEach(e,((e,o)=>{if(!a.isValidElement(e))return;let i=[...t,o];if(e.type===a.Fragment)return void n.push.apply(n,pe(e.props.children,i));e.type!==ue&&l(!1),e.props.index&&e.props.children&&l(!1);let r={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(r.children=pe(e.props.children,i)),n.push(r)})),n}var me=n(1097),Ie=n.n(me);function Ce(e,t){var n=Object.assign({},e);return Array.isArray(t)&&t.forEach((function(e){delete n[e]})),n}function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}var be=n(3808);function ye(e,t,n){var o=a.useRef({});return"value"in o.current&&!n(o.current.condition,t)||(o.current.value=e(),o.current.condition=t),o.current.value}var Ae=function(e,t){"function"===typeof e?e(t):"object"===fe(e)&&e&&"current"in e&&(e.current=t)},ve=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t.filter(Boolean);return a.length<=1?a[0]:function(e){t.forEach((function(t){Ae(t,e)}))}},Se=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ye((function(){return ve.apply(void 0,t)}),t,(function(e,t){return e.length!==t.length||e.every((function(e,n){return e!==t[n]}))}))},xe=function(e){var t,n,a=(0,be.isMemo)(e)?e.type.type:e.type;return!!("function"!==typeof a||null!==(t=a.prototype)&&void 0!==t&&t.render||a.$$typeof===be.ForwardRef)&&!!("function"!==typeof e||null!==(n=e.prototype)&&void 0!==n&&n.render||e.$$typeof===be.ForwardRef)};function Ge(e){return(0,a.isValidElement)(e)&&!(0,be.isFragment)(e)}Number(a.version.split(".")[0]);const Ze=function(e){if(!e)return!1;if(e instanceof Element){if(e.offsetParent)return!0;if(e.getBBox){var t=e.getBBox(),n=t.width,a=t.height;if(n||a)return!0}if(e.getBoundingClientRect){var o=e.getBoundingClientRect(),i=o.width,r=o.height;if(i||r)return!0}}return!1},we="anticon",ke=["outlined","borderless","filled"],Be=a.createContext({getPrefixCls:(e,t)=>t||(e?"ant-".concat(e):"ant"),iconPrefixCls:we}),{Consumer:Re}=Be;function We(e){return e&&a.isValidElement(e)&&e.type===a.Fragment}const Ve=(e,t,n)=>a.isValidElement(e)?a.cloneElement(e,"function"===typeof n?n(e.props||{}):n):t;function Ne(e,t){return Ve(e,e,t)}function Xe(e){var t=function(e,t){if("object"!=fe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=fe(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==fe(t)?t:t+""}function Me(e,t,n){return(t=Xe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Te(e){if(Array.isArray(e))return e}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function Fe(e,t){if(e){if("string"==typeof e)return Ee(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ee(e,t):void 0}}function He(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Je(e,t){return Te(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,o,i,r,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=i.call(n)).done)&&(s.push(a.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(c)throw o}}return s}}(e,t)||Fe(e,t)||He()}function Ye(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Le(e){return function(e){if(Array.isArray(e))return Ee(e)}(e)||Ye(e)||Fe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){Me(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const De=function(e){for(var t,n=0,a=0,o=e.length;o>=4;++a,o-=4)t=1540483477*(65535&(t=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(o){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)};function Ue(){return!("undefined"===typeof window||!window.document||!window.document.createElement)}function Pe(e,t){if(!e)return!1;if(e.contains)return e.contains(t);for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1}var Oe="data-rc-order",_e="data-rc-priority",Qe="rc-util-key",je=new Map;function qe(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).mark;return e?e.startsWith("data-")?e:"data-".concat(e):Qe}function $e(e){return e.attachTo?e.attachTo:document.querySelector("head")||document.body}function et(e){return Array.from((je.get(e)||e).children).filter((function(e){return"STYLE"===e.tagName}))}function tt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Ue())return null;var n=t.csp,a=t.prepend,o=t.priority,i=void 0===o?0:o,r=function(e){return"queue"===e?"prependQueue":e?"prepend":"append"}(a),s="prependQueue"===r,l=document.createElement("style");l.setAttribute(Oe,r),s&&i&&l.setAttribute(_e,"".concat(i)),null!==n&&void 0!==n&&n.nonce&&(l.nonce=null===n||void 0===n?void 0:n.nonce),l.innerHTML=e;var c=$e(t),g=c.firstChild;if(a){if(s){var u=(t.styles||et(c)).filter((function(e){if(!["prepend","prependQueue"].includes(e.getAttribute(Oe)))return!1;var t=Number(e.getAttribute(_e)||0);return i>=t}));if(u.length)return c.insertBefore(l,u[u.length-1].nextSibling),l}c.insertBefore(l,g)}else c.appendChild(l);return l}function nt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=$e(t);return(t.styles||et(n)).find((function(n){return n.getAttribute(qe(t))===e}))}function at(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=nt(e,t);n&&$e(t).removeChild(n)}function ot(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=$e(n),o=et(a),i=Ke(Ke({},n),{},{styles:o});!function(e,t){var n=je.get(e);if(!n||!Pe(document,n)){var a=tt("",t),o=a.parentNode;je.set(e,o),e.removeChild(a)}}(a,i);var r=nt(t,i);if(r){var s,l,c;if(null!==(s=i.csp)&&void 0!==s&&s.nonce&&r.nonce!==(null===(l=i.csp)||void 0===l?void 0:l.nonce))r.nonce=null===(c=i.csp)||void 0===c?void 0:c.nonce;return r.innerHTML!==e&&(r.innerHTML=e),r}var g=tt(e,i);return g.setAttribute(qe(i),t),g}var it={},rt=[];function st(e,t){}function lt(e,t){}function ct(e,t,n){t||it[n]||(e(!1,n),it[n]=!0)}function gt(e,t){ct(st,e,t)}gt.preMessage=function(e){rt.push(e)},gt.resetWarned=function(){it={}},gt.noteOnce=function(e,t){ct(lt,e,t)};const ut=gt;const dt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=new Set;return function e(t,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=a.has(t);if(ut(!r,"Warning: There may be circular references"),r)return!1;if(t===o)return!0;if(n&&i>1)return!1;a.add(t);var s=i+1;if(Array.isArray(t)){if(!Array.isArray(o)||t.length!==o.length)return!1;for(var l=0;l<t.length;l++)if(!e(t[l],o[l],s))return!1;return!0}if(t&&o&&"object"===fe(t)&&"object"===fe(o)){var c=Object.keys(t);return c.length===Object.keys(o).length&&c.every((function(n){return e(t[n],o[n],s)}))}return!1}(e,t)};function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Xe(a.key),a)}}function mt(e,t,n){return t&&pt(e.prototype,t),n&&pt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var It="%";function Ct(e){return e.join(It)}var ft=function(){function e(t){ht(this,e),Me(this,"instanceId",void 0),Me(this,"cache",new Map),this.instanceId=t}return mt(e,[{key:"get",value:function(e){return this.opGet(Ct(e))}},{key:"opGet",value:function(e){return this.cache.get(e)||null}},{key:"update",value:function(e,t){return this.opUpdate(Ct(e),t)}},{key:"opUpdate",value:function(e,t){var n=t(this.cache.get(e));null===n?this.cache.delete(e):this.cache.set(e,n)}}]),e}();const bt=ft;var yt="data-token-hash",At="data-css-hash",vt="__cssinjs_instance__";function St(){var e=Math.random().toString(12).slice(2);if("undefined"!==typeof document&&document.head&&document.body){var t=document.body.querySelectorAll("style[".concat(At,"]"))||[],n=document.head.firstChild;Array.from(t).forEach((function(t){t[vt]=t[vt]||e,t[vt]===e&&document.head.insertBefore(t,n)}));var a={};Array.from(document.querySelectorAll("style[".concat(At,"]"))).forEach((function(t){var n,o=t.getAttribute(At);a[o]?t[vt]===e&&(null===(n=t.parentNode)||void 0===n||n.removeChild(t)):a[o]=!0}))}return new bt(e)}var xt=a.createContext({hashPriority:"low",cache:St(),defaultCache:!0});const Gt=xt;function Zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e,t){return wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wt(e,t)}function kt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wt(e,t)}function Bt(e){return Bt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Bt(e)}function Rt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Rt=function(){return!!e})()}function Wt(e){var t=Rt();return function(){var n,a=Bt(e);if(t){var o=Bt(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return function(e,t){if(t&&("object"==fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Zt(e)}(this,n)}}const Vt=mt((function e(){ht(this,e)}));var Nt="CALC_UNIT",Xt=new RegExp(Nt,"g");function Mt(e){return"number"===typeof e?"".concat(e).concat(Nt):e}var Tt=function(e){kt(n,e);var t=Wt(n);function n(e,a){var o;ht(this,n),Me(Zt(o=t.call(this)),"result",""),Me(Zt(o),"unitlessCssVar",void 0),Me(Zt(o),"lowPriority",void 0);var i=fe(e);return o.unitlessCssVar=a,e instanceof n?o.result="(".concat(e.result,")"):"number"===i?o.result=Mt(e):"string"===i&&(o.result=e),o}return mt(n,[{key:"add",value:function(e){return e instanceof n?this.result="".concat(this.result," + ").concat(e.getResult()):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," + ").concat(Mt(e))),this.lowPriority=!0,this}},{key:"sub",value:function(e){return e instanceof n?this.result="".concat(this.result," - ").concat(e.getResult()):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," - ").concat(Mt(e))),this.lowPriority=!0,this}},{key:"mul",value:function(e){return this.lowPriority&&(this.result="(".concat(this.result,")")),e instanceof n?this.result="".concat(this.result," * ").concat(e.getResult(!0)):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," * ").concat(e)),this.lowPriority=!1,this}},{key:"div",value:function(e){return this.lowPriority&&(this.result="(".concat(this.result,")")),e instanceof n?this.result="".concat(this.result," / ").concat(e.getResult(!0)):"number"!==typeof e&&"string"!==typeof e||(this.result="".concat(this.result," / ").concat(e)),this.lowPriority=!1,this}},{key:"getResult",value:function(e){return this.lowPriority||e?"(".concat(this.result,")"):this.result}},{key:"equal",value:function(e){var t=this,n=(e||{}).unit,a=!0;return"boolean"===typeof n?a=n:Array.from(this.unitlessCssVar).some((function(e){return t.result.includes(e)}))&&(a=!1),this.result=this.result.replace(Xt,a?"px":""),"undefined"!==typeof this.lowPriority?"calc(".concat(this.result,")"):this.result}}]),n}(Vt),Et=function(e){kt(n,e);var t=Wt(n);function n(e){var a;return ht(this,n),Me(Zt(a=t.call(this)),"result",0),e instanceof n?a.result=e.result:"number"===typeof e&&(a.result=e),a}return mt(n,[{key:"add",value:function(e){return e instanceof n?this.result+=e.result:"number"===typeof e&&(this.result+=e),this}},{key:"sub",value:function(e){return e instanceof n?this.result-=e.result:"number"===typeof e&&(this.result-=e),this}},{key:"mul",value:function(e){return e instanceof n?this.result*=e.result:"number"===typeof e&&(this.result*=e),this}},{key:"div",value:function(e){return e instanceof n?this.result/=e.result:"number"===typeof e&&(this.result/=e),this}},{key:"equal",value:function(){return this.result}}]),n}(Vt);const Ft=function(e,t){var n="css"===e?Tt:Et;return function(e){return new n(e,t)}};var Ht=function(){function e(){ht(this,e),Me(this,"cache",void 0),Me(this,"keys",void 0),Me(this,"cacheCallTimes",void 0),this.cache=new Map,this.keys=[],this.cacheCallTimes=0}return mt(e,[{key:"size",value:function(){return this.keys.length}},{key:"internalGet",value:function(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={map:this.cache};return e.forEach((function(e){var t;o?o=null===(t=o)||void 0===t||null===(t=t.map)||void 0===t?void 0:t.get(e):o=void 0})),null!==(t=o)&&void 0!==t&&t.value&&a&&(o.value[1]=this.cacheCallTimes++),null===(n=o)||void 0===n?void 0:n.value}},{key:"get",value:function(e){var t;return null===(t=this.internalGet(e,!0))||void 0===t?void 0:t[0]}},{key:"has",value:function(e){return!!this.internalGet(e)}},{key:"set",value:function(t,n){var a=this;if(!this.has(t)){if(this.size()+1>e.MAX_CACHE_SIZE+e.MAX_CACHE_OFFSET){var o=this.keys.reduce((function(e,t){var n=Je(e,2)[1];return a.internalGet(t)[1]<n?[t,a.internalGet(t)[1]]:e}),[this.keys[0],this.cacheCallTimes]),i=Je(o,1)[0];this.delete(i)}this.keys.push(t)}var r=this.cache;t.forEach((function(e,o){if(o===t.length-1)r.set(e,{value:[n,a.cacheCallTimes++]});else{var i=r.get(e);i?i.map||(i.map=new Map):r.set(e,{map:new Map}),r=r.get(e).map}}))}},{key:"deleteByPath",value:function(e,t){var n,a=e.get(t[0]);if(1===t.length)return a.map?e.set(t[0],{map:a.map}):e.delete(t[0]),null===(n=a.value)||void 0===n?void 0:n[0];var o=this.deleteByPath(a.map,t.slice(1));return a.map&&0!==a.map.size||a.value||e.delete(t[0]),o}},{key:"delete",value:function(e){if(this.has(e))return this.keys=this.keys.filter((function(t){return!function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,e)})),this.deleteByPath(this.cache,e)}}]),e}();Me(Ht,"MAX_CACHE_SIZE",20),Me(Ht,"MAX_CACHE_OFFSET",5);var Jt=0,Yt=function(){function e(t){ht(this,e),Me(this,"derivatives",void 0),Me(this,"id",void 0),this.derivatives=Array.isArray(t)?t:[t],this.id=Jt,0===t.length&&t.length,Jt+=1}return mt(e,[{key:"getDerivativeToken",value:function(e){return this.derivatives.reduce((function(t,n){return n(e,t)}),void 0)}}]),e}(),Lt=new Ht;function zt(e){var t=Array.isArray(e)?e:[e];return Lt.has(t)||Lt.set(t,new Yt(t)),Lt.get(t)}var Kt=new WeakMap,Dt={};var Ut=new WeakMap;function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ut.get(e)||"";return n||(Object.keys(e).forEach((function(a){var o=e[a];n+=a,o instanceof Yt?n+=o.id:o&&"object"===fe(o)?n+=Pt(o,t):n+=o})),t&&(n=De(n)),Ut.set(e,n)),n}function Ot(e,t){return De("".concat(t,"_").concat(Pt(e,!0)))}"random-".concat(Date.now(),"-").concat(Math.random()).replace(/\./g,"");var _t=Ue();function Qt(e){return"number"===typeof e?"".concat(e,"px"):e}function jt(e,t,n){if(arguments.length>4&&void 0!==arguments[4]&&arguments[4])return e;var a=Ke(Ke({},arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),{},Me(Me({},yt,t),At,n)),o=Object.keys(a).map((function(e){var t=a[e];return t?"".concat(e,'="').concat(t,'"'):null})).filter((function(e){return e})).join(" ");return"<style ".concat(o,">").concat(e,"</style>")}var qt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"--".concat(t?"".concat(t,"-"):"").concat(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([A-Z]+)([A-Z][a-z0-9]+)/g,"$1-$2").replace(/([a-z])([A-Z0-9])/g,"$1-$2").toLowerCase()},$t=function(e,t,n){return Object.keys(e).length?".".concat(t).concat(null!==n&&void 0!==n&&n.scope?".".concat(n.scope):"","{").concat(Object.entries(e).map((function(e){var t=Je(e,2),n=t[0],a=t[1];return"".concat(n,":").concat(a,";")})).join(""),"}"):""},en=function(e,t,n){var a={},o={};return Object.entries(e).forEach((function(e){var t,i,r=Je(e,2),s=r[0],l=r[1];if(null!==n&&void 0!==n&&null!==(t=n.preserve)&&void 0!==t&&t[s])o[s]=l;else if(("string"===typeof l||"number"===typeof l)&&(null===n||void 0===n||null===(i=n.ignore)||void 0===i||!i[s])){var c,g=qt(s,null===n||void 0===n?void 0:n.prefix);a[g]="number"!==typeof l||null!==n&&void 0!==n&&null!==(c=n.unitless)&&void 0!==c&&c[s]?String(l):"".concat(l,"px"),o[s]="var(".concat(g,")")}})),[o,$t(a,t,{scope:null===n||void 0===n?void 0:n.scope})]},tn=Ue()?a.useLayoutEffect:a.useEffect,nn=function(e,t){var n=a.useRef(!0);tn((function(){return e(n.current)}),t),tn((function(){return n.current=!1,function(){n.current=!0}}),[])},an=function(e,t){nn((function(t){if(!t)return e()}),t)};const on=nn;var rn=Ke({},o).useInsertionEffect;const sn=rn?function(e,t,n){return rn((function(){return e(),t()}),n)}:function(e,t,n){a.useMemo(e,n),on((function(){return t(!0)}),n)};var ln="undefined"!==typeof Ke({},o).useInsertionEffect?function(e){var t=[],n=!1;return a.useEffect((function(){return n=!1,function(){n=!0,t.length&&t.forEach((function(e){return e()}))}}),e),function(e){n||t.push(e)}}:function(){return function(e){e()}};const cn=ln;const gn=function(){return!1};function un(e,t,n,o,i){var r=a.useContext(Gt).cache,s=Ct([e].concat(Le(t))),l=cn([s]),c=(gn(),function(e){r.opUpdate(s,(function(t){var a=Je(t||[void 0,void 0],2),o=a[0];var i=[void 0===o?0:o,a[1]||n()];return e?e(i):i}))});a.useMemo((function(){c()}),[s]);var g=r.opGet(s)[1];return sn((function(){null===i||void 0===i||i(g)}),(function(e){return c((function(t){var n=Je(t,2),a=n[0],o=n[1];return e&&0===a&&(null===i||void 0===i||i(g)),[a+1,o]})),function(){r.opUpdate(s,(function(t){var n=Je(t||[],2),a=n[0],i=void 0===a?0:a,c=n[1];return 0===i-1?(l((function(){!e&&r.opGet(s)||null===o||void 0===o||o(c,!1)})),null):[i-1,c]}))}}),[s]),g}var dn={},hn="css",pn=new Map;var mn=0;function In(e,t){pn.set(e,(pn.get(e)||0)-1);var n=Array.from(pn.keys()),a=n.filter((function(e){return(pn.get(e)||0)<=0}));n.length-a.length>mn&&a.forEach((function(e){!function(e,t){"undefined"!==typeof document&&document.querySelectorAll("style[".concat(yt,'="').concat(e,'"]')).forEach((function(e){var n;e[vt]===t&&(null===(n=e.parentNode)||void 0===n||n.removeChild(e))}))}(e,t),pn.delete(e)}))}var Cn=function(e,t,n,a){var o=Ke(Ke({},n.getDerivativeToken(e)),t);return a&&(o=a(o)),o},fn="token";function bn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,a.useContext)(Gt),i=o.cache.instanceId,r=o.container,s=n.salt,l=void 0===s?"":s,c=n.override,g=void 0===c?dn:c,u=n.formatToken,d=n.getComputedToken,h=n.cssVar,p=function(e,t){for(var n=Kt,a=0;a<t.length;a+=1){var o=t[a];n.has(o)||n.set(o,new WeakMap),n=n.get(o)}return n.has(Dt)||n.set(Dt,e()),n.get(Dt)}((function(){return Object.assign.apply(Object,[{}].concat(Le(t)))}),t),m=Pt(p),I=Pt(g),C=h?Pt(h):"",f=un(fn,[l,e.id,m,I,C],(function(){var t,n=d?d(p,g,e):Cn(p,g,e,u),a=Ke({},n),o="";if(h){var i=Je(en(n,h.key,{prefix:h.prefix,ignore:h.ignore,unitless:h.unitless,preserve:h.preserve}),2);n=i[0],o=i[1]}var r=Ot(n,l);n._tokenKey=r,a._tokenKey=Ot(a,l);var s=null!==(t=null===h||void 0===h?void 0:h.key)&&void 0!==t?t:r;n._themeKey=s,function(e){pn.set(e,(pn.get(e)||0)+1)}(s);var c="".concat(hn,"-").concat(De(r));return n._hashId=c,[n,c,a,o,(null===h||void 0===h?void 0:h.key)||""]}),(function(e){In(e[0]._themeKey,i)}),(function(e){var t=Je(e,4),n=t[0],a=t[3];if(h&&a){var o=ot(a,De("css-variables-".concat(n._themeKey)),{mark:At,prepend:"queue",attachTo:r,priority:-999});o[vt]=i,o.setAttribute(yt,n._themeKey)}}));return f}function yn(){return yn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},yn.apply(null,arguments)}const An={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};var vn="comm",Sn="rule",xn="decl",Gn="@import",Zn="@keyframes",wn="@layer",kn=Math.abs,Bn=String.fromCharCode;Object.assign;function Rn(e){return e.trim()}function Wn(e,t,n){return e.replace(t,n)}function Vn(e,t,n){return e.indexOf(t,n)}function Nn(e,t){return 0|e.charCodeAt(t)}function Xn(e,t,n){return e.slice(t,n)}function Mn(e){return e.length}function Tn(e,t){return t.push(e),e}function En(e,t){for(var n="",a=0;a<e.length;a++)n+=t(e[a],a,e,t)||"";return n}function Fn(e,t,n,a){switch(e.type){case wn:if(e.children.length)break;case Gn:case xn:return e.return=e.return||e.value;case vn:return"";case Zn:return e.return=e.value+"{"+En(e.children,a)+"}";case Sn:if(!Mn(e.value=e.props.join(",")))return""}return Mn(n=En(e.children,a))?e.return=e.value+"{"+n+"}":""}var Hn=1,Jn=1,Yn=0,Ln=0,zn=0,Kn="";function Dn(e,t,n,a,o,i,r,s){return{value:e,root:t,parent:n,type:a,props:o,children:i,line:Hn,column:Jn,length:r,return:"",siblings:s}}function Un(){return zn=Ln>0?Nn(Kn,--Ln):0,Jn--,10===zn&&(Jn=1,Hn--),zn}function Pn(){return zn=Ln<Yn?Nn(Kn,Ln++):0,Jn++,10===zn&&(Jn=1,Hn++),zn}function On(){return Nn(Kn,Ln)}function _n(){return Ln}function Qn(e,t){return Xn(Kn,e,t)}function jn(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function qn(e){return Hn=Jn=1,Yn=Mn(Kn=e),Ln=0,[]}function $n(e){return Kn="",e}function ea(e){return Rn(Qn(Ln-1,aa(91===e?e+2:40===e?e+1:e)))}function ta(e){for(;(zn=On())&&zn<33;)Pn();return jn(e)>2||jn(zn)>3?"":" "}function na(e,t){for(;--t&&Pn()&&!(zn<48||zn>102||zn>57&&zn<65||zn>70&&zn<97););return Qn(e,_n()+(t<6&&32==On()&&32==Pn()))}function aa(e){for(;Pn();)switch(zn){case e:return Ln;case 34:case 39:34!==e&&39!==e&&aa(zn);break;case 40:41===e&&aa(e);break;case 92:Pn()}return Ln}function oa(e,t){for(;Pn()&&e+zn!==57&&(e+zn!==84||47!==On()););return"/*"+Qn(t,Ln-1)+"*"+Bn(47===e?e:Pn())}function ia(e){for(;!jn(On());)Pn();return Qn(e,Ln)}function ra(e){return $n(sa("",null,null,null,[""],e=qn(e),0,[0],e))}function sa(e,t,n,a,o,i,r,s,l){for(var c=0,g=0,u=r,d=0,h=0,p=0,m=1,I=1,C=1,f=0,b="",y=o,A=i,v=a,S=b;I;)switch(p=f,f=Pn()){case 40:if(108!=p&&58==Nn(S,u-1)){-1!=Vn(S+=Wn(ea(f),"&","&\f"),"&\f",kn(c?s[c-1]:0))&&(C=-1);break}case 34:case 39:case 91:S+=ea(f);break;case 9:case 10:case 13:case 32:S+=ta(p);break;case 92:S+=na(_n()-1,7);continue;case 47:switch(On()){case 42:case 47:Tn(ca(oa(Pn(),_n()),t,n,l),l);break;default:S+="/"}break;case 123*m:s[c++]=Mn(S)*C;case 125*m:case 59:case 0:switch(f){case 0:case 125:I=0;case 59+g:-1==C&&(S=Wn(S,/\f/g,"")),h>0&&Mn(S)-u&&Tn(h>32?ga(S+";",a,n,u-1,l):ga(Wn(S," ","")+";",a,n,u-2,l),l);break;case 59:S+=";";default:if(Tn(v=la(S,t,n,c,g,o,s,b,y=[],A=[],u,i),i),123===f)if(0===g)sa(S,t,v,v,y,i,u,s,A);else switch(99===d&&110===Nn(S,3)?100:d){case 100:case 108:case 109:case 115:sa(e,v,v,a&&Tn(la(e,v,v,0,0,o,s,b,o,y=[],u,A),A),o,A,u,s,a?y:A);break;default:sa(S,v,v,v,[""],A,0,s,A)}}c=g=h=0,m=C=1,b=S="",u=r;break;case 58:u=1+Mn(S),h=p;default:if(m<1)if(123==f)--m;else if(125==f&&0==m++&&125==Un())continue;switch(S+=Bn(f),f*m){case 38:C=g>0?1:(S+="\f",-1);break;case 44:s[c++]=(Mn(S)-1)*C,C=1;break;case 64:45===On()&&(S+=ea(Pn())),d=On(),g=u=Mn(b=S+=ia(_n())),f++;break;case 45:45===p&&2==Mn(S)&&(m=0)}}return i}function la(e,t,n,a,o,i,r,s,l,c,g,u){for(var d=o-1,h=0===o?i:[""],p=function(e){return e.length}(h),m=0,I=0,C=0;m<a;++m)for(var f=0,b=Xn(e,d+1,d=kn(I=r[m])),y=e;f<p;++f)(y=Rn(I>0?h[f]+" "+b:Wn(b,/&\f/g,h[f])))&&(l[C++]=y);return Dn(e,t,n,0===o?Sn:s,l,c,g,u)}function ca(e,t,n,a){return Dn(e,t,n,vn,Bn(zn),Xn(e,2,-2),0,a)}function ga(e,t,n,a,o){return Dn(e,t,n,xn,Xn(e,0,a),Xn(e,a+1,-1),a,o)}var ua,da="data-ant-cssinjs-cache-path",ha="_FILE_STYLE__";var pa=!0;function ma(e){return function(){if(!ua&&(ua={},Ue())){var e=document.createElement("div");e.className=da,e.style.position="fixed",e.style.visibility="hidden",e.style.top="-9999px",document.body.appendChild(e);var t=getComputedStyle(e).content||"";(t=t.replace(/^"/,"").replace(/"$/,"")).split(";").forEach((function(e){var t=Je(e.split(":"),2),n=t[0],a=t[1];ua[n]=a}));var n,a=document.querySelector("style[".concat(da,"]"));a&&(pa=!1,null===(n=a.parentNode)||void 0===n||n.removeChild(a)),document.body.removeChild(e)}}(),!!ua[e]}var Ia="_multi_value_";function Ca(e){return En(ra(e),Fn).replace(/\{%%%\:[^;];}/g,";")}var fa=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{root:!0,parentSelectors:[]},o=a.root,i=a.injectHash,r=a.parentSelectors,s=n.hashId,l=n.layer,c=(n.path,n.hashPriority),g=n.transformers,u=void 0===g?[]:g,d=(n.linters,""),h={};function p(t){var a=t.getName(s);if(!h[a]){var o=Je(e(t.style,n,{root:!1,parentSelectors:r}),1)[0];h[a]="@keyframes ".concat(t.getName(s)).concat(o)}}var m=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.forEach((function(t){Array.isArray(t)?e(t,n):t&&n.push(t)})),n}(Array.isArray(t)?t:[t]);return m.forEach((function(t){var a="string"!==typeof t||o?t:{};if("string"===typeof a)d+="".concat(a,"\n");else if(a._keyframe)p(a);else{var l=u.reduce((function(e,t){var n;return(null===t||void 0===t||null===(n=t.visit)||void 0===n?void 0:n.call(t,e))||e}),a);Object.keys(l).forEach((function(t){var a=l[t];if("object"!==fe(a)||!a||"animationName"===t&&a._keyframe||function(e){return"object"===fe(e)&&e&&("_skip_check_"in e||Ia in e)}(a)){var g;function A(e,t){var n=e.replace(/[A-Z]/g,(function(e){return"-".concat(e.toLowerCase())})),a=t;An[e]||"number"!==typeof a||0===a||(a="".concat(a,"px")),"animationName"===e&&null!==t&&void 0!==t&&t._keyframe&&(p(t),a=t.getName(s)),d+="".concat(n,":").concat(a,";")}var u=null!==(g=null===a||void 0===a?void 0:a.value)&&void 0!==g?g:a;"object"===fe(a)&&null!==a&&void 0!==a&&a[Ia]&&Array.isArray(u)?u.forEach((function(e){A(t,e)})):A(t,u)}else{var m=!1,I=t.trim(),C=!1;(o||i)&&s?I.startsWith("@")?m=!0:I=function(e,t,n){if(!t)return e;var a=".".concat(t),o="low"===n?":where(".concat(a,")"):a,i=e.split(",").map((function(e){var t,n=e.trim().split(/\s+/),a=n[0]||"",i=(null===(t=a.match(/^\w+/))||void 0===t?void 0:t[0])||"";return[a="".concat(i).concat(o).concat(a.slice(i.length))].concat(Le(n.slice(1))).join(" ")}));return i.join(",")}(t,s,c):!o||s||"&"!==I&&""!==I||(I="",C=!0);var f=Je(e(a,n,{root:C,injectHash:m,parentSelectors:[].concat(Le(r),[I])}),2),b=f[0],y=f[1];h=Ke(Ke({},h),y),d+="".concat(I).concat(b)}}))}})),o?l&&(d="@layer ".concat(l.name," {").concat(d,"}"),l.dependencies&&(h["@layer ".concat(l.name)]=l.dependencies.map((function(e){return"@layer ".concat(e,", ").concat(l.name,";")})).join("\n"))):d="{".concat(d,"}"),[d,h]};function ba(e,t){return De("".concat(e.join("%")).concat(t))}function ya(){return null}var Aa="style";function va(e,t){var n=e.token,o=e.path,i=e.hashId,r=e.layer,s=e.nonce,l=e.clientOnly,c=e.order,g=void 0===c?0:c,u=a.useContext(Gt),d=u.autoClear,h=(u.mock,u.defaultCache),p=u.hashPriority,m=u.container,I=u.ssrInline,C=u.transformers,f=u.linters,b=u.cache,y=u.layer,A=n._tokenKey,v=[A];y&&v.push("layer"),v.push.apply(v,Le(o));var S=_t;var x=un(Aa,v,(function(){var e=v.join("|");if(ma(e)){var n=function(e){var t=ua[e],n=null;if(t&&Ue())if(pa)n=ha;else{var a=document.querySelector("style[".concat(At,'="').concat(ua[e],'"]'));a?n=a.innerHTML:delete ua[e]}return[n,t]}(e),a=Je(n,2),s=a[0],c=a[1];if(s)return[s,A,c,{},l,g]}var u=t(),d=Je(fa(u,{hashId:i,hashPriority:p,layer:y?r:void 0,path:o.join("-"),transformers:C,linters:f}),2),h=d[0],m=d[1],I=Ca(h),b=ba(v,I);return[I,A,b,m,l,g]}),(function(e,t){var n=Je(e,3)[2];(t||d)&&_t&&at(n,{mark:At})}),(function(e){var t=Je(e,4),n=t[0],a=(t[1],t[2]),o=t[3];if(S&&n!==ha){var i={mark:At,prepend:!y&&"queue",attachTo:m,priority:g},r="function"===typeof s?s():s;r&&(i.csp={nonce:r});var l=[],c=[];Object.keys(o).forEach((function(e){e.startsWith("@layer")?l.push(e):c.push(e)})),l.forEach((function(e){ot(Ca(o[e]),"_layer-".concat(e),Ke(Ke({},i),{},{prepend:!0}))}));var u=ot(n,a,i);u[vt]=b.instanceId,u.setAttribute(yt,A),c.forEach((function(e){ot(Ca(o[e]),"_effect-".concat(e),i)}))}})),G=Je(x,3),Z=G[0],w=G[1],k=G[2];return function(e){var t;return t=I&&!S&&h?a.createElement("style",yn({},Me(Me({},yt,w),At,k),{dangerouslySetInnerHTML:{__html:Z}})):a.createElement(ya,null),a.createElement(a.Fragment,null,t,e)}}var Sa="cssVar";const xa=function(e,t){var n=e.key,o=e.prefix,i=e.unitless,r=e.ignore,s=e.token,l=e.scope,c=void 0===l?"":l,g=(0,a.useContext)(Gt),u=g.cache.instanceId,d=g.container,h=s._tokenKey,p=[].concat(Le(e.path),[n,c,h]),m=un(Sa,p,(function(){var e=t(),a=Je(en(e,n,{prefix:o,unitless:i,ignore:r,scope:c}),2),s=a[0],l=a[1];return[s,l,ba(p,l),n]}),(function(e){var t=Je(e,3)[2];_t&&at(t,{mark:At})}),(function(e){var t=Je(e,3),a=t[1],o=t[2];if(a){var i=ot(a,o,{mark:At,prepend:"queue",attachTo:d,priority:-999});i[vt]=u,i.setAttribute(yt,n)}}));return m};Me(Me(Me({},Aa,(function(e,t,n){var a=Je(e,6),o=a[0],i=a[1],r=a[2],s=a[3],l=a[4],c=a[5],g=(n||{}).plain;if(l)return null;var u=o,d={"data-rc-order":"prependQueue","data-rc-priority":"".concat(c)};return u=jt(o,i,r,d,g),s&&Object.keys(s).forEach((function(e){if(!t[e]){t[e]=!0;var n=jt(Ca(s[e]),i,"_effect-".concat(e),d,g);e.startsWith("@layer")?u=n+u:u+=n}})),[c,r,u]})),fn,(function(e,t,n){var a=Je(e,5),o=a[2],i=a[3],r=a[4],s=(n||{}).plain;if(!i)return null;var l=o._tokenKey;return[-999,l,jt(i,r,l,{"data-rc-order":"prependQueue","data-rc-priority":"".concat(-999)},s)]})),Sa,(function(e,t,n){var a=Je(e,4),o=a[1],i=a[2],r=a[3],s=(n||{}).plain;if(!o)return null;return[-999,i,jt(o,r,i,{"data-rc-order":"prependQueue","data-rc-priority":"".concat(-999)},s)]}));var Ga=function(){function e(t,n){ht(this,e),Me(this,"name",void 0),Me(this,"style",void 0),Me(this,"_keyframe",!0),this.name=t,this.style=n}return mt(e,[{key:"getName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?"".concat(e,"-").concat(this.name):this.name}}]),e}();const Za=Ga;function wa(e){return e.notSplit=!0,e}wa(["borderTop","borderBottom"]),wa(["borderTop"]),wa(["borderBottom"]),wa(["borderLeft","borderRight"]),wa(["borderLeft"]),wa(["borderRight"]);function ka(e){var t=a.useRef();t.current=e;var n=a.useCallback((function(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return null===(e=t.current)||void 0===e?void 0:e.call.apply(e,[t].concat(a))}),[]);return n}function Ba(e){var t=a.useRef(!1),n=Je(a.useState(e),2),o=n[0],i=n[1];return a.useEffect((function(){return t.current=!1,function(){t.current=!0}}),[]),[o,function(e,n){n&&t.current||i(e)}]}function Ra(e){return void 0!==e}function Wa(e,t){var n=t||{},a=n.defaultValue,o=n.value,i=n.onChange,r=n.postState,s=Je(Ba((function(){return Ra(o)?o:Ra(a)?"function"===typeof a?a():a:"function"===typeof e?e():e})),2),l=s[0],c=s[1],g=void 0!==o?o:l,u=r?r(g):g,d=ka(i),h=Je(Ba([g]),2),p=h[0],m=h[1];return an((function(){var e=p[0];l!==e&&d(l,e)}),[p]),an((function(){Ra(o)||c(o)}),[o]),[u,ka((function(e,t){c(e,t),m([g],t)}))]}function Va(e){return Te(e)||Ye(e)||Fe(e)||He()}function Na(e,t){for(var n=e,a=0;a<t.length;a+=1){if(null===n||void 0===n)return;n=n[t[a]]}return n}function Xa(e,t,n,a){if(!t.length)return n;var o,i=Va(t),r=i[0],s=i.slice(1);return o=e||"number"!==typeof r?Array.isArray(e)?Le(e):Ke({},e):[],a&&void 0===n&&1===s.length?delete o[r][s[0]]:o[r]=Xa(o[r],s,n,a),o}function Ma(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.length&&a&&void 0===n&&!Na(e,t.slice(0,-1))?e:Xa(e,t,n,a)}function Ta(e){return Array.isArray(e)?[]:{}}var Ea="undefined"===typeof Reflect?Object.keys:Reflect.ownKeys;function Fa(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=Ta(t[0]);return t.forEach((function(e){!function t(n,o){var i,r=new Set(o),s=Na(e,n),l=Array.isArray(s);if(l||"object"===fe(i=s)&&null!==i&&Object.getPrototypeOf(i)===Object.prototype){if(!r.has(s)){r.add(s);var c=Na(a,n);l?a=Ma(a,n,[]):c&&"object"===fe(c)||(a=Ma(a,n,Ta(s))),Ea(s).forEach((function(e){t([].concat(Le(n),[e]),r)}))}}else a=Ma(a,n,s)}([])})),a}let Ha=function(){return mt((function e(){ht(this,e),this.map=new Map,this.objectIDMap=new WeakMap,this.nextID=0,this.lastAccessBeat=new Map,this.accessBeat=0}),[{key:"set",value:function(e,t){this.clear();const n=this.getCompositeKey(e);this.map.set(n,t),this.lastAccessBeat.set(n,Date.now())}},{key:"get",value:function(e){const t=this.getCompositeKey(e),n=this.map.get(t);return this.lastAccessBeat.set(t,Date.now()),this.accessBeat+=1,n}},{key:"getCompositeKey",value:function(e){return e.map((e=>e&&"object"===typeof e?"obj_".concat(this.getObjectID(e)):"".concat(typeof e,"_").concat(e))).join("|")}},{key:"getObjectID",value:function(e){if(this.objectIDMap.has(e))return this.objectIDMap.get(e);const t=this.nextID;return this.objectIDMap.set(e,t),this.nextID+=1,t}},{key:"clear",value:function(){if(this.accessBeat>1e4){const e=Date.now();this.lastAccessBeat.forEach(((t,n)=>{e-t>6e5&&(this.map.delete(n),this.lastAccessBeat.delete(n))})),this.accessBeat=0}}}])}();const Ja=new Ha;const Ya=function(e,t){return a.useMemo((()=>{const n=Ja.get(t);if(n)return n;const a=e();return Ja.set(t,a),a}),t)},La={overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},za=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{boxSizing:"border-box",margin:0,padding:0,color:e.colorText,fontSize:e.fontSize,lineHeight:e.lineHeight,listStyle:"none",fontFamily:t?"inherit":e.fontFamily}},Ka=e=>({a:{color:e.colorLink,textDecoration:e.linkDecoration,backgroundColor:"transparent",outline:"none",cursor:"pointer",transition:"color ".concat(e.motionDurationSlow),"-webkit-text-decoration-skip":"objects","&:hover":{color:e.colorLinkHover},"&:active":{color:e.colorLinkActive},"&:active, &:hover":{textDecoration:e.linkHoverDecoration,outline:0},"&:focus":{textDecoration:e.linkFocusDecoration,outline:0},"&[disabled]":{color:e.colorTextDisabled,cursor:"not-allowed"}}}),Da=(e,t,n,a)=>{const o='[class^="'.concat(t,'"], [class*=" ').concat(t,'"]'),i=n?".".concat(n):o,r={boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"}};let s={};return!1!==a&&(s={fontFamily:e.fontFamily,fontSize:e.fontSize}),{[i]:Object.assign(Object.assign(Object.assign({},s),r),{[o]:r})}},Ua=e=>({outline:"".concat(Qt(e.lineWidthFocus)," solid ").concat(e.colorPrimaryBorder),outlineOffset:1,transition:"outline-offset 0s, outline 0s"}),Pa=e=>({"&:focus-visible":Object.assign({},Ua(e))}),Oa="5.19.0";function _a(e,t){(function(e){return"string"===typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"===typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function Qa(e){return Math.min(1,Math.max(0,e))}function ja(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function qa(e){return e<=1?"".concat(100*Number(e),"%"):e}function $a(e){return 1===e.length?"0"+e:String(e)}function eo(e,t,n){e=_a(e,255),t=_a(t,255),n=_a(n,255);var a=Math.max(e,t,n),o=Math.min(e,t,n),i=0,r=0,s=(a+o)/2;if(a===o)r=0,i=0;else{var l=a-o;switch(r=s>.5?l/(2-a-o):l/(a+o),a){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return{h:i,s:r,l:s}}function to(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function no(e,t,n){e=_a(e,255),t=_a(t,255),n=_a(n,255);var a=Math.max(e,t,n),o=Math.min(e,t,n),i=0,r=a,s=a-o,l=0===a?0:s/a;if(a===o)i=0;else{switch(a){case e:i=(t-n)/s+(t<n?6:0);break;case t:i=(n-e)/s+2;break;case n:i=(e-t)/s+4}i/=6}return{h:i,s:l,v:r}}function ao(e,t,n,a){var o=[$a(Math.round(e).toString(16)),$a(Math.round(t).toString(16)),$a(Math.round(n).toString(16))];return a&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function oo(e){return Math.round(255*parseFloat(e)).toString(16)}function io(e){return ro(e)/255}function ro(e){return parseInt(e,16)}var so={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function lo(e){var t={r:0,g:0,b:0},n=1,a=null,o=null,i=null,r=!1,s=!1;return"string"===typeof e&&(e=function(e){if(e=e.trim().toLowerCase(),0===e.length)return!1;var t=!1;if(so[e])e=so[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=ho.rgb.exec(e);if(n)return{r:n[1],g:n[2],b:n[3]};if(n=ho.rgba.exec(e),n)return{r:n[1],g:n[2],b:n[3],a:n[4]};if(n=ho.hsl.exec(e),n)return{h:n[1],s:n[2],l:n[3]};if(n=ho.hsla.exec(e),n)return{h:n[1],s:n[2],l:n[3],a:n[4]};if(n=ho.hsv.exec(e),n)return{h:n[1],s:n[2],v:n[3]};if(n=ho.hsva.exec(e),n)return{h:n[1],s:n[2],v:n[3],a:n[4]};if(n=ho.hex8.exec(e),n)return{r:ro(n[1]),g:ro(n[2]),b:ro(n[3]),a:io(n[4]),format:t?"name":"hex8"};if(n=ho.hex6.exec(e),n)return{r:ro(n[1]),g:ro(n[2]),b:ro(n[3]),format:t?"name":"hex"};if(n=ho.hex4.exec(e),n)return{r:ro(n[1]+n[1]),g:ro(n[2]+n[2]),b:ro(n[3]+n[3]),a:io(n[4]+n[4]),format:t?"name":"hex8"};if(n=ho.hex3.exec(e),n)return{r:ro(n[1]+n[1]),g:ro(n[2]+n[2]),b:ro(n[3]+n[3]),format:t?"name":"hex"};return!1}(e)),"object"===typeof e&&(po(e.r)&&po(e.g)&&po(e.b)?(t=function(e,t,n){return{r:255*_a(e,255),g:255*_a(t,255),b:255*_a(n,255)}}(e.r,e.g,e.b),r=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):po(e.h)&&po(e.s)&&po(e.v)?(a=qa(e.s),o=qa(e.v),t=function(e,t,n){e=6*_a(e,360),t=_a(t,100),n=_a(n,100);var a=Math.floor(e),o=e-a,i=n*(1-t),r=n*(1-o*t),s=n*(1-(1-o)*t),l=a%6;return{r:255*[n,r,i,i,s,n][l],g:255*[s,n,n,r,i,i][l],b:255*[i,i,s,n,n,r][l]}}(e.h,a,o),r=!0,s="hsv"):po(e.h)&&po(e.s)&&po(e.l)&&(a=qa(e.s),i=qa(e.l),t=function(e,t,n){var a,o,i;if(e=_a(e,360),t=_a(t,100),n=_a(n,100),0===t)o=n,i=n,a=n;else{var r=n<.5?n*(1+t):n+t-n*t,s=2*n-r;a=to(s,r,e+1/3),o=to(s,r,e),i=to(s,r,e-1/3)}return{r:255*a,g:255*o,b:255*i}}(e.h,a,i),r=!0,s="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(n=e.a)),n=ja(n),{ok:r,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}var co="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),go="[\\s|\\(]+(".concat(co,")[,|\\s]+(").concat(co,")[,|\\s]+(").concat(co,")\\s*\\)?"),uo="[\\s|\\(]+(".concat(co,")[,|\\s]+(").concat(co,")[,|\\s]+(").concat(co,")[,|\\s]+(").concat(co,")\\s*\\)?"),ho={CSS_UNIT:new RegExp(co),rgb:new RegExp("rgb"+go),rgba:new RegExp("rgba"+uo),hsl:new RegExp("hsl"+go),hsla:new RegExp("hsla"+uo),hsv:new RegExp("hsv"+go),hsva:new RegExp("hsva"+uo),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function po(e){return Boolean(ho.CSS_UNIT.exec(String(e)))}var mo=2,Io=.16,Co=.05,fo=.05,bo=.15,yo=5,Ao=4,vo=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function So(e){var t=no(e.r,e.g,e.b);return{h:360*t.h,s:t.s,v:t.v}}function xo(e){var t=e.r,n=e.g,a=e.b;return"#".concat(ao(t,n,a,!1))}function Go(e,t,n){var a;return(a=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-mo*t:Math.round(e.h)+mo*t:n?Math.round(e.h)+mo*t:Math.round(e.h)-mo*t)<0?a+=360:a>=360&&(a-=360),a}function Zo(e,t,n){return 0===e.h&&0===e.s?e.s:((a=n?e.s-Io*t:t===Ao?e.s+Io:e.s+Co*t)>1&&(a=1),n&&t===yo&&a>.1&&(a=.1),a<.06&&(a=.06),Number(a.toFixed(2)));var a}function wo(e,t,n){var a;return(a=n?e.v+fo*t:e.v-bo*t)>1&&(a=1),Number(a.toFixed(2))}function ko(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],a=lo(e),o=yo;o>0;o-=1){var i=So(a),r=xo(lo({h:Go(i,o,!0),s:Zo(i,o,!0),v:wo(i,o,!0)}));n.push(r)}n.push(xo(a));for(var s=1;s<=Ao;s+=1){var l=So(a),c=xo(lo({h:Go(l,s),s:Zo(l,s),v:wo(l,s)}));n.push(c)}return"dark"===t.theme?vo.map((function(e){var a=e.index,o=e.opacity;return xo(function(e,t,n){var a=n/100;return{r:(t.r-e.r)*a+e.r,g:(t.g-e.g)*a+e.g,b:(t.b-e.b)*a+e.b}}(lo(t.backgroundColor||"#141414"),lo(n[a]),100*o))})):n}var Bo={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},Ro={},Wo={};Object.keys(Bo).forEach((function(e){Ro[e]=ko(Bo[e]),Ro[e].primary=Ro[e][5],Wo[e]=ko(Bo[e],{theme:"dark",backgroundColor:"#141414"}),Wo[e].primary=Wo[e][5]}));Ro.red,Ro.volcano;var Vo=Ro.gold,No=(Ro.orange,Ro.yellow,Ro.lime,Ro.green,Ro.cyan,Ro.blue);Ro.geekblue,Ro.purple,Ro.magenta,Ro.grey,Ro.grey;const Xo={blue:"#1677ff",purple:"#722ED1",cyan:"#13C2C2",green:"#52C41A",magenta:"#EB2F96",pink:"#eb2f96",red:"#F5222D",orange:"#FA8C16",yellow:"#FADB14",volcano:"#FA541C",geekblue:"#2F54EB",gold:"#FAAD14",lime:"#A0D911"},Mo=Object.assign(Object.assign({},Xo),{colorPrimary:"#1677ff",colorSuccess:"#52c41a",colorWarning:"#faad14",colorError:"#ff4d4f",colorInfo:"#1677ff",colorLink:"",colorTextBase:"",colorBgBase:"",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,\n'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',\n'Noto Color Emoji'",fontFamilyCode:"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace",fontSize:14,lineWidth:1,lineType:"solid",motionUnit:.1,motionBase:0,motionEaseOutCirc:"cubic-bezier(0.08, 0.82, 0.17, 1)",motionEaseInOutCirc:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",motionEaseOut:"cubic-bezier(0.215, 0.61, 0.355, 1)",motionEaseInOut:"cubic-bezier(0.645, 0.045, 0.355, 1)",motionEaseOutBack:"cubic-bezier(0.12, 0.4, 0.29, 1.46)",motionEaseInBack:"cubic-bezier(0.71, -0.46, 0.88, 0.6)",motionEaseInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",motionEaseOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",borderRadius:6,sizeUnit:4,sizeStep:4,sizePopupArrow:16,controlHeight:32,zIndexBase:0,zIndexPopupBase:1e3,opacityImage:1,wireframe:!1,motion:!0});var To=function(){function e(t,n){var a;if(void 0===t&&(t=""),void 0===n&&(n={}),t instanceof e)return t;"number"===typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var o=lo(t);this.originalInput=t,this.r=o.r,this.g=o.g,this.b=o.b,this.a=o.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(a=n.format)&&void 0!==a?a:o.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=o.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,n=e.g/255,a=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=ja(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var e=no(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=no(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),a=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(n,"%, ").concat(a,"%)"):"hsva(".concat(t,", ").concat(n,"%, ").concat(a,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=eo(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=eo(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),a=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(n,"%, ").concat(a,"%)"):"hsla(".concat(t,", ").concat(n,"%, ").concat(a,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),ao(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,n,a,o){var i=[$a(Math.round(e).toString(16)),$a(Math.round(t).toString(16)),$a(Math.round(n).toString(16)),$a(oo(a))];return o&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))&&i[3].startsWith(i[3].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toHexShortString=function(e){return void 0===e&&(e=!1),1===this.a?this.toHexString(e):this.toHex8String(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(n,")"):"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*_a(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*_a(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+ao(this.r,this.g,this.b,!1),t=0,n=Object.entries(so);t<n.length;t++){var a=n[t],o=a[0];if(e===a[1])return o}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!==e&&void 0!==e?e:this.format;var n=!1,a=this.a<1&&this.a>=0;return t||!a||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l+=t/100,n.l=Qa(n.l),new e(n)},e.prototype.brighten=function(t){void 0===t&&(t=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),new e(n)},e.prototype.darken=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l-=t/100,n.l=Qa(n.l),new e(n)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s-=t/100,n.s=Qa(n.s),new e(n)},e.prototype.saturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s+=t/100,n.s=Qa(n.s),new e(n)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var n=this.toHsl(),a=(n.h+t)%360;return n.h=a<0?360+a:a,new e(n)},e.prototype.mix=function(t,n){void 0===n&&(n=50);var a=this.toRgb(),o=new e(t).toRgb(),i=n/100;return new e({r:(o.r-a.r)*i+a.r,g:(o.g-a.g)*i+a.g,b:(o.b-a.b)*i+a.b,a:(o.a-a.a)*i+a.a})},e.prototype.analogous=function(t,n){void 0===t&&(t=6),void 0===n&&(n=30);var a=this.toHsl(),o=360/n,i=[this];for(a.h=(a.h-(o*t>>1)+720)%360;--t;)a.h=(a.h+o)%360,i.push(new e(a));return i},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var n=this.toHsv(),a=n.h,o=n.s,i=n.v,r=[],s=1/t;t--;)r.push(new e({h:a,s:o,v:i})),i=(i+s)%1;return r},e.prototype.splitcomplement=function(){var t=this.toHsl(),n=t.h;return[this,new e({h:(n+72)%360,s:t.s,l:t.l}),new e({h:(n+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var n=this.toRgb(),a=new e(t).toRgb(),o=n.a+a.a*(1-n.a);return new e({r:(n.r*n.a+a.r*a.a*(1-n.a))/o,g:(n.g*n.a+a.g*a.a*(1-n.a))/o,b:(n.b*n.a+a.b*a.a*(1-n.a))/o,a:o})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var n=this.toHsl(),a=n.h,o=[this],i=360/t,r=1;r<t;r++)o.push(new e({h:(a+r*i)%360,s:n.s,l:n.l}));return o},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();const Eo=e=>{let t=e,n=e,a=e,o=e;return e<6&&e>=5?t=e+1:e<16&&e>=6?t=e+2:e>=16&&(t=16),e<7&&e>=5?n=4:e<8&&e>=7?n=5:e<14&&e>=8?n=6:e<16&&e>=14?n=7:e>=16&&(n=8),e<6&&e>=2?a=1:e>=6&&(a=2),e>4&&e<8?o=4:e>=8&&(o=6),{borderRadius:e,borderRadiusXS:a,borderRadiusSM:n,borderRadiusLG:t,borderRadiusOuter:o}};const Fo=e=>{const{controlHeight:t}=e;return{controlHeightSM:.75*t,controlHeightXS:.5*t,controlHeightLG:1.25*t}};function Ho(e){return(e+8)/e}const Jo=e=>{const t=function(e){const t=new Array(10).fill(null).map(((t,n)=>{const a=n-1,o=e*Math.pow(Math.E,a/5),i=n>1?Math.floor(o):Math.ceil(o);return 2*Math.floor(i/2)}));return t[1]=e,t.map((e=>({size:e,lineHeight:Ho(e)})))}(e),n=t.map((e=>e.size)),a=t.map((e=>e.lineHeight)),o=n[1],i=n[0],r=n[2],s=a[1],l=a[0],c=a[2];return{fontSizeSM:i,fontSize:o,fontSizeLG:r,fontSizeXL:n[3],fontSizeHeading1:n[6],fontSizeHeading2:n[5],fontSizeHeading3:n[4],fontSizeHeading4:n[3],fontSizeHeading5:n[2],lineHeight:s,lineHeightLG:c,lineHeightSM:l,fontHeight:Math.round(s*o),fontHeightLG:Math.round(c*r),fontHeightSM:Math.round(l*i),lineHeightHeading1:a[6],lineHeightHeading2:a[5],lineHeightHeading3:a[4],lineHeightHeading4:a[3],lineHeightHeading5:a[2]}};const Yo=(e,t)=>new To(e).setAlpha(t).toRgbString(),Lo=(e,t)=>new To(e).darken(t).toHexString(),zo=e=>{const t=ko(e);return{1:t[0],2:t[1],3:t[2],4:t[3],5:t[4],6:t[5],7:t[6],8:t[4],9:t[5],10:t[6]}},Ko=(e,t)=>{const n=e||"#fff",a=t||"#000";return{colorBgBase:n,colorTextBase:a,colorText:Yo(a,.88),colorTextSecondary:Yo(a,.65),colorTextTertiary:Yo(a,.45),colorTextQuaternary:Yo(a,.25),colorFill:Yo(a,.15),colorFillSecondary:Yo(a,.06),colorFillTertiary:Yo(a,.04),colorFillQuaternary:Yo(a,.02),colorBgLayout:Lo(n,4),colorBgContainer:Lo(n,0),colorBgElevated:Lo(n,0),colorBgSpotlight:Yo(a,.85),colorBgBlur:"transparent",colorBorder:Lo(n,15),colorBorderSecondary:Lo(n,6)}};const Do=zt((function(e){const t=Object.keys(Xo).map((t=>{const n=ko(e[t]);return new Array(10).fill(1).reduce(((e,a,o)=>(e["".concat(t,"-").concat(o+1)]=n[o],e["".concat(t).concat(o+1)]=n[o],e)),{})})).reduce(((e,t)=>e=Object.assign(Object.assign({},e),t)),{});return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),t),function(e,t){let{generateColorPalettes:n,generateNeutralColorPalettes:a}=t;const{colorSuccess:o,colorWarning:i,colorError:r,colorInfo:s,colorPrimary:l,colorBgBase:c,colorTextBase:g}=e,u=n(l),d=n(o),h=n(i),p=n(r),m=n(s),I=a(c,g),C=n(e.colorLink||e.colorInfo);return Object.assign(Object.assign({},I),{colorPrimaryBg:u[1],colorPrimaryBgHover:u[2],colorPrimaryBorder:u[3],colorPrimaryBorderHover:u[4],colorPrimaryHover:u[5],colorPrimary:u[6],colorPrimaryActive:u[7],colorPrimaryTextHover:u[8],colorPrimaryText:u[9],colorPrimaryTextActive:u[10],colorSuccessBg:d[1],colorSuccessBgHover:d[2],colorSuccessBorder:d[3],colorSuccessBorderHover:d[4],colorSuccessHover:d[4],colorSuccess:d[6],colorSuccessActive:d[7],colorSuccessTextHover:d[8],colorSuccessText:d[9],colorSuccessTextActive:d[10],colorErrorBg:p[1],colorErrorBgHover:p[2],colorErrorBgActive:p[3],colorErrorBorder:p[3],colorErrorBorderHover:p[4],colorErrorHover:p[5],colorError:p[6],colorErrorActive:p[7],colorErrorTextHover:p[8],colorErrorText:p[9],colorErrorTextActive:p[10],colorWarningBg:h[1],colorWarningBgHover:h[2],colorWarningBorder:h[3],colorWarningBorderHover:h[4],colorWarningHover:h[4],colorWarning:h[6],colorWarningActive:h[7],colorWarningTextHover:h[8],colorWarningText:h[9],colorWarningTextActive:h[10],colorInfoBg:m[1],colorInfoBgHover:m[2],colorInfoBorder:m[3],colorInfoBorderHover:m[4],colorInfoHover:m[4],colorInfo:m[6],colorInfoActive:m[7],colorInfoTextHover:m[8],colorInfoText:m[9],colorInfoTextActive:m[10],colorLinkHover:C[4],colorLink:C[6],colorLinkActive:C[7],colorBgMask:new To("#000").setAlpha(.45).toRgbString(),colorWhite:"#fff"})}(e,{generateColorPalettes:zo,generateNeutralColorPalettes:Ko})),Jo(e.fontSize)),function(e){const{sizeUnit:t,sizeStep:n}=e;return{sizeXXL:t*(n+8),sizeXL:t*(n+4),sizeLG:t*(n+2),sizeMD:t*(n+1),sizeMS:t*n,size:t*n,sizeSM:t*(n-1),sizeXS:t*(n-2),sizeXXS:t*(n-3)}}(e)),Fo(e)),function(e){const{motionUnit:t,motionBase:n,borderRadius:a,lineWidth:o}=e;return Object.assign({motionDurationFast:"".concat((n+t).toFixed(1),"s"),motionDurationMid:"".concat((n+2*t).toFixed(1),"s"),motionDurationSlow:"".concat((n+3*t).toFixed(1),"s"),lineWidthBold:o+1},Eo(a))}(e))})),Uo={token:Mo,override:{override:Mo},hashed:!0},Po=a.createContext(Uo);function Oo(e){return e>=0&&e<=255}const _o=function(e,t){const{r:n,g:a,b:o,a:i}=new To(e).toRgb();if(i<1)return e;const{r:r,g:s,b:l}=new To(t).toRgb();for(let c=.01;c<=1;c+=.01){const e=Math.round((n-r*(1-c))/c),t=Math.round((a-s*(1-c))/c),i=Math.round((o-l*(1-c))/c);if(Oo(e)&&Oo(t)&&Oo(i))return new To({r:e,g:t,b:i,a:Math.round(100*c)/100}).toRgbString()}return new To({r:n,g:a,b:o,a:1}).toRgbString()};var Qo=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};function jo(e){const{override:t}=e,n=Qo(e,["override"]),a=Object.assign({},t);Object.keys(Mo).forEach((e=>{delete a[e]}));const o=Object.assign(Object.assign({},n),a),i=1200,r=1600;if(!1===o.motion){const e="0s";o.motionDurationFast=e,o.motionDurationMid=e,o.motionDurationSlow=e}return Object.assign(Object.assign(Object.assign({},o),{colorFillContent:o.colorFillSecondary,colorFillContentHover:o.colorFill,colorFillAlter:o.colorFillQuaternary,colorBgContainerDisabled:o.colorFillTertiary,colorBorderBg:o.colorBgContainer,colorSplit:_o(o.colorBorderSecondary,o.colorBgContainer),colorTextPlaceholder:o.colorTextQuaternary,colorTextDisabled:o.colorTextQuaternary,colorTextHeading:o.colorText,colorTextLabel:o.colorTextSecondary,colorTextDescription:o.colorTextTertiary,colorTextLightSolid:o.colorWhite,colorHighlight:o.colorError,colorBgTextHover:o.colorFillSecondary,colorBgTextActive:o.colorFill,colorIcon:o.colorTextTertiary,colorIconHover:o.colorText,colorErrorOutline:_o(o.colorErrorBg,o.colorBgContainer),colorWarningOutline:_o(o.colorWarningBg,o.colorBgContainer),fontSizeIcon:o.fontSizeSM,lineWidthFocus:4*o.lineWidth,lineWidth:o.lineWidth,controlOutlineWidth:2*o.lineWidth,controlInteractiveSize:o.controlHeight/2,controlItemBgHover:o.colorFillTertiary,controlItemBgActive:o.colorPrimaryBg,controlItemBgActiveHover:o.colorPrimaryBgHover,controlItemBgActiveDisabled:o.colorFill,controlTmpOutline:o.colorFillQuaternary,controlOutline:_o(o.colorPrimaryBg,o.colorBgContainer),lineType:o.lineType,borderRadius:o.borderRadius,borderRadiusXS:o.borderRadiusXS,borderRadiusSM:o.borderRadiusSM,borderRadiusLG:o.borderRadiusLG,fontWeightStrong:600,opacityLoading:.65,linkDecoration:"none",linkHoverDecoration:"none",linkFocusDecoration:"none",controlPaddingHorizontal:12,controlPaddingHorizontalSM:8,paddingXXS:o.sizeXXS,paddingXS:o.sizeXS,paddingSM:o.sizeSM,padding:o.size,paddingMD:o.sizeMD,paddingLG:o.sizeLG,paddingXL:o.sizeXL,paddingContentHorizontalLG:o.sizeLG,paddingContentVerticalLG:o.sizeMS,paddingContentHorizontal:o.sizeMS,paddingContentVertical:o.sizeSM,paddingContentHorizontalSM:o.size,paddingContentVerticalSM:o.sizeXS,marginXXS:o.sizeXXS,marginXS:o.sizeXS,marginSM:o.sizeSM,margin:o.size,marginMD:o.sizeMD,marginLG:o.sizeLG,marginXL:o.sizeXL,marginXXL:o.sizeXXL,boxShadow:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowSecondary:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowTertiary:"\n      0 1px 2px 0 rgba(0, 0, 0, 0.03),\n      0 1px 6px -1px rgba(0, 0, 0, 0.02),\n      0 2px 4px 0 rgba(0, 0, 0, 0.02)\n    ",screenXS:480,screenXSMin:480,screenXSMax:575,screenSM:576,screenSMMin:576,screenSMMax:767,screenMD:768,screenMDMin:768,screenMDMax:991,screenLG:992,screenLGMin:992,screenLGMax:1199,screenXL:i,screenXLMin:i,screenXLMax:1599,screenXXL:r,screenXXLMin:r,boxShadowPopoverArrow:"2px 2px 5px rgba(0, 0, 0, 0.05)",boxShadowCard:"\n      0 1px 2px -2px ".concat(new To("rgba(0, 0, 0, 0.16)").toRgbString(),",\n      0 3px 6px 0 ").concat(new To("rgba(0, 0, 0, 0.12)").toRgbString(),",\n      0 5px 12px 4px ").concat(new To("rgba(0, 0, 0, 0.09)").toRgbString(),"\n    "),boxShadowDrawerRight:"\n      -6px 0 16px 0 rgba(0, 0, 0, 0.08),\n      -3px 0 6px -4px rgba(0, 0, 0, 0.12),\n      -9px 0 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerLeft:"\n      6px 0 16px 0 rgba(0, 0, 0, 0.08),\n      3px 0 6px -4px rgba(0, 0, 0, 0.12),\n      9px 0 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerUp:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerDown:"\n      0 -6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 -3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 -9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowTabsOverflowLeft:"inset 10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowRight:"inset -10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowTop:"inset 0 10px 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowBottom:"inset 0 -10px 8px -8px rgba(0, 0, 0, 0.08)"}),a)}var qo=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const $o={lineHeight:!0,lineHeightSM:!0,lineHeightLG:!0,lineHeightHeading1:!0,lineHeightHeading2:!0,lineHeightHeading3:!0,lineHeightHeading4:!0,lineHeightHeading5:!0,opacityLoading:!0,fontWeightStrong:!0,zIndexPopupBase:!0,zIndexBase:!0},ei={size:!0,sizeSM:!0,sizeLG:!0,sizeMD:!0,sizeXS:!0,sizeXXS:!0,sizeMS:!0,sizeXL:!0,sizeXXL:!0,sizeUnit:!0,sizeStep:!0,motionBase:!0,motionUnit:!0},ti={screenXS:!0,screenXSMin:!0,screenXSMax:!0,screenSM:!0,screenSMMin:!0,screenSMMax:!0,screenMD:!0,screenMDMin:!0,screenMDMax:!0,screenLG:!0,screenLGMin:!0,screenLGMax:!0,screenXL:!0,screenXLMin:!0,screenXLMax:!0,screenXXL:!0,screenXXLMin:!0},ni=(e,t,n)=>{const a=n.getDerivativeToken(e),{override:o}=t,i=qo(t,["override"]);let r=Object.assign(Object.assign({},a),{override:o});return r=jo(r),i&&Object.entries(i).forEach((e=>{let[t,n]=e;const{theme:a}=n,o=qo(n,["theme"]);let i=o;a&&(i=ni(Object.assign(Object.assign({},r),o),{override:o},a)),r[t]=i})),r};function ai(){const{token:e,hashed:t,theme:n,override:o,cssVar:i}=a.useContext(Po),r="".concat(Oa,"-").concat(t||""),s=n||Do,[l,c,g]=bn(s,[Mo,e],{salt:r,override:o,getComputedToken:ni,formatToken:jo,cssVar:i&&{prefix:i.prefix,key:i.key,unitless:$o,ignore:ei,preserve:ti}});return[s,g,t?c:"",l,i]}const oi="undefined"!==typeof CSSINJS_STATISTIC;let ii=!0;function ri(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!oi)return Object.assign.apply(Object,[{}].concat(t));ii=!1;const a={};return t.forEach((e=>{Object.keys(e).forEach((t=>{Object.defineProperty(a,t,{configurable:!0,enumerable:!0,get:()=>e[t]})}))})),ii=!0,a}const si={};function li(){}const ci=e=>{let t,n=e,a=li;return oi&&"undefined"!==typeof Proxy&&(t=new Set,n=new Proxy(e,{get:(e,n)=>(ii&&t.add(n),e[n])}),a=(e,n)=>{var a;si[e]={global:Array.from(t),component:Object.assign(Object.assign({},null===(a=si[e])||void 0===a?void 0:a.component),n)}}),{token:n,keys:t,flush:a}},gi=(e,t)=>{const[n,a]=ai();return va({theme:n,token:a,hashId:"",path:["ant-design-icons",e],nonce:()=>null===t||void 0===t?void 0:t.nonce,layer:{name:"antd"}},(()=>[{[".".concat(e)]:Object.assign(Object.assign({},{display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),{[".".concat(e," .").concat(e,"-icon")]:{display:"block"}})}]))},ui=(e,t,n)=>{var a;return"function"===typeof n?n(ri(t,null!==(a=t[e])&&void 0!==a?a:{})):null!==n&&void 0!==n?n:{}},di=(e,t,n,a)=>{const o=Object.assign({},t[e]);if(null===a||void 0===a?void 0:a.deprecatedTokens){const{deprecatedTokens:e}=a;e.forEach((e=>{let[t,n]=e;var a;((null===o||void 0===o?void 0:o[t])||(null===o||void 0===o?void 0:o[n]))&&(null!==(a=o[n])&&void 0!==a||(o[n]=null===o||void 0===o?void 0:o[t]))}))}const i=Object.assign(Object.assign({},n),o);return Object.keys(i).forEach((e=>{i[e]===t[e]&&delete i[e]})),i},hi=(e,t)=>"".concat([t,e.replace(/([A-Z]+)([A-Z][a-z]+)/g,"$1-$2").replace(/([a-z])([A-Z])/g,"$1-$2")].filter(Boolean).join("-"));function pi(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=Array.isArray(e)?e:[e,e],[r]=i,s=i.join("-");return function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const[l,c,g,u,d]=ai(),{getPrefixCls:h,iconPrefixCls:p,csp:m}=(0,a.useContext)(Be),I=h(),C=d?"css":"js",f=Ya((()=>{const e=new Set;return d&&Object.keys(o.unitless||{}).forEach((t=>{e.add(qt(t,d.prefix)),e.add(qt(t,hi(r,d.prefix)))})),Ft(C,e)}),[C,r,null===d||void 0===d?void 0:d.prefix]),{max:b,min:y}=function(e){return"js"===e?{max:Math.max,min:Math.min}:{max:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"max(".concat(t.map((e=>Qt(e))).join(","),")")},min:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"min(".concat(t.map((e=>Qt(e))).join(","),")")}}}(C),A={theme:l,token:u,hashId:g,nonce:()=>null===m||void 0===m?void 0:m.nonce,clientOnly:o.clientOnly,layer:{name:"antd"},order:o.order||-999};va(Object.assign(Object.assign({},A),{clientOnly:!1,path:["Shared",I]}),(()=>[{"&":Ka(u)}])),gi(p,m);return[va(Object.assign(Object.assign({},A),{path:[s,e,p]}),(()=>{if(!1===o.injectStyle)return[];const{token:a,flush:s}=ci(u),l=ui(r,c,n),h=".".concat(e),m=di(r,c,l,{deprecatedTokens:o.deprecatedTokens});d&&Object.keys(l).forEach((e=>{l[e]="var(".concat(qt(e,hi(r,d.prefix)),")")}));const C=ri(a,{componentCls:h,prefixCls:e,iconCls:".".concat(p),antCls:".".concat(I),calc:f,max:b,min:y},d?l:m),A=t(C,{hashId:g,prefixCls:e,rootPrefixCls:I,iconPrefixCls:p});return s(r,m),[!1===o.resetStyle?null:Da(C,e,i,o.resetFont),A]})),g]}}const mi=(e,t,n,a)=>{const o=pi(e,t,n,Object.assign({resetStyle:!1,order:-998},a));return e=>{let{prefixCls:t,rootCls:n=t}=e;return o(t,n),null}},Ii=(e,t,n,o)=>{const i=Array.isArray(e)?e[0]:e;function r(e){return"".concat(i).concat(e.slice(0,1).toUpperCase()).concat(e.slice(1))}const s=(null===o||void 0===o?void 0:o.unitless)||{},l=Object.assign(Object.assign({},$o),{[r("zIndexPopup")]:!0});Object.keys(s).forEach((e=>{l[r(e)]=s[e]}));const c=Object.assign(Object.assign({},o),{unitless:l,prefixToken:r}),g=pi(e,t,n,c),u=((e,t,n)=>{const{unitless:o,injectStyle:i=!0,prefixToken:r}=n,s=a=>{let{rootCls:i,cssVar:s}=a;const[,l]=ai();return xa({path:[e],prefix:s.prefix,key:null===s||void 0===s?void 0:s.key,unitless:o,ignore:ei,token:l,scope:i},(()=>{const a=ui(e,l,t),o=di(e,l,a,{deprecatedTokens:null===n||void 0===n?void 0:n.deprecatedTokens});return Object.keys(a).forEach((e=>{o[r(e)]=o[e],delete o[e]})),o})),null};return t=>{const[,,,,n]=ai();return[o=>i&&n?a.createElement(a.Fragment,null,a.createElement(s,{rootCls:t,cssVar:n,component:e}),o):o,null===n||void 0===n?void 0:n.key]}})(i,n,c);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const[,n]=g(e,t),[a,o]=u(t);return[a,n,o]}},Ci=e=>{const{componentCls:t,colorPrimary:n}=e;return{[t]:{position:"absolute",background:"transparent",pointerEvents:"none",boxSizing:"border-box",color:"var(--wave-color, ".concat(n,")"),boxShadow:"0 0 0 0 currentcolor",opacity:.2,"&.wave-motion-appear":{transition:["box-shadow 0.4s ".concat(e.motionEaseOutCirc),"opacity 2s ".concat(e.motionEaseOutCirc)].join(","),"&-active":{boxShadow:"0 0 0 6px currentcolor",opacity:0},"&.wave-quick":{transition:["box-shadow ".concat(e.motionDurationSlow," ").concat(e.motionEaseInOut),"opacity ".concat(e.motionDurationSlow," ").concat(e.motionEaseInOut)].join(",")}}}}},fi=pi("Wave",(e=>[Ci(e)]));var bi=function(e){return+setTimeout(e,16)},yi=function(e){return clearTimeout(e)};"undefined"!==typeof window&&"requestAnimationFrame"in window&&(bi=function(e){return window.requestAnimationFrame(e)},yi=function(e){return window.cancelAnimationFrame(e)});var Ai=0,vi=new Map;function Si(e){vi.delete(e)}var xi=function(e){var t=Ai+=1;return function n(a){if(0===a)Si(t),e();else{var o=bi((function(){n(a-1)}));vi.set(t,o)}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),t};xi.cancel=function(e){var t=vi.get(e);return Si(e),yi(t)};const Gi=xi;const Zi=(0,a.createContext)({});function wi(){}const ki=a.createContext({}),Bi=()=>{const e=()=>{};return e.deprecated=wi,e},Ri=(0,a.createContext)(void 0);const Wi={items_per_page:"/ page",jump_to:"Go to",jump_to_confirm:"confirm",page:"Page",prev_page:"Previous Page",next_page:"Next Page",prev_5:"Previous 5 Pages",next_5:"Next 5 Pages",prev_3:"Previous 3 Pages",next_3:"Next 3 Pages",page_size:"Page Size"};const Vi={locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"OK",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",yearFormat:"YYYY",dateFormat:"M/D/YYYY",dayFormat:"D",dateTimeFormat:"M/D/YYYY HH:mm:ss",monthBeforeYear:!0,previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"},Ni={placeholder:"Select time",rangePlaceholder:["Start time","End time"]},Xi={lang:Object.assign({placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeQuarterPlaceholder:["Start quarter","End quarter"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"]},Vi),timePickerLocale:Object.assign({},Ni)},Mi="${label} is not a valid ${type}",Ti={locale:"en",Pagination:Wi,DatePicker:Xi,TimePicker:Ni,Calendar:Xi,global:{placeholder:"Please select"},Table:{filterTitle:"Filter menu",filterConfirm:"OK",filterReset:"Reset",filterEmptyText:"No filters",filterCheckall:"Select all items",filterSearchPlaceholder:"Search in filters",emptyText:"No data",selectAll:"Select current page",selectInvert:"Invert current page",selectNone:"Clear all data",selectionAll:"Select all data",sortTitle:"Sort",expand:"Expand row",collapse:"Collapse row",triggerDesc:"Click to sort descending",triggerAsc:"Click to sort ascending",cancelSort:"Click to cancel sorting"},Tour:{Next:"Next",Previous:"Previous",Finish:"Finish"},Modal:{okText:"OK",cancelText:"Cancel",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancel"},Transfer:{titles:["",""],searchPlaceholder:"Search here",itemUnit:"item",itemsUnit:"items",remove:"Remove",selectCurrent:"Select current page",removeCurrent:"Remove current page",selectAll:"Select all data",deselectAll:"Deselect all data",removeAll:"Remove all data",selectInvert:"Invert current page"},Upload:{uploading:"Uploading...",removeFile:"Remove file",uploadError:"Upload error",previewFile:"Preview file",downloadFile:"Download file"},Empty:{description:"No data"},Icon:{icon:"icon"},Text:{edit:"Edit",copy:"Copy",copied:"Copied",expand:"Expand",collapse:"Collapse"},Form:{optional:"(optional)",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:Mi,method:Mi,array:Mi,object:Mi,number:Mi,date:Mi,boolean:Mi,integer:Mi,float:Mi,regexp:Mi,email:Mi,url:Mi,hex:Mi},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},Image:{preview:"Preview"},QRCode:{expired:"QR code expired",refresh:"Refresh",scanned:"Scanned"},ColorPicker:{presetEmpty:"Empty"}};let Ei=Object.assign({},Ti.Modal),Fi=[];const Hi=()=>Fi.reduce(((e,t)=>Object.assign(Object.assign({},e),t)),Ti.Modal);function Ji(){return Ei}const Yi=(0,a.createContext)(void 0);const Li=e=>{const{locale:t={},children:n,_ANT_MARK__:o}=e;a.useEffect((()=>{const e=function(e){if(e){const t=Object.assign({},e);return Fi.push(t),Ei=Hi(),()=>{Fi=Fi.filter((e=>e!==t)),Ei=Hi()}}Ei=Object.assign({},Ti.Modal)}(null===t||void 0===t?void 0:t.Modal);return e}),[t]);const i=a.useMemo((()=>Object.assign(Object.assign({},t),{exist:!0})),[t]);return a.createElement(Yi.Provider,{value:i},n)},zi="-ant-".concat(Date.now(),"-").concat(Math.random());function Ki(e,t){const n=function(e,t){const n={},a=(e,t)=>{let n=e.clone();return n=(null===t||void 0===t?void 0:t(n))||n,n.toRgbString()},o=(e,t)=>{const o=new To(e),i=ko(o.toRgbString());n["".concat(t,"-color")]=a(o),n["".concat(t,"-color-disabled")]=i[1],n["".concat(t,"-color-hover")]=i[4],n["".concat(t,"-color-active")]=i[6],n["".concat(t,"-color-outline")]=o.clone().setAlpha(.2).toRgbString(),n["".concat(t,"-color-deprecated-bg")]=i[0],n["".concat(t,"-color-deprecated-border")]=i[2]};if(t.primaryColor){o(t.primaryColor,"primary");const e=new To(t.primaryColor),i=ko(e.toRgbString());i.forEach(((e,t)=>{n["primary-".concat(t+1)]=e})),n["primary-color-deprecated-l-35"]=a(e,(e=>e.lighten(35))),n["primary-color-deprecated-l-20"]=a(e,(e=>e.lighten(20))),n["primary-color-deprecated-t-20"]=a(e,(e=>e.tint(20))),n["primary-color-deprecated-t-50"]=a(e,(e=>e.tint(50))),n["primary-color-deprecated-f-12"]=a(e,(e=>e.setAlpha(.12*e.getAlpha())));const r=new To(i[0]);n["primary-color-active-deprecated-f-30"]=a(r,(e=>e.setAlpha(.3*e.getAlpha()))),n["primary-color-active-deprecated-d-02"]=a(r,(e=>e.darken(2)))}t.successColor&&o(t.successColor,"success"),t.warningColor&&o(t.warningColor,"warning"),t.errorColor&&o(t.errorColor,"error"),t.infoColor&&o(t.infoColor,"info");const i=Object.keys(n).map((t=>"--".concat(e,"-").concat(t,": ").concat(n[t],";")));return"\n  :root {\n    ".concat(i.join("\n"),"\n  }\n  ").trim()}(e,t);Ue()&&ot(n,"".concat(zi,"-dynamic-theme"))}const Di=a.createContext(!1),Ui=e=>{let{children:t,disabled:n}=e;const o=a.useContext(Di);return a.createElement(Di.Provider,{value:null!==n&&void 0!==n?n:o},t)},Pi=Di,Oi=a.createContext(void 0),_i=e=>{let{children:t,size:n}=e;const o=a.useContext(Oi);return a.createElement(Oi.Provider,{value:n||o},t)},Qi=Oi;const ji=function(){return{componentDisabled:(0,a.useContext)(Pi),componentSize:(0,a.useContext)(Qi)}},qi=Object.assign({},o),{useId:$i}=qi,er="undefined"===typeof $i?()=>"":$i;var tr=n(9998),nr=n.t(tr,2);function ar(e){return e instanceof HTMLElement||e instanceof SVGElement}function or(e){var t,n=function(e){return e&&"object"===fe(e)&&ar(e.nativeElement)?e.nativeElement:ar(e)?e:null}(e);return n||(e instanceof a.Component?null===(t=tr.findDOMNode)||void 0===t?void 0:t.call(tr,e):null)}function ir(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var rr=["children"],sr=a.createContext({});function lr(e){var t=e.children,n=ir(e,rr);return a.createElement(sr.Provider,{value:n},t)}const cr=function(e){kt(n,e);var t=Wt(n);function n(){return ht(this,n),t.apply(this,arguments)}return mt(n,[{key:"render",value:function(){return this.props.children}}]),n}(a.Component);var gr="none",ur="appear",dr="enter",hr="leave",pr="none",mr="prepare",Ir="start",Cr="active",fr="end",br="prepared";function yr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit".concat(e)]="webkit".concat(t),n["Moz".concat(e)]="moz".concat(t),n["ms".concat(e)]="MS".concat(t),n["O".concat(e)]="o".concat(t.toLowerCase()),n}var Ar=function(e,t){var n={animationend:yr("Animation","AnimationEnd"),transitionend:yr("Transition","TransitionEnd")};return e&&("AnimationEvent"in t||delete n.animationend.animation,"TransitionEvent"in t||delete n.transitionend.transition),n}(Ue(),"undefined"!==typeof window?window:{}),vr={};if(Ue()){var Sr=document.createElement("div");vr=Sr.style}var xr={};function Gr(e){if(xr[e])return xr[e];var t=Ar[e];if(t)for(var n=Object.keys(t),a=n.length,o=0;o<a;o+=1){var i=n[o];if(Object.prototype.hasOwnProperty.call(t,i)&&i in vr)return xr[e]=t[i],xr[e]}return""}var Zr=Gr("animationend"),wr=Gr("transitionend"),kr=!(!Zr||!wr),Br=Zr||"animationend",Rr=wr||"transitionend";function Wr(e,t){if(!e)return null;if("object"===fe(e)){var n=t.replace(/-\w/g,(function(e){return e[1].toUpperCase()}));return e[n]}return"".concat(e,"-").concat(t)}const Vr=function(e){var t=(0,a.useRef)();function n(t){t&&(t.removeEventListener(Rr,e),t.removeEventListener(Br,e))}return a.useEffect((function(){return function(){n(t.current)}}),[]),[function(a){t.current&&t.current!==a&&n(t.current),a&&a!==t.current&&(a.addEventListener(Rr,e),a.addEventListener(Br,e),t.current=a)},n]};const Nr=Ue()?a.useLayoutEffect:a.useEffect;var Xr=[mr,Ir,Cr,fr],Mr=[mr,br],Tr=!1,Er=!0;function Fr(e){return e===Cr||e===fr}const Hr=function(e,t,n){var o=Je(Ba(pr),2),i=o[0],r=o[1],s=function(){var e=a.useRef(null);function t(){Gi.cancel(e.current)}return a.useEffect((function(){return function(){t()}}),[]),[function n(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;t();var i=Gi((function(){o<=1?a({isCanceled:function(){return i!==e.current}}):n(a,o-1)}));e.current=i},t]}(),l=Je(s,2),c=l[0],g=l[1];var u=t?Mr:Xr;return Nr((function(){if(i!==pr&&i!==fr){var e=u.indexOf(i),t=u[e+1],a=n(i);a===Tr?r(t,!0):t&&c((function(e){function n(){e.isCanceled()||r(t,!0)}!0===a?n():Promise.resolve(a).then(n)}))}}),[e,i]),a.useEffect((function(){return function(){g()}}),[]),[function(){r(mr,!0)},i]};function Jr(e,t,n,o){var i=o.motionEnter,r=void 0===i||i,s=o.motionAppear,l=void 0===s||s,c=o.motionLeave,g=void 0===c||c,u=o.motionDeadline,d=o.motionLeaveImmediately,h=o.onAppearPrepare,p=o.onEnterPrepare,m=o.onLeavePrepare,I=o.onAppearStart,C=o.onEnterStart,f=o.onLeaveStart,b=o.onAppearActive,y=o.onEnterActive,A=o.onLeaveActive,v=o.onAppearEnd,S=o.onEnterEnd,x=o.onLeaveEnd,G=o.onVisibleChanged,Z=Je(Ba(),2),w=Z[0],k=Z[1],B=function(e){var t=a.useReducer((function(e){return e+1}),0),n=Je(t,2)[1],o=a.useRef(e);return[ka((function(){return o.current})),ka((function(e){o.current="function"===typeof e?e(o.current):e,n()}))]}(gr),R=Je(B,2),W=R[0],V=R[1],N=Je(Ba(null),2),X=N[0],M=N[1],T=W(),E=(0,a.useRef)(!1),F=(0,a.useRef)(null);function H(){return n()}var J=(0,a.useRef)(!1);function Y(){V(gr),M(null,!0)}var L=ka((function(e){var t=W();if(t!==gr){var n=H();if(!e||e.deadline||e.target===n){var a,o=J.current;t===ur&&o?a=null===v||void 0===v?void 0:v(n,e):t===dr&&o?a=null===S||void 0===S?void 0:S(n,e):t===hr&&o&&(a=null===x||void 0===x?void 0:x(n,e)),o&&!1!==a&&Y()}}})),z=Je(Vr(L),1)[0],K=function(e){switch(e){case ur:return Me(Me(Me({},mr,h),Ir,I),Cr,b);case dr:return Me(Me(Me({},mr,p),Ir,C),Cr,y);case hr:return Me(Me(Me({},mr,m),Ir,f),Cr,A);default:return{}}},D=a.useMemo((function(){return K(T)}),[T]),U=Je(Hr(T,!e,(function(e){if(e===mr){var t=D[mr];return t?t(H()):Tr}var n;O in D&&M((null===(n=D[O])||void 0===n?void 0:n.call(D,H(),null))||null);return O===Cr&&T!==gr&&(z(H()),u>0&&(clearTimeout(F.current),F.current=setTimeout((function(){L({deadline:!0})}),u))),O===br&&Y(),Er})),2),P=U[0],O=U[1],_=Fr(O);J.current=_,Nr((function(){k(t);var n,a=E.current;E.current=!0,!a&&t&&l&&(n=ur),a&&t&&r&&(n=dr),(a&&!t&&g||!a&&d&&!t&&g)&&(n=hr);var o=K(n);n&&(e||o[mr])?(V(n),P()):V(gr)}),[t]),(0,a.useEffect)((function(){(T===ur&&!l||T===dr&&!r||T===hr&&!g)&&V(gr)}),[l,r,g]),(0,a.useEffect)((function(){return function(){E.current=!1,clearTimeout(F.current)}}),[]);var Q=a.useRef(!1);(0,a.useEffect)((function(){w&&(Q.current=!0),void 0!==w&&T===gr&&((Q.current||w)&&(null===G||void 0===G||G(w)),Q.current=!0)}),[w,T]);var j=X;return D[mr]&&O===Ir&&(j=Ke({transition:"none"},j)),[T,O,j,null!==w&&void 0!==w?w:t]}const Yr=function(e){var t=e;"object"===fe(e)&&(t=e.transitionSupport);var n=a.forwardRef((function(e,n){var o=e.visible,i=void 0===o||o,r=e.removeOnLeave,s=void 0===r||r,l=e.forceRender,c=e.children,g=e.motionName,u=e.leavedClassName,d=e.eventProps,h=function(e,n){return!(!e.motionName||!t||!1===n)}(e,a.useContext(sr).motion),p=(0,a.useRef)(),m=(0,a.useRef)();var I=Je(Jr(h,i,(function(){try{return p.current instanceof HTMLElement?p.current:or(m.current)}catch(e){return null}}),e),4),C=I[0],f=I[1],b=I[2],y=I[3],A=a.useRef(y);y&&(A.current=!0);var v,S=a.useCallback((function(e){p.current=e,Ae(n,e)}),[n]),x=Ke(Ke({},d),{},{visible:i});if(c)if(C===gr)v=y?c(Ke({},x),S):!s&&A.current&&u?c(Ke(Ke({},x),{},{className:u}),S):l||!s&&!u?c(Ke(Ke({},x),{},{style:{display:"none"}}),S):null;else{var G;f===mr?G="prepare":Fr(f)?G="active":f===Ir&&(G="start");var Z=Wr(g,"".concat(C,"-").concat(G));v=c(Ke(Ke({},x),{},{className:Ie()(Wr(g,C),Me(Me({},Z,Z&&G),g,"string"===typeof g)),style:b}),S)}else v=null;a.isValidElement(v)&&xe(v)&&(v.ref||(v=a.cloneElement(v,{ref:S})));return a.createElement(cr,{ref:m},v)}));return n.displayName="CSSMotion",n}(kr);var Lr="add",zr="keep",Kr="remove",Dr="removed";function Ur(e){var t;return Ke(Ke({},t=e&&"object"===fe(e)&&"key"in e?e:{key:e}),{},{key:String(t.key)})}function Pr(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(Ur)}var Or=["component","children","onVisibleChanged","onAllRemoved"],_r=["status"],Qr=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];const jr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yr,n=function(e){kt(o,e);var n=Wt(o);function o(){var e;ht(this,o);for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return Me(Zt(e=n.call.apply(n,[this].concat(a))),"state",{keyEntities:[]}),Me(Zt(e),"removeKey",(function(t){var n=e.state.keyEntities.map((function(e){return e.key!==t?e:Ke(Ke({},e),{},{status:Dr})}));return e.setState({keyEntities:n}),n.filter((function(e){return e.status!==Dr})).length})),e}return mt(o,[{key:"render",value:function(){var e=this,n=this.state.keyEntities,o=this.props,i=o.component,r=o.children,s=o.onVisibleChanged,l=o.onAllRemoved,c=ir(o,Or),g=i||a.Fragment,u={};return Qr.forEach((function(e){u[e]=c[e],delete c[e]})),delete c.keys,a.createElement(g,c,n.map((function(n,o){var i=n.status,c=ir(n,_r),g=i===Lr||i===zr;return a.createElement(t,yn({},u,{key:c.key,visible:g,eventProps:c,onVisibleChanged:function(t){(null===s||void 0===s||s(t,{key:c.key}),t)||0===e.removeKey(c.key)&&l&&l()}}),(function(e,t){return r(Ke(Ke({},e),{},{index:o}),t)}))})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.keys,a=t.keyEntities,o=Pr(n),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],a=0,o=t.length,i=Pr(e),r=Pr(t);i.forEach((function(e){for(var t=!1,i=a;i<o;i+=1){var s=r[i];if(s.key===e.key){a<i&&(n=n.concat(r.slice(a,i).map((function(e){return Ke(Ke({},e),{},{status:Lr})}))),a=i),n.push(Ke(Ke({},s),{},{status:zr})),a+=1,t=!0;break}}t||n.push(Ke(Ke({},e),{},{status:Kr}))})),a<o&&(n=n.concat(r.slice(a).map((function(e){return Ke(Ke({},e),{},{status:Lr})}))));var s={};return n.forEach((function(e){var t=e.key;s[t]=(s[t]||0)+1})),Object.keys(s).filter((function(e){return s[e]>1})).forEach((function(e){(n=n.filter((function(t){var n=t.key,a=t.status;return n!==e||a!==Kr}))).forEach((function(t){t.key===e&&(t.status=zr)}))})),n}(a,o);return{keyEntities:i.filter((function(e){var t=a.find((function(t){var n=t.key;return e.key===n}));return!t||t.status!==Dr||e.status!==Kr}))}}}]),o}(a.Component);return Me(n,"defaultProps",{component:"div"}),n}(kr),qr=Yr;function $r(e){const{children:t}=e,[,n]=ai(),{motion:o}=n,i=a.useRef(!1);return i.current=i.current||!1===o,i.current?a.createElement(lr,{motion:o},t):t}const es=()=>null;var ts=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const ns=["getTargetContainer","getPopupContainer","renderEmpty","input","pagination","form","select","button"];let as,os,is,rs;function ss(){return as||"ant"}function ls(){return os||we}const cs=()=>({getPrefixCls:(e,t)=>t||(e?"".concat(ss(),"-").concat(e):ss()),getIconPrefixCls:ls,getRootPrefixCls:()=>as||ss(),getTheme:()=>is,holderRender:rs}),gs=e=>{const{children:t,csp:n,autoInsertSpaceInButton:o,alert:i,anchor:r,form:s,locale:l,componentSize:c,direction:g,space:u,virtual:d,dropdownMatchSelectWidth:h,popupMatchSelectWidth:p,popupOverflow:m,legacyLocale:I,parentContext:C,iconPrefixCls:f,theme:b,componentDisabled:y,segmented:A,statistic:v,spin:S,calendar:x,carousel:G,cascader:Z,collapse:w,typography:k,checkbox:B,descriptions:R,divider:W,drawer:V,skeleton:N,steps:X,image:M,layout:T,list:E,mentions:F,modal:H,progress:J,result:Y,slider:L,breadcrumb:z,menu:K,pagination:D,input:U,textArea:P,empty:O,badge:_,radio:Q,rate:j,switch:q,transfer:$,avatar:ee,message:te,tag:ne,table:ae,card:oe,tabs:ie,timeline:re,timePicker:se,upload:le,notification:ce,tree:ge,colorPicker:ue,datePicker:de,rangePicker:he,flex:pe,wave:me,dropdown:Ie,warning:Ce,tour:fe,floatButtonGroup:be,variant:Ae,inputNumber:ve,treeSelect:Se}=e,xe=a.useCallback(((t,n)=>{const{prefixCls:a}=e;if(n)return n;const o=a||C.getPrefixCls("");return t?"".concat(o,"-").concat(t):o}),[C.getPrefixCls,e.prefixCls]),Ge=f||C.iconPrefixCls||we,Ze=n||C.csp;gi(Ge,Ze);const ke=function(e,t,n){var a;Bi("ConfigProvider");const o=e||{},i=!1!==o.inherit&&t?t:Object.assign(Object.assign({},Uo),{hashed:null!==(a=null===t||void 0===t?void 0:t.hashed)&&void 0!==a?a:Uo.hashed,cssVar:null===t||void 0===t?void 0:t.cssVar}),r=er();return ye((()=>{var a,s;if(!e)return t;const l=Object.assign({},i.components);Object.keys(e.components||{}).forEach((t=>{l[t]=Object.assign(Object.assign({},l[t]),e.components[t])}));const c="css-var-".concat(r.replace(/:/g,"")),g=(null!==(a=o.cssVar)&&void 0!==a?a:i.cssVar)&&Object.assign(Object.assign(Object.assign({prefix:null===n||void 0===n?void 0:n.prefixCls},"object"===typeof i.cssVar?i.cssVar:{}),"object"===typeof o.cssVar?o.cssVar:{}),{key:"object"===typeof o.cssVar&&(null===(s=o.cssVar)||void 0===s?void 0:s.key)||c});return Object.assign(Object.assign(Object.assign({},i),o),{token:Object.assign(Object.assign({},i.token),o.token),components:l,cssVar:g})}),[o,i],((e,t)=>e.some(((e,n)=>{const a=t[n];return!dt(e,a,!0)}))))}(b,C.theme,{prefixCls:xe("")});const Re={csp:Ze,autoInsertSpaceInButton:o,alert:i,anchor:r,locale:l||I,direction:g,space:u,virtual:d,popupMatchSelectWidth:null!==p&&void 0!==p?p:h,popupOverflow:m,getPrefixCls:xe,iconPrefixCls:Ge,theme:ke,segmented:A,statistic:v,spin:S,calendar:x,carousel:G,cascader:Z,collapse:w,typography:k,checkbox:B,descriptions:R,divider:W,drawer:V,skeleton:N,steps:X,image:M,input:U,textArea:P,layout:T,list:E,mentions:F,modal:H,progress:J,result:Y,slider:L,breadcrumb:z,menu:K,pagination:D,empty:O,badge:_,radio:Q,rate:j,switch:q,transfer:$,avatar:ee,message:te,tag:ne,table:ae,card:oe,tabs:ie,timeline:re,timePicker:se,upload:le,notification:ce,tree:ge,colorPicker:ue,datePicker:de,rangePicker:he,flex:pe,wave:me,dropdown:Ie,warning:Ce,tour:fe,floatButtonGroup:be,variant:Ae,inputNumber:ve,treeSelect:Se};const We=Object.assign({},C);Object.keys(Re).forEach((e=>{void 0!==Re[e]&&(We[e]=Re[e])})),ns.forEach((t=>{const n=e[t];n&&(We[t]=n)})),"undefined"!==typeof o&&(We.button=Object.assign({autoInsertSpace:o},We.button));const Ve=ye((()=>We),We,((e,t)=>{const n=Object.keys(e),a=Object.keys(t);return n.length!==a.length||n.some((n=>e[n]!==t[n]))})),Ne=a.useMemo((()=>({prefixCls:Ge,csp:Ze})),[Ge,Ze]);let Xe=a.createElement(a.Fragment,null,a.createElement(es,{dropdownMatchSelectWidth:h}),t);const Me=a.useMemo((()=>{var e,t,n,a;return Fa((null===(e=Ti.Form)||void 0===e?void 0:e.defaultValidateMessages)||{},(null===(n=null===(t=Ve.locale)||void 0===t?void 0:t.Form)||void 0===n?void 0:n.defaultValidateMessages)||{},(null===(a=Ve.form)||void 0===a?void 0:a.validateMessages)||{},(null===s||void 0===s?void 0:s.validateMessages)||{})}),[Ve,null===s||void 0===s?void 0:s.validateMessages]);Object.keys(Me).length>0&&(Xe=a.createElement(Ri.Provider,{value:Me},Xe)),l&&(Xe=a.createElement(Li,{locale:l,_ANT_MARK__:"internalMark"},Xe)),(Ge||Ze)&&(Xe=a.createElement(Zi.Provider,{value:Ne},Xe)),c&&(Xe=a.createElement(_i,{size:c},Xe)),Xe=a.createElement($r,null,Xe);const Te=a.useMemo((()=>{const e=ke||{},{algorithm:t,token:n,components:a,cssVar:o}=e,i=ts(e,["algorithm","token","components","cssVar"]),r=t&&(!Array.isArray(t)||t.length>0)?zt(t):Do,s={};Object.entries(a||{}).forEach((e=>{let[t,n]=e;const a=Object.assign({},n);"algorithm"in a&&(!0===a.algorithm?a.theme=r:(Array.isArray(a.algorithm)||"function"===typeof a.algorithm)&&(a.theme=zt(a.algorithm)),delete a.algorithm),s[t]=a}));const l=Object.assign(Object.assign({},Mo),n);return Object.assign(Object.assign({},i),{theme:r,token:l,components:s,override:Object.assign({override:l},s),cssVar:o})}),[ke]);return b&&(Xe=a.createElement(Po.Provider,{value:Te},Xe)),Ve.warning&&(Xe=a.createElement(ki.Provider,{value:Ve.warning},Xe)),void 0!==y&&(Xe=a.createElement(Ui,{disabled:y},Xe)),a.createElement(Be.Provider,{value:Ve},Xe)},us=e=>{const t=a.useContext(Be),n=a.useContext(Yi);return a.createElement(gs,Object.assign({parentContext:t,legacyLocale:n},e))};us.ConfigContext=Be,us.SizeContext=Qi,us.config=e=>{const{prefixCls:t,iconPrefixCls:n,theme:a,holderRender:o}=e;void 0!==t&&(as=t),void 0!==n&&(os=n),"holderRender"in e&&(rs=o),a&&(!function(e){return Object.keys(e).some((e=>e.endsWith("Color")))}(a)?is=a:Ki(ss(),a))},us.useConfig=ji,Object.defineProperty(us,"SizeContext",{get:()=>Qi});const ds=us,hs="".concat("ant","-wave-target");function ps(){ps=function(){return t};var e,t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function g(e,t,n,a){var i=t&&t.prototype instanceof C?t:C,r=Object.create(i.prototype),s=new R(a||[]);return o(r,"_invoke",{value:Z(e,n,s)}),r}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=g;var d="suspendedStart",h="suspendedYield",p="executing",m="completed",I={};function C(){}function f(){}function b(){}var y={};c(y,r,(function(){return this}));var A=Object.getPrototypeOf,v=A&&A(A(W([])));v&&v!==n&&a.call(v,r)&&(y=v);var S=b.prototype=C.prototype=Object.create(y);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function G(e,t){function n(o,i,r,s){var l=u(e[o],e,i);if("throw"!==l.type){var c=l.arg,g=c.value;return g&&"object"==fe(g)&&a.call(g,"__await")?t.resolve(g.__await).then((function(e){n("next",e,r,s)}),(function(e){n("throw",e,r,s)})):t.resolve(g).then((function(e){c.value=e,r(c)}),(function(e){return n("throw",e,r,s)}))}s(l.arg)}var i;o(this,"_invoke",{value:function(e,a){function o(){return new t((function(t,o){n(e,a,t,o)}))}return i=i?i.then(o,o):o()}})}function Z(t,n,a){var o=d;return function(i,r){if(o===p)throw Error("Generator is already running");if(o===m){if("throw"===i)throw r;return{value:e,done:!0}}for(a.method=i,a.arg=r;;){var s=a.delegate;if(s){var l=w(s,a);if(l){if(l===I)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===d)throw o=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=p;var c=u(t,n,a);if("normal"===c.type){if(o=a.done?m:h,c.arg===I)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(o=m,a.method="throw",a.arg=c.arg)}}}function w(t,n){var a=n.method,o=t.iterator[a];if(o===e)return n.delegate=null,"throw"===a&&t.iterator.return&&(n.method="return",n.arg=e,w(t,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),I;var i=u(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,I;var r=i.arg;return r?r.done?(n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,I):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,I)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function W(t){if(t||""===t){var n=t[r];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(a.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(fe(t)+" is not iterable")}return f.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:f,configurable:!0}),f.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},x(G.prototype),c(G.prototype,s,(function(){return this})),t.AsyncIterator=G,t.async=function(e,n,a,o,i){void 0===i&&(i=Promise);var r=new G(g(e,n,a,o),i);return t.isGeneratorFunction(n)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},x(S),c(S,l,"Generator"),c(S,r,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=W,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(a,o){return s.type="throw",s.arg=t,n.next=a,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return o("end");if(r.tryLoc<=this.prev){var l=a.call(r,"catchLoc"),c=a.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return o(r.catchLoc,!0);if(this.prev<r.finallyLoc)return o(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return o(r.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return o(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,I):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),I},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),I}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var o=a.arg;B(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,a){return this.delegate={iterator:W(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=e),I}},t}function ms(e,t,n,a,o,i,r){try{var s=e[i](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,o)}function Is(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function r(e){ms(i,a,o,r,s,"next",e)}function s(e){ms(i,a,o,r,s,"throw",e)}r(void 0)}))}}var Cs,fs=Ke({},nr),bs=fs.version,ys=fs.render,As=fs.unmountComponentAtNode;try{Number((bs||"").split(".")[0])>=18&&(Cs=fs.createRoot)}catch(Pke){}function vs(e){var t=fs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;t&&"object"===fe(t)&&(t.usingClientEntryPoint=e)}var Ss="__rc_react_root__";function xs(e,t){Cs?function(e,t){vs(!0);var n=t[Ss]||Cs(t);vs(!1),n.render(e),t[Ss]=n}(e,t):function(e,t){ys(e,t)}(e,t)}function Gs(e){return Zs.apply(this,arguments)}function Zs(){return Zs=Is(ps().mark((function e(t){return ps().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then((function(){var e;null===(e=t[Ss])||void 0===e||e.unmount(),delete t[Ss]})));case 1:case"end":return e.stop()}}),e)}))),Zs.apply(this,arguments)}function ws(e){As(e)}function ks(e){return Bs.apply(this,arguments)}function Bs(){return(Bs=Is(ps().mark((function e(t){return ps().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===Cs){e.next=2;break}return e.abrupt("return",Gs(t));case 2:ws(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rs(e){return e&&"#fff"!==e&&"#ffffff"!==e&&"rgb(255, 255, 255)"!==e&&"rgba(255, 255, 255, 1)"!==e&&function(e){const t=(e||"").match(/rgba?\((\d*), (\d*), (\d*)(, [\d.]*)?\)/);return!(t&&t[1]&&t[2]&&t[3])||!(t[1]===t[2]&&t[2]===t[3])}(e)&&!/rgba\((?:\d*, ){3}0\)/.test(e)&&"transparent"!==e}function Ws(e){return Number.isNaN(e)?0:e}const Vs=e=>{const{className:t,target:n,component:o}=e,i=a.useRef(null),[r,s]=a.useState(null),[l,c]=a.useState([]),[g,u]=a.useState(0),[d,h]=a.useState(0),[p,m]=a.useState(0),[I,C]=a.useState(0),[f,b]=a.useState(!1),y={left:g,top:d,width:p,height:I,borderRadius:l.map((e=>"".concat(e,"px"))).join(" ")};function A(){const e=getComputedStyle(n);s(function(e){const{borderTopColor:t,borderColor:n,backgroundColor:a}=getComputedStyle(e);return Rs(t)?t:Rs(n)?n:Rs(a)?a:null}(n));const t="static"===e.position,{borderLeftWidth:a,borderTopWidth:o}=e;u(t?n.offsetLeft:Ws(-parseFloat(a))),h(t?n.offsetTop:Ws(-parseFloat(o))),m(n.offsetWidth),C(n.offsetHeight);const{borderTopLeftRadius:i,borderTopRightRadius:r,borderBottomLeftRadius:l,borderBottomRightRadius:g}=e;c([i,r,g,l].map((e=>Ws(parseFloat(e)))))}if(r&&(y["--wave-color"]=r),a.useEffect((()=>{if(n){const e=Gi((()=>{A(),b(!0)}));let t;return"undefined"!==typeof ResizeObserver&&(t=new ResizeObserver(A),t.observe(n)),()=>{Gi.cancel(e),null===t||void 0===t||t.disconnect()}}}),[]),!f)return null;const v=("Checkbox"===o||"Radio"===o)&&(null===n||void 0===n?void 0:n.classList.contains(hs));return a.createElement(qr,{visible:!0,motionAppear:!0,motionName:"wave-motion",motionDeadline:5e3,onAppearEnd:(e,t)=>{var n;if(t.deadline||"opacity"===t.propertyName){const e=null===(n=i.current)||void 0===n?void 0:n.parentElement;ks(e).then((()=>{null===e||void 0===e||e.remove()}))}return!1}},((e,n)=>{let{className:o}=e;return a.createElement("div",{ref:ve(i,n),className:Ie()(t,o,{"wave-quick":v}),style:y})}))},Ns=(e,t)=>{var n;const{component:o}=t;if("Checkbox"===o&&!(null===(n=e.querySelector("input"))||void 0===n?void 0:n.checked))return;const i=document.createElement("div");i.style.position="absolute",i.style.left="0px",i.style.top="0px",null===e||void 0===e||e.insertBefore(i,null===e||void 0===e?void 0:e.firstChild),xs(a.createElement(Vs,Object.assign({},t,{target:e})),i)},Xs=(e,t,n)=>{const{wave:o}=a.useContext(Be),[,i,r]=ai(),s=ka((a=>{const s=e.current;if((null===o||void 0===o?void 0:o.disabled)||!s)return;const l=s.querySelector(".".concat(hs))||s,{showEffect:c}=o||{};(c||Ns)(l,{className:t,token:i,component:n,event:a,hashId:r})})),l=a.useRef();return e=>{Gi.cancel(l.current),l.current=Gi((()=>{s(e)}))}};const Ms=e=>{const{children:t,disabled:n,component:o}=e,{getPrefixCls:i}=(0,a.useContext)(Be),r=(0,a.useRef)(null),s=i("wave"),[,l]=fi(s),c=Xs(r,Ie()(s,l),o);if(a.useEffect((()=>{const e=r.current;if(!e||1!==e.nodeType||n)return;const t=t=>{!Ze(t.target)||!e.getAttribute||e.getAttribute("disabled")||e.disabled||e.className.includes("disabled")||e.className.includes("-leave")||c(t)};return e.addEventListener("click",t,!0),()=>{e.removeEventListener("click",t,!0)}}),[n]),!a.isValidElement(t))return null!==t&&void 0!==t?t:null;return Ne(t,{ref:xe(t)?ve(t.ref,r):r})},Ts=e=>{const t=a.useContext(Qi);return a.useMemo((()=>e?"string"===typeof e?null!==e&&void 0!==e?e:t:e instanceof Function?e(t):t:t),[e,t])};function Es(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];return a.Children.forEach(e,(function(e){(void 0!==e&&null!==e||t.keepEmpty)&&(Array.isArray(e)?n=n.concat(Es(e)):(0,be.isFragment)(e)&&e.props?n=n.concat(Es(e.props.children,t)):n.push(e))})),n}const Fs=a.createContext(null),Hs=(e,t)=>{const n=a.useContext(Fs),o=a.useMemo((()=>{if(!n)return"";const{compactDirection:a,isFirstItem:o,isLastItem:i}=n,r="vertical"===a?"-vertical-":"-";return Ie()("".concat(e,"-compact").concat(r,"item"),{["".concat(e,"-compact").concat(r,"first-item")]:o,["".concat(e,"-compact").concat(r,"last-item")]:i,["".concat(e,"-compact").concat(r,"item-rtl")]:"rtl"===t})}),[e,t,n]);return{compactSize:null===n||void 0===n?void 0:n.compactSize,compactDirection:null===n||void 0===n?void 0:n.compactDirection,compactItemClassnames:o}},Js=e=>{let{children:t}=e;return a.createElement(Fs.Provider,{value:null},t)};var Ys=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Ls=a.createContext(void 0),zs=e=>{const{getPrefixCls:t,direction:n}=a.useContext(Be),{prefixCls:o,size:i,className:r}=e,s=Ys(e,["prefixCls","size","className"]),l=t("btn-group",o),[,,c]=ai();let g="";switch(i){case"large":g="lg";break;case"small":g="sm"}const u=Ie()(l,{["".concat(l,"-").concat(g)]:g,["".concat(l,"-rtl")]:"rtl"===n},r,c);return a.createElement(Ls.Provider,{value:i},a.createElement("div",Object.assign({},s,{className:u})))},Ks=/^[\u4e00-\u9fa5]{2}$/,Ds=Ks.test.bind(Ks);function Us(e){return"danger"===e?{danger:!0}:{type:e}}function Ps(e){return"string"===typeof e}function Os(e){return"text"===e||"link"===e}function _s(e,t){let n=!1;const o=[];return a.Children.forEach(e,(e=>{const t=typeof e,a="string"===t||"number"===t;if(n&&a){const t=o.length-1,n=o[t];o[t]="".concat(n).concat(e)}else o.push(e);n=a})),a.Children.map(o,(e=>function(e,t){if(null===e||void 0===e)return;const n=t?" ":"";return"string"!==typeof e&&"number"!==typeof e&&Ps(e.type)&&Ds(e.props.children)?Ne(e,{children:e.props.children.split("").join(n)}):Ps(e)?Ds(e)?a.createElement("span",null,e.split("").join(n)):a.createElement("span",null,e):We(e)?a.createElement("span",null,e):e}(e,t)))}const Qs=(0,a.forwardRef)(((e,t)=>{const{className:n,style:o,children:i,prefixCls:r}=e,s=Ie()("".concat(r,"-icon"),n);return a.createElement("span",{ref:t,className:s,style:o},i)})),js=Qs;const qs={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"};function $s(e){var t;return null===e||void 0===e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}function el(e){return function(e){return $s(e)instanceof ShadowRoot}(e)?$s(e):null}function tl(e){return"object"===fe(e)&&"string"===typeof e.name&&"string"===typeof e.theme&&("object"===fe(e.icon)||"function"===typeof e.icon)}function nl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,n){var a,o=e[n];if("class"===n)t.className=o,delete t.class;else delete t[n],t[(a=n,a.replace(/-(.)/g,(function(e,t){return t.toUpperCase()})))]=o;return t}),{})}function al(e,t,n){return n?a.createElement(e.tag,Ke(Ke({key:t},nl(e.attrs)),n),(e.children||[]).map((function(n,a){return al(n,"".concat(t,"-").concat(e.tag,"-").concat(a))}))):a.createElement(e.tag,Ke({key:t},nl(e.attrs)),(e.children||[]).map((function(n,a){return al(n,"".concat(t,"-").concat(e.tag,"-").concat(a))})))}function ol(e){return ko(e)[0]}function il(e){return e?Array.isArray(e)?e:[e]:[]}var rl=["icon","className","onClick","style","primaryColor","secondaryColor"],sl={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};var ll=function(e){var t=e.icon,n=e.className,o=e.onClick,i=e.style,r=e.primaryColor,s=e.secondaryColor,l=ir(e,rl),c=a.useRef(),g=sl;if(r&&(g={primaryColor:r,secondaryColor:s||ol(r)}),function(e){var t=(0,a.useContext)(Zi),n=t.csp,o=t.prefixCls,i="\n.anticon {\n  display: inline-flex;\n  align-items: center;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n";o&&(i=i.replace(/anticon/g,o)),(0,a.useEffect)((function(){var t=el(e.current);ot(i,"@ant-design-icons",{prepend:!0,csp:n,attachTo:t})}),[])}(c),function(e,t){ut(e,"[@ant-design/icons] ".concat(t))}(tl(t),"icon should be icon definiton, but got ".concat(t)),!tl(t))return null;var u=t;return u&&"function"===typeof u.icon&&(u=Ke(Ke({},u),{},{icon:u.icon(g.primaryColor,g.secondaryColor)})),al(u.icon,"svg-".concat(u.name),Ke(Ke({className:n,onClick:o,style:i,"data-icon":u.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},l),{},{ref:c}))};ll.displayName="IconReact",ll.getTwoToneColors=function(){return Ke({},sl)},ll.setTwoToneColors=function(e){var t=e.primaryColor,n=e.secondaryColor;sl.primaryColor=t,sl.secondaryColor=n||ol(t),sl.calculated=!!n};const cl=ll;function gl(e){var t=Je(il(e),2),n=t[0],a=t[1];return cl.setTwoToneColors({primaryColor:n,secondaryColor:a})}var ul=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];gl(No.primary);var dl=a.forwardRef((function(e,t){var n=e.className,o=e.icon,i=e.spin,r=e.rotate,s=e.tabIndex,l=e.onClick,c=e.twoToneColor,g=ir(e,ul),u=a.useContext(Zi),d=u.prefixCls,h=void 0===d?"anticon":d,p=u.rootClassName,m=Ie()(p,h,Me(Me({},"".concat(h,"-").concat(o.name),!!o.name),"".concat(h,"-spin"),!!i||"loading"===o.name),n),I=s;void 0===I&&l&&(I=-1);var C=r?{msTransform:"rotate(".concat(r,"deg)"),transform:"rotate(".concat(r,"deg)")}:void 0,f=Je(il(c),2),b=f[0],y=f[1];return a.createElement("span",yn({role:"img","aria-label":o.name},g,{ref:t,tabIndex:I,onClick:l,className:m}),a.createElement(cl,{icon:o,primaryColor:b,secondaryColor:y,style:C}))}));dl.displayName="AntdIcon",dl.getTwoToneColor=function(){var e=cl.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor},dl.setTwoToneColor=gl;const hl=dl;var pl=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:qs}))};const ml=a.forwardRef(pl),Il=(0,a.forwardRef)(((e,t)=>{const{prefixCls:n,className:o,style:i,iconClassName:r}=e,s=Ie()("".concat(n,"-loading-icon"),o);return a.createElement(js,{prefixCls:n,className:s,style:i,ref:t},a.createElement(ml,{className:r}))})),Cl=()=>({width:0,opacity:0,transform:"scale(0)"}),fl=e=>({width:e.scrollWidth,opacity:1,transform:"scale(1)"}),bl=e=>{const{prefixCls:t,loading:n,existIcon:o,className:i,style:r}=e,s=!!n;return o?a.createElement(Il,{prefixCls:t,className:i,style:r}):a.createElement(qr,{visible:s,motionName:"".concat(t,"-loading-icon-motion"),motionLeave:s,removeOnLeave:!0,onAppearStart:Cl,onAppearActive:fl,onEnterStart:Cl,onEnterActive:fl,onLeaveStart:fl,onLeaveActive:Cl},((e,n)=>{let{className:o,style:s}=e;return a.createElement(Il,{prefixCls:t,className:i,style:Object.assign(Object.assign({},r),s),ref:n,iconClassName:o})}))},yl=(e,t)=>({["> span, > ".concat(e)]:{"&:not(:last-child)":{["&, & > ".concat(e)]:{"&:not(:disabled)":{borderInlineEndColor:t}}},"&:not(:first-child)":{["&, & > ".concat(e)]:{"&:not(:disabled)":{borderInlineStartColor:t}}}}}),Al=e=>{const{componentCls:t,fontSize:n,lineWidth:a,groupBorderColor:o,colorErrorHover:i}=e;return{["".concat(t,"-group")]:[{position:"relative",display:"inline-flex",["> span, > ".concat(t)]:{"&:not(:last-child)":{["&, & > ".concat(t)]:{borderStartEndRadius:0,borderEndEndRadius:0}},"&:not(:first-child)":{marginInlineStart:e.calc(a).mul(-1).equal(),["&, & > ".concat(t)]:{borderStartStartRadius:0,borderEndStartRadius:0}}},[t]:{position:"relative",zIndex:1,"&:hover, &:focus, &:active":{zIndex:2},"&[disabled]":{zIndex:0}},["".concat(t,"-icon-only")]:{fontSize:n}},yl("".concat(t,"-primary"),o),yl("".concat(t,"-danger"),i)]}},vl=e=>{const{paddingInline:t,onlyIconSize:n,paddingBlock:a}=e;return ri(e,{buttonPaddingHorizontal:t,buttonPaddingVertical:a,buttonIconOnlyFontSize:n})},Sl=e=>{var t,n,a,o,i,r;const s=null!==(t=e.contentFontSize)&&void 0!==t?t:e.fontSize,l=null!==(n=e.contentFontSizeSM)&&void 0!==n?n:e.fontSize,c=null!==(a=e.contentFontSizeLG)&&void 0!==a?a:e.fontSizeLG,g=null!==(o=e.contentLineHeight)&&void 0!==o?o:Ho(s),u=null!==(i=e.contentLineHeightSM)&&void 0!==i?i:Ho(l),d=null!==(r=e.contentLineHeightLG)&&void 0!==r?r:Ho(c);return{fontWeight:400,defaultShadow:"0 ".concat(e.controlOutlineWidth,"px 0 ").concat(e.controlTmpOutline),primaryShadow:"0 ".concat(e.controlOutlineWidth,"px 0 ").concat(e.controlOutline),dangerShadow:"0 ".concat(e.controlOutlineWidth,"px 0 ").concat(e.colorErrorOutline),primaryColor:e.colorTextLightSolid,dangerColor:e.colorTextLightSolid,borderColorDisabled:e.colorBorder,defaultGhostColor:e.colorBgContainer,ghostBg:"transparent",defaultGhostBorderColor:e.colorBgContainer,paddingInline:e.paddingContentHorizontal-e.lineWidth,paddingInlineLG:e.paddingContentHorizontal-e.lineWidth,paddingInlineSM:8-e.lineWidth,onlyIconSize:e.fontSizeLG,onlyIconSizeSM:e.fontSizeLG-2,onlyIconSizeLG:e.fontSizeLG+2,groupBorderColor:e.colorPrimaryHover,linkHoverBg:"transparent",textHoverBg:e.colorBgTextHover,defaultColor:e.colorText,defaultBg:e.colorBgContainer,defaultBorderColor:e.colorBorder,defaultBorderColorDisabled:e.colorBorder,defaultHoverBg:e.colorBgContainer,defaultHoverColor:e.colorPrimaryHover,defaultHoverBorderColor:e.colorPrimaryHover,defaultActiveBg:e.colorBgContainer,defaultActiveColor:e.colorPrimaryActive,defaultActiveBorderColor:e.colorPrimaryActive,contentFontSize:s,contentFontSizeSM:l,contentFontSizeLG:c,contentLineHeight:g,contentLineHeightSM:u,contentLineHeightLG:d,paddingBlock:Math.max((e.controlHeight-s*g)/2-e.lineWidth,0),paddingBlockSM:Math.max((e.controlHeightSM-l*u)/2-e.lineWidth,0),paddingBlockLG:Math.max((e.controlHeightLG-c*d)/2-e.lineWidth,0)}},xl=e=>{const{componentCls:t,iconCls:n,fontWeight:a}=e;return{[t]:{outline:"none",position:"relative",display:"inline-flex",gap:e.marginXS,alignItems:"center",justifyContent:"center",fontWeight:a,whiteSpace:"nowrap",textAlign:"center",backgroundImage:"none",background:"transparent",border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," transparent"),cursor:"pointer",transition:"all ".concat(e.motionDurationMid," ").concat(e.motionEaseInOut),userSelect:"none",touchAction:"manipulation",color:e.colorText,"&:disabled > *":{pointerEvents:"none"},"> span":{display:"inline-block"},["".concat(t,"-icon")]:{lineHeight:1},"> a":{color:"currentColor"},"&:not(:disabled)":Object.assign({},Pa(e)),["&".concat(t,"-two-chinese-chars::first-letter")]:{letterSpacing:"0.34em"},["&".concat(t,"-two-chinese-chars > *:not(").concat(n,")")]:{marginInlineEnd:"-0.34em",letterSpacing:"0.34em"},"&-icon-end":{flexDirection:"row-reverse"}}}},Gl=(e,t,n)=>({["&:not(:disabled):not(".concat(e,"-disabled)")]:{"&:hover":t,"&:active":n}}),Zl=e=>({minWidth:e.controlHeight,paddingInlineStart:0,paddingInlineEnd:0,borderRadius:"50%"}),wl=e=>({borderRadius:e.controlHeight,paddingInlineStart:e.calc(e.controlHeight).div(2).equal(),paddingInlineEnd:e.calc(e.controlHeight).div(2).equal()}),kl=e=>({cursor:"not-allowed",borderColor:e.borderColorDisabled,color:e.colorTextDisabled,background:e.colorBgContainerDisabled,boxShadow:"none"}),Bl=(e,t,n,a,o,i,r,s)=>({["&".concat(e,"-background-ghost")]:Object.assign(Object.assign({color:n||void 0,background:t,borderColor:a||void 0,boxShadow:"none"},Gl(e,Object.assign({background:t},r),Object.assign({background:t},s))),{"&:disabled":{cursor:"not-allowed",color:o||void 0,borderColor:i||void 0}})}),Rl=e=>({["&:disabled, &".concat(e.componentCls,"-disabled")]:Object.assign({},kl(e))}),Wl=e=>Object.assign({},Rl(e)),Vl=e=>({["&:disabled, &".concat(e.componentCls,"-disabled")]:{cursor:"not-allowed",color:e.colorTextDisabled}}),Nl=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Wl(e)),{background:e.defaultBg,borderColor:e.defaultBorderColor,color:e.defaultColor,boxShadow:e.defaultShadow}),Gl(e.componentCls,{color:e.defaultHoverColor,borderColor:e.defaultHoverBorderColor,background:e.defaultHoverBg},{color:e.defaultActiveColor,borderColor:e.defaultActiveBorderColor,background:e.defaultActiveBg})),Bl(e.componentCls,e.ghostBg,e.defaultGhostColor,e.defaultGhostBorderColor,e.colorTextDisabled,e.colorBorder)),{["&".concat(e.componentCls,"-dangerous")]:Object.assign(Object.assign(Object.assign({color:e.colorError,borderColor:e.colorError},Gl(e.componentCls,{color:e.colorErrorHover,borderColor:e.colorErrorBorderHover},{color:e.colorErrorActive,borderColor:e.colorErrorActive})),Bl(e.componentCls,e.ghostBg,e.colorError,e.colorError,e.colorTextDisabled,e.colorBorder)),Rl(e))}),Xl=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Wl(e)),{color:e.primaryColor,background:e.colorPrimary,boxShadow:e.primaryShadow}),Gl(e.componentCls,{color:e.colorTextLightSolid,background:e.colorPrimaryHover},{color:e.colorTextLightSolid,background:e.colorPrimaryActive})),Bl(e.componentCls,e.ghostBg,e.colorPrimary,e.colorPrimary,e.colorTextDisabled,e.colorBorder,{color:e.colorPrimaryHover,borderColor:e.colorPrimaryHover},{color:e.colorPrimaryActive,borderColor:e.colorPrimaryActive})),{["&".concat(e.componentCls,"-dangerous")]:Object.assign(Object.assign(Object.assign({background:e.colorError,boxShadow:e.dangerShadow,color:e.dangerColor},Gl(e.componentCls,{background:e.colorErrorHover},{background:e.colorErrorActive})),Bl(e.componentCls,e.ghostBg,e.colorError,e.colorError,e.colorTextDisabled,e.colorBorder,{color:e.colorErrorHover,borderColor:e.colorErrorHover},{color:e.colorErrorActive,borderColor:e.colorErrorActive})),Rl(e))}),Ml=e=>Object.assign(Object.assign({},Nl(e)),{borderStyle:"dashed"}),Tl=e=>Object.assign(Object.assign(Object.assign({color:e.colorLink},Gl(e.componentCls,{color:e.colorLinkHover,background:e.linkHoverBg},{color:e.colorLinkActive})),Vl(e)),{["&".concat(e.componentCls,"-dangerous")]:Object.assign(Object.assign({color:e.colorError},Gl(e.componentCls,{color:e.colorErrorHover},{color:e.colorErrorActive})),Vl(e))}),El=e=>Object.assign(Object.assign(Object.assign({},Gl(e.componentCls,{color:e.colorText,background:e.textHoverBg},{color:e.colorText,background:e.colorBgTextActive})),Vl(e)),{["&".concat(e.componentCls,"-dangerous")]:Object.assign(Object.assign({color:e.colorError},Vl(e)),Gl(e.componentCls,{color:e.colorErrorHover,background:e.colorErrorBg},{color:e.colorErrorHover,background:e.colorErrorBgActive}))}),Fl=e=>{const{componentCls:t}=e;return{["".concat(t,"-default")]:Nl(e),["".concat(t,"-primary")]:Xl(e),["".concat(t,"-dashed")]:Ml(e),["".concat(t,"-link")]:Tl(e),["".concat(t,"-text")]:El(e),["".concat(t,"-ghost")]:Bl(e.componentCls,e.ghostBg,e.colorBgContainer,e.colorBgContainer,e.colorTextDisabled,e.colorBorder)}},Hl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{componentCls:n,controlHeight:a,fontSize:o,lineHeight:i,borderRadius:r,buttonPaddingHorizontal:s,iconCls:l,buttonPaddingVertical:c}=e,g="".concat(n,"-icon-only");return[{["".concat(t)]:{fontSize:o,lineHeight:i,height:a,padding:"".concat(Qt(c)," ").concat(Qt(s)),borderRadius:r,["&".concat(g)]:{width:a,paddingInline:0,["&".concat(n,"-compact-item")]:{flex:"none"},["&".concat(n,"-round")]:{width:"auto"},[l]:{fontSize:e.buttonIconOnlyFontSize}},["&".concat(n,"-loading")]:{opacity:e.opacityLoading,cursor:"default"},["".concat(n,"-loading-icon")]:{transition:"width ".concat(e.motionDurationSlow," ").concat(e.motionEaseInOut,", opacity ").concat(e.motionDurationSlow," ").concat(e.motionEaseInOut)}}},{["".concat(n).concat(n,"-circle").concat(t)]:Zl(e)},{["".concat(n).concat(n,"-round").concat(t)]:wl(e)}]},Jl=e=>{const t=ri(e,{fontSize:e.contentFontSize,lineHeight:e.contentLineHeight});return Hl(t,e.componentCls)},Yl=e=>{const t=ri(e,{controlHeight:e.controlHeightSM,fontSize:e.contentFontSizeSM,lineHeight:e.contentLineHeightSM,padding:e.paddingXS,buttonPaddingHorizontal:e.paddingInlineSM,buttonPaddingVertical:e.paddingBlockSM,borderRadius:e.borderRadiusSM,buttonIconOnlyFontSize:e.onlyIconSizeSM});return Hl(t,"".concat(e.componentCls,"-sm"))},Ll=e=>{const t=ri(e,{controlHeight:e.controlHeightLG,fontSize:e.contentFontSizeLG,lineHeight:e.contentLineHeightLG,buttonPaddingHorizontal:e.paddingInlineLG,buttonPaddingVertical:e.paddingBlockLG,borderRadius:e.borderRadiusLG,buttonIconOnlyFontSize:e.onlyIconSizeLG});return Hl(t,"".concat(e.componentCls,"-lg"))},zl=e=>{const{componentCls:t}=e;return{[t]:{["&".concat(t,"-block")]:{width:"100%"}}}},Kl=Ii("Button",(e=>{const t=vl(e);return[xl(t),Jl(t),Yl(t),Ll(t),zl(t),Fl(t),Al(t)]}),Sl,{unitless:{fontWeight:!0,contentLineHeight:!0,contentLineHeightSM:!0,contentLineHeightLG:!0}});function Dl(e,t,n){const{focusElCls:a,focus:o,borderElCls:i}=n,r=i?"> *":"",s=["hover",o?"focus":null,"active"].filter(Boolean).map((e=>"&:".concat(e," ").concat(r))).join(",");return{["&-item:not(".concat(t,"-last-item)")]:{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal()},"&-item":Object.assign(Object.assign({[s]:{zIndex:2}},a?{["&".concat(a)]:{zIndex:2}}:{}),{["&[disabled] ".concat(r)]:{zIndex:0}})}}function Ul(e,t,n){const{borderElCls:a}=n,o=a?"> ".concat(a):"";return{["&-item:not(".concat(t,"-first-item):not(").concat(t,"-last-item) ").concat(o)]:{borderRadius:0},["&-item:not(".concat(t,"-last-item)").concat(t,"-first-item")]:{["& ".concat(o,", &").concat(e,"-sm ").concat(o,", &").concat(e,"-lg ").concat(o)]:{borderStartEndRadius:0,borderEndEndRadius:0}},["&-item:not(".concat(t,"-first-item)").concat(t,"-last-item")]:{["& ".concat(o,", &").concat(e,"-sm ").concat(o,", &").concat(e,"-lg ").concat(o)]:{borderStartStartRadius:0,borderEndStartRadius:0}}}}function Pl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{focus:!0};const{componentCls:n}=e,a="".concat(n,"-compact");return{[a]:Object.assign(Object.assign({},Dl(e,a,t)),Ul(n,a,t))}}function Ol(e,t){return{["&-item:not(".concat(t,"-last-item)")]:{marginBottom:e.calc(e.lineWidth).mul(-1).equal()},"&-item":{"&:hover,&:focus,&:active":{zIndex:2},"&[disabled]":{zIndex:0}}}}function _l(e){const t="".concat(e.componentCls,"-compact-vertical");return{[t]:Object.assign(Object.assign({},Ol(e,t)),(n=e.componentCls,a=t,{["&-item:not(".concat(a,"-first-item):not(").concat(a,"-last-item)")]:{borderRadius:0},["&-item".concat(a,"-first-item:not(").concat(a,"-last-item)")]:{["&, &".concat(n,"-sm, &").concat(n,"-lg")]:{borderEndEndRadius:0,borderEndStartRadius:0}},["&-item".concat(a,"-last-item:not(").concat(a,"-first-item)")]:{["&, &".concat(n,"-sm, &").concat(n,"-lg")]:{borderStartStartRadius:0,borderStartEndRadius:0}}}))};var n,a}const Ql=e=>{const{componentCls:t,calc:n}=e;return{[t]:{["&-compact-item".concat(t,"-primary")]:{["&:not([disabled]) + ".concat(t,"-compact-item").concat(t,"-primary:not([disabled])")]:{position:"relative","&:before":{position:"absolute",top:n(e.lineWidth).mul(-1).equal(),insetInlineStart:n(e.lineWidth).mul(-1).equal(),display:"inline-block",width:e.lineWidth,height:"calc(100% + ".concat(Qt(e.lineWidth)," * 2)"),backgroundColor:e.colorPrimaryHover,content:'""'}}},"&-compact-vertical-item":{["&".concat(t,"-primary")]:{["&:not([disabled]) + ".concat(t,"-compact-vertical-item").concat(t,"-primary:not([disabled])")]:{position:"relative","&:before":{position:"absolute",top:n(e.lineWidth).mul(-1).equal(),insetInlineStart:n(e.lineWidth).mul(-1).equal(),display:"inline-block",width:"calc(100% + ".concat(Qt(e.lineWidth)," * 2)"),height:e.lineWidth,backgroundColor:e.colorPrimaryHover,content:'""'}}}}}}},jl=mi(["Button","compact"],(e=>{const t=vl(e);return[Pl(t),_l(t),Ql(t)]}),Sl);var ql=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const $l=a.forwardRef(((e,t)=>{var n,o,i;const{loading:r=!1,prefixCls:s,type:l,danger:c=!1,shape:g="default",size:u,styles:d,disabled:h,className:p,rootClassName:m,children:I,icon:C,iconPosition:f="start",ghost:b=!1,block:y=!1,htmlType:A="button",classNames:v,style:S={},autoInsertSpace:x}=e,G=ql(e,["loading","prefixCls","type","danger","shape","size","styles","disabled","className","rootClassName","children","icon","iconPosition","ghost","block","htmlType","classNames","style","autoInsertSpace"]),Z=l||"default",{getPrefixCls:w,direction:k,button:B}=(0,a.useContext)(Be),R=null===(n=null!==x&&void 0!==x?x:null===B||void 0===B?void 0:B.autoInsertSpace)||void 0===n||n,W=w("btn",s),[V,N,X]=Kl(W),M=(0,a.useContext)(Pi),T=null!==h&&void 0!==h?h:M,E=(0,a.useContext)(Ls),F=(0,a.useMemo)((()=>function(e){if("object"===typeof e&&e){let t=null===e||void 0===e?void 0:e.delay;return t=Number.isNaN(t)||"number"!==typeof t?0:t,{loading:t<=0,delay:t}}return{loading:!!e,delay:0}}(r)),[r]),[H,J]=(0,a.useState)(F.loading),[Y,L]=(0,a.useState)(!1),z=ve(t,(0,a.createRef)()),K=1===a.Children.count(I)&&!C&&!Os(Z);(0,a.useEffect)((()=>{let e=null;return F.delay>0?e=setTimeout((()=>{e=null,J(!0)}),F.delay):J(F.loading),function(){e&&(clearTimeout(e),e=null)}}),[F]),(0,a.useEffect)((()=>{if(!z||!z.current||!R)return;const e=z.current.textContent;K&&Ds(e)?Y||L(!0):Y&&L(!1)}),[z]);const D=t=>{const{onClick:n}=e;H||T?t.preventDefault():null===n||void 0===n||n(t)};const{compactSize:U,compactItemClassnames:P}=Hs(W,k),O={large:"lg",small:"sm",middle:void 0},_=Ts((e=>{var t,n;return null!==(n=null!==(t=null!==u&&void 0!==u?u:U)&&void 0!==t?t:E)&&void 0!==n?n:e})),Q=_&&O[_]||"",j=H?"loading":C,q=Ce(G,["navigate"]),$=Ie()(W,N,X,{["".concat(W,"-").concat(g)]:"default"!==g&&g,["".concat(W,"-").concat(Z)]:Z,["".concat(W,"-").concat(Q)]:Q,["".concat(W,"-icon-only")]:!I&&0!==I&&!!j,["".concat(W,"-background-ghost")]:b&&!Os(Z),["".concat(W,"-loading")]:H,["".concat(W,"-two-chinese-chars")]:Y&&R&&!H,["".concat(W,"-block")]:y,["".concat(W,"-dangerous")]:c,["".concat(W,"-rtl")]:"rtl"===k,["".concat(W,"-icon-end")]:"end"===f},P,p,m,null===B||void 0===B?void 0:B.className),ee=Object.assign(Object.assign({},null===B||void 0===B?void 0:B.style),S),te=Ie()(null===v||void 0===v?void 0:v.icon,null===(o=null===B||void 0===B?void 0:B.classNames)||void 0===o?void 0:o.icon),ne=Object.assign(Object.assign({},(null===d||void 0===d?void 0:d.icon)||{}),(null===(i=null===B||void 0===B?void 0:B.styles)||void 0===i?void 0:i.icon)||{}),ae=C&&!H?a.createElement(js,{prefixCls:W,className:te,style:ne},C):a.createElement(bl,{existIcon:!!C,prefixCls:W,loading:H}),oe=I||0===I?_s(I,K&&R):null;if(void 0!==q.href)return V(a.createElement("a",Object.assign({},q,{className:Ie()($,{["".concat(W,"-disabled")]:T}),href:T?void 0:q.href,style:ee,onClick:D,ref:z,tabIndex:T?-1:0}),ae,oe));let ie=a.createElement("button",Object.assign({},G,{type:A,className:$,style:ee,onClick:D,disabled:T,ref:z}),ae,oe,!!P&&a.createElement(jl,{key:"compact",prefixCls:W}));return Os(Z)||(ie=a.createElement(Ms,{component:"Button",disabled:H},ie)),V(ie)})),ec=$l;ec.Group=zs,ec.__ANT_BUTTON=!0;const tc=ec;const nc={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M689 165.1L308.2 493.5c-10.9 9.4-10.9 27.5 0 37L689 858.9c14.2 12.2 35 1.2 35-18.5V183.6c0-19.7-20.8-30.7-35-18.5z"}}]},name:"caret-left",theme:"outlined"};var ac=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:nc}))};const oc=a.forwardRef(ac);const ic={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};var rc=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:ic}))};const sc=a.forwardRef(rc),lc=n.p+"static/media/\u80cc\u666f-\u6d3b\u52d5\u4e2d\u5fc3.1ffac035265ef20fe8ee.png",cc=n.p+"static/media/\u80cc\u666f-\u9632\u7a7a\u6d1e.f90faeb0de54b12e303f.png",gc=n.p+"static/media/\u80cc\u666f-\u8349\u5730.c74b0686f7d2b2a31bb6.png",uc=n.p+"static/media/\u80cc\u666f-\u624b\u6c34\u820d.2f138815ef63a0d144b2.png",dc=n.p+"static/media/\u80cc\u666f-\u795e\u793e\u5916.00e1c15117665b21ba54.png",hc=n.p+"static/media/\u80cc\u666f-\u6d3b\u52d5\u4e2d\u5fc3-\u76f4.1e54f69f6334402013fb.png",pc=n.p+"static/media/\u80cc\u666f-\u9632\u7a7a\u6d1e-\u76f4.f907c7d126239b981908.png",mc=n.p+"static/media/\u80cc\u666f-\u624b\u6c34\u820d-\u76f4.37de97c161caac6faca0.png",Ic=n.p+"static/media/\u80cc\u666f-\u795e\u793e\u5916-\u76f4.7eef3bf4761050edff0f.png";var Cc=n(6723);const fc=e=>{var t,n,o;let{visible:i,dialogData:r=[],currentIndex:s=0,onPrevious:l,onNext:c,setCurrentDialogIndex:g}=e;const u=q(),d=Q(),[h,p]=(0,a.useState)("landscape");(0,a.useEffect)((()=>{[lc,cc,gc,uc,dc,hc,pc,mc,Ic].forEach((e=>{(new Image).src=e}))}),[]);const m=e=>{document.body.style.backgroundImage="url(".concat(((e,t)=>e>=19&&e<=27?"landscape"===t?cc:pc:e>=27&&e<=35?gc:e>=37&&e<=40?"landscape"===t?uc:mc:e>40?"landscape"===t?dc:Ic:"landscape"===t?lc:hc)(e,h),")")};(0,a.useEffect)((()=>{m(s)}),[s,h]),(0,a.useEffect)((()=>{const e=()=>{const e=window.innerWidth>window.innerHeight?"landscape":"portrait";p(e)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);(0,a.useEffect)((()=>{const e=new URLSearchParams(d.search).get("dialogIndex");null!==e&&g(parseInt(e,10))}),[d.search,g]);const[I,C]=(0,a.useReducer)(((e,t)=>{switch(t.type){case"START_COUNTDOWN":return{...e,countdown:t.payload,isButtonEnabled:!1};case"TICK":return e.countdown>1?{...e,countdown:e.countdown-1}:{countdown:0,isButtonEnabled:!0};default:return e}}),{countdown:3,isButtonEnabled:!1});(0,a.useEffect)((()=>{if(18===s||41===s){C({type:"START_COUNTDOWN",payload:3});const e=setInterval((()=>{C({type:"TICK"})}),1e3);return()=>clearInterval(e)}}),[s]);const f=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n<10?"0":"").concat(n)},b={4:{text:"\u5c0b\u627e\u963f\u516c\u306e\u7bb1\u5b50",onClick:()=>u("/Game1")},9:{text:"\u958b\u59cb\u4fee\u76f8\u6a5f",onClick:()=>u("/Game2")},18:{text:I.isButtonEnabled?"\u62b5\u9054\u9632\u7a7a\u6d1e":"\u524d\u5f80\u9632\u7a7a\u6d1e (".concat(f(I.countdown),")"),onClick:()=>c()},21:{text:"\u958b\u59cb\u904a\u6232",onClick:()=>u("/Game3")},36:{text:"\u958b\u59cb\u904a\u6232",onClick:()=>u("/Game4")},37:{text:"\u958b\u59cb\u904a\u6232",onClick:()=>u("/Game5")},41:{text:I.isButtonEnabled?"\u62b5\u9054\u795e\u793e":"\u524d\u5f80\u795e\u793e (".concat(f(I.countdown),")"),onClick:()=>c()},47:{text:"\u958b\u59cb\u904a\u6232",onClick:()=>u("/Game6")},67:{text:"\u958b\u59cb\u904a\u6232",onClick:()=>u("/Game7")},94:{text:"\u5b8c\u7d50\u6492\u82b1",onClick:()=>{localStorage.clear(),u("/?reset=true")}}};return(0,a.useEffect)((()=>(document.body.classList.add("dialog-body"),()=>{document.body.classList.remove("dialog-body")})),[]),(0,Cc.jsxs)(Cc.Fragment,{children:[i&&(0,Cc.jsx)("div",{className:"custom-modal-overlay",onClick:e=>e.stopPropagation()}),(0,Cc.jsxs)("div",{className:"custom-modal",children:[(null===(t=r[s])||void 0===t?void 0:t.imageUrl)&&(0,Cc.jsx)("img",{src:r[s].imageUrl,className:"custom-modal-image",alt:"dialog"}),(0,Cc.jsx)("span",{className:"custom-modal-title",children:null===(n=r[s])||void 0===n?void 0:n.title}),(0,Cc.jsx)("div",{className:"custom-modal-content",children:null===(o=r[s])||void 0===o?void 0:o.content}),(0,Cc.jsx)(tc,{className:"custom-modal-button-prev",onClick:()=>{s>0&&l()},disabled:0===s,icon:(0,Cc.jsx)(oc,{className:"my-custom-icon"})}),!b[s]&&(0,Cc.jsx)(tc,{className:"custom-modal-button",onClick:()=>{s<r.length-1&&c()},icon:(0,Cc.jsx)(sc,{className:"my-custom-icon"})})]}),b[s]&&(0,Cc.jsx)(tc,{className:"assemble-button",onClick:b[s].onClick,disabled:(18===s||41===s)&&!I.isButtonEnabled,children:b[s].text})]})},bc=function(){if("undefined"===typeof navigator||"undefined"===typeof window)return!1;var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(null===e||void 0===e?void 0:e.substr(0,4))};var yc={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var t=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||t>=yc.F1&&t<=yc.F12)return!1;switch(t){case yc.ALT:case yc.CAPS_LOCK:case yc.CONTEXT_MENU:case yc.CTRL:case yc.DOWN:case yc.END:case yc.ESC:case yc.HOME:case yc.INSERT:case yc.LEFT:case yc.MAC_FF_META:case yc.META:case yc.NUMLOCK:case yc.NUM_CENTER:case yc.PAGE_DOWN:case yc.PAGE_UP:case yc.PAUSE:case yc.PRINT_SCREEN:case yc.RIGHT:case yc.SHIFT:case yc.UP:case yc.WIN_KEY:case yc.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=yc.ZERO&&e<=yc.NINE)return!0;if(e>=yc.NUM_ZERO&&e<=yc.NUM_MULTIPLY)return!0;if(e>=yc.A&&e<=yc.Z)return!0;if(-1!==window.navigator.userAgent.indexOf("WebKit")&&0===e)return!0;switch(e){case yc.SPACE:case yc.QUESTION_MARK:case yc.NUM_PLUS:case yc.NUM_MINUS:case yc.NUM_PERIOD:case yc.NUM_DIVISION:case yc.SEMICOLON:case yc.DASH:case yc.EQUALS:case yc.COMMA:case yc.PERIOD:case yc.SLASH:case yc.APOSTROPHE:case yc.SINGLE_QUOTE:case yc.OPEN_SQUARE_BRACKET:case yc.BACKSLASH:case yc.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}};const Ac=yc;const vc=function(e){var t=e.className,n=e.customizeIcon,o=e.customizeIconProps,i=e.children,r=e.onMouseDown,s=e.onClick,l="function"===typeof n?n(o):n;return a.createElement("span",{className:t,onMouseDown:function(e){e.preventDefault(),null===r||void 0===r||r(e)},style:{userSelect:"none",WebkitUserSelect:"none"},unselectable:"on",onClick:s,"aria-hidden":!0},void 0!==l?l:a.createElement("span",{className:Ie()(t.split(/\s+/).map((function(e){return"".concat(e,"-icon")})))},i))};var Sc=a.createContext(null);function xc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250,t=a.useRef(null),n=a.useRef(null);return a.useEffect((function(){return function(){window.clearTimeout(n.current)}}),[]),[function(){return t.current},function(a){(a||null===t.current)&&(t.current=a),window.clearTimeout(n.current),n.current=window.setTimeout((function(){t.current=null}),e)}]}var Gc="".concat("accept acceptCharset accessKey action allowFullScreen allowTransparency\n    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge\n    charSet checked classID className colSpan cols content contentEditable contextMenu\n    controls coords crossOrigin data dateTime default defer dir disabled download draggable\n    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder\n    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity\n    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media\n    mediaGroup method min minLength multiple muted name noValidate nonce open\n    optimum pattern placeholder poster preload radioGroup readOnly rel required\n    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected\n    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style\n    summary tabIndex target title type useMap value width wmode wrap"," ").concat("onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown\n    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick\n    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown\n    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel\n    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough\n    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata\n    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError").split(/[\s\n]+/),Zc="aria-",wc="data-";function kc(e,t){return 0===e.indexOf(t)}function Bc(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=!1===n?{aria:!0,data:!0,attr:!0}:!0===n?{aria:!0}:Ke({},n);var a={};return Object.keys(e).forEach((function(n){(t.aria&&("role"===n||kc(n,Zc))||t.data&&kc(n,wc)||t.attr&&Gc.includes(n))&&(a[n]=e[n])})),a}var Rc=a.createContext(null);var Wc=function(){if("undefined"!==typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,a){return e[0]===t&&(n=a,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),a=this.__entries__[n];return a&&a[1]},t.prototype.set=function(t,n){var a=e(this.__entries__,t);~a?this.__entries__[a][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,a=e(n,t);~a&&n.splice(a,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,a=this.__entries__;n<a.length;n++){var o=a[n];e.call(t,o[1],o[0])}},t}()}(),Vc="undefined"!==typeof window&&"undefined"!==typeof document&&window.document===document,Nc="undefined"!==typeof n.g&&n.g.Math===Math?n.g:"undefined"!==typeof self&&self.Math===Math?self:"undefined"!==typeof window&&window.Math===Math?window:Function("return this")(),Xc="function"===typeof requestAnimationFrame?requestAnimationFrame.bind(Nc):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var Mc=["top","right","bottom","left","width","height","size","weight"],Tc="undefined"!==typeof MutationObserver,Ec=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,a=!1,o=0;function i(){n&&(n=!1,e()),a&&s()}function r(){Xc(i)}function s(){var e=Date.now();if(n){if(e-o<2)return;a=!0}else n=!0,a=!1,setTimeout(r,t);o=e}return s}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){Vc&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Tc?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){Vc&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;Mc.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),Fc=function(e,t){for(var n=0,a=Object.keys(t);n<a.length;n++){var o=a[n];Object.defineProperty(e,o,{value:t[o],enumerable:!1,writable:!1,configurable:!0})}return e},Hc=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||Nc},Jc=Uc(0,0,0,0);function Yc(e){return parseFloat(e)||0}function Lc(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+Yc(e["border-"+n+"-width"])}),0)}function zc(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return Jc;var a=Hc(e).getComputedStyle(e),o=function(e){for(var t={},n=0,a=["top","right","bottom","left"];n<a.length;n++){var o=a[n],i=e["padding-"+o];t[o]=Yc(i)}return t}(a),i=o.left+o.right,r=o.top+o.bottom,s=Yc(a.width),l=Yc(a.height);if("border-box"===a.boxSizing&&(Math.round(s+i)!==t&&(s-=Lc(a,"left","right")+i),Math.round(l+r)!==n&&(l-=Lc(a,"top","bottom")+r)),!function(e){return e===Hc(e).document.documentElement}(e)){var c=Math.round(s+i)-t,g=Math.round(l+r)-n;1!==Math.abs(c)&&(s-=c),1!==Math.abs(g)&&(l-=g)}return Uc(o.left,o.top,s,l)}var Kc="undefined"!==typeof SVGGraphicsElement?function(e){return e instanceof Hc(e).SVGGraphicsElement}:function(e){return e instanceof Hc(e).SVGElement&&"function"===typeof e.getBBox};function Dc(e){return Vc?Kc(e)?function(e){var t=e.getBBox();return Uc(0,0,t.width,t.height)}(e):zc(e):Jc}function Uc(e,t,n,a){return{x:e,y:t,width:n,height:a}}var Pc=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Uc(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=Dc(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),Oc=function(e,t){var n=function(e){var t=e.x,n=e.y,a=e.width,o=e.height,i="undefined"!==typeof DOMRectReadOnly?DOMRectReadOnly:Object,r=Object.create(i.prototype);return Fc(r,{x:t,y:n,width:a,height:o,top:n,right:t+a,bottom:o+n,left:t}),r}(t);Fc(this,{target:e,contentRect:n})},_c=function(){function e(e,t,n){if(this.activeObservations_=[],this.observations_=new Wc,"function"!==typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!==typeof Element&&Element instanceof Object){if(!(e instanceof Hc(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new Pc(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!==typeof Element&&Element instanceof Object){if(!(e instanceof Hc(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new Oc(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),Qc="undefined"!==typeof WeakMap?new WeakMap:new Wc,jc=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=Ec.getInstance(),a=new _c(t,n,this);Qc.set(this,a)};["observe","unobserve","disconnect"].forEach((function(e){jc.prototype[e]=function(){var t;return(t=Qc.get(this))[e].apply(t,arguments)}}));const qc="undefined"!==typeof Nc.ResizeObserver?Nc.ResizeObserver:jc;var $c=new Map;var eg=new qc((function(e){e.forEach((function(e){var t,n=e.target;null===(t=$c.get(n))||void 0===t||t.forEach((function(e){return e(n)}))}))}));var tg=function(e){kt(n,e);var t=Wt(n);function n(){return ht(this,n),t.apply(this,arguments)}return mt(n,[{key:"render",value:function(){return this.props.children}}]),n}(a.Component);function ng(e,t){var n=e.children,o=e.disabled,i=a.useRef(null),r=a.useRef(null),s=a.useContext(Rc),l="function"===typeof n,c=l?n(i):n,g=a.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),u=!l&&a.isValidElement(c)&&xe(c),d=u?c.ref:null,h=Se(d,i),p=function(){var e;return or(i.current)||(i.current&&"object"===fe(i.current)?or(null===(e=i.current)||void 0===e?void 0:e.nativeElement):null)||or(r.current)};a.useImperativeHandle(t,(function(){return p()}));var m=a.useRef(e);m.current=e;var I=a.useCallback((function(e){var t=m.current,n=t.onResize,a=t.data,o=e.getBoundingClientRect(),i=o.width,r=o.height,l=e.offsetWidth,c=e.offsetHeight,u=Math.floor(i),d=Math.floor(r);if(g.current.width!==u||g.current.height!==d||g.current.offsetWidth!==l||g.current.offsetHeight!==c){var h={width:u,height:d,offsetWidth:l,offsetHeight:c};g.current=h;var p=l===Math.round(i)?i:l,I=c===Math.round(r)?r:c,C=Ke(Ke({},h),{},{offsetWidth:p,offsetHeight:I});null===s||void 0===s||s(C,e,a),n&&Promise.resolve().then((function(){n(C,e)}))}}),[]);return a.useEffect((function(){var e,t,n=p();return n&&!o&&(e=n,t=I,$c.has(e)||($c.set(e,new Set),eg.observe(e)),$c.get(e).add(t)),function(){return function(e,t){$c.has(e)&&($c.get(e).delete(t),$c.get(e).size||(eg.unobserve(e),$c.delete(e)))}(n,I)}}),[i.current,o]),a.createElement(tg,{ref:r},u?a.cloneElement(c,{ref:h}):c)}const ag=a.forwardRef(ng);function og(e,t){var n=e.children;return("function"===typeof n?[n]:Es(n)).map((function(n,o){var i=(null===n||void 0===n?void 0:n.key)||"".concat("rc-observer-key","-").concat(o);return a.createElement(ag,yn({},e,{key:i,ref:0===o?t:void 0}),n)}))}var ig=a.forwardRef(og);ig.Collection=function(e){var t=e.children,n=e.onBatchResize,o=a.useRef(0),i=a.useRef([]),r=a.useContext(Rc),s=a.useCallback((function(e,t,a){o.current+=1;var s=o.current;i.current.push({size:e,element:t,data:a}),Promise.resolve().then((function(){s===o.current&&(null===n||void 0===n||n(i.current),i.current=[])})),null===r||void 0===r||r(e,t,a)}),[n,r]);return a.createElement(Rc.Provider,{value:s},t)};const rg=ig;var sg=["prefixCls","invalidate","item","renderItem","responsive","responsiveDisabled","registerSize","itemKey","className","style","children","display","order","component"],lg=void 0;function cg(e,t){var n=e.prefixCls,o=e.invalidate,i=e.item,r=e.renderItem,s=e.responsive,l=e.responsiveDisabled,c=e.registerSize,g=e.itemKey,u=e.className,d=e.style,h=e.children,p=e.display,m=e.order,I=e.component,C=void 0===I?"div":I,f=ir(e,sg),b=s&&!p;function y(e){c(g,e)}a.useEffect((function(){return function(){y(null)}}),[]);var A,v=r&&i!==lg?r(i):h;o||(A={opacity:b?0:1,height:b?0:lg,overflowY:b?"hidden":lg,order:s?m:lg,pointerEvents:b?"none":lg,position:b?"absolute":lg});var S={};b&&(S["aria-hidden"]=!0);var x=a.createElement(C,yn({className:Ie()(!o&&n,u),style:Ke(Ke({},A),d)},S,f,{ref:t}),v);return s&&(x=a.createElement(rg,{onResize:function(e){y(e.offsetWidth)},disabled:l},x)),x}var gg=a.forwardRef(cg);gg.displayName="Item";const ug=gg;function dg(){var e=a.useRef(null);return function(t){e.current||(e.current=[],function(e){if("undefined"===typeof MessageChannel)Gi(e);else{var t=new MessageChannel;t.port1.onmessage=function(){return e()},t.port2.postMessage(void 0)}}((function(){(0,tr.unstable_batchedUpdates)((function(){e.current.forEach((function(e){e()})),e.current=null}))}))),e.current.push(t)}}function hg(e,t){var n=Je(a.useState(t),2),o=n[0],i=n[1];return[o,ka((function(t){e((function(){i(t)}))}))]}var pg=a.createContext(null),mg=["component"],Ig=["className"],Cg=["className"],fg=function(e,t){var n=a.useContext(pg);if(!n){var o=e.component,i=void 0===o?"div":o,r=ir(e,mg);return a.createElement(i,yn({},r,{ref:t}))}var s=n.className,l=ir(n,Ig),c=e.className,g=ir(e,Cg);return a.createElement(pg.Provider,{value:null},a.createElement(ug,yn({ref:t,className:Ie()(s,c)},l,g)))},bg=a.forwardRef(fg);bg.displayName="RawItem";const yg=bg;var Ag=["prefixCls","data","renderItem","renderRawItem","itemKey","itemWidth","ssr","style","className","maxCount","renderRest","renderRawRest","suffix","component","itemComponent","onVisibleChange"],vg="responsive",Sg="invalidate";function xg(e){return"+ ".concat(e.length," ...")}function Gg(e,t){var n=e.prefixCls,o=void 0===n?"rc-overflow":n,i=e.data,r=void 0===i?[]:i,s=e.renderItem,l=e.renderRawItem,c=e.itemKey,g=e.itemWidth,u=void 0===g?10:g,d=e.ssr,h=e.style,p=e.className,m=e.maxCount,I=e.renderRest,C=e.renderRawRest,f=e.suffix,b=e.component,y=void 0===b?"div":b,A=e.itemComponent,v=e.onVisibleChange,S=ir(e,Ag),x="full"===d,G=dg(),Z=Je(hg(G,null),2),w=Z[0],k=Z[1],B=w||0,R=Je(hg(G,new Map),2),W=R[0],V=R[1],N=Je(hg(G,0),2),X=N[0],M=N[1],T=Je(hg(G,0),2),E=T[0],F=T[1],H=Je(hg(G,0),2),J=H[0],Y=H[1],L=Je((0,a.useState)(null),2),z=L[0],K=L[1],D=Je((0,a.useState)(null),2),U=D[0],P=D[1],O=a.useMemo((function(){return null===U&&x?Number.MAX_SAFE_INTEGER:U||0}),[U,w]),_=Je((0,a.useState)(!1),2),Q=_[0],j=_[1],q="".concat(o,"-item"),$=Math.max(X,E),ee=m===vg,te=r.length&&ee,ne=m===Sg,ae=te||"number"===typeof m&&r.length>m,oe=(0,a.useMemo)((function(){var e=r;return te?e=null===w&&x?r:r.slice(0,Math.min(r.length,B/u)):"number"===typeof m&&(e=r.slice(0,m)),e}),[r,u,w,m,te]),ie=(0,a.useMemo)((function(){return te?r.slice(O+1):r.slice(oe.length)}),[r,oe,te,O]),re=(0,a.useCallback)((function(e,t){var n;return"function"===typeof c?c(e):null!==(n=c&&(null===e||void 0===e?void 0:e[c]))&&void 0!==n?n:t}),[c]),se=(0,a.useCallback)(s||function(e){return e},[s]);function le(e,t,n){(U!==e||void 0!==t&&t!==z)&&(P(e),n||(j(e<r.length-1),null===v||void 0===v||v(e)),void 0!==t&&K(t))}function ce(e,t){V((function(n){var a=new Map(n);return null===t?a.delete(e):a.set(e,t),a}))}function ge(e){return W.get(re(oe[e],e))}on((function(){if(B&&"number"===typeof $&&oe){var e=J,t=oe.length,n=t-1;if(!t)return void le(0,null);for(var a=0;a<t;a+=1){var o=ge(a);if(x&&(o=o||0),void 0===o){le(a-1,void 0,!0);break}if(e+=o,0===n&&e<=B||a===n-1&&e+ge(n)<=B){le(n,null);break}if(e+$>B){le(a-1,e-o-J+E);break}}f&&ge(0)+J>B&&K(null)}}),[B,W,E,J,re,oe]);var ue=Q&&!!ie.length,de={};null!==z&&te&&(de={position:"absolute",left:z,top:0});var he,pe={prefixCls:q,responsive:te,component:A,invalidate:ne},me=l?function(e,t){var n=re(e,t);return a.createElement(pg.Provider,{key:n,value:Ke(Ke({},pe),{},{order:t,item:e,itemKey:n,registerSize:ce,display:t<=O})},l(e,t))}:function(e,t){var n=re(e,t);return a.createElement(ug,yn({},pe,{order:t,key:n,item:e,renderItem:se,itemKey:n,registerSize:ce,display:t<=O}))},Ce={order:ue?O:Number.MAX_SAFE_INTEGER,className:"".concat(q,"-rest"),registerSize:function(e,t){F(t),M(E)},display:ue};if(C)C&&(he=a.createElement(pg.Provider,{value:Ke(Ke({},pe),Ce)},C(ie)));else{var fe=I||xg;he=a.createElement(ug,yn({},pe,Ce),"function"===typeof fe?fe(ie):fe)}var be=a.createElement(y,yn({className:Ie()(!ne&&o,p),style:h,ref:t},S),oe.map(me),ae?he:null,f&&a.createElement(ug,yn({},pe,{responsive:ee,responsiveDisabled:!te,order:O,className:"".concat(q,"-suffix"),registerSize:function(e,t){Y(t)},display:!0,style:de}),f));return ee&&(be=a.createElement(rg,{onResize:function(e,t){k(t.clientWidth)},disabled:!te},be)),be}var Zg=a.forwardRef(Gg);Zg.displayName="Overflow",Zg.Item=yg,Zg.RESPONSIVE=vg,Zg.INVALIDATE=Sg;const wg=Zg;var kg=function(e,t){var n,o=e.prefixCls,i=e.id,r=e.inputElement,s=e.disabled,l=e.tabIndex,c=e.autoFocus,g=e.autoComplete,u=e.editable,d=e.activeDescendantId,h=e.value,p=e.maxLength,m=e.onKeyDown,I=e.onMouseDown,C=e.onChange,f=e.onPaste,b=e.onCompositionStart,y=e.onCompositionEnd,A=e.open,v=e.attrs,S=r||a.createElement("input",null),x=S,G=x.ref,Z=x.props,w=Z.onKeyDown,k=Z.onChange,B=Z.onMouseDown,R=Z.onCompositionStart,W=Z.onCompositionEnd,V=Z.style;return S.props,S=a.cloneElement(S,Ke(Ke(Ke({type:"search"},Z),{},{id:i,ref:ve(t,G),disabled:s,tabIndex:l,autoComplete:g||"off",autoFocus:c,className:Ie()("".concat(o,"-selection-search-input"),null===(n=S)||void 0===n||null===(n=n.props)||void 0===n?void 0:n.className),role:"combobox","aria-expanded":A||!1,"aria-haspopup":"listbox","aria-owns":"".concat(i,"_list"),"aria-autocomplete":"list","aria-controls":"".concat(i,"_list"),"aria-activedescendant":A?d:void 0},v),{},{value:u?h:"",maxLength:p,readOnly:!u,unselectable:u?null:"on",style:Ke(Ke({},V),{},{opacity:u?null:0}),onKeyDown:function(e){m(e),w&&w(e)},onMouseDown:function(e){I(e),B&&B(e)},onChange:function(e){C(e),k&&k(e)},onCompositionStart:function(e){b(e),R&&R(e)},onCompositionEnd:function(e){y(e),W&&W(e)},onPaste:f}))};const Bg=a.forwardRef(kg);function Rg(e){return Array.isArray(e)?e:void 0!==e?[e]:[]}var Wg="undefined"!==typeof window&&window.document&&window.document.documentElement;function Vg(e){return["string","number"].includes(fe(e))}function Ng(e){var t=void 0;return e&&(Vg(e.title)?t=e.title.toString():Vg(e.label)&&(t=e.label.toString())),t}function Xg(e){var t;return null!==(t=e.key)&&void 0!==t?t:e.value}var Mg=function(e){e.preventDefault(),e.stopPropagation()};const Tg=function(e){var t,n,o=e.id,i=e.prefixCls,r=e.values,s=e.open,l=e.searchValue,c=e.autoClearSearchValue,g=e.inputRef,u=e.placeholder,d=e.disabled,h=e.mode,p=e.showSearch,m=e.autoFocus,I=e.autoComplete,C=e.activeDescendantId,f=e.tabIndex,b=e.removeIcon,y=e.maxTagCount,A=e.maxTagTextLength,v=e.maxTagPlaceholder,S=void 0===v?function(e){return"+ ".concat(e.length," ...")}:v,x=e.tagRender,G=e.onToggleOpen,Z=e.onRemove,w=e.onInputChange,k=e.onInputPaste,B=e.onInputKeyDown,R=e.onInputMouseDown,W=e.onInputCompositionStart,V=e.onInputCompositionEnd,N=a.useRef(null),X=Je((0,a.useState)(0),2),M=X[0],T=X[1],E=Je((0,a.useState)(!1),2),F=E[0],H=E[1],J="".concat(i,"-selection"),Y=s||"multiple"===h&&!1===c||"tags"===h?l:"",L="tags"===h||"multiple"===h&&!1===c||p&&(s||F);t=function(){T(N.current.scrollWidth)},n=[Y],Wg?a.useLayoutEffect(t,n):a.useEffect(t,n);var z=function(e,t,n,o,i){return a.createElement("span",{title:Ng(e),className:Ie()("".concat(J,"-item"),Me({},"".concat(J,"-item-disabled"),n))},a.createElement("span",{className:"".concat(J,"-item-content")},t),o&&a.createElement(vc,{className:"".concat(J,"-item-remove"),onMouseDown:Mg,onClick:i,customizeIcon:b},"\xd7"))},K=function(e,t,n,o,i,r){return a.createElement("span",{onMouseDown:function(e){Mg(e),G(!s)}},x({label:t,value:e,disabled:n,closable:o,onClose:i,isMaxTag:!!r}))},D=a.createElement("div",{className:"".concat(J,"-search"),style:{width:M},onFocus:function(){H(!0)},onBlur:function(){H(!1)}},a.createElement(Bg,{ref:g,open:s,prefixCls:i,id:o,inputElement:null,disabled:d,autoFocus:m,autoComplete:I,editable:L,activeDescendantId:C,value:Y,onKeyDown:B,onMouseDown:R,onChange:w,onPaste:k,onCompositionStart:W,onCompositionEnd:V,tabIndex:f,attrs:Bc(e,!0)}),a.createElement("span",{ref:N,className:"".concat(J,"-search-mirror"),"aria-hidden":!0},Y,"\xa0")),U=a.createElement(wg,{prefixCls:"".concat(J,"-overflow"),data:r,renderItem:function(e){var t=e.disabled,n=e.label,a=e.value,o=!d&&!t,i=n;if("number"===typeof A&&("string"===typeof n||"number"===typeof n)){var r=String(i);r.length>A&&(i="".concat(r.slice(0,A),"..."))}var s=function(t){t&&t.stopPropagation(),Z(e)};return"function"===typeof x?K(a,i,t,o,s):z(e,i,t,o,s)},renderRest:function(e){var t="function"===typeof S?S(e):S;return"function"===typeof x?K(void 0,t,!1,!1,void 0,!0):z({title:t},t,!1)},suffix:D,itemKey:Xg,maxCount:y});return a.createElement(a.Fragment,null,U,!r.length&&!Y&&a.createElement("span",{className:"".concat(J,"-placeholder")},u))};const Eg=function(e){var t=e.inputElement,n=e.prefixCls,o=e.id,i=e.inputRef,r=e.disabled,s=e.autoFocus,l=e.autoComplete,c=e.activeDescendantId,g=e.mode,u=e.open,d=e.values,h=e.placeholder,p=e.tabIndex,m=e.showSearch,I=e.searchValue,C=e.activeValue,f=e.maxLength,b=e.onInputKeyDown,y=e.onInputMouseDown,A=e.onInputChange,v=e.onInputPaste,S=e.onInputCompositionStart,x=e.onInputCompositionEnd,G=e.title,Z=Je(a.useState(!1),2),w=Z[0],k=Z[1],B="combobox"===g,R=B||m,W=d[0],V=I||"";B&&C&&!w&&(V=C),a.useEffect((function(){B&&k(!1)}),[B,C]);var N=!("combobox"!==g&&!u&&!m)&&!!V,X=void 0===G?Ng(W):G,M=a.useMemo((function(){return W?null:a.createElement("span",{className:"".concat(n,"-selection-placeholder"),style:N?{visibility:"hidden"}:void 0},h)}),[W,N,h,n]);return a.createElement(a.Fragment,null,a.createElement("span",{className:"".concat(n,"-selection-search")},a.createElement(Bg,{ref:i,prefixCls:n,id:o,open:u,inputElement:t,disabled:r,autoFocus:s,autoComplete:l,editable:R,activeDescendantId:c,value:V,onKeyDown:b,onMouseDown:y,onChange:function(e){k(!0),A(e)},onPaste:v,onCompositionStart:S,onCompositionEnd:x,tabIndex:p,attrs:Bc(e,!0),maxLength:B?f:void 0})),!B&&W?a.createElement("span",{className:"".concat(n,"-selection-item"),title:X,style:N?{visibility:"hidden"}:void 0},W.label):null,M)};var Fg=function(e,t){var n=(0,a.useRef)(null),o=(0,a.useRef)(!1),i=e.prefixCls,r=e.open,s=e.mode,l=e.showSearch,c=e.tokenWithEnter,g=e.disabled,u=e.autoClearSearchValue,d=e.onSearch,h=e.onSearchSubmit,p=e.onToggleOpen,m=e.onInputKeyDown,I=e.domRef;a.useImperativeHandle(t,(function(){return{focus:function(e){n.current.focus(e)},blur:function(){n.current.blur()}}}));var C=Je(xc(0),2),f=C[0],b=C[1],y=(0,a.useRef)(null),A=function(e){!1!==d(e,!0,o.current)&&p(!0)},v={inputRef:n,onInputKeyDown:function(e){var t,n=e.which;n!==Ac.UP&&n!==Ac.DOWN||e.preventDefault(),m&&m(e),n!==Ac.ENTER||"tags"!==s||o.current||r||null===h||void 0===h||h(e.target.value),t=n,[Ac.ESC,Ac.SHIFT,Ac.BACKSPACE,Ac.TAB,Ac.WIN_KEY,Ac.ALT,Ac.META,Ac.WIN_KEY_RIGHT,Ac.CTRL,Ac.SEMICOLON,Ac.EQUALS,Ac.CAPS_LOCK,Ac.CONTEXT_MENU,Ac.F1,Ac.F2,Ac.F3,Ac.F4,Ac.F5,Ac.F6,Ac.F7,Ac.F8,Ac.F9,Ac.F10,Ac.F11,Ac.F12].includes(t)||p(!0)},onInputMouseDown:function(){b(!0)},onInputChange:function(e){var t=e.target.value;if(c&&y.current&&/[\r\n]/.test(y.current)){var n=y.current.replace(/[\r\n]+$/,"").replace(/\r\n/g," ").replace(/[\r\n]/g," ");t=t.replace(n,y.current)}y.current=null,A(t)},onInputPaste:function(e){var t=e.clipboardData,n=null===t||void 0===t?void 0:t.getData("text");y.current=n||""},onInputCompositionStart:function(){o.current=!0},onInputCompositionEnd:function(e){o.current=!1,"combobox"!==s&&A(e.target.value)}},S="multiple"===s||"tags"===s?a.createElement(Tg,yn({},e,v)):a.createElement(Eg,yn({},e,v));return a.createElement("div",{ref:I,className:"".concat(i,"-selector"),onClick:function(e){e.target!==n.current&&(void 0!==document.body.style.msTouchAction?setTimeout((function(){n.current.focus()})):n.current.focus())},onMouseDown:function(e){var t=f();e.target===n.current||t||"combobox"===s&&g||e.preventDefault(),("combobox"===s||l&&t)&&r||(r&&!1!==u&&d("",!0,!1),p())}},S)};const Hg=a.forwardRef(Fg);const Jg=a.createContext(null);var Yg=[];function Lg(e){var t="rc-scrollbar-measure-".concat(Math.random().toString(36).substring(7)),n=document.createElement("div");n.id=t;var a,o,i=n.style;if(i.position="absolute",i.left="0",i.top="0",i.width="100px",i.height="100px",i.overflow="scroll",e){var r=getComputedStyle(e);i.scrollbarColor=r.scrollbarColor,i.scrollbarWidth=r.scrollbarWidth;var s=getComputedStyle(e,"::-webkit-scrollbar"),l=parseInt(s.width,10),c=parseInt(s.height,10);try{var g=l?"width: ".concat(s.width,";"):"",u=c?"height: ".concat(s.height,";"):"";ot("\n#".concat(t,"::-webkit-scrollbar {\n").concat(g,"\n").concat(u,"\n}"),t)}catch(Pke){console.error(Pke),a=l,o=c}}document.body.appendChild(n);var d=e&&a&&!isNaN(a)?a:n.offsetWidth-n.clientWidth,h=e&&o&&!isNaN(o)?o:n.offsetHeight-n.clientHeight;return document.body.removeChild(n),at(t),{width:d,height:h}}var zg="rc-util-locker-".concat(Date.now()),Kg=0;function Dg(e){var t=!!e,n=Je(a.useState((function(){return Kg+=1,"".concat(zg,"_").concat(Kg)})),1)[0];on((function(){if(t){var e=(o=document.body,"undefined"!==typeof document&&o&&o instanceof Element?Lg(o):{width:0,height:0}).width,a=document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth;ot("\nhtml body {\n  overflow-y: hidden;\n  ".concat(a?"width: calc(100% - ".concat(e,"px);"):"","\n}"),n)}else at(n);var o;return function(){at(n)}}),[t,n])}var Ug=!1;var Pg=function(e){return!1!==e&&(Ue()&&e?"string"===typeof e?document.querySelector(e):"function"===typeof e?e():e:null)},Og=a.forwardRef((function(e,t){var n=e.open,o=e.autoLock,i=e.getContainer,r=(e.debug,e.autoDestroy),s=void 0===r||r,l=e.children,c=Je(a.useState(n),2),g=c[0],u=c[1],d=g||n;a.useEffect((function(){(s||n)&&u(n)}),[n,s]);var h=Je(a.useState((function(){return Pg(i)})),2),p=h[0],m=h[1];a.useEffect((function(){var e=Pg(i);m(null!==e&&void 0!==e?e:null)}));var I=function(e,t){var n=Je(a.useState((function(){return Ue()?document.createElement("div"):null})),1)[0],o=a.useRef(!1),i=a.useContext(Jg),r=Je(a.useState(Yg),2),s=r[0],l=r[1],c=i||(o.current?void 0:function(e){l((function(t){return[e].concat(Le(t))}))});function g(){n.parentElement||document.body.appendChild(n),o.current=!0}function u(){var e;null===(e=n.parentElement)||void 0===e||e.removeChild(n),o.current=!1}return on((function(){return e?i?i(g):g():u(),u}),[e]),on((function(){s.length&&(s.forEach((function(e){return e()})),l(Yg))}),[s]),[n,c]}(d&&!p),C=Je(I,2),f=C[0],b=C[1],y=null!==p&&void 0!==p?p:f;Dg(o&&n&&Ue()&&(y===f||y===document.body));var A=null;l&&xe(l)&&t&&(A=l.ref);var v=Se(A,t);if(!d||!Ue()||void 0===p)return null;var S,x=!1===y||("boolean"===typeof S&&(Ug=S),Ug),G=l;return t&&(G=a.cloneElement(l,{ref:v})),a.createElement(Jg.Provider,{value:b},x?G:(0,tr.createPortal)(G,y))}));const _g=Og;var Qg=0;var jg=Ke({},o).useId;const qg=jg?function(e){var t=jg();return e||t}:function(e){var t=Je(a.useState("ssr-id"),2),n=t[0],o=t[1];return a.useEffect((function(){var e=Qg;Qg+=1,o("rc_unique_".concat(e))}),[]),e||n};function $g(e){var t=e.prefixCls,n=e.align,o=e.arrow,i=e.arrowPos,r=o||{},s=r.className,l=r.content,c=i.x,g=void 0===c?0:c,u=i.y,d=void 0===u?0:u,h=a.useRef();if(!n||!n.points)return null;var p={position:"absolute"};if(!1!==n.autoArrow){var m=n.points[0],I=n.points[1],C=m[0],f=m[1],b=I[0],y=I[1];C!==b&&["t","b"].includes(C)?"t"===C?p.top=0:p.bottom=0:p.top=d,f!==y&&["l","r"].includes(f)?"l"===f?p.left=0:p.right=0:p.left=g}return a.createElement("div",{ref:h,className:Ie()("".concat(t,"-arrow"),s),style:p},l)}function eu(e){var t=e.prefixCls,n=e.open,o=e.zIndex,i=e.mask,r=e.motion;return i?a.createElement(qr,yn({},r,{motionAppear:!0,visible:n,removeOnLeave:!0}),(function(e){var n=e.className;return a.createElement("div",{style:{zIndex:o},className:Ie()("".concat(t,"-mask"),n)})})):null}var tu=a.memo((function(e){return e.children}),(function(e,t){return t.cache}));const nu=tu;var au=a.forwardRef((function(e,t){var n=e.popup,o=e.className,i=e.prefixCls,r=e.style,s=e.target,l=e.onVisibleChanged,c=e.open,g=e.keepDom,u=e.fresh,d=e.onClick,h=e.mask,p=e.arrow,m=e.arrowPos,I=e.align,C=e.motion,f=e.maskMotion,b=e.forceRender,y=e.getPopupContainer,A=e.autoDestroy,v=e.portal,S=e.zIndex,x=e.onMouseEnter,G=e.onMouseLeave,Z=e.onPointerEnter,w=e.ready,k=e.offsetX,B=e.offsetY,R=e.offsetR,W=e.offsetB,V=e.onAlign,N=e.onPrepare,X=e.stretch,M=e.targetWidth,T=e.targetHeight,E="function"===typeof n?n():n,F=c||g,H=(null===y||void 0===y?void 0:y.length)>0,J=Je(a.useState(!y||!H),2),Y=J[0],L=J[1];if(on((function(){!Y&&H&&s&&L(!0)}),[Y,H,s]),!Y)return null;var z="auto",K={left:"-1000vw",top:"-1000vh",right:z,bottom:z};if(w||!c){var D,U=I.points,P=I.dynamicInset||(null===(D=I._experimental)||void 0===D?void 0:D.dynamicInset),O=P&&"r"===U[0][1],_=P&&"b"===U[0][0];O?(K.right=R,K.left=z):(K.left=k,K.right=z),_?(K.bottom=W,K.top=z):(K.top=B,K.bottom=z)}var Q={};return X&&(X.includes("height")&&T?Q.height=T:X.includes("minHeight")&&T&&(Q.minHeight=T),X.includes("width")&&M?Q.width=M:X.includes("minWidth")&&M&&(Q.minWidth=M)),c||(Q.pointerEvents="none"),a.createElement(v,{open:b||F,getContainer:y&&function(){return y(s)},autoDestroy:A},a.createElement(eu,{prefixCls:i,open:c,zIndex:S,mask:h,motion:f}),a.createElement(rg,{onResize:V,disabled:!c},(function(e){return a.createElement(qr,yn({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:b,leavedClassName:"".concat(i,"-hidden")},C,{onAppearPrepare:N,onEnterPrepare:N,visible:c,onVisibleChanged:function(e){var t;null===C||void 0===C||null===(t=C.onVisibleChanged)||void 0===t||t.call(C,e),l(e)}}),(function(n,s){var l=n.className,g=n.style,h=Ie()(i,l,o);return a.createElement("div",{ref:ve(e,t,s),className:h,style:Ke(Ke(Ke(Ke({"--arrow-x":"".concat(m.x||0,"px"),"--arrow-y":"".concat(m.y||0,"px")},K),Q),g),{},{boxSizing:"border-box",zIndex:S},r),onMouseEnter:x,onMouseLeave:G,onPointerEnter:Z,onClick:d},p&&a.createElement($g,{prefixCls:i,arrow:p,arrowPos:m,align:I}),a.createElement(nu,{cache:!c&&!u},E))}))})))}));const ou=au;var iu=a.forwardRef((function(e,t){var n=e.children,o=e.getTriggerDOMNode,i=xe(n),r=a.useCallback((function(e){Ae(t,o?o(e):e)}),[o]),s=Se(r,n.ref);return i?a.cloneElement(n,{ref:s}):n}));const ru=iu;const su=a.createContext(null);function lu(e){return e?Array.isArray(e)?e:[e]:[]}function cu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(arguments.length>2?arguments[2]:void 0)?e[0]===t[0]:e[0]===t[0]&&e[1]===t[1]}function gu(e,t,n,a){return t||(n?{motionName:"".concat(e,"-").concat(n)}:a?{motionName:a}:null)}function uu(e){return e.ownerDocument.defaultView}function du(e){for(var t=[],n=null===e||void 0===e?void 0:e.parentElement,a=["hidden","scroll","clip","auto"];n;){var o=uu(n).getComputedStyle(n);[o.overflowX,o.overflowY,o.overflow].some((function(e){return a.includes(e)}))&&t.push(n),n=n.parentElement}return t}function hu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Number.isNaN(e)?t:e}function pu(e){return hu(parseFloat(e),0)}function mu(e,t){var n=Ke({},e);return(t||[]).forEach((function(e){if(!(e instanceof HTMLBodyElement||e instanceof HTMLHtmlElement)){var t=uu(e).getComputedStyle(e),a=t.overflow,o=t.overflowClipMargin,i=t.borderTopWidth,r=t.borderBottomWidth,s=t.borderLeftWidth,l=t.borderRightWidth,c=e.getBoundingClientRect(),g=e.offsetHeight,u=e.clientHeight,d=e.offsetWidth,h=e.clientWidth,p=pu(i),m=pu(r),I=pu(s),C=pu(l),f=hu(Math.round(c.width/d*1e3)/1e3),b=hu(Math.round(c.height/g*1e3)/1e3),y=(d-h-I-C)*f,A=(g-u-p-m)*b,v=p*b,S=m*b,x=I*f,G=C*f,Z=0,w=0;if("clip"===a){var k=pu(o);Z=k*f,w=k*b}var B=c.x+x-Z,R=c.y+v-w,W=B+c.width+2*Z-x-G-y,V=R+c.height+2*w-v-S-A;n.left=Math.max(n.left,B),n.top=Math.max(n.top,R),n.right=Math.min(n.right,W),n.bottom=Math.min(n.bottom,V)}})),n}function Iu(e){var t="".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),n=t.match(/^(.*)\%$/);return n?e*(parseFloat(n[1])/100):parseFloat(t)}function Cu(e,t){var n=Je(t||[],2),a=n[0],o=n[1];return[Iu(e.width,a),Iu(e.height,o)]}function fu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[e[0],e[1]]}function bu(e,t){var n,a=t[0],o=t[1];return n="t"===a?e.y:"b"===a?e.y+e.height:e.y+e.height/2,{x:"l"===o?e.x:"r"===o?e.x+e.width:e.x+e.width/2,y:n}}function yu(e,t){var n={t:"b",b:"t",l:"r",r:"l"};return e.map((function(e,a){return a===t?n[e]||"c":e})).join("")}var Au=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];const vu=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_g,t=a.forwardRef((function(t,n){var o=t.prefixCls,i=void 0===o?"rc-trigger-popup":o,r=t.children,s=t.action,l=void 0===s?"hover":s,c=t.showAction,g=t.hideAction,u=t.popupVisible,d=t.defaultPopupVisible,h=t.onPopupVisibleChange,p=t.afterPopupVisibleChange,m=t.mouseEnterDelay,I=t.mouseLeaveDelay,C=void 0===I?.1:I,f=t.focusDelay,b=t.blurDelay,y=t.mask,A=t.maskClosable,v=void 0===A||A,S=t.getPopupContainer,x=t.forceRender,G=t.autoDestroy,Z=t.destroyPopupOnHide,w=t.popup,k=t.popupClassName,B=t.popupStyle,R=t.popupPlacement,W=t.builtinPlacements,V=void 0===W?{}:W,N=t.popupAlign,X=t.zIndex,M=t.stretch,T=t.getPopupClassNameFromAlign,E=t.fresh,F=t.alignPoint,H=t.onPopupClick,J=t.onPopupAlign,Y=t.arrow,L=t.popupMotion,z=t.maskMotion,K=t.popupTransitionName,D=t.popupAnimation,U=t.maskTransitionName,P=t.maskAnimation,O=t.className,_=t.getTriggerDOMNode,Q=ir(t,Au),j=G||Z||!1,q=Je(a.useState(!1),2),$=q[0],ee=q[1];on((function(){ee(bc())}),[]);var te=a.useRef({}),ne=a.useContext(su),ae=a.useMemo((function(){return{registerSubPopup:function(e,t){te.current[e]=t,null===ne||void 0===ne||ne.registerSubPopup(e,t)}}}),[ne]),oe=qg(),ie=Je(a.useState(null),2),re=ie[0],se=ie[1],le=a.useRef(null),ce=ka((function(e){le.current=e,ar(e)&&re!==e&&se(e),null===ne||void 0===ne||ne.registerSubPopup(oe,e)})),ge=Je(a.useState(null),2),ue=ge[0],de=ge[1],he=a.useRef(null),pe=ka((function(e){ar(e)&&ue!==e&&(de(e),he.current=e)})),me=a.Children.only(r),Ce=(null===me||void 0===me?void 0:me.props)||{},fe={},be=ka((function(e){var t,n,a=ue;return(null===a||void 0===a?void 0:a.contains(e))||(null===(t=el(a))||void 0===t?void 0:t.host)===e||e===a||(null===re||void 0===re?void 0:re.contains(e))||(null===(n=el(re))||void 0===n?void 0:n.host)===e||e===re||Object.values(te.current).some((function(t){return(null===t||void 0===t?void 0:t.contains(e))||e===t}))})),ye=gu(i,L,D,K),Ae=gu(i,z,P,U),ve=Je(a.useState(d||!1),2),Se=ve[0],xe=ve[1],Ge=null!==u&&void 0!==u?u:Se,we=ka((function(e){void 0===u&&xe(e)}));on((function(){xe(u||!1)}),[u]);var ke=a.useRef(Ge);ke.current=Ge;var Be=a.useRef([]);Be.current=[];var Re=ka((function(e){var t;we(e),(null!==(t=Be.current[Be.current.length-1])&&void 0!==t?t:Ge)!==e&&(Be.current.push(e),null===h||void 0===h||h(e))})),We=a.useRef(),Ve=function(){clearTimeout(We.current)},Ne=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Ve(),0===t?Re(e):We.current=setTimeout((function(){Re(e)}),1e3*t)};a.useEffect((function(){return Ve}),[]);var Xe=Je(a.useState(!1),2),Me=Xe[0],Te=Xe[1];on((function(e){e&&!Ge||Te(!0)}),[Ge]);var Ee=Je(a.useState(null),2),Fe=Ee[0],He=Ee[1],Ye=Je(a.useState([0,0]),2),ze=Ye[0],De=Ye[1],Ue=function(e){De([e.clientX,e.clientY])},Pe=function(e,t,n,o,i,r,s){var l=Je(a.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:i[o]||{}}),2),c=l[0],g=l[1],u=a.useRef(0),d=a.useMemo((function(){return t?du(t):[]}),[t]),h=a.useRef({});e||(h.current={});var p=ka((function(){if(t&&n&&e){var a,l,c,u=t,p=u.ownerDocument,m=uu(u).getComputedStyle(u),I=m.width,C=m.height,f=m.position,b=u.style.left,y=u.style.top,A=u.style.right,v=u.style.bottom,S=u.style.overflow,x=Ke(Ke({},i[o]),r),G=p.createElement("div");if(null===(a=u.parentElement)||void 0===a||a.appendChild(G),G.style.left="".concat(u.offsetLeft,"px"),G.style.top="".concat(u.offsetTop,"px"),G.style.position=f,G.style.height="".concat(u.offsetHeight,"px"),G.style.width="".concat(u.offsetWidth,"px"),u.style.left="0",u.style.top="0",u.style.right="auto",u.style.bottom="auto",u.style.overflow="hidden",Array.isArray(n))c={x:n[0],y:n[1],width:0,height:0};else{var Z=n.getBoundingClientRect();c={x:Z.x,y:Z.y,width:Z.width,height:Z.height}}var w=u.getBoundingClientRect(),k=p.documentElement,B=k.clientWidth,R=k.clientHeight,W=k.scrollWidth,V=k.scrollHeight,N=k.scrollTop,X=k.scrollLeft,M=w.height,T=w.width,E=c.height,F=c.width,H={left:0,top:0,right:B,bottom:R},J={left:-X,top:-N,right:W-X,bottom:V-N},Y=x.htmlRegion,L="visible",z="visibleFirst";"scroll"!==Y&&Y!==z&&(Y=L);var K=Y===z,D=mu(J,d),U=mu(H,d),P=Y===L?U:D,O=K?U:P;u.style.left="auto",u.style.top="auto",u.style.right="0",u.style.bottom="0";var _=u.getBoundingClientRect();u.style.left=b,u.style.top=y,u.style.right=A,u.style.bottom=v,u.style.overflow=S,null===(l=u.parentElement)||void 0===l||l.removeChild(G);var Q=hu(Math.round(T/parseFloat(I)*1e3)/1e3),j=hu(Math.round(M/parseFloat(C)*1e3)/1e3);if(0===Q||0===j||ar(n)&&!Ze(n))return;var q=x.offset,$=x.targetOffset,ee=Je(Cu(w,q),2),te=ee[0],ne=ee[1],ae=Je(Cu(c,$),2),oe=ae[0],ie=ae[1];c.x-=oe,c.y-=ie;var re=Je(x.points||[],2),se=re[0],le=fu(re[1]),ce=fu(se),ge=bu(c,le),ue=bu(w,ce),de=Ke({},x),he=ge.x-ue.x+te,pe=ge.y-ue.y+ne;function gt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P,a=w.x+e,o=w.y+t,i=a+T,r=o+M,s=Math.max(a,n.left),l=Math.max(o,n.top),c=Math.min(i,n.right),g=Math.min(r,n.bottom);return Math.max(0,(c-s)*(g-l))}var me,Ie,Ce,fe,be=gt(he,pe),ye=gt(he,pe,U),Ae=bu(c,["t","l"]),ve=bu(w,["t","l"]),Se=bu(c,["b","r"]),xe=bu(w,["b","r"]),Ge=x.overflow||{},we=Ge.adjustX,ke=Ge.adjustY,Be=Ge.shiftX,Re=Ge.shiftY,We=function(e){return"boolean"===typeof e?e:e>=0};function ut(){me=w.y+pe,Ie=me+M,Ce=w.x+he,fe=Ce+T}ut();var Ve=We(ke),Ne=ce[0]===le[0];if(Ve&&"t"===ce[0]&&(Ie>O.bottom||h.current.bt)){var Xe=pe;Ne?Xe-=M-E:Xe=Ae.y-xe.y-ne;var Me=gt(he,Xe),Te=gt(he,Xe,U);Me>be||Me===be&&(!K||Te>=ye)?(h.current.bt=!0,pe=Xe,ne=-ne,de.points=[yu(ce,0),yu(le,0)]):h.current.bt=!1}if(Ve&&"b"===ce[0]&&(me<O.top||h.current.tb)){var Ee=pe;Ne?Ee+=M-E:Ee=Se.y-ve.y-ne;var Fe=gt(he,Ee),He=gt(he,Ee,U);Fe>be||Fe===be&&(!K||He>=ye)?(h.current.tb=!0,pe=Ee,ne=-ne,de.points=[yu(ce,0),yu(le,0)]):h.current.tb=!1}var Ye=We(we),Le=ce[1]===le[1];if(Ye&&"l"===ce[1]&&(fe>O.right||h.current.rl)){var ze=he;Le?ze-=T-F:ze=Ae.x-xe.x-te;var De=gt(ze,pe),Ue=gt(ze,pe,U);De>be||De===be&&(!K||Ue>=ye)?(h.current.rl=!0,he=ze,te=-te,de.points=[yu(ce,1),yu(le,1)]):h.current.rl=!1}if(Ye&&"r"===ce[1]&&(Ce<O.left||h.current.lr)){var Pe=he;Le?Pe+=T-F:Pe=Se.x-ve.x-te;var Oe=gt(Pe,pe),_e=gt(Pe,pe,U);Oe>be||Oe===be&&(!K||_e>=ye)?(h.current.lr=!0,he=Pe,te=-te,de.points=[yu(ce,1),yu(le,1)]):h.current.lr=!1}ut();var Qe=!0===Be?0:Be;"number"===typeof Qe&&(Ce<U.left&&(he-=Ce-U.left-te,c.x+F<U.left+Qe&&(he+=c.x-U.left+F-Qe)),fe>U.right&&(he-=fe-U.right-te,c.x>U.right-Qe&&(he+=c.x-U.right+Qe)));var je=!0===Re?0:Re;"number"===typeof je&&(me<U.top&&(pe-=me-U.top-ne,c.y+E<U.top+je&&(pe+=c.y-U.top+E-je)),Ie>U.bottom&&(pe-=Ie-U.bottom-ne,c.y>U.bottom-je&&(pe+=c.y-U.bottom+je)));var qe=w.x+he,$e=qe+T,et=w.y+pe,tt=et+M,nt=c.x,at=nt+F,ot=c.y,it=ot+E,rt=(Math.max(qe,nt)+Math.min($e,at))/2-qe,st=(Math.max(et,ot)+Math.min(tt,it))/2-et;null===s||void 0===s||s(t,de);var lt=_.right-w.x-(he+w.width),ct=_.bottom-w.y-(pe+w.height);1===Q&&(he=Math.round(he),lt=Math.round(lt)),1===j&&(pe=Math.round(pe),ct=Math.round(ct)),g({ready:!0,offsetX:he/Q,offsetY:pe/j,offsetR:lt/Q,offsetB:ct/j,arrowX:rt/Q,arrowY:st/j,scaleX:Q,scaleY:j,align:de})}})),m=function(){g((function(e){return Ke(Ke({},e),{},{ready:!1})}))};return on(m,[o]),on((function(){e||m()}),[e]),[c.ready,c.offsetX,c.offsetY,c.offsetR,c.offsetB,c.arrowX,c.arrowY,c.scaleX,c.scaleY,c.align,function(){u.current+=1;var e=u.current;Promise.resolve().then((function(){u.current===e&&p()}))}]}(Ge,re,F?ze:ue,R,V,N,J),Oe=Je(Pe,11),_e=Oe[0],Qe=Oe[1],je=Oe[2],qe=Oe[3],$e=Oe[4],et=Oe[5],tt=Oe[6],nt=Oe[7],at=Oe[8],ot=Oe[9],it=Oe[10],rt=function(e,t,n,o){return a.useMemo((function(){var a=lu(null!==n&&void 0!==n?n:t),i=lu(null!==o&&void 0!==o?o:t),r=new Set(a),s=new Set(i);return e&&(r.has("hover")&&(r.delete("hover"),r.add("click")),s.has("hover")&&(s.delete("hover"),s.add("click"))),[r,s]}),[e,t,n,o])}($,l,c,g),st=Je(rt,2),lt=st[0],ct=st[1],gt=lt.has("click"),ut=ct.has("click")||ct.has("contextMenu"),dt=ka((function(){Me||it()}));!function(e,t,n,a,o){on((function(){if(e&&t&&n){var i=n,r=du(t),s=du(i),l=uu(i),c=new Set([l].concat(Le(r),Le(s)));function g(){a(),o()}return c.forEach((function(e){e.addEventListener("scroll",g,{passive:!0})})),l.addEventListener("resize",g,{passive:!0}),a(),function(){c.forEach((function(e){e.removeEventListener("scroll",g),l.removeEventListener("resize",g)}))}}}),[e,t,n])}(Ge,ue,re,dt,(function(){ke.current&&F&&ut&&Ne(!1)})),on((function(){dt()}),[ze,R]),on((function(){!Ge||null!==V&&void 0!==V&&V[R]||dt()}),[JSON.stringify(N)]);var ht=a.useMemo((function(){var e=function(e,t,n,a){for(var o=n.points,i=Object.keys(e),r=0;r<i.length;r+=1){var s,l=i[r];if(cu(null===(s=e[l])||void 0===s?void 0:s.points,o,a))return"".concat(t,"-placement-").concat(l)}return""}(V,i,ot,F);return Ie()(e,null===T||void 0===T?void 0:T(ot))}),[ot,T,V,i,F]);a.useImperativeHandle(n,(function(){return{nativeElement:he.current,popupElement:le.current,forceAlign:dt}}));var pt=Je(a.useState(0),2),mt=pt[0],It=pt[1],Ct=Je(a.useState(0),2),ft=Ct[0],bt=Ct[1],yt=function(){if(M&&ue){var e=ue.getBoundingClientRect();It(e.width),bt(e.height)}};function At(e,t,n,a){fe[e]=function(o){var i;null===a||void 0===a||a(o),Ne(t,n);for(var r=arguments.length,s=new Array(r>1?r-1:0),l=1;l<r;l++)s[l-1]=arguments[l];null===(i=Ce[e])||void 0===i||i.call.apply(i,[Ce,o].concat(s))}}on((function(){Fe&&(it(),Fe(),He(null))}),[Fe]),(gt||ut)&&(fe.onClick=function(e){var t;ke.current&&ut?Ne(!1):!ke.current&&gt&&(Ue(e),Ne(!0));for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];null===(t=Ce.onClick)||void 0===t||t.call.apply(t,[Ce,e].concat(a))}),function(e,t,n,o,i,r,s,l){var c=a.useRef(e);c.current=e,a.useEffect((function(){if(t&&o&&(!i||r)){var e=function(e){var t=e.target;c.current&&!s(t)&&l(!1)},a=uu(o);a.addEventListener("mousedown",e,!0),a.addEventListener("contextmenu",e,!0);var g=el(n);return g&&(g.addEventListener("mousedown",e,!0),g.addEventListener("contextmenu",e,!0)),function(){a.removeEventListener("mousedown",e,!0),a.removeEventListener("contextmenu",e,!0),g&&(g.removeEventListener("mousedown",e,!0),g.removeEventListener("contextmenu",e,!0))}}}),[t,n,o,i,r])}(Ge,ut,ue,re,y,v,be,Ne);var vt,St,xt=lt.has("hover"),Gt=ct.has("hover");xt&&(At("onMouseEnter",!0,m,(function(e){Ue(e)})),At("onPointerEnter",!0,m,(function(e){Ue(e)})),vt=function(e){(Ge||Me)&&null!==re&&void 0!==re&&re.contains(e.target)&&Ne(!0,m)},F&&(fe.onMouseMove=function(e){var t;null===(t=Ce.onMouseMove)||void 0===t||t.call(Ce,e)})),Gt&&(At("onMouseLeave",!1,C),At("onPointerLeave",!1,C),St=function(){Ne(!1,C)}),lt.has("focus")&&At("onFocus",!0,f),ct.has("focus")&&At("onBlur",!1,b),lt.has("contextMenu")&&(fe.onContextMenu=function(e){var t;ke.current&&ct.has("contextMenu")?Ne(!1):(Ue(e),Ne(!0)),e.preventDefault();for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];null===(t=Ce.onContextMenu)||void 0===t||t.call.apply(t,[Ce,e].concat(a))}),O&&(fe.className=Ie()(Ce.className,O));var Zt=Ke(Ke({},Ce),fe),wt={};["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"].forEach((function(e){Q[e]&&(wt[e]=function(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];null===(t=Zt[e])||void 0===t||t.call.apply(t,[Zt].concat(a)),Q[e].apply(Q,a)})}));var kt=a.cloneElement(me,Ke(Ke({},Zt),wt)),Bt={x:et,y:tt},Rt=Y?Ke({},!0!==Y?Y:{}):null;return a.createElement(a.Fragment,null,a.createElement(rg,{disabled:!Ge,ref:pe,onResize:function(){yt(),dt()}},a.createElement(ru,{getTriggerDOMNode:_},kt)),a.createElement(su.Provider,{value:ae},a.createElement(ou,{portal:e,ref:ce,prefixCls:i,popup:w,className:Ie()(k,ht),style:B,target:ue,onMouseEnter:vt,onMouseLeave:St,onPointerEnter:vt,zIndex:X,open:Ge,keepDom:Me,fresh:E,onClick:H,mask:y,motion:ye,maskMotion:Ae,onVisibleChanged:function(e){Te(!1),it(),null===p||void 0===p||p(e)},onPrepare:function(){return new Promise((function(e){yt(),He((function(){return e}))}))},forceRender:x,autoDestroy:j,getPopupContainer:S,align:ot,arrow:Rt,arrowPos:Bt,ready:_e,offsetX:Qe,offsetY:je,offsetR:qe,offsetB:$e,onAlign:dt,stretch:M,targetWidth:mt/nt,targetHeight:ft/at})))}));return t}(_g);var Su=["prefixCls","disabled","visible","children","popupElement","animation","transitionName","dropdownStyle","dropdownClassName","direction","placement","builtinPlacements","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","getPopupContainer","empty","getTriggerDOMNode","onPopupVisibleChange","onPopupMouseEnter"],xu=function(e,t){var n=e.prefixCls,o=(e.disabled,e.visible),i=e.children,r=e.popupElement,s=e.animation,l=e.transitionName,c=e.dropdownStyle,g=e.dropdownClassName,u=e.direction,d=void 0===u?"ltr":u,h=e.placement,p=e.builtinPlacements,m=e.dropdownMatchSelectWidth,I=e.dropdownRender,C=e.dropdownAlign,f=e.getPopupContainer,b=e.empty,y=e.getTriggerDOMNode,A=e.onPopupVisibleChange,v=e.onPopupMouseEnter,S=ir(e,Su),x="".concat(n,"-dropdown"),G=r;I&&(G=I(r));var Z=a.useMemo((function(){return p||function(e){var t=!0===e?0:1;return{bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"}}}(m)}),[p,m]),w=s?"".concat(x,"-").concat(s):l,k="number"===typeof m,B=a.useMemo((function(){return k?null:!1===m?"minWidth":"width"}),[m,k]),R=c;k&&(R=Ke(Ke({},R),{},{width:m}));var W=a.useRef(null);return a.useImperativeHandle(t,(function(){return{getPopupElement:function(){var e;return null===(e=W.current)||void 0===e?void 0:e.popupElement}}})),a.createElement(vu,yn({},S,{showAction:A?["click"]:[],hideAction:A?["click"]:[],popupPlacement:h||("rtl"===d?"bottomRight":"bottomLeft"),builtinPlacements:Z,prefixCls:x,popupTransitionName:w,popup:a.createElement("div",{onMouseEnter:v},G),ref:W,stretch:B,popupAlign:C,popupVisible:o,getPopupContainer:f,popupClassName:Ie()(g,Me({},"".concat(x,"-empty"),b)),popupStyle:R,getTriggerDOMNode:y,onPopupVisibleChange:A}),i)};const Gu=a.forwardRef(xu);function Zu(e,t){var n,a=e.key;return"value"in e&&(n=e.value),null!==a&&void 0!==a?a:void 0!==n?n:"rc-index-key-".concat(t)}function wu(e){return"undefined"!==typeof e&&!Number.isNaN(e)}function ku(e,t){var n=e||{},a=n.label||(t?"children":"label");return{label:a,value:n.value||"value",options:n.options||"options",groupLabel:n.groupLabel||a}}function Bu(e){var t=Ke({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return ut(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),t}}),t}const Ru=a.createContext(null);function Wu(e){var t=e.visible,n=e.values;if(!t)return null;return a.createElement("span",{"aria-live":"polite",style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},"".concat(n.slice(0,50).map((function(e){var t=e.label,n=e.value;return["number","string"].includes(fe(t))?t:n})).join(", ")),n.length>50?", ...":null)}var Vu=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","suffixIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","builtinPlacements","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],Nu=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"],Xu=function(e){return"tags"===e||"multiple"===e},Mu=a.forwardRef((function(e,t){var n,o=e.id,i=e.prefixCls,r=e.className,s=e.showSearch,l=e.tagRender,c=e.direction,g=e.omitDomProps,u=e.displayValues,d=e.onDisplayValuesChange,h=e.emptyOptions,p=e.notFoundContent,m=void 0===p?"Not Found":p,I=e.onClear,C=e.mode,f=e.disabled,b=e.loading,y=e.getInputElement,A=e.getRawInputElement,v=e.open,S=e.defaultOpen,x=e.onDropdownVisibleChange,G=e.activeValue,Z=e.onActiveValueChange,w=e.activeDescendantId,k=e.searchValue,B=e.autoClearSearchValue,R=e.onSearch,W=e.onSearchSplit,V=e.tokenSeparators,N=e.allowClear,X=e.suffixIcon,M=e.clearIcon,T=e.OptionList,E=e.animation,F=e.transitionName,H=e.dropdownStyle,J=e.dropdownClassName,Y=e.dropdownMatchSelectWidth,L=e.dropdownRender,z=e.dropdownAlign,K=e.placement,D=e.builtinPlacements,U=e.getPopupContainer,P=e.showAction,O=void 0===P?[]:P,_=e.onFocus,Q=e.onBlur,j=e.onKeyUp,q=e.onKeyDown,$=e.onMouseDown,ee=ir(e,Vu),te=Xu(C),ne=(void 0!==s?s:te)||"combobox"===C,ae=Ke({},ee);Nu.forEach((function(e){delete ae[e]})),null===g||void 0===g||g.forEach((function(e){delete ae[e]}));var oe=Je(a.useState(!1),2),ie=oe[0],re=oe[1];a.useEffect((function(){re(bc())}),[]);var se=a.useRef(null),le=a.useRef(null),ce=a.useRef(null),ge=a.useRef(null),ue=a.useRef(null),de=a.useRef(!1),he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=Je(a.useState(!1),2),n=t[0],o=t[1],i=a.useRef(null),r=function(){window.clearTimeout(i.current)};return a.useEffect((function(){return r}),[]),[n,function(t,n){r(),i.current=window.setTimeout((function(){o(t),n&&n()}),e)},r]}(),pe=Je(he,3),me=pe[0],Ce=pe[1],be=pe[2];a.useImperativeHandle(t,(function(){var e,t;return{focus:null===(e=ge.current)||void 0===e?void 0:e.focus,blur:null===(t=ge.current)||void 0===t?void 0:t.blur,scrollTo:function(e){var t;return null===(t=ue.current)||void 0===t?void 0:t.scrollTo(e)},nativeElement:se.current||le.current}}));var ye=a.useMemo((function(){var e;if("combobox"!==C)return k;var t=null===(e=u[0])||void 0===e?void 0:e.value;return"string"===typeof t||"number"===typeof t?String(t):""}),[k,C,u]),Ae="combobox"===C&&"function"===typeof y&&y()||null,ve="function"===typeof A&&A(),xe=Se(le,null===ve||void 0===ve||null===(n=ve.props)||void 0===n?void 0:n.ref),Ge=Je(a.useState(!1),2),Ze=Ge[0],we=Ge[1];on((function(){we(!0)}),[]);var ke=Je(Wa(!1,{defaultValue:S,value:v}),2),Be=ke[0],Re=ke[1],We=!!Ze&&Be,Ve=!m&&h;(f||Ve&&We&&"combobox"===C)&&(We=!1);var Ne=!Ve&&We,Xe=a.useCallback((function(e){var t=void 0!==e?e:!We;f||(Re(t),We!==t&&(null===x||void 0===x||x(t)))}),[f,We,Re,x]),Te=a.useMemo((function(){return(V||[]).some((function(e){return["\n","\r\n"].includes(e)}))}),[V]),Ee=a.useContext(Ru)||{},Fe=Ee.maxCount,He=Ee.rawValues,Ye=function(e,t,n){if(!(te&&wu(Fe)&&(null===He||void 0===He?void 0:He.size)>=Fe)){var a=!0,o=e;null===Z||void 0===Z||Z(null);var i=function(e,t,n){if(!t||!t.length)return null;var a=!1,o=function e(t,n){var o=Va(n),i=o[0],r=o.slice(1);if(!i)return[t];var s=t.split(i);return a=a||s.length>1,s.reduce((function(t,n){return[].concat(Le(t),Le(e(n,r)))}),[]).filter(Boolean)}(e,t);return a?"undefined"!==typeof n?o.slice(0,n):o:null}(e,V,wu(Fe)?Fe-He.size:void 0),r=n?null:i;return"combobox"!==C&&r&&(o="",null===W||void 0===W||W(r),Xe(!1),a=!1),R&&ye!==o&&R(o,{source:t?"typing":"effect"}),a}};a.useEffect((function(){We||te||"combobox"===C||Ye("",!1,!1)}),[We]),a.useEffect((function(){Be&&f&&Re(!1),f&&!de.current&&Ce(!1)}),[f]);var ze=Je(xc(),2),De=ze[0],Ue=ze[1],Pe=a.useRef(!1),Oe=[];a.useEffect((function(){return function(){Oe.forEach((function(e){return clearTimeout(e)})),Oe.splice(0,Oe.length)}}),[]);var _e,Qe=Je(a.useState({}),2)[1];ve&&(_e=function(e){Xe(e)}),function(e,t,n,o){var i=a.useRef(null);i.current={open:t,triggerOpen:n,customizedTrigger:o},a.useEffect((function(){function t(t){var n;if(null===(n=i.current)||void 0===n||!n.customizedTrigger){var a=t.target;a.shadowRoot&&t.composed&&(a=t.composedPath()[0]||a),i.current.open&&e().filter((function(e){return e})).every((function(e){return!e.contains(a)&&e!==a}))&&i.current.triggerOpen(!1)}}return window.addEventListener("mousedown",t),function(){return window.removeEventListener("mousedown",t)}}),[])}((function(){var e;return[se.current,null===(e=ce.current)||void 0===e?void 0:e.getPopupElement()]}),Ne,Xe,!!ve);var je,qe=a.useMemo((function(){return Ke(Ke({},e),{},{notFoundContent:m,open:We,triggerOpen:Ne,id:o,showSearch:ne,multiple:te,toggleOpen:Xe})}),[e,m,Ne,We,o,ne,te,Xe]),$e=!!X||b;$e&&(je=a.createElement(vc,{className:Ie()("".concat(i,"-arrow"),Me({},"".concat(i,"-arrow-loading"),b)),customizeIcon:X,customizeIconProps:{loading:b,searchValue:ye,open:We,focused:me,showSearch:ne}}));var et,tt=function(e,t,n,o,i){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,c=a.useMemo((function(){return"object"===fe(o)?o.clearIcon:i||void 0}),[o,i]);return{allowClear:a.useMemo((function(){return!(r||!o||!n.length&&!s||"combobox"===l&&""===s)}),[o,r,n.length,s,l]),clearIcon:a.createElement(vc,{className:"".concat(e,"-clear"),onMouseDown:t,customizeIcon:c},"\xd7")}}(i,(function(){var e;null===I||void 0===I||I(),null===(e=ge.current)||void 0===e||e.focus(),d([],{type:"clear",values:u}),Ye("",!1,!1)}),u,N,M,f,ye,C),nt=tt.allowClear,at=tt.clearIcon,ot=a.createElement(T,{ref:ue}),it=Ie()(i,r,Me(Me(Me(Me(Me(Me(Me(Me(Me(Me({},"".concat(i,"-focused"),me),"".concat(i,"-multiple"),te),"".concat(i,"-single"),!te),"".concat(i,"-allow-clear"),N),"".concat(i,"-show-arrow"),$e),"".concat(i,"-disabled"),f),"".concat(i,"-loading"),b),"".concat(i,"-open"),We),"".concat(i,"-customize-input"),Ae),"".concat(i,"-show-search"),ne)),rt=a.createElement(Gu,{ref:ce,disabled:f,prefixCls:i,visible:Ne,popupElement:ot,animation:E,transitionName:F,dropdownStyle:H,dropdownClassName:J,direction:c,dropdownMatchSelectWidth:Y,dropdownRender:L,dropdownAlign:z,placement:K,builtinPlacements:D,getPopupContainer:U,empty:h,getTriggerDOMNode:function(e){return le.current||e},onPopupVisibleChange:_e,onPopupMouseEnter:function(){Qe({})}},ve?a.cloneElement(ve,{ref:xe}):a.createElement(Hg,yn({},e,{domRef:le,prefixCls:i,inputElement:Ae,ref:ge,id:o,showSearch:ne,autoClearSearchValue:B,mode:C,activeDescendantId:w,tagRender:l,values:u,open:We,onToggleOpen:Xe,activeValue:G,searchValue:ye,onSearch:Ye,onSearchSubmit:function(e){e&&e.trim()&&R(e,{source:"submit"})},onRemove:function(e){var t=u.filter((function(t){return t!==e}));d(t,{type:"remove",values:[e]})},tokenWithEnter:Te})));return et=ve?rt:a.createElement("div",yn({className:it},ae,{ref:se,onMouseDown:function(e){var t,n=e.target,a=null===(t=ce.current)||void 0===t?void 0:t.getPopupElement();if(a&&a.contains(n)){var o=setTimeout((function(){var e,t=Oe.indexOf(o);-1!==t&&Oe.splice(t,1),be(),ie||a.contains(document.activeElement)||null===(e=ge.current)||void 0===e||e.focus()}));Oe.push(o)}for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];null===$||void 0===$||$.apply(void 0,[e].concat(r))},onKeyDown:function(e){var t,n=De(),a=e.which;if(a===Ac.ENTER&&("combobox"!==C&&e.preventDefault(),We||Xe(!0)),Ue(!!ye),a===Ac.BACKSPACE&&!n&&te&&!ye&&u.length){for(var o=Le(u),i=null,r=o.length-1;r>=0;r-=1){var s=o[r];if(!s.disabled){o.splice(r,1),i=s;break}}i&&d(o,{type:"remove",values:[i]})}for(var l=arguments.length,c=new Array(l>1?l-1:0),g=1;g<l;g++)c[g-1]=arguments[g];We&&(null===(t=ue.current)||void 0===t||t.onKeyDown.apply(t,[e].concat(c))),null===q||void 0===q||q.apply(void 0,[e].concat(c))},onKeyUp:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o;We&&(null===(o=ue.current)||void 0===o||o.onKeyUp.apply(o,[e].concat(n))),null===j||void 0===j||j.apply(void 0,[e].concat(n))},onFocus:function(){Ce(!0),f||(_&&!Pe.current&&_.apply(void 0,arguments),O.includes("focus")&&Xe(!0)),Pe.current=!0},onBlur:function(){de.current=!0,Ce(!1,(function(){Pe.current=!1,de.current=!1,Xe(!1)})),f||(ye&&("tags"===C?R(ye,{source:"submit"}):"multiple"===C&&R("",{source:"blur"})),Q&&Q.apply(void 0,arguments))}}),a.createElement(Wu,{visible:me&&!We,values:u}),rt,je,nt&&at),a.createElement(Sc.Provider,{value:qe},et)}));const Tu=Mu;var Eu=function(){return null};Eu.isSelectOptGroup=!0;const Fu=Eu;var Hu=function(){return null};Hu.isSelectOption=!0;const Ju=Hu;var Yu=a.forwardRef((function(e,t){var n=e.height,o=e.offsetY,i=e.offsetX,r=e.children,s=e.prefixCls,l=e.onInnerResize,c=e.innerProps,g=e.rtl,u=e.extra,d={},h={display:"flex",flexDirection:"column"};return void 0!==o&&(d={height:n,position:"relative",overflow:"hidden"},h=Ke(Ke({},h),{},Me(Me(Me(Me(Me({transform:"translateY(".concat(o,"px)")},g?"marginRight":"marginLeft",-i),"position","absolute"),"left",0),"right",0),"top",0))),a.createElement("div",{style:d},a.createElement(rg,{onResize:function(e){e.offsetHeight&&l&&l()}},a.createElement("div",yn({style:h,className:Ie()(Me({},"".concat(s,"-holder-inner"),s)),ref:t},c),r,u)))}));Yu.displayName="Filler";const Lu=Yu;function zu(e){var t=e.children,n=e.setRef,o=a.useCallback((function(e){n(e)}),[]);return a.cloneElement(t,{ref:o})}function Ku(e,t,n){var o=Je(a.useState(e),2),i=o[0],r=o[1],s=Je(a.useState(null),2),l=s[0],c=s[1];return a.useEffect((function(){var a=function(e,t,n){var a,o,i=e.length,r=t.length;if(0===i&&0===r)return null;i<r?(a=e,o=t):(a=t,o=e);var s={__EMPTY_ITEM__:!0};function l(e){return void 0!==e?n(e):s}for(var c=null,g=1!==Math.abs(i-r),u=0;u<o.length;u+=1){var d=l(a[u]);if(d!==l(o[u])){c=u,g=g||d!==l(o[u+1]);break}}return null===c?null:{index:c,multiple:g}}(i||[],e||[],t);void 0!==(null===a||void 0===a?void 0:a.index)&&(null===n||void 0===n||n(a.index),c(e[a.index])),r(e)}),[e]),[l]}const Du="object"===("undefined"===typeof navigator?"undefined":fe(navigator))&&/Firefox/i.test(navigator.userAgent),Uu=function(e,t,n,o){var i=(0,a.useRef)(!1),r=(0,a.useRef)(null);var s=(0,a.useRef)({top:e,bottom:t,left:n,right:o});return s.current.top=e,s.current.bottom=t,s.current.left=n,s.current.right=o,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e?t<0&&s.current.left||t>0&&s.current.right:t<0&&s.current.top||t>0&&s.current.bottom;return n&&a?(clearTimeout(r.current),i.current=!1):a&&!i.current||(clearTimeout(r.current),i.current=!0,r.current=setTimeout((function(){i.current=!1}),50)),!i.current&&a}};function Pu(e,t,n,o,i,r,s){var l=(0,a.useRef)(0),c=(0,a.useRef)(null),g=(0,a.useRef)(null),u=(0,a.useRef)(!1),d=Uu(t,n,o,i);var h=(0,a.useRef)(null),p=(0,a.useRef)(null);return[function(t){if(e){Gi.cancel(p.current),p.current=Gi((function(){h.current=null}),2);var n=t.deltaX,a=t.deltaY,o=t.shiftKey,i=n,m=a;("sx"===h.current||!h.current&&o&&a&&!n)&&(i=a,m=0,h.current="sx");var I=Math.abs(i),C=Math.abs(m);null===h.current&&(h.current=r&&I>C?"x":"y"),"y"===h.current?function(e,t){Gi.cancel(c.current),l.current+=t,g.current=t,d(!1,t)||(Du||e.preventDefault(),c.current=Gi((function(){var e=u.current?10:1;s(l.current*e),l.current=0})))}(t,m):function(e,t){s(t,!0),Du||e.preventDefault()}(t,i)}},function(t){e&&(u.current=t.detail===g.current)}]}const Ou=function(){function e(){ht(this,e),Me(this,"maps",void 0),Me(this,"id",0),this.maps=Object.create(null)}return mt(e,[{key:"set",value:function(e,t){this.maps[e]=t,this.id+=1}},{key:"get",value:function(e){return this.maps[e]}}]),e}();var _u=14/15;var Qu=10;function ju(e,t){return("touches"in e?e.touches[0]:e)[t?"pageX":"pageY"]}var qu=a.forwardRef((function(e,t){var n=e.prefixCls,o=e.rtl,i=e.scrollOffset,r=e.scrollRange,s=e.onStartMove,l=e.onStopMove,c=e.onScroll,g=e.horizontal,u=e.spinSize,d=e.containerSize,h=e.style,p=e.thumbStyle,m=Je(a.useState(!1),2),I=m[0],C=m[1],f=Je(a.useState(null),2),b=f[0],y=f[1],A=Je(a.useState(null),2),v=A[0],S=A[1],x=!o,G=a.useRef(),Z=a.useRef(),w=Je(a.useState(!1),2),k=w[0],B=w[1],R=a.useRef(),W=function(){clearTimeout(R.current),B(!0),R.current=setTimeout((function(){B(!1)}),3e3)},V=r-d||0,N=d-u||0,X=a.useMemo((function(){return 0===i||0===V?0:i/V*N}),[i,V,N]),M=a.useRef({top:X,dragging:I,pageY:b,startTop:v});M.current={top:X,dragging:I,pageY:b,startTop:v};var T=function(e){C(!0),y(ju(e,g)),S(M.current.top),s(),e.stopPropagation(),e.preventDefault()};a.useEffect((function(){var e=function(e){e.preventDefault()},t=G.current,n=Z.current;return t.addEventListener("touchstart",e,{passive:!1}),n.addEventListener("touchstart",T,{passive:!1}),function(){t.removeEventListener("touchstart",e),n.removeEventListener("touchstart",T)}}),[]);var E=a.useRef();E.current=V;var F=a.useRef();F.current=N,a.useEffect((function(){if(I){var e,t=function(t){var n=M.current,a=n.dragging,o=n.pageY,i=n.startTop;Gi.cancel(e);var r=G.current.getBoundingClientRect(),s=d/(g?r.width:r.height);if(a){var l=(ju(t,g)-o)*s,u=i;!x&&g?u-=l:u+=l;var h=E.current,p=F.current,m=p?u/p:0,I=Math.ceil(m*h);I=Math.max(I,0),I=Math.min(I,h),e=Gi((function(){c(I,g)}))}},n=function(){C(!1),l()};return window.addEventListener("mousemove",t,{passive:!0}),window.addEventListener("touchmove",t,{passive:!0}),window.addEventListener("mouseup",n,{passive:!0}),window.addEventListener("touchend",n,{passive:!0}),function(){window.removeEventListener("mousemove",t),window.removeEventListener("touchmove",t),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),Gi.cancel(e)}}}),[I]),a.useEffect((function(){return W(),function(){clearTimeout(R.current)}}),[i]),a.useImperativeHandle(t,(function(){return{delayHidden:W}}));var H="".concat(n,"-scrollbar"),J={position:"absolute",visibility:k?null:"hidden"},Y={position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"};return g?(J.height=8,J.left=0,J.right=0,J.bottom=0,Y.height="100%",Y.width=u,x?Y.left=X:Y.right=X):(J.width=8,J.top=0,J.bottom=0,x?J.right=0:J.left=0,Y.width="100%",Y.height=u,Y.top=X),a.createElement("div",{ref:G,className:Ie()(H,Me(Me(Me({},"".concat(H,"-horizontal"),g),"".concat(H,"-vertical"),!g),"".concat(H,"-visible"),k)),style:Ke(Ke({},J),h),onMouseDown:function(e){e.stopPropagation(),e.preventDefault()},onMouseMove:W},a.createElement("div",{ref:Z,className:Ie()("".concat(H,"-thumb"),Me({},"".concat(H,"-thumb-moving"),I)),style:Ke(Ke({},Y),p),onMouseDown:T}))}));const $u=qu;var ed=20;function td(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=e/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)*e;return isNaN(t)&&(t=0),t=Math.max(t,ed),Math.floor(t)}var nd=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","scrollWidth","component","onScroll","onVirtualScroll","onVisibleChange","innerProps","extraRender","styles"],ad=[],od={overflowY:"auto",overflowAnchor:"none"};function id(e,t){var n=e.prefixCls,o=void 0===n?"rc-virtual-list":n,i=e.className,r=e.height,s=e.itemHeight,l=e.fullHeight,c=void 0===l||l,g=e.style,u=e.data,d=e.children,h=e.itemKey,p=e.virtual,m=e.direction,I=e.scrollWidth,C=e.component,f=void 0===C?"div":C,b=e.onScroll,y=e.onVirtualScroll,A=e.onVisibleChange,v=e.innerProps,S=e.extraRender,x=e.styles,G=ir(e,nd),Z=a.useCallback((function(e){return"function"===typeof h?h(e):null===e||void 0===e?void 0:e[h]}),[h]),w=function(e,t,n){var o=Je(a.useState(0),2),i=o[0],r=o[1],s=(0,a.useRef)(new Map),l=(0,a.useRef)(new Ou),c=(0,a.useRef)();function g(){Gi.cancel(c.current)}function u(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];g();var t=function(){s.current.forEach((function(e,t){if(e&&e.offsetParent){var n=or(e),a=n.offsetHeight;l.current.get(t)!==a&&l.current.set(t,n.offsetHeight)}})),r((function(e){return e+1}))};e?t():c.current=Gi(t)}return(0,a.useEffect)((function(){return g}),[]),[function(a,o){var i=e(a),r=s.current.get(i);o?(s.current.set(i,o),u()):s.current.delete(i),!r!==!o&&(o?null===t||void 0===t||t(a):null===n||void 0===n||n(a))},u,l.current,i]}(Z,null,null),k=Je(w,4),B=k[0],R=k[1],W=k[2],V=k[3],N=!(!1===p||!r||!s),X=a.useMemo((function(){return Object.values(W.maps).reduce((function(e,t){return e+t}),0)}),[W.id,W.maps]),M=N&&u&&(Math.max(s*u.length,X)>r||!!I),T="rtl"===m,E=Ie()(o,Me({},"".concat(o,"-rtl"),T),i),F=u||ad,H=(0,a.useRef)(),J=(0,a.useRef)(),Y=(0,a.useRef)(),L=Je((0,a.useState)(0),2),z=L[0],K=L[1],D=Je((0,a.useState)(0),2),U=D[0],P=D[1],O=Je((0,a.useState)(!1),2),_=O[0],Q=O[1],j=function(){Q(!0)},q=function(){Q(!1)},$={getKey:Z};function ee(e){K((function(t){var n=function(e){var t=e;Number.isNaN(be.current)||(t=Math.min(t,be.current));return t=Math.max(t,0),t}("function"===typeof e?e(t):e);return H.current.scrollTop=n,n}))}var te=(0,a.useRef)({start:0,end:F.length}),ne=(0,a.useRef)(),ae=Je(Ku(F,Z),1)[0];ne.current=ae;var oe=a.useMemo((function(){if(!N)return{scrollHeight:void 0,start:0,end:F.length-1,offset:void 0};var e;if(!M)return{scrollHeight:(null===(e=J.current)||void 0===e?void 0:e.offsetHeight)||0,start:0,end:F.length-1,offset:void 0};for(var t,n,a,o=0,i=F.length,l=0;l<i;l+=1){var c=F[l],g=Z(c),u=W.get(g),d=o+(void 0===u?s:u);d>=z&&void 0===t&&(t=l,n=o),d>z+r&&void 0===a&&(a=l),o=d}return void 0===t&&(t=0,n=0,a=Math.ceil(r/s)),void 0===a&&(a=F.length-1),{scrollHeight:o,start:t,end:a=Math.min(a+1,F.length-1),offset:n}}),[M,N,z,F,V,r]),ie=oe.scrollHeight,re=oe.start,se=oe.end,le=oe.offset;te.current.start=re,te.current.end=se;var ce=Je(a.useState({width:0,height:r}),2),ge=ce[0],ue=ce[1],de=(0,a.useRef)(),he=(0,a.useRef)(),pe=a.useMemo((function(){return td(ge.width,I)}),[ge.width,I]),me=a.useMemo((function(){return td(ge.height,ie)}),[ge.height,ie]),Ce=ie-r,be=(0,a.useRef)(Ce);be.current=Ce;var ye=z<=0,Ae=z>=Ce,ve=U<=0,Se=U>=I,xe=Uu(ye,Ae,ve,Se),Ge=function(){return{x:T?-U:U,y:z}},Ze=(0,a.useRef)(Ge()),we=ka((function(e){if(y){var t=Ke(Ke({},Ge()),e);Ze.current.x===t.x&&Ze.current.y===t.y||(y(t),Ze.current=t)}}));function ke(e,t){var n=e;t?((0,tr.flushSync)((function(){P(n)})),we()):ee(n)}var Be=function(e){var t=e,n=I?I-ge.width:0;return t=Math.max(t,0),t=Math.min(t,n)},Re=ka((function(e,t){t?((0,tr.flushSync)((function(){P((function(t){return Be(t+(T?-e:e))}))})),we()):ee((function(t){return t+e}))})),We=Je(Pu(N,ye,Ae,ve,Se,!!I,Re),2),Ve=We[0],Ne=We[1];!function(e,t,n){var o,i=(0,a.useRef)(!1),r=(0,a.useRef)(0),s=(0,a.useRef)(0),l=(0,a.useRef)(null),c=(0,a.useRef)(null),g=function(e){if(i.current){var t=Math.ceil(e.touches[0].pageX),a=Math.ceil(e.touches[0].pageY),o=r.current-t,l=s.current-a,g=Math.abs(o)>Math.abs(l);g?r.current=t:s.current=a,n(g,g?o:l)&&e.preventDefault(),clearInterval(c.current),c.current=setInterval((function(){g?o*=_u:l*=_u;var e=Math.floor(g?o:l);(!n(g,e,!0)||Math.abs(e)<=.1)&&clearInterval(c.current)}),16)}},u=function(){i.current=!1,o()},d=function(e){o(),1!==e.touches.length||i.current||(i.current=!0,r.current=Math.ceil(e.touches[0].pageX),s.current=Math.ceil(e.touches[0].pageY),l.current=e.target,l.current.addEventListener("touchmove",g,{passive:!1}),l.current.addEventListener("touchend",u,{passive:!0}))};o=function(){l.current&&(l.current.removeEventListener("touchmove",g),l.current.removeEventListener("touchend",u))},on((function(){return e&&t.current.addEventListener("touchstart",d,{passive:!0}),function(){var e;null===(e=t.current)||void 0===e||e.removeEventListener("touchstart",d),o(),clearInterval(c.current)}}),[e])}(N,H,(function(e,t,n){return!xe(e,t,n)&&(Ve({preventDefault:function(){},deltaX:e?t:0,deltaY:e?0:t}),!0)})),on((function(){function e(e){N&&e.preventDefault()}var t=H.current;return t.addEventListener("wheel",Ve,{passive:!1}),t.addEventListener("DOMMouseScroll",Ne,{passive:!0}),t.addEventListener("MozMousePixelScroll",e,{passive:!1}),function(){t.removeEventListener("wheel",Ve),t.removeEventListener("DOMMouseScroll",Ne),t.removeEventListener("MozMousePixelScroll",e)}}),[N]),on((function(){if(I){var e=Be(U);P(e),we({x:e})}}),[ge.width,I]);var Xe=function(){var e,t;null===(e=de.current)||void 0===e||e.delayHidden(),null===(t=he.current)||void 0===t||t.delayHidden()},Te=function(e,t,n,o,i,r,s,l){var c=a.useRef(),g=Je(a.useState(null),2),u=g[0],d=g[1];return on((function(){if(u&&u.times<Qu){if(!e.current)return void d((function(e){return Ke({},e)}));r();var a=u.targetAlign,l=u.originAlign,c=u.index,g=u.offset,h=e.current.clientHeight,p=!1,m=a,I=null;if(h){for(var C=a||l,f=0,b=0,y=0,A=Math.min(t.length-1,c),v=0;v<=A;v+=1){var S=i(t[v]);b=f;var x=n.get(S);f=y=b+(void 0===x?o:x)}for(var G="top"===C?g:h-g,Z=A;Z>=0;Z-=1){var w=i(t[Z]),k=n.get(w);if(void 0===k){p=!0;break}if((G-=k)<=0)break}switch(C){case"top":I=b-g;break;case"bottom":I=y-h+g;break;default:var B=e.current.scrollTop;b<B?m="top":y>B+h&&(m="bottom")}null!==I&&s(I),I!==u.lastTop&&(p=!0)}p&&d(Ke(Ke({},u),{},{times:u.times+1,targetAlign:m,lastTop:I}))}}),[u,e.current]),function(e){if(null!==e&&void 0!==e){if(Gi.cancel(c.current),"number"===typeof e)s(e);else if(e&&"object"===fe(e)){var n,a=e.align;n="index"in e?e.index:t.findIndex((function(t){return i(t)===e.key}));var o=e.offset;d({times:0,index:n,offset:void 0===o?0:o,originAlign:a})}}else l()}}(H,F,W,s,Z,(function(){return R(!0)}),ee,Xe);a.useImperativeHandle(t,(function(){return{nativeElement:Y.current,getScrollInfo:Ge,scrollTo:function(e){var t;(t=e)&&"object"===fe(t)&&("left"in t||"top"in t)?(void 0!==e.left&&P(Be(e.left)),Te(e.top)):Te(e)}}})),on((function(){if(A){var e=F.slice(re,se+1);A(e,F)}}),[re,se,F]);var Ee=function(e,t,n,o){var i=Je(a.useMemo((function(){return[new Map,[]]}),[e,n.id,o]),2),r=i[0],s=i[1];return function(a){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,l=r.get(a),c=r.get(i);if(void 0===l||void 0===c)for(var g=e.length,u=s.length;u<g;u+=1){var d,h=e[u],p=t(h);r.set(p,u);var m=null!==(d=n.get(p))&&void 0!==d?d:o;if(s[u]=(s[u-1]||0)+m,p===a&&(l=u),p===i&&(c=u),void 0!==l&&void 0!==c)break}return{top:s[l-1]||0,bottom:s[c]}}}(F,Z,W,s),Fe=null===S||void 0===S?void 0:S({start:re,end:se,virtual:M,offsetX:U,offsetY:le,rtl:T,getSize:Ee}),He=function(e,t,n,o,i,r,s,l){var c=l.getKey;return e.slice(t,n+1).map((function(e,n){var l=s(e,t+n,{style:{width:o},offsetX:i}),g=c(e);return a.createElement(zu,{key:g,setRef:function(t){return r(e,t)}},l)}))}(F,re,se,I,U,B,d,$),Ye=null;r&&(Ye=Ke(Me({},c?"height":"maxHeight",r),od),N&&(Ye.overflowY="hidden",I&&(Ye.overflowX="hidden"),_&&(Ye.pointerEvents="none")));var Le={};return T&&(Le.dir="rtl"),a.createElement("div",yn({ref:Y,style:Ke(Ke({},g),{},{position:"relative"}),className:E},Le,G),a.createElement(rg,{onResize:function(e){ue({width:e.offsetWidth,height:e.offsetHeight})}},a.createElement(f,{className:"".concat(o,"-holder"),style:Ye,ref:H,onScroll:function(e){var t=e.currentTarget.scrollTop;t!==z&&ee(t),null===b||void 0===b||b(e),we()},onMouseEnter:Xe},a.createElement(Lu,{prefixCls:o,height:ie,offsetX:U,offsetY:le,scrollWidth:I,onInnerResize:R,ref:J,innerProps:v,rtl:T,extra:Fe},He))),M&&ie>r&&a.createElement($u,{ref:de,prefixCls:o,scrollOffset:z,scrollRange:ie,rtl:T,onScroll:ke,onStartMove:j,onStopMove:q,spinSize:me,containerSize:ge.height,style:null===x||void 0===x?void 0:x.verticalScrollBar,thumbStyle:null===x||void 0===x?void 0:x.verticalScrollBarThumb}),M&&I>ge.width&&a.createElement($u,{ref:he,prefixCls:o,scrollOffset:U,scrollRange:I,rtl:T,onScroll:ke,onStartMove:j,onStopMove:q,spinSize:pe,containerSize:ge.width,horizontal:!0,style:null===x||void 0===x?void 0:x.horizontalScrollBar,thumbStyle:null===x||void 0===x?void 0:x.horizontalScrollBarThumb}))}var rd=a.forwardRef(id);rd.displayName="List";const sd=rd;var ld=["disabled","title","children","style","className"];function cd(e){return"string"===typeof e||"number"===typeof e}var gd=function(e,t){var n=a.useContext(Sc),o=n.prefixCls,i=n.id,r=n.open,s=n.multiple,l=n.mode,c=n.searchValue,g=n.toggleOpen,u=n.notFoundContent,d=n.onPopupScroll,h=a.useContext(Ru),p=h.maxCount,m=h.flattenOptions,I=h.onActiveValue,C=h.defaultActiveFirstOption,f=h.onSelect,b=h.menuItemSelectedIcon,y=h.rawValues,A=h.fieldNames,v=h.virtual,S=h.direction,x=h.listHeight,G=h.listItemHeight,Z=h.optionRender,w="".concat(o,"-item"),k=ye((function(){return m}),[r,m],(function(e,t){return t[0]&&e[1]!==t[1]})),B=a.useRef(null),R=a.useMemo((function(){return s&&wu(p)&&(null===y||void 0===y?void 0:y.size)>=p}),[s,p,null===y||void 0===y?void 0:y.size]),W=function(e){e.preventDefault()},V=function(e){var t;null===(t=B.current)||void 0===t||t.scrollTo("number"===typeof e?{index:e}:e)},N=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=k.length,a=0;a<n;a+=1){var o=(e+a*t+n)%n,i=k[o]||{},r=i.group,s=i.data;if(!r&&(null===s||void 0===s||!s.disabled)&&!R)return o}return-1},X=Je(a.useState((function(){return N(0)})),2),M=X[0],T=X[1],E=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];T(e);var n={source:t?"keyboard":"mouse"},a=k[e];a?I(a.value,e,n):I(null,-1,n)};(0,a.useEffect)((function(){E(!1!==C?N(0):-1)}),[k.length,c]);var F=a.useCallback((function(e){return y.has(e)&&"combobox"!==l}),[l,Le(y).toString(),y.size]);(0,a.useEffect)((function(){var e,t=setTimeout((function(){if(!s&&r&&1===y.size){var e=Array.from(y)[0],t=k.findIndex((function(t){return t.data.value===e}));-1!==t&&(E(t),V(t))}}));r&&(null===(e=B.current)||void 0===e||e.scrollTo(void 0));return function(){return clearTimeout(t)}}),[r,c]);var H=function(e){void 0!==e&&f(e,{selected:!y.has(e)}),s||g(!1)};if(a.useImperativeHandle(t,(function(){return{onKeyDown:function(e){var t=e.which,n=e.ctrlKey;switch(t){case Ac.N:case Ac.P:case Ac.UP:case Ac.DOWN:var a=0;if(t===Ac.UP?a=-1:t===Ac.DOWN?a=1:/(mac\sos|macintosh)/i.test(navigator.appVersion)&&n&&(t===Ac.N?a=1:t===Ac.P&&(a=-1)),0!==a){var o=N(M+a,a);V(o),E(o,!0)}break;case Ac.ENTER:var i,s=k[M];!s||null!==s&&void 0!==s&&null!==(i=s.data)&&void 0!==i&&i.disabled||R?H(void 0):H(s.value),r&&e.preventDefault();break;case Ac.ESC:g(!1),r&&e.stopPropagation()}},onKeyUp:function(){},scrollTo:function(e){V(e)}}})),0===k.length)return a.createElement("div",{role:"listbox",id:"".concat(i,"_list"),className:"".concat(w,"-empty"),onMouseDown:W},u);var J=Object.keys(A).map((function(e){return A[e]})),Y=function(e){return e.label};function L(e,t){return{role:e.group?"presentation":"option",id:"".concat(i,"_list_").concat(t)}}var z=function(e){var t=k[e];if(!t)return null;var n=t.data||{},o=n.value,i=t.group,r=Bc(n,!0),s=Y(t);return t?a.createElement("div",yn({"aria-label":"string"!==typeof s||i?null:s},r,{key:e},L(t,e),{"aria-selected":F(o)}),o):null},K={role:"listbox",id:"".concat(i,"_list")};return a.createElement(a.Fragment,null,v&&a.createElement("div",yn({},K,{style:{height:0,width:0,overflow:"hidden"}}),z(M-1),z(M),z(M+1)),a.createElement(sd,{itemKey:"key",ref:B,data:k,height:x,itemHeight:G,fullHeight:!1,onMouseDown:W,onScroll:d,virtual:v,direction:S,innerProps:v?null:K},(function(e,t){var n=e.group,o=e.groupOption,i=e.data,r=e.label,s=e.value,l=i.key;if(n){var c,g=null!==(c=i.title)&&void 0!==c?c:cd(r)?r.toString():void 0;return a.createElement("div",{className:Ie()(w,"".concat(w,"-group"),i.className),title:g},void 0!==r?r:l)}var u=i.disabled,d=i.title,h=(i.children,i.style),p=i.className,m=Ce(ir(i,ld),J),I=F(s),C=u||!I&&R,f="".concat(w,"-option"),y=Ie()(w,f,p,Me(Me(Me(Me({},"".concat(f,"-grouped"),o),"".concat(f,"-active"),M===t&&!C),"".concat(f,"-disabled"),C),"".concat(f,"-selected"),I)),A=Y(e),S=!b||"function"===typeof b||I,x="number"===typeof A?A:A||s,G=cd(x)?x.toString():void 0;return void 0!==d&&(G=d),a.createElement("div",yn({},Bc(m),v?{}:L(e,t),{"aria-selected":I,className:y,title:G,onMouseMove:function(){M===t||C||E(t)},onClick:function(){C||H(s)},style:h}),a.createElement("div",{className:"".concat(f,"-content")},"function"===typeof Z?Z(e,{index:t}):x),a.isValidElement(b)||I,S&&a.createElement(vc,{className:"".concat(w,"-option-state"),customizeIcon:b,customizeIconProps:{value:s,disabled:C,isSelected:I}},I?"\u2713":null))})))};const ud=a.forwardRef(gd);function dd(e,t){return Rg(e).join("").toUpperCase().includes(t)}var hd=0,pd=Ue();function md(e){var t=Je(a.useState(),2),n=t[0],o=t[1];return a.useEffect((function(){o("rc_select_".concat(function(){var e;return pd?(e=hd,hd+=1):e="TEST_OR_SSR",e}()))}),[]),e||n}var Id=["children","value"],Cd=["children"];function fd(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Es(e).map((function(e,n){if(!a.isValidElement(e)||!e.type)return null;var o=e,i=o.type.isSelectOptGroup,r=o.key,s=o.props,l=s.children,c=ir(s,Cd);return t||!i?function(e){var t=e,n=t.key,a=t.props,o=a.children,i=a.value;return Ke({key:n,value:void 0!==i?i:n,children:o},ir(a,Id))}(e):Ke(Ke({key:"__RC_SELECT_GRP__".concat(null===r?n:r,"__"),label:r},c),{},{options:fd(l)})})).filter((function(e){return e}))}const bd=function(e,t,n,o,i){return a.useMemo((function(){var a=e;!e&&(a=fd(t));var r=new Map,s=new Map,l=function(e,t,n){n&&"string"===typeof n&&e.set(t[n],t)};return function e(t){for(var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=0;c<t.length;c+=1){var g=t[c];!g[n.options]||a?(r.set(g[n.value],g),l(s,g,n.label),l(s,g,o),l(s,g,i)):e(g[n.options],!0)}}(a),{options:a,valueOptions:r,labelOptions:s}}),[e,t,n,o,i])};function yd(e){var t=a.useRef();t.current=e;var n=a.useCallback((function(){return t.current.apply(t,arguments)}),[]);return n}var Ad=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","optionRender","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","direction","listHeight","listItemHeight","labelRender","value","defaultValue","labelInValue","onChange","maxCount"],vd=["inputValue"];var Sd=a.forwardRef((function(e,t){var n=e.id,o=e.mode,i=e.prefixCls,r=void 0===i?"rc-select":i,s=e.backfill,l=e.fieldNames,c=e.inputValue,g=e.searchValue,u=e.onSearch,d=e.autoClearSearchValue,h=void 0===d||d,p=e.onSelect,m=e.onDeselect,I=e.dropdownMatchSelectWidth,C=void 0===I||I,f=e.filterOption,b=e.filterSort,y=e.optionFilterProp,A=e.optionLabelProp,v=e.options,S=e.optionRender,x=e.children,G=e.defaultActiveFirstOption,Z=e.menuItemSelectedIcon,w=e.virtual,k=e.direction,B=e.listHeight,R=void 0===B?200:B,W=e.listItemHeight,V=void 0===W?20:W,N=e.labelRender,X=e.value,M=e.defaultValue,T=e.labelInValue,E=e.onChange,F=e.maxCount,H=ir(e,Ad),J=md(n),Y=Xu(o),L=!(v||!x),z=a.useMemo((function(){return(void 0!==f||"combobox"!==o)&&f}),[f,o]),K=a.useMemo((function(){return ku(l,L)}),[JSON.stringify(l),L]),D=Je(Wa("",{value:void 0!==g?g:c,postState:function(e){return e||""}}),2),U=D[0],P=D[1],O=bd(v,x,K,y,A),_=O.valueOptions,Q=O.labelOptions,j=O.options,q=a.useCallback((function(e){return Rg(e).map((function(e){var t,n,a,o,i,r;(function(e){return!e||"object"!==fe(e)})(e)?t=e:(a=e.key,n=e.label,t=null!==(r=e.value)&&void 0!==r?r:a);var s,l=_.get(t);l&&(void 0===n&&(n=null===l||void 0===l?void 0:l[A||K.label]),void 0===a&&(a=null!==(s=null===l||void 0===l?void 0:l.key)&&void 0!==s?s:t),o=null===l||void 0===l?void 0:l.disabled,i=null===l||void 0===l?void 0:l.title);return{label:n,value:t,key:a,disabled:o,title:i}}))}),[K,A,_]),$=Je(Wa(M,{value:X}),2),ee=$[0],te=$[1],ne=a.useMemo((function(){var e,t=q(Y&&null===ee?[]:ee);return"combobox"===o&&function(e){return!e&&0!==e}(null===(e=t[0])||void 0===e?void 0:e.value)?[]:t}),[ee,q,o,Y]),ae=function(e,t){var n=a.useRef({values:new Map,options:new Map});return[a.useMemo((function(){var a=n.current,o=a.values,i=a.options,r=e.map((function(e){var t;return void 0===e.label?Ke(Ke({},e),{},{label:null===(t=o.get(e.value))||void 0===t?void 0:t.label}):e})),s=new Map,l=new Map;return r.forEach((function(e){s.set(e.value,e),l.set(e.value,t.get(e.value)||i.get(e.value))})),n.current.values=s,n.current.options=l,r}),[e,t]),a.useCallback((function(e){return t.get(e)||n.current.options.get(e)}),[t])]}(ne,_),oe=Je(ae,2),ie=oe[0],re=oe[1],se=a.useMemo((function(){if(!o&&1===ie.length){var e=ie[0];if(null===e.value&&(null===e.label||void 0===e.label))return[]}return ie.map((function(e){var t;return Ke(Ke({},e),{},{label:null!==(t="function"===typeof N?N(e):e.label)&&void 0!==t?t:e.value})}))}),[o,ie,N]),le=a.useMemo((function(){return new Set(ie.map((function(e){return e.value})))}),[ie]);a.useEffect((function(){if("combobox"===o){var e,t=null===(e=ie[0])||void 0===e?void 0:e.value;P(function(e){return void 0!==e&&null!==e}(t)?String(t):"")}}),[ie]);var ce=yd((function(e,t){var n=null!==t&&void 0!==t?t:e;return Me(Me({},K.value,e),K.label,n)})),ge=a.useMemo((function(){if("tags"!==o)return j;var e=Le(j);return Le(ie).sort((function(e,t){return e.value<t.value?-1:1})).forEach((function(t){var n=t.value;(function(e){return _.has(e)})(n)||e.push(ce(n,t.label))})),e}),[ce,j,_,ie,o]),ue=function(e,t,n,o,i){return a.useMemo((function(){if(!n||!1===o)return e;var a=t.options,r=t.label,s=t.value,l=[],c="function"===typeof o,g=n.toUpperCase(),u=c?o:function(e,t){return i?dd(t[i],g):t[a]?dd(t["children"!==r?r:"label"],g):dd(t[s],g)},d=c?function(e){return Bu(e)}:function(e){return e};return e.forEach((function(e){if(e[a])if(u(n,d(e)))l.push(e);else{var t=e[a].filter((function(e){return u(n,d(e))}));t.length&&l.push(Ke(Ke({},e),{},Me({},a,t)))}else u(n,d(e))&&l.push(e)})),l}),[e,o,i,n,t])}(ge,K,U,z,y),de=a.useMemo((function(){return"tags"!==o||!U||ue.some((function(e){return e[y||"value"]===U}))||ue.some((function(e){return e[K.value]===U}))?ue:[ce(U)].concat(Le(ue))}),[ce,y,o,ue,U,K]),he=a.useMemo((function(){return b?Le(de).sort((function(e,t){return b(e,t,{searchValue:U})})):de}),[de,b,U]),pe=a.useMemo((function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.fieldNames,a=t.childrenAsData,o=[],i=ku(n,!1),r=i.label,s=i.value,l=i.options,c=i.groupLabel;return function e(t,n){Array.isArray(t)&&t.forEach((function(t){if(n||!(l in t)){var i=t[s];o.push({key:Zu(t,o.length),groupOption:n,data:t,label:t[r],value:i})}else{var g=t[c];void 0===g&&a&&(g=t.label),o.push({key:Zu(t,o.length),group:!0,data:t,label:g}),e(t[l],!0)}}))}(e,!1),o}(he,{fieldNames:K,childrenAsData:L})}),[he,K,L]),me=function(e){var t=q(e);if(te(t),E&&(t.length!==ie.length||t.some((function(e,t){var n;return(null===(n=ie[t])||void 0===n?void 0:n.value)!==(null===e||void 0===e?void 0:e.value)})))){var n=T?t:t.map((function(e){return e.value})),a=t.map((function(e){return Bu(re(e.value))}));E(Y?n:n[0],Y?a:a[0])}},Ie=Je(a.useState(null),2),Ce=Ie[0],be=Ie[1],ye=Je(a.useState(0),2),Ae=ye[0],ve=ye[1],Se=void 0!==G?G:"combobox"!==o,xe=a.useCallback((function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).source,a=void 0===n?"keyboard":n;ve(t),s&&"combobox"===o&&null!==e&&"keyboard"===a&&be(String(e))}),[s,o]),Ge=function(e,t,n){var a=function(){var t,n=re(e);return[T?{label:null===n||void 0===n?void 0:n[K.label],value:e,key:null!==(t=null===n||void 0===n?void 0:n.key)&&void 0!==t?t:e}:e,Bu(n)]};if(t&&p){var o=Je(a(),2),i=o[0],r=o[1];p(i,r)}else if(!t&&m&&"clear"!==n){var s=Je(a(),2),l=s[0],c=s[1];m(l,c)}},Ze=yd((function(e,t){var n,a=!Y||t.selected;n=a?Y?[].concat(Le(ie),[e]):[e]:ie.filter((function(t){return t.value!==e})),me(n),Ge(e,a),"combobox"===o?be(""):Xu&&!h||(P(""),be(""))})),we=a.useMemo((function(){var e=!1!==w&&!1!==C;return Ke(Ke({},O),{},{flattenOptions:pe,onActiveValue:xe,defaultActiveFirstOption:Se,onSelect:Ze,menuItemSelectedIcon:Z,rawValues:le,fieldNames:K,virtual:e,direction:k,listHeight:R,listItemHeight:V,childrenAsData:L,maxCount:F,optionRender:S})}),[F,O,pe,xe,Se,Ze,Z,le,K,w,C,k,R,V,L,S]);return a.createElement(Ru.Provider,{value:we},a.createElement(Tu,yn({},H,{id:J,prefixCls:r,ref:t,omitDomProps:vd,mode:o,displayValues:se,onDisplayValuesChange:function(e,t){me(e);var n=t.type,a=t.values;"remove"!==n&&"clear"!==n||a.forEach((function(e){Ge(e.value,!1,n)}))},direction:k,searchValue:U,onSearch:function(e,t){if(P(e),be(null),"submit"!==t.source)"blur"!==t.source&&("combobox"===o&&me(e),null===u||void 0===u||u(e));else{var n=(e||"").trim();if(n){var a=Array.from(new Set([].concat(Le(le),[n])));me(a),Ge(n,!0),P("")}}},autoClearSearchValue:h,onSearchSplit:function(e){var t=e;"tags"!==o&&(t=e.map((function(e){var t=Q.get(e);return null===t||void 0===t?void 0:t.value})).filter((function(e){return void 0!==e})));var n=Array.from(new Set([].concat(Le(le),Le(t))));me(n),n.forEach((function(e){Ge(e,!0)}))},dropdownMatchSelectWidth:C,OptionList:ud,emptyOptions:!pe.length,activeValue:Ce,activeDescendantId:"".concat(J,"_list_").concat(Ae)})))}));var xd=Sd;xd.Option=Ju,xd.OptGroup=Fu;const Gd=xd;const Zd=a.createContext(void 0),wd=100,kd=1e3,Bd={Modal:wd,Drawer:wd,Popover:wd,Popconfirm:wd,Tooltip:wd,Tour:wd},Rd={SelectLike:50,Dropdown:50,DatePicker:50,Menu:50,ImagePreview:1};function Wd(e,t){const[,n]=ai(),o=a.useContext(Zd),i=function(e){return e in Bd}(e);if(void 0!==t)return[t,t];let r=null!==o&&void 0!==o?o:0;return i?(r+=(o?0:n.zIndexPopupBase)+Bd[e],r=Math.min(r,n.zIndexPopupBase+kd)):r+=Rd[e],[void 0===o?t:r,r]}const Vd=(e,t,n)=>void 0!==n?n:"".concat(e,"-").concat(t);function Nd(e){return t=>a.createElement(ds,{theme:{token:{motion:!1,zIndexPopupBase:0}}},a.createElement(e,Object.assign({},t)))}const Xd=(e,t,n,o)=>Nd((i=>{const{prefixCls:r,style:s}=i,l=a.useRef(null),[c,g]=a.useState(0),[u,d]=a.useState(0),[h,p]=Wa(!1,{value:i.open}),{getPrefixCls:m}=a.useContext(Be),I=m(t||"select",r);a.useEffect((()=>{if(p(!0),"undefined"!==typeof ResizeObserver){const e=new ResizeObserver((e=>{const t=e[0].target;g(t.offsetHeight+8),d(t.offsetWidth)})),t=setInterval((()=>{var a;const o=n?".".concat(n(I)):".".concat(I,"-dropdown"),i=null===(a=l.current)||void 0===a?void 0:a.querySelector(o);i&&(clearInterval(t),e.observe(i))}),10);return()=>{clearInterval(t),e.disconnect()}}}),[]);let C=Object.assign(Object.assign({},i),{style:Object.assign(Object.assign({},s),{margin:0}),open:h,visible:h,getPopupContainer:()=>l.current});o&&(C=o(C));const f={paddingBottom:c,position:"relative",minWidth:u};return a.createElement("div",{ref:l,style:f},a.createElement(e,Object.assign({},C)))}));function Md(e,t,n){return Ie()({["".concat(e,"-status-success")]:"success"===t,["".concat(e,"-status-warning")]:"warning"===t,["".concat(e,"-status-error")]:"error"===t,["".concat(e,"-status-validating")]:"validating"===t,["".concat(e,"-has-feedback")]:n})}const Td=(e,t)=>t||e,Ed=(e,t)=>{const n=a.useContext(Yi),o=a.useMemo((()=>{var a;const o=t||Ti[e],i=null!==(a=null===n||void 0===n?void 0:n[e])&&void 0!==a?a:{};return Object.assign(Object.assign({},"function"===typeof o?o():o),i||{})}),[e,t,n]);return[o,a.useMemo((()=>{const e=null===n||void 0===n?void 0:n.locale;return(null===n||void 0===n?void 0:n.exist)&&!e?Ti.locale:e}),[n])]};const Fd=()=>{const[,e]=ai(),t=new To(e.colorBgBase).toHsl().l<.5?{opacity:.65}:{};return a.createElement("svg",{style:t,width:"184",height:"152",viewBox:"0 0 184 152",xmlns:"http://www.w3.org/2000/svg"},a.createElement("title",null,"empty image"),a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("g",{transform:"translate(24 31.67)"},a.createElement("ellipse",{fillOpacity:".8",fill:"#F5F5F7",cx:"67.797",cy:"106.89",rx:"67.797",ry:"12.668"}),a.createElement("path",{d:"M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z",fill:"#AEB8C2"}),a.createElement("path",{d:"M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z",fill:"url(#linearGradient-1)",transform:"translate(13.56)"}),a.createElement("path",{d:"M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z",fill:"#F5F5F7"}),a.createElement("path",{d:"M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z",fill:"#DCE0E6"})),a.createElement("path",{d:"M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z",fill:"#DCE0E6"}),a.createElement("g",{transform:"translate(149.65 15.383)",fill:"#FFF"},a.createElement("ellipse",{cx:"20.654",cy:"3.167",rx:"2.849",ry:"2.815"}),a.createElement("path",{d:"M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z"}))))};const Hd=()=>{const[,e]=ai(),{colorFill:t,colorFillTertiary:n,colorFillQuaternary:o,colorBgContainer:i}=e,{borderColor:r,shadowColor:s,contentColor:l}=(0,a.useMemo)((()=>({borderColor:new To(t).onBackground(i).toHexShortString(),shadowColor:new To(n).onBackground(i).toHexShortString(),contentColor:new To(o).onBackground(i).toHexShortString()})),[t,n,o,i]);return a.createElement("svg",{width:"64",height:"41",viewBox:"0 0 64 41",xmlns:"http://www.w3.org/2000/svg"},a.createElement("title",null,"Simple Empty"),a.createElement("g",{transform:"translate(0 1)",fill:"none",fillRule:"evenodd"},a.createElement("ellipse",{fill:s,cx:"32",cy:"33",rx:"32",ry:"7"}),a.createElement("g",{fillRule:"nonzero",stroke:r},a.createElement("path",{d:"M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"}),a.createElement("path",{d:"M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",fill:l}))))},Jd=e=>{const{componentCls:t,margin:n,marginXS:a,marginXL:o,fontSize:i,lineHeight:r}=e;return{[t]:{marginInline:a,fontSize:i,lineHeight:r,textAlign:"center",["".concat(t,"-image")]:{height:e.emptyImgHeight,marginBottom:a,opacity:e.opacityImage,img:{height:"100%"},svg:{maxWidth:"100%",height:"100%",margin:"auto"}},["".concat(t,"-description")]:{color:e.colorTextDescription},["".concat(t,"-footer")]:{marginTop:n},"&-normal":{marginBlock:o,color:e.colorTextDescription,["".concat(t,"-description")]:{color:e.colorTextDescription},["".concat(t,"-image")]:{height:e.emptyImgHeightMD}},"&-small":{marginBlock:a,color:e.colorTextDescription,["".concat(t,"-image")]:{height:e.emptyImgHeightSM}}}}},Yd=Ii("Empty",(e=>{const{componentCls:t,controlHeightLG:n,calc:a}=e,o=ri(e,{emptyImgCls:"".concat(t,"-img"),emptyImgHeight:a(n).mul(2.5).equal(),emptyImgHeightMD:n,emptyImgHeightSM:a(n).mul(.875).equal()});return[Jd(o)]}));var Ld=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const zd=a.createElement(Fd,null),Kd=a.createElement(Hd,null),Dd=e=>{var{className:t,rootClassName:n,prefixCls:o,image:i=zd,description:r,children:s,imageStyle:l,style:c}=e,g=Ld(e,["className","rootClassName","prefixCls","image","description","children","imageStyle","style"]);const{getPrefixCls:u,direction:d,empty:h}=a.useContext(Be),p=u("empty",o),[m,I,C]=Yd(p),[f]=Ed("Empty"),b="undefined"!==typeof r?r:null===f||void 0===f?void 0:f.description,y="string"===typeof b?b:"empty";let A=null;return A="string"===typeof i?a.createElement("img",{alt:y,src:i}):i,m(a.createElement("div",Object.assign({className:Ie()(I,C,p,null===h||void 0===h?void 0:h.className,{["".concat(p,"-normal")]:i===Kd,["".concat(p,"-rtl")]:"rtl"===d},t,n),style:Object.assign(Object.assign({},null===h||void 0===h?void 0:h.style),c)},g),a.createElement("div",{className:"".concat(p,"-image"),style:l},A),b&&a.createElement("div",{className:"".concat(p,"-description")},b),s&&a.createElement("div",{className:"".concat(p,"-footer")},s)))};Dd.PRESENTED_IMAGE_DEFAULT=zd,Dd.PRESENTED_IMAGE_SIMPLE=Kd;const Ud=Dd,Pd=e=>{const{componentName:t}=e,{getPrefixCls:n}=(0,a.useContext)(Be),o=n("empty");switch(t){case"Table":case"List":return a.createElement(Ud,{image:Ud.PRESENTED_IMAGE_SIMPLE});case"Select":case"TreeSelect":case"Cascader":case"Transfer":case"Mentions":return a.createElement(Ud,{image:Ud.PRESENTED_IMAGE_SIMPLE,className:"".concat(o,"-small")});default:return a.createElement(Ud,null)}},Od=e=>{const[,,,,t]=ai();return t?"".concat(e,"-css-var"):""};var _d="RC_FORM_INTERNAL_HOOKS",Qd=function(){ut(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")};const jd=a.createContext({getFieldValue:Qd,getFieldsValue:Qd,getFieldError:Qd,getFieldWarning:Qd,getFieldsError:Qd,isFieldsTouched:Qd,isFieldTouched:Qd,isFieldValidating:Qd,isFieldsValidating:Qd,resetFields:Qd,setFields:Qd,setFieldValue:Qd,setFieldsValue:Qd,validateFields:Qd,submit:Qd,getInternalHooks:function(){return Qd(),{dispatch:Qd,initEntityValue:Qd,registerField:Qd,useSubscribe:Qd,setInitialValues:Qd,destroyForm:Qd,setCallbacks:Qd,registerWatch:Qd,getFields:Qd,setValidateMessages:Qd,setPreserve:Qd,getInitialValue:Qd}}});const qd=a.createContext(null);function $d(e){return void 0===e||null===e?[]:Array.isArray(e)?e:[e]}function eh(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var e=JSON.parse(JSON.stringify(this));return e.clone=this.clone,e}}}var th=eh();function nh(e){var t="function"==typeof Map?new Map:void 0;return nh=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(DH){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(Rt())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,t);var o=new(e.bind.apply(e,a));return n&&wt(o,n.prototype),o}(e,arguments,Bt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),wt(n,e)},nh(e)}var ah=/%[sdj%]/g;function oh(e){if(!e||!e.length)return null;var t={};return e.forEach((function(e){var n=e.field;t[n]=t[n]||[],t[n].push(e)})),t}function ih(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=0,i=n.length;if("function"===typeof e)return e.apply(null,n);if("string"===typeof e){var r=e.replace(ah,(function(e){if("%%"===e)return"%";if(o>=i)return e;switch(e){case"%s":return String(n[o++]);case"%d":return Number(n[o++]);case"%j":try{return JSON.stringify(n[o++])}catch(sP){return"[Circular]"}break;default:return e}}));return r}return e}function rh(e,t){return void 0===e||null===e||(!("array"!==t||!Array.isArray(e)||e.length)||!(!function(e){return"string"===e||"url"===e||"hex"===e||"email"===e||"date"===e||"pattern"===e}(t)||"string"!==typeof e||e))}function sh(e,t,n){var a=0,o=e.length;!function i(r){if(r&&r.length)n(r);else{var s=a;a+=1,s<o?t(e[s],i):n([])}}([])}var lh=function(e){kt(n,e);var t=Wt(n);function n(e,a){var o;return ht(this,n),Me(Zt(o=t.call(this,"Async Validation Error")),"errors",void 0),Me(Zt(o),"fields",void 0),o.errors=e,o.fields=a,o}return mt(n)}(nh(Error));function ch(e,t,n,a,o){if(t.first){var i=new Promise((function(t,i){var r=function(e){var t=[];return Object.keys(e).forEach((function(n){t.push.apply(t,Le(e[n]||[]))})),t}(e);sh(r,n,(function(e){return a(e),e.length?i(new lh(e,oh(e))):t(o)}))}));return i.catch((function(e){return e})),i}var r=!0===t.firstFields?Object.keys(e):t.firstFields||[],s=Object.keys(e),l=s.length,c=0,g=[],u=new Promise((function(t,i){var u=function(e){if(g.push.apply(g,e),++c===l)return a(g),g.length?i(new lh(g,oh(g))):t(o)};s.length||(a(g),t(o)),s.forEach((function(t){var a=e[t];-1!==r.indexOf(t)?sh(a,n,u):function(e,t,n){var a=[],o=0,i=e.length;function r(e){a.push.apply(a,Le(e||[])),++o===i&&n(a)}e.forEach((function(e){t(e,r)}))}(a,n,u)}))}));return u.catch((function(e){return e})),u}function gh(e,t){return function(n){var a,o;return a=e.fullFields?function(e,t){for(var n=e,a=0;a<t.length;a++){if(void 0==n)return n;n=n[t[a]]}return n}(t,e.fullFields):t[n.field||e.fullField],(o=n)&&void 0!==o.message?(n.field=n.field||e.fullField,n.fieldValue=a,n):{message:"function"===typeof n?n():n,fieldValue:a,field:n.field||e.fullField}}}function uh(e,t){if(t)for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];"object"===fe(a)&&"object"===fe(e[n])?e[n]=Ke(Ke({},e[n]),a):e[n]=a}return e}var dh="enum";const hh=function(e,t,n,a,o,i){!e.required||n.hasOwnProperty(e.field)&&!rh(t,i||e.type)||a.push(ih(o.messages.required,e.fullField))};var ph;var mh=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,Ih=/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i,Ch={integer:function(e){return Ch.number(e)&&parseInt(e,10)===e},float:function(e){return Ch.number(e)&&!Ch.integer(e)},array:function(e){return Array.isArray(e)},regexp:function(e){if(e instanceof RegExp)return!0;try{return!!new RegExp(e)}catch(Pke){return!1}},date:function(e){return"function"===typeof e.getTime&&"function"===typeof e.getMonth&&"function"===typeof e.getYear&&!isNaN(e.getTime())},number:function(e){return!isNaN(e)&&"number"===typeof e},object:function(e){return"object"===fe(e)&&!Ch.array(e)},method:function(e){return"function"===typeof e},email:function(e){return"string"===typeof e&&e.length<=320&&!!e.match(mh)},url:function(e){return"string"===typeof e&&e.length<=2048&&!!e.match(function(){if(ph)return ph;var e="[a-fA-F\\d:]",t=function(t){return t&&t.includeBoundaries?"(?:(?<=\\s|^)(?=".concat(e,")|(?<=").concat(e,")(?=\\s|$))"):""},n="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",a="[a-fA-F\\d]{1,4}",o=["(?:".concat(a,":){7}(?:").concat(a,"|:)"),"(?:".concat(a,":){6}(?:").concat(n,"|:").concat(a,"|:)"),"(?:".concat(a,":){5}(?::").concat(n,"|(?::").concat(a,"){1,2}|:)"),"(?:".concat(a,":){4}(?:(?::").concat(a,"){0,1}:").concat(n,"|(?::").concat(a,"){1,3}|:)"),"(?:".concat(a,":){3}(?:(?::").concat(a,"){0,2}:").concat(n,"|(?::").concat(a,"){1,4}|:)"),"(?:".concat(a,":){2}(?:(?::").concat(a,"){0,3}:").concat(n,"|(?::").concat(a,"){1,5}|:)"),"(?:".concat(a,":){1}(?:(?::").concat(a,"){0,4}:").concat(n,"|(?::").concat(a,"){1,6}|:)"),"(?::(?:(?::".concat(a,"){0,5}:").concat(n,"|(?::").concat(a,"){1,7}|:))")],i="(?:".concat(o.join("|"),")").concat("(?:%[0-9a-zA-Z]{1,})?"),r=new RegExp("(?:^".concat(n,"$)|(?:^").concat(i,"$)")),s=new RegExp("^".concat(n,"$")),l=new RegExp("^".concat(i,"$")),c=function(e){return e&&e.exact?r:new RegExp("(?:".concat(t(e)).concat(n).concat(t(e),")|(?:").concat(t(e)).concat(i).concat(t(e),")"),"g")};c.v4=function(e){return e&&e.exact?s:new RegExp("".concat(t(e)).concat(n).concat(t(e)),"g")},c.v6=function(e){return e&&e.exact?l:new RegExp("".concat(t(e)).concat(i).concat(t(e)),"g")};var g=c.v4().source,u=c.v6().source,d="(?:".concat("(?:(?:[a-z]+:)?//)","|www\\.)").concat("(?:\\S+(?::\\S*)?@)?","(?:localhost|").concat(g,"|").concat(u,"|").concat("(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)").concat("(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*").concat("(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",")").concat("(?::\\d{2,5})?").concat('(?:[/?#][^\\s"]*)?');return ph=new RegExp("(?:^".concat(d,"$)"),"i")}())},hex:function(e){return"string"===typeof e&&!!e.match(Ih)}};const fh=function(e,t,n,a,o){if(e.required&&void 0===t)hh(e,t,n,a,o);else{var i=e.type;["integer","float","array","regexp","object","method","email","number","date","url","hex"].indexOf(i)>-1?Ch[i](t)||a.push(ih(o.messages.types[i],e.fullField,e.type)):i&&fe(t)!==e.type&&a.push(ih(o.messages.types[i],e.fullField,e.type))}};const bh={required:hh,whitespace:function(e,t,n,a,o){(/^\s+$/.test(t)||""===t)&&a.push(ih(o.messages.whitespace,e.fullField))},type:fh,range:function(e,t,n,a,o){var i="number"===typeof e.len,r="number"===typeof e.min,s="number"===typeof e.max,l=t,c=null,g="number"===typeof t,u="string"===typeof t,d=Array.isArray(t);if(g?c="number":u?c="string":d&&(c="array"),!c)return!1;d&&(l=t.length),u&&(l=t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length),i?l!==e.len&&a.push(ih(o.messages[c].len,e.fullField,e.len)):r&&!s&&l<e.min?a.push(ih(o.messages[c].min,e.fullField,e.min)):s&&!r&&l>e.max?a.push(ih(o.messages[c].max,e.fullField,e.max)):r&&s&&(l<e.min||l>e.max)&&a.push(ih(o.messages[c].range,e.fullField,e.min,e.max))},enum:function(e,t,n,a,o){e[dh]=Array.isArray(e[dh])?e[dh]:[],-1===e[dh].indexOf(t)&&a.push(ih(o.messages[dh],e.fullField,e[dh].join(", ")))},pattern:function(e,t,n,a,o){if(e.pattern)if(e.pattern instanceof RegExp)e.pattern.lastIndex=0,e.pattern.test(t)||a.push(ih(o.messages.pattern.mismatch,e.fullField,t,e.pattern));else if("string"===typeof e.pattern){new RegExp(e.pattern).test(t)||a.push(ih(o.messages.pattern.mismatch,e.fullField,t,e.pattern))}}};const yh=function(e,t,n,a,o){var i=[],r=Array.isArray(t)?"array":fe(t);bh.required(e,t,a,i,o,r),n(i)};const Ah=function(e,t,n,a,o){var i=e.type,r=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t,i)&&!e.required)return n();bh.required(e,t,a,r,o,i),rh(t,i)||bh.type(e,t,a,r,o)}n(r)},vh={string:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t,"string")&&!e.required)return n();bh.required(e,t,a,i,o,"string"),rh(t,"string")||(bh.type(e,t,a,i,o),bh.range(e,t,a,i,o),bh.pattern(e,t,a,i,o),!0===e.whitespace&&bh.whitespace(e,t,a,i,o))}n(i)},method:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),void 0!==t&&bh.type(e,t,a,i,o)}n(i)},number:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(""===t&&(t=void 0),rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),void 0!==t&&(bh.type(e,t,a,i,o),bh.range(e,t,a,i,o))}n(i)},boolean:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),void 0!==t&&bh.type(e,t,a,i,o)}n(i)},regexp:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),rh(t)||bh.type(e,t,a,i,o)}n(i)},integer:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),void 0!==t&&(bh.type(e,t,a,i,o),bh.range(e,t,a,i,o))}n(i)},float:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),void 0!==t&&(bh.type(e,t,a,i,o),bh.range(e,t,a,i,o))}n(i)},array:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if((void 0===t||null===t)&&!e.required)return n();bh.required(e,t,a,i,o,"array"),void 0!==t&&null!==t&&(bh.type(e,t,a,i,o),bh.range(e,t,a,i,o))}n(i)},object:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),void 0!==t&&bh.type(e,t,a,i,o)}n(i)},enum:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o),void 0!==t&&bh.enum(e,t,a,i,o)}n(i)},pattern:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t,"string")&&!e.required)return n();bh.required(e,t,a,i,o),rh(t,"string")||bh.pattern(e,t,a,i,o)}n(i)},date:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t,"date")&&!e.required)return n();var r;if(bh.required(e,t,a,i,o),!rh(t,"date"))r=t instanceof Date?t:new Date(t),bh.type(e,r,a,i,o),r&&bh.range(e,r.getTime(),a,i,o)}n(i)},url:Ah,hex:Ah,email:Ah,required:yh,any:function(e,t,n,a,o){var i=[];if(e.required||!e.required&&a.hasOwnProperty(e.field)){if(rh(t)&&!e.required)return n();bh.required(e,t,a,i,o)}n(i)}};var Sh=function(){function e(t){ht(this,e),Me(this,"rules",null),Me(this,"_messages",th),this.define(t)}return mt(e,[{key:"define",value:function(e){var t=this;if(!e)throw new Error("Cannot configure a schema with no rules");if("object"!==fe(e)||Array.isArray(e))throw new Error("Rules must be an object");this.rules={},Object.keys(e).forEach((function(n){var a=e[n];t.rules[n]=Array.isArray(a)?a:[a]}))}},{key:"messages",value:function(e){return e&&(this._messages=uh(eh(),e)),this._messages}},{key:"validate",value:function(t){var n=this,a=t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if("function"===typeof o&&(i=o,o={}),!this.rules||0===Object.keys(this.rules).length)return i&&i(null,a),Promise.resolve(a);if(o.messages){var r=this.messages();r===th&&(r=eh()),uh(r,o.messages),o.messages=r}else o.messages=this.messages();var s={};(o.keys||Object.keys(this.rules)).forEach((function(e){var o=n.rules[e],i=a[e];o.forEach((function(o){var r=o;"function"===typeof r.transform&&(a===t&&(a=Ke({},a)),void 0!==(i=a[e]=r.transform(i))&&null!==i&&(r.type=r.type||(Array.isArray(i)?"array":fe(i)))),(r="function"===typeof r?{validator:r}:Ke({},r)).validator=n.getValidationMethod(r),r.validator&&(r.field=e,r.fullField=r.fullField||e,r.type=n.getType(r),s[e]=s[e]||[],s[e].push({rule:r,value:i,source:a,field:e}))}))}));var l={};return ch(s,o,(function(t,n){var i,r=t.rule,s=("object"===r.type||"array"===r.type)&&("object"===fe(r.fields)||"object"===fe(r.defaultField));function c(e,t){return Ke(Ke({},t),{},{fullField:"".concat(r.fullField,".").concat(e),fullFields:r.fullFields?[].concat(Le(r.fullFields),[e]):[e]})}function g(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],g=Array.isArray(i)?i:[i];!o.suppressWarning&&g.length&&e.warning("async-validator:",g),g.length&&void 0!==r.message&&(g=[].concat(r.message));var u=g.map(gh(r,a));if(o.first&&u.length)return l[r.field]=1,n(u);if(s){if(r.required&&!t.value)return void 0!==r.message?u=[].concat(r.message).map(gh(r,a)):o.error&&(u=[o.error(r,ih(o.messages.required,r.field))]),n(u);var d={};r.defaultField&&Object.keys(t.value).map((function(e){d[e]=r.defaultField})),d=Ke(Ke({},d),t.rule.fields);var h={};Object.keys(d).forEach((function(e){var t=d[e],n=Array.isArray(t)?t:[t];h[e]=n.map(c.bind(null,e))}));var p=new e(h);p.messages(o.messages),t.rule.options&&(t.rule.options.messages=o.messages,t.rule.options.error=o.error),p.validate(t.value,t.rule.options||o,(function(e){var t=[];u&&u.length&&t.push.apply(t,Le(u)),e&&e.length&&t.push.apply(t,Le(e)),n(t.length?t:null)}))}else n(u)}if(s=s&&(r.required||!r.required&&t.value),r.field=t.field,r.asyncValidator)i=r.asyncValidator(r,t.value,g,t.source,o);else if(r.validator){try{i=r.validator(r,t.value,g,t.source,o)}catch(h){var u,d;null===(u=(d=console).error)||void 0===u||u.call(d,h),o.suppressValidatorError||setTimeout((function(){throw h}),0),g(h.message)}!0===i?g():!1===i?g("function"===typeof r.message?r.message(r.fullField||r.field):r.message||"".concat(r.fullField||r.field," fails")):i instanceof Array?g(i):i instanceof Error&&g(i.message)}i&&i.then&&i.then((function(){return g()}),(function(e){return g(e)}))}),(function(e){!function(e){var t=[],n={};function o(e){var n;Array.isArray(e)?t=(n=t).concat.apply(n,Le(e)):t.push(e)}for(var r=0;r<e.length;r++)o(e[r]);t.length?(n=oh(t),i(t,n)):i(null,a)}(e)}),a)}},{key:"getType",value:function(e){if(void 0===e.type&&e.pattern instanceof RegExp&&(e.type="pattern"),"function"!==typeof e.validator&&e.type&&!vh.hasOwnProperty(e.type))throw new Error(ih("Unknown rule type %s",e.type));return e.type||"string"}},{key:"getValidationMethod",value:function(e){if("function"===typeof e.validator)return e.validator;var t=Object.keys(e),n=t.indexOf("message");return-1!==n&&t.splice(n,1),1===t.length&&"required"===t[0]?vh.required:vh[this.getType(e)]||void 0}}]),e}();Me(Sh,"register",(function(e,t){if("function"!==typeof t)throw new Error("Cannot register a validator by type, validator is not a function");vh[e]=t})),Me(Sh,"warning",(function(){})),Me(Sh,"messages",th),Me(Sh,"validators",vh);var xh="'${name}' is not a valid ${type}",Gh={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:xh,method:xh,array:xh,object:xh,number:xh,date:xh,boolean:xh,integer:xh,float:xh,regexp:xh,email:xh,url:xh,hex:xh},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},Zh=Sh;function wh(e,t){return e.replace(/\$\{\w+\}/g,(function(e){var n=e.slice(2,-1);return t[n]}))}var kh="CODE_LOGIC_ERROR";function Bh(e,t,n,a,o){return Rh.apply(this,arguments)}function Rh(){return Rh=Is(ps().mark((function e(t,n,o,i,r){var s,l,c,g,u,d,h,p,m;return ps().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete(s=Ke({},o)).ruleIndex,Zh.warning=function(){},s.validator&&(l=s.validator,s.validator=function(){try{return l.apply(void 0,arguments)}catch(e){return console.error(e),Promise.reject(kh)}}),c=null,s&&"array"===s.type&&s.defaultField&&(c=s.defaultField,delete s.defaultField),g=new Zh(Me({},t,[s])),u=Fa(Gh,i.validateMessages),g.messages(u),d=[],e.prev=10,e.next=13,Promise.resolve(g.validate(Me({},t,n),Ke({},i)));case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),e.t0.errors&&(d=e.t0.errors.map((function(e,t){var n=e.message,o=n===kh?u.default:n;return a.isValidElement(o)?a.cloneElement(o,{key:"error_".concat(t)}):o})));case 18:if(d.length||!c){e.next=23;break}return e.next=21,Promise.all(n.map((function(e,n){return Bh("".concat(t,".").concat(n),e,c,i,r)})));case 21:return h=e.sent,e.abrupt("return",h.reduce((function(e,t){return[].concat(Le(e),Le(t))}),[]));case 23:return p=Ke(Ke({},o),{},{name:t,enum:(o.enum||[]).join(", ")},r),m=d.map((function(e){return"string"===typeof e?wh(e,p):e})),e.abrupt("return",m);case 26:case"end":return e.stop()}}),e,null,[[10,15]])}))),Rh.apply(this,arguments)}function Wh(e,t,n,a,o,i){var r,s=e.join("."),l=n.map((function(e,t){var n=e.validator,a=Ke(Ke({},e),{},{ruleIndex:t});return n&&(a.validator=function(e,t,a){var o=!1,i=n(e,t,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Promise.resolve().then((function(){ut(!o,"Your validator function has already return a promise. `callback` will be ignored."),o||a.apply(void 0,t)}))}));o=i&&"function"===typeof i.then&&"function"===typeof i.catch,ut(o,"`callback` is deprecated. Please return a promise instead."),o&&i.then((function(){a()})).catch((function(e){a(e||" ")}))}),a})).sort((function(e,t){var n=e.warningOnly,a=e.ruleIndex,o=t.warningOnly,i=t.ruleIndex;return!!n===!!o?a-i:n?1:-1}));if(!0===o)r=new Promise(function(){var e=Is(ps().mark((function e(n,o){var r,c,g;return ps().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<l.length)){e.next=12;break}return c=l[r],e.next=5,Bh(s,t,c,a,i);case 5:if(!(g=e.sent).length){e.next=9;break}return o([{errors:g,rule:c}]),e.abrupt("return");case 9:r+=1,e.next=1;break;case 12:n([]);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());else{var c=l.map((function(e){return Bh(s,t,e,a,i).then((function(t){return{errors:t,rule:e}}))}));r=(o?function(e){return Nh.apply(this,arguments)}(c):function(e){return Vh.apply(this,arguments)}(c)).then((function(e){return Promise.reject(e)}))}return r.catch((function(e){return e})),r}function Vh(){return(Vh=Is(ps().mark((function e(t){return ps().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t).then((function(e){var t;return(t=[]).concat.apply(t,Le(e))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nh(){return(Nh=Is(ps().mark((function e(t){var n;return ps().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,e.abrupt("return",new Promise((function(e){t.forEach((function(a){a.then((function(a){a.errors.length&&e([a]),(n+=1)===t.length&&e([])}))}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xh(e){return $d(e)}function Mh(e,t){var n={};return t.forEach((function(t){var a=Na(e,t);n=Ma(n,t,a)})),n}function Th(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&e.some((function(e){return Eh(t,e,n)}))}function Eh(e,t){return!(!e||!t)&&(!(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&e.length!==t.length)&&t.every((function(t,n){return e[n]===t})))}function Fh(e){var t=arguments.length<=1?void 0:arguments[1];return t&&t.target&&"object"===fe(t.target)&&e in t.target?t.target[e]:t}function Hh(e,t,n){var a=e.length;if(t<0||t>=a||n<0||n>=a)return e;var o=e[t],i=t-n;return i>0?[].concat(Le(e.slice(0,n)),[o],Le(e.slice(n,t)),Le(e.slice(t+1,a))):i<0?[].concat(Le(e.slice(0,t)),Le(e.slice(t+1,n+1)),[o],Le(e.slice(n+1,a))):e}var Jh=["name"],Yh=[];function Lh(e,t,n,a,o,i){return"function"===typeof e?e(t,n,"source"in i?{source:i.source}:{}):a!==o}var zh=function(e){kt(n,e);var t=Wt(n);function n(e){var o;(ht(this,n),Me(Zt(o=t.call(this,e)),"state",{resetCount:0}),Me(Zt(o),"cancelRegisterFunc",null),Me(Zt(o),"mounted",!1),Me(Zt(o),"touched",!1),Me(Zt(o),"dirty",!1),Me(Zt(o),"validatePromise",void 0),Me(Zt(o),"prevValidating",void 0),Me(Zt(o),"errors",Yh),Me(Zt(o),"warnings",Yh),Me(Zt(o),"cancelRegister",(function(){var e=o.props,t=e.preserve,n=e.isListField,a=e.name;o.cancelRegisterFunc&&o.cancelRegisterFunc(n,t,Xh(a)),o.cancelRegisterFunc=null})),Me(Zt(o),"getNamePath",(function(){var e=o.props,t=e.name,n=e.fieldContext.prefixName;return void 0!==t?[].concat(Le(void 0===n?[]:n),Le(t)):[]})),Me(Zt(o),"getRules",(function(){var e=o.props,t=e.rules,n=void 0===t?[]:t,a=e.fieldContext;return n.map((function(e){return"function"===typeof e?e(a):e}))})),Me(Zt(o),"refresh",(function(){o.mounted&&o.setState((function(e){return{resetCount:e.resetCount+1}}))})),Me(Zt(o),"metaCache",null),Me(Zt(o),"triggerMetaEvent",(function(e){var t=o.props.onMetaChange;if(t){var n=Ke(Ke({},o.getMeta()),{},{destroy:e});dt(o.metaCache,n)||t(n),o.metaCache=n}else o.metaCache=null})),Me(Zt(o),"onStoreChange",(function(e,t,n){var a=o.props,i=a.shouldUpdate,r=a.dependencies,s=void 0===r?[]:r,l=a.onReset,c=n.store,g=o.getNamePath(),u=o.getValue(e),d=o.getValue(c),h=t&&Th(t,g);switch("valueUpdate"!==n.type||"external"!==n.source||dt(u,d)||(o.touched=!0,o.dirty=!0,o.validatePromise=null,o.errors=Yh,o.warnings=Yh,o.triggerMetaEvent()),n.type){case"reset":if(!t||h)return o.touched=!1,o.dirty=!1,o.validatePromise=void 0,o.errors=Yh,o.warnings=Yh,o.triggerMetaEvent(),null===l||void 0===l||l(),void o.refresh();break;case"remove":if(i)return void o.reRender();break;case"setField":var p=n.data;if(h)return"touched"in p&&(o.touched=p.touched),"validating"in p&&!("originRCField"in p)&&(o.validatePromise=p.validating?Promise.resolve([]):null),"errors"in p&&(o.errors=p.errors||Yh),"warnings"in p&&(o.warnings=p.warnings||Yh),o.dirty=!0,o.triggerMetaEvent(),void o.reRender();if("value"in p&&Th(t,g,!0))return void o.reRender();if(i&&!g.length&&Lh(i,e,c,u,d,n))return void o.reRender();break;case"dependenciesUpdate":if(s.map(Xh).some((function(e){return Th(n.relatedFields,e)})))return void o.reRender();break;default:if(h||(!s.length||g.length||i)&&Lh(i,e,c,u,d,n))return void o.reRender()}!0===i&&o.reRender()})),Me(Zt(o),"validateRules",(function(e){var t=o.getNamePath(),n=o.getValue(),a=e||{},i=a.triggerName,r=a.validateOnly,s=void 0!==r&&r,l=Promise.resolve().then(Is(ps().mark((function a(){var r,s,c,g,u,d,h;return ps().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o.mounted){a.next=2;break}return a.abrupt("return",[]);case 2:if(r=o.props,s=r.validateFirst,c=void 0!==s&&s,g=r.messageVariables,u=r.validateDebounce,d=o.getRules(),i&&(d=d.filter((function(e){return e})).filter((function(e){var t=e.validateTrigger;return!t||$d(t).includes(i)}))),!u||!i){a.next=10;break}return a.next=8,new Promise((function(e){setTimeout(e,u)}));case 8:if(o.validatePromise===l){a.next=10;break}return a.abrupt("return",[]);case 10:return(h=Wh(t,n,d,e,c,g)).catch((function(e){return e})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yh;if(o.validatePromise===l){var t;o.validatePromise=null;var n=[],a=[];null===(t=e.forEach)||void 0===t||t.call(e,(function(e){var t=e.rule.warningOnly,o=e.errors,i=void 0===o?Yh:o;t?a.push.apply(a,Le(i)):n.push.apply(n,Le(i))})),o.errors=n,o.warnings=a,o.triggerMetaEvent(),o.reRender()}})),a.abrupt("return",h);case 13:case"end":return a.stop()}}),a)}))));return s||(o.validatePromise=l,o.dirty=!0,o.errors=Yh,o.warnings=Yh,o.triggerMetaEvent(),o.reRender()),l})),Me(Zt(o),"isFieldValidating",(function(){return!!o.validatePromise})),Me(Zt(o),"isFieldTouched",(function(){return o.touched})),Me(Zt(o),"isFieldDirty",(function(){return!(!o.dirty&&void 0===o.props.initialValue)||void 0!==(0,o.props.fieldContext.getInternalHooks(_d).getInitialValue)(o.getNamePath())})),Me(Zt(o),"getErrors",(function(){return o.errors})),Me(Zt(o),"getWarnings",(function(){return o.warnings})),Me(Zt(o),"isListField",(function(){return o.props.isListField})),Me(Zt(o),"isList",(function(){return o.props.isList})),Me(Zt(o),"isPreserve",(function(){return o.props.preserve})),Me(Zt(o),"getMeta",(function(){return o.prevValidating=o.isFieldValidating(),{touched:o.isFieldTouched(),validating:o.prevValidating,errors:o.errors,warnings:o.warnings,name:o.getNamePath(),validated:null===o.validatePromise}})),Me(Zt(o),"getOnlyChild",(function(e){if("function"===typeof e){var t=o.getMeta();return Ke(Ke({},o.getOnlyChild(e(o.getControlled(),t,o.props.fieldContext))),{},{isFunction:!0})}var n=Es(e);return 1===n.length&&a.isValidElement(n[0])?{child:n[0],isFunction:!1}:{child:n,isFunction:!1}})),Me(Zt(o),"getValue",(function(e){var t=o.props.fieldContext.getFieldsValue,n=o.getNamePath();return Na(e||t(!0),n)})),Me(Zt(o),"getControlled",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=o.props,n=t.name,a=t.trigger,i=t.validateTrigger,r=t.getValueFromEvent,s=t.normalize,l=t.valuePropName,c=t.getValueProps,g=t.fieldContext,u=void 0!==i?i:g.validateTrigger,d=o.getNamePath(),h=g.getInternalHooks,p=g.getFieldsValue,m=h(_d).dispatch,I=o.getValue(),C=c||function(e){return Me({},l,e)},f=e[a],b=void 0!==n?C(I):{};var y=Ke(Ke({},e),b);return y[a]=function(){var e;o.touched=!0,o.dirty=!0,o.triggerMetaEvent();for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];e=r?r.apply(void 0,n):Fh.apply(void 0,[l].concat(n)),s&&(e=s(e,I,p(!0))),m({type:"updateValue",namePath:d,value:e}),f&&f.apply(void 0,n)},$d(u||[]).forEach((function(e){var t=y[e];y[e]=function(){t&&t.apply(void 0,arguments);var n=o.props.rules;n&&n.length&&m({type:"validateField",namePath:d,triggerName:e})}})),y})),e.fieldContext)&&(0,(0,e.fieldContext.getInternalHooks)(_d).initEntityValue)(Zt(o));return o}return mt(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.shouldUpdate,n=e.fieldContext;if(this.mounted=!0,n){var a=(0,n.getInternalHooks)(_d).registerField;this.cancelRegisterFunc=a(this)}!0===t&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var e,t=this.state.resetCount,n=this.props.children,o=this.getOnlyChild(n),i=o.child;return o.isFunction?e=i:a.isValidElement(i)?e=a.cloneElement(i,this.getControlled(i.props)):(ut(!i,"`children` of Field is not validate ReactElement."),e=i),a.createElement(a.Fragment,{key:t},e)}}]),n}(a.Component);Me(zh,"contextType",jd),Me(zh,"defaultProps",{trigger:"onChange",valuePropName:"value"});const Kh=function(e){var t=e.name,n=ir(e,Jh),o=a.useContext(jd),i=a.useContext(qd),r=void 0!==t?Xh(t):void 0,s="keep";return n.isListField||(s="_".concat((r||[]).join("_"))),a.createElement(zh,yn({key:s,name:r,isListField:!!i},n,{fieldContext:o}))};const Dh=function(e){var t=e.name,n=e.initialValue,o=e.children,i=e.rules,r=e.validateTrigger,s=e.isListField,l=a.useContext(jd),c=a.useContext(qd),g=a.useRef({keys:[],id:0}).current,u=a.useMemo((function(){var e=Xh(l.prefixName)||[];return[].concat(Le(e),Le(Xh(t)))}),[l.prefixName,t]),d=a.useMemo((function(){return Ke(Ke({},l),{},{prefixName:u})}),[l,u]),h=a.useMemo((function(){return{getKey:function(e){var t=u.length,n=e[t];return[g.keys[n],e.slice(t+1)]}}}),[u]);return"function"!==typeof o?(ut(!1,"Form.List only accepts function as children."),null):a.createElement(qd.Provider,{value:h},a.createElement(jd.Provider,{value:d},a.createElement(Kh,{name:[],shouldUpdate:function(e,t,n){return"internal"!==n.source&&e!==t},rules:i,validateTrigger:r,initialValue:n,isList:!0,isListField:null!==s&&void 0!==s?s:!!c},(function(e,t){var n=e.value,a=void 0===n?[]:n,i=e.onChange,r=l.getFieldValue,s=function(){return r(u||[])||[]},c={add:function(e,t){var n=s();t>=0&&t<=n.length?(g.keys=[].concat(Le(g.keys.slice(0,t)),[g.id],Le(g.keys.slice(t))),i([].concat(Le(n.slice(0,t)),[e],Le(n.slice(t))))):(g.keys=[].concat(Le(g.keys),[g.id]),i([].concat(Le(n),[e]))),g.id+=1},remove:function(e){var t=s(),n=new Set(Array.isArray(e)?e:[e]);n.size<=0||(g.keys=g.keys.filter((function(e,t){return!n.has(t)})),i(t.filter((function(e,t){return!n.has(t)}))))},move:function(e,t){if(e!==t){var n=s();e<0||e>=n.length||t<0||t>=n.length||(g.keys=Hh(g.keys,e,t),i(Hh(n,e,t)))}}},d=a||[];return Array.isArray(d)||(d=[]),o(d.map((function(e,t){var n=g.keys[t];return void 0===n&&(g.keys[t]=g.id,n=g.keys[t],g.id+=1),{name:t,key:n,isListField:!0}})),c,t)}))))};var Uh="__@field_split__";function Ph(e){return e.map((function(e){return"".concat(fe(e),":").concat(e)})).join(Uh)}var Oh=function(){function e(){ht(this,e),Me(this,"kvs",new Map)}return mt(e,[{key:"set",value:function(e,t){this.kvs.set(Ph(e),t)}},{key:"get",value:function(e){return this.kvs.get(Ph(e))}},{key:"update",value:function(e,t){var n=t(this.get(e));n?this.set(e,n):this.delete(e)}},{key:"delete",value:function(e){this.kvs.delete(Ph(e))}},{key:"map",value:function(e){return Le(this.kvs.entries()).map((function(t){var n=Je(t,2),a=n[0],o=n[1],i=a.split(Uh);return e({key:i.map((function(e){var t=Je(e.match(/^([^:]*):(.*)$/),3),n=t[1],a=t[2];return"number"===n?Number(a):a})),value:o})}))}},{key:"toJSON",value:function(){var e={};return this.map((function(t){var n=t.key,a=t.value;return e[n.join(".")]=a,null})),e}}]),e}();const _h=Oh;var Qh=["name"],jh=mt((function e(t){var n=this;ht(this,e),Me(this,"formHooked",!1),Me(this,"forceRootUpdate",void 0),Me(this,"subscribable",!0),Me(this,"store",{}),Me(this,"fieldEntities",[]),Me(this,"initialValues",{}),Me(this,"callbacks",{}),Me(this,"validateMessages",null),Me(this,"preserve",null),Me(this,"lastValidatePromise",null),Me(this,"getForm",(function(){return{getFieldValue:n.getFieldValue,getFieldsValue:n.getFieldsValue,getFieldError:n.getFieldError,getFieldWarning:n.getFieldWarning,getFieldsError:n.getFieldsError,isFieldsTouched:n.isFieldsTouched,isFieldTouched:n.isFieldTouched,isFieldValidating:n.isFieldValidating,isFieldsValidating:n.isFieldsValidating,resetFields:n.resetFields,setFields:n.setFields,setFieldValue:n.setFieldValue,setFieldsValue:n.setFieldsValue,validateFields:n.validateFields,submit:n.submit,_init:!0,getInternalHooks:n.getInternalHooks}})),Me(this,"getInternalHooks",(function(e){return e===_d?(n.formHooked=!0,{dispatch:n.dispatch,initEntityValue:n.initEntityValue,registerField:n.registerField,useSubscribe:n.useSubscribe,setInitialValues:n.setInitialValues,destroyForm:n.destroyForm,setCallbacks:n.setCallbacks,setValidateMessages:n.setValidateMessages,getFields:n.getFields,setPreserve:n.setPreserve,getInitialValue:n.getInitialValue,registerWatch:n.registerWatch}):(ut(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)})),Me(this,"useSubscribe",(function(e){n.subscribable=e})),Me(this,"prevWithoutPreserves",null),Me(this,"setInitialValues",(function(e,t){if(n.initialValues=e||{},t){var a,o=Fa(e,n.store);null===(a=n.prevWithoutPreserves)||void 0===a||a.map((function(t){var n=t.key;o=Ma(o,n,Na(e,n))})),n.prevWithoutPreserves=null,n.updateStore(o)}})),Me(this,"destroyForm",(function(e){if(e)n.updateStore({});else{var t=new _h;n.getFieldEntities(!0).forEach((function(e){n.isMergedPreserve(e.isPreserve())||t.set(e.getNamePath(),!0)})),n.prevWithoutPreserves=t}})),Me(this,"getInitialValue",(function(e){var t=Na(n.initialValues,e);return e.length?Fa(t):t})),Me(this,"setCallbacks",(function(e){n.callbacks=e})),Me(this,"setValidateMessages",(function(e){n.validateMessages=e})),Me(this,"setPreserve",(function(e){n.preserve=e})),Me(this,"watchList",[]),Me(this,"registerWatch",(function(e){return n.watchList.push(e),function(){n.watchList=n.watchList.filter((function(t){return t!==e}))}})),Me(this,"notifyWatch",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(n.watchList.length){var t=n.getFieldsValue(),a=n.getFieldsValue(!0);n.watchList.forEach((function(n){n(t,a,e)}))}})),Me(this,"timeoutId",null),Me(this,"warningUnhooked",(function(){0})),Me(this,"updateStore",(function(e){n.store=e})),Me(this,"getFieldEntities",(function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?n.fieldEntities.filter((function(e){return e.getNamePath().length})):n.fieldEntities})),Me(this,"getFieldsMap",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new _h;return n.getFieldEntities(e).forEach((function(e){var n=e.getNamePath();t.set(n,e)})),t})),Me(this,"getFieldEntitiesForNamePathList",(function(e){if(!e)return n.getFieldEntities(!0);var t=n.getFieldsMap(!0);return e.map((function(e){var n=Xh(e);return t.get(n)||{INVALIDATE_NAME_PATH:Xh(e)}}))})),Me(this,"getFieldsValue",(function(e,t){var a,o,i;if(n.warningUnhooked(),!0===e||Array.isArray(e)?(a=e,o=t):e&&"object"===fe(e)&&(i=e.strict,o=e.filter),!0===a&&!o)return n.store;var r=n.getFieldEntitiesForNamePathList(Array.isArray(a)?a:null),s=[];return r.forEach((function(e){var t,n,r,l,c="INVALIDATE_NAME_PATH"in e?e.INVALIDATE_NAME_PATH:e.getNamePath();if(i){if(null!==(r=(l=e).isList)&&void 0!==r&&r.call(l))return}else if(!a&&null!==(t=(n=e).isListField)&&void 0!==t&&t.call(n))return;if(o){var g="getMeta"in e?e.getMeta():null;o(g)&&s.push(c)}else s.push(c)})),Mh(n.store,s.map(Xh))})),Me(this,"getFieldValue",(function(e){n.warningUnhooked();var t=Xh(e);return Na(n.store,t)})),Me(this,"getFieldsError",(function(e){return n.warningUnhooked(),n.getFieldEntitiesForNamePathList(e).map((function(t,n){return t&&!("INVALIDATE_NAME_PATH"in t)?{name:t.getNamePath(),errors:t.getErrors(),warnings:t.getWarnings()}:{name:Xh(e[n]),errors:[],warnings:[]}}))})),Me(this,"getFieldError",(function(e){n.warningUnhooked();var t=Xh(e);return n.getFieldsError([t])[0].errors})),Me(this,"getFieldWarning",(function(e){n.warningUnhooked();var t=Xh(e);return n.getFieldsError([t])[0].warnings})),Me(this,"isFieldsTouched",(function(){n.warningUnhooked();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var o,i=t[0],r=t[1],s=!1;0===t.length?o=null:1===t.length?Array.isArray(i)?(o=i.map(Xh),s=!1):(o=null,s=i):(o=i.map(Xh),s=r);var l=n.getFieldEntities(!0),c=function(e){return e.isFieldTouched()};if(!o)return s?l.every((function(e){return c(e)||e.isList()})):l.some(c);var g=new _h;o.forEach((function(e){g.set(e,[])})),l.forEach((function(e){var t=e.getNamePath();o.forEach((function(n){n.every((function(e,n){return t[n]===e}))&&g.update(n,(function(t){return[].concat(Le(t),[e])}))}))}));var u=function(e){return e.some(c)},d=g.map((function(e){return e.value}));return s?d.every(u):d.some(u)})),Me(this,"isFieldTouched",(function(e){return n.warningUnhooked(),n.isFieldsTouched([e])})),Me(this,"isFieldsValidating",(function(e){n.warningUnhooked();var t=n.getFieldEntities();if(!e)return t.some((function(e){return e.isFieldValidating()}));var a=e.map(Xh);return t.some((function(e){var t=e.getNamePath();return Th(a,t)&&e.isFieldValidating()}))})),Me(this,"isFieldValidating",(function(e){return n.warningUnhooked(),n.isFieldsValidating([e])})),Me(this,"resetWithFieldInitialValue",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new _h,a=n.getFieldEntities(!0);a.forEach((function(e){var n=e.props.initialValue,a=e.getNamePath();if(void 0!==n){var o=t.get(a)||new Set;o.add({entity:e,value:n}),t.set(a,o)}}));var o;e.entities?o=e.entities:e.namePathList?(o=[],e.namePathList.forEach((function(e){var n,a=t.get(e);a&&(n=o).push.apply(n,Le(Le(a).map((function(e){return e.entity}))))}))):o=a,o.forEach((function(a){if(void 0!==a.props.initialValue){var o=a.getNamePath();if(void 0!==n.getInitialValue(o))ut(!1,"Form already set 'initialValues' with path '".concat(o.join("."),"'. Field can not overwrite it."));else{var i=t.get(o);if(i&&i.size>1)ut(!1,"Multiple Field with path '".concat(o.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(i){var r=n.getFieldValue(o);a.isListField()||e.skipExist&&void 0!==r||n.updateStore(Ma(n.store,o,Le(i)[0].value))}}}}))})),Me(this,"resetFields",(function(e){n.warningUnhooked();var t=n.store;if(!e)return n.updateStore(Fa(n.initialValues)),n.resetWithFieldInitialValue(),n.notifyObservers(t,null,{type:"reset"}),void n.notifyWatch();var a=e.map(Xh);a.forEach((function(e){var t=n.getInitialValue(e);n.updateStore(Ma(n.store,e,t))})),n.resetWithFieldInitialValue({namePathList:a}),n.notifyObservers(t,a,{type:"reset"}),n.notifyWatch(a)})),Me(this,"setFields",(function(e){n.warningUnhooked();var t=n.store,a=[];e.forEach((function(e){var o=e.name,i=ir(e,Qh),r=Xh(o);a.push(r),"value"in i&&n.updateStore(Ma(n.store,r,i.value)),n.notifyObservers(t,[r],{type:"setField",data:e})})),n.notifyWatch(a)})),Me(this,"getFields",(function(){return n.getFieldEntities(!0).map((function(e){var t=e.getNamePath(),a=Ke(Ke({},e.getMeta()),{},{name:t,value:n.getFieldValue(t)});return Object.defineProperty(a,"originRCField",{value:!0}),a}))})),Me(this,"initEntityValue",(function(e){var t=e.props.initialValue;if(void 0!==t){var a=e.getNamePath();void 0===Na(n.store,a)&&n.updateStore(Ma(n.store,a,t))}})),Me(this,"isMergedPreserve",(function(e){var t=void 0!==e?e:n.preserve;return null===t||void 0===t||t})),Me(this,"registerField",(function(e){n.fieldEntities.push(e);var t=e.getNamePath();if(n.notifyWatch([t]),void 0!==e.props.initialValue){var a=n.store;n.resetWithFieldInitialValue({entities:[e],skipExist:!0}),n.notifyObservers(a,[e.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(a,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(n.fieldEntities=n.fieldEntities.filter((function(t){return t!==e})),!n.isMergedPreserve(o)&&(!a||i.length>1)){var r=a?void 0:n.getInitialValue(t);if(t.length&&n.getFieldValue(t)!==r&&n.fieldEntities.every((function(e){return!Eh(e.getNamePath(),t)}))){var s=n.store;n.updateStore(Ma(s,t,r,!0)),n.notifyObservers(s,[t],{type:"remove"}),n.triggerDependenciesUpdate(s,t)}}n.notifyWatch([t])}})),Me(this,"dispatch",(function(e){switch(e.type){case"updateValue":var t=e.namePath,a=e.value;n.updateValue(t,a);break;case"validateField":var o=e.namePath,i=e.triggerName;n.validateFields([o],{triggerName:i})}})),Me(this,"notifyObservers",(function(e,t,a){if(n.subscribable){var o=Ke(Ke({},a),{},{store:n.getFieldsValue(!0)});n.getFieldEntities().forEach((function(n){(0,n.onStoreChange)(e,t,o)}))}else n.forceRootUpdate()})),Me(this,"triggerDependenciesUpdate",(function(e,t){var a=n.getDependencyChildrenFields(t);return a.length&&n.validateFields(a),n.notifyObservers(e,a,{type:"dependenciesUpdate",relatedFields:[t].concat(Le(a))}),a})),Me(this,"updateValue",(function(e,t){var a=Xh(e),o=n.store;n.updateStore(Ma(n.store,a,t)),n.notifyObservers(o,[a],{type:"valueUpdate",source:"internal"}),n.notifyWatch([a]);var i=n.triggerDependenciesUpdate(o,a),r=n.callbacks.onValuesChange;r&&r(Mh(n.store,[a]),n.getFieldsValue());n.triggerOnFieldsChange([a].concat(Le(i)))})),Me(this,"setFieldsValue",(function(e){n.warningUnhooked();var t=n.store;if(e){var a=Fa(n.store,e);n.updateStore(a)}n.notifyObservers(t,null,{type:"valueUpdate",source:"external"}),n.notifyWatch()})),Me(this,"setFieldValue",(function(e,t){n.setFields([{name:e,value:t}])})),Me(this,"getDependencyChildrenFields",(function(e){var t=new Set,a=[],o=new _h;n.getFieldEntities().forEach((function(e){(e.props.dependencies||[]).forEach((function(t){var n=Xh(t);o.update(n,(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return t.add(e),t}))}))}));return function e(n){(o.get(n)||new Set).forEach((function(n){if(!t.has(n)){t.add(n);var o=n.getNamePath();n.isFieldDirty()&&o.length&&(a.push(o),e(o))}}))}(e),a})),Me(this,"triggerOnFieldsChange",(function(e,t){var a=n.callbacks.onFieldsChange;if(a){var o=n.getFields();if(t){var i=new _h;t.forEach((function(e){var t=e.name,n=e.errors;i.set(t,n)})),o.forEach((function(e){e.errors=i.get(e.name)||e.errors}))}var r=o.filter((function(t){var n=t.name;return Th(e,n)}));r.length&&a(r,o)}})),Me(this,"validateFields",(function(e,t){var a,o;n.warningUnhooked(),Array.isArray(e)||"string"===typeof e||"string"===typeof t?(a=e,o=t):o=e;var i=!!a,r=i?a.map(Xh):[],s=[],l=String(Date.now()),c=new Set,g=o||{},u=g.recursive,d=g.dirty;n.getFieldEntities(!0).forEach((function(e){if(i||r.push(e.getNamePath()),e.props.rules&&e.props.rules.length&&(!d||e.isFieldDirty())){var t=e.getNamePath();if(c.add(t.join(l)),!i||Th(r,t,u)){var a=e.validateRules(Ke({validateMessages:Ke(Ke({},Gh),n.validateMessages)},o));s.push(a.then((function(){return{name:t,errors:[],warnings:[]}})).catch((function(e){var n,a=[],o=[];return null===(n=e.forEach)||void 0===n||n.call(e,(function(e){var t=e.rule.warningOnly,n=e.errors;t?o.push.apply(o,Le(n)):a.push.apply(a,Le(n))})),a.length?Promise.reject({name:t,errors:a,warnings:o}):{name:t,errors:a,warnings:o}})))}}}));var h=function(e){var t=!1,n=e.length,a=[];return e.length?new Promise((function(o,i){e.forEach((function(e,r){e.catch((function(e){return t=!0,e})).then((function(e){n-=1,a[r]=e,n>0||(t&&i(a),o(a))}))}))})):Promise.resolve([])}(s);n.lastValidatePromise=h,h.catch((function(e){return e})).then((function(e){var t=e.map((function(e){return e.name}));n.notifyObservers(n.store,t,{type:"validateFinish"}),n.triggerOnFieldsChange(t,e)}));var p=h.then((function(){return n.lastValidatePromise===h?Promise.resolve(n.getFieldsValue(r)):Promise.reject([])})).catch((function(e){var t=e.filter((function(e){return e&&e.errors.length}));return Promise.reject({values:n.getFieldsValue(r),errorFields:t,outOfDate:n.lastValidatePromise!==h})}));p.catch((function(e){return e}));var m=r.filter((function(e){return c.has(e.join(l))}));return n.triggerOnFieldsChange(m),p})),Me(this,"submit",(function(){n.warningUnhooked(),n.validateFields().then((function(e){var t=n.callbacks.onFinish;if(t)try{t(e)}catch(a){console.error(a)}})).catch((function(e){var t=n.callbacks.onFinishFailed;t&&t(e)}))})),this.forceRootUpdate=t}));const qh=function(e){var t=a.useRef(),n=Je(a.useState({}),2)[1];if(!t.current)if(e)t.current=e;else{var o=new jh((function(){n({})}));t.current=o.getForm()}return[t.current]};var $h=a.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}});const ep=$h;var tp=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed","clearOnDestroy"];const np=function(e,t){var n=e.name,o=e.initialValues,i=e.fields,r=e.form,s=e.preserve,l=e.children,c=e.component,g=void 0===c?"form":c,u=e.validateMessages,d=e.validateTrigger,h=void 0===d?"onChange":d,p=e.onValuesChange,m=e.onFieldsChange,I=e.onFinish,C=e.onFinishFailed,f=e.clearOnDestroy,b=ir(e,tp),y=a.useRef(null),A=a.useContext(ep),v=Je(qh(r),1)[0],S=v.getInternalHooks(_d),x=S.useSubscribe,G=S.setInitialValues,Z=S.setCallbacks,w=S.setValidateMessages,k=S.setPreserve,B=S.destroyForm;a.useImperativeHandle(t,(function(){return Ke(Ke({},v),{},{nativeElement:y.current})})),a.useEffect((function(){return A.registerForm(n,v),function(){A.unregisterForm(n)}}),[A,v,n]),w(Ke(Ke({},A.validateMessages),u)),Z({onValuesChange:p,onFieldsChange:function(e){if(A.triggerFormChange(n,e),m){for(var t=arguments.length,a=new Array(t>1?t-1:0),o=1;o<t;o++)a[o-1]=arguments[o];m.apply(void 0,[e].concat(a))}},onFinish:function(e){A.triggerFormFinish(n,e),I&&I(e)},onFinishFailed:C}),k(s);var R,W=a.useRef(null);G(o,!W.current),W.current||(W.current=!0),a.useEffect((function(){return function(){return B(f)}}),[]);var V="function"===typeof l;V?R=l(v.getFieldsValue(!0),v):R=l;x(!V);var N=a.useRef();a.useEffect((function(){(function(e,t){if(e===t)return!0;if(!e&&t||e&&!t)return!1;if(!e||!t||"object"!==fe(e)||"object"!==fe(t))return!1;var n=Object.keys(e),a=Object.keys(t);return Le(new Set([].concat(n,a))).every((function(n){var a=e[n],o=t[n];return"function"===typeof a&&"function"===typeof o||a===o}))})(N.current||[],i||[])||v.setFields(i||[]),N.current=i}),[i,v]);var X=a.useMemo((function(){return Ke(Ke({},v),{},{validateTrigger:h})}),[v,h]),M=a.createElement(qd.Provider,{value:null},a.createElement(jd.Provider,{value:X},R));return!1===g?M:a.createElement(g,yn({},b,{ref:y,onSubmit:function(e){e.preventDefault(),e.stopPropagation(),v.submit()},onReset:function(e){var t;e.preventDefault(),v.resetFields(),null===(t=b.onReset)||void 0===t||t.call(b,e)}}),M)};function ap(e){try{return JSON.stringify(e)}catch(t){return Math.random()}}var op=function(){};const ip=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=t[0],i=t[1],r=void 0===i?{}:i,s=function(e){return e&&!!e._init}(r)?{form:r}:r,l=s.form,c=Je((0,a.useState)(),2),g=c[0],u=c[1],d=(0,a.useMemo)((function(){return ap(g)}),[g]),h=(0,a.useRef)(d);h.current=d;var p=(0,a.useContext)(jd),m=l||p,I=m&&m._init,C=Xh(o),f=(0,a.useRef)(C);return f.current=C,op(C),(0,a.useEffect)((function(){if(I){var e=m.getFieldsValue,t=(0,m.getInternalHooks)(_d).registerWatch,n=function(e,t){var n=s.preserve?t:e;return"function"===typeof o?o(n):Na(n,f.current)},a=t((function(e,t){var a=n(e,t),o=ap(a);h.current!==o&&(h.current=o,u(a))})),i=n(e(),e(!0));return g!==i&&u(i),a}}),[I]),g};var rp=a.forwardRef(np);rp.FormProvider=function(e){var t=e.validateMessages,n=e.onFormChange,o=e.onFormFinish,i=e.children,r=a.useContext($h),s=a.useRef({});return a.createElement($h.Provider,{value:Ke(Ke({},r),{},{validateMessages:Ke(Ke({},r.validateMessages),t),triggerFormChange:function(e,t){n&&n(e,{changedFields:t,forms:s.current}),r.triggerFormChange(e,t)},triggerFormFinish:function(e,t){o&&o(e,{values:t,forms:s.current}),r.triggerFormFinish(e,t)},registerForm:function(e,t){e&&(s.current=Ke(Ke({},s.current),{},Me({},e,t))),r.registerForm(e,t)},unregisterForm:function(e){var t=Ke({},s.current);delete t[e],s.current=t,r.unregisterForm(e)}})},i)},rp.Field=Kh,rp.List=Dh,rp.useForm=qh,rp.useWatch=ip;const sp=a.createContext({});const lp=e=>{let{children:t,status:n,override:o}=e;const i=(0,a.useContext)(sp),r=(0,a.useMemo)((()=>{const e=Object.assign({},i);return o&&delete e.isFormItemInput,n&&(delete e.status,delete e.hasFeedback,delete e.feedbackIcon),e}),[n,o,i]);return a.createElement(sp.Provider,{value:r},t)},cp=(0,a.createContext)(void 0),gp=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;var o,i;const{variant:r,[e]:s}=(0,a.useContext)(Be),l=(0,a.useContext)(cp),c=null===s||void 0===s?void 0:s.variant;let g;g="undefined"!==typeof t?t:!1===n?"borderless":null!==(i=null!==(o=null!==l&&void 0!==l?l:c)&&void 0!==o?o:r)&&void 0!==i?i:"outlined";return[g,ke.includes(g)]};const up=function(e,t){return e||(e=>{const t={overflow:{adjustX:!0,adjustY:!0,shiftY:!0},htmlRegion:"scroll"===e?"scroll":"visible",dynamicInset:!0};return{bottomLeft:Object.assign(Object.assign({},t),{points:["tl","bl"],offset:[0,4]}),bottomRight:Object.assign(Object.assign({},t),{points:["tr","br"],offset:[0,4]}),topLeft:Object.assign(Object.assign({},t),{points:["bl","tl"],offset:[0,-4]}),topRight:Object.assign(Object.assign({},t),{points:["br","tr"],offset:[0,-4]})}})(t)},dp=e=>({animationDuration:e,animationFillMode:"both"}),hp=e=>({animationDuration:e,animationFillMode:"both"}),pp=function(e,t,n,a){const o=arguments.length>4&&void 0!==arguments[4]&&arguments[4]?"&":"";return{["\n      ".concat(o).concat(e,"-enter,\n      ").concat(o).concat(e,"-appear\n    ")]:Object.assign(Object.assign({},dp(a)),{animationPlayState:"paused"}),["".concat(o).concat(e,"-leave")]:Object.assign(Object.assign({},hp(a)),{animationPlayState:"paused"}),["\n      ".concat(o).concat(e,"-enter").concat(e,"-enter-active,\n      ").concat(o).concat(e,"-appear").concat(e,"-appear-active\n    ")]:{animationName:t,animationPlayState:"running"},["".concat(o).concat(e,"-leave").concat(e,"-leave-active")]:{animationName:n,animationPlayState:"running",pointerEvents:"none"}}},mp=new Za("antSlideUpIn",{"0%":{transform:"scaleY(0.8)",transformOrigin:"0% 0%",opacity:0},"100%":{transform:"scaleY(1)",transformOrigin:"0% 0%",opacity:1}}),Ip=new Za("antSlideUpOut",{"0%":{transform:"scaleY(1)",transformOrigin:"0% 0%",opacity:1},"100%":{transform:"scaleY(0.8)",transformOrigin:"0% 0%",opacity:0}}),Cp=new Za("antSlideDownIn",{"0%":{transform:"scaleY(0.8)",transformOrigin:"100% 100%",opacity:0},"100%":{transform:"scaleY(1)",transformOrigin:"100% 100%",opacity:1}}),fp=new Za("antSlideDownOut",{"0%":{transform:"scaleY(1)",transformOrigin:"100% 100%",opacity:1},"100%":{transform:"scaleY(0.8)",transformOrigin:"100% 100%",opacity:0}}),bp=new Za("antSlideLeftIn",{"0%":{transform:"scaleX(0.8)",transformOrigin:"0% 0%",opacity:0},"100%":{transform:"scaleX(1)",transformOrigin:"0% 0%",opacity:1}}),yp=new Za("antSlideLeftOut",{"0%":{transform:"scaleX(1)",transformOrigin:"0% 0%",opacity:1},"100%":{transform:"scaleX(0.8)",transformOrigin:"0% 0%",opacity:0}}),Ap=new Za("antSlideRightIn",{"0%":{transform:"scaleX(0.8)",transformOrigin:"100% 0%",opacity:0},"100%":{transform:"scaleX(1)",transformOrigin:"100% 0%",opacity:1}}),vp=new Za("antSlideRightOut",{"0%":{transform:"scaleX(1)",transformOrigin:"100% 0%",opacity:1},"100%":{transform:"scaleX(0.8)",transformOrigin:"100% 0%",opacity:0}}),Sp={"slide-up":{inKeyframes:mp,outKeyframes:Ip},"slide-down":{inKeyframes:Cp,outKeyframes:fp},"slide-left":{inKeyframes:bp,outKeyframes:yp},"slide-right":{inKeyframes:Ap,outKeyframes:vp}},xp=(e,t)=>{const{antCls:n}=e,a="".concat(n,"-").concat(t),{inKeyframes:o,outKeyframes:i}=Sp[t];return[pp(a,o,i,e.motionDurationMid),{["\n      ".concat(a,"-enter,\n      ").concat(a,"-appear\n    ")]:{transform:"scale(0)",transformOrigin:"0% 0%",opacity:0,animationTimingFunction:e.motionEaseOutQuint,"&-prepare":{transform:"scale(1)"}},["".concat(a,"-leave")]:{animationTimingFunction:e.motionEaseInQuint}}]},Gp=new Za("antMoveDownIn",{"0%":{transform:"translate3d(0, 100%, 0)",transformOrigin:"0 0",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1}}),Zp=new Za("antMoveDownOut",{"0%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1},"100%":{transform:"translate3d(0, 100%, 0)",transformOrigin:"0 0",opacity:0}}),wp=new Za("antMoveLeftIn",{"0%":{transform:"translate3d(-100%, 0, 0)",transformOrigin:"0 0",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1}}),kp=new Za("antMoveLeftOut",{"0%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1},"100%":{transform:"translate3d(-100%, 0, 0)",transformOrigin:"0 0",opacity:0}}),Bp=new Za("antMoveRightIn",{"0%":{transform:"translate3d(100%, 0, 0)",transformOrigin:"0 0",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1}}),Rp=new Za("antMoveRightOut",{"0%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1},"100%":{transform:"translate3d(100%, 0, 0)",transformOrigin:"0 0",opacity:0}}),Wp={"move-up":{inKeyframes:new Za("antMoveUpIn",{"0%":{transform:"translate3d(0, -100%, 0)",transformOrigin:"0 0",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1}}),outKeyframes:new Za("antMoveUpOut",{"0%":{transform:"translate3d(0, 0, 0)",transformOrigin:"0 0",opacity:1},"100%":{transform:"translate3d(0, -100%, 0)",transformOrigin:"0 0",opacity:0}})},"move-down":{inKeyframes:Gp,outKeyframes:Zp},"move-left":{inKeyframes:wp,outKeyframes:kp},"move-right":{inKeyframes:Bp,outKeyframes:Rp}},Vp=(e,t)=>{const{antCls:n}=e,a="".concat(n,"-").concat(t),{inKeyframes:o,outKeyframes:i}=Wp[t];return[pp(a,o,i,e.motionDurationMid),{["\n        ".concat(a,"-enter,\n        ").concat(a,"-appear\n      ")]:{opacity:0,animationTimingFunction:e.motionEaseOutCirc},["".concat(a,"-leave")]:{animationTimingFunction:e.motionEaseInOutCirc}}]},Np=e=>{const{optionHeight:t,optionFontSize:n,optionLineHeight:a,optionPadding:o}=e;return{position:"relative",display:"block",minHeight:t,padding:o,color:e.colorText,fontWeight:"normal",fontSize:n,lineHeight:a,boxSizing:"border-box"}},Xp=e=>{const{antCls:t,componentCls:n}=e,a="".concat(n,"-item"),o="&".concat(t,"-slide-up-enter").concat(t,"-slide-up-enter-active"),i="&".concat(t,"-slide-up-appear").concat(t,"-slide-up-appear-active"),r="&".concat(t,"-slide-up-leave").concat(t,"-slide-up-leave-active"),s="".concat(n,"-dropdown-placement-");return[{["".concat(n,"-dropdown")]:Object.assign(Object.assign({},za(e)),{position:"absolute",top:-9999,zIndex:e.zIndexPopup,boxSizing:"border-box",padding:e.paddingXXS,overflow:"hidden",fontSize:e.fontSize,fontVariant:"initial",backgroundColor:e.colorBgElevated,borderRadius:e.borderRadiusLG,outline:"none",boxShadow:e.boxShadowSecondary,["\n          ".concat(o).concat(s,"bottomLeft,\n          ").concat(i).concat(s,"bottomLeft\n        ")]:{animationName:mp},["\n          ".concat(o).concat(s,"topLeft,\n          ").concat(i).concat(s,"topLeft,\n          ").concat(o).concat(s,"topRight,\n          ").concat(i).concat(s,"topRight\n        ")]:{animationName:Cp},["".concat(r).concat(s,"bottomLeft")]:{animationName:Ip},["\n          ".concat(r).concat(s,"topLeft,\n          ").concat(r).concat(s,"topRight\n        ")]:{animationName:fp},"&-hidden":{display:"none"},["".concat(a)]:Object.assign(Object.assign({},Np(e)),{cursor:"pointer",transition:"background ".concat(e.motionDurationSlow," ease"),borderRadius:e.borderRadiusSM,"&-group":{color:e.colorTextDescription,fontSize:e.fontSizeSM,cursor:"default"},"&-option":{display:"flex","&-content":Object.assign({flex:"auto"},La),"&-state":{flex:"none",display:"flex",alignItems:"center"},["&-active:not(".concat(a,"-option-disabled)")]:{backgroundColor:e.optionActiveBg},["&-selected:not(".concat(a,"-option-disabled)")]:{color:e.optionSelectedColor,fontWeight:e.optionSelectedFontWeight,backgroundColor:e.optionSelectedBg,["".concat(a,"-option-state")]:{color:e.colorPrimary},["&:has(+ ".concat(a,"-option-selected:not(").concat(a,"-option-disabled))")]:{borderEndStartRadius:0,borderEndEndRadius:0,["& + ".concat(a,"-option-selected:not(").concat(a,"-option-disabled)")]:{borderStartStartRadius:0,borderStartEndRadius:0}}},"&-disabled":{["&".concat(a,"-option-selected")]:{backgroundColor:e.colorBgContainerDisabled},color:e.colorTextDisabled,cursor:"not-allowed"},"&-grouped":{paddingInlineStart:e.calc(e.controlPaddingHorizontal).mul(2).equal()}},"&-empty":Object.assign(Object.assign({},Np(e)),{color:e.colorTextDisabled})}),"&-rtl":{direction:"rtl"}})},xp(e,"slide-up"),xp(e,"slide-down"),Vp(e,"move-up"),Vp(e,"move-down")]},Mp=e=>{const{componentCls:t,iconCls:n,borderRadiusSM:a,motionDurationSlow:o,paddingXS:i,multipleItemColorDisabled:r,multipleItemBorderColorDisabled:s,colorIcon:l,colorIconHover:c,INTERNAL_FIXED_ITEM_MARGIN:g}=e,u="".concat(t,"-selection-overflow");return{[u]:{position:"relative",display:"flex",flex:"auto",flexWrap:"wrap",maxWidth:"100%","&-item":{flex:"none",alignSelf:"center",maxWidth:"100%",display:"inline-flex"},["".concat(t,"-selection-item")]:{display:"flex",alignSelf:"center",flex:"none",boxSizing:"border-box",maxWidth:"100%",marginBlock:g,borderRadius:a,cursor:"default",transition:"font-size ".concat(o,", line-height ").concat(o,", height ").concat(o),marginInlineEnd:e.calc(g).mul(2).equal(),paddingInlineStart:i,paddingInlineEnd:e.calc(i).div(2).equal(),["".concat(t,"-disabled&")]:{color:r,borderColor:s,cursor:"not-allowed"},"&-content":{display:"inline-block",marginInlineEnd:e.calc(i).div(2).equal(),overflow:"hidden",whiteSpace:"pre",textOverflow:"ellipsis"},"&-remove":Object.assign(Object.assign({},{display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),{display:"inline-flex",alignItems:"center",color:l,fontWeight:"bold",fontSize:10,lineHeight:"inherit",cursor:"pointer",["> ".concat(n)]:{verticalAlign:"-0.2em"},"&:hover":{color:c}})}}}},Tp=(e,t)=>{const{componentCls:n,INTERNAL_FIXED_ITEM_MARGIN:a}=e,o="".concat(n,"-selection-overflow"),i=e.multipleSelectItemHeight,r=(e=>{const{multipleSelectItemHeight:t,selectHeight:n,lineWidth:a}=e;return e.calc(n).sub(t).div(2).sub(a).equal()})(e),s=t?"".concat(n,"-").concat(t):"",l=(e=>{const{multipleSelectItemHeight:t,paddingXXS:n,lineWidth:a,INTERNAL_FIXED_ITEM_MARGIN:o}=e,i=e.max(e.calc(n).sub(a).equal(),0);return{basePadding:i,containerPadding:e.max(e.calc(i).sub(o).equal(),0),itemHeight:Qt(t),itemLineHeight:Qt(e.calc(t).sub(e.calc(e.lineWidth).mul(2)).equal())}})(e);return{["".concat(n,"-multiple").concat(s)]:Object.assign(Object.assign({},Mp(e)),{["".concat(n,"-selector")]:{display:"flex",flexWrap:"wrap",alignItems:"center",height:"100%",paddingInline:l.basePadding,paddingBlock:l.containerPadding,borderRadius:e.borderRadius,["".concat(n,"-disabled&")]:{background:e.multipleSelectorBgDisabled,cursor:"not-allowed"},"&:after":{display:"inline-block",width:0,margin:"".concat(Qt(a)," 0"),lineHeight:Qt(i),visibility:"hidden",content:'"\\a0"'}},["".concat(n,"-selection-item")]:{height:l.itemHeight,lineHeight:Qt(l.itemLineHeight)},["".concat(o,"-item + ").concat(o,"-item")]:{["".concat(n,"-selection-search")]:{marginInlineStart:0}},["".concat(o,"-item-suffix")]:{height:"100%"},["".concat(n,"-selection-search")]:{display:"inline-flex",position:"relative",maxWidth:"100%",marginInlineStart:e.calc(e.inputPaddingHorizontalBase).sub(r).equal(),"\n          &-input,\n          &-mirror\n        ":{height:i,fontFamily:e.fontFamily,lineHeight:Qt(i),transition:"all ".concat(e.motionDurationSlow)},"&-input":{width:"100%",minWidth:4.1},"&-mirror":{position:"absolute",top:0,insetInlineStart:0,insetInlineEnd:"auto",zIndex:999,whiteSpace:"pre",visibility:"hidden"}},["".concat(n,"-selection-placeholder")]:{position:"absolute",top:"50%",insetInlineStart:e.inputPaddingHorizontalBase,insetInlineEnd:e.inputPaddingHorizontalBase,transform:"translateY(-50%)",transition:"all ".concat(e.motionDurationSlow)}})}};function Ep(e,t){const{componentCls:n}=e,a=t?"".concat(n,"-").concat(t):"",o={["".concat(n,"-multiple").concat(a)]:{fontSize:e.fontSize,["".concat(n,"-selector")]:{["".concat(n,"-show-search&")]:{cursor:"text"}},["\n        &".concat(n,"-show-arrow ").concat(n,"-selector,\n        &").concat(n,"-allow-clear ").concat(n,"-selector\n      ")]:{paddingInlineEnd:e.calc(e.fontSizeIcon).add(e.controlPaddingHorizontal).equal()}}};return[Tp(e,t),o]}const Fp=e=>{const{componentCls:t}=e,n=ri(e,{selectHeight:e.controlHeightSM,multipleSelectItemHeight:e.multipleItemHeightSM,borderRadius:e.borderRadiusSM,borderRadiusSM:e.borderRadiusXS}),a=ri(e,{fontSize:e.fontSizeLG,selectHeight:e.controlHeightLG,multipleSelectItemHeight:e.multipleItemHeightLG,borderRadius:e.borderRadiusLG,borderRadiusSM:e.borderRadius});return[Ep(e),Ep(n,"sm"),{["".concat(t,"-multiple").concat(t,"-sm")]:{["".concat(t,"-selection-placeholder")]:{insetInline:e.calc(e.controlPaddingHorizontalSM).sub(e.lineWidth).equal()},["".concat(t,"-selection-search")]:{marginInlineStart:2}}},Ep(a,"lg")]};function Hp(e,t){const{componentCls:n,inputPaddingHorizontalBase:a,borderRadius:o}=e,i=e.calc(e.controlHeight).sub(e.calc(e.lineWidth).mul(2)).equal(),r=t?"".concat(n,"-").concat(t):"";return{["".concat(n,"-single").concat(r)]:{fontSize:e.fontSize,height:e.controlHeight,["".concat(n,"-selector")]:Object.assign(Object.assign({},za(e,!0)),{display:"flex",borderRadius:o,["".concat(n,"-selection-search")]:{position:"absolute",top:0,insetInlineStart:a,insetInlineEnd:a,bottom:0,"&-input":{width:"100%",WebkitAppearance:"textfield"}},["\n          ".concat(n,"-selection-item,\n          ").concat(n,"-selection-placeholder\n        ")]:{padding:0,lineHeight:Qt(i),transition:"all ".concat(e.motionDurationSlow,", visibility 0s"),alignSelf:"center"},["".concat(n,"-selection-placeholder")]:{transition:"none",pointerEvents:"none"},[["&:after","".concat(n,"-selection-item:empty:after"),"".concat(n,"-selection-placeholder:empty:after")].join(",")]:{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'}}),["\n        &".concat(n,"-show-arrow ").concat(n,"-selection-item,\n        &").concat(n,"-show-arrow ").concat(n,"-selection-placeholder\n      ")]:{paddingInlineEnd:e.showArrowPaddingInlineEnd},["&".concat(n,"-open ").concat(n,"-selection-item")]:{color:e.colorTextPlaceholder},["&:not(".concat(n,"-customize-input)")]:{["".concat(n,"-selector")]:{width:"100%",height:"100%",padding:"0 ".concat(Qt(a)),["".concat(n,"-selection-search-input")]:{height:i},"&:after":{lineHeight:Qt(i)}}},["&".concat(n,"-customize-input")]:{["".concat(n,"-selector")]:{"&:after":{display:"none"},["".concat(n,"-selection-search")]:{position:"static",width:"100%"},["".concat(n,"-selection-placeholder")]:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,padding:"0 ".concat(Qt(a)),"&:after":{display:"none"}}}}}}}function Jp(e){const{componentCls:t}=e,n=e.calc(e.controlPaddingHorizontalSM).sub(e.lineWidth).equal();return[Hp(e),Hp(ri(e,{controlHeight:e.controlHeightSM,borderRadius:e.borderRadiusSM}),"sm"),{["".concat(t,"-single").concat(t,"-sm")]:{["&:not(".concat(t,"-customize-input)")]:{["".concat(t,"-selection-search")]:{insetInlineStart:n,insetInlineEnd:n},["".concat(t,"-selector")]:{padding:"0 ".concat(Qt(n))},["&".concat(t,"-show-arrow ").concat(t,"-selection-search")]:{insetInlineEnd:e.calc(n).add(e.calc(e.fontSize).mul(1.5)).equal()},["\n            &".concat(t,"-show-arrow ").concat(t,"-selection-item,\n            &").concat(t,"-show-arrow ").concat(t,"-selection-placeholder\n          ")]:{paddingInlineEnd:e.calc(e.fontSize).mul(1.5).equal()}}}},Hp(ri(e,{controlHeight:e.singleItemHeightLG,fontSize:e.fontSizeLG,borderRadius:e.borderRadiusLG}),"lg")]}const Yp=(e,t)=>{const{componentCls:n,antCls:a,controlOutlineWidth:o}=e;return{["&:not(".concat(n,"-customize-input) ").concat(n,"-selector")]:{border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(t.borderColor),background:e.selectorBg},["&:not(".concat(n,"-disabled):not(").concat(n,"-customize-input):not(").concat(a,"-pagination-size-changer)")]:{["&:hover ".concat(n,"-selector")]:{borderColor:t.hoverBorderHover},["".concat(n,"-focused& ").concat(n,"-selector")]:{borderColor:t.activeBorderColor,boxShadow:"0 0 0 ".concat(Qt(o)," ").concat(t.activeShadowColor),outline:0}}}},Lp=(e,t)=>({["&".concat(e.componentCls,"-status-").concat(t.status)]:Object.assign({},Yp(e,t))}),zp=e=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign({},Yp(e,{borderColor:e.colorBorder,hoverBorderHover:e.colorPrimaryHover,activeBorderColor:e.colorPrimary,activeShadowColor:e.controlOutline})),Lp(e,{status:"error",borderColor:e.colorError,hoverBorderHover:e.colorErrorHover,activeBorderColor:e.colorError,activeShadowColor:e.colorErrorOutline})),Lp(e,{status:"warning",borderColor:e.colorWarning,hoverBorderHover:e.colorWarningHover,activeBorderColor:e.colorWarning,activeShadowColor:e.colorWarningOutline})),{["&".concat(e.componentCls,"-disabled")]:{["&:not(".concat(e.componentCls,"-customize-input) ").concat(e.componentCls,"-selector")]:{background:e.colorBgContainerDisabled,color:e.colorTextDisabled}},["&".concat(e.componentCls,"-multiple ").concat(e.componentCls,"-selection-item")]:{background:e.multipleItemBg,border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.multipleItemBorderColor)}})}),Kp=(e,t)=>{const{componentCls:n,antCls:a}=e;return{["&:not(".concat(n,"-customize-input) ").concat(n,"-selector")]:{background:t.bg,border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," transparent"),color:t.color},["&:not(".concat(n,"-disabled):not(").concat(n,"-customize-input):not(").concat(a,"-pagination-size-changer)")]:{["&:hover ".concat(n,"-selector")]:{background:t.hoverBg},["".concat(n,"-focused& ").concat(n,"-selector")]:{background:e.selectorBg,borderColor:t.activeBorderColor,outline:0}}}},Dp=(e,t)=>({["&".concat(e.componentCls,"-status-").concat(t.status)]:Object.assign({},Kp(e,t))}),Up=e=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign({},Kp(e,{bg:e.colorFillTertiary,hoverBg:e.colorFillSecondary,activeBorderColor:e.colorPrimary,color:e.colorText})),Dp(e,{status:"error",bg:e.colorErrorBg,hoverBg:e.colorErrorBgHover,activeBorderColor:e.colorError,color:e.colorError})),Dp(e,{status:"warning",bg:e.colorWarningBg,hoverBg:e.colorWarningBgHover,activeBorderColor:e.colorWarning,color:e.colorWarning})),{["&".concat(e.componentCls,"-disabled")]:{["&:not(".concat(e.componentCls,"-customize-input) ").concat(e.componentCls,"-selector")]:{borderColor:e.colorBorder,background:e.colorBgContainerDisabled,color:e.colorTextDisabled}},["&".concat(e.componentCls,"-multiple ").concat(e.componentCls,"-selection-item")]:{background:e.colorBgContainer,border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorSplit)}})}),Pp=e=>({"&-borderless":{["".concat(e.componentCls,"-selector")]:{background:"transparent",borderColor:"transparent"},["&".concat(e.componentCls,"-disabled")]:{["&:not(".concat(e.componentCls,"-customize-input) ").concat(e.componentCls,"-selector")]:{color:e.colorTextDisabled}},["&".concat(e.componentCls,"-multiple ").concat(e.componentCls,"-selection-item")]:{background:e.multipleItemBg,border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.multipleItemBorderColor)},["&".concat(e.componentCls,"-status-error")]:{["".concat(e.componentCls,"-selection-item")]:{color:e.colorError}},["&".concat(e.componentCls,"-status-warning")]:{["".concat(e.componentCls,"-selection-item")]:{color:e.colorWarning}}}}),Op=e=>({[e.componentCls]:Object.assign(Object.assign(Object.assign({},zp(e)),Up(e)),Pp(e))}),_p=e=>{const{componentCls:t}=e;return{position:"relative",transition:"all ".concat(e.motionDurationMid," ").concat(e.motionEaseInOut),input:{cursor:"pointer"},["".concat(t,"-show-search&")]:{cursor:"text",input:{cursor:"auto",color:"inherit",height:"100%"}},["".concat(t,"-disabled&")]:{cursor:"not-allowed",input:{cursor:"not-allowed"}}}},Qp=e=>{const{componentCls:t}=e;return{["".concat(t,"-selection-search-input")]:{margin:0,padding:0,background:"transparent",border:"none",outline:"none",appearance:"none",fontFamily:"inherit","&::-webkit-search-cancel-button":{display:"none","-webkit-appearance":"none"}}}},jp=e=>{const{antCls:t,componentCls:n,inputPaddingHorizontalBase:a,iconCls:o}=e;return{[n]:Object.assign(Object.assign({},za(e)),{position:"relative",display:"inline-block",cursor:"pointer",["&:not(".concat(n,"-customize-input) ").concat(n,"-selector")]:Object.assign(Object.assign({},_p(e)),Qp(e)),["".concat(n,"-selection-item")]:Object.assign(Object.assign({flex:1,fontWeight:"normal",position:"relative",userSelect:"none"},La),{["> ".concat(t,"-typography")]:{display:"inline"}}),["".concat(n,"-selection-placeholder")]:Object.assign(Object.assign({},La),{flex:1,color:e.colorTextPlaceholder,pointerEvents:"none"}),["".concat(n,"-arrow")]:Object.assign(Object.assign({},{display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),{position:"absolute",top:"50%",insetInlineStart:"auto",insetInlineEnd:a,height:e.fontSizeIcon,marginTop:e.calc(e.fontSizeIcon).mul(-1).div(2).equal(),color:e.colorTextQuaternary,fontSize:e.fontSizeIcon,lineHeight:1,textAlign:"center",pointerEvents:"none",display:"flex",alignItems:"center",transition:"opacity ".concat(e.motionDurationSlow," ease"),[o]:{verticalAlign:"top",transition:"transform ".concat(e.motionDurationSlow),"> svg":{verticalAlign:"top"},["&:not(".concat(n,"-suffix)")]:{pointerEvents:"auto"}},["".concat(n,"-disabled &")]:{cursor:"not-allowed"},"> *:not(:last-child)":{marginInlineEnd:8}}),["".concat(n,"-clear")]:{position:"absolute",top:"50%",insetInlineStart:"auto",insetInlineEnd:a,zIndex:1,display:"inline-block",width:e.fontSizeIcon,height:e.fontSizeIcon,marginTop:e.calc(e.fontSizeIcon).mul(-1).div(2).equal(),color:e.colorTextQuaternary,fontSize:e.fontSizeIcon,fontStyle:"normal",lineHeight:1,textAlign:"center",textTransform:"none",cursor:"pointer",opacity:0,transition:"color ".concat(e.motionDurationMid," ease, opacity ").concat(e.motionDurationSlow," ease"),textRendering:"auto","&:before":{display:"block"},"&:hover":{color:e.colorTextTertiary}},"&:hover":{["".concat(n,"-clear")]:{opacity:1},["".concat(n,"-arrow:not(:last-child)")]:{opacity:0}}}),["".concat(n,"-has-feedback")]:{["".concat(n,"-clear")]:{insetInlineEnd:e.calc(a).add(e.fontSize).add(e.paddingXS).equal()}}}},qp=e=>{const{componentCls:t}=e;return[{[t]:{["&".concat(t,"-in-form-item")]:{width:"100%"}}},jp(e),Jp(e),Fp(e),Xp(e),{["".concat(t,"-rtl")]:{direction:"rtl"}},Pl(e,{borderElCls:"".concat(t,"-selector"),focusElCls:"".concat(t,"-focused")})]},$p=Ii("Select",((e,t)=>{let{rootPrefixCls:n}=t;const a=ri(e,{rootPrefixCls:n,inputPaddingHorizontalBase:e.calc(e.paddingSM).sub(1).equal(),multipleSelectItemHeight:e.multipleItemHeight,selectHeight:e.controlHeight});return[qp(a),Op(a)]}),(e=>{const{fontSize:t,lineHeight:n,lineWidth:a,controlHeight:o,controlHeightSM:i,controlHeightLG:r,paddingXXS:s,controlPaddingHorizontal:l,zIndexPopupBase:c,colorText:g,fontWeightStrong:u,controlItemBgActive:d,controlItemBgHover:h,colorBgContainer:p,colorFillSecondary:m,colorBgContainerDisabled:I,colorTextDisabled:C}=e,f=2*s,b=2*a,y=Math.min(o-f,o-b),A=Math.min(i-f,i-b),v=Math.min(r-f,r-b);return{INTERNAL_FIXED_ITEM_MARGIN:Math.floor(s/2),zIndexPopup:c+50,optionSelectedColor:g,optionSelectedFontWeight:u,optionSelectedBg:d,optionActiveBg:h,optionPadding:"".concat((o-t*n)/2,"px ").concat(l,"px"),optionFontSize:t,optionLineHeight:n,optionHeight:o,selectorBg:p,clearBg:p,singleItemHeightLG:r,multipleItemBg:m,multipleItemBorderColor:"transparent",multipleItemHeight:y,multipleItemHeightSM:A,multipleItemHeightLG:v,multipleSelectorBgDisabled:I,multipleItemColorDisabled:C,multipleItemBorderColorDisabled:"transparent",showArrowPaddingInlineEnd:Math.ceil(1.25*e.fontSize)}}),{unitless:{optionLineHeight:!0,optionSelectedFontWeight:!0}});const em={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};var tm=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:em}))};const nm=a.forwardRef(tm);const am={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"}}]},name:"close-circle",theme:"filled"};var om=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:am}))};const im=a.forwardRef(om);const rm={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"}}]},name:"close",theme:"outlined"};var sm=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:rm}))};const lm=a.forwardRef(sm);const cm={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"}}]},name:"down",theme:"outlined"};var gm=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:cm}))};const um=a.forwardRef(gm);const dm={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"};var hm=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:dm}))};const pm=a.forwardRef(hm);var mm=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Im="SECRET_COMBOBOX_MODE_DO_NOT_USE",Cm=(e,t)=>{var n;const{prefixCls:o,bordered:i,className:r,rootClassName:s,getPopupContainer:l,popupClassName:c,dropdownClassName:g,listHeight:u=256,placement:d,listItemHeight:h,size:p,disabled:m,notFoundContent:I,status:C,builtinPlacements:f,dropdownMatchSelectWidth:b,popupMatchSelectWidth:y,direction:A,style:v,allowClear:S,variant:x,dropdownStyle:G,transitionName:Z,tagRender:w,maxCount:k}=e,B=mm(e,["prefixCls","bordered","className","rootClassName","getPopupContainer","popupClassName","dropdownClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","direction","style","allowClear","variant","dropdownStyle","transitionName","tagRender","maxCount"]),{getPopupContainer:R,getPrefixCls:W,renderEmpty:V,direction:N,virtual:X,popupMatchSelectWidth:M,popupOverflow:T,select:E}=a.useContext(Be),[,F]=ai(),H=null!==h&&void 0!==h?h:null===F||void 0===F?void 0:F.controlHeight,J=W("select",o),Y=W(),L=null!==A&&void 0!==A?A:N,{compactSize:z,compactItemClassnames:K}=Hs(J,L),[D,U]=gp("select",x,i),P=Od(J),[O,_,Q]=$p(J,P),j=a.useMemo((()=>{const{mode:t}=e;if("combobox"!==t)return t===Im?"combobox":t}),[e.mode]),q="multiple"===j||"tags"===j,$=function(e,t){return void 0!==t?t:null!==e}(e.suffixIcon,e.showArrow),ee=null!==(n=null!==y&&void 0!==y?y:b)&&void 0!==n?n:M,{status:te,hasFeedback:ne,isFormItemInput:ae,feedbackIcon:oe}=a.useContext(sp),ie=Td(te,C);let re;re=void 0!==I?I:"combobox"===j?null:(null===V||void 0===V?void 0:V("Select"))||a.createElement(Pd,{componentName:"Select"});const{suffixIcon:se,itemIcon:le,removeIcon:ce,clearIcon:ge}=function(e){let{suffixIcon:t,clearIcon:n,menuItemSelectedIcon:o,removeIcon:i,loading:r,multiple:s,hasFeedback:l,prefixCls:c,showSuffixIcon:g,feedbackIcon:u,showArrow:d,componentName:h}=e;const p=null!==n&&void 0!==n?n:a.createElement(im,null),m=e=>null!==t||l||d?a.createElement(a.Fragment,null,!1!==g&&e,l&&u):null;let I=null;if(void 0!==t)I=m(t);else if(r)I=m(a.createElement(ml,{spin:!0}));else{const e="".concat(c,"-suffix");I=t=>{let{open:n,showSearch:o}=t;return m(n&&o?a.createElement(pm,{className:e}):a.createElement(um,{className:e}))}}let C=null;C=void 0!==o?o:s?a.createElement(nm,null):null;let f=null;return f=void 0!==i?i:a.createElement(lm,null),{clearIcon:p,suffixIcon:I,itemIcon:C,removeIcon:f}}(Object.assign(Object.assign({},B),{multiple:q,hasFeedback:ne,feedbackIcon:oe,showSuffixIcon:$,prefixCls:J,componentName:"Select"})),ue=!0===S?{clearIcon:ge}:S,de=Ce(B,["suffixIcon","itemIcon"]),he=Ie()(c||g,{["".concat(J,"-dropdown-").concat(L)]:"rtl"===L},s,Q,P,_),pe=Ts((e=>{var t;return null!==(t=null!==p&&void 0!==p?p:z)&&void 0!==t?t:e})),me=a.useContext(Pi),fe=null!==m&&void 0!==m?m:me,be=Ie()({["".concat(J,"-lg")]:"large"===pe,["".concat(J,"-sm")]:"small"===pe,["".concat(J,"-rtl")]:"rtl"===L,["".concat(J,"-").concat(D)]:U,["".concat(J,"-in-form-item")]:ae},Md(J,ie,ne),K,null===E||void 0===E?void 0:E.className,r,s,Q,P,_),ye=a.useMemo((()=>void 0!==d?d:"rtl"===L?"bottomRight":"bottomLeft"),[d,L]);const[Ae]=Wd("SelectLike",null===G||void 0===G?void 0:G.zIndex);return O(a.createElement(Gd,Object.assign({ref:t,virtual:X,showSearch:null===E||void 0===E?void 0:E.showSearch},de,{style:Object.assign(Object.assign({},null===E||void 0===E?void 0:E.style),v),dropdownMatchSelectWidth:ee,transitionName:Vd(Y,"slide-up",Z),builtinPlacements:up(f,T),listHeight:u,listItemHeight:H,mode:j,prefixCls:J,placement:ye,direction:L,suffixIcon:se,menuItemSelectedIcon:le,removeIcon:ce,allowClear:ue,notFoundContent:re,className:be,getPopupContainer:l||R,dropdownClassName:he,disabled:fe,dropdownStyle:Object.assign(Object.assign({},G),{zIndex:Ae}),maxCount:q?k:void 0,tagRender:q?w:void 0})))};const fm=a.forwardRef(Cm),bm=Xd(fm);fm.SECRET_COMBOBOX_MODE_DO_NOT_USE=Im,fm.Option=Ju,fm.OptGroup=Fu,fm._InternalPanelDoNotUseOrYouWillBeFired=bm;const ym=fm,Am=a.createContext({});const vm={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var Sm=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:vm}))};const xm=a.forwardRef(Sm);const Gm={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var Zm=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:Gm}))};const wm=a.forwardRef(Zm);const km={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"};var Bm=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:km}))};const Rm=a.forwardRef(Bm);var Wm=a.forwardRef((function(e,t){var n=e.prefixCls,o=e.style,i=e.className,r=e.duration,s=void 0===r?4.5:r,l=e.showProgress,c=e.pauseOnHover,g=void 0===c||c,u=e.eventKey,d=e.content,h=e.closable,p=e.closeIcon,m=void 0===p?"x":p,I=e.props,C=e.onClick,f=e.onNoticeClose,b=e.times,y=e.hovering,A=Je(a.useState(!1),2),v=A[0],S=A[1],x=Je(a.useState(0),2),G=x[0],Z=x[1],w=Je(a.useState(0),2),k=w[0],B=w[1],R=y||v,W=s>0&&l,V=function(){f(u)};a.useEffect((function(){if(!R&&s>0){var e=Date.now()-k,t=setTimeout((function(){V()}),1e3*s-k);return function(){g&&clearTimeout(t),B(Date.now()-e)}}}),[s,R,b]),a.useEffect((function(){if(!R&&W&&(g||0===k)){var e,t=performance.now();return function n(){cancelAnimationFrame(e),e=requestAnimationFrame((function(e){var a=e+k-t,o=Math.min(a/(1e3*s),1);Z(100*o),o<1&&n()}))}(),function(){g&&cancelAnimationFrame(e)}}}),[s,k,R,W,b]);var N=a.useMemo((function(){return"object"===fe(h)&&null!==h?h:h?{closeIcon:m}:{}}),[h,m]),X=Bc(N,!0),M=100-(!G||G<0?0:G>100?100:G),T="".concat(n,"-notice");return a.createElement("div",yn({},I,{ref:t,className:Ie()(T,i,Me({},"".concat(T,"-closable"),h)),style:o,onMouseEnter:function(e){var t;S(!0),null===I||void 0===I||null===(t=I.onMouseEnter)||void 0===t||t.call(I,e)},onMouseLeave:function(e){var t;S(!1),null===I||void 0===I||null===(t=I.onMouseLeave)||void 0===t||t.call(I,e)},onClick:C}),a.createElement("div",{className:"".concat(T,"-content")},d),h&&a.createElement("a",yn({tabIndex:0,className:"".concat(T,"-close"),onKeyDown:function(e){"Enter"!==e.key&&"Enter"!==e.code&&e.keyCode!==Ac.ENTER||V()},"aria-label":"Close"},X,{onClick:function(e){e.preventDefault(),e.stopPropagation(),V()}}),N.closeIcon),W&&a.createElement("progress",{className:"".concat(T,"-progress"),max:"100",value:M},M+"%"))}));const Vm=Wm;var Nm=a.createContext({});const Xm=function(e){var t=e.children,n=e.classNames;return a.createElement(Nm.Provider,{value:{classNames:n}},t)};const Mm=function(e){var t,n,a,o={offset:8,threshold:3,gap:16};e&&"object"===fe(e)&&(o.offset=null!==(t=e.offset)&&void 0!==t?t:8,o.threshold=null!==(n=e.threshold)&&void 0!==n?n:3,o.gap=null!==(a=e.gap)&&void 0!==a?a:16);return[!!e,o]};var Tm=["className","style","classNames","styles"];const Em=function(e){var t=e.configList,n=e.placement,o=e.prefixCls,i=e.className,r=e.style,s=e.motion,l=e.onAllNoticeRemoved,c=e.onNoticeClose,g=e.stack,u=(0,a.useContext)(Nm).classNames,d=(0,a.useRef)({}),h=Je((0,a.useState)(null),2),p=h[0],m=h[1],I=Je((0,a.useState)([]),2),C=I[0],f=I[1],b=t.map((function(e){return{config:e,key:String(e.key)}})),y=Je(Mm(g),2),A=y[0],v=y[1],S=v.offset,x=v.threshold,G=v.gap,Z=A&&(C.length>0||b.length<=x),w="function"===typeof s?s(n):s;return(0,a.useEffect)((function(){A&&C.length>1&&f((function(e){return e.filter((function(e){return b.some((function(t){var n=t.key;return e===n}))}))}))}),[C,b,A]),(0,a.useEffect)((function(){var e,t;A&&d.current[null===(e=b[b.length-1])||void 0===e?void 0:e.key]&&m(d.current[null===(t=b[b.length-1])||void 0===t?void 0:t.key])}),[b,A]),a.createElement(jr,yn({key:n,className:Ie()(o,"".concat(o,"-").concat(n),null===u||void 0===u?void 0:u.list,i,Me(Me({},"".concat(o,"-stack"),!!A),"".concat(o,"-stack-expanded"),Z)),style:r,keys:b,motionAppear:!0},w,{onAllRemoved:function(){l(n)}}),(function(e,t){var i=e.config,r=e.className,s=e.style,l=e.index,g=i,h=g.key,m=g.times,I=String(h),y=i,v=y.className,x=y.style,w=y.classNames,k=y.styles,B=ir(y,Tm),R=b.findIndex((function(e){return e.key===I})),W={};if(A){var V=b.length-1-(R>-1?R:l-1),N="top"===n||"bottom"===n?"-50%":"0";if(V>0){var X,M,T;W.height=Z?null===(X=d.current[I])||void 0===X?void 0:X.offsetHeight:null===p||void 0===p?void 0:p.offsetHeight;for(var E=0,F=0;F<V;F++){var H;E+=(null===(H=d.current[b[b.length-1-F].key])||void 0===H?void 0:H.offsetHeight)+G}var J=(Z?E:V*S)*(n.startsWith("top")?1:-1),Y=!Z&&null!==p&&void 0!==p&&p.offsetWidth&&null!==(M=d.current[I])&&void 0!==M&&M.offsetWidth?((null===p||void 0===p?void 0:p.offsetWidth)-2*S*(V<3?V:3))/(null===(T=d.current[I])||void 0===T?void 0:T.offsetWidth):1;W.transform="translate3d(".concat(N,", ").concat(J,"px, 0) scaleX(").concat(Y,")")}else W.transform="translate3d(".concat(N,", 0, 0)")}return a.createElement("div",{ref:t,className:Ie()("".concat(o,"-notice-wrapper"),r,null===w||void 0===w?void 0:w.wrapper),style:Ke(Ke(Ke({},s),W),null===k||void 0===k?void 0:k.wrapper),onMouseEnter:function(){return f((function(e){return e.includes(I)?e:[].concat(Le(e),[I])}))},onMouseLeave:function(){return f((function(e){return e.filter((function(e){return e!==I}))}))}},a.createElement(Vm,yn({},B,{ref:function(e){R>-1?d.current[I]=e:delete d.current[I]},prefixCls:o,classNames:w,styles:k,className:Ie()(v,null===u||void 0===u?void 0:u.notice),style:x,times:m,key:h,eventKey:h,onNoticeClose:c,hovering:A&&C.length>0})))}))};var Fm=a.forwardRef((function(e,t){var n=e.prefixCls,o=void 0===n?"rc-notification":n,i=e.container,r=e.motion,s=e.maxCount,l=e.className,c=e.style,g=e.onAllRemoved,u=e.stack,d=e.renderNotifications,h=Je(a.useState([]),2),p=h[0],m=h[1],I=function(e){var t,n=p.find((function(t){return t.key===e}));null===n||void 0===n||null===(t=n.onClose)||void 0===t||t.call(n),m((function(t){return t.filter((function(t){return t.key!==e}))}))};a.useImperativeHandle(t,(function(){return{open:function(e){m((function(t){var n,a=Le(t),o=a.findIndex((function(t){return t.key===e.key})),i=Ke({},e);o>=0?(i.times=((null===(n=t[o])||void 0===n?void 0:n.times)||0)+1,a[o]=i):(i.times=0,a.push(i));return s>0&&a.length>s&&(a=a.slice(-s)),a}))},close:function(e){I(e)},destroy:function(){m([])}}}));var C=Je(a.useState({}),2),f=C[0],b=C[1];a.useEffect((function(){var e={};p.forEach((function(t){var n=t.placement,a=void 0===n?"topRight":n;a&&(e[a]=e[a]||[],e[a].push(t))})),Object.keys(f).forEach((function(t){e[t]=e[t]||[]})),b(e)}),[p]);var y=function(e){b((function(t){var n=Ke({},t);return(n[e]||[]).length||delete n[e],n}))},A=a.useRef(!1);if(a.useEffect((function(){Object.keys(f).length>0?A.current=!0:A.current&&(null===g||void 0===g||g(),A.current=!1)}),[f]),!i)return null;var v=Object.keys(f);return(0,tr.createPortal)(a.createElement(a.Fragment,null,v.map((function(e){var t=f[e],n=a.createElement(Em,{key:e,configList:t,placement:e,prefixCls:o,className:null===l||void 0===l?void 0:l(e),style:null===c||void 0===c?void 0:c(e),motion:r,onNoticeClose:I,onAllNoticeRemoved:y,stack:u});return d?d(n,{prefixCls:o,key:e}):n}))),i)}));const Hm=Fm;var Jm=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","stack","renderNotifications"],Ym=function(){return document.body},Lm=0;function zm(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.getContainer,n=void 0===t?Ym:t,o=e.motion,i=e.prefixCls,r=e.maxCount,s=e.className,l=e.style,c=e.onAllRemoved,g=e.stack,u=e.renderNotifications,d=ir(e,Jm),h=Je(a.useState(),2),p=h[0],m=h[1],I=a.useRef(),C=a.createElement(Hm,{container:p,ref:I,prefixCls:i,motion:o,maxCount:r,className:s,style:l,onAllRemoved:c,stack:g,renderNotifications:u}),f=Je(a.useState([]),2),b=f[0],y=f[1],A=a.useMemo((function(){return{open:function(e){var t=function(){for(var e={},t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach((function(t){t&&Object.keys(t).forEach((function(n){var a=t[n];void 0!==a&&(e[n]=a)}))})),e}(d,e);null!==t.key&&void 0!==t.key||(t.key="rc-notification-".concat(Lm),Lm+=1),y((function(e){return[].concat(Le(e),[{type:"open",config:t}])}))},close:function(e){y((function(t){return[].concat(Le(t),[{type:"close",key:e}])}))},destroy:function(){y((function(e){return[].concat(Le(e),[{type:"destroy"}])}))}}}),[]);return a.useEffect((function(){m(n())})),a.useEffect((function(){I.current&&b.length&&(b.forEach((function(e){switch(e.type){case"open":I.current.open(e.config);break;case"close":I.current.close(e.key);break;case"destroy":I.current.destroy()}})),y((function(e){return e.filter((function(e){return!b.includes(e)}))})))}),[b]),[A,C]}const Km=e=>{const{componentCls:t,iconCls:n,boxShadow:a,colorText:o,colorSuccess:i,colorError:r,colorWarning:s,colorInfo:l,fontSizeLG:c,motionEaseInOutCirc:g,motionDurationSlow:u,marginXS:d,paddingXS:h,borderRadiusLG:p,zIndexPopup:m,contentPadding:I,contentBg:C}=e,f="".concat(t,"-notice"),b=new Za("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:h,transform:"translateY(0)",opacity:1}}),y=new Za("MessageMoveOut",{"0%":{maxHeight:e.height,padding:h,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),A={padding:h,textAlign:"center",["".concat(t,"-custom-content")]:{display:"flex",alignItems:"center"},["".concat(t,"-custom-content > ").concat(n)]:{marginInlineEnd:d,fontSize:c},["".concat(f,"-content")]:{display:"inline-block",padding:I,background:C,borderRadius:p,boxShadow:a,pointerEvents:"all"},["".concat(t,"-success > ").concat(n)]:{color:i},["".concat(t,"-error > ").concat(n)]:{color:r},["".concat(t,"-warning > ").concat(n)]:{color:s},["".concat(t,"-info > ").concat(n,",\n      ").concat(t,"-loading > ").concat(n)]:{color:l}};return[{[t]:Object.assign(Object.assign({},za(e)),{color:o,position:"fixed",top:d,width:"100%",pointerEvents:"none",zIndex:m,["".concat(t,"-move-up")]:{animationFillMode:"forwards"},["\n        ".concat(t,"-move-up-appear,\n        ").concat(t,"-move-up-enter\n      ")]:{animationName:b,animationDuration:u,animationPlayState:"paused",animationTimingFunction:g},["\n        ".concat(t,"-move-up-appear").concat(t,"-move-up-appear-active,\n        ").concat(t,"-move-up-enter").concat(t,"-move-up-enter-active\n      ")]:{animationPlayState:"running"},["".concat(t,"-move-up-leave")]:{animationName:y,animationDuration:u,animationPlayState:"paused",animationTimingFunction:g},["".concat(t,"-move-up-leave").concat(t,"-move-up-leave-active")]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[t]:{["".concat(f,"-wrapper")]:Object.assign({},A)}},{["".concat(t,"-notice-pure-panel")]:Object.assign(Object.assign({},A),{padding:0,textAlign:"start"})}]},Dm=Ii("Message",(e=>{const t=ri(e,{height:150});return[Km(t)]}),(e=>({zIndexPopup:e.zIndexPopupBase+kd+10,contentBg:e.colorBgElevated,contentPadding:"".concat((e.controlHeightLG-e.fontSize*e.lineHeight)/2,"px ").concat(e.paddingSM,"px")})));var Um=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Pm={info:a.createElement(Rm,null),success:a.createElement(xm,null),error:a.createElement(im,null),warning:a.createElement(wm,null),loading:a.createElement(ml,null)},Om=e=>{let{prefixCls:t,type:n,icon:o,children:i}=e;return a.createElement("div",{className:Ie()("".concat(t,"-custom-content"),"".concat(t,"-").concat(n))},o||Pm[n],a.createElement("span",null,i))},_m=e=>{const{prefixCls:t,className:n,type:o,icon:i,content:r}=e,s=Um(e,["prefixCls","className","type","icon","content"]),{getPrefixCls:l}=a.useContext(Be),c=t||l("message"),g=Od(c),[u,d,h]=Dm(c,g);return u(a.createElement(Vm,Object.assign({},s,{prefixCls:c,className:Ie()(n,d,"".concat(c,"-notice-pure-panel"),h,g),eventKey:"pure",duration:null,content:a.createElement(Om,{prefixCls:c,type:o,icon:i},r)})))};function Qm(e){let t;const n=new Promise((n=>{t=e((()=>{n(!0)}))})),a=()=>{null===t||void 0===t||t()};return a.then=(e,t)=>n.then(e,t),a.promise=n,a}var jm=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const qm=3,$m=e=>{let{children:t,prefixCls:n}=e;const o=Od(n),[i,r,s]=Dm(n,o);return i(a.createElement(Xm,{classNames:{list:Ie()(r,s,o)}},t))},eI=(e,t)=>{let{prefixCls:n,key:o}=t;return a.createElement($m,{prefixCls:n,key:o},e)},tI=a.forwardRef(((e,t)=>{const{top:n,prefixCls:o,getContainer:i,maxCount:r,duration:s=qm,rtl:l,transitionName:c,onAllRemoved:g}=e,{getPrefixCls:u,getPopupContainer:d,message:h,direction:p}=a.useContext(Be),m=o||u("message"),I=a.createElement("span",{className:"".concat(m,"-close-x")},a.createElement(lm,{className:"".concat(m,"-close-icon")})),[C,f]=zm({prefixCls:m,style:()=>({left:"50%",transform:"translateX(-50%)",top:null!==n&&void 0!==n?n:8}),className:()=>Ie()({["".concat(m,"-rtl")]:null!==l&&void 0!==l?l:"rtl"===p}),motion:()=>function(e,t){return{motionName:null!==t&&void 0!==t?t:"".concat(e,"-move-up")}}(m,c),closable:!1,closeIcon:I,duration:s,getContainer:()=>(null===i||void 0===i?void 0:i())||(null===d||void 0===d?void 0:d())||document.body,maxCount:r,onAllRemoved:g,renderNotifications:eI});return a.useImperativeHandle(t,(()=>Object.assign(Object.assign({},C),{prefixCls:m,message:h}))),f}));let nI=0;function aI(e){const t=a.useRef(null),n=(Bi("Message"),a.useMemo((()=>{const e=e=>{var n;null===(n=t.current)||void 0===n||n.close(e)},n=n=>{if(!t.current){const e=()=>{};return e.then=()=>{},e}const{open:o,prefixCls:i,message:r}=t.current,s="".concat(i,"-notice"),{content:l,icon:c,type:g,key:u,className:d,style:h,onClose:p}=n,m=jm(n,["content","icon","type","key","className","style","onClose"]);let I=u;return void 0!==I&&null!==I||(nI+=1,I="antd-message-".concat(nI)),Qm((t=>(o(Object.assign(Object.assign({},m),{key:I,content:a.createElement(Om,{prefixCls:i,type:g,icon:c},l),placement:"top",className:Ie()(g&&"".concat(s,"-").concat(g),d,null===r||void 0===r?void 0:r.className),style:Object.assign(Object.assign({},null===r||void 0===r?void 0:r.style),h),onClose:()=>{null===p||void 0===p||p(),t()}})),()=>{e(I)})))},o={open:n,destroy:n=>{var a;void 0!==n?e(n):null===(a=t.current)||void 0===a||a.destroy()}};return["info","success","warning","error","loading"].forEach((e=>{o[e]=(t,a,o)=>{let i,r,s;i=t&&"object"===typeof t&&"content"in t?t:{content:t},"function"===typeof a?s=a:(r=a,s=o);const l=Object.assign(Object.assign({onClose:s,duration:r},i),{type:e});return n(l)}})),o}),[]));return[n,a.createElement(tI,Object.assign({key:"message-holder"},e,{ref:t}))]}let oI=null,iI=e=>e(),rI=[],sI={};function lI(){const{getContainer:e,duration:t,rtl:n,maxCount:a,top:o}=sI,i=(null===e||void 0===e?void 0:e())||document.body;return{getContainer:()=>i,duration:t,rtl:n,maxCount:a,top:o}}const cI=a.forwardRef(((e,t)=>{const{messageConfig:n,sync:o}=e,{getPrefixCls:i}=(0,a.useContext)(Be),r=sI.prefixCls||i("message"),s=(0,a.useContext)(Am),[l,c]=aI(Object.assign(Object.assign(Object.assign({},n),{prefixCls:r}),s.message));return a.useImperativeHandle(t,(()=>{const e=Object.assign({},l);return Object.keys(e).forEach((t=>{e[t]=function(){return o(),l[t].apply(l,arguments)}})),{instance:e,sync:o}})),c})),gI=a.forwardRef(((e,t)=>{const[n,o]=a.useState(lI),i=()=>{o(lI)};a.useEffect(i,[]);const r=cs(),s=r.getRootPrefixCls(),l=r.getIconPrefixCls(),c=r.getTheme(),g=a.createElement(cI,{ref:t,sync:i,messageConfig:n});return a.createElement(ds,{prefixCls:s,iconPrefixCls:l,theme:c},r.holderRender?r.holderRender(g):g)}));function uI(){if(!oI){const e=document.createDocumentFragment(),t={fragment:e};return oI=t,void iI((()=>{xs(a.createElement(gI,{ref:e=>{const{instance:n,sync:a}=e||{};Promise.resolve().then((()=>{!t.instance&&n&&(t.instance=n,t.sync=a,uI())}))}}),e)}))}oI.instance&&(rI.forEach((e=>{const{type:t,skipped:n}=e;if(!n)switch(t){case"open":iI((()=>{const t=oI.instance.open(Object.assign(Object.assign({},sI),e.config));null===t||void 0===t||t.then(e.resolve),e.setCloseFn(t)}));break;case"destroy":iI((()=>{null===oI||void 0===oI||oI.instance.destroy(e.key)}));break;default:iI((()=>{var n;const a=(n=oI.instance)[t].apply(n,Le(e.args));null===a||void 0===a||a.then(e.resolve),e.setCloseFn(a)}))}})),rI=[])}const dI={open:function(e){const t=Qm((t=>{let n;const a={type:"open",config:e,resolve:t,setCloseFn:e=>{n=e}};return rI.push(a),()=>{n?iI((()=>{n()})):a.skipped=!0}}));return uI(),t},destroy:e=>{rI.push({type:"destroy",key:e}),uI()},config:function(e){sI=Object.assign(Object.assign({},sI),e),iI((()=>{var e;null===(e=null===oI||void 0===oI?void 0:oI.sync)||void 0===e||e.call(oI)}))},useMessage:function(e){return aI(e)},_InternalPanelDoNotUseOrYouWillBeFired:_m},hI=dI;["success","info","warning","error","loading"].forEach((e=>{hI[e]=function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return function(e,t){cs();const n=Qm((n=>{let a;const o={type:e,args:t,resolve:n,setCloseFn:e=>{a=e}};return rI.push(o),()=>{a?iI((()=>{a()})):o.skipped=!0}}));return uI(),n}(e,n)}}));const pI=hI;function mI(e){return!!(null===e||void 0===e?void 0:e.then)}const II=e=>{const{type:t,children:n,prefixCls:o,buttonProps:i,close:r,autoFocus:s,emitEvent:l,isSilent:c,quitOnNullishReturnValue:g,actionFn:u}=e,d=a.useRef(!1),h=a.useRef(null),[p,m]=Ba(!1),I=function(){null===r||void 0===r||r.apply(void 0,arguments)};a.useEffect((()=>{let e=null;return s&&(e=setTimeout((()=>{var e;null===(e=h.current)||void 0===e||e.focus()}))),()=>{e&&clearTimeout(e)}}),[]);return a.createElement(tc,Object.assign({},Us(t),{onClick:e=>{if(d.current)return;if(d.current=!0,!u)return void I();let t;if(l){if(t=u(e),g&&!mI(t))return d.current=!1,void I(e)}else if(u.length)t=u(r),d.current=!1;else if(t=u(),!mI(t))return void I();(e=>{mI(e)&&(m(!0),e.then((function(){m(!1,!0),I.apply(void 0,arguments),d.current=!1}),(e=>{if(m(!1,!0),d.current=!1,!(null===c||void 0===c?void 0:c()))return Promise.reject(e)})))})(t)},loading:p,prefixCls:o},i,{ref:h}),n)},CI=a.createContext({}),{Provider:fI}=CI,bI=()=>{const{autoFocusButton:e,cancelButtonProps:t,cancelTextLocale:n,isSilent:o,mergedOkCancel:i,rootPrefixCls:r,close:s,onCancel:l,onConfirm:c}=(0,a.useContext)(CI);return i?a.createElement(II,{isSilent:o,actionFn:l,close:function(){null===s||void 0===s||s.apply(void 0,arguments),null===c||void 0===c||c(!1)},autoFocus:"cancel"===e,buttonProps:t,prefixCls:"".concat(r,"-btn")},n):null},yI=()=>{const{autoFocusButton:e,close:t,isSilent:n,okButtonProps:o,rootPrefixCls:i,okTextLocale:r,okType:s,onConfirm:l,onOk:c}=(0,a.useContext)(CI);return a.createElement(II,{isSilent:n,type:s||"primary",actionFn:c,close:function(){null===t||void 0===t||t.apply(void 0,arguments),null===l||void 0===l||l(!0)},autoFocus:"ok"===e,buttonProps:o,prefixCls:"".concat(i,"-btn")},r)};var AI=a.createContext({});function vI(e,t,n){var a=t;return!a&&n&&(a="".concat(e,"-").concat(n)),a}function SI(e,t){var n=e["page".concat(t?"Y":"X","Offset")],a="scroll".concat(t?"Top":"Left");if("number"!==typeof n){var o=e.document;"number"!==typeof(n=o.documentElement[a])&&(n=o.body[a])}return n}const xI=a.memo((function(e){return e.children}),(function(e,t){return!t.shouldUpdate}));var GI={width:0,height:0,overflow:"hidden",outline:"none"},ZI={outline:"none"},wI=a.forwardRef((function(e,t){var n=e.prefixCls,o=e.className,i=e.style,r=e.title,s=e.ariaId,l=e.footer,c=e.closable,g=e.closeIcon,u=e.onClose,d=e.children,h=e.bodyStyle,p=e.bodyProps,m=e.modalRender,I=e.onMouseDown,C=e.onMouseUp,f=e.holderRef,b=e.visible,y=e.forceRender,A=e.width,v=e.height,S=e.classNames,x=e.styles,G=a.useContext(AI).panel,Z=Se(f,G),w=(0,a.useRef)(),k=(0,a.useRef)(),B=(0,a.useRef)();a.useImperativeHandle(t,(function(){return{focus:function(){var e;null===(e=B.current)||void 0===e||e.focus({preventScroll:!0})},changeActive:function(e){var t=document.activeElement;e&&t===k.current?w.current.focus({preventScroll:!0}):e||t!==w.current||k.current.focus({preventScroll:!0})}}}));var R={};void 0!==A&&(R.width=A),void 0!==v&&(R.height=v);var W=l?a.createElement("div",{className:Ie()("".concat(n,"-footer"),null===S||void 0===S?void 0:S.footer),style:Ke({},null===x||void 0===x?void 0:x.footer)},l):null,V=r?a.createElement("div",{className:Ie()("".concat(n,"-header"),null===S||void 0===S?void 0:S.header),style:Ke({},null===x||void 0===x?void 0:x.header)},a.createElement("div",{className:"".concat(n,"-title"),id:s},r)):null,N=(0,a.useMemo)((function(){return"object"===fe(c)&&null!==c?c:c?{closeIcon:null!==g&&void 0!==g?g:a.createElement("span",{className:"".concat(n,"-close-x")})}:{}}),[c,g,n]),X=Bc(N,!0),M="object"===fe(c)&&c.disabled,T=c?a.createElement("button",yn({type:"button",onClick:u,"aria-label":"Close"},X,{className:"".concat(n,"-close"),disabled:M}),N.closeIcon):null,E=a.createElement("div",{className:Ie()("".concat(n,"-content"),null===S||void 0===S?void 0:S.content),style:null===x||void 0===x?void 0:x.content},T,V,a.createElement("div",yn({className:Ie()("".concat(n,"-body"),null===S||void 0===S?void 0:S.body),style:Ke(Ke({},h),null===x||void 0===x?void 0:x.body)},p),d),W);return a.createElement("div",{key:"dialog-element",role:"dialog","aria-labelledby":r?s:null,"aria-modal":"true",ref:Z,style:Ke(Ke({},i),R),className:Ie()(n,o),onMouseDown:I,onMouseUp:C},a.createElement("div",{tabIndex:0,ref:w,style:GI,"aria-hidden":"true"}),a.createElement("div",{ref:B,tabIndex:-1,style:ZI},a.createElement(xI,{shouldUpdate:b||y},m?m(E):E)),a.createElement("div",{tabIndex:0,ref:k,style:GI,"aria-hidden":"true"}))}));const kI=wI;var BI=a.forwardRef((function(e,t){var n=e.prefixCls,o=e.title,i=e.style,r=e.className,s=e.visible,l=e.forceRender,c=e.destroyOnClose,g=e.motionName,u=e.ariaId,d=e.onVisibleChanged,h=e.mousePosition,p=(0,a.useRef)(),m=Je(a.useState(),2),I=m[0],C=m[1],f={};function b(){var e=function(e){var t=e.getBoundingClientRect(),n={left:t.left,top:t.top},a=e.ownerDocument,o=a.defaultView||a.parentWindow;return n.left+=SI(o),n.top+=SI(o,!0),n}(p.current);C(h&&(h.x||h.y)?"".concat(h.x-e.left,"px ").concat(h.y-e.top,"px"):"")}return I&&(f.transformOrigin=I),a.createElement(qr,{visible:s,onVisibleChanged:d,onAppearPrepare:b,onEnterPrepare:b,forceRender:l,motionName:g,removeOnLeave:c,ref:p},(function(s,l){var c=s.className,g=s.style;return a.createElement(kI,yn({},e,{ref:t,title:o,ariaId:u,prefixCls:n,holderRef:l,style:Ke(Ke(Ke({},g),i),f),className:Ie()(r,c)}))}))}));BI.displayName="Content";const RI=BI;const WI=function(e){var t=e.prefixCls,n=e.style,o=e.visible,i=e.maskProps,r=e.motionName,s=e.className;return a.createElement(qr,{key:"mask",visible:o,motionName:r,leavedClassName:"".concat(t,"-mask-hidden")},(function(e,o){var r=e.className,l=e.style;return a.createElement("div",yn({ref:o,style:Ke(Ke({},l),n),className:Ie()("".concat(t,"-mask"),r,s)},i))}))};const VI=function(e){var t=e.prefixCls,n=void 0===t?"rc-dialog":t,o=e.zIndex,i=e.visible,r=void 0!==i&&i,s=e.keyboard,l=void 0===s||s,c=e.focusTriggerAfterClose,g=void 0===c||c,u=e.wrapStyle,d=e.wrapClassName,h=e.wrapProps,p=e.onClose,m=e.afterOpenChange,I=e.afterClose,C=e.transitionName,f=e.animation,b=e.closable,y=void 0===b||b,A=e.mask,v=void 0===A||A,S=e.maskTransitionName,x=e.maskAnimation,G=e.maskClosable,Z=void 0===G||G,w=e.maskStyle,k=e.maskProps,B=e.rootClassName,R=e.classNames,W=e.styles;var V=(0,a.useRef)(),N=(0,a.useRef)(),X=(0,a.useRef)(),M=Je(a.useState(r),2),T=M[0],E=M[1],F=qg();function H(e){null===p||void 0===p||p(e)}var J=(0,a.useRef)(!1),Y=(0,a.useRef)(),L=null;Z&&(L=function(e){J.current?J.current=!1:N.current===e.target&&H(e)}),(0,a.useEffect)((function(){r&&(E(!0),Pe(N.current,document.activeElement)||(V.current=document.activeElement))}),[r]),(0,a.useEffect)((function(){return function(){clearTimeout(Y.current)}}),[]);var z=Ke(Ke(Ke({zIndex:o},u),null===W||void 0===W?void 0:W.wrapper),{},{display:T?null:"none"});return a.createElement("div",yn({className:Ie()("".concat(n,"-root"),B)},Bc(e,{data:!0})),a.createElement(WI,{prefixCls:n,visible:v&&r,motionName:vI(n,S,x),style:Ke(Ke({zIndex:o},w),null===W||void 0===W?void 0:W.mask),maskProps:k,className:null===R||void 0===R?void 0:R.mask}),a.createElement("div",yn({tabIndex:-1,onKeyDown:function(e){if(l&&e.keyCode===Ac.ESC)return e.stopPropagation(),void H(e);r&&e.keyCode===Ac.TAB&&X.current.changeActive(!e.shiftKey)},className:Ie()("".concat(n,"-wrap"),d,null===R||void 0===R?void 0:R.wrapper),ref:N,onClick:L,style:z},h),a.createElement(RI,yn({},e,{onMouseDown:function(){clearTimeout(Y.current),J.current=!0},onMouseUp:function(){Y.current=setTimeout((function(){J.current=!1}))},ref:X,closable:y,ariaId:F,prefixCls:n,visible:r&&T,onClose:H,onVisibleChanged:function(e){if(e)!function(){var e;Pe(N.current,document.activeElement)||null===(e=X.current)||void 0===e||e.focus()}();else{if(E(!1),v&&V.current&&g){try{V.current.focus({preventScroll:!0})}catch(Pke){}V.current=null}T&&(null===I||void 0===I||I())}null===m||void 0===m||m(e)},motionName:vI(n,C,f)}))))};var NI=function(e){var t=e.visible,n=e.getContainer,o=e.forceRender,i=e.destroyOnClose,r=void 0!==i&&i,s=e.afterClose,l=e.panelRef,c=Je(a.useState(t),2),g=c[0],u=c[1],d=a.useMemo((function(){return{panel:l}}),[l]);return a.useEffect((function(){t&&u(!0)}),[t]),o||!r||g?a.createElement(AI.Provider,{value:d},a.createElement(_g,{open:t||o||g,autoDestroy:!1,getContainer:n,autoLock:t||g},a.createElement(VI,yn({},e,{destroyOnClose:r,afterClose:function(){null===s||void 0===s||s(),u(!1)}})))):null};NI.displayName="Dialog";const XI=NI,MI=e=>{const{space:t,form:n,children:o}=e;if(void 0===o||null===o)return null;let i=o;return n&&(i=a.createElement(lp,{override:!0,status:!0},i)),t&&(i=a.createElement(Js,null,i)),i};function TI(e){if(e)return{closable:e.closable,closeIcon:e.closeIcon}}function EI(e){const{closable:t,closeIcon:n}=e||{};return a.useMemo((()=>{if(!t&&(!1===t||!1===n||null===n))return!1;if(void 0===t&&void 0===n)return null;let e={closeIcon:"boolean"!==typeof n&&null!==n?n:void 0};return t&&"object"===typeof t&&(e=Object.assign(Object.assign({},e),t)),e}),[t,n])}function FI(){const e={};for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach((t=>{t&&Object.keys(t).forEach((n=>{void 0!==t[n]&&(e[n]=t[n])}))})),e}const HI={};const JI=e=>{const{prefixCls:t,className:n,style:o,size:i,shape:r}=e,s=Ie()({["".concat(t,"-lg")]:"large"===i,["".concat(t,"-sm")]:"small"===i}),l=Ie()({["".concat(t,"-circle")]:"circle"===r,["".concat(t,"-square")]:"square"===r,["".concat(t,"-round")]:"round"===r}),c=a.useMemo((()=>"number"===typeof i?{width:i,height:i,lineHeight:"".concat(i,"px")}:{}),[i]);return a.createElement("span",{className:Ie()(t,s,l,n),style:Object.assign(Object.assign({},c),o)})},YI=new Za("ant-skeleton-loading",{"0%":{backgroundPosition:"100% 50%"},"100%":{backgroundPosition:"0 50%"}}),LI=e=>({height:e,lineHeight:Qt(e)}),zI=e=>Object.assign({width:e},LI(e)),KI=e=>({background:e.skeletonLoadingBackground,backgroundSize:"400% 100%",animationName:YI,animationDuration:e.skeletonLoadingMotionDuration,animationTimingFunction:"ease",animationIterationCount:"infinite"}),DI=(e,t)=>Object.assign({width:t(e).mul(5).equal(),minWidth:t(e).mul(5).equal()},LI(e)),UI=e=>{const{skeletonAvatarCls:t,gradientFromColor:n,controlHeight:a,controlHeightLG:o,controlHeightSM:i}=e;return{["".concat(t)]:Object.assign({display:"inline-block",verticalAlign:"top",background:n},zI(a)),["".concat(t).concat(t,"-circle")]:{borderRadius:"50%"},["".concat(t).concat(t,"-lg")]:Object.assign({},zI(o)),["".concat(t).concat(t,"-sm")]:Object.assign({},zI(i))}},PI=e=>{const{controlHeight:t,borderRadiusSM:n,skeletonInputCls:a,controlHeightLG:o,controlHeightSM:i,gradientFromColor:r,calc:s}=e;return{["".concat(a)]:Object.assign({display:"inline-block",verticalAlign:"top",background:r,borderRadius:n},DI(t,s)),["".concat(a,"-lg")]:Object.assign({},DI(o,s)),["".concat(a,"-sm")]:Object.assign({},DI(i,s))}},OI=e=>Object.assign({width:e},LI(e)),_I=e=>{const{skeletonImageCls:t,imageSizeBase:n,gradientFromColor:a,borderRadiusSM:o,calc:i}=e;return{["".concat(t)]:Object.assign(Object.assign({display:"flex",alignItems:"center",justifyContent:"center",verticalAlign:"top",background:a,borderRadius:o},OI(i(n).mul(2).equal())),{["".concat(t,"-path")]:{fill:"#bfbfbf"},["".concat(t,"-svg")]:Object.assign(Object.assign({},OI(n)),{maxWidth:i(n).mul(4).equal(),maxHeight:i(n).mul(4).equal()}),["".concat(t,"-svg").concat(t,"-svg-circle")]:{borderRadius:"50%"}}),["".concat(t).concat(t,"-circle")]:{borderRadius:"50%"}}},QI=(e,t,n)=>{const{skeletonButtonCls:a}=e;return{["".concat(n).concat(a,"-circle")]:{width:t,minWidth:t,borderRadius:"50%"},["".concat(n).concat(a,"-round")]:{borderRadius:t}}},jI=(e,t)=>Object.assign({width:t(e).mul(2).equal(),minWidth:t(e).mul(2).equal()},LI(e)),qI=e=>{const{borderRadiusSM:t,skeletonButtonCls:n,controlHeight:a,controlHeightLG:o,controlHeightSM:i,gradientFromColor:r,calc:s}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({["".concat(n)]:Object.assign({display:"inline-block",verticalAlign:"top",background:r,borderRadius:t,width:s(a).mul(2).equal(),minWidth:s(a).mul(2).equal()},jI(a,s))},QI(e,a,n)),{["".concat(n,"-lg")]:Object.assign({},jI(o,s))}),QI(e,o,"".concat(n,"-lg"))),{["".concat(n,"-sm")]:Object.assign({},jI(i,s))}),QI(e,i,"".concat(n,"-sm")))},$I=e=>{const{componentCls:t,skeletonAvatarCls:n,skeletonTitleCls:a,skeletonParagraphCls:o,skeletonButtonCls:i,skeletonInputCls:r,skeletonImageCls:s,controlHeight:l,controlHeightLG:c,controlHeightSM:g,gradientFromColor:u,padding:d,marginSM:h,borderRadius:p,titleHeight:m,blockRadius:I,paragraphLiHeight:C,controlHeightXS:f,paragraphMarginTop:b}=e;return{["".concat(t)]:{display:"table",width:"100%",["".concat(t,"-header")]:{display:"table-cell",paddingInlineEnd:d,verticalAlign:"top",["".concat(n)]:Object.assign({display:"inline-block",verticalAlign:"top",background:u},zI(l)),["".concat(n,"-circle")]:{borderRadius:"50%"},["".concat(n,"-lg")]:Object.assign({},zI(c)),["".concat(n,"-sm")]:Object.assign({},zI(g))},["".concat(t,"-content")]:{display:"table-cell",width:"100%",verticalAlign:"top",["".concat(a)]:{width:"100%",height:m,background:u,borderRadius:I,["+ ".concat(o)]:{marginBlockStart:g}},["".concat(o)]:{padding:0,"> li":{width:"100%",height:C,listStyle:"none",background:u,borderRadius:I,"+ li":{marginBlockStart:f}}},["".concat(o,"> li:last-child:not(:first-child):not(:nth-child(2))")]:{width:"61%"}},["&-round ".concat(t,"-content")]:{["".concat(a,", ").concat(o," > li")]:{borderRadius:p}}},["".concat(t,"-with-avatar ").concat(t,"-content")]:{["".concat(a)]:{marginBlockStart:h,["+ ".concat(o)]:{marginBlockStart:b}}},["".concat(t).concat(t,"-element")]:Object.assign(Object.assign(Object.assign(Object.assign({display:"inline-block",width:"auto"},qI(e)),UI(e)),PI(e)),_I(e)),["".concat(t).concat(t,"-block")]:{width:"100%",["".concat(i)]:{width:"100%"},["".concat(r)]:{width:"100%"}},["".concat(t).concat(t,"-active")]:{["\n        ".concat(a,",\n        ").concat(o," > li,\n        ").concat(n,",\n        ").concat(i,",\n        ").concat(r,",\n        ").concat(s,"\n      ")]:Object.assign({},KI(e))}}},eC=Ii("Skeleton",(e=>{const{componentCls:t,calc:n}=e,a=ri(e,{skeletonAvatarCls:"".concat(t,"-avatar"),skeletonTitleCls:"".concat(t,"-title"),skeletonParagraphCls:"".concat(t,"-paragraph"),skeletonButtonCls:"".concat(t,"-button"),skeletonInputCls:"".concat(t,"-input"),skeletonImageCls:"".concat(t,"-image"),imageSizeBase:n(e.controlHeight).mul(1.5).equal(),borderRadius:100,skeletonLoadingBackground:"linear-gradient(90deg, ".concat(e.gradientFromColor," 25%, ").concat(e.gradientToColor," 37%, ").concat(e.gradientFromColor," 63%)"),skeletonLoadingMotionDuration:"1.4s"});return[$I(a)]}),(e=>{const{colorFillContent:t,colorFill:n}=e;return{color:t,colorGradientEnd:n,gradientFromColor:t,gradientToColor:n,titleHeight:e.controlHeight/2,blockRadius:e.borderRadiusSM,paragraphMarginTop:e.marginLG+e.marginXXS,paragraphLiHeight:e.controlHeight/2}}),{deprecatedTokens:[["color","gradientFromColor"],["colorGradientEnd","gradientToColor"]]}),tC=e=>{const{prefixCls:t,className:n,rootClassName:o,active:i,shape:r="circle",size:s="default"}=e,{getPrefixCls:l}=a.useContext(Be),c=l("skeleton",t),[g,u,d]=eC(c),h=Ce(e,["prefixCls","className"]),p=Ie()(c,"".concat(c,"-element"),{["".concat(c,"-active")]:i},n,o,u,d);return g(a.createElement("div",{className:p},a.createElement(JI,Object.assign({prefixCls:"".concat(c,"-avatar"),shape:r,size:s},h))))},nC=e=>{const{prefixCls:t,className:n,rootClassName:o,active:i,block:r=!1,size:s="default"}=e,{getPrefixCls:l}=a.useContext(Be),c=l("skeleton",t),[g,u,d]=eC(c),h=Ce(e,["prefixCls"]),p=Ie()(c,"".concat(c,"-element"),{["".concat(c,"-active")]:i,["".concat(c,"-block")]:r},n,o,u,d);return g(a.createElement("div",{className:p},a.createElement(JI,Object.assign({prefixCls:"".concat(c,"-button"),size:s},h))))},aC=e=>{const{prefixCls:t,className:n,rootClassName:o,style:i,active:r}=e,{getPrefixCls:s}=a.useContext(Be),l=s("skeleton",t),[c,g,u]=eC(l),d=Ie()(l,"".concat(l,"-element"),{["".concat(l,"-active")]:r},n,o,g,u);return c(a.createElement("div",{className:d},a.createElement("div",{className:Ie()("".concat(l,"-image"),n),style:i},a.createElement("svg",{viewBox:"0 0 1098 1024",xmlns:"http://www.w3.org/2000/svg",className:"".concat(l,"-image-svg")},a.createElement("title",null,"Image placeholder"),a.createElement("path",{d:"M365.714286 329.142857q0 45.714286-32.036571 77.677714t-77.677714 32.036571-77.677714-32.036571-32.036571-77.677714 32.036571-77.677714 77.677714-32.036571 77.677714 32.036571 32.036571 77.677714zM950.857143 548.571429l0 256-804.571429 0 0-109.714286 182.857143-182.857143 91.428571 91.428571 292.571429-292.571429zM1005.714286 146.285714l-914.285714 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 694.857143q0 7.460571 5.412571 12.873143t12.873143 5.412571l914.285714 0q7.460571 0 12.873143-5.412571t5.412571-12.873143l0-694.857143q0-7.460571-5.412571-12.873143t-12.873143-5.412571zM1097.142857 164.571429l0 694.857143q0 37.741714-26.843429 64.585143t-64.585143 26.843429l-914.285714 0q-37.741714 0-64.585143-26.843429t-26.843429-64.585143l0-694.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l914.285714 0q37.741714 0 64.585143 26.843429t26.843429 64.585143z",className:"".concat(l,"-image-path")})))))},oC=e=>{const{prefixCls:t,className:n,rootClassName:o,active:i,block:r,size:s="default"}=e,{getPrefixCls:l}=a.useContext(Be),c=l("skeleton",t),[g,u,d]=eC(c),h=Ce(e,["prefixCls"]),p=Ie()(c,"".concat(c,"-element"),{["".concat(c,"-active")]:i,["".concat(c,"-block")]:r},n,o,u,d);return g(a.createElement("div",{className:p},a.createElement(JI,Object.assign({prefixCls:"".concat(c,"-input"),size:s},h))))};const iC={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM288 604a64 64 0 10128 0 64 64 0 10-128 0zm118-224a48 48 0 1096 0 48 48 0 10-96 0zm158 228a96 96 0 10192 0 96 96 0 10-192 0zm148-314a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"dot-chart",theme:"outlined"};var rC=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:iC}))};const sC=a.forwardRef(rC),lC=e=>{const{prefixCls:t,className:n,rootClassName:o,style:i,active:r,children:s}=e,{getPrefixCls:l}=a.useContext(Be),c=l("skeleton",t),[g,u,d]=eC(c),h=Ie()(c,"".concat(c,"-element"),{["".concat(c,"-active")]:r},u,n,o,d),p=null!==s&&void 0!==s?s:a.createElement(sC,null);return g(a.createElement("div",{className:h},a.createElement("div",{className:Ie()("".concat(c,"-image"),n),style:i},p)))},cC=(e,t)=>{const{width:n,rows:a=2}=t;return Array.isArray(n)?n[e]:a-1===e?n:void 0},gC=e=>{const{prefixCls:t,className:n,style:o,rows:i}=e,r=Le(Array(i)).map(((t,n)=>a.createElement("li",{key:n,style:{width:cC(n,e)}})));return a.createElement("ul",{className:Ie()(t,n),style:o},r)},uC=e=>{let{prefixCls:t,className:n,width:o,style:i}=e;return a.createElement("h3",{className:Ie()(t,n),style:Object.assign({width:o},i)})};function dC(e){return e&&"object"===typeof e?e:{}}const hC=e=>{const{prefixCls:t,loading:n,className:o,rootClassName:i,style:r,children:s,avatar:l=!1,title:c=!0,paragraph:g=!0,active:u,round:d}=e,{getPrefixCls:h,direction:p,skeleton:m}=a.useContext(Be),I=h("skeleton",t),[C,f,b]=eC(I);if(n||!("loading"in e)){const e=!!l,t=!!c,n=!!g;let s,h;if(e){const e=Object.assign(Object.assign({prefixCls:"".concat(I,"-avatar")},function(e,t){return e&&!t?{size:"large",shape:"square"}:{size:"large",shape:"circle"}}(t,n)),dC(l));s=a.createElement("div",{className:"".concat(I,"-header")},a.createElement(JI,Object.assign({},e)))}if(t||n){let o,i;if(t){const t=Object.assign(Object.assign({prefixCls:"".concat(I,"-title")},function(e,t){return!e&&t?{width:"38%"}:e&&t?{width:"50%"}:{}}(e,n)),dC(c));o=a.createElement(uC,Object.assign({},t))}if(n){const n=Object.assign(Object.assign({prefixCls:"".concat(I,"-paragraph")},function(e,t){const n={};return e&&t||(n.width="61%"),n.rows=!e&&t?3:2,n}(e,t)),dC(g));i=a.createElement(gC,Object.assign({},n))}h=a.createElement("div",{className:"".concat(I,"-content")},o,i)}const y=Ie()(I,{["".concat(I,"-with-avatar")]:e,["".concat(I,"-active")]:u,["".concat(I,"-rtl")]:"rtl"===p,["".concat(I,"-round")]:d},null===m||void 0===m?void 0:m.className,o,i,f,b);return C(a.createElement("div",{className:y,style:Object.assign(Object.assign({},null===m||void 0===m?void 0:m.style),r)},s,h))}return null!==s&&void 0!==s?s:null};hC.Button=nC,hC.Avatar=tC,hC.Input=oC,hC.Image=aC,hC.Node=lC;const pC=hC;function mC(){}const IC=a.createContext({add:mC,remove:mC});const CC=()=>{const{cancelButtonProps:e,cancelTextLocale:t,onCancel:n}=(0,a.useContext)(CI);return a.createElement(tc,Object.assign({onClick:n},e),t)},fC=()=>{const{confirmLoading:e,okButtonProps:t,okType:n,okTextLocale:o,onOk:i}=(0,a.useContext)(CI);return a.createElement(tc,Object.assign({},Us(n),{loading:e,onClick:i},t),o)};function bC(e,t){return a.createElement("span",{className:"".concat(e,"-close-x")},t||a.createElement(lm,{className:"".concat(e,"-close-icon")}))}const yC=e=>{const{okText:t,okType:n="primary",cancelText:o,confirmLoading:i,onOk:r,onCancel:s,okButtonProps:l,cancelButtonProps:c,footer:g}=e,[u]=Ed("Modal",Ji()),d={confirmLoading:i,okButtonProps:l,cancelButtonProps:c,okTextLocale:t||(null===u||void 0===u?void 0:u.okText),cancelTextLocale:o||(null===u||void 0===u?void 0:u.cancelText),okType:n,onOk:r,onCancel:s},h=a.useMemo((()=>d),Le(Object.values(d)));let p;return"function"===typeof g||"undefined"===typeof g?(p=a.createElement(a.Fragment,null,a.createElement(CC,null),a.createElement(fC,null)),"function"===typeof g&&(p=g(p,{OkBtn:fC,CancelBtn:CC})),p=a.createElement(fI,{value:h},p)):p=g,a.createElement(Ui,{disabled:!1},p)},AC=new Za("antFadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),vC=new Za("antFadeOut",{"0%":{opacity:1},"100%":{opacity:0}}),SC=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{antCls:n}=e,a="".concat(n,"-fade"),o=t?"&":"";return[pp(a,AC,vC,e.motionDurationMid,t),{["\n        ".concat(o).concat(a,"-enter,\n        ").concat(o).concat(a,"-appear\n      ")]:{opacity:0,animationTimingFunction:"linear"},["".concat(o).concat(a,"-leave")]:{animationTimingFunction:"linear"}}]},xC=new Za("antZoomIn",{"0%":{transform:"scale(0.2)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),GC=new Za("antZoomOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.2)",opacity:0}}),ZC=new Za("antZoomBigIn",{"0%":{transform:"scale(0.8)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),wC=new Za("antZoomBigOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.8)",opacity:0}}),kC=new Za("antZoomUpIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 0%"}}),BC=new Za("antZoomUpOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 0%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0}}),RC={zoom:{inKeyframes:xC,outKeyframes:GC},"zoom-big":{inKeyframes:ZC,outKeyframes:wC},"zoom-big-fast":{inKeyframes:ZC,outKeyframes:wC},"zoom-left":{inKeyframes:new Za("antZoomLeftIn",{"0%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"0% 50%"}}),outKeyframes:new Za("antZoomLeftOut",{"0%":{transform:"scale(1)",transformOrigin:"0% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0}})},"zoom-right":{inKeyframes:new Za("antZoomRightIn",{"0%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"100% 50%"}}),outKeyframes:new Za("antZoomRightOut",{"0%":{transform:"scale(1)",transformOrigin:"100% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0}})},"zoom-up":{inKeyframes:kC,outKeyframes:BC},"zoom-down":{inKeyframes:new Za("antZoomDownIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 100%"}}),outKeyframes:new Za("antZoomDownOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 100%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0}})}},WC=(e,t)=>{const{antCls:n}=e,a="".concat(n,"-").concat(t),{inKeyframes:o,outKeyframes:i}=RC[t];return[pp(a,o,i,"zoom-big-fast"===t?e.motionDurationFast:e.motionDurationMid),{["\n        ".concat(a,"-enter,\n        ").concat(a,"-appear\n      ")]:{transform:"scale(0)",opacity:0,animationTimingFunction:e.motionEaseOutCirc,"&-prepare":{transform:"none"}},["".concat(a,"-leave")]:{animationTimingFunction:e.motionEaseInOutCirc}}]};function VC(e){return{position:e,inset:0}}const NC=e=>{const{componentCls:t,antCls:n}=e;return[{["".concat(t,"-root")]:{["".concat(t).concat(n,"-zoom-enter, ").concat(t).concat(n,"-zoom-appear")]:{transform:"none",opacity:0,animationDuration:e.motionDurationSlow,userSelect:"none"},["".concat(t).concat(n,"-zoom-leave ").concat(t,"-content")]:{pointerEvents:"none"},["".concat(t,"-mask")]:Object.assign(Object.assign({},VC("fixed")),{zIndex:e.zIndexPopupBase,height:"100%",backgroundColor:e.colorBgMask,pointerEvents:"none",["".concat(t,"-hidden")]:{display:"none"}}),["".concat(t,"-wrap")]:Object.assign(Object.assign({},VC("fixed")),{zIndex:e.zIndexPopupBase,overflow:"auto",outline:0,WebkitOverflowScrolling:"touch"})}},{["".concat(t,"-root")]:SC(e)}]},XC=e=>{const{componentCls:t}=e;return[{["".concat(t,"-root")]:{["".concat(t,"-wrap-rtl")]:{direction:"rtl"},["".concat(t,"-centered")]:{textAlign:"center","&::before":{display:"inline-block",width:0,height:"100%",verticalAlign:"middle",content:'""'},[t]:{top:0,display:"inline-block",paddingBottom:0,textAlign:"start",verticalAlign:"middle"}},["@media (max-width: ".concat(e.screenSMMax,"px)")]:{[t]:{maxWidth:"calc(100vw - 16px)",margin:"".concat(Qt(e.marginXS)," auto")},["".concat(t,"-centered")]:{[t]:{flex:1}}}}},{[t]:Object.assign(Object.assign({},za(e)),{pointerEvents:"none",position:"relative",top:100,width:"auto",maxWidth:"calc(100vw - ".concat(Qt(e.calc(e.margin).mul(2).equal()),")"),margin:"0 auto",paddingBottom:e.paddingLG,["".concat(t,"-title")]:{margin:0,color:e.titleColor,fontWeight:e.fontWeightStrong,fontSize:e.titleFontSize,lineHeight:e.titleLineHeight,wordWrap:"break-word"},["".concat(t,"-content")]:{position:"relative",backgroundColor:e.contentBg,backgroundClip:"padding-box",border:0,borderRadius:e.borderRadiusLG,boxShadow:e.boxShadow,pointerEvents:"auto",padding:e.contentPadding},["".concat(t,"-close")]:Object.assign({position:"absolute",top:e.calc(e.modalHeaderHeight).sub(e.modalCloseBtnSize).div(2).equal(),insetInlineEnd:e.calc(e.modalHeaderHeight).sub(e.modalCloseBtnSize).div(2).equal(),zIndex:e.calc(e.zIndexPopupBase).add(10).equal(),padding:0,color:e.modalCloseIconColor,fontWeight:e.fontWeightStrong,lineHeight:1,textDecoration:"none",background:"transparent",borderRadius:e.borderRadiusSM,width:e.modalCloseBtnSize,height:e.modalCloseBtnSize,border:0,outline:0,cursor:"pointer",transition:"color ".concat(e.motionDurationMid,", background-color ").concat(e.motionDurationMid),"&-x":{display:"flex",fontSize:e.fontSizeLG,fontStyle:"normal",lineHeight:"".concat(Qt(e.modalCloseBtnSize)),justifyContent:"center",textTransform:"none",textRendering:"auto"},"&:hover":{color:e.modalCloseIconHoverColor,backgroundColor:e.colorBgTextHover,textDecoration:"none"},"&:active":{backgroundColor:e.colorBgTextActive}},Pa(e)),["".concat(t,"-header")]:{color:e.colorText,background:e.headerBg,borderRadius:"".concat(Qt(e.borderRadiusLG)," ").concat(Qt(e.borderRadiusLG)," 0 0"),marginBottom:e.headerMarginBottom,padding:e.headerPadding,borderBottom:e.headerBorderBottom},["".concat(t,"-body")]:{fontSize:e.fontSize,lineHeight:e.lineHeight,wordWrap:"break-word",padding:e.bodyPadding,["".concat(t,"-body-skeleton")]:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",margin:"".concat(Qt(e.margin)," auto")}},["".concat(t,"-footer")]:{textAlign:"end",background:e.footerBg,marginTop:e.footerMarginTop,padding:e.footerPadding,borderTop:e.footerBorderTop,borderRadius:e.footerBorderRadius,["> ".concat(e.antCls,"-btn + ").concat(e.antCls,"-btn")]:{marginInlineStart:e.marginXS}},["".concat(t,"-open")]:{overflow:"hidden"}})},{["".concat(t,"-pure-panel")]:{top:"auto",padding:0,display:"flex",flexDirection:"column",["".concat(t,"-content,\n          ").concat(t,"-body,\n          ").concat(t,"-confirm-body-wrapper")]:{display:"flex",flexDirection:"column",flex:"auto"},["".concat(t,"-confirm-body")]:{marginBottom:"auto"}}}]},MC=e=>{const{componentCls:t}=e;return{["".concat(t,"-root")]:{["".concat(t,"-wrap-rtl")]:{direction:"rtl",["".concat(t,"-confirm-body")]:{direction:"rtl"}}}}},TC=e=>{const t=e.padding,n=e.fontSizeHeading5,a=e.lineHeightHeading5;return ri(e,{modalHeaderHeight:e.calc(e.calc(a).mul(n).equal()).add(e.calc(t).mul(2).equal()).equal(),modalFooterBorderColorSplit:e.colorSplit,modalFooterBorderStyle:e.lineType,modalFooterBorderWidth:e.lineWidth,modalCloseIconColor:e.colorIcon,modalCloseIconHoverColor:e.colorIconHover,modalCloseBtnSize:e.controlHeight,modalConfirmIconSize:e.fontHeight,modalTitleHeight:e.calc(e.titleFontSize).mul(e.titleLineHeight).equal()})},EC=e=>({footerBg:"transparent",headerBg:e.colorBgElevated,titleLineHeight:e.lineHeightHeading5,titleFontSize:e.fontSizeHeading5,contentBg:e.colorBgElevated,titleColor:e.colorTextHeading,contentPadding:e.wireframe?0:"".concat(Qt(e.paddingMD)," ").concat(Qt(e.paddingContentHorizontalLG)),headerPadding:e.wireframe?"".concat(Qt(e.padding)," ").concat(Qt(e.paddingLG)):0,headerBorderBottom:e.wireframe?"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorSplit):"none",headerMarginBottom:e.wireframe?0:e.marginXS,bodyPadding:e.wireframe?e.paddingLG:0,footerPadding:e.wireframe?"".concat(Qt(e.paddingXS)," ").concat(Qt(e.padding)):0,footerBorderTop:e.wireframe?"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorSplit):"none",footerBorderRadius:e.wireframe?"0 0 ".concat(Qt(e.borderRadiusLG)," ").concat(Qt(e.borderRadiusLG)):0,footerMarginTop:e.wireframe?0:e.marginSM,confirmBodyPadding:e.wireframe?"".concat(Qt(2*e.padding)," ").concat(Qt(2*e.padding)," ").concat(Qt(e.paddingLG)):0,confirmIconMarginInlineEnd:e.wireframe?e.margin:e.marginSM,confirmBtnsMarginTop:e.wireframe?e.marginLG:e.marginSM}),FC=Ii("Modal",(e=>{const t=TC(e);return[XC(t),MC(t),NC(t),WC(t,"zoom")]}),EC,{unitless:{titleLineHeight:!0}});var HC=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};let JC;const YC=e=>{JC={x:e.pageX,y:e.pageY},setTimeout((()=>{JC=null}),100)};Ue()&&window.document.documentElement&&document.documentElement.addEventListener("click",YC,!0);const LC=e=>{var t;const{getPopupContainer:n,getPrefixCls:o,direction:i,modal:r}=a.useContext(Be),s=t=>{const{onCancel:n}=e;null===n||void 0===n||n(t)};const{prefixCls:l,className:c,rootClassName:g,open:u,wrapClassName:d,centered:h,getContainer:p,focusTriggerAfterClose:m=!0,style:I,visible:C,width:f=520,footer:b,classNames:y,styles:A,children:v,loading:S}=e,x=HC(e,["prefixCls","className","rootClassName","open","wrapClassName","centered","getContainer","focusTriggerAfterClose","style","visible","width","footer","classNames","styles","children","loading"]),G=o("modal",l),Z=o(),w=Od(G),[k,B,R]=FC(G,w),W=Ie()(d,{["".concat(G,"-centered")]:!!h,["".concat(G,"-wrap-rtl")]:"rtl"===i}),V=null===b||S?null:a.createElement(yC,Object.assign({},e,{onOk:t=>{const{onOk:n}=e;null===n||void 0===n||n(t)},onCancel:s})),[N,X]=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:HI;const o=EI(e),i=EI(t),r=a.useMemo((()=>Object.assign({closeIcon:a.createElement(lm,null)},n)),[n]),s=a.useMemo((()=>!1!==o&&(o?FI(r,i,o):!1!==i&&(i?FI(r,i):!!r.closable&&r))),[o,i,r]);return a.useMemo((()=>{if(!1===s)return[!1,null];const{closeIconRender:e}=r,{closeIcon:t}=s;let n=t;if(null!==n&&void 0!==n){e&&(n=e(t));const o=Bc(s,!0);Object.keys(o).length&&(n=a.isValidElement(n)?a.cloneElement(n,o):a.createElement("span",Object.assign({},o),n))}return[!0,n]}),[s,r])}(TI(e),TI(r),{closable:!0,closeIcon:a.createElement(lm,{className:"".concat(G,"-close-icon")}),closeIconRender:e=>bC(G,e)}),M=function(e){const t=a.useContext(IC),n=a.useRef();return ka((a=>{if(a){const o=e?a.querySelector(e):a;t.add(o),n.current=o}else t.remove(n.current)}))}(".".concat(G,"-content")),[T,E]=Wd("Modal",x.zIndex);return k(a.createElement(MI,{form:!0,space:!0},a.createElement(Zd.Provider,{value:E},a.createElement(XI,Object.assign({width:f},x,{zIndex:T,getContainer:void 0===p?n:p,prefixCls:G,rootClassName:Ie()(B,g,R,w),footer:V,visible:null!==u&&void 0!==u?u:C,mousePosition:null!==(t=x.mousePosition)&&void 0!==t?t:JC,onClose:s,closable:N,closeIcon:X,focusTriggerAfterClose:m,transitionName:Vd(Z,"zoom",e.transitionName),maskTransitionName:Vd(Z,"fade",e.maskTransitionName),className:Ie()(B,c,null===r||void 0===r?void 0:r.className),style:Object.assign(Object.assign({},null===r||void 0===r?void 0:r.style),I),classNames:Object.assign(Object.assign(Object.assign({},null===r||void 0===r?void 0:r.classNames),y),{wrapper:Ie()(W,null===y||void 0===y?void 0:y.wrapper)}),styles:Object.assign(Object.assign({},null===r||void 0===r?void 0:r.styles),A),panelRef:M}),S?a.createElement(pC,{active:!0,title:!1,paragraph:{rows:4},className:"".concat(G,"-body-skeleton")}):v))))},zC=e=>{const{componentCls:t,titleFontSize:n,titleLineHeight:a,modalConfirmIconSize:o,fontSize:i,lineHeight:r,modalTitleHeight:s,fontHeight:l,confirmBodyPadding:c}=e,g="".concat(t,"-confirm");return{[g]:{"&-rtl":{direction:"rtl"},["".concat(e.antCls,"-modal-header")]:{display:"none"},["".concat(g,"-body-wrapper")]:Object.assign({},{"&::before":{display:"table",content:'""'},"&::after":{display:"table",clear:"both",content:'""'}}),["&".concat(t," ").concat(t,"-body")]:{padding:c},["".concat(g,"-body")]:{display:"flex",flexWrap:"nowrap",alignItems:"start",["> ".concat(e.iconCls)]:{flex:"none",fontSize:o,marginInlineEnd:e.confirmIconMarginInlineEnd,marginTop:e.calc(e.calc(l).sub(o).equal()).div(2).equal()},["&-has-title > ".concat(e.iconCls)]:{marginTop:e.calc(e.calc(s).sub(o).equal()).div(2).equal()}},["".concat(g,"-paragraph")]:{display:"flex",flexDirection:"column",flex:"auto",rowGap:e.marginXS},["".concat(e.iconCls," + ").concat(g,"-paragraph")]:{maxWidth:"calc(100% - ".concat(Qt(e.calc(e.modalConfirmIconSize).add(e.marginSM).equal()),")")},["".concat(g,"-title")]:{color:e.colorTextHeading,fontWeight:e.fontWeightStrong,fontSize:n,lineHeight:a},["".concat(g,"-content")]:{color:e.colorText,fontSize:i,lineHeight:r},["".concat(g,"-btns")]:{textAlign:"end",marginTop:e.confirmBtnsMarginTop,["".concat(e.antCls,"-btn + ").concat(e.antCls,"-btn")]:{marginBottom:0,marginInlineStart:e.marginXS}}},["".concat(g,"-error ").concat(g,"-body > ").concat(e.iconCls)]:{color:e.colorError},["".concat(g,"-warning ").concat(g,"-body > ").concat(e.iconCls,",\n        ").concat(g,"-confirm ").concat(g,"-body > ").concat(e.iconCls)]:{color:e.colorWarning},["".concat(g,"-info ").concat(g,"-body > ").concat(e.iconCls)]:{color:e.colorInfo},["".concat(g,"-success ").concat(g,"-body > ").concat(e.iconCls)]:{color:e.colorSuccess}}},KC=mi(["Modal","confirm"],(e=>{const t=TC(e);return[zC(t)]}),EC,{order:-1e3});var DC=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};function UC(e){const{prefixCls:t,icon:n,okText:o,cancelText:i,confirmPrefixCls:r,type:s,okCancel:l,footer:c,locale:g}=e,u=DC(e,["prefixCls","icon","okText","cancelText","confirmPrefixCls","type","okCancel","footer","locale"]);let d=n;if(!n&&null!==n)switch(s){case"info":d=a.createElement(Rm,null);break;case"success":d=a.createElement(xm,null);break;case"error":d=a.createElement(im,null);break;default:d=a.createElement(wm,null)}const h=null!==l&&void 0!==l?l:"confirm"===s,p=null!==e.autoFocusButton&&(e.autoFocusButton||"ok"),[m]=Ed("Modal"),I=g||m,C=o||(h?null===I||void 0===I?void 0:I.okText:null===I||void 0===I?void 0:I.justOkText),f=i||(null===I||void 0===I?void 0:I.cancelText),b=Object.assign({autoFocusButton:p,cancelTextLocale:f,okTextLocale:C,mergedOkCancel:h},u),y=a.useMemo((()=>b),Le(Object.values(b))),A=a.createElement(a.Fragment,null,a.createElement(bI,null),a.createElement(yI,null)),v=void 0!==e.title&&null!==e.title,S="".concat(r,"-body");return a.createElement("div",{className:"".concat(r,"-body-wrapper")},a.createElement("div",{className:Ie()(S,{["".concat(S,"-has-title")]:v})},d,a.createElement("div",{className:"".concat(r,"-paragraph")},v&&a.createElement("span",{className:"".concat(r,"-title")},e.title),a.createElement("div",{className:"".concat(r,"-content")},e.content))),void 0===c||"function"===typeof c?a.createElement(fI,{value:y},a.createElement("div",{className:"".concat(r,"-btns")},"function"===typeof c?c(A,{OkBtn:yI,CancelBtn:bI}):A)):c,a.createElement(KC,{prefixCls:t}))}const PC=e=>{const{close:t,zIndex:n,afterClose:o,open:i,keyboard:r,centered:s,getContainer:l,maskStyle:c,direction:g,prefixCls:u,wrapClassName:d,rootPrefixCls:h,bodyStyle:p,closable:m=!1,closeIcon:I,modalRender:C,focusTriggerAfterClose:f,onConfirm:b,styles:y}=e;const A="".concat(u,"-confirm"),v=e.width||416,S=e.style||{},x=void 0===e.mask||e.mask,G=void 0!==e.maskClosable&&e.maskClosable,Z=Ie()(A,"".concat(A,"-").concat(e.type),{["".concat(A,"-rtl")]:"rtl"===g},e.className),[,w]=ai(),k=a.useMemo((()=>void 0!==n?n:w.zIndexPopupBase+kd),[n,w]);return a.createElement(LC,{prefixCls:u,className:Z,wrapClassName:Ie()({["".concat(A,"-centered")]:!!e.centered},d),onCancel:()=>{null===t||void 0===t||t({triggerCancel:!0}),null===b||void 0===b||b(!1)},open:i,title:"",footer:null,transitionName:Vd(h||"","zoom",e.transitionName),maskTransitionName:Vd(h||"","fade",e.maskTransitionName),mask:x,maskClosable:G,style:S,styles:Object.assign({body:p,mask:c},y),width:v,zIndex:k,afterClose:o,keyboard:r,centered:s,getContainer:l,closable:m,closeIcon:I,modalRender:C,focusTriggerAfterClose:f},a.createElement(UC,Object.assign({},e,{confirmPrefixCls:A})))};const OC=e=>{const{rootPrefixCls:t,iconPrefixCls:n,direction:o,theme:i}=e;return a.createElement(ds,{prefixCls:t,iconPrefixCls:n,direction:o,theme:i},a.createElement(PC,Object.assign({},e)))},_C=[];let QC="";function jC(){return QC}const qC=e=>{var t,n;const{prefixCls:o,getContainer:i,direction:r}=e,s=Ji(),l=(0,a.useContext)(Be),c=jC()||l.getPrefixCls(),g=o||"".concat(c,"-modal");let u=i;return!1===u&&(u=void 0),a.createElement(OC,Object.assign({},e,{rootPrefixCls:c,prefixCls:g,iconPrefixCls:l.iconPrefixCls,theme:l.theme,direction:null!==r&&void 0!==r?r:l.direction,locale:null!==(n=null===(t=l.locale)||void 0===t?void 0:t.Modal)&&void 0!==n?n:s,getContainer:u}))};function $C(e){const t=cs();const n=document.createDocumentFragment();let o,i=Object.assign(Object.assign({},e),{close:l,open:!0});function r(){for(var t,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];var r;o.some((e=>null===e||void 0===e?void 0:e.triggerCancel))&&(null===(t=e.onCancel)||void 0===t||(r=t).call.apply(r,[e,()=>{}].concat(Le(o.slice(1)))));for(let e=0;e<_C.length;e++){if(_C[e]===l){_C.splice(e,1);break}}ks(n)}function s(e){clearTimeout(o),o=setTimeout((()=>{const o=t.getPrefixCls(void 0,jC()),i=t.getIconPrefixCls(),r=t.getTheme(),s=a.createElement(qC,Object.assign({},e));xs(a.createElement(ds,{prefixCls:o,iconPrefixCls:i,theme:r},t.holderRender?t.holderRender(s):s),n)}))}function l(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];i=Object.assign(Object.assign({},i),{open:!1,afterClose:()=>{"function"===typeof e.afterClose&&e.afterClose(),r.apply(this,n)}}),i.visible&&delete i.visible,s(i)}return s(i),_C.push(l),{destroy:l,update:function(e){i="function"===typeof e?e(i):Object.assign(Object.assign({},i),e),s(i)}}}function ef(e){return Object.assign(Object.assign({},e),{type:"warning"})}function tf(e){return Object.assign(Object.assign({},e),{type:"info"})}function nf(e){return Object.assign(Object.assign({},e),{type:"success"})}function af(e){return Object.assign(Object.assign({},e),{type:"error"})}function of(e){return Object.assign(Object.assign({},e),{type:"confirm"})}var rf=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const sf=Nd((e=>{const{prefixCls:t,className:n,closeIcon:o,closable:i,type:r,title:s,children:l,footer:c}=e,g=rf(e,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:u}=a.useContext(Be),d=u(),h=t||u("modal"),p=Od(d),[m,I,C]=FC(h,p),f="".concat(h,"-confirm");let b={};return b=r?{closable:null!==i&&void 0!==i&&i,title:"",footer:"",children:a.createElement(UC,Object.assign({},e,{prefixCls:h,confirmPrefixCls:f,rootPrefixCls:d,content:l}))}:{closable:null===i||void 0===i||i,title:s,footer:null!==c&&a.createElement(yC,Object.assign({},e)),children:l},m(a.createElement(kI,Object.assign({prefixCls:h,className:Ie()(I,"".concat(h,"-pure-panel"),r&&f,r&&"".concat(f,"-").concat(r),n,C,p)},g,{closeIcon:bC(h,o),closable:i},b)))}));var lf=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const cf=(e,t)=>{var n,{afterClose:o,config:i}=e,r=lf(e,["afterClose","config"]);const[s,l]=a.useState(!0),[c,g]=a.useState(i),{direction:u,getPrefixCls:d}=a.useContext(Be),h=d("modal"),p=d(),m=function(){var e;l(!1);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var o;n.some((e=>null===e||void 0===e?void 0:e.triggerCancel))&&(null===(e=c.onCancel)||void 0===e||(o=e).call.apply(o,[c,()=>{}].concat(Le(n.slice(1)))))};a.useImperativeHandle(t,(()=>({destroy:m,update:e=>{g((t=>Object.assign(Object.assign({},t),e)))}})));const I=null!==(n=c.okCancel)&&void 0!==n?n:"confirm"===c.type,[C]=Ed("Modal",Ti.Modal);return a.createElement(OC,Object.assign({prefixCls:h,rootPrefixCls:p},c,{close:m,open:s,afterClose:()=>{var e;o(),null===(e=c.afterClose)||void 0===e||e.call(c)},okText:c.okText||(I?null===C||void 0===C?void 0:C.okText:null===C||void 0===C?void 0:C.justOkText),direction:c.direction||u,cancelText:c.cancelText||(null===C||void 0===C?void 0:C.cancelText)},r))},gf=a.forwardRef(cf);let uf=0;const df=a.memo(a.forwardRef(((e,t)=>{const[n,o]=function(){const[e,t]=a.useState([]);return[e,a.useCallback((e=>(t((t=>[].concat(Le(t),[e]))),()=>{t((t=>t.filter((t=>t!==e))))})),[])]}();return a.useImperativeHandle(t,(()=>({patchElement:o})),[]),a.createElement(a.Fragment,null,n)})));const hf=function(){const e=a.useRef(null),[t,n]=a.useState([]);a.useEffect((()=>{if(t.length){Le(t).forEach((e=>{e()})),n([])}}),[t]);const o=a.useCallback((t=>function(o){var i;uf+=1;const r=a.createRef();let s;const l=new Promise((e=>{s=e}));let c,g=!1;const u=a.createElement(gf,{key:"modal-".concat(uf),config:t(o),ref:r,afterClose:()=>{null===c||void 0===c||c()},isSilent:()=>g,onConfirm:e=>{s(e)}});c=null===(i=e.current)||void 0===i?void 0:i.patchElement(u),c&&_C.push(c);const d={destroy:()=>{function e(){var e;null===(e=r.current)||void 0===e||e.destroy()}r.current?e():n((t=>[].concat(Le(t),[e])))},update:e=>{function t(){var t;null===(t=r.current)||void 0===t||t.update(e)}r.current?t():n((e=>[].concat(Le(e),[t])))},then:e=>(g=!0,l.then(e))};return d}),[]);return[a.useMemo((()=>({info:o(tf),success:o(nf),error:o(af),warning:o(ef),confirm:o(of)})),[]),a.createElement(df,{key:"modal-holder",ref:e})]};function pf(e){return $C(ef(e))}const mf=LC;mf.useModal=hf,mf.info=function(e){return $C(tf(e))},mf.success=function(e){return $C(nf(e))},mf.error=function(e){return $C(af(e))},mf.warning=pf,mf.warn=pf,mf.confirm=function(e){return $C(of(e))},mf.destroyAll=function(){for(;_C.length;){const e=_C.pop();e&&e()}},mf.config=function(e){let{rootPrefixCls:t}=e;QC=t},mf._InternalPanelDoNotUseOrYouWillBeFired=sf;const If=mf;const Cf={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"ellipsis",theme:"outlined"};var ff=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:Cf}))};const bf=a.forwardRef(ff),yf=e=>{const[t,n]=(0,a.useState)((()=>JSON.parse(localStorage.getItem("pageState"))||e)),o=(0,a.useRef)(!0);return(0,a.useEffect)((()=>{o.current?o.current=!1:localStorage.setItem("pageState",JSON.stringify(t))}),[t]),[t,n]},{Option:Af}=ym,vf=e=>{let{isVisible:t,showModal:n,handleModalCancel:o}=e;const i=q(),[r,s]=yf({dialogVisible:!1,currentDialogIndex:0}),l=(0,a.useRef)(null),[c,g]=(0,a.useState)(null),u=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;s((e=>({...e,currentDialogIndex:t||e.currentDialogIndex}))),o(),i("/game".concat(e))}),[s,o,i]),d=(0,a.useCallback)((e=>{s((t=>({...t,dialogVisible:!0,currentDialogIndex:e}))),o(),i("/?dialogIndex="+e)}),[s,o,i]),h=(0,a.useCallback)((()=>{localStorage.clear(),s({dialogVisible:!1,currentDialogIndex:0,introVisible:!1,imageVisible:!1,isModalVisible:!1}),pI.success("\u5df2\u6e05\u9664\u7576\u524d\u7d00\u9304"),o(),l.current&&l.current.submit()}),[s,o]);return(0,Cc.jsxs)(Cc.Fragment,{children:[(0,Cc.jsx)("div",{style:{position:"relative",width:"100%",height:"100%"},children:(0,Cc.jsx)(tc,{type:"primary",onClick:n,style:{position:"fixed",top:"2rem",left:"2rem",zIndex:1e3,backgroundColor:"#8b5a2b",borderColor:"#8b5a2b",color:"white"},children:(0,Cc.jsx)(bf,{})})}),(0,Cc.jsxs)(If,{title:"\u9078\u64c7\u95dc\u5361",open:t,onCancel:o,footer:null,children:[(0,Cc.jsxs)(ym,{style:{width:"100%",marginBottom:"1rem"},placeholder:"\u8acb\u9078\u64c7\u95dc\u5361\u6216\u64cd\u4f5c",onChange:e=>g(e),children:[(0,Cc.jsx)(Af,{value:"game:1",children:"\u7b2c\u4e00\u7ae0\uff1a\u723a\u723a\u7684\u820a\u76f8\u6a5f"}),(0,Cc.jsx)(Af,{value:"story:5",children:"\u7b2c\u4e00\u7ae0\u6545\u4e8b-1"}),(0,Cc.jsx)(Af,{value:"game:2",children:"\u7b2c\u4e00\u7ae0\uff1a\u723a\u723a\u7684\u820a\u76f8\u6a5f-2"}),(0,Cc.jsx)(Af,{value:"story:10",children:"\u7b2c\u4e00\u7ae0\u6545\u4e8b-2"}),(0,Cc.jsx)(Af,{value:"game:3",children:"\u7b2c\u4e8c\u7ae0\uff1a\u6d88\u9664\u7a7a\u8972\u8b66\u5831"}),(0,Cc.jsx)(Af,{value:"story:22",children:"\u7b2c\u4e8c\u7ae0\u6545\u4e8b"}),(0,Cc.jsx)(Af,{value:"game:4",children:"\u7b2c\u4e09\u7ae0\uff1a\u807d\u8072\u8fa8\u4f4d"}),(0,Cc.jsx)(Af,{value:"story:37",children:"\u7b2c\u4e09\u7ae0\u6545\u4e8b"}),(0,Cc.jsx)(Af,{value:"game:5",children:"\u7b2c\u56db\u7ae0\uff1aAR\u8fa8\u8b58"}),(0,Cc.jsx)(Af,{value:"story:38",children:"\u7b2c\u56db\u7ae0\u6545\u4e8b"}),(0,Cc.jsx)(Af,{value:"game:6",children:"\u7b2c\u4e94\u7ae0\uff1a\u5c0b\u627e\u5c0f\u5c0f\u6a39\u86d9"}),(0,Cc.jsx)(Af,{value:"story:48",children:"\u7b2c\u4e94\u7ae0\u6545\u4e8b-1"}),(0,Cc.jsx)(Af,{value:"game:7",children:"\u7b2c\u4e94\u7ae0\uff1a\u5c0b\u627e\u90f5\u5dee\u5c0f\u5c0f\u6a39\u86d9\u795e"}),(0,Cc.jsx)(Af,{value:"story:68",children:"\u7b2c\u4e94\u7ae0\u6545\u4e8b-2"})]}),(0,Cc.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[(0,Cc.jsx)(tc,{onClick:h,style:{width:"100%",backgroundColor:"red",color:"white"},children:"\u6e05\u9664\u7d00\u9304"}),(0,Cc.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,Cc.jsx)(tc,{type:"primary",onClick:()=>{if(c){const[e,...t]=c.split(":");"game"===e?u(t[0]):"story"===e&&d(t[0])}},disabled:!c,style:{width:"48%"},children:"\u78ba\u8a8d"}),(0,Cc.jsx)(tc,{onClick:o,style:{width:"48%"},children:"\u53d6\u6d88"})]})]})]}),(0,Cc.jsx)("form",{ref:l,action:"/",method:"GET",style:{display:"none"},children:(0,Cc.jsx)("input",{type:"hidden",name:"reset",value:"true"})})]})},Sf=n.p+"static/media/\u904a\u6232\u958b\u59cb\u4ecb\u9762.a2b7b8a355a0b865f990.png",xf=n.p+"static/media/\u5fd7\u5de5\u963f\u59e81-\u5e38\u99d0\u8868\u60c5.592d34d395329b47e9b5.png",Gf=n.p+"static/media/\u6309\u9215-\u904a\u6232\u958b\u59cb.cab92c0b8a8cc7c60be1.png",Zf=n.p+"static/media/\u963f\u6c111-\u4e00\u822c\u5e38\u99d0\u8868\u60c5.245cc85f58c34988c7fa.png",wf=n.p+"static/media/\u963f\u6c112-\u7591\u554f.7dce17f3f926565a58e3.png",kf=n.p+"static/media/\u963f\u6c113-\u8a8d\u771f.3dbfdce365cfc7548579.png",Bf=n.p+"static/media/\u963f\u6c113-\u8a8d\u771f2.51d344d5baf92dac29a9.png",Rf=n.p+"static/media/\u963f\u6c114-\u9a5a\u8a1d.8ce35967d5aadb6e81df.png",Wf=n.p+"static/media/\u963f\u6c115-\u8208\u596e.a7387ab0cc7af74f7afb.png",Vf=n.p+"static/media/\u963f\u6c116-\u9a5a\u614c\u7dca\u5f35.e025273b5d529cd9161a.png",Nf=n.p+"static/media/\u963f\u6c117-\u5b89\u6170.5710f855555ddd54eb09.png",Xf=n.p+"static/media/\u963f\u516c1-\u4e00\u822c\u5e38\u99d0\u8868\u60c5.cbb7b57c97cc3695cf0d.png",Mf=n.p+"static/media/\u963f\u516c2-\u96e3\u904e.9576b8b0c507fa7b9d70.png",Tf=n.p+"static/media/\u963f\u516c3-\u9a5a\u8a1d.0332255d43f5be768cf2.png",Ef=n.p+"static/media/\u963f\u516c4-\u958b\u5fc3\u7b11.55f28657ffa45dab1359.png",Ff=n.p+"static/media/\u963f\u516c5-\u9a5a\u614c\u7dca\u5f35.152210f0a9edf1320299.png",Hf=n.p+"static/media/\u963f\u516c6-\u5606\u6c23.3ebd5a8be86130c3dfcd.png",Jf=n.p+"static/media/\u90f5\u5dee\u86d9\u86d91-\u5e38\u99d0\u8868\u60c5.e91f508e400169b40d9a.png",Yf=n.p+"static/media/\u90f5\u5dee\u86d9\u86d92-\u7591\u554f.36483f25522e320f468d.png",Lf=n.p+"static/media/\u90f5\u5dee\u86d9\u86d93-\u958b\u5fc3\u7b11.974f95de640bdcab9b7f.png",zf=()=>{const[e,t]=yf({dialogVisible:!1,currentDialogIndex:0,imageVisible:!1,introVisible:!1,isModalVisible:!1}),{dialogVisible:n,currentDialogIndex:o,imageVisible:i,introVisible:r,isModalVisible:s}=e,l=Q(),c=q(),g=(0,a.useCallback)((()=>{const e=new URLSearchParams(window.location.search),n=e.get("dialogIndex");if("true"===e.get("reset"))t({dialogVisible:!1,currentDialogIndex:0,imageVisible:!1,introVisible:!1,isModalVisible:!1}),localStorage.clear();else if(null!==n){const e=parseInt(n,10);t((t=>({...t,dialogVisible:!0,currentDialogIndex:e})))}window.history.replaceState({},document.title,window.location.pathname)}),[t,l.search]);(0,a.useEffect)((()=>{g()}),[g]);const u=[{title:"\u65c1\u767d",content:"\u6709\u4e00\u5929\uff0c\u963f\u6c11\u63a5\u5230\u4e86\u6d3b\u52d5\u4e2d\u5fc3\u5fd7\u5de5\u7684\u96fb\u8a71"},{title:"\u5fd7\u5de5",content:"\u300c\u552f\uff1f\u963f\u6c11\u963f\uff0c\u4f60\u963f\u516c\u4e4b\u524d\u653e\u5728\u6d3b\u52d5\u4e2d\u5fc3\u7684\u6771\u897f\uff0c\u8981\u8a18\u5f97\u904e\u4f86\u62ff\u5594\uff01\u300d",imageUrl:xf},{title:"\u963f\u6c11",content:"\u300c\u597d\u7684\u3002\u6211\u7b49\u7b49\u548c\u963f\u516c\u4e00\u8d77\u904e\u53bb\u6536\u62fe\u3002\u300d",imageUrl:Zf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u6211\u5011\u53bb\u6d3b\u52d5\u4e2d\u5fc3\u5427\uff1f\u300d",imageUrl:Zf},{title:"\u963f\u6c11",content:"\u300c\u963f\u6c11\uff0c\u4f60\u5011\u4f86\u4e86\u963f\u3002\u723a\u723a\u7684\u6771\u897f\u61c9\u8a72\u5728\u90a3\u6ac3\u5b50\u9644\u8fd1\uff0c\u4f60\u53ef\u4ee5\u627e\u627e\u770b\u3002 \u300d",imageUrl:xf},{title:"\u963f\u6c11",content:"\u5728\u6ac3\u5b50\u9644\u8fd1\u627e\u5230\u4e00\u500b\u820a\u7bb1\u5b50\uff0c\u88e1\u9762\u7ffb\u51fa\u4e86\u4e00\u53f0\u597d\u7834\u820a\u7684\u76f8\u6a5f\u548c\u5fa1\u5b88!"},{title:"\u963f\u6c11",content:"\u300c\u9019\u662f\u8ab0\u7684\u76f8\u6a5f\u5440\uff1f\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u9019\u662f\u4f60\u963f\u7956\u9001\u7d66\u6211\u7684\u76f8\u6a5f\uff0c\u90a3\u53ef\u662f\u963f\u516c\u7684\u5bf6\u8c9d\u5462\uff0c\u53ef\u60dc\u5b83\u73fe\u5728\u58de\u6389\u4e86...\u300d",imageUrl:Mf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u6216\u8a31\u6211\u5011\u53ef\u4ee5\u8a66\u8457\u4fee\u597d\u5b83\uff0c\u518d\u4e00\u8d77\u62cd\u4e0b\u66f4\u591a\u7684\u7167\u7247\u3002\u300d",imageUrl:kf},{title:"\u65c1\u767d",content:"\u6211\u5011\u73fe\u5728\u4e00\u8d77\u4f86\u5e6b\u963f\u516c\u628a\u76f8\u6a5f\u4fee\u597d\u5427!"},{title:"\u65c1\u767d",content:"\u628a\u76f8\u6a5f\u4fee\u597d\u5f8c\uff0c\u6211\u5011\u5c0d\u8457\u6d3b\u52d5\u4e2d\u5fc3\u7684\u7246\u4e0a\u62cd\u7167\u6e2c\u8a66\u770b\u770b\uff0c\u76f8\u6a5f\u5580\u64e6\u4e00\u8072...\u3002"},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c!\u9019...\u9019\u5f35\u7167\u7247...\u7684\u6d3b\u52d5\u4e2d\u5fc3...\u770b\u8d77\u4f86\u8ddf\u73fe\u5728\u4e0d\u4e00\u6a23\u8bf6?!\u300d",imageUrl:Rf},{title:"\u963f\u516c",content:"\u300c\u5594?\u9019...\u662f\u6211\u9084\u5e74\u8f15\u7684\u6642\u5019!\u6d3b\u52d5\u4e2d\u5fc3\u7684\u6a23\u5b50\u8bf6!\u300d",imageUrl:Tf},{title:"\u963f\u516c",content:"\u300c\u4f60\u770b\u5728\u7246\u4e0a\u756b\u6c34\u5e73\u7dda\u7684\u7537\u751f\u5c31\u662f\u6211\u554a~\u300d",imageUrl:Ef},{title:"\u65c1\u767d",content:"\u963f\u6c11\u89ba\u5f97\u4e0d\u53ef\u601d\u8b70\uff0c\u767c\u73fe\u539f\u4f86\u7528\u9019\u53f0\u76f8\u6a5f\u5c0d\u6e96\u7279\u5b9a\u7684\u5730\u65b9\uff0c\u6703\u51fa\u73fe\u963f\u516c\u4ee5\u524d\u7684\u8a18\u61b6\u3002"},{title:"\u65c1\u767d",content:"\u9019\u8b93\u963f\u6c11\u7684\u597d\u5947\u5fc3\u589e\u52a0\uff0c\u60f3\u62ff\u8457\u9019\u53f0\u76f8\u6a5f\u5230\u793e\u5340\u63a2\u96aa\u3002"},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u6211\u5011\u53ef\u4ee5\u4e00\u8d77\u53bb\u793e\u5340\u8d70\u8d70\u62cd\u7167\u55ce?\u300d",imageUrl:Zf},{title:"\u963f\u516c",content:"\u300c\u597d\u554a\u300d",imageUrl:Ef},{title:"\u963f\u6c11",content:"\u300cYA!\u8d70\u56c9!\u51fa\u767c\u53bb\u63a2\u96aa\u4e86\u5594!\u300d",imageUrl:Wf},{title:"\u65c1\u767d",content:"\u525b\u8d70\u5230\u9644\u8fd1\uff0c\u76f8\u6a5f\u50b3\u51fa\u4e86\u7a7a\u8972\u8b66\u5831\u7684\u8072\u97f3\u3002"},{title:"\u963f\u6c11",content:"\u300c\u9019\u662f\u751a\u9ebc\u8072\u97f3?!\u300d",imageUrl:Vf},{title:"\u963f\u516c",content:"\u300c\u5feb\uff01\u5feb\u5230\u9632\u7a7a\u6d1e\u8eb2\u8d77\u4f86\u963f\uff01\u300d",imageUrl:Ff},{title:"\u963f\u516c",content:"\u300c\u4ee5\u524d\u6211\u5011\u7d93\u5e38\u8981\u8eb2\u5728\u9019\u88e1\uff0c\u90a3\u6642\u5019\u4e8c\u6b21\u4e16\u754c\u5927\u6230\u3002\u300d",imageUrl:Hf},{title:"\u963f\u516c",content:"\u300c\u56e0\u70ba\u6211\u5011\u7684\u9019\u7cd6\u5ee0\u9644\u8fd1\u6709\u9152\u7cbe\u5de5\u5ee0\uff0c\u4ee5\u63d0\u7149\u9152\u7cbe\u5145\u7576\u66ff\u4ee3\u71c3\u6599\uff0c\u7d93\u5e38\u6210\u70ba\u7f8e\u8ecd\u7a7a\u8972\u7684\u9996\u8981\u76ee\u6a19\u4e4b\u4e00\u3002\u300d",imageUrl:Hf},{title:"\u963f\u516c",content:"\u300c\u6240\u4ee5\u7576\u6642\u7684\u6211\u5011\u4e00\u807d\u5230\u7a7a\u8972\u8b66\u5831\u5c31\u8981\u8d95\u5feb\u8eb2\u5230\u9632\u7a7a\u6d1e\u88e1\u3002\u300d",imageUrl:Hf},{title:"\u963f\u516c",content:"\u300c\u7576\u6642\u65e5\u672c\u4eba\u9084\u5728\u9019\u88e1\u6210\u7acb\u4e86\u300e\u63d0\u65b0\u968a\u300f\u5c08\u9580\u6559\u5c0e\u6211\u5011\u9047\u5230\u7a7a\u8972\u61c9\u8a72\u600e\u9ebc\u505a\u300d",imageUrl:Hf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\u6c92\u4e8b\u4e86\uff0c\u6211\u5011\u73fe\u5728\u5f88\u5e73\u5b89\u3002\u300d",imageUrl:Nf},{title:"\u76f8\u6a5f",content:"\u300c\u8d70\u5230\u7cd6\u5ee0\u5bbf\u820d\u5f8c\uff0c\u76f8\u6a5f\u7a81\u7136\u64ad\u653e\u51fa\u4e86\u4e00\u6bb5\u9304\u97f3..."},{title:"\u963f\u6c11",content:"\u300c\u9019\u662f\u4ec0\u9ebc\u8072\u97f3\u5440\uff1f\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u9019\u8072\u97f3...\u597d\u719f\u6089\u300d",imageUrl:Xf},{title:"\u963f\u6c11",content:"\u300c\u9019\u4e9b\u8072\u97f3...\u90fd\u597d\u50cf\u662f\u95dc\u65bc\u7cd6\u5ee0\u548c\u795e\u793e\u7684\u8072\u97f3\u8bf6?\u300d",imageUrl:Rf},{title:"\u963f\u516c",content:"\u300c\u54c8\u54c8\u5c0d\u5566! \u9019\u4e9b\u8072\u97f3\uff0c\u90fd\u662f\u6211\u5e74\u8f15\u6642\u5728\u7cd6\u5ee0\u5de5\u4f5c\u7684\u65e5\u5b50\u88e1\u7d93\u5e38\u807d\u5230\u7684\u3002\u300d",imageUrl:Ef},{title:"\u963f\u6c11",content:"\u300c\u5594?\u90a3\u76f8\u6a5f\u600e\u9ebc\u6703\u64a5\u653e\u51fa\u9019\u4e9b\u9304\u97f3\u5462?\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u6216\u8a31...\u53ef\u80fd\u60f3\u544a\u8a34\u6211\u5011\u4ec0\u9ebc?\u300d",imageUrl:Xf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u6211\u5011\u80fd\u4e0d\u80fd\u627e\u5230\u7cd6\u5ee0\u7684\u5730\u5716\uff0c\u770b\u770b\u80fd\u4e0d\u80fd\u6839\u64da\u9019\u4e9b\u8072\u97f3\u627e\u5230\u76f8\u95dc\u7684\u5730\u9ede\uff1f\u300d",imageUrl:Zf},{title:"\u963f\u516c",content:"\u300c\u597d\u4e3b\u610f\uff01\u6211\u5011\u53bb\u627e\u627e\u770b\u3002\u300d",imageUrl:Xf},{title:"\u65c1\u767d",content:"\u963f\u6c11\u62ff\u8d77\u5148\u524d\u5728\u6d3b\u52d5\u4e2d\u5fc3\u627e\u5230\u4e86\u7cd6\u5ee0\u7684\u5730\u5716\u4e26\u4ed4\u7d30\u5730\u67e5\u770b\u3002\u6839\u64da\u76f8\u6a5f\u64ad\u653e\u7684\u8072\u97f3\u627e\u5230\u4e86\u76f8\u5c0d\u61c9\u7684\u5730\u9ede\uff0c\u4e26\u767c\u73fe\u5230..."},{title:"\u963f\u6c11",content:"\u300c\u6211\u5011\u8d70\u5230\u4e86\u624b\u6c34\u820d\u65c1\u5f8c\uff0c\u4e26\u5c0d\u8457\u624b\u6c34\u820d\u6383\u63cf\u62cd\u7167\u5f8c\u624d\u767c\u73fe..\u300d",imageUrl:Zf},{title:"\u963f\u6c11",content:"\u300c\u539f\u4f86\uff0c\u624b\u6c34\u820d\u662f\u6d17\u624b\u53f0\u7684\u610f\u601d\u554a\u300d",imageUrl:Zf},{title:"\u963f\u516c",content:"\u300c\u54c8\u54c8\u5c0d\u963f\uff0c\u6709\u8da3\u5427~\u90a3\u662f\u90a3\u500b\u6642\u4ee3\u7684\u5ff5\u6cd5\u3002\u300d",imageUrl:Ef},{title:"\u963f\u516c",content:"\u300c\u4ee5\u524d\u5728\u7cd6\u5ee0\u5de5\u4f5c\u7684\u6642\u5019\u554a\uff0c\u56e0\u70ba\u8981\u642c\u904b\u7518\u8517\u904e\u53bb\uff0c\u6bcf\u6b21\u5728\u5927\u592a\u967d\u5e95\u4e0b\u904b\u7518\u8517\u543c\uff0c\u90fd\u6eff\u8eab\u6c57\u3002\u300d",imageUrl:Ef},{title:"\u963f\u516c",content:"\u300c\u6211\u5011\u5c31\u5728\u9019\u9644\u8fd1\u73a9\u76f8\u64b2\uff0c\u73a9\u76e1\u8208\u4e86\u518d\u5230\u624b\u6c34\u820d\u9019\u908a\u6d17\u6fa1\u3002\u300d",imageUrl:Ef},{title:"\u963f\u6c11",content:"\u300c\u6b38\uff1f\u9019\u4e9b\u7167\u7247\u22ef\u597d\u50cf\u90fd\u6709\u4e00\u96bb\u5c0f\u5c0f\u7684\u6a39\u86d9\u300d",imageUrl:wf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u60a8\u77e5\u9053\u7942\u5011\u70ba\u4ec0\u9ebc\u51fa\u73fe\u5728\u7167\u7247\u88e1\u9762\u55ce\uff1f\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u90a3\u662f\u6a39\u86d9\u795e\uff0c\u7942\u5011\u5728\u6211\u5e74\u8f15\u6642\u5c31\u51fa\u73fe\u5728\u6211\u5011\u7684\u751f\u6d3b\u4e2d\u4e86\uff0c\u6211\u60f3\u5b83\u5011\u53ef\u80fd\u6709\u7279\u5225\u7684\u610f\u7fa9\u3002\u300d",imageUrl:Ef},{title:"\u963f\u6c11",content:"\u300c\u6a39\u86d9\u795e\uff1f\uff01\u807d\u8d77\u4f86\u5f88\u9177\u6b38\u3002\u963f\u516c\uff0c\u6211\u5011\u80fd\u4e0d\u80fd\u53bb\u627e\u627e\u770b\u6a39\u86d9\u795e\u51fa\u73fe\u7684\u5730\u65b9\u5462\uff1f\u300d",imageUrl:Zf},{title:"\u963f\u516c",content:"\u300c\u6211\u8a18\u5f97\u7942\u5011\u7d93\u5e38\u51fa\u73fe\u5728\u795e\u793e\u9644\u8fd1\uff0c\u6216\u8a31\u6211\u5011\u53ef\u4ee5\u53bb\u90a3\u88e1\u770b\u770b\u3002\u300d\u963f\u6c11\u9ad8\u8208\u5730\u8aaa\uff1a\u300c\u90a3\u6211\u5011\u73fe\u5728\u5c31\u53bb\u795e\u793e\u5427\uff01\u300d",imageUrl:Xf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u5c31\u662f\u90a3\u500b\u6a39\u86d9\u795e\uff01\u7942\u548c\u7167\u7247\u4e0a\u7684\u6a39\u86d9\u795e\u9577\u5f97\u4e00\u6a21\u4e00\u6a23\uff01\u300d",imageUrl:Wf},{title:"\u963f\u516c",content:"\u300c\u770b\u4f86\u6a39\u86d9\u795e\u771f\u7684\u5728\u4fdd\u8b77\u6211\u5011\uff0c\u5b83\u5011\u53ef\u80fd\u5e0c\u671b\u6211\u5011\u80fd\u5230\u795e\u793e\u4f86\uff0c\u4e86\u89e3\u66f4\u591a\u7684\u6545\u4e8b\u3002\u300d",imageUrl:Xf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u795e\u793e\u88e1\u6709\u4ec0\u9ebc\u6545\u4e8b\u6216\u50b3\u8aaa\u55ce\uff1f\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u7576\u7136\u6709\uff0c\u6a39\u86d9\u795e\u4e0d\u53ea\u662f\u795e\u793e\u7684\u5b88\u8b77\u795e\uff0c\u66f4\u662f\u6211\u5011\u4e09\u6c11\u793e\u5340\u7684\u5b88\u8b77\u795e\u3002\u7942\u5011\u7d93\u5e38\u4fdd\u8b77\u8457\u6211\u5011\u7684\u5bb6\u9109\u7684\u9019\u7247\u571f\u5730\u3002\u300d",imageUrl:Xf},{title:"\u963f\u516c",content:"\u300c\u6211\u5e74\u8f15\u6642\uff0c\u6bcf\u6b21\u9762\u5c0d\u56f0\u96e3\u6216\u9700\u8981\u5e6b\u52a9\u6642\uff0c\u6211\u90fd\u6703\u5230\u795e\u793e\u4f86\u53c3\u62dc\uff0c\u800c\u6a39\u86d9\u795e\u7e3d\u662f\u6703\u8eb2\u5728\u9644\u8fd1\u7d66\u6211\u529b\u91cf\u548c\u4fdd\u8b77\u3002\u300d",imageUrl:Xf},{title:"\u963f\u6c11",content:"\u300c\u90a3\u6a39\u86d9\u795e\u662f\u600e\u9ebc\u4fdd\u8b77\u5bb6\u9109\u7684\u5462\uff1f\u5b83\u5011\u6709\u4ec0\u9ebc\u7279\u5225\u7684\u80fd\u529b\u55ce\uff1f\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u7942\u5011\u5c31\u50cf\u662f\u56db\u8449\u5e78\u904b\u8349\u4e00\u6a23\u7684\u89d2\u8272\uff0c\u662f\u5bb6\u9109\u7684\u5b88\u8b77\u8005\u3002\u300d",imageUrl:Xf},{title:"\u963f\u516c",content:"\u300c\u5982\u679c\u4f60\u5728\u56f0\u5883\u4e2d\u770b\u5230\u6a39\u86d9\u795e\uff0c\u90a3\u5c31\u662f\u4e00\u500b\u5f88\u597d\u7684\u8c61\u5fb5\uff0c\u5b83\u5011\u6703\u7d66\u4e88\u4f60\u529b\u91cf\u548c\u5e0c\u671b\uff0c\u8b93\u4f60\u514b\u670d\u56f0\u96e3\u3002\u300d",imageUrl:Xf},{title:"\u963f\u6c11",content:"\u300c\u771f\u7684\u55ce\uff1f\u6211\u4e5f\u60f3\u9047\u5230\u6a39\u86d9\u795e\uff0c\u6211\u5011\u80fd\u600e\u9ebc\u6a23\u8b93\u7942\u5011\u51fa\u73fe\u5462\uff1f\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u53ea\u8981\u6211\u5011\u5fc3\u4e2d\u771f\u8aa0\u5730\u5e0c\u671b\uff0c\u4e26\u4e14\u5c0a\u91cd\u9019\u7247\u571f\u5730\u548c\u81ea\u7136\uff0c\u6a39\u86d9\u795e\u5c31\u6703\u51fa\u73fe\u5728\u6211\u5011\u7684\u751f\u6d3b\u4e2d\u3002\u300d",imageUrl:Ef},{title:"\u963f\u516c",content:"\u300c\u73fe\u5728\u6211\u5011\u5df2\u7d93\u770b\u5230\u7942\u5011\u5728\u7167\u7247\u88e1\u51fa\u73fe\u4e86\uff0c\u4e0d\u904e\u5982\u679c\u4f60\u771f\u5fc3\u5730\u60f3\u8981\u8207\u7942\u5011\u4e92\u52d5\u7684\u8a71\uff0c\u53ef\u4ee5\u7d93\u5e38\u5230\u795e\u793e\u8d70\u8d70\u3002\u300d",imageUrl:Ef},{title:"\u963f\u516c",content:"\u300c\u6216\u662f\u5728\u5bb6\u9109\u7684\u81ea\u7136\u4e2d\u8207\u5927\u81ea\u7136\u5171\u9cf4\uff0c\u4e5f\u8a31\u4f60\u6703\u6709\u6a5f\u6703\u9047\u5230\u5b83\u5011\u3002\u300d",imageUrl:Ef},{title:"\u963f\u516c",content:"\u300c\u4f60\u77e5\u9053\u55ce\uff0c\u4ee5\u524d\u795e\u793e\u524d\u9762\u6709\u4e00\u9593\u5c0f\u90f5\u5c40\uff0c\u6211\u5011\u7d93\u5e38\u5728\u90a3\u88e1\u5bc4\u4fe1\u548c\u6536\u4fe1\u3002\u300d",imageUrl:Xf},{title:"\u963f\u6c11",content:"\u300c\u90f5\u5c40\uff1f\u300d",imageUrl:wf},{title:"\u963f\u516c",content:"\u300c\u5509~\u5c0d\u5440\uff0c\u4e0d\u904e\u524d\u5e7e\u5e74\uff0c\u90a3\u5c0f\u5c0f\u7684\u90f5\u5c40\u88ab\u62c6\u9664\u4e86\uff0c\u5c31\u5269\u73fe\u5728\u9019\u7247\u7a7a\u5730...\u300d",imageUrl:Hf},{title:"\u963f\u516c",content:"\u300c\u8981\u662f\u6709\u597d\u597d\u4fdd\u5b58\u9019\u4e9b\u5efa\u7bc9\u53ca\u6ef4\u6ef4\u9ede\u9ede\u7684\u56de\u61b6\uff0c\u8a72\u6709\u591a\u597d...\u300d",imageUrl:Hf},{title:"\u65c1\u767d",content:"\u5c0f\u6a39\u86d9\u795e\u597d\u50cf\u807d\u898b\u4e86\u9019\u500b\u5fc3\u9858\uff0c\u65bc\u662f\u51fa\u73fe\u4e86\u8a31\u591a\u5c0f\u5c0f\u6a39\u86d9\u795e\u3002"},{title:"\u963f\u6c11",content:"\u300c\u54c7\uff5e\u600e\u9ebc\u7a81\u7136\u51fa\u73fe\u597d\u591a\u5c0f\u6a39\u86d9\u795e\uff1f\u800c\u4e14\u6bcf\u500b\u6a23\u5b50\u53c8\u6709\u9ede\u4e0d\u4e00\u6a23\u6b38\uff1f\u300d",imageUrl:Bf},{title:"\u963f\u516c",content:"\u300c\u6216\u8a31\u9019\u4e9b\u6a39\u86d9\u795e\u60f3\u8981\u5e36\u9818\u6211\u5011\u627e\u56de\u90a3\u4e9b\u904e\u53bb\u7684\u56de\u61b6?\u300d",imageUrl:Tf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u6211\u5011\u8ddf\u8457\u5c0f\u6a39\u86d9\u795e\u5011\u53bb\u770b\u770b\u5427\uff01\u300d",imageUrl:Wf},{title:"\u963f\u516c",content:"\u300c\u597d\u554a\u3002\u300d",imageUrl:Xf},{title:"\u65c1\u767d",content:"\u963f\u6c11\u8ddf\u8457\u9019\u4e9b\u6a39\u86d9\u795e\u5728\u795e\u793e\u524d\u7684\u7a7a\u5730\u4e0a\u8d70\u8457\uff0c\u767c\u73fe\u6bcf\u96bb\u6a39\u86d9\u795e\u90fd\u6709\u8457\u7368\u7279\u7684\u7279\u5fb5\u548c\u8868\u60c5\u3002"},{title:"\u65c1\u767d",content:"\u4ed6\u5011\u5faa\u8457\u9019\u4e9b\u6a39\u86d9\u795e\u7684\u5f15\u5c0e\uff0c\u6f38\u6f38\u8d70\u5230\u90f5\u5c40\u820a\u5740\u7684\u4e2d\u5fc3\u3002"},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u770b\u90a3\u908a\uff0c\u90a3\u4e00\u5b9a\u5c31\u662f\u6211\u5011\u8981\u627e\u7684\u90f5\u5dee\u6a39\u86d9\u795e\uff01\u300d",imageUrl:Wf},{title:"\u90f5\u5dee\u5c0f\u5c0f\u6a39\u86d9\u795e",content:"\u300c\u4f60\u5011\u662f\u4f86\u5bc4\u4fe1\u7684\u55ce\uff1f\u300d",imageUrl:Jf},{title:"\u963f\u6c11",content:"\u300c\u6a39\u86d9\u795e\u22ef\u7adf\u7136\u6703\u8b1b\u8a71\uff1f!\u300d",imageUrl:Zf},{title:"\u90f5\u5dee\u5c0f\u5c0f\u6a39\u86d9\u795e",content:"\u300c\u5443\u22ef\u5c0d\u3002\u6211\u6703\u8b1b\u8a71\u22ef\u554a\u4f60\u5011\u662f\u8981\u4f86\u5bc4\u4fe1\u7684\u55ce\uff1f\u300d",imageUrl:Yf},{title:"\u963f\u6c11",content:"\u300c\u4e0d\u662f\u6b38\u22ef\u6211\u5011\u5176\u5be6\u662f\u56e0\u70ba\u9019\u53f0\u76f8\u6a5f\u62cd\u7684\u7167\u7247\u767c\u73fe\u6709\u5c0f\u5c0f\u6a39\u86d9\u795e\u7136\u5f8c\u77e5\u9053\u795e\u793e\u9019\u908a\u5176\u5be6\u6709\u90f5\u5c40\u624d\u610f\u5916\u627e\u5230\u4f60\u7684\u22ef\u300d",imageUrl:wf},{title:"\u90f5\u5dee\u5c0f\u5c0f\u6a39\u86d9\u795e",content:"\u300c\u5594\uff1f\u807d\u8d77\u4f86\u662f\u4e00\u5834\u5f88\u6709\u8da3\u7684\u5192\u96aa\u22ef\u300d",imageUrl:Lf},{title:"\u90f5\u5dee\u5c0f\u5c0f\u6a39\u86d9\u795e",content:"\u300c\u4e0d\u904e\u7adf\u7136\u4f60\u5011\u90fd\u9019\u5011\u8a8d\u771f\u627e\u5230\u6211\u4e86\uff0c\u90a3\u6211\u5c31\u5e6b\u4f60\u5011\u6eff\u8db3\u4e00\u500b\u9858\u671b\u5427\u3002\u4f60\u5011\u6709\u4ec0\u9ebc\u5fc3\u9858\u55ce?\u300d",imageUrl:Lf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u6a39\u86d9\u795e\u8aaa\u4ed6\u53ef\u4ee5\u5e6b\u52a9\u6211\u5011\u5be6\u73fe\u4e00\u500b\u9858\u671b\u8bf6\uff01\u60a8\u60f3\u8981\u8a31\u4ec0\u9ebc\u9858\u671b\u5462?\u300d",imageUrl:Wf},{title:"\u963f\u516c",content:"\u300c\u5728\u9019\u88e1\u5ea6\u904e\u9019\u9ebc\u4e45\u7684\u6642\u5149...\u8a31\u591a\u4e8b\u7269\u65e9\u5df2\u7269\u662f\u4eba\u975e...\u300d",imageUrl:Hf},{title:"\u963f\u516c",content:"\u300c\u6211\u60f3\u6211\u7684\u5fc3\u9858...\u61c9\u8a72\u662f\u80fd\u5728\u7cd6\u5ee0\u9084\u5728\u7684\u6642\u5019\uff0c\u518d\u4f86\u795e\u793e\u9019\u908a\u770b\u770b\uff0c\u518d\u5230\u90f5\u5c40\u9019\u908a\u5bc4\u4fe1\u5427...\u300d",imageUrl:Hf},{title:"\u963f\u516c",content:"\u300c\u53ef\u60dc\u963f...\u65e9\u4e00\u770b\u4e0d\u898b\u90a3\u5fc3\u4e2d\u6700\u61f7\u5ff5\u7684\u666f\u8272\u4e86...\u300d",imageUrl:Hf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c...\u96d6\u7136\u6211\u5011\u6c92\u8fa6\u6cd5\u56de\u5230\u90a3\u500b\u5e74\u4ee3\u53bb\u6b23\u8cde\u7cd6\u5ee0\u8208\u76db\u7684\u6a23\u8c8c\uff0c\u4e0d\u904e\u6211\u5011\u53ef\u4ee5\u5728\u9019\u5730\u65b9\u62cd\u5f35\u7167\u7247\u3002\u300d",imageUrl:Bf},{title:"\u963f\u6c11",content:"\u300c\u6211\u5011\u7684\u5fc3\u4e2d\u4f9d\u7136\u6703\u7559\u4f5c\u7f8e\u9e97\u7d00\u5ff5\uff0c\u8b93\u9019\u500b\u7279\u5225\u7684\u6642\u523b\u6c38\u9060\u4fdd\u5b58\u4e0b\u4f86\u3002\u300d",imageUrl:Bf},{title:"\u65c1\u767d",content:"\u963f\u6c11\u8207\u963f\u516c\u7ad9\u5728\u90f5\u5dee\u5c0f\u6a39\u86d9\u65c1\u908a\uff0c\u963f\u516c\u62ff\u8d77\u76f8\u6a5f\uff0c\u6309\u4e0b\u4e86\u5feb\u9580\u3002"},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff0c\u4f60\u770b\uff01\u7167\u7247\u4e0a\u6709\u60a8\u4e4b\u524d\u7684\u53bb\u904e\u7684\u90f5\u5c40\u8ddf\u795e\u793e\u6b38\u3002\u300d",imageUrl:Rf},{title:"\u963f\u516c",content:"\u300c\u771f\u7684\u662f\u8bf6!\u9019\u5f35\u7167\u7247\u771f\u7684\u5f88\u7279\u5225\uff0c\u611f\u89ba\u5c31\u50cf\u56de\u5230\u4e86\u904e\u53bb\u3002\u8b1d\u8b1d\u4f60\u5011\u8b93\u6211\u627e\u56de\u9019\u4e9b\u7f8e\u597d\u6642\u5149\u3002\u300d",imageUrl:Ef},{title:"\u90f5\u5dee\u5c0f\u6a39\u86d9\u795e",content:"\u300c\u5e0c\u671b\u4f60\u5011\u80fd\u5920\u6c38\u9060\u73cd\u60dc\u56de\u61b6\uff0c\u4e26\u4e00\u540c\u5b88\u8b77\u9019\u500b\u5bb6\u5712\u3002\u300d",imageUrl:Lf},{title:"\u7167\u7247",content:"\u300c\u4f60\u8981\u548c\u6211\u5011\u4e00\u8d77\u5b88\u8b77\u9019\u500b\u5bb6\u5712\u55ce\uff1f\u300d"},{title:"\u963f\u516c",content:"\u300c\u770b\u4f86\u6a39\u86d9\u795e\u4e5f\u60f3\u8b93\u4f60\u53c3\u8207\u9019\u5b88\u8b77\u5bb6\u9109\u7684\u4f7f\u547d\uff0c\u4f60\u600e\u9ebc\u60f3\uff1f\u300d",imageUrl:Ef},{title:"\u963f\u6c11",content:"\u300c\u7576\u7136\u8981\u554a!\u300d",imageUrl:Bf},{title:"\u963f\u6c11",content:"\u300c\u963f\u516c\uff01\u6211\u4e5f\u60f3\u8981\u5b88\u8b77\u9019\u7247\u7f8e\u597d\u7684\u5bb6\u5712\uff0c\u8b93\u5b83\u7e7c\u7e8c\u5145\u6eff\u56de\u61b6\u548c\u6545\u4e8b\u3002\u300d",imageUrl:Bf},{title:"\u90f5\u5dee\u5c0f\u6a39\u86d9\u795e",content:"\u300c\u5f88\u9ad8\u8208\u4f60\u9858\u610f\u52a0\u5165\u6211\u5011\uff0c\u4e00\u8d77\u5b88\u8b77\u4e09\u6c11\u793e\u5340\u3002\u300d",imageUrl:Lf},{title:"\u65c1\u767d",content:"\u6700\u7d42\uff0c\u963f\u6c11\u548c\u963f\u516c\u4ee5\u53ca\u90f5\u5dee\u5c0f\u6a39\u86d9\u795e\u4e00\u540c\u7ad9\u5728\u795e\u793e\u524d\u7684\u7a7a\u5730\u4e0a\uff0c\u4ed6\u5011\u7684\u5fc3\u5145\u6eff\u4e86\u5c0d\u5bb6\u5712\u7684\u71b1\u611b\u548c\u5c0d\u672a\u4f86\u7684\u671f\u5f85\u3002"},{title:"\u65c1\u767d",content:"\u4ed6\u5011\u77e5\u9053\uff0c\u5373\u4f7f\u6642\u5149\u6d41\u8f49\uff0c\u5bb6\u5712\u7684\u98a8\u666f\u4e5f\u8a31\u6703\u6539\u8b8a\uff0c\u4f46\u90a3\u4e9b\u73cd\u8cb4\u7684\u56de\u61b6\u548c\u6545\u4e8b\u5c07\u6c38\u9060\u5728\u5fc3\u4e2d\u7559\u5b58\u3002"},{title:"\u65c1\u767d",content:"\u963f\u6c11\u62ff\u8457\u7167\u7247\uff0c\u5fc3\u4e2d\u5145\u6eff\u611f\u6168\uff0c\u4ed6\u6df1\u6df1\u5730\u660e\u767d\u5230\uff0c\u5b88\u8b77\u5bb6\u5712\u4e0d\u50c5\u50c5\u662f\u4fdd\u8b77\u571f\u5730\uff0c\u66f4\u662f\u73cd\u60dc\u56de\u61b6\u3001\u50b3\u627f\u6587\u5316\u7684\u91cd\u8981\u4f7f\u547d\u3002"},{title:"\u65c1\u767d",content:"\u4ed6\u6c7a\u5fc3\u8981\u8207\u963f\u516c\u548c\u6a39\u86d9\u795e\u4e00\u540c\u52aa\u529b\uff0c\u8b93\u9019\u7247\u5bb6\u5712\u5145\u6eff\u611b\u548c\u6eab\u99a8\uff0c\u6210\u70ba\u5c6c\u65bc\u6bcf\u500b\u4eba\u5fc3\u4e2d\u7684\u6a02\u571f\u3002"},{title:"\u65c1\u767d",content:"\u6545\u4e8b\u7684\u5c3e\u8072\uff0c\u4ed6\u5011\u4e00\u8d77\u8d70\u51fa\u4e86\u795e\u793e\uff0c\u5c55\u671b\u8457\u672a\u4f86\uff0c\u6e96\u5099\u8fce\u63a5\u65b0\u7684\u5192\u96aa\u548c\u6311\u6230\u3002"},{title:"\u65c1\u767d",content:"\u800c\u5728\u4ed6\u5011\u8eab\u5f8c\uff0c\u6a39\u86d9\u795e\u5011\u975c\u975c\u5730\u5b88\u8b77\u8457\u9019\u7247\u571f\u5730\uff0c\u70ba\u4ed6\u5011\u7684\u4f7f\u547d\u9ed8\u9ed8\u5730\u5b88\u8b77\u8457\u5bb6\u5712\u7684\u6bcf\u4e00\u5bf8\u571f\u5730\u548c\u6bcf\u4e00\u4efd\u56de\u61b6\u3002"}],d=(0,a.useCallback)((e=>{t((t=>({...t,currentDialogIndex:e})))}),[t]);(0,a.useEffect)((()=>{const e=new URLSearchParams(l.search).get("dialogIndex");null!==e&&t((t=>({...t,dialogVisible:!0,currentDialogIndex:parseInt(e,10)})))}),[l.search]),(0,a.useEffect)((()=>{n&&window.history.pushState(null,"","?dialogIndex=".concat(o))}),[o,n]);const h=(0,a.useCallback)((()=>{t((e=>({...e,introVisible:!0})))}),[t]),p=(0,a.useCallback)((()=>{t((e=>({...e,introVisible:!1,dialogVisible:!0,imageVisible:!0})))}),[t]),m=(0,a.useCallback)((()=>{t((e=>({...e,dialogVisible:!1,currentDialogIndex:0,imageVisible:!1}))),c("/")}),[t,c]),I=(0,a.useCallback)((()=>{o>0&&t((e=>({...e,currentDialogIndex:e.currentDialogIndex-1})))}),[o,t]),C=(0,a.useCallback)((()=>{o<u.length-1&&t((e=>({...e,currentDialogIndex:e.currentDialogIndex+1})))}),[o,u.length,t]),f=(0,a.useCallback)((()=>{t((e=>({...e,isModalVisible:!0})))}),[t]),b=(0,a.useCallback)((()=>{t((e=>({...e,isModalVisible:!1})))}),[t]);return(0,Cc.jsxs)("div",{className:"dialog",children:[!r&&(0,Cc.jsx)(vf,{isVisible:s,showModal:f,handleModalCancel:b}),n&&(0,Cc.jsx)(fc,{visible:n,onClose:m,dialogData:u,currentIndex:o,onPrevious:I,onNext:C,setCurrentDialogIndex:d}),!n&&!r&&(0,Cc.jsxs)("div",{className:"centered-container",children:[(0,Cc.jsx)("img",{src:Sf,alt:"Placeholder Image",className:"centered-image"}),(0,Cc.jsx)("button",{type:"button",onClick:h,className:"startButton",children:(0,Cc.jsx)("img",{src:Gf,alt:"Start Button"})})]}),r&&(0,Cc.jsxs)("div",{className:"intro-container",children:[(0,Cc.jsx)("p",{children:"\u4f60\u4e5f\u5c0d\u4e09\u5d01\u5e97\u795e\u793e\u53ca\u793e\u5340\u80cc\u5f8c\u90a3\u6bb5\u4e0d\u70ba\u4eba\u77e5\u7684\u6545\u4e8b\u5f88\u597d\u5947\u55ce\uff1f\u82e5\u96b1\u82e5\u73fe\u7684\u795e\u79d8\u6a39\u86d9\u795e\u9ed8\u9ed8\u5730\u5b88\u8b77\u8457\u4ec0\u9ebc\u5462\uff1f \u8ddf\u96a8\u8457\u963f\u6c11\u548c\u963f\u516c\u8173\u6b65\uff0c\u900f\u904e\u820a\u76f8\u6a5f\u6bcf\u4e00\u6b21\u5feb\u9580\u7684\u8072\u97f3\uff0c\u8ffd\u5c0b\u90a3\u4e00\u6bb5\u6bb5\u7684\u7247\u6bb5\u8a18\u61b6\uff0c\u800c\u9019\u4e0d\u50c5\u662f\u4e00\u6bb5\u5c0b\u627e\u5931\u843d\u8a18\u61b6\u7684\u65c5\u7a0b\u3001\u4e00\u6b21\u5fc3\u9748\u7684\u5c0d\u8a71\uff0c\u66f4\u662f\u4e00\u6b21\u4e16\u4ee3\u9593\u7684\u4ea4\u6d41\u3002 \u61f7\u8457\u5c0d\u65bc\u904e\u53bb\u8a18\u61b6\u81f4\u656c\u7684\u656c\u754f\u5fc3\uff0c\u4e00\u540c\u8e0f\u4e0a\u4e00\u6bb5\u7a7f\u8d8a\u6642\u7a7a\u7684\u9b54\u5e7b\u65c5\u7a0b\uff0c\u4e00\u8d77\u63a2\u7d22\u5c6c\u65bc\u4e09\u5d01\u5e97\u7684\u751c\u871c\u8a18\u61b6\u53ca\u6bcf\u4e00\u500b\u89d2\u843d\uff0c\u4e26\u4e00\u6b65\u6b65\u89e3\u958b\u6a39\u86d9\u795e\u3001\u4e09\u5d01\u5e97\u795e\u793e\u53ca\u8af8\u591a\u793e\u5340\u907a\u8de1\u80cc\u5f8c\u7684\u795e\u79d8\u6545\u4e8b\u5427\uff01 \u8b93\u6211\u5011\u6e96\u5099\u597d\uff0c\u6211\u5011\u6e96\u5099\u8d70\u9032\u4e09\u5d01\u5e97\u7684\u795e\u79d8\u65c5\u7a0b\u56c9\uff01"}),(0,Cc.jsx)("button",{onClick:p,children:"\u8d70\u5427"})]})]})},Kf="151",Df={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Uf={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Pf=0,Of=1,_f=2,Qf=3,jf=0,qf=1,$f=2,eb=3,tb=0,nb=1,ab=2,ob=2,ib=0,rb=1,sb=2,lb=3,cb=4,gb=5,ub=100,db=101,hb=102,pb=103,mb=104,Ib=200,Cb=201,fb=202,bb=203,yb=204,Ab=205,vb=206,Sb=207,xb=208,Gb=209,Zb=210,wb=0,kb=1,Bb=2,Rb=3,Wb=4,Vb=5,Nb=6,Xb=7,Mb=0,Tb=1,Eb=2,Fb=0,Hb=1,Jb=2,Yb=3,Lb=4,zb=5,Kb=300,Db=301,Ub=302,Pb=303,Ob=304,_b=306,Qb=1e3,jb=1001,qb=1002,$b=1003,ey=1004,ty=1004,ny=1005,ay=1005,oy=1006,iy=1007,ry=1007,sy=1008,ly=1008,cy=1009,gy=1010,uy=1011,dy=1012,hy=1013,py=1014,my=1015,Iy=1016,Cy=1017,fy=1018,by=1020,yy=1021,Ay=1023,vy=1024,Sy=1025,xy=1026,Gy=1027,Zy=1028,wy=1029,ky=1030,By=1031,Ry=1033,Wy=33776,Vy=33777,Ny=33778,Xy=33779,My=35840,Ty=35841,Ey=35842,Fy=35843,Hy=36196,Jy=37492,Yy=37496,Ly=37808,zy=37809,Ky=37810,Dy=37811,Uy=37812,Py=37813,Oy=37814,_y=37815,Qy=37816,jy=37817,qy=37818,$y=37819,eA=37820,tA=37821,nA=36492,aA=36283,oA=36284,iA=36285,rA=36286,sA=2200,lA=2201,cA=2202,gA=2300,uA=2301,dA=2302,hA=2400,pA=2401,mA=2402,IA=2500,CA=2501,fA=0,bA=1,yA=2,AA=3e3,vA=3001,SA=3200,xA=3201,GA=0,ZA=1,wA="",kA="srgb",BA="srgb-linear",RA="display-p3",WA=0,VA=7680,NA=7681,XA=7682,MA=7683,TA=34055,EA=34056,FA=5386,HA=512,JA=513,YA=514,LA=515,zA=516,KA=517,DA=518,UA=519,PA=35044,OA=35048,_A=35040,QA=35045,jA=35049,qA=35041,$A=35046,ev=35050,tv=35042,nv="100",av="300 es",ov=1035;class iv{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,a=n.length;t<a;t++)n[t].call(this,e);e.target=null}}}const rv=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let sv=1234567;const lv=Math.PI/180,cv=180/Math.PI;function gv(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return(rv[255&e]+rv[e>>8&255]+rv[e>>16&255]+rv[e>>24&255]+"-"+rv[255&t]+rv[t>>8&255]+"-"+rv[t>>16&15|64]+rv[t>>24&255]+"-"+rv[63&n|128]+rv[n>>8&255]+"-"+rv[n>>16&255]+rv[n>>24&255]+rv[255&a]+rv[a>>8&255]+rv[a>>16&255]+rv[a>>24&255]).toLowerCase()}function uv(e,t,n){return Math.max(t,Math.min(n,e))}function dv(e,t){return(e%t+t)%t}function hv(e,t,n){return(1-n)*e+n*t}function pv(e){return 0===(e&e-1)&&0!==e}function mv(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Iv(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Cv(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function fv(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const bv={DEG2RAD:lv,RAD2DEG:cv,generateUUID:gv,clamp:uv,euclideanModulo:dv,mapLinear:function(e,t,n,a,o){return a+(e-t)*(o-a)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:hv,damp:function(e,t,n,a){return hv(e,t,1-Math.exp(-n*a))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(dv(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(sv=e);let t=sv+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*lv},radToDeg:function(e){return e*cv},isPowerOfTwo:pv,ceilPowerOfTwo:mv,floorPowerOfTwo:Iv,setQuaternionFromProperEuler:function(e,t,n,a,o){const i=Math.cos,r=Math.sin,s=i(n/2),l=r(n/2),c=i((t+a)/2),g=r((t+a)/2),u=i((t-a)/2),d=r((t-a)/2),h=i((a-t)/2),p=r((a-t)/2);switch(o){case"XYX":e.set(s*g,l*u,l*d,s*c);break;case"YZY":e.set(l*d,s*g,l*u,s*c);break;case"ZXZ":e.set(l*u,l*d,s*g,s*c);break;case"XZX":e.set(s*g,l*p,l*h,s*c);break;case"YXY":e.set(l*h,s*g,l*p,s*c);break;case"ZYZ":e.set(l*p,l*h,s*g,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}},normalize:fv,denormalize:Cv};class yv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;yv.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6],this.y=a[1]*t+a[4]*n+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(uv(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),a=Math.sin(t),o=this.x-e.x,i=this.y-e.y;return this.x=o*n-i*a+e.x,this.y=o*a+i*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Av{constructor(){Av.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,a,o,i,r,s,l){const c=this.elements;return c[0]=e,c[1]=a,c[2]=r,c[3]=t,c[4]=o,c[5]=s,c[6]=n,c[7]=i,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,a=t.elements,o=this.elements,i=n[0],r=n[3],s=n[6],l=n[1],c=n[4],g=n[7],u=n[2],d=n[5],h=n[8],p=a[0],m=a[3],I=a[6],C=a[1],f=a[4],b=a[7],y=a[2],A=a[5],v=a[8];return o[0]=i*p+r*C+s*y,o[3]=i*m+r*f+s*A,o[6]=i*I+r*b+s*v,o[1]=l*p+c*C+g*y,o[4]=l*m+c*f+g*A,o[7]=l*I+c*b+g*v,o[2]=u*p+d*C+h*y,o[5]=u*m+d*f+h*A,o[8]=u*I+d*b+h*v,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],i=e[4],r=e[5],s=e[6],l=e[7],c=e[8];return t*i*c-t*r*l-n*o*c+n*r*s+a*o*l-a*i*s}invert(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],i=e[4],r=e[5],s=e[6],l=e[7],c=e[8],g=c*i-r*l,u=r*s-c*o,d=l*o-i*s,h=t*g+n*u+a*d;if(0===h)return this.set(0,0,0,0,0,0,0,0,0);const p=1/h;return e[0]=g*p,e[1]=(a*l-c*n)*p,e[2]=(r*n-a*i)*p,e[3]=u*p,e[4]=(c*t-a*s)*p,e[5]=(a*o-r*t)*p,e[6]=d*p,e[7]=(n*s-l*t)*p,e[8]=(i*t-n*o)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,a,o,i,r){const s=Math.cos(o),l=Math.sin(o);return this.set(n*s,n*l,-n*(s*i+l*r)+i+e,-a*l,a*s,-a*(-l*i+s*r)+r+t,0,0,1),this}scale(e,t){return this.premultiply(vv.makeScale(e,t)),this}rotate(e){return this.premultiply(vv.makeRotation(-e)),this}translate(e,t){return this.premultiply(vv.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let a=0;a<9;a++)if(t[a]!==n[a])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const vv=new Av;function Sv(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const xv={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Gv(e,t){return new xv[e](t)}function Zv(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function wv(e){return"function"===typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}function kv(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Bv(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Rv=(new Av).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Wv=(new Av).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);const Vv={[BA]:e=>e,[kA]:e=>e.convertSRGBToLinear(),[RA]:function(e){return e.convertSRGBToLinear().applyMatrix3(Wv)}},Nv={[BA]:e=>e,[kA]:e=>e.convertLinearToSRGB(),[RA]:function(e){return e.applyMatrix3(Rv).convertLinearToSRGB()}},Xv={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return BA},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const a=Vv[t],o=Nv[n];if(void 0===a||void 0===o)throw new Error('Unsupported color space conversion, "'.concat(t,'" to "').concat(n,'".'));return o(a(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let Mv;class Tv{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Mv&&(Mv=Zv("canvas")),Mv.width=e.width,Mv.height=e.height;const n=Mv.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Mv}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=Zv("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const a=n.getImageData(0,0,e.width,e.height),o=a.data;for(let e=0;e<o.length;e++)o[e]=255*kv(o[e]/255);return n.putImageData(a,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*kv(t[e]/255)):t[e]=kv(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Ev{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,this.uuid=gv(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},a=this.data;if(null!==a){let e;if(Array.isArray(a)){e=[];for(let t=0,n=a.length;t<n;t++)a[t].isDataTexture?e.push(Fv(a[t].image)):e.push(Fv(a[t]))}else e=Fv(a);n.url=e}return t||(e.images[this.uuid]=n),n}}function Fv(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Tv.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Hv=0;class Jv extends iv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jv.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jv.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jb,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:jb,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:oy,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:sy,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ay,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:cy,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Jv.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:AA;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Hv++}),this.uuid=gv(),this.name="",this.source=new Ev(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=a,this.magFilter=o,this.minFilter=i,this.anisotropy=l,this.format=r,this.internalFormat=null,this.type=s,this.offset=new yv(0,0),this.repeat=new yv(1,1),this.center=new yv(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Av,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=wv(e.userData),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Kb)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Qb:e.x=e.x-Math.floor(e.x);break;case jb:e.x=e.x<0?0:1;break;case qb:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Qb:e.y=e.y-Math.floor(e.y);break;case jb:e.y=e.y<0?0:1;break;case qb:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Jv.DEFAULT_IMAGE=null,Jv.DEFAULT_MAPPING=Kb,Jv.DEFAULT_ANISOTROPY=1;class Yv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Yv.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=a}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,a=this.z,o=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*a+i[12]*o,this.y=i[1]*t+i[5]*n+i[9]*a+i[13]*o,this.z=i[2]*t+i[6]*n+i[10]*a+i[14]*o,this.w=i[3]*t+i[7]*n+i[11]*a+i[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,a,o;const i=.01,r=.1,s=e.elements,l=s[0],c=s[4],g=s[8],u=s[1],d=s[5],h=s[9],p=s[2],m=s[6],I=s[10];if(Math.abs(c-u)<i&&Math.abs(g-p)<i&&Math.abs(h-m)<i){if(Math.abs(c+u)<r&&Math.abs(g+p)<r&&Math.abs(h+m)<r&&Math.abs(l+d+I-3)<r)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(d+1)/2,C=(I+1)/2,f=(c+u)/4,b=(g+p)/4,y=(h+m)/4;return e>s&&e>C?e<i?(n=0,a=.707106781,o=.707106781):(n=Math.sqrt(e),a=f/n,o=b/n):s>C?s<i?(n=.707106781,a=0,o=.707106781):(a=Math.sqrt(s),n=f/a,o=y/a):C<i?(n=.707106781,a=.707106781,o=0):(o=Math.sqrt(C),n=b/o,a=y/o),this.set(n,a,o,t),this}let C=Math.sqrt((m-h)*(m-h)+(g-p)*(g-p)+(u-c)*(u-c));return Math.abs(C)<.001&&(C=1),this.x=(m-h)/C,this.y=(g-p)/C,this.z=(u-c)/C,this.w=Math.acos((l+d+I-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Lv extends iv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Yv(0,0,e,t),this.scissorTest=!1,this.viewport=new Yv(0,0,e,t);const a={width:e,height:t,depth:1};this.texture=new Jv(a,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:oy,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Ev(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class zv extends Jv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:a},this.magFilter=$b,this.minFilter=$b,this.wrapR=jb,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Kv extends Lv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new zv(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Dv extends Jv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:a},this.magFilter=$b,this.minFilter=$b,this.wrapR=jb,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Uv extends Lv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Dv(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Pv extends Lv{constructor(){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLMultipleRenderTargets=!0;const t=this.texture;this.texture=[];for(let n=0;n<e;n++)this.texture[n]=t.clone(),this.texture[n].isRenderTargetTexture=!0}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let a=0,o=this.texture.length;a<o;a++)this.texture[a].image.width=e,this.texture[a].image.height=t,this.texture[a].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Ov{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=a}static slerpFlat(e,t,n,a,o,i,r){let s=n[a+0],l=n[a+1],c=n[a+2],g=n[a+3];const u=o[i+0],d=o[i+1],h=o[i+2],p=o[i+3];if(0===r)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=g);if(1===r)return e[t+0]=u,e[t+1]=d,e[t+2]=h,void(e[t+3]=p);if(g!==p||s!==u||l!==d||c!==h){let e=1-r;const t=s*u+l*d+c*h+g*p,n=t>=0?1:-1,a=1-t*t;if(a>Number.EPSILON){const o=Math.sqrt(a),i=Math.atan2(o,t*n);e=Math.sin(e*i)/o,r=Math.sin(r*i)/o}const o=r*n;if(s=s*e+u*o,l=l*e+d*o,c=c*e+h*o,g=g*e+p*o,e===1-r){const e=1/Math.sqrt(s*s+l*l+c*c+g*g);s*=e,l*=e,c*=e,g*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=g}static multiplyQuaternionsFlat(e,t,n,a,o,i){const r=n[a],s=n[a+1],l=n[a+2],c=n[a+3],g=o[i],u=o[i+1],d=o[i+2],h=o[i+3];return e[t]=r*h+c*g+s*d-l*u,e[t+1]=s*h+c*u+l*g-r*d,e[t+2]=l*h+c*d+r*u-s*g,e[t+3]=c*h-r*g-s*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,a){return this._x=e,this._y=t,this._z=n,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,a=e._y,o=e._z,i=e._order,r=Math.cos,s=Math.sin,l=r(n/2),c=r(a/2),g=r(o/2),u=s(n/2),d=s(a/2),h=s(o/2);switch(i){case"XYZ":this._x=u*c*g+l*d*h,this._y=l*d*g-u*c*h,this._z=l*c*h+u*d*g,this._w=l*c*g-u*d*h;break;case"YXZ":this._x=u*c*g+l*d*h,this._y=l*d*g-u*c*h,this._z=l*c*h-u*d*g,this._w=l*c*g+u*d*h;break;case"ZXY":this._x=u*c*g-l*d*h,this._y=l*d*g+u*c*h,this._z=l*c*h+u*d*g,this._w=l*c*g-u*d*h;break;case"ZYX":this._x=u*c*g-l*d*h,this._y=l*d*g+u*c*h,this._z=l*c*h-u*d*g,this._w=l*c*g+u*d*h;break;case"YZX":this._x=u*c*g+l*d*h,this._y=l*d*g+u*c*h,this._z=l*c*h-u*d*g,this._w=l*c*g-u*d*h;break;case"XZY":this._x=u*c*g-l*d*h,this._y=l*d*g-u*c*h,this._z=l*c*h+u*d*g,this._w=l*c*g+u*d*h;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,a=Math.sin(n);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],a=t[4],o=t[8],i=t[1],r=t[5],s=t[9],l=t[2],c=t[6],g=t[10],u=n+r+g;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-s)*e,this._y=(o-l)*e,this._z=(i-a)*e}else if(n>r&&n>g){const e=2*Math.sqrt(1+n-r-g);this._w=(c-s)/e,this._x=.25*e,this._y=(a+i)/e,this._z=(o+l)/e}else if(r>g){const e=2*Math.sqrt(1+r-n-g);this._w=(o-l)/e,this._x=(a+i)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+g-n-r);this._w=(i-a)/e,this._x=(o+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(uv(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const a=Math.min(1,t/n);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,a=e._y,o=e._z,i=e._w,r=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+i*r+a*l-o*s,this._y=a*c+i*s+o*r-n*l,this._z=o*c+i*l+n*s-a*r,this._w=i*c-n*r-a*s-o*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,a=this._y,o=this._z,i=this._w;let r=i*e._w+n*e._x+a*e._y+o*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=i,this._x=n,this._y=a,this._z=o,this;const s=1-r*r;if(s<=Number.EPSILON){const e=1-t;return this._w=e*i+t*this._w,this._x=e*n+t*this._x,this._y=e*a+t*this._y,this._z=e*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,r),g=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=i*g+this._w*u,this._x=n*g+this._x*u,this._y=a*g+this._y*u,this._z=o*g+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),a=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(a),n*Math.sin(o),n*Math.cos(o),t*Math.sin(a))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class _v{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_v.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(jv.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(jv.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*a,this.y=o[1]*t+o[4]*n+o[7]*a,this.z=o[2]*t+o[5]*n+o[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,a=this.z,o=e.elements,i=1/(o[3]*t+o[7]*n+o[11]*a+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*a+o[12])*i,this.y=(o[1]*t+o[5]*n+o[9]*a+o[13])*i,this.z=(o[2]*t+o[6]*n+o[10]*a+o[14])*i,this}applyQuaternion(e){const t=this.x,n=this.y,a=this.z,o=e.x,i=e.y,r=e.z,s=e.w,l=s*t+i*a-r*n,c=s*n+r*t-o*a,g=s*a+o*n-i*t,u=-o*t-i*n-r*a;return this.x=l*s+u*-o+c*-r-g*-i,this.y=c*s+u*-i+g*-o-l*-r,this.z=g*s+u*-r+l*-i-c*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*a,this.y=o[1]*t+o[5]*n+o[9]*a,this.z=o[2]*t+o[6]*n+o[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,a=e.y,o=e.z,i=t.x,r=t.y,s=t.z;return this.x=a*s-o*r,this.y=o*i-n*s,this.z=n*r-a*i,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Qv.copy(this).projectOnVector(e),this.sub(Qv)}reflect(e){return this.sub(Qv.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(uv(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const a=Math.sin(t)*e;return this.x=a*Math.sin(n),this.y=Math.cos(t)*e,this.z=a*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Qv=new _v,jv=new Ov;class qv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(eS.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(eS.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=eS.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),tS.copy(e.boundingBox),tS.applyMatrix4(e.matrixWorld),this.union(tS);else{const n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,a=t.count;n<a;n++)eS.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(eS)}else null===n.boundingBox&&n.computeBoundingBox(),tS.copy(n.boundingBox),tS.applyMatrix4(e.matrixWorld),this.union(tS)}const n=e.children;for(let a=0,o=n.length;a<o;a++)this.expandByObject(n[a],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,eS),eS.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(lS),cS.subVectors(this.max,lS),nS.subVectors(e.a,lS),aS.subVectors(e.b,lS),oS.subVectors(e.c,lS),iS.subVectors(aS,nS),rS.subVectors(oS,aS),sS.subVectors(nS,oS);let t=[0,-iS.z,iS.y,0,-rS.z,rS.y,0,-sS.z,sS.y,iS.z,0,-iS.x,rS.z,0,-rS.x,sS.z,0,-sS.x,-iS.y,iS.x,0,-rS.y,rS.x,0,-sS.y,sS.x,0];return!!dS(t,nS,aS,oS,cS)&&(t=[1,0,0,0,1,0,0,0,1],!!dS(t,nS,aS,oS,cS)&&(gS.crossVectors(iS,rS),t=[gS.x,gS.y,gS.z],dS(t,nS,aS,oS,cS)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,eS).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(eS).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||($v[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),$v[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),$v[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),$v[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),$v[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),$v[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),$v[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),$v[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints($v)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const $v=[new _v,new _v,new _v,new _v,new _v,new _v,new _v,new _v],eS=new _v,tS=new qv,nS=new _v,aS=new _v,oS=new _v,iS=new _v,rS=new _v,sS=new _v,lS=new _v,cS=new _v,gS=new _v,uS=new _v;function dS(e,t,n,a,o){for(let i=0,r=e.length-3;i<=r;i+=3){uS.fromArray(e,i);const r=o.x*Math.abs(uS.x)+o.y*Math.abs(uS.y)+o.z*Math.abs(uS.z),s=t.dot(uS),l=n.dot(uS),c=a.dot(uS);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>r)return!1}return!0}const hS=new qv,pS=new _v,mS=new _v;class IS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):hS.setFromPoints(e).getCenter(n);let a=0;for(let o=0,i=e.length;o<i;o++)a=Math.max(a,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(a),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;pS.subVectors(e,this.center);const t=pS.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(pS,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(mS.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(pS.copy(e.center).add(mS)),this.expandByPoint(pS.copy(e.center).sub(mS))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const CS=new _v,fS=new _v,bS=new _v,yS=new _v,AS=new _v,vS=new _v,SS=new _v;class xS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,CS)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=CS.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(CS.copy(this.origin).addScaledVector(this.direction,t),CS.distanceToSquared(e))}distanceSqToSegment(e,t,n,a){fS.copy(e).add(t).multiplyScalar(.5),bS.copy(t).sub(e).normalize(),yS.copy(this.origin).sub(fS);const o=.5*e.distanceTo(t),i=-this.direction.dot(bS),r=yS.dot(this.direction),s=-yS.dot(bS),l=yS.lengthSq(),c=Math.abs(1-i*i);let g,u,d,h;if(c>0)if(g=i*s-r,u=i*r-s,h=o*c,g>=0)if(u>=-h)if(u<=h){const e=1/c;g*=e,u*=e,d=g*(g+i*u+2*r)+u*(i*g+u+2*s)+l}else u=o,g=Math.max(0,-(i*u+r)),d=-g*g+u*(u+2*s)+l;else u=-o,g=Math.max(0,-(i*u+r)),d=-g*g+u*(u+2*s)+l;else u<=-h?(g=Math.max(0,-(-i*o+r)),u=g>0?-o:Math.min(Math.max(-o,-s),o),d=-g*g+u*(u+2*s)+l):u<=h?(g=0,u=Math.min(Math.max(-o,-s),o),d=u*(u+2*s)+l):(g=Math.max(0,-(i*o+r)),u=g>0?o:Math.min(Math.max(-o,-s),o),d=-g*g+u*(u+2*s)+l);else u=i>0?-o:o,g=Math.max(0,-(i*u+r)),d=-g*g+u*(u+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,g),a&&a.copy(fS).addScaledVector(bS,u),d}intersectSphere(e,t){CS.subVectors(e.center,this.origin);const n=CS.dot(this.direction),a=CS.dot(CS)-n*n,o=e.radius*e.radius;if(a>o)return null;const i=Math.sqrt(o-a),r=n-i,s=n+i;return s<0?null:r<0?this.at(s,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,a,o,i,r,s;const l=1/this.direction.x,c=1/this.direction.y,g=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,a=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,a=(e.min.x-u.x)*l),c>=0?(o=(e.min.y-u.y)*c,i=(e.max.y-u.y)*c):(o=(e.max.y-u.y)*c,i=(e.min.y-u.y)*c),n>i||o>a?null:((o>n||isNaN(n))&&(n=o),(i<a||isNaN(a))&&(a=i),g>=0?(r=(e.min.z-u.z)*g,s=(e.max.z-u.z)*g):(r=(e.max.z-u.z)*g,s=(e.min.z-u.z)*g),n>s||r>a?null:((r>n||n!==n)&&(n=r),(s<a||a!==a)&&(a=s),a<0?null:this.at(n>=0?n:a,t)))}intersectsBox(e){return null!==this.intersectBox(e,CS)}intersectTriangle(e,t,n,a,o){AS.subVectors(t,e),vS.subVectors(n,e),SS.crossVectors(AS,vS);let i,r=this.direction.dot(SS);if(r>0){if(a)return null;i=1}else{if(!(r<0))return null;i=-1,r=-r}yS.subVectors(this.origin,e);const s=i*this.direction.dot(vS.crossVectors(yS,vS));if(s<0)return null;const l=i*this.direction.dot(AS.cross(yS));if(l<0)return null;if(s+l>r)return null;const c=-i*yS.dot(SS);return c<0?null:this.at(c/r,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class GS{constructor(){GS.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,a,o,i,r,s,l,c,g,u,d,h,p,m){const I=this.elements;return I[0]=e,I[4]=t,I[8]=n,I[12]=a,I[1]=o,I[5]=i,I[9]=r,I[13]=s,I[2]=l,I[6]=c,I[10]=g,I[14]=u,I[3]=d,I[7]=h,I[11]=p,I[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new GS).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,a=1/ZS.setFromMatrixColumn(e,0).length(),o=1/ZS.setFromMatrixColumn(e,1).length(),i=1/ZS.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,a=e.y,o=e.z,i=Math.cos(n),r=Math.sin(n),s=Math.cos(a),l=Math.sin(a),c=Math.cos(o),g=Math.sin(o);if("XYZ"===e.order){const e=i*c,n=i*g,a=r*c,o=r*g;t[0]=s*c,t[4]=-s*g,t[8]=l,t[1]=n+a*l,t[5]=e-o*l,t[9]=-r*s,t[2]=o-e*l,t[6]=a+n*l,t[10]=i*s}else if("YXZ"===e.order){const e=s*c,n=s*g,a=l*c,o=l*g;t[0]=e+o*r,t[4]=a*r-n,t[8]=i*l,t[1]=i*g,t[5]=i*c,t[9]=-r,t[2]=n*r-a,t[6]=o+e*r,t[10]=i*s}else if("ZXY"===e.order){const e=s*c,n=s*g,a=l*c,o=l*g;t[0]=e-o*r,t[4]=-i*g,t[8]=a+n*r,t[1]=n+a*r,t[5]=i*c,t[9]=o-e*r,t[2]=-i*l,t[6]=r,t[10]=i*s}else if("ZYX"===e.order){const e=i*c,n=i*g,a=r*c,o=r*g;t[0]=s*c,t[4]=a*l-n,t[8]=e*l+o,t[1]=s*g,t[5]=o*l+e,t[9]=n*l-a,t[2]=-l,t[6]=r*s,t[10]=i*s}else if("YZX"===e.order){const e=i*s,n=i*l,a=r*s,o=r*l;t[0]=s*c,t[4]=o-e*g,t[8]=a*g+n,t[1]=g,t[5]=i*c,t[9]=-r*c,t[2]=-l*c,t[6]=n*g+a,t[10]=e-o*g}else if("XZY"===e.order){const e=i*s,n=i*l,a=r*s,o=r*l;t[0]=s*c,t[4]=-g,t[8]=l*c,t[1]=e*g+o,t[5]=i*c,t[9]=n*g-a,t[2]=a*g-n,t[6]=r*c,t[10]=o*g+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(kS,e,BS)}lookAt(e,t,n){const a=this.elements;return VS.subVectors(e,t),0===VS.lengthSq()&&(VS.z=1),VS.normalize(),RS.crossVectors(n,VS),0===RS.lengthSq()&&(1===Math.abs(n.z)?VS.x+=1e-4:VS.z+=1e-4,VS.normalize(),RS.crossVectors(n,VS)),RS.normalize(),WS.crossVectors(VS,RS),a[0]=RS.x,a[4]=WS.x,a[8]=VS.x,a[1]=RS.y,a[5]=WS.y,a[9]=VS.y,a[2]=RS.z,a[6]=WS.z,a[10]=VS.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,a=t.elements,o=this.elements,i=n[0],r=n[4],s=n[8],l=n[12],c=n[1],g=n[5],u=n[9],d=n[13],h=n[2],p=n[6],m=n[10],I=n[14],C=n[3],f=n[7],b=n[11],y=n[15],A=a[0],v=a[4],S=a[8],x=a[12],G=a[1],Z=a[5],w=a[9],k=a[13],B=a[2],R=a[6],W=a[10],V=a[14],N=a[3],X=a[7],M=a[11],T=a[15];return o[0]=i*A+r*G+s*B+l*N,o[4]=i*v+r*Z+s*R+l*X,o[8]=i*S+r*w+s*W+l*M,o[12]=i*x+r*k+s*V+l*T,o[1]=c*A+g*G+u*B+d*N,o[5]=c*v+g*Z+u*R+d*X,o[9]=c*S+g*w+u*W+d*M,o[13]=c*x+g*k+u*V+d*T,o[2]=h*A+p*G+m*B+I*N,o[6]=h*v+p*Z+m*R+I*X,o[10]=h*S+p*w+m*W+I*M,o[14]=h*x+p*k+m*V+I*T,o[3]=C*A+f*G+b*B+y*N,o[7]=C*v+f*Z+b*R+y*X,o[11]=C*S+f*w+b*W+y*M,o[15]=C*x+f*k+b*V+y*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],a=e[8],o=e[12],i=e[1],r=e[5],s=e[9],l=e[13],c=e[2],g=e[6],u=e[10],d=e[14];return e[3]*(+o*s*g-a*l*g-o*r*u+n*l*u+a*r*d-n*s*d)+e[7]*(+t*s*d-t*l*u+o*i*u-a*i*d+a*l*c-o*s*c)+e[11]*(+t*l*g-t*r*d-o*i*g+n*i*d+o*r*c-n*l*c)+e[15]*(-a*r*c-t*s*g+t*r*u+a*i*g-n*i*u+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],i=e[4],r=e[5],s=e[6],l=e[7],c=e[8],g=e[9],u=e[10],d=e[11],h=e[12],p=e[13],m=e[14],I=e[15],C=g*m*l-p*u*l+p*s*d-r*m*d-g*s*I+r*u*I,f=h*u*l-c*m*l-h*s*d+i*m*d+c*s*I-i*u*I,b=c*p*l-h*g*l+h*r*d-i*p*d-c*r*I+i*g*I,y=h*g*s-c*p*s-h*r*u+i*p*u+c*r*m-i*g*m,A=t*C+n*f+a*b+o*y;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/A;return e[0]=C*v,e[1]=(p*u*o-g*m*o-p*a*d+n*m*d+g*a*I-n*u*I)*v,e[2]=(r*m*o-p*s*o+p*a*l-n*m*l-r*a*I+n*s*I)*v,e[3]=(g*s*o-r*u*o-g*a*l+n*u*l+r*a*d-n*s*d)*v,e[4]=f*v,e[5]=(c*m*o-h*u*o+h*a*d-t*m*d-c*a*I+t*u*I)*v,e[6]=(h*s*o-i*m*o-h*a*l+t*m*l+i*a*I-t*s*I)*v,e[7]=(i*u*o-c*s*o+c*a*l-t*u*l-i*a*d+t*s*d)*v,e[8]=b*v,e[9]=(h*g*o-c*p*o-h*n*d+t*p*d+c*n*I-t*g*I)*v,e[10]=(i*p*o-h*r*o+h*n*l-t*p*l-i*n*I+t*r*I)*v,e[11]=(c*r*o-i*g*o-c*n*l+t*g*l+i*n*d-t*r*d)*v,e[12]=y*v,e[13]=(c*p*a-h*g*a+h*n*u-t*p*u-c*n*m+t*g*m)*v,e[14]=(h*r*a-i*p*a-h*n*s+t*p*s+i*n*m-t*r*m)*v,e[15]=(i*g*a-c*r*a+c*n*s-t*g*s-i*n*u+t*r*u)*v,this}scale(e){const t=this.elements,n=e.x,a=e.y,o=e.z;return t[0]*=n,t[4]*=a,t[8]*=o,t[1]*=n,t[5]*=a,t[9]*=o,t[2]*=n,t[6]*=a,t[10]*=o,t[3]*=n,t[7]*=a,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,a))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),a=Math.sin(t),o=1-n,i=e.x,r=e.y,s=e.z,l=o*i,c=o*r;return this.set(l*i+n,l*r-a*s,l*s+a*r,0,l*r+a*s,c*r+n,c*s-a*i,0,l*s-a*r,c*s+a*i,o*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,a,o,i){return this.set(1,n,o,0,e,1,i,0,t,a,1,0,0,0,0,1),this}compose(e,t,n){const a=this.elements,o=t._x,i=t._y,r=t._z,s=t._w,l=o+o,c=i+i,g=r+r,u=o*l,d=o*c,h=o*g,p=i*c,m=i*g,I=r*g,C=s*l,f=s*c,b=s*g,y=n.x,A=n.y,v=n.z;return a[0]=(1-(p+I))*y,a[1]=(d+b)*y,a[2]=(h-f)*y,a[3]=0,a[4]=(d-b)*A,a[5]=(1-(u+I))*A,a[6]=(m+C)*A,a[7]=0,a[8]=(h+f)*v,a[9]=(m-C)*v,a[10]=(1-(u+p))*v,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,t,n){const a=this.elements;let o=ZS.set(a[0],a[1],a[2]).length();const i=ZS.set(a[4],a[5],a[6]).length(),r=ZS.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),e.x=a[12],e.y=a[13],e.z=a[14],wS.copy(this);const s=1/o,l=1/i,c=1/r;return wS.elements[0]*=s,wS.elements[1]*=s,wS.elements[2]*=s,wS.elements[4]*=l,wS.elements[5]*=l,wS.elements[6]*=l,wS.elements[8]*=c,wS.elements[9]*=c,wS.elements[10]*=c,t.setFromRotationMatrix(wS),n.x=o,n.y=i,n.z=r,this}makePerspective(e,t,n,a,o,i){const r=this.elements,s=2*o/(t-e),l=2*o/(n-a),c=(t+e)/(t-e),g=(n+a)/(n-a),u=-(i+o)/(i-o),d=-2*i*o/(i-o);return r[0]=s,r[4]=0,r[8]=c,r[12]=0,r[1]=0,r[5]=l,r[9]=g,r[13]=0,r[2]=0,r[6]=0,r[10]=u,r[14]=d,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(e,t,n,a,o,i){const r=this.elements,s=1/(t-e),l=1/(n-a),c=1/(i-o),g=(t+e)*s,u=(n+a)*l,d=(i+o)*c;return r[0]=2*s,r[4]=0,r[8]=0,r[12]=-g,r[1]=0,r[5]=2*l,r[9]=0,r[13]=-u,r[2]=0,r[6]=0,r[10]=-2*c,r[14]=-d,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let a=0;a<16;a++)if(t[a]!==n[a])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const ZS=new _v,wS=new GS,kS=new _v(0,0,0),BS=new _v(1,1,1),RS=new _v,WS=new _v,VS=new _v,NS=new GS,XS=new Ov;class MS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:MS.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=a}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=e.elements,o=a[0],i=a[4],r=a[8],s=a[1],l=a[5],c=a[9],g=a[2],u=a[6],d=a[10];switch(t){case"XYZ":this._y=Math.asin(uv(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-i,o)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-uv(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(r,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-g,o),this._z=0);break;case"ZXY":this._x=Math.asin(uv(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-g,d),this._z=Math.atan2(-i,l)):(this._y=0,this._z=Math.atan2(s,o));break;case"ZYX":this._y=Math.asin(-uv(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(s,o)):(this._x=0,this._z=Math.atan2(-i,l));break;case"YZX":this._z=Math.asin(uv(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-g,o)):(this._x=0,this._y=Math.atan2(r,d));break;case"XZY":this._z=Math.asin(-uv(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(r,o)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return NS.makeRotationFromQuaternion(e),this.setFromRotationMatrix(NS,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return XS.setFromEuler(this),this.setFromQuaternion(XS,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}MS.DEFAULT_ORDER="XYZ";class TS{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let ES=0;const FS=new _v,HS=new Ov,JS=new GS,YS=new _v,LS=new _v,zS=new _v,KS=new Ov,DS=new _v(1,0,0),US=new _v(0,1,0),PS=new _v(0,0,1),OS={type:"added"},_S={type:"removed"};class QS extends iv{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ES++}),this.uuid=gv(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=QS.DEFAULT_UP.clone();const e=new _v,t=new MS,n=new Ov,a=new _v(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new GS},normalMatrix:{value:new Av}}),this.matrix=new GS,this.matrixWorld=new GS,this.matrixAutoUpdate=QS.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=QS.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new TS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return HS.setFromAxisAngle(e,t),this.quaternion.multiply(HS),this}rotateOnWorldAxis(e,t){return HS.setFromAxisAngle(e,t),this.quaternion.premultiply(HS),this}rotateX(e){return this.rotateOnAxis(DS,e)}rotateY(e){return this.rotateOnAxis(US,e)}rotateZ(e){return this.rotateOnAxis(PS,e)}translateOnAxis(e,t){return FS.copy(e).applyQuaternion(this.quaternion),this.position.add(FS.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(DS,e)}translateY(e){return this.translateOnAxis(US,e)}translateZ(e){return this.translateOnAxis(PS,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(JS.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?YS.copy(e):YS.set(e,t,n);const a=this.parent;this.updateWorldMatrix(!0,!1),LS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?JS.lookAt(LS,YS,this.up):JS.lookAt(YS,LS,this.up),this.quaternion.setFromRotationMatrix(JS),a&&(JS.extractRotation(a.matrixWorld),HS.setFromRotationMatrix(JS),this.quaternion.premultiply(HS.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(OS)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_S)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(_S)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),JS.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),JS.multiply(e.parent.matrixWorld)),e.applyMatrix4(JS),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,a=this.children.length;n<a;n++){const a=this.children[n].getObjectByProperty(e,t);if(void 0!==a)return a}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let a=0,o=this.children.length;a<o;a++){const o=this.children[a].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LS,e,zS),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LS,KS,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,a=t.length;n<a;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,a=t.length;n<a;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,a=t.length;n<a;n++){const a=t[n];!0!==a.matrixWorldAutoUpdate&&!0!==e||a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const a={};function o(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),!0===this.castShadow&&(a.castShadow=!0),!0===this.receiveShadow&&(a.receiveShadow=!0),!1===this.visible&&(a.visible=!1),!1===this.frustumCulled&&(a.frustumCulled=!1),0!==this.renderOrder&&(a.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),a.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(a.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?a.background=this.background.toJSON():this.background.isTexture&&(a.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(a.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){a.geometry=o(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,a=n.length;t<a;t++){const a=n[t];o(e.shapes,a)}else o(e.shapes,n)}}if(this.isSkinnedMesh&&(a.bindMode=this.bindMode,a.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(e.skeletons,this.skeleton),a.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,a=this.material.length;n<a;n++)t.push(o(e.materials,this.material[n]));a.material=t}else a.material=o(e.materials,this.material);if(this.children.length>0){a.children=[];for(let t=0;t<this.children.length;t++)a.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){a.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];a.animations.push(o(e.animations,n))}}if(t){const t=i(e.geometries),a=i(e.materials),o=i(e.textures),r=i(e.images),s=i(e.shapes),l=i(e.skeletons),c=i(e.animations),g=i(e.nodes);t.length>0&&(n.geometries=t),a.length>0&&(n.materials=a),o.length>0&&(n.textures=o),r.length>0&&(n.images=r),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),g.length>0&&(n.nodes=g)}return n.object=a,n;function i(e){const t=[];for(const n in e){const a=e[n];delete a.metadata,t.push(a)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=wv(e.userData),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}QS.DEFAULT_UP=new _v(0,1,0),QS.DEFAULT_MATRIX_AUTO_UPDATE=!0,QS.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const jS=new _v,qS=new _v,$S=new _v,ex=new _v,tx=new _v,nx=new _v,ax=new _v,ox=new _v,ix=new _v,rx=new _v;let sx=!1;class lx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new _v;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,a){a.subVectors(n,t),jS.subVectors(e,t),a.cross(jS);const o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}static getBarycoord(e,t,n,a,o){jS.subVectors(a,t),qS.subVectors(n,t),$S.subVectors(e,t);const i=jS.dot(jS),r=jS.dot(qS),s=jS.dot($S),l=qS.dot(qS),c=qS.dot($S),g=i*l-r*r;if(0===g)return o.set(-2,-1,-1);const u=1/g,d=(l*s-r*c)*u,h=(i*c-r*s)*u;return o.set(1-d-h,h,d)}static containsPoint(e,t,n,a){return this.getBarycoord(e,t,n,a,ex),ex.x>=0&&ex.y>=0&&ex.x+ex.y<=1}static getUV(e,t,n,a,o,i,r,s){return!1===sx&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),sx=!0),this.getInterpolation(e,t,n,a,o,i,r,s)}static getInterpolation(e,t,n,a,o,i,r,s){return this.getBarycoord(e,t,n,a,ex),s.setScalar(0),s.addScaledVector(o,ex.x),s.addScaledVector(i,ex.y),s.addScaledVector(r,ex.z),s}static isFrontFacing(e,t,n,a){return jS.subVectors(n,t),qS.subVectors(e,t),jS.cross(qS).dot(a)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,a){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[a]),this}setFromAttributeAndIndices(e,t,n,a){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,a),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return jS.subVectors(this.c,this.b),qS.subVectors(this.a,this.b),.5*jS.cross(qS).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return lx.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return lx.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,a,o){return!1===sx&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),sx=!0),lx.getInterpolation(e,this.a,this.b,this.c,t,n,a,o)}getInterpolation(e,t,n,a,o){return lx.getInterpolation(e,this.a,this.b,this.c,t,n,a,o)}containsPoint(e){return lx.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return lx.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,a=this.b,o=this.c;let i,r;tx.subVectors(a,n),nx.subVectors(o,n),ox.subVectors(e,n);const s=tx.dot(ox),l=nx.dot(ox);if(s<=0&&l<=0)return t.copy(n);ix.subVectors(e,a);const c=tx.dot(ix),g=nx.dot(ix);if(c>=0&&g<=c)return t.copy(a);const u=s*g-c*l;if(u<=0&&s>=0&&c<=0)return i=s/(s-c),t.copy(n).addScaledVector(tx,i);rx.subVectors(e,o);const d=tx.dot(rx),h=nx.dot(rx);if(h>=0&&d<=h)return t.copy(o);const p=d*l-s*h;if(p<=0&&l>=0&&h<=0)return r=l/(l-h),t.copy(n).addScaledVector(nx,r);const m=c*h-d*g;if(m<=0&&g-c>=0&&d-h>=0)return ax.subVectors(o,a),r=(g-c)/(g-c+(d-h)),t.copy(a).addScaledVector(ax,r);const I=1/(m+p+u);return i=p*I,r=u*I,t.copy(n).addScaledVector(tx,i).addScaledVector(nx,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let cx=0;class gx extends iv{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:cx++}),this.uuid=gv(),this.name="",this.type="Material",this.blending=rb,this.side=tb,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=yb,this.blendDst=Ab,this.blendEquation=ub,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Rb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=UA,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=VA,this.stencilZFail=VA,this.stencilZPass=VA,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."));continue}const a=this[t];void 0!==a?a&&a.isColor?a.set(n):a&&a.isVector3&&n&&n.isVector3?a.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function a(e){const t=[];for(const n in e){const a=e[n];delete a.metadata,t.push(a)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==rb&&(n.blending=this.blending),this.side!==tb&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=a(e.textures),o=a(e.images);t.length>0&&(n.textures=t),o.length>0&&(n.images=o)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let a=0;a!==e;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=wv(e.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const ux={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},dx={h:0,s:0,l:0},hx={h:0,s:0,l:0};function px(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class mx{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kA;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Xv.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Xv.workingColorSpace;return this.r=e,this.g=t,this.b=n,Xv.toWorkingColorSpace(this,a),this}setHSL(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Xv.workingColorSpace;if(e=dv(e,1),t=uv(t,0,1),n=uv(n,0,1),0===t)this.r=this.g=this.b=n;else{const a=n<=.5?n*(1+t):n+t-n*t,o=2*n-a;this.r=px(o,a,e+1/3),this.g=px(o,a,e),this.b=px(o,a,e-1/3)}return Xv.toWorkingColorSpace(this,a),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kA;function a(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const i=t[1],r=t[2];switch(i){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Xv.toWorkingColorSpace(this,n),a(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Xv.toWorkingColorSpace(this,n),a(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const e=parseFloat(o[1])/360,t=parseFloat(o[2])/100,i=parseFloat(o[3])/100;return a(o[4]),this.setHSL(e,t,i,n)}break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=t[1],o=a.length;if(3===o)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,n);if(6===o)return this.setHex(parseInt(a,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kA;const n=ux[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=kv(e.r),this.g=kv(e.g),this.b=kv(e.b),this}copyLinearToSRGB(e){return this.r=Bv(e.r),this.g=Bv(e.g),this.b=Bv(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kA;return Xv.fromWorkingColorSpace(Ix.copy(this),e),uv(255*Ix.r,0,255)<<16^uv(255*Ix.g,0,255)<<8^uv(255*Ix.b,0,255)}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kA;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xv.workingColorSpace;Xv.fromWorkingColorSpace(Ix.copy(this),t);const n=Ix.r,a=Ix.g,o=Ix.b,i=Math.max(n,a,o),r=Math.min(n,a,o);let s,l;const c=(r+i)/2;if(r===i)s=0,l=0;else{const e=i-r;switch(l=c<=.5?e/(i+r):e/(2-i-r),i){case n:s=(a-o)/e+(a<o?6:0);break;case a:s=(o-n)/e+2;break;case o:s=(n-a)/e+4}s/=6}return e.h=s,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xv.workingColorSpace;return Xv.fromWorkingColorSpace(Ix.copy(this),t),e.r=Ix.r,e.g=Ix.g,e.b=Ix.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kA;Xv.fromWorkingColorSpace(Ix.copy(this),e);const t=Ix.r,n=Ix.g,a=Ix.b;return e!==kA?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(a.toFixed(3),")"):"rgb(".concat(255*t|0,",").concat(255*n|0,",").concat(255*a|0,")")}offsetHSL(e,t,n){return this.getHSL(dx),dx.h+=e,dx.s+=t,dx.l+=n,this.setHSL(dx.h,dx.s,dx.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(dx),e.getHSL(hx);const n=hv(dx.h,hx.h,t),a=hv(dx.s,hx.s,t),o=hv(dx.l,hx.l,t);return this.setHSL(n,a,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,a=this.b,o=e.elements;return this.r=o[0]*t+o[3]*n+o[6]*a,this.g=o[1]*t+o[4]*n+o[7]*a,this.b=o[2]*t+o[5]*n+o[8]*a,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ix=new mx;mx.NAMES=ux;class Cx extends gx{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new mx(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Mb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const fx=bx();function bx(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),a=new Uint32Array(512),o=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(a[l]=0,a[256|l]=32768,o[l]=24,o[256|l]=24):e<-14?(a[l]=1024>>-e-14,a[256|l]=1024>>-e-14|32768,o[l]=-e-1,o[256|l]=-e-1):e<=15?(a[l]=e+15<<10,a[256|l]=e+15<<10|32768,o[l]=13,o[256|l]=13):e<128?(a[l]=31744,a[256|l]=64512,o[l]=24,o[256|l]=24):(a[l]=31744,a[256|l]=64512,o[l]=13,o[256|l]=13)}const i=new Uint32Array(2048),r=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,i[l]=e|t}for(let l=1024;l<2048;++l)i[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)r[l]=l<<23;r[31]=1199570944,r[32]=2147483648;for(let l=33;l<63;++l)r[l]=2147483648+(l-32<<23);r[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(s[l]=1024);return{floatView:t,uint32View:n,baseTable:a,shiftTable:o,mantissaTable:i,exponentTable:r,offsetTable:s}}function yx(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=uv(e,-65504,65504),fx.floatView[0]=e;const t=fx.uint32View[0],n=t>>23&511;return fx.baseTable[n]+((8388607&t)>>fx.shiftTable[n])}function Ax(e){const t=e>>10;return fx.uint32View[0]=fx.mantissaTable[fx.offsetTable[t]+(1023&e)]+fx.exponentTable[t],fx.floatView[0]}const vx={toHalfFloat:yx,fromHalfFloat:Ax},Sx=new _v,xx=new yv;class Gx{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=PA,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let a=0,o=this.itemSize;a<o;a++)this.array[e+a]=t.array[n+a];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)xx.fromBufferAttribute(this,t),xx.applyMatrix3(e),this.setXY(t,xx.x,xx.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Sx.fromBufferAttribute(this,t),Sx.applyMatrix3(e),this.setXYZ(t,Sx.x,Sx.y,Sx.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Sx.fromBufferAttribute(this,t),Sx.applyMatrix4(e),this.setXYZ(t,Sx.x,Sx.y,Sx.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Sx.fromBufferAttribute(this,t),Sx.applyNormalMatrix(e),this.setXYZ(t,Sx.x,Sx.y,Sx.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Sx.fromBufferAttribute(this,t),Sx.transformDirection(e),this.setXYZ(t,Sx.x,Sx.y,Sx.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Cv(t,this.array)),t}setX(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Cv(t,this.array)),t}setY(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Cv(t,this.array)),t}setZ(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Cv(t,this.array)),t}setW(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,a){return e*=this.itemSize,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array),a=fv(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=a,this}setXYZW(e,t,n,a,o){return e*=this.itemSize,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array),a=fv(a,this.array),o=fv(o,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=a,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==PA&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Zx extends Gx{constructor(e,t,n){super(new Int8Array(e),t,n)}}class wx extends Gx{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class kx extends Gx{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Bx extends Gx{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Rx extends Gx{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Wx extends Gx{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Vx extends Gx{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Nx extends Gx{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Ax(this.array[e*this.itemSize]);return this.normalized&&(t=Cv(t,this.array)),t}setX(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize]=yx(t),this}getY(e){let t=Ax(this.array[e*this.itemSize+1]);return this.normalized&&(t=Cv(t,this.array)),t}setY(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize+1]=yx(t),this}getZ(e){let t=Ax(this.array[e*this.itemSize+2]);return this.normalized&&(t=Cv(t,this.array)),t}setZ(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize+2]=yx(t),this}getW(e){let t=Ax(this.array[e*this.itemSize+3]);return this.normalized&&(t=Cv(t,this.array)),t}setW(e,t){return this.normalized&&(t=fv(t,this.array)),this.array[e*this.itemSize+3]=yx(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array)),this.array[e+0]=yx(t),this.array[e+1]=yx(n),this}setXYZ(e,t,n,a){return e*=this.itemSize,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array),a=fv(a,this.array)),this.array[e+0]=yx(t),this.array[e+1]=yx(n),this.array[e+2]=yx(a),this}setXYZW(e,t,n,a,o){return e*=this.itemSize,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array),a=fv(a,this.array),o=fv(o,this.array)),this.array[e+0]=yx(t),this.array[e+1]=yx(n),this.array[e+2]=yx(a),this.array[e+3]=yx(o),this}}class Xx extends Gx{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Mx extends Gx{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Tx=0;const Ex=new GS,Fx=new QS,Hx=new _v,Jx=new qv,Yx=new qv,Lx=new _v;class zx extends iv{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Tx++}),this.uuid=gv(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Sv(e)?Vx:Rx)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Av).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const a=this.attributes.tangent;return void 0!==a&&(a.transformDirection(e),a.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ex.makeRotationFromQuaternion(e),this.applyMatrix4(Ex),this}rotateX(e){return Ex.makeRotationX(e),this.applyMatrix4(Ex),this}rotateY(e){return Ex.makeRotationY(e),this.applyMatrix4(Ex),this}rotateZ(e){return Ex.makeRotationZ(e),this.applyMatrix4(Ex),this}translate(e,t,n){return Ex.makeTranslation(e,t,n),this.applyMatrix4(Ex),this}scale(e,t,n){return Ex.makeScale(e,t,n),this.applyMatrix4(Ex),this}lookAt(e){return Fx.lookAt(e),Fx.updateMatrix(),this.applyMatrix4(Fx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Hx).negate(),this.translate(Hx.x,Hx.y,Hx.z),this}setFromPoints(e){const t=[];for(let n=0,a=e.length;n<a;n++){const a=e[n];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Xx(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qv);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new _v(-1/0,-1/0,-1/0),new _v(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,a=t.length;n<a;n++){const e=t[n];Jx.setFromBufferAttribute(e),this.morphTargetsRelative?(Lx.addVectors(this.boundingBox.min,Jx.min),this.boundingBox.expandByPoint(Lx),Lx.addVectors(this.boundingBox.max,Jx.max),this.boundingBox.expandByPoint(Lx)):(this.boundingBox.expandByPoint(Jx.min),this.boundingBox.expandByPoint(Jx.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new IS);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new _v,1/0);if(e){const n=this.boundingSphere.center;if(Jx.setFromBufferAttribute(e),t)for(let e=0,o=t.length;e<o;e++){const n=t[e];Yx.setFromBufferAttribute(n),this.morphTargetsRelative?(Lx.addVectors(Jx.min,Yx.min),Jx.expandByPoint(Lx),Lx.addVectors(Jx.max,Yx.max),Jx.expandByPoint(Lx)):(Jx.expandByPoint(Yx.min),Jx.expandByPoint(Yx.max))}Jx.getCenter(n);let a=0;for(let t=0,o=e.count;t<o;t++)Lx.fromBufferAttribute(e,t),a=Math.max(a,n.distanceToSquared(Lx));if(t)for(let o=0,i=t.length;o<i;o++){const i=t[o],r=this.morphTargetsRelative;for(let t=0,o=i.count;t<o;t++)Lx.fromBufferAttribute(i,t),r&&(Hx.fromBufferAttribute(e,t),Lx.add(Hx)),a=Math.max(a,n.distanceToSquared(Lx))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,a=t.position.array,o=t.normal.array,i=t.uv.array,r=a.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Gx(new Float32Array(4*r),4));const s=this.getAttribute("tangent").array,l=[],c=[];for(let G=0;G<r;G++)l[G]=new _v,c[G]=new _v;const g=new _v,u=new _v,d=new _v,h=new yv,p=new yv,m=new yv,I=new _v,C=new _v;function f(e,t,n){g.fromArray(a,3*e),u.fromArray(a,3*t),d.fromArray(a,3*n),h.fromArray(i,2*e),p.fromArray(i,2*t),m.fromArray(i,2*n),u.sub(g),d.sub(g),p.sub(h),m.sub(h);const o=1/(p.x*m.y-m.x*p.y);isFinite(o)&&(I.copy(u).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(o),C.copy(d).multiplyScalar(p.x).addScaledVector(u,-m.x).multiplyScalar(o),l[e].add(I),l[t].add(I),l[n].add(I),c[e].add(C),c[t].add(C),c[n].add(C))}let b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(let G=0,Z=b.length;G<Z;++G){const e=b[G],t=e.start;for(let a=t,o=t+e.count;a<o;a+=3)f(n[a+0],n[a+1],n[a+2])}const y=new _v,A=new _v,v=new _v,S=new _v;function x(e){v.fromArray(o,3*e),S.copy(v);const t=l[e];y.copy(t),y.sub(v.multiplyScalar(v.dot(t))).normalize(),A.crossVectors(S,t);const n=A.dot(c[e])<0?-1:1;s[4*e]=y.x,s[4*e+1]=y.y,s[4*e+2]=y.z,s[4*e+3]=n}for(let G=0,Z=b.length;G<Z;++G){const e=b[G],t=e.start;for(let a=t,o=t+e.count;a<o;a+=3)x(n[a+0]),x(n[a+1]),x(n[a+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Gx(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const a=new _v,o=new _v,i=new _v,r=new _v,s=new _v,l=new _v,c=new _v,g=new _v;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),h=e.getX(u+1),p=e.getX(u+2);a.fromBufferAttribute(t,d),o.fromBufferAttribute(t,h),i.fromBufferAttribute(t,p),c.subVectors(i,o),g.subVectors(a,o),c.cross(g),r.fromBufferAttribute(n,d),s.fromBufferAttribute(n,h),l.fromBufferAttribute(n,p),r.add(c),s.add(c),l.add(c),n.setXYZ(d,r.x,r.y,r.z),n.setXYZ(h,s.x,s.y,s.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,u=t.count;e<u;e+=3)a.fromBufferAttribute(t,e+0),o.fromBufferAttribute(t,e+1),i.fromBufferAttribute(t,e+2),c.subVectors(i,o),g.subVectors(a,o),c.cross(g),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Lx.fromBufferAttribute(e,t),Lx.normalize(),e.setXYZ(t,Lx.x,Lx.y,Lx.z)}toNonIndexed(){function e(e,t){const n=e.array,a=e.itemSize,o=e.normalized,i=new n.constructor(t.length*a);let r=0,s=0;for(let l=0,c=t.length;l<c;l++){r=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*a;for(let e=0;e<a;e++)i[s++]=n[r++]}return new Gx(i,a,o)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new zx,n=this.index.array,a=this.attributes;for(const r in a){const o=e(a[r],n);t.setAttribute(r,o)}const o=this.morphAttributes;for(const r in o){const a=[],i=o[r];for(let t=0,o=i.length;t<o;t++){const o=e(i[t],n);a.push(o)}t.morphAttributes[r]=a}t.morphTargetsRelative=this.morphTargetsRelative;const i=this.groups;for(let r=0,s=i.length;r<s;r++){const e=i[r];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const a={};let o=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let a=0,o=t.length;a<o;a++){const o=t[a];n.push(o.toJSON(e.data))}n.length>0&&(a[s]=n,o=!0)}o&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);const i=this.groups;i.length>0&&(e.data.groups=JSON.parse(JSON.stringify(i)));const r=this.boundingSphere;return null!==r&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const a=e.attributes;for(const l in a){const e=a[l];this.setAttribute(l,e.clone(t))}const o=e.morphAttributes;for(const l in o){const e=[],n=o[l];for(let a=0,o=n.length;a<o;a++)e.push(n[a].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const i=e.groups;for(let l=0,c=i.length;l<c;l++){const e=i[l];this.addGroup(e.start,e.count,e.materialIndex)}const r=e.boundingBox;null!==r&&(this.boundingBox=r.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=wv(e.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Kx=new GS,Dx=new xS,Ux=new IS,Px=new _v,Ox=new _v,_x=new _v,Qx=new _v,jx=new _v,qx=new _v,$x=new yv,eG=new yv,tG=new yv,nG=new _v,aG=new _v,oG=new _v,iG=new _v,rG=new _v;class sG extends QS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zx,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Cx;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,a=n.attributes.position,o=n.morphAttributes.position,i=n.morphTargetsRelative;t.fromBufferAttribute(a,e);const r=this.morphTargetInfluences;if(o&&r){qx.set(0,0,0);for(let n=0,a=o.length;n<a;n++){const a=r[n],s=o[n];0!==a&&(jx.fromBufferAttribute(s,e),i?qx.addScaledVector(jx,a):qx.addScaledVector(jx.sub(t),a))}t.add(qx)}return this.isSkinnedMesh&&this.applyBoneTransform(e,t),t}raycast(e,t){const n=this.geometry,a=this.material,o=this.matrixWorld;if(void 0===a)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ux.copy(n.boundingSphere),Ux.applyMatrix4(o),Dx.copy(e.ray).recast(e.near),!1===Ux.containsPoint(Dx.origin)){if(null===Dx.intersectSphere(Ux,Px))return;if(Dx.origin.distanceToSquared(Px)>(e.far-e.near)**2)return}if(Kx.copy(o).invert(),Dx.copy(e.ray).applyMatrix4(Kx),null!==n.boundingBox&&!1===Dx.intersectsBox(n.boundingBox))return;let i;const r=n.index,s=n.attributes.position,l=n.attributes.uv,c=n.attributes.uv2,g=n.attributes.normal,u=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(a))for(let h=0,p=u.length;h<p;h++){const n=u[h],o=a[n.materialIndex];for(let a=Math.max(n.start,d.start),s=Math.min(r.count,Math.min(n.start+n.count,d.start+d.count));a<s;a+=3){const s=r.getX(a),u=r.getX(a+1),d=r.getX(a+2);i=lG(this,o,e,Dx,l,c,g,s,u,d),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=n.materialIndex,t.push(i))}}else{for(let n=Math.max(0,d.start),o=Math.min(r.count,d.start+d.count);n<o;n+=3){const o=r.getX(n),s=r.getX(n+1),u=r.getX(n+2);i=lG(this,a,e,Dx,l,c,g,o,s,u),i&&(i.faceIndex=Math.floor(n/3),t.push(i))}}else if(void 0!==s)if(Array.isArray(a))for(let h=0,p=u.length;h<p;h++){const n=u[h],o=a[n.materialIndex];for(let a=Math.max(n.start,d.start),r=Math.min(s.count,Math.min(n.start+n.count,d.start+d.count));a<r;a+=3){i=lG(this,o,e,Dx,l,c,g,a,a+1,a+2),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=n.materialIndex,t.push(i))}}else{for(let n=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);n<o;n+=3){i=lG(this,a,e,Dx,l,c,g,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),t.push(i))}}}}function lG(e,t,n,a,o,i,r,s,l,c){e.getVertexPosition(s,Ox),e.getVertexPosition(l,_x),e.getVertexPosition(c,Qx);const g=function(e,t,n,a,o,i,r,s){let l;if(l=t.side===nb?a.intersectTriangle(r,i,o,!0,s):a.intersectTriangle(o,i,r,t.side===tb,s),null===l)return null;rG.copy(s),rG.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(rG);return c<n.near||c>n.far?null:{distance:c,point:rG.clone(),object:e}}(e,t,n,a,Ox,_x,Qx,iG);if(g){o&&($x.fromBufferAttribute(o,s),eG.fromBufferAttribute(o,l),tG.fromBufferAttribute(o,c),g.uv=lx.getInterpolation(iG,Ox,_x,Qx,$x,eG,tG,new yv)),i&&($x.fromBufferAttribute(i,s),eG.fromBufferAttribute(i,l),tG.fromBufferAttribute(i,c),g.uv2=lx.getInterpolation(iG,Ox,_x,Qx,$x,eG,tG,new yv)),r&&(nG.fromBufferAttribute(r,s),aG.fromBufferAttribute(r,l),oG.fromBufferAttribute(r,c),g.normal=lx.getInterpolation(iG,Ox,_x,Qx,nG,aG,oG,new _v),g.normal.dot(a.direction)>0&&g.normal.multiplyScalar(-1));const e={a:s,b:l,c:c,normal:new _v,materialIndex:0};lx.getNormal(Ox,_x,Qx,e.normal),g.face=e}return g}class cG extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:a,heightSegments:o,depthSegments:i};const r=this;a=Math.floor(a),o=Math.floor(o),i=Math.floor(i);const s=[],l=[],c=[],g=[];let u=0,d=0;function h(e,t,n,a,o,i,h,p,m,I,C){const f=i/m,b=h/I,y=i/2,A=h/2,v=p/2,S=m+1,x=I+1;let G=0,Z=0;const w=new _v;for(let r=0;r<x;r++){const i=r*b-A;for(let s=0;s<S;s++){const u=s*f-y;w[e]=u*a,w[t]=i*o,w[n]=v,l.push(w.x,w.y,w.z),w[e]=0,w[t]=0,w[n]=p>0?1:-1,c.push(w.x,w.y,w.z),g.push(s/m),g.push(1-r/I),G+=1}}for(let r=0;r<I;r++)for(let e=0;e<m;e++){const t=u+e+S*r,n=u+e+S*(r+1),a=u+(e+1)+S*(r+1),o=u+(e+1)+S*r;s.push(t,n,o),s.push(n,a,o),Z+=6}r.addGroup(d,Z,C),d+=Z,u+=G}h("z","y","x",-1,-1,n,t,e,i,o,0),h("z","y","x",1,-1,n,t,-e,i,o,1),h("x","z","y",1,1,e,n,t,a,i,2),h("x","z","y",1,-1,e,n,-t,a,i,3),h("x","y","z",1,-1,e,t,n,a,o,4),h("x","y","z",-1,-1,e,t,-n,a,o,5),this.setIndex(s),this.setAttribute("position",new Xx(l,3)),this.setAttribute("normal",new Xx(c,3)),this.setAttribute("uv",new Xx(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cG(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function gG(e){const t={};for(const n in e){t[n]={};for(const a in e[n]){const o=e[n][a];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][a]=null):t[n][a]=o.clone():Array.isArray(o)?t[n][a]=o.slice():t[n][a]=o}}return t}function uG(e){const t={};for(let n=0;n<e.length;n++){const a=gG(e[n]);for(const e in a)t[e]=a[e]}return t}function dG(e){return null===e.getRenderTarget()&&e.outputEncoding===vA?kA:BA}const hG={clone:gG,merge:uG};class pG extends gx{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=gG(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const a in this.uniforms){const n=this.uniforms[a].value;n&&n.isTexture?t.uniforms[a]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[a]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[a]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[a]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[a]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[a]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[a]={type:"m4",value:n.toArray()}:t.uniforms[a]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const a in this.extensions)!0===this.extensions[a]&&(n[a]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class mG extends QS{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new GS,this.projectionMatrix=new GS,this.projectionMatrixInverse=new GS}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class IG extends mG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=a,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*cv*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*lv*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*cv*Math.atan(Math.tan(.5*lv*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,a,o,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=a,this.view.width=o,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*lv*this.fov)/this.zoom,n=2*t,a=this.aspect*n,o=-.5*a;const i=this.view;if(null!==this.view&&this.view.enabled){const e=i.fullWidth,r=i.fullHeight;o+=i.offsetX*a/e,t-=i.offsetY*n/r,a*=i.width/e,n*=i.height/r}const r=this.filmOffset;0!==r&&(o+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+a,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const CG=-90;class fG extends QS{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const a=new IG(CG,1,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(1,0,0),this.add(a);const o=new IG(CG,1,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(-1,0,0),this.add(o);const i=new IG(CG,1,e,t);i.layers=this.layers,i.up.set(0,0,-1),i.lookAt(0,1,0),this.add(i);const r=new IG(CG,1,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(0,-1,0),this.add(r);const s=new IG(CG,1,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(0,0,1),this.add(s);const l=new IG(CG,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[a,o,i,r,s,l]=this.children,c=e.getRenderTarget(),g=e.toneMapping,u=e.xr.enabled;e.toneMapping=Fb,e.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,a),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,i),e.setRenderTarget(n,3),e.render(t,r),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=g,e.xr.enabled=u,n.texture.needsPMREMUpdate=!0}}class bG extends Jv{constructor(e,t,n,a,o,i,r,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Db,n,a,o,i,r,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class yG extends Lv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},a=[n,n,n,n,n,n];this.texture=new bG(a,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:oy}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},a="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",o="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new cG(5,5,5),r=new pG({name:"CubemapFromEquirect",uniforms:gG(n),vertexShader:a,fragmentShader:o,side:nb,blending:ib});r.uniforms.tEquirect.value=t;const s=new sG(i,r),l=t.minFilter;t.minFilter===sy&&(t.minFilter=oy);return new fG(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,a){const o=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,a);e.setRenderTarget(o)}}const AG=new _v,vG=new _v,SG=new Av;class xG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const a=AG.subVectors(n,t).cross(vG.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(AG),a=this.normal.dot(n);if(0===a)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/a;return o<0||o>1?null:t.copy(e.start).addScaledVector(n,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||SG.getNormalMatrix(e),a=this.coplanarPoint(AG).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-a.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const GG=new IS,ZG=new _v;class wG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xG,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xG,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new xG,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new xG,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new xG,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new xG;this.planes=[e,t,n,a,o,i]}set(e,t,n,a,o,i){const r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(n),r[3].copy(a),r[4].copy(o),r[5].copy(i),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,a=n[0],o=n[1],i=n[2],r=n[3],s=n[4],l=n[5],c=n[6],g=n[7],u=n[8],d=n[9],h=n[10],p=n[11],m=n[12],I=n[13],C=n[14],f=n[15];return t[0].setComponents(r-a,g-s,p-u,f-m).normalize(),t[1].setComponents(r+a,g+s,p+u,f+m).normalize(),t[2].setComponents(r+o,g+l,p+d,f+I).normalize(),t[3].setComponents(r-o,g-l,p-d,f-I).normalize(),t[4].setComponents(r-i,g-c,p-h,f-C).normalize(),t[5].setComponents(r+i,g+c,p+h,f+C).normalize(),this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),GG.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),GG.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(GG)}intersectsSprite(e){return GG.center.set(0,0,0),GG.radius=.7071067811865476,GG.applyMatrix4(e.matrixWorld),this.intersectsSphere(GG)}intersectsSphere(e){const t=this.planes,n=e.center,a=-e.radius;for(let o=0;o<6;o++){if(t[o].distanceToPoint(n)<a)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const a=t[n];if(ZG.x=a.normal.x>0?e.max.x:e.min.x,ZG.y=a.normal.y>0?e.max.y:e.min.y,ZG.z=a.normal.z>0?e.max.z:e.min.z,a.distanceToPoint(ZG)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function kG(){let e=null,t=!1,n=null,a=null;function o(t,i){n(t,i),a=e.requestAnimationFrame(o)}return{start:function(){!0!==t&&null!==n&&(a=e.requestAnimationFrame(o),t=!0)},stop:function(){e.cancelAnimationFrame(a),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function BG(e,t){const n=t.isWebGL2,a=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),a.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=a.get(t);n&&(e.deleteBuffer(n.buffer),a.delete(t))},update:function(t,o){if(t.isGLBufferAttribute){const e=a.get(t);return void((!e||e.version<t.version)&&a.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const i=a.get(t);void 0===i?a.set(t,function(t,a){const o=t.array,i=t.usage,r=e.createBuffer();let s;if(e.bindBuffer(a,r),e.bufferData(a,o,i),t.onUploadCallback(),o instanceof Float32Array)s=5126;else if(o instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");s=5131}else s=5123;else if(o instanceof Int16Array)s=5122;else if(o instanceof Uint32Array)s=5125;else if(o instanceof Int32Array)s=5124;else if(o instanceof Int8Array)s=5120;else if(o instanceof Uint8Array)s=5121;else{if(!(o instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+o);s=5121}return{buffer:r,type:s,bytesPerElement:o.BYTES_PER_ELEMENT,version:t.version}}(t,o)):i.version<t.version&&(!function(t,a,o){const i=a.array,r=a.updateRange;e.bindBuffer(o,t),-1===r.count?e.bufferSubData(o,0,i):(n?e.bufferSubData(o,r.offset*i.BYTES_PER_ELEMENT,i,r.offset,r.count):e.bufferSubData(o,r.offset*i.BYTES_PER_ELEMENT,i.subarray(r.offset,r.offset+r.count)),r.count=-1),a.onUploadCallback()}(i.buffer,t,o),i.version=t.version)}}}class RG extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:a};const o=e/2,i=t/2,r=Math.floor(n),s=Math.floor(a),l=r+1,c=s+1,g=e/r,u=t/s,d=[],h=[],p=[],m=[];for(let I=0;I<c;I++){const e=I*u-i;for(let t=0;t<l;t++){const n=t*g-o;h.push(n,-e,0),p.push(0,0,1),m.push(t/r),m.push(1-I/s)}}for(let I=0;I<s;I++)for(let e=0;e<r;e++){const t=e+l*I,n=e+l*(I+1),a=e+1+l*(I+1),o=e+1+l*I;d.push(t,n,o),d.push(n,a,o)}this.setIndex(d),this.setAttribute("position",new Xx(h,3)),this.setAttribute("normal",new Xx(p,3)),this.setAttribute("uv",new Xx(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new RG(e.width,e.height,e.widthSegments,e.heightSegments)}}const WG={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_NORMALMAP_TANGENTSPACE\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\t\n\t\tvec2 lodFudge = pow( 1.95, lod ) / fullSize;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec2 fullSize = vec2( textureSize( sampler, 0 ) );\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_UV2\n\tattribute vec2 uv2;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},VG={common:{diffuse:{value:new mx(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Av},alphaMap:{value:null},alphaMapTransform:{value:new Av},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Av}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Av}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Av}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Av},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Av},normalScale:{value:new yv(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Av},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Av}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Av}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Av}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new mx(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new mx(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Av}},sprite:{diffuse:{value:new mx(16777215)},opacity:{value:1},center:{value:new yv(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Av},alphaMap:{value:null},alphaTest:{value:0}}},NG={basic:{uniforms:uG([VG.common,VG.specularmap,VG.envmap,VG.aomap,VG.lightmap,VG.fog]),vertexShader:WG.meshbasic_vert,fragmentShader:WG.meshbasic_frag},lambert:{uniforms:uG([VG.common,VG.specularmap,VG.envmap,VG.aomap,VG.lightmap,VG.emissivemap,VG.bumpmap,VG.normalmap,VG.displacementmap,VG.fog,VG.lights,{emissive:{value:new mx(0)}}]),vertexShader:WG.meshlambert_vert,fragmentShader:WG.meshlambert_frag},phong:{uniforms:uG([VG.common,VG.specularmap,VG.envmap,VG.aomap,VG.lightmap,VG.emissivemap,VG.bumpmap,VG.normalmap,VG.displacementmap,VG.fog,VG.lights,{emissive:{value:new mx(0)},specular:{value:new mx(1118481)},shininess:{value:30}}]),vertexShader:WG.meshphong_vert,fragmentShader:WG.meshphong_frag},standard:{uniforms:uG([VG.common,VG.envmap,VG.aomap,VG.lightmap,VG.emissivemap,VG.bumpmap,VG.normalmap,VG.displacementmap,VG.roughnessmap,VG.metalnessmap,VG.fog,VG.lights,{emissive:{value:new mx(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:WG.meshphysical_vert,fragmentShader:WG.meshphysical_frag},toon:{uniforms:uG([VG.common,VG.aomap,VG.lightmap,VG.emissivemap,VG.bumpmap,VG.normalmap,VG.displacementmap,VG.gradientmap,VG.fog,VG.lights,{emissive:{value:new mx(0)}}]),vertexShader:WG.meshtoon_vert,fragmentShader:WG.meshtoon_frag},matcap:{uniforms:uG([VG.common,VG.bumpmap,VG.normalmap,VG.displacementmap,VG.fog,{matcap:{value:null}}]),vertexShader:WG.meshmatcap_vert,fragmentShader:WG.meshmatcap_frag},points:{uniforms:uG([VG.points,VG.fog]),vertexShader:WG.points_vert,fragmentShader:WG.points_frag},dashed:{uniforms:uG([VG.common,VG.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:WG.linedashed_vert,fragmentShader:WG.linedashed_frag},depth:{uniforms:uG([VG.common,VG.displacementmap]),vertexShader:WG.depth_vert,fragmentShader:WG.depth_frag},normal:{uniforms:uG([VG.common,VG.bumpmap,VG.normalmap,VG.displacementmap,{opacity:{value:1}}]),vertexShader:WG.meshnormal_vert,fragmentShader:WG.meshnormal_frag},sprite:{uniforms:uG([VG.sprite,VG.fog]),vertexShader:WG.sprite_vert,fragmentShader:WG.sprite_frag},background:{uniforms:{uvTransform:{value:new Av},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:WG.background_vert,fragmentShader:WG.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:WG.backgroundCube_vert,fragmentShader:WG.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:WG.cube_vert,fragmentShader:WG.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:WG.equirect_vert,fragmentShader:WG.equirect_frag},distanceRGBA:{uniforms:uG([VG.common,VG.displacementmap,{referencePosition:{value:new _v},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:WG.distanceRGBA_vert,fragmentShader:WG.distanceRGBA_frag},shadow:{uniforms:uG([VG.lights,VG.fog,{color:{value:new mx(0)},opacity:{value:1}}]),vertexShader:WG.shadow_vert,fragmentShader:WG.shadow_frag}};NG.physical={uniforms:uG([NG.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Av},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Av},clearcoatNormalScale:{value:new yv(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Av},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Av},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Av},sheen:{value:0},sheenColor:{value:new mx(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Av},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Av},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Av},transmissionSamplerSize:{value:new yv},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Av},attenuationDistance:{value:0},attenuationColor:{value:new mx(0)},specularColor:{value:new mx(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Av},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Av}}]),vertexShader:WG.meshphysical_vert,fragmentShader:WG.meshphysical_frag};const XG={r:0,b:0,g:0};function MG(e,t,n,a,o,i,r){const s=new mx(0);let l,c,g=!0===i?0:1,u=null,d=0,h=null;function p(t,n){t.getRGB(XG,dG(e)),a.buffers.color.setClear(XG.r,XG.g,XG.b,n,r)}return{getClearColor:function(){return s},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),g=t,p(s,g)},getClearAlpha:function(){return g},setClearAlpha:function(e){g=e,p(s,g)},render:function(a,i){let r=!1,m=!0===i.isScene?i.background:null;if(m&&m.isTexture){m=(i.backgroundBlurriness>0?n:t).get(m)}const I=e.xr,C=I.getSession&&I.getSession();C&&"additive"===C.environmentBlendMode&&(m=null),null===m?p(s,g):m&&m.isColor&&(p(m,1),r=!0),(e.autoClear||r)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===_b)?(void 0===c&&(c=new sG(new cG(1,1,1),new pG({name:"BackgroundCubeMaterial",uniforms:gG(NG.backgroundCube.uniforms),vertexShader:NG.backgroundCube.vertexShader,fragmentShader:NG.backgroundCube.fragmentShader,side:nb,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(c)),c.material.uniforms.envMap.value=m,c.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=i.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,c.material.toneMapped=m.encoding!==vA,u===m&&d===m.version&&h===e.toneMapping||(c.material.needsUpdate=!0,u=m,d=m.version,h=e.toneMapping),c.layers.enableAll(),a.unshift(c,c.geometry,c.material,0,0,null)):m&&m.isTexture&&(void 0===l&&(l=new sG(new RG(2,2),new pG({name:"BackgroundMaterial",uniforms:gG(NG.background.uniforms),vertexShader:NG.background.vertexShader,fragmentShader:NG.background.fragmentShader,side:tb,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(l)),l.material.uniforms.t2D.value=m,l.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,l.material.toneMapped=m.encoding!==vA,!0===m.matrixAutoUpdate&&m.updateMatrix(),l.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&d===m.version&&h===e.toneMapping||(l.material.needsUpdate=!0,u=m,d=m.version,h=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null))}}}function TG(e,t,n,a){const o=e.getParameter(34921),i=a.isWebGL2?null:t.get("OES_vertex_array_object"),r=a.isWebGL2||null!==i,s={},l=h(null);let c=l,g=!1;function u(t){return a.isWebGL2?e.bindVertexArray(t):i.bindVertexArrayOES(t)}function d(t){return a.isWebGL2?e.deleteVertexArray(t):i.deleteVertexArrayOES(t)}function h(e){const t=[],n=[],a=[];for(let i=0;i<o;i++)t[i]=0,n[i]=0,a[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:a,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){I(e,0)}function I(n,o){const i=c.newAttributes,r=c.enabledAttributes,s=c.attributeDivisors;if(i[n]=1,0===r[n]&&(e.enableVertexAttribArray(n),r[n]=1),s[n]!==o){(a.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[a.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,o),s[n]=o}}function C(){const t=c.newAttributes,n=c.enabledAttributes;for(let a=0,o=n.length;a<o;a++)n[a]!==t[a]&&(e.disableVertexAttribArray(a),n[a]=0)}function f(t,n,o,i,r,s){!0!==a.isWebGL2||5124!==o&&5125!==o?e.vertexAttribPointer(t,n,o,i,r,s):e.vertexAttribIPointer(t,n,o,r,s)}function b(){y(),g=!0,c!==l&&(c=l,u(c.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(o,l,d,b,y){let A=!1;if(r){const t=function(t,n,o){const r=!0===o.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let g=c[r];void 0===g&&(g=h(a.isWebGL2?e.createVertexArray():i.createVertexArrayOES()),c[r]=g);return g}(b,d,l);c!==t&&(c=t,u(c.object)),A=function(e,t,n,a){const o=c.attributes,i=t.attributes;let r=0;const s=n.getAttributes();for(const l in s){if(s[l].location>=0){const t=o[l];let n=i[l];if(void 0===n&&("instanceMatrix"===l&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;r++}}return c.attributesNum!==r||c.index!==a}(o,b,d,y),A&&function(e,t,n,a){const o={},i=t.attributes;let r=0;const s=n.getAttributes();for(const l in s){if(s[l].location>=0){let t=i[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),o[l]=n,r++}}c.attributes=o,c.attributesNum=r,c.index=a}(o,b,d,y)}else{const e=!0===l.wireframe;c.geometry===b.id&&c.program===d.id&&c.wireframe===e||(c.geometry=b.id,c.program=d.id,c.wireframe=e,A=!0)}null!==y&&n.update(y,34963),(A||g)&&(g=!1,function(o,i,r,s){if(!1===a.isWebGL2&&(o.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=s.attributes,c=r.getAttributes(),g=i.defaultAttributeValues;for(const t in c){const a=c[t];if(a.location>=0){let i=l[t];if(void 0===i&&("instanceMatrix"===t&&o.instanceMatrix&&(i=o.instanceMatrix),"instanceColor"===t&&o.instanceColor&&(i=o.instanceColor)),void 0!==i){const t=i.normalized,r=i.itemSize,l=n.get(i);if(void 0===l)continue;const c=l.buffer,g=l.type,u=l.bytesPerElement;if(i.isInterleavedBufferAttribute){const n=i.data,l=n.stride,d=i.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)I(a.location+e,n.meshPerAttribute);!0!==o.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(34962,c);for(let e=0;e<a.locationSize;e++)f(a.location+e,r/a.locationSize,g,t,l*u,(d+r/a.locationSize*e)*u)}else{if(i.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)I(a.location+e,i.meshPerAttribute);!0!==o.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(34962,c);for(let e=0;e<a.locationSize;e++)f(a.location+e,r/a.locationSize,g,t,r*u,r/a.locationSize*e*u)}}else if(void 0!==g){const n=g[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(a.location,n);break;case 3:e.vertexAttrib3fv(a.location,n);break;case 4:e.vertexAttrib4fv(a.location,n);break;default:e.vertexAttrib1fv(a.location,n)}}}}C()}(o,l,d,b),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:b,resetDefaultState:y,dispose:function(){b();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const n in t){const e=t[n];for(const t in e)d(e[t].object),delete e[t];delete t[n]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const a=n[e.id];for(const e in a)d(a[e].object),delete a[e];delete n[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:C}}function EG(e,t,n,a){const o=a.isWebGL2;let i;this.setMode=function(e){i=e},this.render=function(t,a){e.drawArrays(i,t,a),n.update(a,i,1)},this.renderInstances=function(a,r,s){if(0===s)return;let l,c;if(o)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](i,a,r,s),n.update(r,i,s)}}function FG(e,t,n){let a;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const i="undefined"!==typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let r=void 0!==n.precision?n.precision:"highp";const s=o(r);s!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",s,"instead."),r=s);const l=i||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,g=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),h=e.getParameter(34076),p=e.getParameter(34921),m=e.getParameter(36347),I=e.getParameter(36348),C=e.getParameter(36349),f=u>0,b=i||t.has("OES_texture_float");return{isWebGL2:i,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==a)return a;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");a=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else a=0;return a},getMaxPrecision:o,precision:r,logarithmicDepthBuffer:c,maxTextures:g,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:h,maxAttributes:p,maxVertexUniforms:m,maxVaryings:I,maxFragmentUniforms:C,vertexTextures:f,floatFragmentTextures:b,floatVertexTextures:f&&b,maxSamples:i?e.getParameter(36183):0}}function HG(e){const t=this;let n=null,a=0,o=!1,i=!1;const r=new xG,s=new Av,l={value:null,needsUpdate:!1};function c(e,n,a,o){const i=null!==e?e.length:0;let c=null;if(0!==i){if(c=l.value,!0!==o||null===c){const t=a+4*i,o=n.matrixWorldInverse;s.getNormalMatrix(o),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=a;n!==i;++n,l+=4)r.copy(e[n]).applyMatrix4(o,s),r.normal.toArray(c,l),c[l+3]=r.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=i,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==a||o;return o=t,a=e.length,n},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(r,s,g){const u=r.clippingPlanes,d=r.clipIntersection,h=r.clipShadows,p=e.get(r);if(!o||null===u||0===u.length||i&&!h)i?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=a>0);t.numPlanes=a,t.numIntersection=0}();else{const e=i?0:a,t=4*e;let o=p.clippingState||null;l.value=o,o=c(u,s,t,g);for(let a=0;a!==t;++a)o[a]=n[a];p.clippingState=o,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function JG(e){let t=new WeakMap;function n(e,t){return t===Pb?e.mapping=Db:t===Ob&&(e.mapping=Ub),e}function a(e){const n=e.target;n.removeEventListener("dispose",a);const o=t.get(n);void 0!==o&&(t.delete(n),o.dispose())}return{get:function(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const i=o.mapping;if(i===Pb||i===Ob){if(t.has(o)){return n(t.get(o).texture,o.mapping)}{const i=o.image;if(i&&i.height>0){const r=new yG(i.height/2);return r.fromEquirectangularTexture(e,o),t.set(o,r),o.addEventListener("dispose",a),n(r.texture,o.mapping)}return null}}}return o},dispose:function(){t=new WeakMap}}}class YG extends mG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=a,this.near=o,this.far=i,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,a,o,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=a,this.view.width=o,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,a=(this.top+this.bottom)/2;let o=n-e,i=n+e,r=a+t,s=a-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=e*this.view.offsetX,i=o+e*this.view.width,r-=t*this.view.offsetY,s=r-t*this.view.height}this.projectionMatrix.makeOrthographic(o,i,r,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const LG=[.125,.215,.35,.446,.526,.582],zG=20,KG=new YG,DG=new mx;let UG=null;const PG=(1+Math.sqrt(5))/2,OG=1/PG,_G=[new _v(1,1,1),new _v(-1,1,1),new _v(1,1,-1),new _v(-1,1,-1),new _v(0,PG,OG),new _v(0,PG,-OG),new _v(OG,0,PG),new _v(-OG,0,PG),new _v(PG,OG,0),new _v(-PG,OG,0)];class QG{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;UG=this._renderer.getRenderTarget(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,a,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=eZ(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=$G(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(UG),e.scissorTest=!1,qG(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Db||e.mapping===Ub?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),UG=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:oy,minFilter:oy,generateMipmaps:!1,type:Iy,format:Ay,encoding:AA,depthBuffer:!1},a=jG(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=jG(e,t,n);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],a=[];let o=e;const i=e-4+1+LG.length;for(let r=0;r<i;r++){const i=Math.pow(2,o);n.push(i);let s=1/i;r>e-4?s=LG[r-e+4-1]:0===r&&(s=0),a.push(s);const l=1/(i-2),c=-l,g=1+l,u=[c,c,g,c,g,g,c,c,g,g,c,g],d=6,h=6,p=3,m=2,I=1,C=new Float32Array(p*h*d),f=new Float32Array(m*h*d),b=new Float32Array(I*h*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,a=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];C.set(a,p*h*e),f.set(u,m*h*e);const o=[e,e,e,e,e,e];b.set(o,I*h*e)}const y=new zx;y.setAttribute("position",new Gx(C,p)),y.setAttribute("uv",new Gx(f,m)),y.setAttribute("faceIndex",new Gx(b,I)),t.push(y),o>4&&o--}return{lodPlanes:t,sizeLods:n,sigmas:a}}(a)),this._blurMaterial=function(e,t,n){const a=new Float32Array(zG),o=new _v(0,1,0),i=new pG({name:"SphericalGaussianBlur",defines:{n:zG,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:a},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:ib,depthTest:!1,depthWrite:!1});return i}(a,e,t)}return a}_compileMaterial(e){const t=new sG(this._lodPlanes[0],e);this._renderer.compile(t,KG)}_sceneToCubeUV(e,t,n,a){const o=new IG(90,1,t,n),i=[1,-1,1,1,1,1],r=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.toneMapping;s.getClearColor(DG),s.toneMapping=Fb,s.autoClear=!1;const g=new Cx({name:"PMREM.Background",side:nb,depthWrite:!1,depthTest:!1}),u=new sG(new cG,g);let d=!1;const h=e.background;h?h.isColor&&(g.color.copy(h),e.background=null,d=!0):(g.color.copy(DG),d=!0);for(let p=0;p<6;p++){const t=p%3;0===t?(o.up.set(0,i[p],0),o.lookAt(r[p],0,0)):1===t?(o.up.set(0,0,i[p]),o.lookAt(0,r[p],0)):(o.up.set(0,i[p],0),o.lookAt(0,0,r[p]));const n=this._cubeSize;qG(a,t*n,p>2?n:0,n,n),s.setRenderTarget(a),d&&s.render(u,o),s.render(e,o)}u.geometry.dispose(),u.material.dispose(),s.toneMapping=c,s.autoClear=l,e.background=h}_textureToCubeUV(e,t){const n=this._renderer,a=e.mapping===Db||e.mapping===Ub;a?(null===this._cubemapMaterial&&(this._cubemapMaterial=eZ()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=$G());const o=a?this._cubemapMaterial:this._equirectMaterial,i=new sG(this._lodPlanes[0],o);o.uniforms.envMap.value=e;const r=this._cubeSize;qG(t,0,0,3*r,2*r),n.setRenderTarget(t),n.render(i,KG)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let a=1;a<this._lodPlanes.length;a++){const t=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),n=_G[(a-1)%_G.length];this._blur(e,a-1,a,t,n)}t.autoClear=n}_blur(e,t,n,a,o){const i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,a,"latitudinal",o),this._halfBlur(i,e,n,n,a,"longitudinal",o)}_halfBlur(e,t,n,a,o,i,r){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==i&&"longitudinal"!==i&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new sG(this._lodPlanes[a],l),g=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(o)?Math.PI/(2*u):2*Math.PI/39,h=o/d,p=isFinite(o)?1+Math.floor(3*h):zG;p>zG&&console.warn("sigmaRadians, ".concat(o,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(zG));const m=[];let I=0;for(let b=0;b<zG;++b){const e=b/h,t=Math.exp(-e*e/2);m.push(t),0===b?I+=t:b<p&&(I+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/I;g.envMap.value=e.texture,g.samples.value=p,g.weights.value=m,g.latitudinal.value="latitudinal"===i,r&&(g.poleAxis.value=r);const{_lodMax:C}=this;g.dTheta.value=d,g.mipInt.value=C-n;const f=this._sizeLods[a];qG(t,3*f*(a>C-4?a-C+4:0),4*(this._cubeSize-f),3*f,2*f),s.setRenderTarget(t),s.render(c,KG)}}function jG(e,t,n){const a=new Lv(e,t,n);return a.texture.mapping=_b,a.texture.name="PMREM.cubeUv",a.scissorTest=!0,a}function qG(e,t,n,a,o){e.viewport.set(t,n,a,o),e.scissor.set(t,n,a,o)}function $G(){return new pG({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:ib,depthTest:!1,depthWrite:!1})}function eZ(){return new pG({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:ib,depthTest:!1,depthWrite:!1})}function tZ(e){let t=new WeakMap,n=null;function a(e){const n=e.target;n.removeEventListener("dispose",a);const o=t.get(n);void 0!==o&&(t.delete(n),o.dispose())}return{get:function(o){if(o&&o.isTexture){const i=o.mapping,r=i===Pb||i===Ob,s=i===Db||i===Ub;if(r||s){if(o.isRenderTargetTexture&&!0===o.needsPMREMUpdate){o.needsPMREMUpdate=!1;let a=t.get(o);return null===n&&(n=new QG(e)),a=r?n.fromEquirectangular(o,a):n.fromCubemap(o,a),t.set(o,a),a.texture}if(t.has(o))return t.get(o).texture;{const i=o.image;if(r&&i&&i.height>0||s&&i&&function(e){let t=0;const n=6;for(let a=0;a<n;a++)void 0!==e[a]&&t++;return t===n}(i)){null===n&&(n=new QG(e));const i=r?n.fromEquirectangular(o):n.fromCubemap(o);return t.set(o,i),o.addEventListener("dispose",a),i.texture}return null}}}return o},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function nZ(e){const t={};function n(n){if(void 0!==t[n])return t[n];let a;switch(n){case"WEBGL_depth_texture":a=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=e.getExtension(n)}return t[n]=a,a}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function aZ(e,t,n,a){const o={},i=new WeakMap;function r(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);s.removeEventListener("dispose",r),delete o[s.id];const l=i.get(s);l&&(t.remove(l),i.delete(s)),a.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],a=e.index,o=e.attributes.position;let r=0;if(null!==a){const e=a.array;r=a.version;for(let t=0,a=e.length;t<a;t+=3){const a=e[t+0],o=e[t+1],i=e[t+2];n.push(a,o,o,i,i,a)}}else{const e=o.array;r=o.version;for(let t=0,a=e.length/3-1;t<a;t+=3){const e=t+0,a=t+1,o=t+2;n.push(e,a,a,o,o,e)}}const s=new(Sv(n)?Vx:Rx)(n,1);s.version=r;const l=i.get(e);l&&t.remove(l),i.set(e,s)}return{get:function(e,t){return!0===o[t.id]||(t.addEventListener("dispose",r),o[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const o in n)t.update(n[o],34962);const a=e.morphAttributes;for(const o in a){const e=a[o];for(let n=0,a=e.length;n<a;n++)t.update(e[n],34962)}},getWireframeAttribute:function(e){const t=i.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return i.get(e)}}}function oZ(e,t,n,a){const o=a.isWebGL2;let i,r,s;this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,s=e.bytesPerElement},this.render=function(t,a){e.drawElements(i,a,r,t*s),n.update(a,i,1)},this.renderInstances=function(a,l,c){if(0===c)return;let g,u;if(o)g=e,u="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===g)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[u](i,l,r,a*s,c),n.update(l,i,c)}}function iZ(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,a){switch(t.calls++,n){case 4:t.triangles+=a*(e/3);break;case 1:t.lines+=a*(e/2);break;case 3:t.lines+=a*(e-1);break;case 2:t.lines+=a*e;break;case 0:t.points+=a*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function rZ(e,t){return e[0]-t[0]}function sZ(e,t){return Math.abs(t[1])-Math.abs(e[1])}function lZ(e,t,n){const a={},o=new Float32Array(8),i=new WeakMap,r=new Yv,s=[];for(let l=0;l<8;l++)s[l]=[l,0];return{update:function(l,c,g){const u=l.morphTargetInfluences;if(!0===t.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,h=void 0!==d?d.length:0;let p=i.get(c);if(void 0===p||p.count!==h){void 0!==p&&p.texture.dispose();const C=void 0!==c.morphAttributes.position,f=void 0!==c.morphAttributes.normal,b=void 0!==c.morphAttributes.color,y=c.morphAttributes.position||[],A=c.morphAttributes.normal||[],v=c.morphAttributes.color||[];let S=0;!0===C&&(S=1),!0===f&&(S=2),!0===b&&(S=3);let x=c.attributes.position.count*S,G=1;x>t.maxTextureSize&&(G=Math.ceil(x/t.maxTextureSize),x=t.maxTextureSize);const Z=new Float32Array(x*G*4*h),w=new zv(Z,x,G,h);w.type=my,w.needsUpdate=!0;const k=4*S;for(let R=0;R<h;R++){const W=y[R],V=A[R],N=v[R],X=x*G*4*R;for(let M=0;M<W.count;M++){const T=M*k;!0===C&&(r.fromBufferAttribute(W,M),Z[X+T+0]=r.x,Z[X+T+1]=r.y,Z[X+T+2]=r.z,Z[X+T+3]=0),!0===f&&(r.fromBufferAttribute(V,M),Z[X+T+4]=r.x,Z[X+T+5]=r.y,Z[X+T+6]=r.z,Z[X+T+7]=0),!0===b&&(r.fromBufferAttribute(N,M),Z[X+T+8]=r.x,Z[X+T+9]=r.y,Z[X+T+10]=r.z,Z[X+T+11]=4===N.itemSize?r.w:1)}}function B(){w.dispose(),i.delete(c),c.removeEventListener("dispose",B)}p={count:h,texture:w,size:new yv(x,G)},i.set(c,p),c.addEventListener("dispose",B)}let m=0;for(let E=0;E<u.length;E++)m+=u[E];const I=c.morphTargetsRelative?1:1-m;g.getUniforms().setValue(e,"morphTargetBaseInfluence",I),g.getUniforms().setValue(e,"morphTargetInfluences",u),g.getUniforms().setValue(e,"morphTargetsTexture",p.texture,n),g.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{const F=void 0===u?0:u.length;let H=a[c.id];if(void 0===H||H.length!==F){H=[];for(let K=0;K<F;K++)H[K]=[K,0];a[c.id]=H}for(let D=0;D<F;D++){const U=H[D];U[0]=D,U[1]=u[D]}H.sort(sZ);for(let P=0;P<8;P++)P<F&&H[P][1]?(s[P][0]=H[P][0],s[P][1]=H[P][1]):(s[P][0]=Number.MAX_SAFE_INTEGER,s[P][1]=0);s.sort(rZ);const J=c.morphAttributes.position,Y=c.morphAttributes.normal;let L=0;for(let O=0;O<8;O++){const _=s[O],Q=_[0],j=_[1];Q!==Number.MAX_SAFE_INTEGER&&j?(J&&c.getAttribute("morphTarget"+O)!==J[Q]&&c.setAttribute("morphTarget"+O,J[Q]),Y&&c.getAttribute("morphNormal"+O)!==Y[Q]&&c.setAttribute("morphNormal"+O,Y[Q]),o[O]=j,L+=j):(J&&!0===c.hasAttribute("morphTarget"+O)&&c.deleteAttribute("morphTarget"+O),Y&&!0===c.hasAttribute("morphNormal"+O)&&c.deleteAttribute("morphNormal"+O),o[O]=0)}const z=c.morphTargetsRelative?1:1-L;g.getUniforms().setValue(e,"morphTargetBaseInfluence",z),g.getUniforms().setValue(e,"morphTargetInfluences",o)}}}}function cZ(e,t,n,a){let o=new WeakMap;function i(e){const t=e.target;t.removeEventListener("dispose",i),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const r=a.render.frame,s=e.geometry,l=t.get(e,s);return o.get(l)!==r&&(t.update(l),o.set(l,r)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",i)&&e.addEventListener("dispose",i),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){o=new WeakMap}}}const gZ=new Jv,uZ=new zv,dZ=new Dv,hZ=new bG,pZ=[],mZ=[],IZ=new Float32Array(16),CZ=new Float32Array(9),fZ=new Float32Array(4);function bZ(e,t,n){const a=e[0];if(a<=0||a>0)return e;const o=t*n;let i=pZ[o];if(void 0===i&&(i=new Float32Array(o),pZ[o]=i),0!==t){a.toArray(i,0);for(let a=1,o=0;a!==t;++a)o+=n,e[a].toArray(i,o)}return i}function yZ(e,t){if(e.length!==t.length)return!1;for(let n=0,a=e.length;n<a;n++)if(e[n]!==t[n])return!1;return!0}function AZ(e,t){for(let n=0,a=t.length;n<a;n++)e[n]=t[n]}function vZ(e,t){let n=mZ[t];void 0===n&&(n=new Int32Array(t),mZ[t]=n);for(let a=0;a!==t;++a)n[a]=e.allocateTextureUnit();return n}function SZ(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function xZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(yZ(n,t))return;e.uniform2fv(this.addr,t),AZ(n,t)}}function GZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(yZ(n,t))return;e.uniform3fv(this.addr,t),AZ(n,t)}}function ZZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(yZ(n,t))return;e.uniform4fv(this.addr,t),AZ(n,t)}}function wZ(e,t){const n=this.cache,a=t.elements;if(void 0===a){if(yZ(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),AZ(n,t)}else{if(yZ(n,a))return;fZ.set(a),e.uniformMatrix2fv(this.addr,!1,fZ),AZ(n,a)}}function kZ(e,t){const n=this.cache,a=t.elements;if(void 0===a){if(yZ(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),AZ(n,t)}else{if(yZ(n,a))return;CZ.set(a),e.uniformMatrix3fv(this.addr,!1,CZ),AZ(n,a)}}function BZ(e,t){const n=this.cache,a=t.elements;if(void 0===a){if(yZ(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),AZ(n,t)}else{if(yZ(n,a))return;IZ.set(a),e.uniformMatrix4fv(this.addr,!1,IZ),AZ(n,a)}}function RZ(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function WZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(yZ(n,t))return;e.uniform2iv(this.addr,t),AZ(n,t)}}function VZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(yZ(n,t))return;e.uniform3iv(this.addr,t),AZ(n,t)}}function NZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(yZ(n,t))return;e.uniform4iv(this.addr,t),AZ(n,t)}}function XZ(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function MZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(yZ(n,t))return;e.uniform2uiv(this.addr,t),AZ(n,t)}}function TZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(yZ(n,t))return;e.uniform3uiv(this.addr,t),AZ(n,t)}}function EZ(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(yZ(n,t))return;e.uniform4uiv(this.addr,t),AZ(n,t)}}function FZ(e,t,n){const a=this.cache,o=n.allocateTextureUnit();a[0]!==o&&(e.uniform1i(this.addr,o),a[0]=o),n.setTexture2D(t||gZ,o)}function HZ(e,t,n){const a=this.cache,o=n.allocateTextureUnit();a[0]!==o&&(e.uniform1i(this.addr,o),a[0]=o),n.setTexture3D(t||dZ,o)}function JZ(e,t,n){const a=this.cache,o=n.allocateTextureUnit();a[0]!==o&&(e.uniform1i(this.addr,o),a[0]=o),n.setTextureCube(t||hZ,o)}function YZ(e,t,n){const a=this.cache,o=n.allocateTextureUnit();a[0]!==o&&(e.uniform1i(this.addr,o),a[0]=o),n.setTexture2DArray(t||uZ,o)}function LZ(e,t){e.uniform1fv(this.addr,t)}function zZ(e,t){const n=bZ(t,this.size,2);e.uniform2fv(this.addr,n)}function KZ(e,t){const n=bZ(t,this.size,3);e.uniform3fv(this.addr,n)}function DZ(e,t){const n=bZ(t,this.size,4);e.uniform4fv(this.addr,n)}function UZ(e,t){const n=bZ(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function PZ(e,t){const n=bZ(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function OZ(e,t){const n=bZ(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function _Z(e,t){e.uniform1iv(this.addr,t)}function QZ(e,t){e.uniform2iv(this.addr,t)}function jZ(e,t){e.uniform3iv(this.addr,t)}function qZ(e,t){e.uniform4iv(this.addr,t)}function $Z(e,t){e.uniform1uiv(this.addr,t)}function ew(e,t){e.uniform2uiv(this.addr,t)}function tw(e,t){e.uniform3uiv(this.addr,t)}function nw(e,t){e.uniform4uiv(this.addr,t)}function aw(e,t,n){const a=this.cache,o=t.length,i=vZ(n,o);yZ(a,i)||(e.uniform1iv(this.addr,i),AZ(a,i));for(let r=0;r!==o;++r)n.setTexture2D(t[r]||gZ,i[r])}function ow(e,t,n){const a=this.cache,o=t.length,i=vZ(n,o);yZ(a,i)||(e.uniform1iv(this.addr,i),AZ(a,i));for(let r=0;r!==o;++r)n.setTexture3D(t[r]||dZ,i[r])}function iw(e,t,n){const a=this.cache,o=t.length,i=vZ(n,o);yZ(a,i)||(e.uniform1iv(this.addr,i),AZ(a,i));for(let r=0;r!==o;++r)n.setTextureCube(t[r]||hZ,i[r])}function rw(e,t,n){const a=this.cache,o=t.length,i=vZ(n,o);yZ(a,i)||(e.uniform1iv(this.addr,i),AZ(a,i));for(let r=0;r!==o;++r)n.setTexture2DArray(t[r]||uZ,i[r])}class sw{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return SZ;case 35664:return xZ;case 35665:return GZ;case 35666:return ZZ;case 35674:return wZ;case 35675:return kZ;case 35676:return BZ;case 5124:case 35670:return RZ;case 35667:case 35671:return WZ;case 35668:case 35672:return VZ;case 35669:case 35673:return NZ;case 5125:return XZ;case 36294:return MZ;case 36295:return TZ;case 36296:return EZ;case 35678:case 36198:case 36298:case 36306:case 35682:return FZ;case 35679:case 36299:case 36307:return HZ;case 35680:case 36300:case 36308:case 36293:return JZ;case 36289:case 36303:case 36311:case 36292:return YZ}}(t.type)}}class lw{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return LZ;case 35664:return zZ;case 35665:return KZ;case 35666:return DZ;case 35674:return UZ;case 35675:return PZ;case 35676:return OZ;case 5124:case 35670:return _Z;case 35667:case 35671:return QZ;case 35668:case 35672:return jZ;case 35669:case 35673:return qZ;case 5125:return $Z;case 36294:return ew;case 36295:return tw;case 36296:return nw;case 35678:case 36198:case 36298:case 36306:case 35682:return aw;case 35679:case 36299:case 36307:return ow;case 35680:case 36300:case 36308:case 36293:return iw;case 36289:case 36303:case 36311:case 36292:return rw}}(t.type)}}class cw{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const a=this.seq;for(let o=0,i=a.length;o!==i;++o){const i=a[o];i.setValue(e,t[i.id],n)}}}const gw=/(\w+)(\])?(\[|\.)?/g;function uw(e,t){e.seq.push(t),e.map[t.id]=t}function dw(e,t,n){const a=e.name,o=a.length;for(gw.lastIndex=0;;){const i=gw.exec(a),r=gw.lastIndex;let s=i[1];const l="]"===i[2],c=i[3];if(l&&(s|=0),void 0===c||"["===c&&r+2===o){uw(n,void 0===c?new sw(s,e,t):new lw(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new cw(s),uw(n,e)),n=e}}}class hw{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let a=0;a<n;++a){const n=e.getActiveUniform(t,a);dw(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,a){const o=this.map[t];void 0!==o&&o.setValue(e,n,a)}setOptional(e,t,n){const a=t[n];void 0!==a&&this.setValue(e,n,a)}static upload(e,t,n,a){for(let o=0,i=t.length;o!==i;++o){const i=t[o],r=n[i.id];!1!==r.needsUpdate&&i.setValue(e,r.value,a)}}static seqWithValue(e,t){const n=[];for(let a=0,o=e.length;a!==o;++a){const o=e[a];o.id in t&&n.push(o)}return n}}function pw(e,t,n){const a=e.createShader(t);return e.shaderSource(a,n),e.compileShader(a),a}let mw=0;function Iw(e,t,n){const a=e.getShaderParameter(t,35713),o=e.getShaderInfoLog(t).trim();if(a&&""===o)return"";const i=/ERROR: 0:(\d+)/.exec(o);if(i){const a=parseInt(i[1]);return n.toUpperCase()+"\n\n"+o+"\n\n"+function(e,t){const n=e.split("\n"),a=[],o=Math.max(t-6,0),i=Math.min(t+6,n.length);for(let r=o;r<i;r++){const e=r+1;a.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[r]))}return a.join("\n")}(e.getShaderSource(t),a)}return o}function Cw(e,t){const n=function(e){switch(e){case AA:return["Linear","( value )"];case vA:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function fw(e,t){let n;switch(t){case Hb:n="Linear";break;case Jb:n="Reinhard";break;case Yb:n="OptimizedCineon";break;case Lb:n="ACESFilmic";break;case zb:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function bw(e){return""!==e}function yw(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Aw(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const vw=/^[ \t]*#include +<([\w\d./]+)>/gm;function Sw(e){return e.replace(vw,xw)}function xw(e,t){const n=WG[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Sw(n)}const Gw=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Zw(e){return e.replace(Gw,ww)}function ww(e,t,n,a){let o="";for(let i=parseInt(t);i<parseInt(n);i++)o+=a.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return o}function kw(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Bw(e,t,n,a){const o=e.getContext(),i=n.defines;let r=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===qf?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===$f?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===eb&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Db:case Ub:t="ENVMAP_TYPE_CUBE";break;case _b:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),g=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Ub&&(t="ENVMAP_MODE_REFRACTION");return t}(n),u=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Mb:t="ENVMAP_BLENDING_MULTIPLY";break;case Tb:t="ENVMAP_BLENDING_MIX";break;case Eb:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,a=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:a,maxMip:n}}(n),h=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(bw).join("\n")}(n),p=function(e){const t=[];for(const n in e){const a=e[n];!1!==a&&t.push("#define "+n+" "+a)}return t.join("\n")}(i),m=o.createProgram();let I,C,f=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(I=[p].filter(bw).join("\n"),I.length>0&&(I+="\n"),C=[h,p].filter(bw).join("\n"),C.length>0&&(C+="\n")):(I=[kw(n),"#define SHADER_NAME "+n.shaderName,p,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.vertexUvs2?"#define USE_UV2":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(bw).join("\n"),C=[h,kw(n),"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+g:"",n.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs2?"#define USE_UV2":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Fb?"#define TONE_MAPPING":"",n.toneMapping!==Fb?WG.tonemapping_pars_fragment:"",n.toneMapping!==Fb?fw("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",WG.encodings_pars_fragment,Cw("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(bw).join("\n")),r=Sw(r),r=yw(r,n),r=Aw(r,n),s=Sw(s),s=yw(s,n),s=Aw(s,n),r=Zw(r),s=Zw(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(f="#version 300 es\n",I=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+I,C=["#define varying in",n.glslVersion===av?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===av?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+C);const b=f+C+s,y=pw(o,35633,f+I+r),A=pw(o,35632,b);if(o.attachShader(m,y),o.attachShader(m,A),void 0!==n.index0AttributeName?o.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(m,0,"position"),o.linkProgram(m),e.debug.checkShaderErrors){const t=o.getProgramInfoLog(m).trim(),n=o.getShaderInfoLog(y).trim(),a=o.getShaderInfoLog(A).trim();let i=!0,r=!0;if(!1===o.getProgramParameter(m,35714))if(i=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(o,m,y,A);else{const e=Iw(o,y,"vertex"),n=Iw(o,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==n&&""!==a||(r=!1);r&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:n,prefix:I},fragmentShader:{log:a,prefix:C}})}let v,S;return o.deleteShader(y),o.deleteShader(A),this.getUniforms=function(){return void 0===v&&(v=new hw(o,m)),v},this.getAttributes=function(){return void 0===S&&(S=function(e,t){const n={},a=e.getProgramParameter(t,35721);for(let o=0;o<a;o++){const a=e.getActiveAttrib(t,o),i=a.name;let r=1;35674===a.type&&(r=2),35675===a.type&&(r=3),35676===a.type&&(r=4),n[i]={type:a.type,location:e.getAttribLocation(t,i),locationSize:r}}return n}(o,m)),S},this.destroy=function(){a.releaseStatesOfProgram(this),o.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=mw++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=y,this.fragmentShader=A,this}let Rw=0;class Ww{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,a=this._getShaderStage(t),o=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return!1===i.has(a)&&(i.add(a),a.usedTimes++),!1===i.has(o)&&(i.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Vw(e),t.set(e,n)),n}}class Vw{constructor(e){this.id=Rw++,this.code=e,this.usedTimes=0}}function Nw(e,t,n,a,o,i,r){const s=new TS,l=new Ww,c=[],g=o.isWebGL2,u=o.logarithmicDepthBuffer,d=o.vertexTextures;let h=o.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 1===e?"uv2":"uv"}return{getParameters:function(i,s,c,I,C){const f=I.fog,b=C.geometry,y=i.isMeshStandardMaterial?I.environment:null,A=(i.isMeshStandardMaterial?n:t).get(i.envMap||y),v=A&&A.mapping===_b?A.image.height:null,S=p[i.type];null!==i.precision&&(h=o.getMaxPrecision(i.precision),h!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",h,"instead."));const x=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,G=void 0!==x?x.length:0;let Z,w,k,B,R=0;if(void 0!==b.morphAttributes.position&&(R=1),void 0!==b.morphAttributes.normal&&(R=2),void 0!==b.morphAttributes.color&&(R=3),S){const e=NG[S];Z=e.vertexShader,w=e.fragmentShader}else Z=i.vertexShader,w=i.fragmentShader,l.update(i),k=l.getVertexShaderID(i),B=l.getFragmentShaderID(i);const W=e.getRenderTarget(),V=!0===C.isInstancedMesh,N=!!i.map,X=!!i.matcap,M=!!A,T=!!i.aoMap,E=!!i.lightMap,F=!!i.bumpMap,H=!!i.normalMap,J=!!i.displacementMap,Y=!!i.emissiveMap,L=!!i.metalnessMap,z=!!i.roughnessMap,K=i.clearcoat>0,D=i.iridescence>0,U=i.sheen>0,P=i.transmission>0,O=K&&!!i.clearcoatMap,_=K&&!!i.clearcoatNormalMap,Q=K&&!!i.clearcoatRoughnessMap,j=D&&!!i.iridescenceMap,q=D&&!!i.iridescenceThicknessMap,$=U&&!!i.sheenColorMap,ee=U&&!!i.sheenRoughnessMap,te=!!i.specularMap,ne=!!i.specularColorMap,ae=!!i.specularIntensityMap,oe=P&&!!i.transmissionMap,ie=P&&!!i.thicknessMap,re=!!i.gradientMap,se=!!i.alphaMap,le=i.alphaTest>0,ce=!!i.extensions,ge=!!b.attributes.uv,ue=!!b.attributes.uv2;return{isWebGL2:g,shaderID:S,shaderName:i.type,vertexShader:Z,fragmentShader:w,defines:i.defines,customVertexShaderID:k,customFragmentShaderID:B,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:h,instancing:V,instancingColor:V&&null!==C.instanceColor,supportsVertexTextures:d,outputEncoding:null===W?e.outputEncoding:!0===W.isXRRenderTarget?W.texture.encoding:AA,map:N,matcap:X,envMap:M,envMapMode:M&&A.mapping,envMapCubeUVHeight:v,aoMap:T,lightMap:E,bumpMap:F,normalMap:H,displacementMap:d&&J,emissiveMap:Y,normalMapObjectSpace:H&&i.normalMapType===ZA,normalMapTangentSpace:H&&i.normalMapType===GA,decodeVideoTexture:N&&!0===i.map.isVideoTexture&&i.map.encoding===vA,metalnessMap:L,roughnessMap:z,clearcoat:K,clearcoatMap:O,clearcoatNormalMap:_,clearcoatRoughnessMap:Q,iridescence:D,iridescenceMap:j,iridescenceThicknessMap:q,sheen:U,sheenColorMap:$,sheenRoughnessMap:ee,specularMap:te,specularColorMap:ne,specularIntensityMap:ae,transmission:P,transmissionMap:oe,thicknessMap:ie,gradientMap:re,opaque:!1===i.transparent&&i.blending===rb,alphaMap:se,alphaTest:le,combine:i.combine,mapUv:N&&m(i.map.channel),aoMapUv:T&&m(i.aoMap.channel),lightMapUv:E&&m(i.lightMap.channel),bumpMapUv:F&&m(i.bumpMap.channel),normalMapUv:H&&m(i.normalMap.channel),displacementMapUv:J&&m(i.displacementMap.channel),emissiveMapUv:Y&&m(i.emissiveMap.channel),metalnessMapUv:L&&m(i.metalnessMap.channel),roughnessMapUv:z&&m(i.roughnessMap.channel),clearcoatMapUv:O&&m(i.clearcoatMap.channel),clearcoatNormalMapUv:_&&m(i.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Q&&m(i.clearcoatRoughnessMap.channel),iridescenceMapUv:j&&m(i.iridescenceMap.channel),iridescenceThicknessMapUv:q&&m(i.iridescenceThicknessMap.channel),sheenColorMapUv:$&&m(i.sheenColorMap.channel),sheenRoughnessMapUv:ee&&m(i.sheenRoughnessMap.channel),specularMapUv:te&&m(i.specularMap.channel),specularColorMapUv:ne&&m(i.specularColorMap.channel),specularIntensityMapUv:ae&&m(i.specularIntensityMap.channel),transmissionMapUv:oe&&m(i.transmissionMap.channel),thicknessMapUv:ie&&m(i.thicknessMap.channel),alphaMapUv:se&&m(i.alphaMap.channel),vertexTangents:H&&!!b.attributes.tangent,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:ge,vertexUvs2:ue,pointsUvs:!0===C.isPoints&&!!b.attributes.uv&&(N||se),fog:!!f,useFog:!0===i.fog,fogExp2:f&&f.isFogExp2,flatShading:!0===i.flatShading,sizeAttenuation:!0===i.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===C.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:G,morphTextureStride:R,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:Fb,useLegacyLights:e.useLegacyLights,premultipliedAlpha:i.premultipliedAlpha,doubleSided:i.side===ab,flipSided:i.side===nb,useDepthPacking:i.depthPacking>=0,depthPacking:i.depthPacking||0,index0AttributeName:i.index0AttributeName,extensionDerivatives:ce&&!0===i.extensions.derivatives,extensionFragDepth:ce&&!0===i.extensions.fragDepth,extensionDrawBuffers:ce&&!0===i.extensions.drawBuffers,extensionShaderTextureLOD:ce&&!0===i.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||a.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||a.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||a.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.matcap&&s.enable(4);t.envMap&&s.enable(5);t.normalMapObjectSpace&&s.enable(6);t.normalMapTangentSpace&&s.enable(7);t.clearcoat&&s.enable(8);t.iridescence&&s.enable(9);t.alphaTest&&s.enable(10);t.vertexColors&&s.enable(11);t.vertexAlphas&&s.enable(12);t.vertexUvs&&s.enable(13);t.vertexUvs2&&s.enable(14);t.vertexTangents&&s.enable(15);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.useLegacyLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.decodeVideoTexture&&s.enable(17);t.opaque&&s.enable(18);t.pointsUvs&&s.enable(19);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=NG[t];n=hG.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let a;for(let e=0,o=c.length;e<o;e++){const t=c[e];if(t.cacheKey===n){a=t,++a.usedTimes;break}}return void 0===a&&(a=new Bw(e,n,t,i),c.push(a)),a},releaseProgram:function(e){if(0===--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Xw(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,a){e.get(t)[n]=a},dispose:function(){e=new WeakMap}}}function Mw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Tw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ew(){const e=[];let t=0;const n=[],a=[],o=[];function i(n,a,o,i,r,s){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:a,material:o,groupOrder:i,renderOrder:n.renderOrder,z:r,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=a,l.material=o,l.groupOrder=i,l.renderOrder=n.renderOrder,l.z=r,l.group=s),t++,l}return{opaque:n,transmissive:a,transparent:o,init:function(){t=0,n.length=0,a.length=0,o.length=0},push:function(e,t,r,s,l,c){const g=i(e,t,r,s,l,c);r.transmission>0?a.push(g):!0===r.transparent?o.push(g):n.push(g)},unshift:function(e,t,r,s,l,c){const g=i(e,t,r,s,l,c);r.transmission>0?a.unshift(g):!0===r.transparent?o.unshift(g):n.unshift(g)},finish:function(){for(let n=t,a=e.length;n<a;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Mw),a.length>1&&a.sort(t||Tw),o.length>1&&o.sort(t||Tw)}}}function Fw(){let e=new WeakMap;return{get:function(t,n){const a=e.get(t);let o;return void 0===a?(o=new Ew,e.set(t,[o])):n>=a.length?(o=new Ew,a.push(o)):o=a[n],o},dispose:function(){e=new WeakMap}}}function Hw(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new _v,color:new mx};break;case"SpotLight":n={position:new _v,direction:new _v,color:new mx,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new _v,color:new mx,distance:0,decay:0};break;case"HemisphereLight":n={direction:new _v,skyColor:new mx,groundColor:new mx};break;case"RectAreaLight":n={color:new mx,position:new _v,halfWidth:new _v,halfHeight:new _v}}return e[t.id]=n,n}}}let Jw=0;function Yw(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Lw(e,t){const n=new Hw,a=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yv};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yv,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)o.probe.push(new _v);const i=new _v,r=new GS,s=new GS;return{setup:function(i,r){let s=0,l=0,c=0;for(let e=0;e<9;e++)o.probe[e].set(0,0,0);let g=0,u=0,d=0,h=0,p=0,m=0,I=0,C=0,f=0,b=0;i.sort(Yw);const y=!0===r?Math.PI:1;for(let e=0,t=i.length;e<t;e++){const t=i[e],r=t.color,A=t.intensity,v=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=r.r*A*y,l+=r.g*A*y,c+=r.b*A*y;else if(t.isLightProbe)for(let e=0;e<9;e++)o.probe[e].addScaledVector(t.sh.coefficients[e],A);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,n=a.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,o.directionalShadow[g]=n,o.directionalShadowMap[g]=S,o.directionalShadowMatrix[g]=t.shadow.matrix,m++}o.directional[g]=e,g++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(r).multiplyScalar(A*y),e.distance=v,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,o.spot[d]=e;const i=t.shadow;if(t.map&&(o.spotLightMap[f]=t.map,f++,i.updateMatrices(t),t.castShadow&&b++),o.spotLightMatrix[d]=i.matrix,t.castShadow){const e=a.get(t);e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,o.spotShadow[d]=e,o.spotShadowMap[d]=S,C++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(r).multiplyScalar(A),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),o.rectArea[h]=e,h++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=a.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,o.pointShadow[u]=n,o.pointShadowMap[u]=S,o.pointShadowMatrix[u]=t.shadow.matrix,I++}o.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(A*y),e.groundColor.copy(t.groundColor).multiplyScalar(A*y),o.hemi[p]=e,p++}}h>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(o.rectAreaLTC1=VG.LTC_FLOAT_1,o.rectAreaLTC2=VG.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(o.rectAreaLTC1=VG.LTC_HALF_1,o.rectAreaLTC2=VG.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=s,o.ambient[1]=l,o.ambient[2]=c;const A=o.hash;A.directionalLength===g&&A.pointLength===u&&A.spotLength===d&&A.rectAreaLength===h&&A.hemiLength===p&&A.numDirectionalShadows===m&&A.numPointShadows===I&&A.numSpotShadows===C&&A.numSpotMaps===f||(o.directional.length=g,o.spot.length=d,o.rectArea.length=h,o.point.length=u,o.hemi.length=p,o.directionalShadow.length=m,o.directionalShadowMap.length=m,o.pointShadow.length=I,o.pointShadowMap.length=I,o.spotShadow.length=C,o.spotShadowMap.length=C,o.directionalShadowMatrix.length=m,o.pointShadowMatrix.length=I,o.spotLightMatrix.length=C+f-b,o.spotLightMap.length=f,o.numSpotLightShadowsWithMaps=b,A.directionalLength=g,A.pointLength=u,A.spotLength=d,A.rectAreaLength=h,A.hemiLength=p,A.numDirectionalShadows=m,A.numPointShadows=I,A.numSpotShadows=C,A.numSpotMaps=f,o.version=Jw++)},setupView:function(e,t){let n=0,a=0,l=0,c=0,g=0;const u=t.matrixWorldInverse;for(let d=0,h=e.length;d<h;d++){const t=e[d];if(t.isDirectionalLight){const e=o.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(u),n++}else if(t.isSpotLight){const e=o.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(u),l++}else if(t.isRectAreaLight){const e=o.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(u),s.identity(),r.copy(t.matrixWorld),r.premultiply(u),s.extractRotation(r),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=o.point[a];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(u),a++}else if(t.isHemisphereLight){const e=o.hemi[g];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(u),g++}}},state:o}}function zw(e,t){const n=new Lw(e,t),a=[],o=[];return{init:function(){a.length=0,o.length=0},state:{lightsArray:a,shadowsArray:o,lights:n},setupLights:function(e){n.setup(a,e)},setupLightsView:function(e){n.setupView(a,e)},pushLight:function(e){a.push(e)},pushShadow:function(e){o.push(e)}}}function Kw(e,t){let n=new WeakMap;return{get:function(a){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=n.get(a);let r;return void 0===i?(r=new zw(e,t),n.set(a,[r])):o>=i.length?(r=new zw(e,t),i.push(r)):r=i[o],r},dispose:function(){n=new WeakMap}}}class Dw extends gx{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=SA,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Uw extends gx{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Pw(e,t,n){let a=new wG;const o=new yv,i=new yv,r=new Yv,s=new Dw({depthPacking:xA}),l=new Uw,c={},g=n.maxTextureSize,u={[tb]:nb,[nb]:tb,[ab]:ab},d=new pG({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yv},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),h=d.clone();h.defines.HORIZONTAL_PASS=1;const p=new zx;p.setAttribute("position",new Gx(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new sG(p,d),I=this;function C(n,a){const i=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,h.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,h.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Lv(o.x,o.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(a,null,i,d,m,null),h.uniforms.shadow_pass.value=n.mapPass.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(a,null,i,h,m,null)}function f(t,n,a,o){let i=null;const r=!0===a.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==r)i=r;else if(i=!0===a.isPointLight?l:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=i.uuid,t=n.uuid;let a=c[e];void 0===a&&(a={},c[e]=a);let o=a[t];void 0===o&&(o=i.clone(),a[t]=o),i=o}if(i.visible=n.visible,i.wireframe=n.wireframe,i.side=o===eb?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],i.alphaMap=n.alphaMap,i.alphaTest=n.alphaTest,i.map=n.map,i.clipShadows=n.clipShadows,i.clippingPlanes=n.clippingPlanes,i.clipIntersection=n.clipIntersection,i.displacementMap=n.displacementMap,i.displacementScale=n.displacementScale,i.displacementBias=n.displacementBias,i.wireframeLinewidth=n.wireframeLinewidth,i.linewidth=n.linewidth,!0===a.isPointLight&&!0===i.isMeshDistanceMaterial){e.properties.get(i).light=a}return i}function b(n,o,i,r,s){if(!1===n.visible)return;if(n.layers.test(o.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===eb)&&(!n.frustumCulled||a.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);const a=t.update(n),o=n.material;if(Array.isArray(o)){const t=a.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],g=o[c.materialIndex];if(g&&g.visible){const t=f(n,g,r,s);e.renderBufferDirect(i,null,a,t,n,c)}}}else if(o.visible){const t=f(n,o,r,s);e.renderBufferDirect(i,null,a,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],o,i,r,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=qf,this.render=function(t,n,s){if(!1===I.enabled)return;if(!1===I.autoUpdate&&!1===I.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(ib),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let h=0,p=t.length;h<p;h++){const l=t[h],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;o.copy(c.mapSize);const u=c.getFrameExtents();if(o.multiply(u),i.copy(c.mapSize),(o.x>g||o.y>g)&&(o.x>g&&(i.x=Math.floor(g/u.x),o.x=i.x*u.x,c.mapSize.x=i.x),o.y>g&&(i.y=Math.floor(g/u.y),o.y=i.y*u.y,c.mapSize.y=i.y)),null===c.map){const e=this.type!==eb?{minFilter:$b,magFilter:$b}:{};c.map=new Lv(o.x,o.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const p=c.getViewportCount();for(let e=0;e<p;e++){const t=c.getViewport(e);r.set(i.x*t.x,i.y*t.y,i.x*t.z,i.y*t.w),d.viewport(r),c.updateMatrices(l,e),a=c.getFrustum(),b(n,s,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===eb&&C(c,s),c.needsUpdate=!1}I.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function Ow(e,t,n){const a=n.isWebGL2;const o=new function(){let t=!1;const n=new Yv;let a=null;const o=new Yv(0,0,0,0);return{setMask:function(n){a===n||t||(e.colorMask(n,n,n,n),a=n)},setLocked:function(e){t=e},setClear:function(t,a,i,r,s){!0===s&&(t*=r,a*=r,i*=r),n.set(t,a,i,r),!1===o.equals(n)&&(e.clearColor(t,a,i,r),o.copy(n))},reset:function(){t=!1,a=null,o.set(-1,0,0,0)}}},i=new function(){let t=!1,n=null,a=null,o=null;return{setTest:function(e){e?J(2929):Y(2929)},setMask:function(a){n===a||t||(e.depthMask(a),n=a)},setFunc:function(t){if(a!==t){switch(t){case wb:e.depthFunc(512);break;case kb:e.depthFunc(519);break;case Bb:e.depthFunc(513);break;case Rb:e.depthFunc(515);break;case Wb:e.depthFunc(514);break;case Vb:e.depthFunc(518);break;case Nb:e.depthFunc(516);break;case Xb:e.depthFunc(517);break;default:e.depthFunc(515)}a=t}},setLocked:function(e){t=e},setClear:function(t){o!==t&&(e.clearDepth(t),o=t)},reset:function(){t=!1,n=null,a=null,o=null}}},r=new function(){let t=!1,n=null,a=null,o=null,i=null,r=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?J(2960):Y(2960))},setMask:function(a){n===a||t||(e.stencilMask(a),n=a)},setFunc:function(t,n,r){a===t&&o===n&&i===r||(e.stencilFunc(t,n,r),a=t,o=n,i=r)},setOp:function(t,n,a){r===t&&s===n&&l===a||(e.stencilOp(t,n,a),r=t,s=n,l=a)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,a=null,o=null,i=null,r=null,s=null,l=null,c=null}}},s=new WeakMap,l=new WeakMap;let c={},g={},u=new WeakMap,d=[],h=null,p=!1,m=null,I=null,C=null,f=null,b=null,y=null,A=null,v=!1,S=null,x=null,G=null,Z=null,w=null;const k=e.getParameter(35661);let B=!1,R=0;const W=e.getParameter(7938);-1!==W.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(W)[1]),B=R>=1):-1!==W.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]),B=R>=2);let V=null,N={};const X=e.getParameter(3088),M=e.getParameter(2978),T=(new Yv).fromArray(X),E=(new Yv).fromArray(M);function F(t,n,a){const o=new Uint8Array(4),i=e.createTexture();e.bindTexture(t,i),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let r=0;r<a;r++)e.texImage2D(n+r,0,6408,1,1,0,6408,5121,o);return i}const H={};function J(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function Y(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}H[3553]=F(3553,3553,1),H[34067]=F(34067,34069,6),o.setClear(0,0,0,1),i.setClear(1),r.setClear(0),J(2929),i.setFunc(Rb),D(!1),U(Of),J(2884),K(ib);const L={[ub]:32774,[db]:32778,[hb]:32779};if(a)L[pb]=32775,L[mb]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(L[pb]=e.MIN_EXT,L[mb]=e.MAX_EXT)}const z={[Ib]:0,[Cb]:1,[fb]:768,[yb]:770,[Zb]:776,[xb]:774,[vb]:772,[bb]:769,[Ab]:771,[Gb]:775,[Sb]:773};function K(t,n,a,o,i,r,s,l){if(t!==ib){if(!1===p&&(J(3042),p=!0),t===gb)i=i||n,r=r||a,s=s||o,n===I&&i===b||(e.blendEquationSeparate(L[n],L[i]),I=n,b=i),a===C&&o===f&&r===y&&s===A||(e.blendFuncSeparate(z[a],z[o],z[r],z[s]),C=a,f=o,y=r,A=s),m=t,v=!1;else if(t!==m||l!==v){if(I===ub&&b===ub||(e.blendEquation(32774),I=ub,b=ub),l)switch(t){case rb:e.blendFuncSeparate(1,771,1,771);break;case sb:e.blendFunc(1,1);break;case lb:e.blendFuncSeparate(0,769,0,1);break;case cb:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case rb:e.blendFuncSeparate(770,771,1,771);break;case sb:e.blendFunc(770,1);break;case lb:e.blendFuncSeparate(0,769,0,1);break;case cb:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}C=null,f=null,y=null,A=null,m=t,v=l}}else!0===p&&(Y(3042),p=!1)}function D(t){S!==t&&(t?e.frontFace(2304):e.frontFace(2305),S=t)}function U(t){t!==Pf?(J(2884),t!==x&&(t===Of?e.cullFace(1029):t===_f?e.cullFace(1028):e.cullFace(1032))):Y(2884),x=t}function P(t,n,a){t?(J(32823),Z===n&&w===a||(e.polygonOffset(n,a),Z=n,w=a)):Y(32823)}return{buffers:{color:o,depth:i,stencil:r},enable:J,disable:Y,bindFramebuffer:function(t,n){return g[t]!==n&&(e.bindFramebuffer(t,n),g[t]=n,a&&(36009===t&&(g[36160]=n),36160===t&&(g[36009]=n)),!0)},drawBuffers:function(a,o){let i=d,r=!1;if(a)if(i=u.get(o),void 0===i&&(i=[],u.set(o,i)),a.isWebGLMultipleRenderTargets){const e=a.texture;if(i.length!==e.length||36064!==i[0]){for(let t=0,n=e.length;t<n;t++)i[t]=36064+t;i.length=e.length,r=!0}}else 36064!==i[0]&&(i[0]=36064,r=!0);else 1029!==i[0]&&(i[0]=1029,r=!0);r&&(n.isWebGL2?e.drawBuffers(i):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(i))},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:K,setMaterial:function(e,t){e.side===ab?Y(2884):J(2884);let n=e.side===nb;t&&(n=!n),D(n),e.blending===rb&&!1===e.transparent?K(ib):K(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),o.setMask(e.colorWrite);const a=e.stencilWrite;r.setTest(a),a&&(r.setMask(e.stencilWriteMask),r.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),r.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),P(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?J(32926):Y(32926)},setFlipSided:D,setCullFace:U,setLineWidth:function(t){t!==G&&(B&&e.lineWidth(t),G=t)},setPolygonOffset:P,setScissorTest:function(e){e?J(3089):Y(3089)},activeTexture:function(t){void 0===t&&(t=33984+k-1),V!==t&&(e.activeTexture(t),V=t)},bindTexture:function(t,n,a){void 0===a&&(a=null===V?33984+k-1:V);let o=N[a];void 0===o&&(o={type:void 0,texture:void 0},N[a]=o),o.type===t&&o.texture===n||(V!==a&&(e.activeTexture(a),V=a),e.bindTexture(t,n||H[t]),o.type=t,o.texture=n)},unbindTexture:function(){const t=N[V];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let a=l.get(n);void 0===a&&(a=new WeakMap,l.set(n,a));let o=a.get(t);void 0===o&&(o=e.getUniformBlockIndex(n,t.name),a.set(t,o))},uniformBlockBinding:function(t,n){const a=l.get(n).get(t);s.get(n)!==a&&(e.uniformBlockBinding(n,a,t.__bindingPointIndex),s.set(n,a))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===T.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),T.copy(t))},viewport:function(t){!1===E.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),E.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},V=null,N={},g={},u=new WeakMap,d=[],h=null,p=!1,m=null,I=null,C=null,f=null,b=null,y=null,A=null,v=!1,S=null,x=null,G=null,Z=null,w=null,T.set(0,0,e.canvas.width,e.canvas.height),E.set(0,0,e.canvas.width,e.canvas.height),o.reset(),i.reset(),r.reset()}}}function _w(e,t,n,a,o,i,r){const s=o.isWebGL2,l=o.maxTextures,c=o.maxCubemapSize,g=o.maxTextureSize,u=o.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,h="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const I=new WeakMap;let C=!1;try{C="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(L){}function f(e,t){return C?new OffscreenCanvas(e,t):Zv("canvas")}function b(e,t,n,a){let o=1;if((e.width>a||e.height>a)&&(o=a/Math.max(e.width,e.height)),o<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const a=t?Iv:Math.floor,i=a(o*e.width),r=a(o*e.height);void 0===m&&(m=f(i,r));const s=n?f(i,r):m;s.width=i,s.height=r;return s.getContext("2d").drawImage(e,0,0,i,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+i+"x"+r+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return pv(e.width)&&pv(e.height)}function A(e,t){return e.generateMipmaps&&t&&e.minFilter!==$b&&e.minFilter!==oy}function v(t){e.generateMipmap(t)}function S(n,a,o,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===s)return a;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=a;return 6403===a&&(5126===o&&(l=33326),5131===o&&(l=33325),5121===o&&(l=33321)),33319===a&&(5126===o&&(l=33328),5131===o&&(l=33327),5121===o&&(l=33323)),6408===a&&(5126===o&&(l=34836),5131===o&&(l=34842),5121===o&&(l=i===vA&&!1===r?35907:32856),32819===o&&(l=32854),32820===o&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||t.get("EXT_color_buffer_float"),l}function x(e,t,n){return!0===A(e,n)||e.isFramebufferTexture&&e.minFilter!==$b&&e.minFilter!==oy?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function G(e){return e===$b||e===ey||e===ny?9728:9729}function Z(e){const t=e.target;t.removeEventListener("dispose",Z),function(e){const t=a.get(e);if(void 0===t.__webglInit)return;const n=e.source,o=I.get(n);if(o){const a=o[t.__cacheKey];a.usedTimes--,0===a.usedTimes&&k(e),0===Object.keys(o).length&&I.delete(n)}a.remove(e)}(t),t.isVideoTexture&&p.delete(t)}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=t.texture,o=a.get(t),i=a.get(n);void 0!==i.__webglTexture&&(e.deleteTexture(i.__webglTexture),r.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let a=0;a<6;a++)e.deleteFramebuffer(o.__webglFramebuffer[a]),o.__webglDepthbuffer&&e.deleteRenderbuffer(o.__webglDepthbuffer[a]);else{if(e.deleteFramebuffer(o.__webglFramebuffer),o.__webglDepthbuffer&&e.deleteRenderbuffer(o.__webglDepthbuffer),o.__webglMultisampledFramebuffer&&e.deleteFramebuffer(o.__webglMultisampledFramebuffer),o.__webglColorRenderbuffer)for(let t=0;t<o.__webglColorRenderbuffer.length;t++)o.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(o.__webglColorRenderbuffer[t]);o.__webglDepthRenderbuffer&&e.deleteRenderbuffer(o.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let s=0,l=n.length;s<l;s++){const t=a.get(n[s]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),r.memory.textures--),a.remove(n[s])}a.remove(n),a.remove(t)}(n)}function k(t){const n=a.get(t);e.deleteTexture(n.__webglTexture);const o=t.source;delete I.get(o)[n.__cacheKey],r.memory.textures--}let B=0;function R(e,t){const o=a.get(e);if(e.isVideoTexture&&function(e){const t=r.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&o.__version!==e.version){const n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void M(o,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(3553,o.__webglTexture,33984+t)}const W={[Qb]:10497,[jb]:33071,[qb]:33648},V={[$b]:9728,[ey]:9984,[ny]:9986,[oy]:9729,[iy]:9985,[sy]:9987};function N(n,i,r){if(r?(e.texParameteri(n,10242,W[i.wrapS]),e.texParameteri(n,10243,W[i.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,W[i.wrapR]),e.texParameteri(n,10240,V[i.magFilter]),e.texParameteri(n,10241,V[i.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),i.wrapS===jb&&i.wrapT===jb||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,G(i.magFilter)),e.texParameteri(n,10241,G(i.minFilter)),i.minFilter!==$b&&i.minFilter!==oy&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const r=t.get("EXT_texture_filter_anisotropic");if(i.magFilter===$b)return;if(i.minFilter!==ny&&i.minFilter!==sy)return;if(i.type===my&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&i.type===Iy&&!1===t.has("OES_texture_half_float_linear"))return;(i.anisotropy>1||a.get(i).__currentAnisotropy)&&(e.texParameterf(n,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,o.getMaxAnisotropy())),a.get(i).__currentAnisotropy=i.anisotropy)}}function X(t,n){let a=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",Z));const o=n.source;let i=I.get(o);void 0===i&&(i={},I.set(o,i));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===i[s]&&(i[s]={texture:e.createTexture(),usedTimes:0},r.memory.textures++,a=!0),i[s].usedTimes++;const o=i[t.__cacheKey];void 0!==o&&(i[t.__cacheKey].usedTimes--,0===o.usedTimes&&k(n)),t.__cacheKey=s,t.__webglTexture=i[s].texture}return a}function M(t,o,r){let l=3553;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=35866),o.isData3DTexture&&(l=32879);const c=X(t,o),u=o.source;n.bindTexture(l,t.__webglTexture,33984+r);const d=a.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(33984+r),e.pixelStorei(37440,o.flipY),e.pixelStorei(37441,o.premultiplyAlpha),e.pixelStorei(3317,o.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!s&&(e.wrapS!==jb||e.wrapT!==jb||e.minFilter!==$b&&e.minFilter!==oy)}(o)&&!1===y(o.image);let a=b(o.image,t,!1,g);a=Y(o,a);const h=y(a)||s,p=i.convert(o.format,o.encoding);let m,I=i.convert(o.type),C=S(o.internalFormat,p,I,o.encoding,o.isVideoTexture);N(l,o,h);const f=o.mipmaps,G=s&&!0!==o.isVideoTexture,Z=void 0===d.__version||!0===c,w=x(o,a,h);if(o.isDepthTexture)C=6402,s?C=o.type===my?36012:o.type===py?33190:o.type===by?35056:33189:o.type===my&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),o.format===xy&&6402===C&&o.type!==dy&&o.type!==py&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),o.type=py,I=i.convert(o.type)),o.format===Gy&&6402===C&&(C=34041,o.type!==by&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),o.type=by,I=i.convert(o.type))),Z&&(G?n.texStorage2D(3553,1,C,a.width,a.height):n.texImage2D(3553,0,C,a.width,a.height,0,p,I,null));else if(o.isDataTexture)if(f.length>0&&h){G&&Z&&n.texStorage2D(3553,w,C,f[0].width,f[0].height);for(let e=0,t=f.length;e<t;e++)m=f[e],G?n.texSubImage2D(3553,e,0,0,m.width,m.height,p,I,m.data):n.texImage2D(3553,e,C,m.width,m.height,0,p,I,m.data);o.generateMipmaps=!1}else G?(Z&&n.texStorage2D(3553,w,C,a.width,a.height),n.texSubImage2D(3553,0,0,0,a.width,a.height,p,I,a.data)):n.texImage2D(3553,0,C,a.width,a.height,0,p,I,a.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){G&&Z&&n.texStorage3D(35866,w,C,f[0].width,f[0].height,a.depth);for(let e=0,t=f.length;e<t;e++)m=f[e],o.format!==Ay?null!==p?G?n.compressedTexSubImage3D(35866,e,0,0,0,m.width,m.height,a.depth,p,m.data,0,0):n.compressedTexImage3D(35866,e,C,m.width,m.height,a.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):G?n.texSubImage3D(35866,e,0,0,0,m.width,m.height,a.depth,p,I,m.data):n.texImage3D(35866,e,C,m.width,m.height,a.depth,0,p,I,m.data)}else{G&&Z&&n.texStorage2D(3553,w,C,f[0].width,f[0].height);for(let e=0,t=f.length;e<t;e++)m=f[e],o.format!==Ay?null!==p?G?n.compressedTexSubImage2D(3553,e,0,0,m.width,m.height,p,m.data):n.compressedTexImage2D(3553,e,C,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):G?n.texSubImage2D(3553,e,0,0,m.width,m.height,p,I,m.data):n.texImage2D(3553,e,C,m.width,m.height,0,p,I,m.data)}else if(o.isDataArrayTexture)G?(Z&&n.texStorage3D(35866,w,C,a.width,a.height,a.depth),n.texSubImage3D(35866,0,0,0,0,a.width,a.height,a.depth,p,I,a.data)):n.texImage3D(35866,0,C,a.width,a.height,a.depth,0,p,I,a.data);else if(o.isData3DTexture)G?(Z&&n.texStorage3D(32879,w,C,a.width,a.height,a.depth),n.texSubImage3D(32879,0,0,0,0,a.width,a.height,a.depth,p,I,a.data)):n.texImage3D(32879,0,C,a.width,a.height,a.depth,0,p,I,a.data);else if(o.isFramebufferTexture){if(Z)if(G)n.texStorage2D(3553,w,C,a.width,a.height);else{let e=a.width,t=a.height;for(let a=0;a<w;a++)n.texImage2D(3553,a,C,e,t,0,p,I,null),e>>=1,t>>=1}}else if(f.length>0&&h){G&&Z&&n.texStorage2D(3553,w,C,f[0].width,f[0].height);for(let e=0,t=f.length;e<t;e++)m=f[e],G?n.texSubImage2D(3553,e,0,0,p,I,m):n.texImage2D(3553,e,C,p,I,m);o.generateMipmaps=!1}else G?(Z&&n.texStorage2D(3553,w,C,a.width,a.height),n.texSubImage2D(3553,0,0,0,p,I,a)):n.texImage2D(3553,0,C,p,I,a);A(o,h)&&v(l),d.__version=u.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}function T(t,o,r,s,l){const c=i.convert(r.format,r.encoding),g=i.convert(r.type),u=S(r.internalFormat,c,g,r.encoding);a.get(o).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,u,o.width,o.height,o.depth,0,c,g,null):n.texImage2D(l,0,u,o.width,o.height,0,c,g,null)),n.bindFramebuffer(36160,t),J(o)?d.framebufferTexture2DMultisampleEXT(36160,s,l,a.get(r).__webglTexture,0,H(o)):(3553===l||l>=34069&&l<=34074)&&e.framebufferTexture2D(36160,s,l,a.get(r).__webglTexture,0),n.bindFramebuffer(36160,null)}function E(t,n,a){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let o=33189;if(a||J(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===my?o=36012:t.type===py&&(o=33190));const a=H(n);J(n)?d.renderbufferStorageMultisampleEXT(36161,a,o,n.width,n.height):e.renderbufferStorageMultisample(36161,a,o,n.width,n.height)}else e.renderbufferStorage(36161,o,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){const o=H(n);a&&!1===J(n)?e.renderbufferStorageMultisample(36161,o,35056,n.width,n.height):J(n)?d.renderbufferStorageMultisampleEXT(36161,o,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let o=0;o<t.length;o++){const r=t[o],s=i.convert(r.format,r.encoding),l=i.convert(r.type),c=S(r.internalFormat,s,l,r.encoding),g=H(n);a&&!1===J(n)?e.renderbufferStorageMultisample(36161,g,c,n.width,n.height):J(n)?d.renderbufferStorageMultisampleEXT(36161,g,c,n.width,n.height):e.renderbufferStorage(36161,c,n.width,n.height)}}e.bindRenderbuffer(36161,null)}function F(t){const o=a.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!o.__autoAllocateDepthBuffer){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,o){if(o&&o.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!o.depthTexture||!o.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");a.get(o.depthTexture).__webglTexture&&o.depthTexture.image.width===o.width&&o.depthTexture.image.height===o.height||(o.depthTexture.image.width=o.width,o.depthTexture.image.height=o.height,o.depthTexture.needsUpdate=!0),R(o.depthTexture,0);const i=a.get(o.depthTexture).__webglTexture,r=H(o);if(o.depthTexture.format===xy)J(o)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,i,0,r):e.framebufferTexture2D(36160,36096,3553,i,0);else{if(o.depthTexture.format!==Gy)throw new Error("Unknown depthTexture format");J(o)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,i,0,r):e.framebufferTexture2D(36160,33306,3553,i,0)}}(o.__webglFramebuffer,t)}else if(i){o.__webglDepthbuffer=[];for(let a=0;a<6;a++)n.bindFramebuffer(36160,o.__webglFramebuffer[a]),o.__webglDepthbuffer[a]=e.createRenderbuffer(),E(o.__webglDepthbuffer[a],t,!1)}else n.bindFramebuffer(36160,o.__webglFramebuffer),o.__webglDepthbuffer=e.createRenderbuffer(),E(o.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function H(e){return Math.min(u,e.samples)}function J(e){const n=a.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function Y(e,n){const a=e.encoding,o=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===ov||a!==AA&&(a===vA?!1===s?!0===t.has("EXT_sRGB")&&o===Ay?(e.format=ov,e.minFilter=oy,e.generateMipmaps=!1):n=Tv.sRGBToLinear(n):o===Ay&&i===cy||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",a)),n}this.allocateTextureUnit=function(){const e=B;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),B+=1,e},this.resetTextureUnits=function(){B=0},this.setTexture2D=R,this.setTexture2DArray=function(e,t){const o=a.get(e);e.version>0&&o.__version!==e.version?M(o,e,t):n.bindTexture(35866,o.__webglTexture,33984+t)},this.setTexture3D=function(e,t){const o=a.get(e);e.version>0&&o.__version!==e.version?M(o,e,t):n.bindTexture(32879,o.__webglTexture,33984+t)},this.setTextureCube=function(t,o){const r=a.get(t);t.version>0&&r.__version!==t.version?function(t,o,r){if(6!==o.image.length)return;const l=X(t,o),g=o.source;n.bindTexture(34067,t.__webglTexture,33984+r);const u=a.get(g);if(g.version!==u.__version||!0===l){n.activeTexture(33984+r),e.pixelStorei(37440,o.flipY),e.pixelStorei(37441,o.premultiplyAlpha),e.pixelStorei(3317,o.unpackAlignment),e.pixelStorei(37443,0);const t=o.isCompressedTexture||o.image[0].isCompressedTexture,a=o.image[0]&&o.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=t||a?a?o.image[e].image:o.image[e]:b(o.image[e],!1,!0,c),d[e]=Y(o,d[e]);const h=d[0],p=y(h)||s,m=i.convert(o.format,o.encoding),I=i.convert(o.type),C=S(o.internalFormat,m,I,o.encoding),f=s&&!0!==o.isVideoTexture,G=void 0===u.__version||!0===l;let Z,w=x(o,h,p);if(N(34067,o,p),t){f&&G&&n.texStorage2D(34067,w,C,h.width,h.height);for(let e=0;e<6;e++){Z=d[e].mipmaps;for(let t=0;t<Z.length;t++){const a=Z[t];o.format!==Ay?null!==m?f?n.compressedTexSubImage2D(34069+e,t,0,0,a.width,a.height,m,a.data):n.compressedTexImage2D(34069+e,t,C,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):f?n.texSubImage2D(34069+e,t,0,0,a.width,a.height,m,I,a.data):n.texImage2D(34069+e,t,C,a.width,a.height,0,m,I,a.data)}}}else{Z=o.mipmaps,f&&G&&(Z.length>0&&w++,n.texStorage2D(34067,w,C,d[0].width,d[0].height));for(let e=0;e<6;e++)if(a){f?n.texSubImage2D(34069+e,0,0,0,d[e].width,d[e].height,m,I,d[e].data):n.texImage2D(34069+e,0,C,d[e].width,d[e].height,0,m,I,d[e].data);for(let t=0;t<Z.length;t++){const a=Z[t].image[e].image;f?n.texSubImage2D(34069+e,t+1,0,0,a.width,a.height,m,I,a.data):n.texImage2D(34069+e,t+1,C,a.width,a.height,0,m,I,a.data)}}else{f?n.texSubImage2D(34069+e,0,0,0,m,I,d[e]):n.texImage2D(34069+e,0,C,m,I,d[e]);for(let t=0;t<Z.length;t++){const a=Z[t];f?n.texSubImage2D(34069+e,t+1,0,0,m,I,a.image[e]):n.texImage2D(34069+e,t+1,C,m,I,a.image[e])}}}A(o,p)&&v(34067),u.__version=g.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}(r,t,o):n.bindTexture(34067,r.__webglTexture,33984+o)},this.rebindTextures=function(e,t,n){const o=a.get(e);void 0!==t&&T(o.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&F(e)},this.setupRenderTarget=function(t){const l=t.texture,c=a.get(t),g=a.get(l);t.addEventListener("dispose",w),!0!==t.isWebGLMultipleRenderTargets&&(void 0===g.__webglTexture&&(g.__webglTexture=e.createTexture()),g.__version=l.version,r.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,h=y(t)||s;if(u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),d)if(o.drawBuffers){const n=t.texture;for(let t=0,o=n.length;t<o;t++){const o=a.get(n[t]);void 0===o.__webglTexture&&(o.__webglTexture=e.createTexture(),r.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===J(t)){const a=d?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let n=0;n<a.length;n++){const o=a[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer[n]);const r=i.convert(o.format,o.encoding),s=i.convert(o.type),l=S(o.internalFormat,r,s,o.encoding,!0===t.isXRRenderTarget),g=H(t);e.renderbufferStorageMultisample(36161,g,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+n,36161,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),E(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(u){n.bindTexture(34067,g.__webglTexture),N(34067,l,h);for(let e=0;e<6;e++)T(c.__webglFramebuffer[e],t,l,36064,34069+e);A(l,h)&&v(34067),n.unbindTexture()}else if(d){const e=t.texture;for(let o=0,i=e.length;o<i;o++){const i=e[o],r=a.get(i);n.bindTexture(3553,r.__webglTexture),N(3553,i,h),T(c.__webglFramebuffer,t,i,36064+o,3553),A(i,h)&&v(3553)}n.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(e,g.__webglTexture),N(e,l,h),T(c.__webglFramebuffer,t,l,36064,e),A(l,h)&&v(e),n.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(e){const t=y(e)||s,o=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let i=0,r=o.length;i<r;i++){const r=o[i];if(A(r,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,o=a.get(r).__webglTexture;n.bindTexture(t,o),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===J(t)){const o=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],i=t.width,r=t.height;let s=16384;const l=[],c=t.stencilBuffer?33306:36096,g=a.get(t),u=!0===t.isWebGLMultipleRenderTargets;if(u)for(let t=0;t<o.length;t++)n.bindFramebuffer(36160,g.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),n.bindFramebuffer(36160,g.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);n.bindFramebuffer(36008,g.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,g.__webglFramebuffer);for(let n=0;n<o.length;n++){l.push(36064+n),t.depthBuffer&&l.push(c);const d=void 0!==g.__ignoreDepthValues&&g.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),u&&e.framebufferRenderbuffer(36008,36064,36161,g.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),u){const t=a.get(o[n]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,i,r,0,0,i,r,s,9728),h&&e.invalidateFramebuffer(36008,l)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),u)for(let t=0;t<o.length;t++){n.bindFramebuffer(36160,g.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,g.__webglColorRenderbuffer[t]);const i=a.get(o[t]).__webglTexture;n.bindFramebuffer(36160,g.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,i,0)}n.bindFramebuffer(36009,g.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=T,this.useMultisampledRTT=J}function Qw(e,t,n){const a=n.isWebGL2;return{convert:function(n){let o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===cy)return 5121;if(n===Cy)return 32819;if(n===fy)return 32820;if(n===gy)return 5120;if(n===uy)return 5122;if(n===dy)return 5123;if(n===hy)return 5124;if(n===py)return 5125;if(n===my)return 5126;if(n===Iy)return a?5131:(o=t.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(n===yy)return 6406;if(n===Ay)return 6408;if(n===vy)return 6409;if(n===Sy)return 6410;if(n===xy)return 6402;if(n===Gy)return 34041;if(n===ov)return o=t.get("EXT_sRGB"),null!==o?o.SRGB_ALPHA_EXT:null;if(n===Zy)return 6403;if(n===wy)return 36244;if(n===ky)return 33319;if(n===By)return 33320;if(n===Ry)return 36249;if(n===Wy||n===Vy||n===Ny||n===Xy)if(i===vA){if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(n===Wy)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Vy)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Ny)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Xy)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=t.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(n===Wy)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Vy)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Ny)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Xy)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===My||n===Ty||n===Ey||n===Fy){if(o=t.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(n===My)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ty)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ey)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Fy)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Hy)return o=t.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Jy||n===Yy){if(o=t.get("WEBGL_compressed_texture_etc"),null===o)return null;if(n===Jy)return i===vA?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(n===Yy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(n===Ly||n===zy||n===Ky||n===Dy||n===Uy||n===Py||n===Oy||n===_y||n===Qy||n===jy||n===qy||n===$y||n===eA||n===tA){if(o=t.get("WEBGL_compressed_texture_astc"),null===o)return null;if(n===Ly)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===zy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ky)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Dy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Uy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Py)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Oy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===_y)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Qy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===jy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===qy)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===$y)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===eA)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===tA)return i===vA?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===nA){if(o=t.get("EXT_texture_compression_bptc"),null===o)return null;if(n===nA)return i===vA?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(n===aA||n===oA||n===iA||n===rA){if(o=t.get("EXT_texture_compression_rgtc"),null===o)return null;if(n===nA)return o.COMPRESSED_RED_RGTC1_EXT;if(n===oA)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===iA)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===rA)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===by?a?34042:(o=t.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class jw extends IG{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}}class qw extends QS{constructor(){super(),this.isGroup=!0,this.type="Group"}}const $w={type:"move"};class ek{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new qw,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new qw,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new _v,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new _v),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new qw,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new _v,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new _v),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let a=null,o=null,i=null;const r=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){i=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),a=this._getHandJoint(l,i);null!==e&&(a.matrix.fromArray(e.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.jointRadius=e.radius),a.visible=null!==e}const a=l.joints["index-finger-tip"],o=l.joints["thumb-tip"],r=a.position.distanceTo(o.position),s=.02,c=.005;l.inputState.pinching&&r>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&r<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),null!==o&&(s.matrix.fromArray(o.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),o.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(o.linearVelocity)):s.hasLinearVelocity=!1,o.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(o.angularVelocity)):s.hasAngularVelocity=!1));null!==r&&(a=t.getPose(e.targetRaySpace,n),null===a&&null!==o&&(a=o),null!==a&&(r.matrix.fromArray(a.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),a.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(a.linearVelocity)):r.hasLinearVelocity=!1,a.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(a.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent($w)))}return null!==r&&(r.visible=null!==a),null!==s&&(s.visible=null!==o),null!==l&&(l.visible=null!==i),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new qw;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class tk extends Jv{constructor(e,t,n,a,o,i,r,s,l,c){if((c=void 0!==c?c:xy)!==xy&&c!==Gy)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===xy&&(n=py),void 0===n&&c===Gy&&(n=by),super(null,a,o,i,r,s,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==r?r:$b,this.minFilter=void 0!==s?s:$b,this.flipY=!1,this.generateMipmaps=!1}}class nk extends iv{constructor(e,t){super();const n=this;let a=null,o=1,i=null,r="local-floor",s=1,l=null,c=null,g=null,u=null,d=null,h=null;const p=t.getContextAttributes();let m=null,I=null;const C=[],f=[],b=new Set,y=new Map,A=new IG;A.layers.enable(1),A.viewport=new Yv;const v=new IG;v.layers.enable(2),v.viewport=new Yv;const S=[A,v],x=new jw;x.layers.enable(1),x.layers.enable(2);let G=null,Z=null;function w(e){const t=f.indexOf(e.inputSource);if(-1===t)return;const n=C[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}function k(){a.removeEventListener("select",w),a.removeEventListener("selectstart",w),a.removeEventListener("selectend",w),a.removeEventListener("squeeze",w),a.removeEventListener("squeezestart",w),a.removeEventListener("squeezeend",w),a.removeEventListener("end",k),a.removeEventListener("inputsourceschange",B);for(let e=0;e<C.length;e++){const t=f[e];null!==t&&(f[e]=null,C[e].disconnect(t))}G=null,Z=null,e.setRenderTarget(m),d=null,u=null,g=null,a=null,I=null,X.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function B(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],a=f.indexOf(n);a>=0&&(f[a]=null,C[a].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let a=f.indexOf(n);if(-1===a){for(let e=0;e<C.length;e++){if(e>=f.length){f.push(n),a=e;break}if(null===f[e]){f[e]=n,a=e;break}}if(-1===a)break}const o=C[a];o&&o.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=C[e];return void 0===t&&(t=new ek,C[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=C[e];return void 0===t&&(t=new ek,C[e]=t),t.getGripSpace()},this.getHand=function(e){let t=C[e];return void 0===t&&(t=new ek,C[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||i},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return g},this.getFrame=function(){return h},this.getSession=function(){return a},this.setSession=async function(c){if(a=c,null!==a){if(m=e.getRenderTarget(),a.addEventListener("select",w),a.addEventListener("selectstart",w),a.addEventListener("selectend",w),a.addEventListener("squeeze",w),a.addEventListener("squeezestart",w),a.addEventListener("squeezeend",w),a.addEventListener("end",k),a.addEventListener("inputsourceschange",B),!0!==p.xrCompatible&&await t.makeXRCompatible(),void 0===a.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==a.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:o};d=new XRWebGLLayer(a,t,n),a.updateRenderState({baseLayer:d}),I=new Lv(d.framebufferWidth,d.framebufferHeight,{format:Ay,type:cy,encoding:e.outputEncoding,stencilBuffer:p.stencil})}else{let n=null,i=null,r=null;p.depth&&(r=p.stencil?35056:33190,n=p.stencil?Gy:xy,i=p.stencil?by:py);const s={colorFormat:32856,depthFormat:r,scaleFactor:o};g=new XRWebGLBinding(a,t),u=g.createProjectionLayer(s),a.updateRenderState({layers:[u]}),I=new Lv(u.textureWidth,u.textureHeight,{format:Ay,type:cy,depthTexture:new tk(u.textureWidth,u.textureHeight,i,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});e.properties.get(I).__ignoreDepthValues=u.ignoreDepthValues}I.isXRRenderTarget=!0,this.setFoveation(s),l=null,i=await a.requestReferenceSpace(r),X.setContext(a),X.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const R=new _v,W=new _v;function V(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===a)return;x.near=v.near=A.near=e.near,x.far=v.far=A.far=e.far,G===x.near&&Z===x.far||(a.updateRenderState({depthNear:x.near,depthFar:x.far}),G=x.near,Z=x.far);const t=e.parent,n=x.cameras;V(x,t);for(let a=0;a<n.length;a++)V(n[a],t);2===n.length?function(e,t,n){R.setFromMatrixPosition(t.matrixWorld),W.setFromMatrixPosition(n.matrixWorld);const a=R.distanceTo(W),o=t.projectionMatrix.elements,i=n.projectionMatrix.elements,r=o[14]/(o[10]-1),s=o[14]/(o[10]+1),l=(o[9]+1)/o[5],c=(o[9]-1)/o[5],g=(o[8]-1)/o[0],u=(i[8]+1)/i[0],d=r*g,h=r*u,p=a/(-g+u),m=p*-g;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const I=r+p,C=s+p,f=d-m,b=h+(a-m),y=l*s/C*I,A=c*s/C*I;e.projectionMatrix.makePerspective(f,b,y,A,I,C),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(x,A,v):x.projectionMatrix.copy(A.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0);const a=e.children;for(let o=0,i=a.length;o<i;o++)a[o].updateMatrixWorld(!0);e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*cv*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,x,t)},this.getCamera=function(){return x},this.getFoveation=function(){if(null!==u||null!==d)return s},this.setFoveation=function(e){s=e,null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.getPlanes=function(){return b};let N=null;const X=new kG;X.setAnimationLoop((function(t,a){if(c=a.getViewerPose(l||i),h=a,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(I,d.framebuffer),e.setRenderTarget(I));let n=!1;t.length!==x.cameras.length&&(x.cameras.length=0,n=!0);for(let a=0;a<t.length;a++){const o=t[a];let i=null;if(null!==d)i=d.getViewport(o);else{const t=g.getViewSubImage(u,o);i=t.viewport,0===a&&(e.setRenderTargetTextures(I,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(I))}let r=S[a];void 0===r&&(r=new IG,r.layers.enable(a),r.viewport=new Yv,S[a]=r),r.matrix.fromArray(o.transform.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale),r.projectionMatrix.fromArray(o.projectionMatrix),r.projectionMatrixInverse.copy(r.projectionMatrix).invert(),r.viewport.set(i.x,i.y,i.width,i.height),0===a&&(x.matrix.copy(r.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),!0===n&&x.cameras.push(r)}}for(let e=0;e<C.length;e++){const t=f[e],n=C[e];null!==t&&void 0!==n&&n.update(t,a,l||i)}if(N&&N(t,a),a.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:a.detectedPlanes});let e=null;for(const t of b)a.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(const t of e)b.delete(t),y.delete(t),n.dispatchEvent({type:"planeremoved",data:t});for(const t of a.detectedPlanes)if(b.has(t)){const e=y.get(t);t.lastChangedTime>e&&(y.set(t,t.lastChangedTime),n.dispatchEvent({type:"planechanged",data:t}))}else b.add(t),y.set(t,a.lastChangedTime),n.dispatchEvent({type:"planeadded",data:t})}h=null})),this.setAnimationLoop=function(e){N=e},this.dispose=function(){}}}function ak(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function a(a,o){a.opacity.value=o.opacity,o.color&&a.diffuse.value.copy(o.color),o.emissive&&a.emissive.value.copy(o.emissive).multiplyScalar(o.emissiveIntensity),o.map&&(a.map.value=o.map,n(o.map,a.mapTransform)),o.alphaMap&&(a.alphaMap.value=o.alphaMap,n(o.alphaMap,a.alphaMapTransform)),o.bumpMap&&(a.bumpMap.value=o.bumpMap,n(o.bumpMap,a.bumpMapTransform),a.bumpScale.value=o.bumpScale,o.side===nb&&(a.bumpScale.value*=-1)),o.normalMap&&(a.normalMap.value=o.normalMap,n(o.normalMap,a.normalMapTransform),a.normalScale.value.copy(o.normalScale),o.side===nb&&a.normalScale.value.negate()),o.displacementMap&&(a.displacementMap.value=o.displacementMap,n(o.displacementMap,a.displacementMapTransform),a.displacementScale.value=o.displacementScale,a.displacementBias.value=o.displacementBias),o.emissiveMap&&(a.emissiveMap.value=o.emissiveMap,n(o.emissiveMap,a.emissiveMapTransform)),o.specularMap&&(a.specularMap.value=o.specularMap,n(o.specularMap,a.specularMapTransform)),o.alphaTest>0&&(a.alphaTest.value=o.alphaTest);const i=t.get(o).envMap;if(i&&(a.envMap.value=i,a.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,a.reflectivity.value=o.reflectivity,a.ior.value=o.ior,a.refractionRatio.value=o.refractionRatio),o.lightMap){a.lightMap.value=o.lightMap;const t=!0===e.useLegacyLights?Math.PI:1;a.lightMapIntensity.value=o.lightMapIntensity*t,n(o.lightMap,a.lightMapTransform)}o.aoMap&&(a.aoMap.value=o.aoMap,a.aoMapIntensity.value=o.aoMapIntensity,n(o.aoMap,a.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,dG(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,o,i,r,s){o.isMeshBasicMaterial||o.isMeshLambertMaterial?a(e,o):o.isMeshToonMaterial?(a(e,o),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,o)):o.isMeshPhongMaterial?(a(e,o),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,o)):o.isMeshStandardMaterial?(a(e,o),function(e,a){e.metalness.value=a.metalness,a.metalnessMap&&(e.metalnessMap.value=a.metalnessMap,n(a.metalnessMap,e.metalnessMapTransform));e.roughness.value=a.roughness,a.roughnessMap&&(e.roughnessMap.value=a.roughnessMap,n(a.roughnessMap,e.roughnessMapTransform));const o=t.get(a).envMap;o&&(e.envMapIntensity.value=a.envMapIntensity)}(e,o),o.isMeshPhysicalMaterial&&function(e,t,a){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===nb&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=a.texture,e.transmissionSamplerSize.value.set(a.width,a.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,o,s)):o.isMeshMatcapMaterial?(a(e,o),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,o)):o.isMeshDepthMaterial?a(e,o):o.isMeshDistanceMaterial?(a(e,o),function(e,n){const a=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(a.matrixWorld),e.nearDistance.value=a.shadow.camera.near,e.farDistance.value=a.shadow.camera.far}(e,o)):o.isMeshNormalMaterial?a(e,o):o.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,o),o.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,o)):o.isPointsMaterial?function(e,t,a,o){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*a,e.scale.value=.5*o,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,o,i,r):o.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,o):o.isShadowMaterial?(e.color.value.copy(o.color),e.opacity.value=o.opacity):o.isShaderMaterial&&(o.uniformsNeedUpdate=!1)}}}function ok(e,t,n,a){let o={},i={},r=[];const s=n.isWebGL2?e.getParameter(35375):0;function l(e,t,n){const a=e.value;if(void 0===n[t]){if("number"===typeof a)n[t]=a;else{const e=Array.isArray(a)?a:[a],o=[];for(let t=0;t<e.length;t++)o.push(e[t].clone());n[t]=o}return!0}if("number"===typeof a){if(n[t]!==a)return n[t]=a,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],o=Array.isArray(a)?a:[a];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(o[t]))return n.copy(o[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function g(t){const n=t.target;n.removeEventListener("dispose",g);const a=r.indexOf(n.__bindingPointIndex);r.splice(a,1),e.deleteBuffer(o[n.id]),delete o[n.id],delete i[n.id]}return{bind:function(e,t){const n=t.program;a.uniformBlockBinding(e,n)},update:function(n,u){let d=o[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const a=16;let o=0;for(let i=0,r=t.length;i<r;i++){const e=t[i],r={boundary:0,storage:0},s=Array.isArray(e.value)?e.value:[e.value];for(let t=0,n=s.length;t<n;t++){const e=c(s[t]);r.boundary+=e.boundary,r.storage+=e.storage}if(e.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,i>0){o=n%a;0!==o&&a-o-r.boundary<0&&(n+=a-o,e.__offset=n)}n+=r.storage}o=n%a,o>0&&(n+=a-o);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===r.indexOf(e))return r.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const a=e.createBuffer(),o=t.__size,i=t.usage;return e.bindBuffer(35345,a),e.bufferData(35345,o,i),e.bindBuffer(35345,null),e.bindBufferBase(35345,n,a),a}(n),o[n.id]=d,n.addEventListener("dispose",g));const h=u.program;a.updateUBOMapping(n,h);const p=t.render.frame;i[n.id]!==p&&(!function(t){const n=o[t.id],a=t.uniforms,i=t.__cache;e.bindBuffer(35345,n);for(let o=0,r=a.length;o<r;o++){const t=a[o];if(!0===l(t,o,i)){const n=t.__offset,a=Array.isArray(t.value)?t.value:[t.value];let o=0;for(let i=0;i<a.length;i++){const r=a[i],s=c(r);"number"===typeof r?(t.__data[0]=r,e.bufferSubData(35345,n+o,t.__data)):r.isMatrix3?(t.__data[0]=r.elements[0],t.__data[1]=r.elements[1],t.__data[2]=r.elements[2],t.__data[3]=r.elements[0],t.__data[4]=r.elements[3],t.__data[5]=r.elements[4],t.__data[6]=r.elements[5],t.__data[7]=r.elements[0],t.__data[8]=r.elements[6],t.__data[9]=r.elements[7],t.__data[10]=r.elements[8],t.__data[11]=r.elements[0]):(r.toArray(t.__data,o),o+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,n,t.__data)}}e.bindBuffer(35345,null)}(n),i[n.id]=p)},dispose:function(){for(const t in o)e.deleteBuffer(o[t]);r=[],o={},i={}}}}function ik(){const e=Zv("canvas");return e.style.display="block",e}class rk{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=ik(),context:n=null,depth:a=!0,stencil:o=!0,alpha:i=!1,antialias:r=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:g=!1}=e;let u;this.isWebGLRenderer=!0,u=null!==n?n.getContextAttributes().alpha:i;let d=null,h=null;const p=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=AA,this.useLegacyLights=!0,this.toneMapping=Fb,this.toneMappingExposure=1;const I=this;let C=!1,f=0,b=0,y=null,A=-1,v=null;const S=new Yv,x=new Yv;let G=null,Z=t.width,w=t.height,k=1,B=null,R=null;const W=new Yv(0,0,Z,w),V=new Yv(0,0,Z,w);let N=!1;const X=new wG;let M=!1,T=!1,E=null;const F=new GS,H=new _v,J={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Y(){return null===y?k:1}let L,z,K,D,U,P,O,_,Q,j,q,$,ee,te,ne,ae,oe,ie,re,se,le,ce,ge,ue,de=n;function he(e,n){for(let a=0;a<e.length;a++){const o=e[a],i=t.getContext(o,n);if(null!==i)return i}return null}try{const e={alpha:!0,depth:a,stencil:o,antialias:r,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:g};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(Kf)),t.addEventListener("webglcontextlost",Ie,!1),t.addEventListener("webglcontextrestored",Ce,!1),t.addEventListener("webglcontextcreationerror",fe,!1),null===de){const t=["webgl2","webgl","experimental-webgl"];if(!0===I.isWebGL1Renderer&&t.shift(),de=he(t,e),null===de)throw he(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===de.getShaderPrecisionFormat&&(de.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Re){throw console.error("THREE.WebGLRenderer: "+Re.message),Re}function pe(){L=new nZ(de),z=new FG(de,L,e),L.init(z),ce=new Qw(de,L,z),K=new Ow(de,L,z),D=new iZ,U=new Xw,P=new _w(de,L,K,U,z,ce,D),O=new JG(I),_=new tZ(I),Q=new BG(de,z),ge=new TG(de,L,Q,z),j=new aZ(de,Q,D,ge),q=new cZ(de,j,Q,D),re=new lZ(de,z,P),ae=new HG(U),$=new Nw(I,O,_,L,z,ge,ae),ee=new ak(I,U),te=new Fw,ne=new Kw(L,z),ie=new MG(I,O,_,K,q,u,s),oe=new Pw(I,q,z),ue=new ok(de,D,z,K),se=new EG(de,L,D,z),le=new oZ(de,L,D,z),D.programs=$.programs,I.capabilities=z,I.extensions=L,I.properties=U,I.renderLists=te,I.shadowMap=oe,I.state=K,I.info=D}pe();const me=new nk(I,de);function Ie(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const e=D.autoReset,t=oe.enabled,n=oe.autoUpdate,a=oe.needsUpdate,o=oe.type;pe(),D.autoReset=e,oe.enabled=t,oe.autoUpdate=n,oe.needsUpdate=a,oe.type=o}function fe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function be(e){const t=e.target;t.removeEventListener("dispose",be),function(e){(function(e){const t=U.get(e).programs;void 0!==t&&(t.forEach((function(e){$.releaseProgram(e)})),e.isShaderMaterial&&$.releaseShaderCache(e))})(e),U.remove(e)}(t)}this.xr=me,this.getContext=function(){return de},this.getContextAttributes=function(){return de.getContextAttributes()},this.forceContextLoss=function(){const e=L.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=L.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(e){void 0!==e&&(k=e,this.setSize(Z,w,!1))},this.getSize=function(e){return e.set(Z,w)},this.setSize=function(e,n){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Z=e,w=n,t.width=Math.floor(e*k),t.height=Math.floor(n*k),!0===a&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(Z*k,w*k).floor()},this.setDrawingBufferSize=function(e,n,a){Z=e,w=n,k=a,t.width=Math.floor(e*a),t.height=Math.floor(n*a),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(S)},this.getViewport=function(e){return e.copy(W)},this.setViewport=function(e,t,n,a){e.isVector4?W.set(e.x,e.y,e.z,e.w):W.set(e,t,n,a),K.viewport(S.copy(W).multiplyScalar(k).floor())},this.getScissor=function(e){return e.copy(V)},this.setScissor=function(e,t,n,a){e.isVector4?V.set(e.x,e.y,e.z,e.w):V.set(e,t,n,a),K.scissor(x.copy(V).multiplyScalar(k).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(e){K.setScissorTest(N=e)},this.setOpaqueSort=function(e){B=e},this.setTransparentSort=function(e){R=e},this.getClearColor=function(e){return e.copy(ie.getClearColor())},this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)},this.clear=function(){let e=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(e|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e|=1024),de.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ie,!1),t.removeEventListener("webglcontextrestored",Ce,!1),t.removeEventListener("webglcontextcreationerror",fe,!1),te.dispose(),ne.dispose(),U.dispose(),O.dispose(),_.dispose(),q.dispose(),ge.dispose(),ue.dispose(),$.dispose(),me.dispose(),me.removeEventListener("sessionstart",Ae),me.removeEventListener("sessionend",ve),E&&(E.dispose(),E=null),Se.stop()},this.renderBufferDirect=function(e,t,n,a,o,i){null===t&&(t=J);const r=o.isMesh&&o.matrixWorld.determinant()<0,s=function(e,t,n,a,o){!0!==t.isScene&&(t=J);P.resetTextureUnits();const i=t.fog,r=a.isMeshStandardMaterial?t.environment:null,s=null===y?I.outputEncoding:!0===y.isXRRenderTarget?y.texture.encoding:AA,l=(a.isMeshStandardMaterial?_:O).get(a.envMap||r),c=!0===a.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,g=!!a.normalMap&&!!n.attributes.tangent,u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,m=a.toneMapped?I.toneMapping:Fb,C=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,f=void 0!==C?C.length:0,b=U.get(a),S=h.state.lights;if(!0===M&&(!0===T||e!==v)){const t=e===v&&a.id===A;ae.setState(a,e,t)}let x=!1;a.version===b.__version?b.needsLights&&b.lightsStateVersion!==S.state.version||b.outputEncoding!==s||o.isInstancedMesh&&!1===b.instancing?x=!0:o.isInstancedMesh||!0!==b.instancing?o.isSkinnedMesh&&!1===b.skinning?x=!0:o.isSkinnedMesh||!0!==b.skinning?b.envMap!==l||!0===a.fog&&b.fog!==i?x=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===ae.numPlanes&&b.numIntersection===ae.numIntersection?(b.vertexAlphas!==c||b.vertexTangents!==g||b.morphTargets!==u||b.morphNormals!==d||b.morphColors!==p||b.toneMapping!==m||!0===z.isWebGL2&&b.morphTargetsCount!==f)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,b.__version=a.version);let G=b.currentProgram;!0===x&&(G=ke(a,t,o));let Z=!1,B=!1,R=!1;const W=G.getUniforms(),V=b.uniforms;K.useProgram(G.program)&&(Z=!0,B=!0,R=!0);a.id!==A&&(A=a.id,B=!0);if(Z||v!==e){if(W.setValue(de,"projectionMatrix",e.projectionMatrix),z.logarithmicDepthBuffer&&W.setValue(de,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),v!==e&&(v=e,B=!0,R=!0),a.isShaderMaterial||a.isMeshPhongMaterial||a.isMeshToonMaterial||a.isMeshStandardMaterial||a.envMap){const t=W.map.cameraPosition;void 0!==t&&t.setValue(de,H.setFromMatrixPosition(e.matrixWorld))}(a.isMeshPhongMaterial||a.isMeshToonMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||a.isMeshStandardMaterial||a.isShaderMaterial)&&W.setValue(de,"isOrthographic",!0===e.isOrthographicCamera),(a.isMeshPhongMaterial||a.isMeshToonMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||a.isMeshStandardMaterial||a.isShaderMaterial||a.isShadowMaterial||o.isSkinnedMesh)&&W.setValue(de,"viewMatrix",e.matrixWorldInverse)}if(o.isSkinnedMesh){W.setOptional(de,o,"bindMatrix"),W.setOptional(de,o,"bindMatrixInverse");const e=o.skeleton;e&&(z.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),W.setValue(de,"boneTexture",e.boneTexture,P),W.setValue(de,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const N=n.morphAttributes;(void 0!==N.position||void 0!==N.normal||void 0!==N.color&&!0===z.isWebGL2)&&re.update(o,n,G);(B||b.receiveShadow!==o.receiveShadow)&&(b.receiveShadow=o.receiveShadow,W.setValue(de,"receiveShadow",o.receiveShadow));a.isMeshGouraudMaterial&&null!==a.envMap&&(V.envMap.value=l,V.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);B&&(W.setValue(de,"toneMappingExposure",I.toneMappingExposure),b.needsLights&&(F=R,(X=V).ambientLightColor.needsUpdate=F,X.lightProbe.needsUpdate=F,X.directionalLights.needsUpdate=F,X.directionalLightShadows.needsUpdate=F,X.pointLights.needsUpdate=F,X.pointLightShadows.needsUpdate=F,X.spotLights.needsUpdate=F,X.spotLightShadows.needsUpdate=F,X.rectAreaLights.needsUpdate=F,X.hemisphereLights.needsUpdate=F),i&&!0===a.fog&&ee.refreshFogUniforms(V,i),ee.refreshMaterialUniforms(V,a,k,w,E),hw.upload(de,b.uniformsList,V,P));var X,F;a.isShaderMaterial&&!0===a.uniformsNeedUpdate&&(hw.upload(de,b.uniformsList,V,P),a.uniformsNeedUpdate=!1);a.isSpriteMaterial&&W.setValue(de,"center",o.center);if(W.setValue(de,"modelViewMatrix",o.modelViewMatrix),W.setValue(de,"normalMatrix",o.normalMatrix),W.setValue(de,"modelMatrix",o.matrixWorld),a.isShaderMaterial||a.isRawShaderMaterial){const e=a.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(z.isWebGL2){const n=e[t];ue.update(n,G),ue.bind(n,G)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return G}(e,t,n,a,o);K.setMaterial(a,r);let l=n.index,c=1;!0===a.wireframe&&(l=j.getWireframeAttribute(n),c=2);const g=n.drawRange,u=n.attributes.position;let d=g.start*c,p=(g.start+g.count)*c;null!==i&&(d=Math.max(d,i.start*c),p=Math.min(p,(i.start+i.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):void 0!==u&&null!==u&&(d=Math.max(d,0),p=Math.min(p,u.count));const m=p-d;if(m<0||m===1/0)return;let C;ge.setup(o,a,s,n,l);let f=se;if(null!==l&&(C=Q.get(l),f=le,f.setIndex(C)),o.isMesh)!0===a.wireframe?(K.setLineWidth(a.wireframeLinewidth*Y()),f.setMode(1)):f.setMode(4);else if(o.isLine){let e=a.linewidth;void 0===e&&(e=1),K.setLineWidth(e*Y()),o.isLineSegments?f.setMode(1):o.isLineLoop?f.setMode(2):f.setMode(3)}else o.isPoints?f.setMode(0):o.isSprite&&f.setMode(4);if(o.isInstancedMesh)f.renderInstances(d,m,o.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);f.renderInstances(d,m,t)}else f.render(d,m)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===ab&&!1===e.forceSinglePass?(e.side=nb,e.needsUpdate=!0,ke(e,t,n),e.side=tb,e.needsUpdate=!0,ke(e,t,n),e.side=ab):ke(e,t,n)}h=ne.get(e),h.init(),m.push(h),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(h.pushLight(e),e.castShadow&&h.pushShadow(e))})),h.setupLights(I.useLegacyLights),e.traverse((function(t){const a=t.material;if(a)if(Array.isArray(a))for(let o=0;o<a.length;o++){n(a[o],e,t)}else n(a,e,t)})),m.pop(),h=null};let ye=null;function Ae(){Se.stop()}function ve(){Se.start()}const Se=new kG;function xe(e,t,n,a){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||X.intersectsSprite(e)){a&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=q.update(e),o=e.material;o.visible&&d.push(e,t,o,n,H.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==D.render.frame&&(e.skeleton.update(),e.skeleton.frame=D.render.frame),!e.frustumCulled||X.intersectsObject(e))){a&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=q.update(e),o=e.material;if(Array.isArray(o)){const a=t.groups;for(let i=0,r=a.length;i<r;i++){const r=a[i],s=o[r.materialIndex];s&&s.visible&&d.push(e,t,s,n,H.z,r)}}else o.visible&&d.push(e,t,o,n,H.z,null)}const o=e.children;for(let i=0,r=o.length;i<r;i++)xe(o[i],t,n,a)}function Ge(e,t,n,a){const o=e.opaque,i=e.transmissive,s=e.transparent;h.setupLightsView(n),!0===M&&ae.setGlobalState(I.clippingPlanes,n),i.length>0&&function(e,t,n,a){if(null===E){const e=z.isWebGL2;E=new Lv(1024,1024,{generateMipmaps:!0,type:L.has("EXT_color_buffer_half_float")?Iy:cy,minFilter:sy,samples:e&&!0===r?4:0})}const o=I.getRenderTarget();I.setRenderTarget(E),I.clear();const i=I.toneMapping;I.toneMapping=Fb,Ze(e,n,a),P.updateMultisampleRenderTarget(E),P.updateRenderTargetMipmap(E);let s=!1;for(let r=0,l=t.length;r<l;r++){const e=t[r],o=e.object,i=e.geometry,l=e.material,c=e.group;if(l.side===ab&&o.layers.test(a.layers)){const e=l.side;l.side=nb,l.needsUpdate=!0,we(o,n,a,i,l,c),l.side=e,l.needsUpdate=!0,s=!0}}!0===s&&(P.updateMultisampleRenderTarget(E),P.updateRenderTargetMipmap(E));I.setRenderTarget(o),I.toneMapping=i}(o,i,t,n),a&&K.viewport(S.copy(a)),o.length>0&&Ze(o,t,n),i.length>0&&Ze(i,t,n),s.length>0&&Ze(s,t,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Ze(e,t,n){const a=!0===t.isScene?t.overrideMaterial:null;for(let o=0,i=e.length;o<i;o++){const i=e[o],r=i.object,s=i.geometry,l=null===a?i.material:a,c=i.group;r.layers.test(n.layers)&&we(r,t,n,s,l,c)}}function we(e,t,n,a,o,i){e.onBeforeRender(I,t,n,a,o,i),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),o.onBeforeRender(I,t,n,a,e,i),!0===o.transparent&&o.side===ab&&!1===o.forceSinglePass?(o.side=nb,o.needsUpdate=!0,I.renderBufferDirect(n,t,a,o,e,i),o.side=tb,o.needsUpdate=!0,I.renderBufferDirect(n,t,a,o,e,i),o.side=ab):I.renderBufferDirect(n,t,a,o,e,i),e.onAfterRender(I,t,n,a,o,i)}function ke(e,t,n){!0!==t.isScene&&(t=J);const a=U.get(e),o=h.state.lights,i=h.state.shadowsArray,r=o.state.version,s=$.getParameters(e,o.state,i,t,n),l=$.getProgramCacheKey(s);let c=a.programs;a.environment=e.isMeshStandardMaterial?t.environment:null,a.fog=t.fog,a.envMap=(e.isMeshStandardMaterial?_:O).get(e.envMap||a.environment),void 0===c&&(e.addEventListener("dispose",be),c=new Map,a.programs=c);let g=c.get(l);if(void 0!==g){if(a.currentProgram===g&&a.lightsStateVersion===r)return Be(e,s),g}else s.uniforms=$.getUniforms(e),e.onBuild(n,s,I),e.onBeforeCompile(s,I),g=$.acquireProgram(s,l),c.set(l,g),a.uniforms=s.uniforms;const u=a.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=ae.uniform),Be(e,s),a.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),a.lightsStateVersion=r,a.needsLights&&(u.ambientLightColor.value=o.state.ambient,u.lightProbe.value=o.state.probe,u.directionalLights.value=o.state.directional,u.directionalLightShadows.value=o.state.directionalShadow,u.spotLights.value=o.state.spot,u.spotLightShadows.value=o.state.spotShadow,u.rectAreaLights.value=o.state.rectArea,u.ltc_1.value=o.state.rectAreaLTC1,u.ltc_2.value=o.state.rectAreaLTC2,u.pointLights.value=o.state.point,u.pointLightShadows.value=o.state.pointShadow,u.hemisphereLights.value=o.state.hemi,u.directionalShadowMap.value=o.state.directionalShadowMap,u.directionalShadowMatrix.value=o.state.directionalShadowMatrix,u.spotShadowMap.value=o.state.spotShadowMap,u.spotLightMatrix.value=o.state.spotLightMatrix,u.spotLightMap.value=o.state.spotLightMap,u.pointShadowMap.value=o.state.pointShadowMap,u.pointShadowMatrix.value=o.state.pointShadowMatrix);const d=g.getUniforms(),p=hw.seqWithValue(d.seq,u);return a.currentProgram=g,a.uniformsList=p,g}function Be(e,t){const n=U.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Se.setAnimationLoop((function(e){ye&&ye(e)})),"undefined"!==typeof self&&Se.setContext(self),this.setAnimationLoop=function(e){ye=e,me.setAnimationLoop(e),null===e?Se.stop():Se.start()},me.addEventListener("sessionstart",Ae),me.addEventListener("sessionend",ve),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===C)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(t),t=me.getCamera()),!0===e.isScene&&e.onBeforeRender(I,e,t,y),h=ne.get(e,m.length),h.init(),m.push(h),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),X.setFromProjectionMatrix(F),T=this.localClippingEnabled,M=ae.init(this.clippingPlanes,T),d=te.get(e,p.length),d.init(),p.push(d),xe(e,t,0,I.sortObjects),d.finish(),!0===I.sortObjects&&d.sort(B,R),!0===M&&ae.beginShadows();const n=h.state.shadowsArray;if(oe.render(n,e,t),!0===M&&ae.endShadows(),!0===this.info.autoReset&&this.info.reset(),ie.render(d,e),h.setupLights(I.useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,a=n.length;t<a;t++){const a=n[t];Ge(d,e,a,a.viewport)}}else Ge(d,e,t);null!==y&&(P.updateMultisampleRenderTarget(y),P.updateRenderTargetMipmap(y)),!0===e.isScene&&e.onAfterRender(I,e,t),ge.resetDefaultState(),A=-1,v=null,m.pop(),h=m.length>0?m[m.length-1]:null,p.pop(),d=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return f},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(e,t,n){U.get(e.texture).__webglTexture=t,U.get(e.depthTexture).__webglTexture=n;const a=U.get(e);a.__hasExternalTextures=!0,a.__hasExternalTextures&&(a.__autoAllocateDepthBuffer=void 0===n,a.__autoAllocateDepthBuffer||!0===L.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),a.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=U.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y=e,f=t,b=n;let a=!0,o=null,i=!1,r=!1;if(e){const n=U.get(e);void 0!==n.__useDefaultFramebuffer?(K.bindFramebuffer(36160,null),a=!1):void 0===n.__webglFramebuffer?P.setupRenderTarget(e):n.__hasExternalTextures&&P.rebindTextures(e,U.get(e.texture).__webglTexture,U.get(e.depthTexture).__webglTexture);const s=e.texture;(s.isData3DTexture||s.isDataArrayTexture||s.isCompressedArrayTexture)&&(r=!0);const l=U.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(o=l[t],i=!0):o=z.isWebGL2&&e.samples>0&&!1===P.useMultisampledRTT(e)?U.get(e).__webglMultisampledFramebuffer:l,S.copy(e.viewport),x.copy(e.scissor),G=e.scissorTest}else S.copy(W).multiplyScalar(k).floor(),x.copy(V).multiplyScalar(k).floor(),G=N;if(K.bindFramebuffer(36160,o)&&z.drawBuffers&&a&&K.drawBuffers(e,o),K.viewport(S),K.scissor(x),K.setScissorTest(G),i){const a=U.get(e.texture);de.framebufferTexture2D(36160,36064,34069+t,a.__webglTexture,n)}else if(r){const a=U.get(e.texture),o=t||0;de.framebufferTextureLayer(36160,36064,a.__webglTexture,n||0,o)}A=-1},this.readRenderTargetPixels=function(e,t,n,a,o,i,r){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=U.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==r&&(s=s[r]),s){K.bindFramebuffer(36160,s);try{const r=e.texture,s=r.format,l=r.type;if(s!==Ay&&ce.convert(s)!==de.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Iy&&(L.has("EXT_color_buffer_half_float")||z.isWebGL2&&L.has("EXT_color_buffer_float"));if(l!==cy&&ce.convert(l)!==de.getParameter(35738)&&(l!==my||!(z.isWebGL2||L.has("OES_texture_float")||L.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-a&&n>=0&&n<=e.height-o&&de.readPixels(t,n,a,o,ce.convert(s),ce.convert(l),i)}finally{const e=null!==y?U.get(y).__webglFramebuffer:null;K.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=Math.pow(2,-n),o=Math.floor(t.image.width*a),i=Math.floor(t.image.height*a);P.setTexture2D(t,0),de.copyTexSubImage2D(3553,n,0,0,e.x,e.y,o,i),K.unbindTexture()},this.copyTextureToTexture=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=t.image.width,i=t.image.height,r=ce.convert(n.format),s=ce.convert(n.type);P.setTexture2D(n,0),de.pixelStorei(37440,n.flipY),de.pixelStorei(37441,n.premultiplyAlpha),de.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?de.texSubImage2D(3553,a,e.x,e.y,o,i,r,s,t.image.data):t.isCompressedTexture?de.compressedTexSubImage2D(3553,a,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,r,t.mipmaps[0].data):de.texSubImage2D(3553,a,e.x,e.y,r,s,t.image),0===a&&n.generateMipmaps&&de.generateMipmap(3553),K.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(I.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const i=e.max.x-e.min.x+1,r=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=ce.convert(a.format),c=ce.convert(a.type);let g;if(a.isData3DTexture)P.setTexture3D(a,0),g=32879;else{if(!a.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");P.setTexture2DArray(a,0),g=35866}de.pixelStorei(37440,a.flipY),de.pixelStorei(37441,a.premultiplyAlpha),de.pixelStorei(3317,a.unpackAlignment);const u=de.getParameter(3314),d=de.getParameter(32878),h=de.getParameter(3316),p=de.getParameter(3315),m=de.getParameter(32877),C=n.isCompressedTexture?n.mipmaps[0]:n.image;de.pixelStorei(3314,C.width),de.pixelStorei(32878,C.height),de.pixelStorei(3316,e.min.x),de.pixelStorei(3315,e.min.y),de.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?de.texSubImage3D(g,o,t.x,t.y,t.z,i,r,s,l,c,C.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),de.compressedTexSubImage3D(g,o,t.x,t.y,t.z,i,r,s,l,C.data)):de.texSubImage3D(g,o,t.x,t.y,t.z,i,r,s,l,c,C),de.pixelStorei(3314,u),de.pixelStorei(32878,d),de.pixelStorei(3316,h),de.pixelStorei(3315,p),de.pixelStorei(32877,m),0===o&&a.generateMipmaps&&de.generateMipmap(g),K.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?P.setTextureCube(e,0):e.isData3DTexture?P.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?P.setTexture2DArray(e,0):P.setTexture2D(e,0),K.unbindTexture()},this.resetState=function(){f=0,b=0,y=null,K.reset(),ge.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}}class sk extends rk{}sk.prototype.isWebGL1Renderer=!0;class lk{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new mx(e),this.density=t}clone(){return new lk(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class ck{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new mx(e),this.near=t,this.far=n}clone(){return new ck(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class gk extends QS{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class uk{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=PA,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=gv()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let a=0,o=this.stride;a<o;a++)this.array[e+a]=t.array[n+a];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=gv()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=gv()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const dk=new _v;class hk{constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=a}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)dk.fromBufferAttribute(this,t),dk.applyMatrix4(e),this.setXYZ(t,dk.x,dk.y,dk.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)dk.fromBufferAttribute(this,t),dk.applyNormalMatrix(e),this.setXYZ(t,dk.x,dk.y,dk.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)dk.fromBufferAttribute(this,t),dk.transformDirection(e),this.setXYZ(t,dk.x,dk.y,dk.z);return this}setX(e,t){return this.normalized&&(t=fv(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=fv(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=fv(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=fv(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Cv(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Cv(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Cv(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Cv(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array),a=fv(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=a,this}setXYZW(e,t,n,a,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=fv(t,this.array),n=fv(n,this.array),a=fv(a,this.array),o=fv(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=a,this.data.array[e+3]=o,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Gx(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hk(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class pk extends gx{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new mx(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let mk;const Ik=new _v,Ck=new _v,fk=new _v,bk=new yv,yk=new yv,Ak=new GS,vk=new _v,Sk=new _v,xk=new _v,Gk=new yv,Zk=new yv,wk=new yv;class kk extends QS{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===mk){mk=new zx;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new uk(e,5);mk.setIndex([0,1,2,0,2,3]),mk.setAttribute("position",new hk(t,3,0,!1)),mk.setAttribute("uv",new hk(t,2,3,!1))}this.geometry=mk,this.material=void 0!==e?e:new pk,this.center=new yv(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ck.setFromMatrixScale(this.matrixWorld),Ak.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),fk.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ck.multiplyScalar(-fk.z);const n=this.material.rotation;let a,o;0!==n&&(o=Math.cos(n),a=Math.sin(n));const i=this.center;Bk(vk.set(-.5,-.5,0),fk,i,Ck,a,o),Bk(Sk.set(.5,-.5,0),fk,i,Ck,a,o),Bk(xk.set(.5,.5,0),fk,i,Ck,a,o),Gk.set(0,0),Zk.set(1,0),wk.set(1,1);let r=e.ray.intersectTriangle(vk,Sk,xk,!1,Ik);if(null===r&&(Bk(Sk.set(-.5,.5,0),fk,i,Ck,a,o),Zk.set(0,1),r=e.ray.intersectTriangle(vk,xk,Sk,!1,Ik),null===r))return;const s=e.ray.origin.distanceTo(Ik);s<e.near||s>e.far||t.push({distance:s,point:Ik.clone(),uv:lx.getInterpolation(Ik,vk,Sk,xk,Gk,Zk,wk,new yv),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Bk(e,t,n,a,o,i){bk.subVectors(e,n).addScalar(.5).multiply(a),void 0!==o?(yk.x=i*bk.x-o*bk.y,yk.y=o*bk.x+i*bk.y):yk.copy(bk),e.copy(t),e.x+=yk.x,e.y+=yk.y,e.applyMatrix4(Ak)}const Rk=new _v,Wk=new _v;class Vk extends QS{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,a=t.length;n<a;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);const a=this.levels;let o;for(o=0;o<a.length&&!(t<a[o].distance);o++);return a.splice(o,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,a;for(n=1,a=t.length;n<a;n++){let a=t[n].distance;if(t[n].object.visible&&(a-=a*t[n].hysteresis),e<a)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Rk.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Rk);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Rk.setFromMatrixPosition(e.matrixWorld),Wk.setFromMatrixPosition(this.matrixWorld);const n=Rk.distanceTo(Wk)/e.zoom;let a,o;for(t[0].object.visible=!0,a=1,o=t.length;a<o;a++){let e=t[a].distance;if(t[a].object.visible&&(e-=e*t[a].hysteresis),!(n>=e))break;t[a-1].object.visible=!1,t[a].object.visible=!0}for(this._currentLevel=a-1;a<o;a++)t[a].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let a=0,o=n.length;a<o;a++){const e=n[a];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const Nk=new _v,Xk=new Yv,Mk=new Yv,Tk=new _v,Ek=new GS,Fk=new _v;class Hk extends sG{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new GS,this.bindMatrixInverse=new GS,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new qv),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)Fk.fromBufferAttribute(t,n),this.applyBoneTransform(n,Fk),this.boundingBox.expandByPoint(Fk)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new IS),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)Fk.fromBufferAttribute(t,n),this.applyBoneTransform(n,Fk),this.boundingSphere.expandByPoint(Fk)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Yv,t=this.geometry.attributes.skinWeight;for(let n=0,a=t.count;n<a;n++){e.fromBufferAttribute(t,n);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,a=this.geometry;Xk.fromBufferAttribute(a.attributes.skinIndex,e),Mk.fromBufferAttribute(a.attributes.skinWeight,e),Nk.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const e=Mk.getComponent(o);if(0!==e){const a=Xk.getComponent(o);Ek.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(Tk.copy(Nk).applyMatrix4(Ek),e)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Jk extends QS{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Yk extends Jv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:$b,arguments.length>9&&void 0!==arguments[9]?arguments[9]:$b,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Lk=new GS,zk=new GS;class Kk{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=gv(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new GS)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new GS;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,a=this.boneTexture;for(let o=0,i=e.length;o<i;o++){const a=e[o]?e[o].matrixWorld:zk;Lk.multiplyMatrices(a,t[o]),Lk.toArray(n,16*o)}null!==a&&(a.needsUpdate=!0)}clone(){return new Kk(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=mv(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Yk(t,e,e,Ay,my);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,a=e.bones.length;n<a;n++){const a=e.bones[n];let o=t[a];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),o=new Jk),this.bones.push(o),this.boneInverses.push((new GS).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let a=0,o=t.length;a<o;a++){const o=t[a];e.bones.push(o.uuid);const i=n[a];e.boneInverses.push(i.toArray())}return e}}class Dk extends Gx{constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=a}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Uk=new GS,Pk=new GS,Ok=[],_k=new qv,Qk=new GS,jk=new sG,qk=new IS;class $k extends sG{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Dk(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let a=0;a<n;a++)this.setMatrixAt(a,Qk)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new qv),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Uk),_k.copy(e.boundingBox).applyMatrix4(Uk),this.boundingBox.union(_k)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new IS),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Uk),qk.copy(e.boundingSphere).applyMatrix4(Uk),this.boundingSphere.union(qk)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,a=this.count;if(jk.geometry=this.geometry,jk.material=this.material,void 0!==jk.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),qk.copy(this.boundingSphere),qk.applyMatrix4(n),!1!==e.ray.intersectsSphere(qk)))for(let o=0;o<a;o++){this.getMatrixAt(o,Uk),Pk.multiplyMatrices(n,Uk),jk.matrixWorld=Pk,jk.raycast(e,Ok);for(let e=0,n=Ok.length;e<n;e++){const n=Ok[e];n.instanceId=o,n.object=this,t.push(n)}Ok.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Dk(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class eB extends gx{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new mx(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const tB=new _v,nB=new _v,aB=new GS,oB=new xS,iB=new IS;class rB extends QS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zx,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eB;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,a=t.count;e<a;e++)tB.fromBufferAttribute(t,e-1),nB.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=tB.distanceTo(nB);e.setAttribute("lineDistance",new Xx(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,a=this.matrixWorld,o=e.params.Line.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),iB.copy(n.boundingSphere),iB.applyMatrix4(a),iB.radius+=o,!1===e.ray.intersectsSphere(iB))return;aB.copy(a).invert(),oB.copy(e.ray).applyMatrix4(aB);const r=o/((this.scale.x+this.scale.y+this.scale.z)/3),s=r*r,l=new _v,c=new _v,g=new _v,u=new _v,d=this.isLineSegments?2:1,h=n.index,p=n.attributes.position;if(null!==h){for(let n=Math.max(0,i.start),a=Math.min(h.count,i.start+i.count)-1;n<a;n+=d){const a=h.getX(n),o=h.getX(n+1);l.fromBufferAttribute(p,a),c.fromBufferAttribute(p,o);if(oB.distanceSqToSegment(l,c,u,g)>s)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:g.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,i.start),a=Math.min(p.count,i.start+i.count)-1;n<a;n+=d){l.fromBufferAttribute(p,n),c.fromBufferAttribute(p,n+1);if(oB.distanceSqToSegment(l,c,u,g)>s)continue;u.applyMatrix4(this.matrixWorld);const a=e.ray.origin.distanceTo(u);a<e.near||a>e.far||t.push({distance:a,point:g.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const sB=new _v,lB=new _v;class cB extends rB{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,a=t.count;e<a;e+=2)sB.fromBufferAttribute(t,e),lB.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+sB.distanceTo(lB);e.setAttribute("lineDistance",new Xx(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class gB extends rB{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class uB extends gx{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new mx(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const dB=new GS,hB=new xS,pB=new IS,mB=new _v;class IB extends QS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zx,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new uB;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,a=this.matrixWorld,o=e.params.Points.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),pB.copy(n.boundingSphere),pB.applyMatrix4(a),pB.radius+=o,!1===e.ray.intersectsSphere(pB))return;dB.copy(a).invert(),hB.copy(e.ray).applyMatrix4(dB);const r=o/((this.scale.x+this.scale.y+this.scale.z)/3),s=r*r,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,i.start),o=Math.min(l.count,i.start+i.count);n<o;n++){const o=l.getX(n);mB.fromBufferAttribute(c,o),CB(mB,o,s,a,e,t,this)}}else{for(let n=Math.max(0,i.start),o=Math.min(c.count,i.start+i.count);n<o;n++)mB.fromBufferAttribute(c,n),CB(mB,n,s,a,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function CB(e,t,n,a,o,i,r){const s=hB.distanceSqToPoint(e);if(s<n){const n=new _v;hB.closestPointToPoint(e,n),n.applyMatrix4(a);const l=o.ray.origin.distanceTo(n);if(l<o.near||l>o.far)return;i.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:r})}}class fB extends Jv{constructor(e,t,n,a,o,i,r,s,l){super(e,t,n,a,o,i,r,s,l),this.isVideoTexture=!0,this.minFilter=void 0!==i?i:oy,this.magFilter=void 0!==o?o:oy,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class bB extends Jv{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=$b,this.minFilter=$b,this.generateMipmaps=!1,this.needsUpdate=!0}}class yB extends Jv{constructor(e,t,n,a,o,i,r,s,l,c,g,u){super(null,i,r,s,l,c,a,o,g,u),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class AB extends yB{constructor(e,t,n,a,o,i){super(e,t,n,o,i),this.isCompressedArrayTexture=!0,this.image.depth=a,this.wrapR=jb}}class vB extends Jv{constructor(e,t,n,a,o,i,r,s,l){super(e,t,n,a,o,i,r,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class SB{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,a=this.getPoint(0),o=0;t.push(0);for(let i=1;i<=e;i++)n=this.getPoint(i/e),o+=n.distanceTo(a),t.push(o),a=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let a=0;const o=n.length;let i;i=t||e*n[o-1];let r,s=0,l=o-1;for(;s<=l;)if(a=Math.floor(s+(l-s)/2),r=n[a]-i,r<0)s=a+1;else{if(!(r>0)){l=a;break}l=a-1}if(a=l,n[a]===i)return a/(o-1);const c=n[a];return(a+(i-c)/(n[a+1]-c))/(o-1)}getTangent(e,t){const n=1e-4;let a=e-n,o=e+n;a<0&&(a=0),o>1&&(o=1);const i=this.getPoint(a),r=this.getPoint(o),s=t||(i.isVector2?new yv:new _v);return s.copy(r).sub(i).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new _v,a=[],o=[],i=[],r=new _v,s=new GS;for(let d=0;d<=e;d++){const t=d/e;a[d]=this.getTangentAt(t,new _v)}o[0]=new _v,i[0]=new _v;let l=Number.MAX_VALUE;const c=Math.abs(a[0].x),g=Math.abs(a[0].y),u=Math.abs(a[0].z);c<=l&&(l=c,n.set(1,0,0)),g<=l&&(l=g,n.set(0,1,0)),u<=l&&n.set(0,0,1),r.crossVectors(a[0],n).normalize(),o[0].crossVectors(a[0],r),i[0].crossVectors(a[0],o[0]);for(let d=1;d<=e;d++){if(o[d]=o[d-1].clone(),i[d]=i[d-1].clone(),r.crossVectors(a[d-1],a[d]),r.length()>Number.EPSILON){r.normalize();const e=Math.acos(uv(a[d-1].dot(a[d]),-1,1));o[d].applyMatrix4(s.makeRotationAxis(r,e))}i[d].crossVectors(a[d],o[d])}if(!0===t){let t=Math.acos(uv(o[0].dot(o[e]),-1,1));t/=e,a[0].dot(r.crossVectors(o[0],o[e]))>0&&(t=-t);for(let n=1;n<=e;n++)o[n].applyMatrix4(s.makeRotationAxis(a[n],t*n)),i[n].crossVectors(a[n],o[n])}return{tangents:a,normals:o,binormals:i}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class xB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=a,this.aStartAngle=o,this.aEndAngle=i,this.aClockwise=r,this.aRotation=s}getPoint(e,t){const n=t||new yv,a=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const i=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=a;for(;o>a;)o-=a;o<Number.EPSILON&&(o=i?0:a),!0!==this.aClockwise||i||(o===a?o=-a:o-=a);const r=this.aStartAngle+e*o;let s=this.aX+this.xRadius*Math.cos(r),l=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,a=l-this.aY;s=n*e-a*t+this.aX,l=n*t+a*e+this.aY}return n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class GB extends xB{constructor(e,t,n,a,o,i){super(e,t,n,n,a,o,i),this.isArcCurve=!0,this.type="ArcCurve"}}function ZB(){let e=0,t=0,n=0,a=0;function o(o,i,r,s){e=o,t=r,n=-3*o+3*i-2*r-s,a=2*o-2*i+r+s}return{initCatmullRom:function(e,t,n,a,i){o(t,n,i*(n-e),i*(a-t))},initNonuniformCatmullRom:function(e,t,n,a,i,r,s){let l=(t-e)/i-(n-e)/(i+r)+(n-t)/r,c=(n-t)/r-(a-t)/(r+s)+(a-n)/s;l*=r,c*=r,o(t,n,l,c)},calc:function(o){const i=o*o;return e+t*o+n*i+a*(i*o)}}}const wB=new _v,kB=new ZB,BB=new ZB,RB=new ZB;class WB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=a}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v,n=this.points,a=n.length,o=(a-(this.closed?0:1))*e;let i,r,s=Math.floor(o),l=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/a)+1)*a:0===l&&s===a-1&&(s=a-2,l=1),this.closed||s>0?i=n[(s-1)%a]:(wB.subVectors(n[0],n[1]).add(n[0]),i=wB);const c=n[s%a],g=n[(s+1)%a];if(this.closed||s+2<a?r=n[(s+2)%a]:(wB.subVectors(n[a-1],n[a-2]).add(n[a-1]),r=wB),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(i.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(g),e),a=Math.pow(g.distanceToSquared(r),e);n<1e-4&&(n=1),t<1e-4&&(t=n),a<1e-4&&(a=n),kB.initNonuniformCatmullRom(i.x,c.x,g.x,r.x,t,n,a),BB.initNonuniformCatmullRom(i.y,c.y,g.y,r.y,t,n,a),RB.initNonuniformCatmullRom(i.z,c.z,g.z,r.z,t,n,a)}else"catmullrom"===this.curveType&&(kB.initCatmullRom(i.x,c.x,g.x,r.x,this.tension),BB.initCatmullRom(i.y,c.y,g.y,r.y,this.tension),RB.initCatmullRom(i.z,c.z,g.z,r.z,this.tension));return t.set(kB.calc(l),BB.calc(l),RB.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new _v).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function VB(e,t,n,a,o){const i=.5*(a-t),r=.5*(o-n),s=e*e;return(2*n-2*a+i+r)*(e*s)+(-3*n+3*a-2*i-r)*s+i*e+n}function NB(e,t,n,a){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,a)}function XB(e,t,n,a,o){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,a)+function(e,t){return e*e*e*t}(e,o)}class MB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yv,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yv,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new yv;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=a}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv,n=this.v0,a=this.v1,o=this.v2,i=this.v3;return t.set(XB(e,n.x,a.x,o.x,i.x),XB(e,n.y,a.y,o.y,i.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class TB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new _v,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new _v;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=a}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v,n=this.v0,a=this.v1,o=this.v2,i=this.v3;return t.set(XB(e,n.x,a.x,o.x,i.x),XB(e,n.y,a.y,o.y,i.y),XB(e,n.z,a.z,o.z,i.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class EB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yv,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class FB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class HB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yv,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yv;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv,n=this.v0,a=this.v1,o=this.v2;return t.set(NB(e,n.x,a.x,o.x),NB(e,n.y,a.y,o.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class JB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new _v;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v,n=this.v0,a=this.v1,o=this.v2;return t.set(NB(e,n.x,a.x,o.x),NB(e,n.y,a.y,o.y),NB(e,n.z,a.z,o.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class YB extends SB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv,n=this.points,a=(n.length-1)*e,o=Math.floor(a),i=a-o,r=n[0===o?o:o-1],s=n[o],l=n[o>n.length-2?n.length-1:o+1],c=n[o>n.length-3?n.length-1:o+2];return t.set(VB(i,r.x,s.x,l.x,c.x),VB(i,r.y,s.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new yv).fromArray(n))}return this}}var LB=Object.freeze({__proto__:null,ArcCurve:GB,CatmullRomCurve3:WB,CubicBezierCurve:MB,CubicBezierCurve3:TB,EllipseCurve:xB,LineCurve:EB,LineCurve3:FB,QuadraticBezierCurve:HB,QuadraticBezierCurve3:JB,SplineCurve:YB});class zB extends SB{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new EB(t,e))}getPoint(e,t){const n=e*this.getLength(),a=this.getCurveLengths();let o=0;for(;o<a.length;){if(a[o]>=n){const e=a[o]-n,i=this.curves[o],r=i.getLength(),s=0===r?0:1-e/r;return i.getPointAt(s,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,a=this.curves.length;n<a;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let a=0,o=this.curves;a<o.length;a++){const i=o[a],r=i.isEllipseCurve?2*e:i.isLineCurve||i.isLineCurve3?1:i.isSplineCurve?e*i.points.length:e,s=i.getPoints(r);for(let e=0;e<s.length;e++){const a=s[e];n&&n.equals(a)||(t.push(a),n=a)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new LB[n.type]).fromJSON(n))}return this}}class KB extends zB{constructor(e){super(),this.type="Path",this.currentPoint=new yv,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new EB(this.currentPoint.clone(),new yv(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,a){const o=new HB(this.currentPoint.clone(),new yv(e,t),new yv(n,a));return this.curves.push(o),this.currentPoint.set(n,a),this}bezierCurveTo(e,t,n,a,o,i){const r=new MB(this.currentPoint.clone(),new yv(e,t),new yv(n,a),new yv(o,i));return this.curves.push(r),this.currentPoint.set(o,i),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new YB(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,a,o,i){const r=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+r,t+s,n,a,o,i),this}absarc(e,t,n,a,o,i){return this.absellipse(e,t,n,n,a,o,i),this}ellipse(e,t,n,a,o,i,r,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,a,o,i,r,s),this}absellipse(e,t,n,a,o,i,r,s){const l=new xB(e,t,n,a,o,i,r,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class DB extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new yv(0,-.5),new yv(.5,0),new yv(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:a},t=Math.floor(t),a=uv(a,0,2*Math.PI);const o=[],i=[],r=[],s=[],l=[],c=1/t,g=new _v,u=new yv,d=new _v,h=new _v,p=new _v;let m=0,I=0;for(let C=0;C<=e.length-1;C++)switch(C){case 0:m=e[C+1].x-e[C].x,I=e[C+1].y-e[C].y,d.x=1*I,d.y=-m,d.z=0*I,p.copy(d),d.normalize(),s.push(d.x,d.y,d.z);break;case e.length-1:s.push(p.x,p.y,p.z);break;default:m=e[C+1].x-e[C].x,I=e[C+1].y-e[C].y,d.x=1*I,d.y=-m,d.z=0*I,h.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),s.push(d.x,d.y,d.z),p.copy(h)}for(let C=0;C<=t;C++){const o=n+C*c*a,d=Math.sin(o),h=Math.cos(o);for(let n=0;n<=e.length-1;n++){g.x=e[n].x*d,g.y=e[n].y,g.z=e[n].x*h,i.push(g.x,g.y,g.z),u.x=C/t,u.y=n/(e.length-1),r.push(u.x,u.y);const a=s[3*n+0]*d,o=s[3*n+1],c=s[3*n+0]*h;l.push(a,o,c)}}for(let C=0;C<t;C++)for(let t=0;t<e.length-1;t++){const n=t+C*e.length,a=n,i=n+e.length,r=n+e.length+1,s=n+1;o.push(a,i,s),o.push(r,s,i)}this.setIndex(o),this.setAttribute("position",new Xx(i,3)),this.setAttribute("uv",new Xx(r,2)),this.setAttribute("normal",new Xx(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new DB(e.points,e.segments,e.phiStart,e.phiLength)}}class UB extends DB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;const o=new KB;o.absarc(0,-t/2,e,1.5*Math.PI,0),o.absarc(0,t/2,e,0,.5*Math.PI),super(o.getPoints(n),a),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:a}}static fromJSON(e){return new UB(e.radius,e.length,e.capSegments,e.radialSegments)}}class PB extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:a},t=Math.max(3,t);const o=[],i=[],r=[],s=[],l=new _v,c=new yv;i.push(0,0,0),r.push(0,0,1),s.push(.5,.5);for(let g=0,u=3;g<=t;g++,u+=3){const o=n+g/t*a;l.x=e*Math.cos(o),l.y=e*Math.sin(o),i.push(l.x,l.y,l.z),r.push(0,0,1),c.x=(i[u]/e+1)/2,c.y=(i[u+1]/e+1)/2,s.push(c.x,c.y)}for(let g=1;g<=t;g++)o.push(g,g+1,0);this.setIndex(o),this.setAttribute("position",new Xx(i,3)),this.setAttribute("normal",new Xx(r,3)),this.setAttribute("uv",new Xx(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PB(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class OB extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:a,heightSegments:o,openEnded:i,thetaStart:r,thetaLength:s};const l=this;a=Math.floor(a),o=Math.floor(o);const c=[],g=[],u=[],d=[];let h=0;const p=[],m=n/2;let I=0;function C(n){const o=h,i=new yv,p=new _v;let C=0;const f=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=a;e++)g.push(0,m*b,0),u.push(0,b,0),d.push(.5,.5),h++;const y=h;for(let e=0;e<=a;e++){const t=e/a*s+r,n=Math.cos(t),o=Math.sin(t);p.x=f*o,p.y=m*b,p.z=f*n,g.push(p.x,p.y,p.z),u.push(0,b,0),i.x=.5*n+.5,i.y=.5*o*b+.5,d.push(i.x,i.y),h++}for(let e=0;e<a;e++){const t=o+e,a=y+e;!0===n?c.push(a,a+1,t):c.push(a+1,a,t),C+=3}l.addGroup(I,C,!0===n?1:2),I+=C}!function(){const i=new _v,C=new _v;let f=0;const b=(t-e)/n;for(let l=0;l<=o;l++){const c=[],I=l/o,f=I*(t-e)+e;for(let e=0;e<=a;e++){const t=e/a,o=t*s+r,l=Math.sin(o),p=Math.cos(o);C.x=f*l,C.y=-I*n+m,C.z=f*p,g.push(C.x,C.y,C.z),i.set(l,b,p).normalize(),u.push(i.x,i.y,i.z),d.push(t,1-I),c.push(h++)}p.push(c)}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const n=p[t][e],a=p[t+1][e],o=p[t+1][e+1],i=p[t][e+1];c.push(n,a,i),c.push(a,o,i),f+=6}l.addGroup(I,f,0),I+=f}(),!1===i&&(e>0&&C(!0),t>0&&C(!1)),this.setIndex(c),this.setAttribute("position",new Xx(g,3)),this.setAttribute("normal",new Xx(u,3)),this.setAttribute("uv",new Xx(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OB(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class _B extends OB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,a,o,i,r),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:a,openEnded:o,thetaStart:i,thetaLength:r}}static fromJSON(e){return new _B(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class QB extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:a};const o=[],i=[];function r(e,t,n,a){const o=a+1,i=[];for(let r=0;r<=o;r++){i[r]=[];const a=e.clone().lerp(n,r/o),s=t.clone().lerp(n,r/o),l=o-r;for(let e=0;e<=l;e++)i[r][e]=0===e&&r===o?a:a.clone().lerp(s,e/l)}for(let r=0;r<o;r++)for(let e=0;e<2*(o-r)-1;e++){const t=Math.floor(e/2);e%2===0?(s(i[r][t+1]),s(i[r+1][t]),s(i[r][t])):(s(i[r][t+1]),s(i[r+1][t+1]),s(i[r+1][t]))}}function s(e){o.push(e.x,e.y,e.z)}function l(t,n){const a=3*t;n.x=e[a+0],n.y=e[a+1],n.z=e[a+2]}function c(e,t,n,a){a<0&&1===e.x&&(i[t]=e.x-1),0===n.x&&0===n.z&&(i[t]=a/2/Math.PI+.5)}function g(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new _v,a=new _v,o=new _v;for(let i=0;i<t.length;i+=3)l(t[i+0],n),l(t[i+1],a),l(t[i+2],o),r(n,a,o,e)}(a),function(e){const t=new _v;for(let n=0;n<o.length;n+=3)t.x=o[n+0],t.y=o[n+1],t.z=o[n+2],t.normalize().multiplyScalar(e),o[n+0]=t.x,o[n+1]=t.y,o[n+2]=t.z}(n),function(){const e=new _v;for(let n=0;n<o.length;n+=3){e.x=o[n+0],e.y=o[n+1],e.z=o[n+2];const a=g(e)/2/Math.PI+.5,r=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);i.push(a,1-r)}var t;(function(){const e=new _v,t=new _v,n=new _v,a=new _v,r=new yv,s=new yv,l=new yv;for(let u=0,d=0;u<o.length;u+=9,d+=6){e.set(o[u+0],o[u+1],o[u+2]),t.set(o[u+3],o[u+4],o[u+5]),n.set(o[u+6],o[u+7],o[u+8]),r.set(i[d+0],i[d+1]),s.set(i[d+2],i[d+3]),l.set(i[d+4],i[d+5]),a.copy(e).add(t).add(n).divideScalar(3);const h=g(a);c(r,d+0,e,h),c(s,d+2,t,h),c(l,d+4,n,h)}})(),function(){for(let e=0;e<i.length;e+=6){const t=i[e+0],n=i[e+2],a=i[e+4],o=Math.max(t,n,a),r=Math.min(t,n,a);o>.9&&r<.1&&(t<.2&&(i[e+0]+=1),n<.2&&(i[e+2]+=1),a<.2&&(i[e+4]+=1))}}()}(),this.setAttribute("position",new Xx(o,3)),this.setAttribute("normal",new Xx(o.slice(),3)),this.setAttribute("uv",new Xx(i,2)),0===a?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new QB(e.vertices,e.indices,e.radius,e.details)}}class jB extends QB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,a=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-n,0,-a,n,0,a,-n,0,a,n,-a,-n,0,-a,n,0,a,-n,0,a,n,0,-n,0,-a,n,0,-a,-n,0,a,n,0,a],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new jB(e.radius,e.detail)}}const qB=new _v,$B=new _v,eR=new _v,tR=new lx;class nR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,a=Math.pow(10,n),o=Math.cos(lv*t),i=e.getIndex(),r=e.getAttribute("position"),s=i?i.count:r.count,l=[0,0,0],c=["a","b","c"],g=new Array(3),u={},d=[];for(let e=0;e<s;e+=3){i?(l[0]=i.getX(e),l[1]=i.getX(e+1),l[2]=i.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:s}=tR;if(t.fromBufferAttribute(r,l[0]),n.fromBufferAttribute(r,l[1]),s.fromBufferAttribute(r,l[2]),tR.getNormal(eR),g[0]="".concat(Math.round(t.x*a),",").concat(Math.round(t.y*a),",").concat(Math.round(t.z*a)),g[1]="".concat(Math.round(n.x*a),",").concat(Math.round(n.y*a),",").concat(Math.round(n.z*a)),g[2]="".concat(Math.round(s.x*a),",").concat(Math.round(s.y*a),",").concat(Math.round(s.z*a)),g[0]!==g[1]&&g[1]!==g[2]&&g[2]!==g[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=g[e],a=g[t],i=tR[c[e]],r=tR[c[t]],s="".concat(n,"_").concat(a),h="".concat(a,"_").concat(n);h in u&&u[h]?(eR.dot(u[h].normal)<=o&&(d.push(i.x,i.y,i.z),d.push(r.x,r.y,r.z)),u[h]=null):s in u||(u[s]={index0:l[e],index1:l[t],normal:eR.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:n}=u[e];qB.fromBufferAttribute(r,t),$B.fromBufferAttribute(r,n),d.push(qB.x,qB.y,qB.z),d.push($B.x,$B.y,$B.z)}this.setAttribute("position",new Xx(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class aR extends KB{constructor(e){super(e),this.uuid=gv(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,a=this.holes.length;n<a;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new KB).fromJSON(n))}return this}}const oR=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const a=t&&t.length,o=a?t[0]*n:e.length;let i=iR(e,0,o,n,!0);const r=[];if(!i||i.next===i.prev)return r;let s,l,c,g,u,d,h;if(a&&(i=function(e,t,n,a){const o=[];let i,r,s,l,c;for(i=0,r=t.length;i<r;i++)s=t[i]*a,l=i<r-1?t[i+1]*a:e.length,c=iR(e,s,l,a,!1),c===c.next&&(c.steiner=!0),o.push(IR(c));for(o.sort(dR),i=0;i<o.length;i++)n=hR(o[i],n);return n}(e,t,i,n)),e.length>80*n){s=c=e[0],l=g=e[1];for(let t=n;t<o;t+=n)u=e[t],d=e[t+1],u<s&&(s=u),d<l&&(l=d),u>c&&(c=u),d>g&&(g=d);h=Math.max(c-s,g-l),h=0!==h?32767/h:0}return sR(i,r,n,s,l,h,0),r};function iR(e,t,n,a,o){let i,r;if(o===function(e,t,n,a){let o=0;for(let i=t,r=n-a;i<n;i+=a)o+=(e[r]-e[i])*(e[i+1]+e[r+1]),r=i;return o}(e,t,n,a)>0)for(i=t;i<n;i+=a)r=ZR(i,e[i],e[i+1],r);else for(i=n-a;i>=t;i-=a)r=ZR(i,e[i],e[i+1],r);return r&&yR(r,r.next)&&(wR(r),r=r.next),r}function rR(e,t){if(!e)return e;t||(t=e);let n,a=e;do{if(n=!1,a.steiner||!yR(a,a.next)&&0!==bR(a.prev,a,a.next))a=a.next;else{if(wR(a),a=t=a.prev,a===a.next)break;n=!0}}while(n||a!==t);return t}function sR(e,t,n,a,o,i,r){if(!e)return;!r&&i&&function(e,t,n,a){let o=e;do{0===o.z&&(o.z=mR(o.x,o.y,t,n,a)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){let t,n,a,o,i,r,s,l,c=1;do{for(n=e,e=null,i=null,r=0;n;){for(r++,a=n,s=0,t=0;t<c&&(s++,a=a.nextZ,a);t++);for(l=c;s>0||l>0&&a;)0!==s&&(0===l||!a||n.z<=a.z)?(o=n,n=n.nextZ,s--):(o=a,a=a.nextZ,l--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;n=a}i.nextZ=null,c*=2}while(r>1)}(o)}(e,a,o,i);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,i?cR(e,a,o,i):lR(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),wR(e),e=l.next,c=l.next;else if((e=l)===c){r?1===r?sR(e=gR(rR(e),t,n),t,n,a,o,i,2):2===r&&uR(e,t,n,a,o,i):sR(rR(e),t,n,a,o,i,1);break}}function lR(e){const t=e.prev,n=e,a=e.next;if(bR(t,n,a)>=0)return!1;const o=t.x,i=n.x,r=a.x,s=t.y,l=n.y,c=a.y,g=o<i?o<r?o:r:i<r?i:r,u=s<l?s<c?s:c:l<c?l:c,d=o>i?o>r?o:r:i>r?i:r,h=s>l?s>c?s:c:l>c?l:c;let p=a.next;for(;p!==t;){if(p.x>=g&&p.x<=d&&p.y>=u&&p.y<=h&&CR(o,s,i,l,r,c,p.x,p.y)&&bR(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function cR(e,t,n,a){const o=e.prev,i=e,r=e.next;if(bR(o,i,r)>=0)return!1;const s=o.x,l=i.x,c=r.x,g=o.y,u=i.y,d=r.y,h=s<l?s<c?s:c:l<c?l:c,p=g<u?g<d?g:d:u<d?u:d,m=s>l?s>c?s:c:l>c?l:c,I=g>u?g>d?g:d:u>d?u:d,C=mR(h,p,t,n,a),f=mR(m,I,t,n,a);let b=e.prevZ,y=e.nextZ;for(;b&&b.z>=C&&y&&y.z<=f;){if(b.x>=h&&b.x<=m&&b.y>=p&&b.y<=I&&b!==o&&b!==r&&CR(s,g,l,u,c,d,b.x,b.y)&&bR(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,y.x>=h&&y.x<=m&&y.y>=p&&y.y<=I&&y!==o&&y!==r&&CR(s,g,l,u,c,d,y.x,y.y)&&bR(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;b&&b.z>=C;){if(b.x>=h&&b.x<=m&&b.y>=p&&b.y<=I&&b!==o&&b!==r&&CR(s,g,l,u,c,d,b.x,b.y)&&bR(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;y&&y.z<=f;){if(y.x>=h&&y.x<=m&&y.y>=p&&y.y<=I&&y!==o&&y!==r&&CR(s,g,l,u,c,d,y.x,y.y)&&bR(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function gR(e,t,n){let a=e;do{const o=a.prev,i=a.next.next;!yR(o,i)&&AR(o,a,a.next,i)&&xR(o,i)&&xR(i,o)&&(t.push(o.i/n|0),t.push(a.i/n|0),t.push(i.i/n|0),wR(a),wR(a.next),a=e=i),a=a.next}while(a!==e);return rR(a)}function uR(e,t,n,a,o,i){let r=e;do{let e=r.next.next;for(;e!==r.prev;){if(r.i!==e.i&&fR(r,e)){let s=GR(r,e);return r=rR(r,r.next),s=rR(s,s.next),sR(r,t,n,a,o,i,0),void sR(s,t,n,a,o,i,0)}e=e.next}r=r.next}while(r!==e)}function dR(e,t){return e.x-t.x}function hR(e,t){const n=function(e,t){let n,a=t,o=-1/0;const i=e.x,r=e.y;do{if(r<=a.y&&r>=a.next.y&&a.next.y!==a.y){const e=a.x+(r-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(e<=i&&e>o&&(o=e,n=a.x<a.next.x?a:a.next,e===i))return n}a=a.next}while(a!==t);if(!n)return null;const s=n,l=n.x,c=n.y;let g,u=1/0;a=n;do{i>=a.x&&a.x>=l&&i!==a.x&&CR(r<c?i:o,r,l,c,r<c?o:i,r,a.x,a.y)&&(g=Math.abs(r-a.y)/(i-a.x),xR(a,e)&&(g<u||g===u&&(a.x>n.x||a.x===n.x&&pR(n,a)))&&(n=a,u=g)),a=a.next}while(a!==s);return n}(e,t);if(!n)return t;const a=GR(n,e);return rR(a,a.next),rR(n,n.next)}function pR(e,t){return bR(e.prev,e,t.prev)<0&&bR(t.next,e,e.next)<0}function mR(e,t,n,a,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function IR(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function CR(e,t,n,a,o,i,r,s){return(o-r)*(t-s)>=(e-r)*(i-s)&&(e-r)*(a-s)>=(n-r)*(t-s)&&(n-r)*(i-s)>=(o-r)*(a-s)}function fR(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&AR(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(xR(e,t)&&xR(t,e)&&function(e,t){let n=e,a=!1;const o=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!==n.next.y>i&&n.next.y!==n.y&&o<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(a=!a),n=n.next}while(n!==e);return a}(e,t)&&(bR(e.prev,e,t.prev)||bR(e,t.prev,t))||yR(e,t)&&bR(e.prev,e,e.next)>0&&bR(t.prev,t,t.next)>0)}function bR(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function yR(e,t){return e.x===t.x&&e.y===t.y}function AR(e,t,n,a){const o=SR(bR(e,t,n)),i=SR(bR(e,t,a)),r=SR(bR(n,a,e)),s=SR(bR(n,a,t));return o!==i&&r!==s||(!(0!==o||!vR(e,n,t))||(!(0!==i||!vR(e,a,t))||(!(0!==r||!vR(n,e,a))||!(0!==s||!vR(n,t,a)))))}function vR(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function SR(e){return e>0?1:e<0?-1:0}function xR(e,t){return bR(e.prev,e,e.next)<0?bR(e,t,e.next)>=0&&bR(e,e.prev,t)>=0:bR(e,t,e.prev)<0||bR(e,e.next,t)<0}function GR(e,t){const n=new kR(e.i,e.x,e.y),a=new kR(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,a.next=n,n.prev=a,i.next=a,a.prev=i,a}function ZR(e,t,n,a){const o=new kR(e,t,n);return a?(o.next=a.next,o.prev=a,a.next.prev=o,a.next=o):(o.prev=o,o.next=o),o}function wR(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function kR(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class BR{static area(e){const t=e.length;let n=0;for(let a=t-1,o=0;o<t;a=o++)n+=e[a].x*e[o].y-e[o].x*e[a].y;return.5*n}static isClockWise(e){return BR.area(e)<0}static triangulateShape(e,t){const n=[],a=[],o=[];RR(e),WR(n,e);let i=e.length;t.forEach(RR);for(let s=0;s<t.length;s++)a.push(i),i+=t[s].length,WR(n,t[s]);const r=oR(n,a);for(let s=0;s<r.length;s+=3)o.push(r.slice(s,s+3));return o}}function RR(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function WR(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class VR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new aR([new yv(.5,.5),new yv(-.5,.5),new yv(-.5,-.5),new yv(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,a=[],o=[];for(let r=0,s=e.length;r<s;r++){i(e[r])}function i(e){const i=[],r=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,g=void 0!==t.bevelThickness?t.bevelThickness:.2,u=void 0!==t.bevelSize?t.bevelSize:g-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,h=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:NR;let I,C,f,b,y,A=!1;p&&(I=p.getSpacedPoints(s),A=!0,c=!1,C=p.computeFrenetFrames(s,!1),f=new _v,b=new _v,y=new _v),c||(h=0,g=0,u=0,d=0);const v=e.extractPoints(r);let S=v.shape;const x=v.holes;if(!BR.isClockWise(S)){S=S.reverse();for(let e=0,t=x.length;e<t;e++){const t=x[e];BR.isClockWise(t)&&(x[e]=t.reverse())}}const G=BR.triangulateShape(S,x),Z=S;for(let t=0,n=x.length;t<n;t++){const e=x[t];S=S.concat(e)}function w(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const k=S.length,B=G.length;function R(e,t,n){let a,o,i;const r=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,g=r*r+s*s,u=r*c-s*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(g),d=Math.sqrt(l*l+c*c),h=t.x-s/u,p=t.y+r/u,m=((n.x-c/d-h)*c-(n.y+l/d-p)*l)/(r*c-s*l);a=h+r*m-e.x,o=p+s*m-e.y;const I=a*a+o*o;if(I<=2)return new yv(a,o);i=Math.sqrt(I/2)}else{let e=!1;r>Number.EPSILON?l>Number.EPSILON&&(e=!0):r<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(a=-s,o=r,i=Math.sqrt(g)):(a=r,o=s,i=Math.sqrt(g/2))}return new yv(a/i,o/i)}const W=[];for(let t=0,n=Z.length,a=n-1,o=t+1;t<n;t++,a++,o++)a===n&&(a=0),o===n&&(o=0),W[t]=R(Z[t],Z[a],Z[o]);const V=[];let N,X=W.concat();for(let t=0,n=x.length;t<n;t++){const e=x[t];N=[];for(let t=0,n=e.length,a=n-1,o=t+1;t<n;t++,a++,o++)a===n&&(a=0),o===n&&(o=0),N[t]=R(e[t],e[a],e[o]);V.push(N),X=X.concat(N)}for(let t=0;t<h;t++){const e=t/h,n=g*Math.cos(e*Math.PI/2),a=u*Math.sin(e*Math.PI/2)+d;for(let t=0,o=Z.length;t<o;t++){const e=w(Z[t],W[t],a);E(e.x,e.y,-n)}for(let t=0,o=x.length;t<o;t++){const e=x[t];N=V[t];for(let t=0,o=e.length;t<o;t++){const o=w(e[t],N[t],a);E(o.x,o.y,-n)}}}const M=u+d;for(let t=0;t<k;t++){const e=c?w(S[t],X[t],M):S[t];A?(b.copy(C.normals[0]).multiplyScalar(e.x),f.copy(C.binormals[0]).multiplyScalar(e.y),y.copy(I[0]).add(b).add(f),E(y.x,y.y,y.z)):E(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<k;e++){const n=c?w(S[e],X[e],M):S[e];A?(b.copy(C.normals[t]).multiplyScalar(n.x),f.copy(C.binormals[t]).multiplyScalar(n.y),y.copy(I[t]).add(b).add(f),E(y.x,y.y,y.z)):E(n.x,n.y,l/s*t)}for(let t=h-1;t>=0;t--){const e=t/h,n=g*Math.cos(e*Math.PI/2),a=u*Math.sin(e*Math.PI/2)+d;for(let t=0,o=Z.length;t<o;t++){const e=w(Z[t],W[t],a);E(e.x,e.y,l+n)}for(let t=0,o=x.length;t<o;t++){const e=x[t];N=V[t];for(let t=0,o=e.length;t<o;t++){const o=w(e[t],N[t],a);A?E(o.x,o.y+I[s-1].y,I[s-1].x+n):E(o.x,o.y,l+n)}}}function T(e,t){let n=e.length;for(;--n>=0;){const a=n;let o=n-1;o<0&&(o=e.length-1);for(let e=0,n=s+2*h;e<n;e++){const n=k*e,i=k*(e+1);H(t+a+n,t+o+n,t+o+i,t+a+i)}}}function E(e,t,n){i.push(e),i.push(t),i.push(n)}function F(e,t,o){J(e),J(t),J(o);const i=a.length/3,r=m.generateTopUV(n,a,i-3,i-2,i-1);Y(r[0]),Y(r[1]),Y(r[2])}function H(e,t,o,i){J(e),J(t),J(i),J(t),J(o),J(i);const r=a.length/3,s=m.generateSideWallUV(n,a,r-6,r-3,r-2,r-1);Y(s[0]),Y(s[1]),Y(s[3]),Y(s[1]),Y(s[2]),Y(s[3])}function J(e){a.push(i[3*e+0]),a.push(i[3*e+1]),a.push(i[3*e+2])}function Y(e){o.push(e.x),o.push(e.y)}!function(){const e=a.length/3;if(c){let e=0,t=k*e;for(let n=0;n<B;n++){const e=G[n];F(e[2]+t,e[1]+t,e[0]+t)}e=s+2*h,t=k*e;for(let n=0;n<B;n++){const e=G[n];F(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<B;e++){const t=G[e];F(t[2],t[1],t[0])}for(let e=0;e<B;e++){const t=G[e];F(t[0]+k*s,t[1]+k*s,t[2]+k*s)}}n.addGroup(e,a.length/3-e,0)}(),function(){const e=a.length/3;let t=0;T(Z,t),t+=Z.length;for(let n=0,a=x.length;n<a;n++){const e=x[n];T(e,t),t+=e.length}n.addGroup(e,a.length/3-e,1)}()}this.setAttribute("position",new Xx(a,3)),this.setAttribute("uv",new Xx(o,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let a=0,o=e.length;a<o;a++){const t=e[a];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let o=0,i=e.shapes.length;o<i;o++){const a=t[e.shapes[o]];n.push(a)}const a=e.options.extrudePath;return void 0!==a&&(e.options.extrudePath=(new LB[a.type]).fromJSON(a)),new VR(n,e.options)}}const NR={generateTopUV:function(e,t,n,a,o){const i=t[3*n],r=t[3*n+1],s=t[3*a],l=t[3*a+1],c=t[3*o],g=t[3*o+1];return[new yv(i,r),new yv(s,l),new yv(c,g)]},generateSideWallUV:function(e,t,n,a,o,i){const r=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*a],g=t[3*a+1],u=t[3*a+2],d=t[3*o],h=t[3*o+1],p=t[3*o+2],m=t[3*i],I=t[3*i+1],C=t[3*i+2];return Math.abs(s-g)<Math.abs(r-c)?[new yv(r,1-l),new yv(c,1-u),new yv(d,1-p),new yv(m,1-C)]:[new yv(s,1-l),new yv(g,1-u),new yv(h,1-p),new yv(I,1-C)]}};class XR extends QB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new XR(e.radius,e.detail)}}class MR extends QB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new MR(e.radius,e.detail)}}class TR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:a,thetaStart:o,thetaLength:i},n=Math.max(3,n),a=Math.max(1,a);const r=[],s=[],l=[],c=[];let g=e;const u=(t-e)/a,d=new _v,h=new yv;for(let p=0;p<=a;p++){for(let e=0;e<=n;e++){const a=o+e/n*i;d.x=g*Math.cos(a),d.y=g*Math.sin(a),s.push(d.x,d.y,d.z),l.push(0,0,1),h.x=(d.x/t+1)/2,h.y=(d.y/t+1)/2,c.push(h.x,h.y)}g+=u}for(let p=0;p<a;p++){const e=p*(n+1);for(let t=0;t<n;t++){const a=t+e,o=a,i=a+n+1,s=a+n+2,l=a+1;r.push(o,i,l),r.push(i,s,l)}}this.setIndex(r),this.setAttribute("position",new Xx(s,3)),this.setAttribute("normal",new Xx(l,3)),this.setAttribute("uv",new Xx(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TR(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ER extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new aR([new yv(0,.5),new yv(-.5,-.5),new yv(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],a=[],o=[],i=[];let r=0,s=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(r,s,c),r+=s,s=0;function l(e){const r=a.length/3,l=e.extractPoints(t);let c=l.shape;const g=l.holes;!1===BR.isClockWise(c)&&(c=c.reverse());for(let t=0,n=g.length;t<n;t++){const e=g[t];!0===BR.isClockWise(e)&&(g[t]=e.reverse())}const u=BR.triangulateShape(c,g);for(let t=0,n=g.length;t<n;t++){const e=g[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];a.push(e.x,e.y,0),o.push(0,0,1),i.push(e.x,e.y)}for(let t=0,a=u.length;t<a;t++){const e=u[t],a=e[0]+r,o=e[1]+r,i=e[2]+r;n.push(a,o,i),s+=3}}this.setIndex(n),this.setAttribute("position",new Xx(a,3)),this.setAttribute("normal",new Xx(o,3)),this.setAttribute("uv",new Xx(i,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,a=e.length;n<a;n++){const a=e[n];t.shapes.push(a.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let a=0,o=e.shapes.length;a<o;a++){const o=t[e.shapes[a]];n.push(o)}return new ER(n,e.curveSegments)}}class FR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:a,phiLength:o,thetaStart:i,thetaLength:r},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(i+r,Math.PI);let l=0;const c=[],g=new _v,u=new _v,d=[],h=[],p=[],m=[];for(let I=0;I<=n;I++){const d=[],C=I/n;let f=0;0===I&&0===i?f=.5/t:I===n&&s===Math.PI&&(f=-.5/t);for(let n=0;n<=t;n++){const s=n/t;g.x=-e*Math.cos(a+s*o)*Math.sin(i+C*r),g.y=e*Math.cos(i+C*r),g.z=e*Math.sin(a+s*o)*Math.sin(i+C*r),h.push(g.x,g.y,g.z),u.copy(g).normalize(),p.push(u.x,u.y,u.z),m.push(s+f,1-C),d.push(l++)}c.push(d)}for(let I=0;I<n;I++)for(let e=0;e<t;e++){const t=c[I][e+1],a=c[I][e],o=c[I+1][e],r=c[I+1][e+1];(0!==I||i>0)&&d.push(t,a,r),(I!==n-1||s<Math.PI)&&d.push(a,o,r)}this.setIndex(d),this.setAttribute("position",new Xx(h,3)),this.setAttribute("normal",new Xx(p,3)),this.setAttribute("uv",new Xx(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new FR(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class HR extends QB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new HR(e.radius,e.detail)}}class JR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:a,arc:o},n=Math.floor(n),a=Math.floor(a);const i=[],r=[],s=[],l=[],c=new _v,g=new _v,u=new _v;for(let d=0;d<=n;d++)for(let i=0;i<=a;i++){const h=i/a*o,p=d/n*Math.PI*2;g.x=(e+t*Math.cos(p))*Math.cos(h),g.y=(e+t*Math.cos(p))*Math.sin(h),g.z=t*Math.sin(p),r.push(g.x,g.y,g.z),c.x=e*Math.cos(h),c.y=e*Math.sin(h),u.subVectors(g,c).normalize(),s.push(u.x,u.y,u.z),l.push(i/a),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=a;e++){const t=(a+1)*d+e-1,n=(a+1)*(d-1)+e-1,o=(a+1)*(d-1)+e,r=(a+1)*d+e;i.push(t,n,r),i.push(n,o,r)}this.setIndex(i),this.setAttribute("position",new Xx(r,3)),this.setAttribute("normal",new Xx(s,3)),this.setAttribute("uv",new Xx(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new JR(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class YR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:a,p:o,q:i},n=Math.floor(n),a=Math.floor(a);const r=[],s=[],l=[],c=[],g=new _v,u=new _v,d=new _v,h=new _v,p=new _v,m=new _v,I=new _v;for(let f=0;f<=n;++f){const r=f/n*o*Math.PI*2;C(r,o,i,e,d),C(r+.01,o,i,e,h),m.subVectors(h,d),I.addVectors(h,d),p.crossVectors(m,I),I.crossVectors(p,m),p.normalize(),I.normalize();for(let e=0;e<=a;++e){const o=e/a*Math.PI*2,i=-t*Math.cos(o),r=t*Math.sin(o);g.x=d.x+(i*I.x+r*p.x),g.y=d.y+(i*I.y+r*p.y),g.z=d.z+(i*I.z+r*p.z),s.push(g.x,g.y,g.z),u.subVectors(g,d).normalize(),l.push(u.x,u.y,u.z),c.push(f/n),c.push(e/a)}}for(let f=1;f<=n;f++)for(let e=1;e<=a;e++){const t=(a+1)*(f-1)+(e-1),n=(a+1)*f+(e-1),o=(a+1)*f+e,i=(a+1)*(f-1)+e;r.push(t,n,i),r.push(n,o,i)}function C(e,t,n,a,o){const i=Math.cos(e),r=Math.sin(e),s=n/t*e,l=Math.cos(s);o.x=a*(2+l)*.5*i,o.y=a*(2+l)*r*.5,o.z=a*Math.sin(s)*.5}this.setIndex(r),this.setAttribute("position",new Xx(s,3)),this.setAttribute("normal",new Xx(l,3)),this.setAttribute("uv",new Xx(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YR(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class LR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new JB(new _v(-1,-1,0),new _v(-1,1,0),new _v(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:a,closed:o};const i=e.computeFrenetFrames(t,o);this.tangents=i.tangents,this.normals=i.normals,this.binormals=i.binormals;const r=new _v,s=new _v,l=new yv;let c=new _v;const g=[],u=[],d=[],h=[];function p(o){c=e.getPointAt(o/t,c);const l=i.normals[o],d=i.binormals[o];for(let e=0;e<=a;e++){const t=e/a*Math.PI*2,o=Math.sin(t),i=-Math.cos(t);s.x=i*l.x+o*d.x,s.y=i*l.y+o*d.y,s.z=i*l.z+o*d.z,s.normalize(),u.push(s.x,s.y,s.z),r.x=c.x+n*s.x,r.y=c.y+n*s.y,r.z=c.z+n*s.z,g.push(r.x,r.y,r.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===o?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=a;n++)l.x=e/t,l.y=n/a,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=a;t++){const n=(a+1)*(e-1)+(t-1),o=(a+1)*e+(t-1),i=(a+1)*e+t,r=(a+1)*(e-1)+t;h.push(n,o,r),h.push(o,i,r)}}()}(),this.setIndex(h),this.setAttribute("position",new Xx(g,3)),this.setAttribute("normal",new Xx(u,3)),this.setAttribute("uv",new Xx(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new LR((new LB[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class zR extends zx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,a=new _v,o=new _v;if(null!==e.index){const i=e.attributes.position,r=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:r.count,materialIndex:0}]);for(let e=0,l=s.length;e<l;++e){const l=s[e],c=l.start;for(let e=c,s=c+l.count;e<s;e+=3)for(let l=0;l<3;l++){const s=r.getX(e+l),c=r.getX(e+(l+1)%3);a.fromBufferAttribute(i,s),o.fromBufferAttribute(i,c),!0===KR(a,o,n)&&(t.push(a.x,a.y,a.z),t.push(o.x,o.y,o.z))}}}else{const i=e.attributes.position;for(let e=0,r=i.count/3;e<r;e++)for(let s=0;s<3;s++){const r=3*e+s,l=3*e+(s+1)%3;a.fromBufferAttribute(i,r),o.fromBufferAttribute(i,l),!0===KR(a,o,n)&&(t.push(a.x,a.y,a.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new Xx(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function KR(e,t,n){const a="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),o="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(a)&&!0!==n.has(o)&&(n.add(a),n.add(o),!0)}var DR=Object.freeze({__proto__:null,BoxGeometry:cG,CapsuleGeometry:UB,CircleGeometry:PB,ConeGeometry:_B,CylinderGeometry:OB,DodecahedronGeometry:jB,EdgesGeometry:nR,ExtrudeGeometry:VR,IcosahedronGeometry:XR,LatheGeometry:DB,OctahedronGeometry:MR,PlaneGeometry:RG,PolyhedronGeometry:QB,RingGeometry:TR,ShapeGeometry:ER,SphereGeometry:FR,TetrahedronGeometry:HR,TorusGeometry:JR,TorusKnotGeometry:YR,TubeGeometry:LR,WireframeGeometry:zR});class UR extends gx{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new mx(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class PR extends pG{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class OR extends gx{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new mx(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mx(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GA,this.normalScale=new yv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _R extends OR{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new yv(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return uv(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new mx(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new mx(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new mx(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class QR extends gx{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new mx(16777215),this.specular=new mx(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mx(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GA,this.normalScale=new yv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Mb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class jR extends gx{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new mx(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mx(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GA,this.normalScale=new yv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class qR extends gx{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GA,this.normalScale=new yv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class $R extends gx{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new mx(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mx(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GA,this.normalScale=new yv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Mb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eW extends gx{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new mx(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GA,this.normalScale=new yv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tW extends eB{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function nW(e,t,n){return oW(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function aW(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function oW(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function iW(e){const t=e.length,n=new Array(t);for(let a=0;a!==t;++a)n[a]=a;return n.sort((function(t,n){return e[t]-e[n]})),n}function rW(e,t,n){const a=e.length,o=new e.constructor(a);for(let i=0,r=0;r!==a;++i){const a=n[i]*t;for(let n=0;n!==t;++n)o[r++]=e[a+n]}return o}function sW(e,t,n,a){let o=1,i=e[0];for(;void 0!==i&&void 0===i[a];)i=e[o++];if(void 0===i)return;let r=i[a];if(void 0!==r)if(Array.isArray(r))do{r=i[a],void 0!==r&&(t.push(i.time),n.push.apply(n,r)),i=e[o++]}while(void 0!==i);else if(void 0!==r.toArray)do{r=i[a],void 0!==r&&(t.push(i.time),r.toArray(n,n.length)),i=e[o++]}while(void 0!==i);else do{r=i[a],void 0!==r&&(t.push(i.time),n.push(r)),i=e[o++]}while(void 0!==i)}const lW={arraySlice:nW,convertArray:aW,isTypedArray:oW,getKeyframeOrder:iW,sortedArray:rW,flattenJSON:sW,subclip:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const i=e.clone();i.name=t;const r=[];for(let l=0;l<i.tracks.length;++l){const e=i.tracks[l],t=e.getValueSize(),s=[],c=[];for(let i=0;i<e.times.length;++i){const r=e.times[i]*o;if(!(r<n||r>=a)){s.push(e.times[i]);for(let n=0;n<t;++n)c.push(e.values[i*t+n])}}0!==s.length&&(e.times=aW(s,e.times.constructor),e.values=aW(c,e.values.constructor),r.push(e))}i.tracks=r;let s=1/0;for(let l=0;l<i.tracks.length;++l)s>i.tracks[l].times[0]&&(s=i.tracks[l].times[0]);for(let l=0;l<i.tracks.length;++l)i.tracks[l].shift(-1*s);return i.resetDuration(),i},makeClipAdditive:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;a<=0&&(a=30);const o=n.tracks.length,i=t/a;for(let r=0;r<o;++r){const t=n.tracks[r],a=t.ValueTypeName;if("bool"===a||"string"===a)continue;const o=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===a}));if(void 0===o)continue;let s=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const g=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=g/3);const u=t.times.length-1;let d;if(i<=t.times[0]){const e=s,n=l-s;d=nW(t.values,e,n)}else if(i>=t.times[u]){const e=u*l+s,n=e+l-s;d=nW(t.values,e,n)}else{const e=t.createInterpolant(),n=s,a=l-s;e.evaluate(i),d=nW(e.resultBuffer,n,a)}if("quaternion"===a){(new Ov).fromArray(d).normalize().conjugate().toArray(d)}const h=o.times.length;for(let e=0;e<h;++e){const t=e*g+c;if("quaternion"===a)Ov.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=g-2*c;for(let n=0;n<e;++n)o.values[t+n]-=d[n]}}}return e.blendMode=CA,e}};class cW{constructor(e,t,n,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,a=t[n],o=t[n-1];e:{t:{let i;n:{a:if(!(e<a)){for(let i=n+2;;){if(void 0===a){if(e<o)break a;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===i)break;if(o=a,a=t[++n],e<a)break t}i=t.length;break n}if(e>=o)break e;{const r=t[1];e<r&&(n=2,o=r);for(let i=n-2;;){if(void 0===o)return this._cachedIndex=0,this.copySampleValue_(0);if(n===i)break;if(a=o,o=t[--n-1],e>=o)break t}i=n,n=0}}for(;n<i;){const a=n+i>>>1;e<t[a]?i=a:n=a+1}if(a=t[n],o=t[n-1],void 0===o)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===a)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,a)}return this.interpolate_(n,o,e,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a;for(let i=0;i!==a;++i)t[i]=n[o+i];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class gW extends cW{constructor(e,t,n,a){super(e,t,n,a),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:hA,endingEnd:hA}}intervalChanged_(e,t,n){const a=this.parameterPositions;let o=e-2,i=e+1,r=a[o],s=a[i];if(void 0===r)switch(this.getSettings_().endingStart){case pA:o=e,r=2*t-n;break;case mA:o=a.length-2,r=t+a[o]-a[o+1];break;default:o=e,r=n}if(void 0===s)switch(this.getSettings_().endingEnd){case pA:i=e,s=2*n-t;break;case mA:i=1,s=n+a[1]-a[0];break;default:i=e-1,s=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-r),this._weightNext=l/(s-n),this._offsetPrev=o*c,this._offsetNext=i*c}interpolate_(e,t,n,a){const o=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r,l=s-r,c=this._offsetPrev,g=this._offsetNext,u=this._weightPrev,d=this._weightNext,h=(n-t)/(a-t),p=h*h,m=p*h,I=-u*m+2*u*p-u*h,C=(1+u)*m+(-1.5-2*u)*p+(-.5+u)*h+1,f=(-1-d)*m+(1.5+d)*p+.5*h,b=d*m-d*p;for(let y=0;y!==r;++y)o[y]=I*i[c+y]+C*i[l+y]+f*i[s+y]+b*i[g+y];return o}}class uW extends cW{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e,t,n,a){const o=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r,l=s-r,c=(n-t)/(a-t),g=1-c;for(let u=0;u!==r;++u)o[u]=i[l+u]*g+i[s+u]*c;return o}}class dW extends cW{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e){return this.copySampleValue_(e-1)}}class hW{constructor(e,t,n,a){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=aW(t,this.TimeBufferType),this.values=aW(n,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:aW(e.times,Array),values:aW(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new dW(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uW(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new gW(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case gA:t=this.InterpolantFactoryMethodDiscrete;break;case uA:t=this.InterpolantFactoryMethodLinear;break;case dA:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return gA;case this.InterpolantFactoryMethodLinear:return uA;case this.InterpolantFactoryMethodSmooth:return dA}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,a=t.length;n!==a;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,a=t.length;n!==a;++n)t[n]*=e}return this}trim(e,t){const n=this.times,a=n.length;let o=0,i=a-1;for(;o!==a&&n[o]<e;)++o;for(;-1!==i&&n[i]>t;)--i;if(++i,0!==o||i!==a){o>=i&&(i=Math.max(i,1),o=i-1);const e=this.getValueSize();this.times=nW(n,o,i),this.values=nW(this.values,o*e,i*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,a=this.values,o=n.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let i=null;for(let r=0;r!==o;r++){const t=n[r];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,r,t),e=!1;break}if(null!==i&&i>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,r,t,i),e=!1;break}i=t}if(void 0!==a&&oW(a))for(let r=0,s=a.length;r!==s;++r){const t=a[r];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,r,t),e=!1;break}}return e}optimize(){const e=nW(this.times),t=nW(this.values),n=this.getValueSize(),a=this.getInterpolation()===dA,o=e.length-1;let i=1;for(let r=1;r<o;++r){let o=!1;const s=e[r];if(s!==e[r+1]&&(1!==r||s!==e[0]))if(a)o=!0;else{const e=r*n,a=e-n,i=e+n;for(let r=0;r!==n;++r){const n=t[e+r];if(n!==t[a+r]||n!==t[i+r]){o=!0;break}}}if(o){if(r!==i){e[i]=e[r];const a=r*n,o=i*n;for(let e=0;e!==n;++e)t[o+e]=t[a+e]}++i}}if(o>0){e[i]=e[o];for(let e=o*n,a=i*n,r=0;r!==n;++r)t[a+r]=t[e+r];++i}return i!==e.length?(this.times=nW(e,0,i),this.values=nW(t,0,i*n)):(this.times=e,this.values=t),this}clone(){const e=nW(this.times,0),t=nW(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}hW.prototype.TimeBufferType=Float32Array,hW.prototype.ValueBufferType=Float32Array,hW.prototype.DefaultInterpolation=uA;class pW extends hW{}pW.prototype.ValueTypeName="bool",pW.prototype.ValueBufferType=Array,pW.prototype.DefaultInterpolation=gA,pW.prototype.InterpolantFactoryMethodLinear=void 0,pW.prototype.InterpolantFactoryMethodSmooth=void 0;class mW extends hW{}mW.prototype.ValueTypeName="color";class IW extends hW{}IW.prototype.ValueTypeName="number";class CW extends cW{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e,t,n,a){const o=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=(n-t)/(a-t);let l=e*r;for(let c=l+r;l!==c;l+=4)Ov.slerpFlat(o,0,i,l-r,i,l,s);return o}}class fW extends hW{InterpolantFactoryMethodLinear(e){return new CW(this.times,this.values,this.getValueSize(),e)}}fW.prototype.ValueTypeName="quaternion",fW.prototype.DefaultInterpolation=uA,fW.prototype.InterpolantFactoryMethodSmooth=void 0;class bW extends hW{}bW.prototype.ValueTypeName="string",bW.prototype.ValueBufferType=Array,bW.prototype.DefaultInterpolation=gA,bW.prototype.InterpolantFactoryMethodLinear=void 0,bW.prototype.InterpolantFactoryMethodSmooth=void 0;class yW extends hW{}yW.prototype.ValueTypeName="vector";class AW{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:IA;this.name=e,this.tracks=n,this.duration=t,this.blendMode=a,this.uuid=gv(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,a=1/(e.fps||1);for(let i=0,r=n.length;i!==r;++i)t.push(vW(n[i]).scale(a));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],n=e.tracks,a={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,i=n.length;o!==i;++o)t.push(hW.toJSON(n[o]));return a}static CreateFromMorphTargetSequence(e,t,n,a){const o=t.length,i=[];for(let r=0;r<o;r++){let e=[],s=[];e.push((r+o-1)%o,r,(r+1)%o),s.push(0,1,0);const l=iW(e);e=rW(e,1,l),s=rW(s,1,l),a||0!==e[0]||(e.push(o),s.push(s[0])),i.push(new IW(".morphTargetInfluences["+t[r].name+"]",e,s).scale(1/n))}return new this(e,-1,i)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let a=0;a<n.length;a++)if(n[a].name===t)return n[a];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const a={},o=/^([\w-]*?)([\d]+)$/;for(let r=0,s=e.length;r<s;r++){const t=e[r],n=t.name.match(o);if(n&&n.length>1){const e=n[1];let o=a[e];o||(a[e]=o=[]),o.push(t)}}const i=[];for(const r in a)i.push(this.CreateFromMorphTargetSequence(r,a[r],t,n));return i}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,a,o){if(0!==n.length){const i=[],r=[];sW(n,i,r,a),0!==i.length&&o.push(new e(t,i,r))}},a=[],o=e.name||"default",i=e.fps||30,r=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let a=0;a<e[n].morphTargets.length;a++)t[e[n].morphTargets[a]]=-1;for(const o in t){const t=[],i=[];for(let a=0;a!==e[n].morphTargets.length;++a){const a=e[n];t.push(a.time),i.push(a.morphTarget===o?1:0)}a.push(new IW(".morphTargetInfluence["+o+"]",t,i))}s=t.length*i}else{const o=".bones["+t[c].name+"]";n(yW,o+".position",e,"pos",a),n(fW,o+".quaternion",e,"rot",a),n(yW,o+".scale",e,"scl",a)}}if(0===a.length)return null;return new this(o,s,a,r)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function vW(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return IW;case"vector":case"vector2":case"vector3":case"vector4":return yW;case"color":return mW;case"quaternion":return fW;case"bool":case"boolean":return pW;case"string":return bW}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];sW(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const SW={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class xW{constructor(e,t,n){const a=this;let o,i=!1,r=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===i&&void 0!==a.onStart&&a.onStart(e,r,s),i=!0},this.itemEnd=function(e){r++,void 0!==a.onProgress&&a.onProgress(e,r,s),r===s&&(i=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],a=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return a}return null}}}const GW=new xW;class ZW{constructor(e){this.manager=void 0!==e?e:GW,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(a,o){n.load(e,a,t,o)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const wW={};class kW extends Error{constructor(e,t){super(e),this.response=t}}class BW extends ZW{constructor(e){super(e)}load(e,t,n,a){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=SW.get(e);if(void 0!==o)return this.manager.itemStart(e),setTimeout((()=>{t&&t(o),this.manager.itemEnd(e)}),0),o;if(void 0!==wW[e])return void wW[e].push({onLoad:t,onProgress:n,onError:a});wW[e]=[],wW[e].push({onLoad:t,onProgress:n,onError:a});const i=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),r=this.mimeType,s=this.responseType;fetch(i).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=wW[e],a=t.body.getReader(),o=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),i=o?parseInt(o):0,r=0!==i;let s=0;const l=new ReadableStream({start(e){!function t(){a.read().then((a=>{let{done:o,value:l}=a;if(o)e.close();else{s+=l.byteLength;const a=new ProgressEvent("progress",{lengthComputable:r,loaded:s,total:i});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(a)}e.enqueue(l),t()}}))}()}});return new Response(l)}throw new kW('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,r)));case"json":return e.json();default:if(void 0===r)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(r),n=t&&t[1]?t[1].toLowerCase():void 0,a=new TextDecoder(n);return e.arrayBuffer().then((e=>a.decode(e)))}}})).then((t=>{SW.add(e,t);const n=wW[e];delete wW[e];for(let e=0,a=n.length;e<a;e++){const a=n[e];a.onLoad&&a.onLoad(t)}})).catch((t=>{const n=wW[e];if(void 0===n)throw this.manager.itemError(e),t;delete wW[e];for(let e=0,a=n.length;e<a;e++){const a=n[e];a.onError&&a.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class RW extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=this,i=new BW(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(Pke){a?a(Pke):console.error(Pke),o.manager.itemError(e)}}),n,a)}parse(e){const t=[];for(let n=0;n<e.length;n++){const a=AW.parse(e[n]);t.push(a)}return t}}class WW extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=this,i=[],r=new yB,s=new BW(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(o.withCredentials);let l=0;function c(c){s.load(e[c],(function(e){const n=o.parse(e,!0);i[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(r.minFilter=oy),r.image=i,r.format=n.format,r.needsUpdate=!0,t&&t(r))}),n,a)}if(Array.isArray(e))for(let g=0,u=e.length;g<u;++g)c(g);else s.load(e,(function(e){const n=o.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){i[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)i[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),i[t].format=n.format,i[t].width=n.width,i[t].height=n.height}r.image=i}else r.image.width=n.width,r.image.height=n.height,r.mipmaps=n.mipmaps;1===n.mipmapCount&&(r.minFilter=oy),r.format=n.format,r.needsUpdate=!0,t&&t(r)}),n,a);return r}}class VW extends ZW{constructor(e){super(e)}load(e,t,n,a){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,i=SW.get(e);if(void 0!==i)return o.manager.itemStart(e),setTimeout((function(){t&&t(i),o.manager.itemEnd(e)}),0),i;const r=Zv("img");function s(){c(),SW.add(e,this),t&&t(this),o.manager.itemEnd(e)}function l(t){c(),a&&a(t),o.manager.itemError(e),o.manager.itemEnd(e)}function c(){r.removeEventListener("load",s,!1),r.removeEventListener("error",l,!1)}return r.addEventListener("load",s,!1),r.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(r.crossOrigin=this.crossOrigin),o.manager.itemStart(e),r.src=e,r}}class NW extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=new bG,i=new VW(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);let r=0;function s(n){i.load(e[n],(function(e){o.images[n]=e,r++,6===r&&(o.needsUpdate=!0,t&&t(o))}),void 0,a)}for(let l=0;l<e.length;++l)s(l);return o}}class XW extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=this,i=new Yk,r=new BW(this.manager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(o.withCredentials),r.load(e,(function(e){const n=o.parse(e);n&&(void 0!==n.image?i.image=n.image:void 0!==n.data&&(i.image.width=n.width,i.image.height=n.height,i.image.data=n.data),i.wrapS=void 0!==n.wrapS?n.wrapS:jb,i.wrapT=void 0!==n.wrapT?n.wrapT:jb,i.magFilter=void 0!==n.magFilter?n.magFilter:oy,i.minFilter=void 0!==n.minFilter?n.minFilter:oy,i.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(i.encoding=n.encoding),void 0!==n.flipY&&(i.flipY=n.flipY),void 0!==n.format&&(i.format=n.format),void 0!==n.type&&(i.type=n.type),void 0!==n.mipmaps&&(i.mipmaps=n.mipmaps,i.minFilter=sy),1===n.mipmapCount&&(i.minFilter=oy),void 0!==n.generateMipmaps&&(i.generateMipmaps=n.generateMipmaps),i.needsUpdate=!0,t&&t(i,n))}),n,a),i}}class MW extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=new Jv,i=new VW(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,(function(e){o.image=e,o.needsUpdate=!0,void 0!==t&&t(o)}),n,a),o}}class TW extends QS{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new mx(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class EW extends TW{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(QS.DEFAULT_UP),this.updateMatrix(),this.groundColor=new mx(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const FW=new GS,HW=new _v,JW=new _v;class YW{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yv(512,512),this.map=null,this.mapPass=null,this.matrix=new GS,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new wG,this._frameExtents=new yv(1,1),this._viewportCount=1,this._viewports=[new Yv(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;HW.setFromMatrixPosition(e.matrixWorld),t.position.copy(HW),JW.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(JW),t.updateMatrixWorld(),FW.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(FW),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(FW)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class LW extends YW{constructor(){super(new IG(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*cv*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;n===t.fov&&a===t.aspect&&o===t.far||(t.fov=n,t.aspect=a,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class zW extends TW{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(QS.DEFAULT_UP),this.updateMatrix(),this.target=new QS,this.distance=n,this.angle=a,this.penumbra=o,this.decay=i,this.map=null,this.shadow=new LW}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const KW=new GS,DW=new _v,UW=new _v;class PW extends YW{constructor(){super(new IG(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new yv(4,2),this._viewportCount=6,this._viewports=[new Yv(2,1,1,1),new Yv(0,1,1,1),new Yv(3,1,1,1),new Yv(1,1,1,1),new Yv(3,0,1,1),new Yv(1,0,1,1)],this._cubeDirections=[new _v(1,0,0),new _v(-1,0,0),new _v(0,0,1),new _v(0,0,-1),new _v(0,1,0),new _v(0,-1,0)],this._cubeUps=[new _v(0,1,0),new _v(0,1,0),new _v(0,1,0),new _v(0,1,0),new _v(0,0,1),new _v(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,a=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),DW.setFromMatrixPosition(e.matrixWorld),n.position.copy(DW),UW.copy(n.position),UW.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(UW),n.updateMatrixWorld(),a.makeTranslation(-DW.x,-DW.y,-DW.z),KW.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(KW)}}class OW extends TW{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=a,this.shadow=new PW}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class _W extends YW{constructor(){super(new YG(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class QW extends TW{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(QS.DEFAULT_UP),this.updateMatrix(),this.target=new QS,this.shadow=new _W}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class jW extends TW{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class qW extends TW{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=a}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class $W{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new _v)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,a=e.y,o=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.282095),t.addScaledVector(i[1],.488603*a),t.addScaledVector(i[2],.488603*o),t.addScaledVector(i[3],.488603*n),t.addScaledVector(i[4],n*a*1.092548),t.addScaledVector(i[5],a*o*1.092548),t.addScaledVector(i[6],.315392*(3*o*o-1)),t.addScaledVector(i[7],n*o*1.092548),t.addScaledVector(i[8],.546274*(n*n-a*a)),t}getIrradianceAt(e,t){const n=e.x,a=e.y,o=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.886227),t.addScaledVector(i[1],1.023328*a),t.addScaledVector(i[2],1.023328*o),t.addScaledVector(i[3],1.023328*n),t.addScaledVector(i[4],.858086*n*a),t.addScaledVector(i[5],.858086*a*o),t.addScaledVector(i[6],.743125*o*o-.247708),t.addScaledVector(i[7],.858086*n*o),t.addScaledVector(i[8],.429043*(n*n-a*a)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let a=0;a<9;a++)n[a].fromArray(e,t+3*a);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let a=0;a<9;a++)n[a].toArray(e,t+3*a);return e}static getBasisAt(e,t){const n=e.x,a=e.y,o=e.z;t[0]=.282095,t[1]=.488603*a,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*a,t[5]=1.092548*a*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-a*a)}}class eV extends TW{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new $W;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class tV extends ZW{constructor(e){super(e),this.textures={}}load(e,t,n,a){const o=this,i=new BW(o.manager);i.setPath(o.path),i.setRequestHeader(o.requestHeader),i.setWithCredentials(o.withCredentials),i.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(Pke){a?a(Pke):console.error(Pke),o.manager.itemError(e)}}),n,a)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const a=tV.createMaterialFromType(e.type);if(void 0!==e.uuid&&(a.uuid=e.uuid),void 0!==e.name&&(a.name=e.name),void 0!==e.color&&void 0!==a.color&&a.color.setHex(e.color),void 0!==e.roughness&&(a.roughness=e.roughness),void 0!==e.metalness&&(a.metalness=e.metalness),void 0!==e.sheen&&(a.sheen=e.sheen),void 0!==e.sheenColor&&(a.sheenColor=(new mx).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(a.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==a.emissive&&a.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==a.specular&&a.specular.setHex(e.specular),void 0!==e.specularIntensity&&(a.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==a.specularColor&&a.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(a.shininess=e.shininess),void 0!==e.clearcoat&&(a.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(a.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(a.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(a.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(a.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(a.transmission=e.transmission),void 0!==e.thickness&&(a.thickness=e.thickness),void 0!==e.attenuationDistance&&(a.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==a.attenuationColor&&a.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(a.fog=e.fog),void 0!==e.flatShading&&(a.flatShading=e.flatShading),void 0!==e.blending&&(a.blending=e.blending),void 0!==e.combine&&(a.combine=e.combine),void 0!==e.side&&(a.side=e.side),void 0!==e.shadowSide&&(a.shadowSide=e.shadowSide),void 0!==e.opacity&&(a.opacity=e.opacity),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.alphaTest&&(a.alphaTest=e.alphaTest),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(a.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(a.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(a.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(a.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(a.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(a.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(a.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(a.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(a.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(a.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(a.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(a.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(a.rotation=e.rotation),1!==e.linewidth&&(a.linewidth=e.linewidth),void 0!==e.dashSize&&(a.dashSize=e.dashSize),void 0!==e.gapSize&&(a.gapSize=e.gapSize),void 0!==e.scale&&(a.scale=e.scale),void 0!==e.polygonOffset&&(a.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(a.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(a.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(a.dithering=e.dithering),void 0!==e.alphaToCoverage&&(a.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(a.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(a.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.toneMapped&&(a.toneMapped=e.toneMapped),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?a.vertexColors=e.vertexColors>0:a.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const o in e.uniforms){const t=e.uniforms[o];switch(a.uniforms[o]={},t.type){case"t":a.uniforms[o].value=n(t.value);break;case"c":a.uniforms[o].value=(new mx).setHex(t.value);break;case"v2":a.uniforms[o].value=(new yv).fromArray(t.value);break;case"v3":a.uniforms[o].value=(new _v).fromArray(t.value);break;case"v4":a.uniforms[o].value=(new Yv).fromArray(t.value);break;case"m3":a.uniforms[o].value=(new Av).fromArray(t.value);break;case"m4":a.uniforms[o].value=(new GS).fromArray(t.value);break;default:a.uniforms[o].value=t.value}}if(void 0!==e.defines&&(a.defines=e.defines),void 0!==e.vertexShader&&(a.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(a.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(a.glslVersion=e.glslVersion),void 0!==e.extensions)for(const o in e.extensions)a.extensions[o]=e.extensions[o];if(void 0!==e.size&&(a.size=e.size),void 0!==e.sizeAttenuation&&(a.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(a.map=n(e.map)),void 0!==e.matcap&&(a.matcap=n(e.matcap)),void 0!==e.alphaMap&&(a.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(a.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(a.bumpScale=e.bumpScale),void 0!==e.normalMap&&(a.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(a.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),a.normalScale=(new yv).fromArray(t)}return void 0!==e.displacementMap&&(a.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(a.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(a.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(a.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(a.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(a.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(a.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(a.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(a.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(a.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(a.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(a.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(a.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(a.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(a.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(a.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(a.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(a.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(a.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(a.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(a.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(a.clearcoatNormalScale=(new yv).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(a.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(a.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(a.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(a.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(a.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(a.sheenRoughnessMap=n(e.sheenRoughnessMap)),a}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:UR,SpriteMaterial:pk,RawShaderMaterial:PR,ShaderMaterial:pG,PointsMaterial:uB,MeshPhysicalMaterial:_R,MeshStandardMaterial:OR,MeshPhongMaterial:QR,MeshToonMaterial:jR,MeshNormalMaterial:qR,MeshLambertMaterial:$R,MeshDepthMaterial:Dw,MeshDistanceMaterial:Uw,MeshBasicMaterial:Cx,MeshMatcapMaterial:eW,LineDashedMaterial:tW,LineBasicMaterial:eB,Material:gx}[e]}}class nV{static decodeText(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(Pke){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class aV extends zx{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class oV extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=this,i=new BW(o.manager);i.setPath(o.path),i.setRequestHeader(o.requestHeader),i.setWithCredentials(o.withCredentials),i.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(Pke){a?a(Pke):console.error(Pke),o.manager.itemError(e)}}),n,a)}parse(e){const t={},n={};function a(e,a){if(void 0!==t[a])return t[a];const o=e.interleavedBuffers[a],i=function(e,t){if(void 0!==n[t])return n[t];const a=e.arrayBuffers,o=a[t],i=new Uint32Array(o).buffer;return n[t]=i,i}(e,o.buffer),r=Gv(o.type,i),s=new uk(r,o.stride);return s.uuid=o.uuid,t[a]=s,s}const o=e.isInstancedBufferGeometry?new aV:new zx,i=e.data.index;if(void 0!==i){const e=Gv(i.type,i.array);o.setIndex(new Gx(e,1))}const r=e.data.attributes;for(const g in r){const t=r[g];let n;if(t.isInterleavedBufferAttribute){const o=a(e.data,t.data);n=new hk(o,t.itemSize,t.offset,t.normalized)}else{const e=Gv(t.type,t.array);n=new(t.isInstancedBufferAttribute?Dk:Gx)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),void 0!==t.updateRange&&(n.updateRange.offset=t.updateRange.offset,n.updateRange.count=t.updateRange.count),o.setAttribute(g,n)}const s=e.data.morphAttributes;if(s)for(const g in s){const t=s[g],n=[];for(let o=0,i=t.length;o<i;o++){const i=t[o];let r;if(i.isInterleavedBufferAttribute){const t=a(e.data,i.data);r=new hk(t,i.itemSize,i.offset,i.normalized)}else{const e=Gv(i.type,i.array);r=new Gx(e,i.itemSize,i.normalized)}void 0!==i.name&&(r.name=i.name),n.push(r)}o.morphAttributes[g]=n}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let g=0,u=l.length;g!==u;++g){const e=l[g];o.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new _v;void 0!==c.center&&e.fromArray(c.center),o.boundingSphere=new IS(e,c.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class iV extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=this,i=""===this.path?nV.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const r=new BW(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){let i=null;try{i=JSON.parse(n)}catch(s){return void 0!==a&&a(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}const r=i.metadata;if(void 0===r||void 0===r.type||"geometry"===r.type.toLowerCase())return void 0!==a&&a(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);o.parse(i,t)}),n,a)}async loadAsync(e,t){const n=""===this.path?nV.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const a=new BW(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const o=await a.loadAsync(e,t),i=JSON.parse(o),r=i.metadata;if(void 0===r||void 0===r.type||"geometry"===r.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(i)}parse(e,t){const n=this.parseAnimations(e.animations),a=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,a),i=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),r=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,r),l=this.parseObject(e.object,o,s,r,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in i)if(i[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,n),o=await this.parseImagesAsync(e.images),i=this.parseTextures(e.textures,o),r=this.parseMaterials(e.materials,i),s=this.parseObject(e.object,a,r,i,t),l=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,l),s}parseShapes(e){const t={};if(void 0!==e)for(let n=0,a=e.length;n<a;n++){const a=(new aR).fromJSON(e[n]);t[a.uuid]=a}return t}parseSkeletons(e,t){const n={},a={};if(t.traverse((function(e){e.isBone&&(a[e.uuid]=e)})),void 0!==e)for(let o=0,i=e.length;o<i;o++){const t=(new Kk).fromJSON(e[o],a);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const a=new oV;for(let o=0,i=e.length;o<i;o++){let i;const r=e[o];switch(r.type){case"BufferGeometry":case"InstancedBufferGeometry":i=a.parse(r);break;default:r.type in DR?i=DR[r.type].fromJSON(r,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(r.type,'"'))}i.uuid=r.uuid,void 0!==r.name&&(i.name=r.name),void 0!==r.userData&&(i.userData=r.userData),n[r.uuid]=i}}return n}parseMaterials(e,t){const n={},a={};if(void 0!==e){const o=new tV;o.setTextures(t);for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0===n[i.uuid]&&(n[i.uuid]=o.parse(i)),a[i.uuid]=n[i.uuid]}}return a}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const a=e[n],o=AW.parse(a);t[o.uuid]=o}return t}parseImages(e,t){const n=this,a={};let o;function i(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Gv(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new xW(t);o=new VW(n),o.setCrossOrigin(this.crossOrigin);for(let t=0,o=e.length;t<o;t++){const n=e[t],o=n.url;if(Array.isArray(o)){const e=[];for(let t=0,n=o.length;t<n;t++){const n=i(o[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Yk(n.data,n.width,n.height)))}a[n.uuid]=new Ev(e)}else{const e=i(n.url);a[n.uuid]=new Ev(e)}}}return a}async parseImagesAsync(e){const t=this,n={};let a;async function o(e){if("string"===typeof e){const n=e,o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await a.loadAsync(o)}return e.data?{data:Gv(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){a=new VW(this.manager),a.setCrossOrigin(this.crossOrigin);for(let t=0,a=e.length;t<a;t++){const a=e[t],i=a.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=i[t],a=await o(n);null!==a&&(a instanceof HTMLImageElement?e.push(a):e.push(new Yk(a.data,a.width,a.height)))}n[a.uuid]=new Ev(e)}else{const e=await o(a.url);n[a.uuid]=new Ev(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const a={};if(void 0!==e)for(let o=0,i=e.length;o<i;o++){const i=e[o];void 0===i.image&&console.warn('THREE.ObjectLoader: No "image" specified for',i.uuid),void 0===t[i.image]&&console.warn("THREE.ObjectLoader: Undefined image",i.image);const r=t[i.image],s=r.data;let l;Array.isArray(s)?(l=new bG,6===s.length&&(l.needsUpdate=!0)):(l=s&&s.data?new Yk:new Jv,s&&(l.needsUpdate=!0)),l.source=r,l.uuid=i.uuid,void 0!==i.name&&(l.name=i.name),void 0!==i.mapping&&(l.mapping=n(i.mapping,rV)),void 0!==i.channel&&(l.channel=i.channel),void 0!==i.offset&&l.offset.fromArray(i.offset),void 0!==i.repeat&&l.repeat.fromArray(i.repeat),void 0!==i.center&&l.center.fromArray(i.center),void 0!==i.rotation&&(l.rotation=i.rotation),void 0!==i.wrap&&(l.wrapS=n(i.wrap[0],sV),l.wrapT=n(i.wrap[1],sV)),void 0!==i.format&&(l.format=i.format),void 0!==i.internalFormat&&(l.internalFormat=i.internalFormat),void 0!==i.type&&(l.type=i.type),void 0!==i.encoding&&(l.encoding=i.encoding),void 0!==i.minFilter&&(l.minFilter=n(i.minFilter,lV)),void 0!==i.magFilter&&(l.magFilter=n(i.magFilter,lV)),void 0!==i.anisotropy&&(l.anisotropy=i.anisotropy),void 0!==i.flipY&&(l.flipY=i.flipY),void 0!==i.generateMipmaps&&(l.generateMipmaps=i.generateMipmaps),void 0!==i.premultiplyAlpha&&(l.premultiplyAlpha=i.premultiplyAlpha),void 0!==i.unpackAlignment&&(l.unpackAlignment=i.unpackAlignment),void 0!==i.userData&&(l.userData=i.userData),a[i.uuid]=l}return a}parseObject(e,t,n,a,o){let i,r,s;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let a=0,o=e.length;a<o;a++){const o=e[a];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function g(e){return void 0===a[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),a[e]}switch(e.type){case"Scene":i=new gk,void 0!==e.background&&(Number.isInteger(e.background)?i.background=new mx(e.background):i.background=g(e.background)),void 0!==e.environment&&(i.environment=g(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new ck(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new lk(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(i.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(i.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":i=new IG(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new YG(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new jW(e.color,e.intensity);break;case"DirectionalLight":i=new QW(e.color,e.intensity);break;case"PointLight":i=new OW(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new qW(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new zW(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new EW(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new eV).fromJSON(e);break;case"SkinnedMesh":r=l(e.geometry),s=c(e.material),i=new Hk(r,s),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":r=l(e.geometry),s=c(e.material),i=new sG(r,s);break;case"InstancedMesh":r=l(e.geometry),s=c(e.material);const t=e.count,n=e.instanceMatrix,a=e.instanceColor;i=new $k(r,s,t),i.instanceMatrix=new Dk(new Float32Array(n.array),16),void 0!==a&&(i.instanceColor=new Dk(new Float32Array(a.array),a.itemSize));break;case"LOD":i=new Vk;break;case"Line":i=new rB(l(e.geometry),c(e.material));break;case"LineLoop":i=new gB(l(e.geometry),c(e.material));break;case"LineSegments":i=new cB(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":i=new IB(l(e.geometry),c(e.material));break;case"Sprite":i=new kk(c(e.material));break;case"Group":i=new qw;break;case"Bone":i=new Jk;break;default:i=new QS}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.up&&i.up.fromArray(e.up),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){const r=e.children;for(let e=0;e<r.length;e++)i.add(this.parseObject(r[e],t,n,a,o))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];i.animations.push(o[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],a=i.getObjectByProperty("uuid",n.object);void 0!==a&&i.addLevel(a,n.distance,n.hysteresis)}}return i}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}}const rV={UVMapping:Kb,CubeReflectionMapping:Db,CubeRefractionMapping:Ub,EquirectangularReflectionMapping:Pb,EquirectangularRefractionMapping:Ob,CubeUVReflectionMapping:_b},sV={RepeatWrapping:Qb,ClampToEdgeWrapping:jb,MirroredRepeatWrapping:qb},lV={NearestFilter:$b,NearestMipmapNearestFilter:ey,NearestMipmapLinearFilter:ny,LinearFilter:oy,LinearMipmapNearestFilter:iy,LinearMipmapLinearFilter:sy};class cV extends ZW{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,a){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,i=SW.get(e);if(void 0!==i)return o.manager.itemStart(e),setTimeout((function(){t&&t(i),o.manager.itemEnd(e)}),0),i;const r={};r.credentials="anonymous"===this.crossOrigin?"same-origin":"include",r.headers=this.requestHeader,fetch(e,r).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(o.options,{colorSpaceConversion:"none"}))})).then((function(n){SW.add(e,n),t&&t(n),o.manager.itemEnd(e)})).catch((function(t){a&&a(t),o.manager.itemError(e),o.manager.itemEnd(e)})),o.manager.itemStart(e)}}let gV;class uV{static getContext(){return void 0===gV&&(gV=new(window.AudioContext||window.webkitAudioContext)),gV}static setContext(e){gV=e}}class dV extends ZW{constructor(e){super(e)}load(e,t,n,a){const o=this,i=new BW(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{const e=n.slice(0);uV.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(Pke){a?a(Pke):console.error(Pke),o.manager.itemError(e)}}),n,a)}}class hV extends eV{constructor(e,t){super(void 0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),this.isHemisphereLightProbe=!0;const n=(new mx).set(e),a=(new mx).set(t),o=new _v(n.r,n.g,n.b),i=new _v(a.r,a.g,a.b),r=Math.sqrt(Math.PI),s=r*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(i).multiplyScalar(r),this.sh.coefficients[1].copy(o).sub(i).multiplyScalar(s)}}class pV extends eV{constructor(e){super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isAmbientLightProbe=!0;const t=(new mx).set(e);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const mV=new GS,IV=new GS,CV=new GS;class fV{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new IG,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new IG,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,CV.copy(e.projectionMatrix);const n=t.eyeSep/2,a=n*t.near/t.focus,o=t.near*Math.tan(lv*t.fov*.5)/t.zoom;let i,r;IV.elements[12]=-n,mV.elements[12]=n,i=-o*t.aspect+a,r=o*t.aspect+a,CV.elements[0]=2*t.near/(r-i),CV.elements[8]=(r+i)/(r-i),this.cameraL.projectionMatrix.copy(CV),i=-o*t.aspect-a,r=o*t.aspect-a,CV.elements[0]=2*t.near/(r-i),CV.elements[8]=(r+i)/(r-i),this.cameraR.projectionMatrix.copy(CV)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(IV),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(mV)}}class bV{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yV(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=yV();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function yV(){return("undefined"===typeof performance?Date:performance).now()}const AV=new _v,vV=new Ov,SV=new _v,xV=new _v;class GV extends QS{constructor(){super(),this.type="AudioListener",this.context=uV.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new bV}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(AV,vV,SV),xV.set(0,0,-1).applyQuaternion(vV),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(AV.x,e),t.positionY.linearRampToValueAtTime(AV.y,e),t.positionZ.linearRampToValueAtTime(AV.z,e),t.forwardX.linearRampToValueAtTime(xV.x,e),t.forwardY.linearRampToValueAtTime(xV.y,e),t.forwardZ.linearRampToValueAtTime(xV.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(AV.x,AV.y,AV.z),t.setOrientation(xV.x,xV.y,xV.z,n.x,n.y,n.z)}}class ZV extends QS{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const wV=new _v,kV=new Ov,BV=new _v,RV=new _v;class WV extends ZV{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(wV,kV,BV),RV.set(0,0,1).applyQuaternion(kV);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(wV.x,e),t.positionY.linearRampToValueAtTime(wV.y,e),t.positionZ.linearRampToValueAtTime(wV.z,e),t.orientationX.linearRampToValueAtTime(RV.x,e),t.orientationY.linearRampToValueAtTime(RV.y,e),t.orientationZ.linearRampToValueAtTime(RV.z,e)}else t.setPosition(wV.x,wV.y,wV.z),t.setOrientation(RV.x,RV.y,RV.z)}}class VV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class NV{constructor(e,t,n){let a,o,i;switch(this.binding=e,this.valueSize=n,t){case"quaternion":a=this._slerp,o=this._slerpAdditive,i=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":a=this._select,o=this._select,i=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:a=this._lerp,o=this._lerpAdditive,i=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=o,this._setIdentity=i,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,a=this.valueSize,o=e*a+a;let i=this.cumulativeWeight;if(0===i){for(let e=0;e!==a;++e)n[o+e]=n[e];i=t}else{i+=t;const e=t/i;this._mixBufferRegion(n,o,0,e,a)}this.cumulativeWeight=i}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,a=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,a,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,a=e*t+t,o=this.cumulativeWeight,i=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const e=t*this._origIndex;this._mixBufferRegion(n,a,e,1-o,t)}i>0&&this._mixBufferRegionAdditive(n,a,this._addIndex*t,1,t);for(let s=t,l=t+t;s!==l;++s)if(n[s]!==n[s+t]){r.setValue(n,a);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,a=n*this._origIndex;e.getValue(t,a);for(let o=n,i=a;o!==i;++o)t[o]=t[a+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,a,o){if(a>=.5)for(let i=0;i!==o;++i)e[t+i]=e[n+i]}_slerp(e,t,n,a){Ov.slerpFlat(e,t,e,t,e,n,a)}_slerpAdditive(e,t,n,a,o){const i=this._workIndex*o;Ov.multiplyQuaternionsFlat(e,i,e,t,e,n),Ov.slerpFlat(e,t,e,t,e,i,a)}_lerp(e,t,n,a,o){const i=1-a;for(let r=0;r!==o;++r){const o=t+r;e[o]=e[o]*i+e[n+r]*a}}_lerpAdditive(e,t,n,a,o){for(let i=0;i!==o;++i){const o=t+i;e[o]=e[o]+e[n+i]*a}}}const XV="\\[\\]\\.:\\/",MV=new RegExp("["+XV+"]","g"),TV="[^"+XV+"]",EV="[^"+XV.replace("\\.","")+"]",FV=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",TV)+/(WCOD+)?/.source.replace("WCOD",EV)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",TV)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",TV)+"$"),HV=["material","materials","bones","map"];class JV{constructor(e,t,n){this.path=t,this.parsedPath=n||JV.parseTrackName(t),this.node=JV.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new JV.Composite(e,t,n):new JV(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(MV,"")}static parseTrackName(e){const t=FV.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},a=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==a&&-1!==a){const e=n.nodeName.substring(a+1);-1!==HV.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,a),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let a=0;a<e.length;a++){const o=e[a];if(o.name===t||o.uuid===t)return o;const i=n(o.children);if(i)return i}return null},a=n(e.children);if(a)return a}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)e[t++]=n[a]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,a=t.propertyName;let o=t.propertyIndex;if(e||(e=JV.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===a){a=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}const i=e[a];if(void 0===i){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+a+" but it wasn't found.",e)}let r=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?r=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(r=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===a){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[o]&&(o=e.morphTargetDictionary[o])}s=this.BindingType.ArrayElement,this.resolvedProperty=i,this.propertyIndex=o}else void 0!==i.fromArray&&void 0!==i.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=i):Array.isArray(i)?(s=this.BindingType.EntireArray,this.resolvedProperty=i):this.propertyName=a;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}JV.Composite=class{constructor(e,t,n){const a=n||JV.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,a)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,a=this._bindings[n];void 0!==a&&a.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let a=this._targetGroup.nCachedObjects_,o=n.length;a!==o;++a)n[a].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},JV.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},JV.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},JV.prototype.GetterByBindingType=[JV.prototype._getValue_direct,JV.prototype._getValue_array,JV.prototype._getValue_arrayElement,JV.prototype._getValue_toArray],JV.prototype.SetterByBindingTypeAndVersioning=[[JV.prototype._setValue_direct,JV.prototype._setValue_direct_setNeedsUpdate,JV.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[JV.prototype._setValue_array,JV.prototype._setValue_array_setNeedsUpdate,JV.prototype._setValue_array_setMatrixWorldNeedsUpdate],[JV.prototype._setValue_arrayElement,JV.prototype._setValue_arrayElement_setNeedsUpdate,JV.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[JV.prototype._setValue_fromArray,JV.prototype._setValue_fromArray_setNeedsUpdate,JV.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class YV{constructor(){this.isAnimationObjectGroup=!0,this.uuid=gv(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,a=arguments.length;n!==a;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,i=o.length;let r,s=e.length,l=this.nCachedObjects_;for(let c=0,g=arguments.length;c!==g;++c){const g=arguments[c],u=g.uuid;let d=t[u];if(void 0===d){d=s++,t[u]=d,e.push(g);for(let e=0,t=i;e!==t;++e)o[e].push(new JV(g,n[e],a[e]))}else if(d<l){r=e[d];const s=--l,c=e[s];t[c.uuid]=d,e[d]=c,t[u]=s,e[s]=g;for(let e=0,t=i;e!==t;++e){const t=o[e],i=t[s];let r=t[d];t[d]=i,void 0===r&&(r=new JV(g,n[e],a[e])),t[s]=r}}else e[d]!==r&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_;for(let i=0,r=arguments.length;i!==r;++i){const r=arguments[i],s=r.uuid,l=t[s];if(void 0!==l&&l>=o){const i=o++,c=e[i];t[c.uuid]=l,e[l]=c,t[s]=i,e[i]=r;for(let e=0,t=a;e!==t;++e){const t=n[e],a=t[i],o=t[l];t[l]=a,t[i]=o}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_,i=e.length;for(let r=0,s=arguments.length;r!==s;++r){const s=arguments[r].uuid,l=t[s];if(void 0!==l)if(delete t[s],l<o){const r=--o,s=e[r],c=--i,g=e[c];t[s.uuid]=l,e[l]=s,t[g.uuid]=r,e[r]=g,e.pop();for(let e=0,t=a;e!==t;++e){const t=n[e],a=t[r],o=t[c];t[l]=a,t[r]=o,t.pop()}}else{const o=--i,r=e[o];o>0&&(t[r.uuid]=l),e[l]=r,e.pop();for(let e=0,t=a;e!==t;++e){const t=n[e];t[l]=t[o],t.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const n=this._bindingsIndicesByPath;let a=n[e];const o=this._bindings;if(void 0!==a)return o[a];const i=this._paths,r=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,g=new Array(l);a=o.length,n[e]=a,i.push(e),r.push(t),o.push(g);for(let u=c,d=s.length;u!==d;++u){const n=s[u];g[u]=new JV(n,e,t)}return g}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const a=this._paths,o=this._parsedPaths,i=this._bindings,r=i.length-1,s=i[r];t[e[r]]=n,i[n]=s,i.pop(),o[n]=o[r],o.pop(),a[n]=a[r],a.pop()}}}class LV{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=a;const o=t.tracks,i=o.length,r=new Array(i),s={endingStart:hA,endingEnd:hA};for(let l=0;l!==i;++l){const e=o[l].createInterpolant(null);r[l]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=r,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=lA,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,a=e._clip.duration,o=a/n,i=n/a;e.warp(1,o,t),this.warp(i,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const a=this._mixer,o=a.time,i=this.timeScale;let r=this._timeScaleInterpolant;null===r&&(r=a._lendControlInterpolant(),this._timeScaleInterpolant=r);const s=r.parameterPositions,l=r.sampleValues;return s[0]=o,s[1]=o+n,l[0]=e/i,l[1]=t/i,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,a){if(!this.enabled)return void this._updateWeight(e);const o=this._startTime;if(null!==o){const a=(e-o)*n;a<0||0===n?t=0:(this._startTime=null,t=n*a)}t*=this._updateTimeScale(e);const i=this._updateTime(t),r=this._updateWeight(e);if(r>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===CA)for(let n=0,a=e.length;n!==a;++n)e[n].evaluate(i),t[n].accumulateAdditive(r);else for(let n=0,o=e.length;n!==o;++n)e[n].evaluate(i),t[n].accumulate(a,r)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const a=n.evaluate(e)[0];t*=a,e>n.parameterPositions[1]&&(this.stopFading(),0===a&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let a=this.time+e,o=this._loopCount;const i=n===cA;if(0===e)return-1===o?a:i&&1===(1&o)?t-a:a;if(n===sA){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=t)a=t;else{if(!(a<0)){this.time=a;break e}a=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===o&&(e>=0?(o=0,this._setEndings(!0,0===this.repetitions,i)):this._setEndings(0===this.repetitions,!0,i)),a>=t||a<0){const n=Math.floor(a/t);a-=t*n,o+=Math.abs(n);const r=this.repetitions-o;if(r<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=e>0?t:0,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===r){const t=e<0;this._setEndings(t,!t,i)}else this._setEndings(!1,!1,i);this._loopCount=o,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=a;if(i&&1===(1&o))return t-a}return a}_setEndings(e,t,n){const a=this._interpolantSettings;n?(a.endingStart=pA,a.endingEnd=pA):(a.endingStart=e?this.zeroSlopeAtStart?pA:hA:mA,a.endingEnd=t?this.zeroSlopeAtEnd?pA:hA:mA)}_scheduleFading(e,t,n){const a=this._mixer,o=a.time;let i=this._weightInterpolant;null===i&&(i=a._lendControlInterpolant(),this._weightInterpolant=i);const r=i.parameterPositions,s=i.sampleValues;return r[0]=o,s[0]=t,r[1]=o+e,s[1]=n,this}}const zV=new Float32Array(1);class KV extends iv{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,a=e._clip.tracks,o=a.length,i=e._propertyBindings,r=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let g=0;g!==o;++g){const e=a[g],o=e.name;let l=c[o];if(void 0!==l)++l.referenceCount,i[g]=l;else{if(l=i[g],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,o));continue}const a=t&&t._propertyBindings[g].binding.parsedPath;l=new NV(JV.create(n,o,a),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,o),i[g]=l}r[g].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,a=this._actionsByClip[n];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const a=this._actions,o=this._actionsByClip;let i=o[t];if(void 0===i)i={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=i;else{const t=i.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=a.length,a.push(e),i.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],a=e._cacheIndex;n._cacheIndex=a,t[a]=n,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,i=this._actionsByClip,r=i[o],s=r.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete r.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete i[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,a=t.length;n!==a;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,a=this._nActiveActions++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,a=--this._nActiveActions,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_addInactiveBinding(e,t,n){const a=this._bindingsByRootAndName,o=this._bindings;let i=a[t];void 0===i&&(i={},a[t]=i),i[n]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,a=n.rootNode.uuid,o=n.path,i=this._bindingsByRootAndName,r=i[a],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete r[o],0===Object.keys(r).length&&delete i[a]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,a=this._nActiveBindings++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,a=--this._nActiveBindings,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new uW(new Float32Array(2),new Float32Array(2),1,zV),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,a=--this._nActiveControlInterpolants,o=t[a];e.__cacheIndex=a,t[a]=e,o.__cacheIndex=n,t[n]=o}clipAction(e,t,n){const a=t||this._root,o=a.uuid;let i="string"===typeof e?AW.findByName(a,e):e;const r=null!==i?i.uuid:e,s=this._actionsByClip[r];let l=null;if(void 0===n&&(n=null!==i?i.blendMode:IA),void 0!==s){const e=s.actionByRoot[o];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===i&&(i=l._clip)}if(null===i)return null;const c=new LV(this,i,t,n);return this._bindAction(c,l),this._addInactiveAction(c,r,o),c}existingAction(e,t){const n=t||this._root,a=n.uuid,o="string"===typeof e?AW.findByName(n,e):e,i=o?o.uuid:e,r=this._actionsByClip[i];return void 0!==r&&r.actionByRoot[a]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,a=this.time+=e,o=Math.sign(e),i=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(a,e,o,i)}const r=this._bindings,s=this._nActiveBindings;for(let l=0;l!==s;++l)r[l].apply(i);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,a=this._actionsByClip,o=a[n];if(void 0!==o){const e=o.knownActions;for(let n=0,a=e.length;n!==a;++n){const a=e[n];this._deactivateAction(a);const o=a._cacheIndex,i=t[t.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,i._cacheIndex=o,t[o]=i,t.pop(),this._removeInactiveBindingsForAction(a)}delete a[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const e=n[o].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const a=this._bindingsByRootAndName[t];if(void 0!==a)for(const o in a){const e=a[o];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class DV{constructor(e){this.value=e}clone(){return new DV(void 0===this.value.clone?this.value:this.value.clone())}}let UV=0;class PV extends iv{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:UV++}),this.name="",this.usage=PA,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,a=t.length;n<a;n++)this.uniforms.push(t[n].clone());return this}clone(){return(new this.constructor).copy(this)}}class OV extends uk{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class _V{constructor(e,t,n,a,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=a,this.count=o,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class QV{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new xS(e,t),this.near=n,this.far=a,this.camera=null,this.layers=new TS,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return qV(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(jV),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let a=0,o=e.length;a<o;a++)qV(e[a],this,n,t);return n.sort(jV),n}}function jV(e,t){return e.distance-t.distance}function qV(e,t,n,a){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===a){const a=e.children;for(let e=0,o=a.length;e<o;e++)qV(a[e],t,n,!0)}}class $V{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(uv(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class eN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const tN=new yv;class nN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yv(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yv(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=tN.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,tN).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const aN=new _v,oN=new _v;class iN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){aN.subVectors(e,this.start),oN.subVectors(this.end,this.start);const n=oN.dot(oN);let a=oN.dot(aN)/n;return t&&(a=uv(a,0,1)),a}closestPointToPoint(e,t,n){const a=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(a).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const rN=new _v;class sN extends QS{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new zx,a=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let i=0,r=1,s=32;i<s;i++,r++){const e=i/s*Math.PI*2,t=r/s*Math.PI*2;a.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Xx(a,3));const o=new eB({fog:!1,toneMapped:!1});this.cone=new cB(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),rN.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(rN),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const lN=new _v,cN=new GS,gN=new GS;class uN extends cB{constructor(e){const t=dN(e),n=new zx,a=[],o=[],i=new mx(0,0,1),r=new mx(0,1,0);for(let s=0;s<t.length;s++){const e=t[s];e.parent&&e.parent.isBone&&(a.push(0,0,0),a.push(0,0,0),o.push(i.r,i.g,i.b),o.push(r.r,r.g,r.b))}n.setAttribute("position",new Xx(a,3)),n.setAttribute("color",new Xx(o,3));super(n,new eB({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,a=n.getAttribute("position");gN.copy(this.root.matrixWorld).invert();for(let o=0,i=0;o<t.length;o++){const e=t[o];e.parent&&e.parent.isBone&&(cN.multiplyMatrices(gN,e.matrixWorld),lN.setFromMatrixPosition(cN),a.setXYZ(i,lN.x,lN.y,lN.z),cN.multiplyMatrices(gN,e.parent.matrixWorld),lN.setFromMatrixPosition(cN),a.setXYZ(i+1,lN.x,lN.y,lN.z),i+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function dN(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,dN(e.children[n]));return t}class hN extends sG{constructor(e,t,n){super(new FR(t,4,2),new Cx({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const pN=new _v,mN=new mx,IN=new mx;class CN extends QS{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const a=new MR(t);a.rotateY(.5*Math.PI),this.material=new Cx({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const o=a.getAttribute("position"),i=new Float32Array(3*o.count);a.setAttribute("color",new Gx(i,3)),this.add(new sG(a,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");mN.copy(this.light.color),IN.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const a=e<n/2?mN:IN;t.setXYZ(e,a.r,a.g,a.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(pN.setFromMatrixPosition(this.light.matrixWorld).negate())}}class fN extends cB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new mx(n),a=new mx(a);const o=t/2,i=e/t,r=e/2,s=[],l=[];for(let g=0,u=0,d=-r;g<=t;g++,d+=i){s.push(-r,0,d,r,0,d),s.push(d,0,-r,d,0,r);const e=g===o?n:a;e.toArray(l,u),u+=3,e.toArray(l,u),u+=3,e.toArray(l,u),u+=3,e.toArray(l,u),u+=3}const c=new zx;c.setAttribute("position",new Xx(s,3)),c.setAttribute("color",new Xx(l,3));super(c,new eB({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class bN extends cB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;o=new mx(o),i=new mx(i);const r=[],s=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),a=Math.sin(n)*e,l=Math.cos(n)*e;r.push(0,0,0),r.push(a,0,l);const g=1&c?o:i;s.push(g.r,g.g,g.b),s.push(g.r,g.g,g.b)}for(let c=0;c<n;c++){const t=1&c?o:i,l=e-e/n*c;for(let e=0;e<a;e++){let n=e/a*(2*Math.PI),o=Math.sin(n)*l,i=Math.cos(n)*l;r.push(o,0,i),s.push(t.r,t.g,t.b),n=(e+1)/a*(2*Math.PI),o=Math.sin(n)*l,i=Math.cos(n)*l,r.push(o,0,i),s.push(t.r,t.g,t.b)}}const l=new zx;l.setAttribute("position",new Xx(r,3)),l.setAttribute("color",new Xx(s,3));super(l,new eB({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const yN=new _v,AN=new _v,vN=new _v;class SN extends QS{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let a=new zx;a.setAttribute("position",new Xx([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new eB({fog:!1,toneMapped:!1});this.lightPlane=new rB(a,o),this.add(this.lightPlane),a=new zx,a.setAttribute("position",new Xx([0,0,0,0,0,1],3)),this.targetLine=new rB(a,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),yN.setFromMatrixPosition(this.light.matrixWorld),AN.setFromMatrixPosition(this.light.target.matrixWorld),vN.subVectors(AN,yN),this.lightPlane.lookAt(AN),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(AN),this.targetLine.scale.z=vN.length()}}const xN=new _v,GN=new mG;class ZN extends cB{constructor(e){const t=new zx,n=new eB({color:16777215,vertexColors:!0,toneMapped:!1}),a=[],o=[],i={};function r(e,t){s(e),s(t)}function s(e){a.push(0,0,0),o.push(0,0,0),void 0===i[e]&&(i[e]=[]),i[e].push(a.length/3-1)}r("n1","n2"),r("n2","n4"),r("n4","n3"),r("n3","n1"),r("f1","f2"),r("f2","f4"),r("f4","f3"),r("f3","f1"),r("n1","f1"),r("n2","f2"),r("n3","f3"),r("n4","f4"),r("p","n1"),r("p","n2"),r("p","n3"),r("p","n4"),r("u1","u2"),r("u2","u3"),r("u3","u1"),r("c","t"),r("p","c"),r("cn1","cn2"),r("cn3","cn4"),r("cf1","cf2"),r("cf3","cf4"),t.setAttribute("position",new Xx(a,3)),t.setAttribute("color",new Xx(o,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update();const l=new mx(16755200),c=new mx(16711680),g=new mx(43775),u=new mx(16777215),d=new mx(3355443);this.setColors(l,c,g,u,d)}setColors(e,t,n,a,o){const i=this.geometry.getAttribute("color");i.setXYZ(0,e.r,e.g,e.b),i.setXYZ(1,e.r,e.g,e.b),i.setXYZ(2,e.r,e.g,e.b),i.setXYZ(3,e.r,e.g,e.b),i.setXYZ(4,e.r,e.g,e.b),i.setXYZ(5,e.r,e.g,e.b),i.setXYZ(6,e.r,e.g,e.b),i.setXYZ(7,e.r,e.g,e.b),i.setXYZ(8,e.r,e.g,e.b),i.setXYZ(9,e.r,e.g,e.b),i.setXYZ(10,e.r,e.g,e.b),i.setXYZ(11,e.r,e.g,e.b),i.setXYZ(12,e.r,e.g,e.b),i.setXYZ(13,e.r,e.g,e.b),i.setXYZ(14,e.r,e.g,e.b),i.setXYZ(15,e.r,e.g,e.b),i.setXYZ(16,e.r,e.g,e.b),i.setXYZ(17,e.r,e.g,e.b),i.setXYZ(18,e.r,e.g,e.b),i.setXYZ(19,e.r,e.g,e.b),i.setXYZ(20,e.r,e.g,e.b),i.setXYZ(21,e.r,e.g,e.b),i.setXYZ(22,e.r,e.g,e.b),i.setXYZ(23,e.r,e.g,e.b),i.setXYZ(24,t.r,t.g,t.b),i.setXYZ(25,t.r,t.g,t.b),i.setXYZ(26,t.r,t.g,t.b),i.setXYZ(27,t.r,t.g,t.b),i.setXYZ(28,t.r,t.g,t.b),i.setXYZ(29,t.r,t.g,t.b),i.setXYZ(30,t.r,t.g,t.b),i.setXYZ(31,t.r,t.g,t.b),i.setXYZ(32,n.r,n.g,n.b),i.setXYZ(33,n.r,n.g,n.b),i.setXYZ(34,n.r,n.g,n.b),i.setXYZ(35,n.r,n.g,n.b),i.setXYZ(36,n.r,n.g,n.b),i.setXYZ(37,n.r,n.g,n.b),i.setXYZ(38,a.r,a.g,a.b),i.setXYZ(39,a.r,a.g,a.b),i.setXYZ(40,o.r,o.g,o.b),i.setXYZ(41,o.r,o.g,o.b),i.setXYZ(42,o.r,o.g,o.b),i.setXYZ(43,o.r,o.g,o.b),i.setXYZ(44,o.r,o.g,o.b),i.setXYZ(45,o.r,o.g,o.b),i.setXYZ(46,o.r,o.g,o.b),i.setXYZ(47,o.r,o.g,o.b),i.setXYZ(48,o.r,o.g,o.b),i.setXYZ(49,o.r,o.g,o.b),i.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;GN.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),wN("c",t,e,GN,0,0,-1),wN("t",t,e,GN,0,0,1),wN("n1",t,e,GN,-1,-1,-1),wN("n2",t,e,GN,1,-1,-1),wN("n3",t,e,GN,-1,1,-1),wN("n4",t,e,GN,1,1,-1),wN("f1",t,e,GN,-1,-1,1),wN("f2",t,e,GN,1,-1,1),wN("f3",t,e,GN,-1,1,1),wN("f4",t,e,GN,1,1,1),wN("u1",t,e,GN,.7,1.1,-1),wN("u2",t,e,GN,-.7,1.1,-1),wN("u3",t,e,GN,0,2,-1),wN("cf1",t,e,GN,-1,0,1),wN("cf2",t,e,GN,1,0,1),wN("cf3",t,e,GN,0,-1,1),wN("cf4",t,e,GN,0,1,1),wN("cn1",t,e,GN,-1,0,-1),wN("cn2",t,e,GN,1,0,-1),wN("cn3",t,e,GN,0,-1,-1),wN("cn4",t,e,GN,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function wN(e,t,n,a,o,i,r){xN.set(o,i,r).unproject(a);const s=t[e];if(void 0!==s){const e=n.getAttribute("position");for(let t=0,n=s.length;t<n;t++)e.setXYZ(s[t],xN.x,xN.y,xN.z)}}const kN=new qv;class BN extends cB{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new Float32Array(24),o=new zx;o.setIndex(new Gx(n,1)),o.setAttribute("position",new Gx(a,3)),super(o,new eB({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&kN.setFromObject(this.object),kN.isEmpty())return;const t=kN.min,n=kN.max,a=this.geometry.attributes.position,o=a.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,a.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class RN extends cB{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new zx;a.setIndex(new Gx(n,1)),a.setAttribute("position",new Xx([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(a,new eB({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class WN extends rB{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,a=new zx;a.setAttribute("position",new Xx([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),a.computeBoundingSphere(),super(a,new eB({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new zx;o.setAttribute("position",new Xx([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new sG(o,new Cx({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const VN=new _v;let NN,XN;class MN extends QS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _v(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _v(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*o;super(),this.type="ArrowHelper",void 0===NN&&(NN=new zx,NN.setAttribute("position",new Xx([0,0,0,0,1,0],3)),XN=new OB(0,.5,1,5,1),XN.translate(0,-.5,0)),this.position.copy(t),this.line=new rB(NN,new eB({color:a,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new sG(XN,new Cx({color:a,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,i)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{VN.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(VN,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class TN extends cB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new zx;n.setAttribute("position",new Xx(t,3)),n.setAttribute("color",new Xx([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new eB({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const a=new mx,o=this.geometry.attributes.color.array;return a.set(e),a.toArray(o,0),a.toArray(o,3),a.set(t),a.toArray(o,6),a.toArray(o,9),a.set(n),a.toArray(o,12),a.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class EN{constructor(){this.type="ShapePath",this.color=new mx,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new KB,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,a){return this.currentPath.quadraticCurveTo(e,t,n,a),this}bezierCurveTo(e,t,n,a,o,i){return this.currentPath.bezierCurveTo(e,t,n,a,o,i),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let a=!1;for(let o=n-1,i=0;i<n;o=i++){let n=t[o],r=t[i],s=r.x-n.x,l=r.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[i],s=-s,r=t[o],l=-l),e.y<n.y||e.y>r.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;a=!a}}else{if(e.y!==n.y)continue;if(r.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=r.x)return!0}}return a}const n=BR.isClockWise,a=this.subPaths;if(0===a.length)return[];let o,i,r;const s=[];if(1===a.length)return i=a[0],r=new aR,r.curves=i.curves,s.push(r),s;let l=!n(a[0].getPoints());l=e?!l:l;const c=[],g=[];let u,d,h=[],p=0;g[p]=void 0,h[p]=[];for(let m=0,I=a.length;m<I;m++)i=a[m],u=i.getPoints(),o=n(u),o=e?!o:o,o?(!l&&g[p]&&p++,g[p]={s:new aR,p:u},g[p].s.curves=i.curves,l&&p++,h[p]=[]):h[p].push({h:i,p:u[0]});if(!g[0])return function(e){const t=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],o=new aR;o.curves=a.curves,t.push(o)}return t}(a);if(g.length>1){let e=!1,n=0;for(let t=0,a=g.length;t<a;t++)c[t]=[];for(let a=0,o=g.length;a<o;a++){const o=h[a];for(let i=0;i<o.length;i++){const r=o[i];let s=!0;for(let o=0;o<g.length;o++)t(r.p,g[o].p)&&(a!==o&&n++,s?(s=!1,c[o].push(r)):e=!0);s&&c[a].push(r)}}n>0&&!1===e&&(h=c)}for(let m=0,I=g.length;m<I;m++){r=g[m].s,s.push(r),d=h[m];for(let e=0,t=d.length;e<t;e++)r.holes.push(d[e].h)}return s}}class FN extends cG{constructor(e,t,n,a,o,i){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,a,o,i)}}class HN extends UB{constructor(e,t,n,a){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,a)}}class JN extends PB{constructor(e,t,n,a){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,a)}}class YN extends _B{constructor(e,t,n,a,o,i,r){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,a,o,i,r)}}class LN extends OB{constructor(e,t,n,a,o,i,r,s){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,a,o,i,r,s)}}class zN extends jB{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class KN extends VR{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class DN extends XR{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class UN extends DB{constructor(e,t,n,a){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,a)}}class PN extends MR{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class ON extends RG{constructor(e,t,n,a){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,a)}}class _N extends QB{constructor(e,t,n,a){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,a)}}class QN extends TR{constructor(e,t,n,a,o,i){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,a,o,i)}}class jN extends ER{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class qN extends FR{constructor(e,t,n,a,o,i,r){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,a,o,i,r)}}class $N extends HR{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class eX extends JR{constructor(e,t,n,a,o){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,a,o)}}class tX extends YR{constructor(e,t,n,a,o,i){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,a,o,i)}}class nX extends LR{constructor(e,t,n,a,o){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,a,o)}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Kf}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Kf);const aX=(e,t)=>{const n=2*Math.PI*t*e;return n/(n+1)},oX=(e,t,n)=>e*t+(1-e)*n;class iX{constructor(e){let{minCutOff:t,beta:n}=e;this.minCutOff=t,this.beta=n,this.dCutOff=.001,this.xPrev=null,this.dxPrev=null,this.tPrev=null,this.initialized=!1}reset(){this.initialized=!1}filter(e,t){if(!this.initialized)return this.initialized=!0,this.xPrev=t,this.dxPrev=t.map((()=>0)),this.tPrev=e,t;const{xPrev:n,tPrev:a,dxPrev:o}=this,i=e-a,r=aX(i,this.dCutOff),s=[],l=[],c=[];for(let g=0;g<t.length;g++){s[g]=(t[g]-n[g])/i,l[g]=oX(r,s[g],o[g]);const e=this.minCutOff+this.beta*Math.abs(l[g]),a=aX(i,e);c[g]=oX(a,t[g],n[g])}return this.xPrev=c,this.dxPrev=l,this.tPrev=e,c}}class rX{constructor(e){let{uiLoading:t,uiScanning:n,uiError:a}=e;const o=document.createElement("style");o.innerText=".mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid white;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:black;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media (min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media (max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right,white 10px,transparent 10px) 0 0,linear-gradient(to right,white 10px,transparent 10px) 0 100%,linear-gradient(to left,white 10px,transparent 10px) 100% 0,linear-gradient(to left,white 10px,transparent 10px) 100% 100%,linear-gradient(to bottom,white 10px,transparent 10px) 0 0,linear-gradient(to bottom,white 10px,transparent 10px) 100% 0,linear-gradient(to top,white 10px,transparent 10px) 0 100%,linear-gradient(to top,white 10px,transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:white;animation:move 2s linear infinite}@keyframes move{0%,to{top:0%}50%{top:calc(100% - 10px)}}",document.head.appendChild(o),"yes"===t?this.loadingModal=this._loadHTML('<div class="mindar-ui-overlay mindar-ui-loading">\n  <div class="loader"/>\n</div>\n'):"no"!==t&&(this.loadingModal=document.querySelector(t)),"yes"===a?this.compatibilityModal=this._loadHTML('<div class="mindar-ui-overlay mindar-ui-compatibility">\n  <div class="content">\n    <h1>Failed to launch :(</h1>\n    <p>\n      Looks like your device/browser is not compatible.\n    </p>\n\n    <br/>\n    <br/>\n    <p>\n      Please try the following recommended browsers:\n    </p>\n    <p>\n      For Android device - Chrome\n    </p>\n    <p>\n      For iOS device - Safari\n    </p>\n  </div>\n</div>\n'):"no"!==a&&(this.compatibilityModal=document.querySelector(a)),"yes"===n?this.scanningMask=this._loadHTML('<div class="mindar-ui-overlay mindar-ui-scanning">\n  <div class="scanning">\n    <div class="inner">\n      <div class="scanline"/>\n    </div>\n  </div>\n</div>\n'):"no"!==n&&(this.scanningMask=document.querySelector(n)),this.hideLoading(),this.hideCompatibility(),this.hideScanning()}showLoading(){this.loadingModal&&this.loadingModal.classList.remove("hidden")}hideLoading(){this.loadingModal&&this.loadingModal.classList.add("hidden")}showCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.remove("hidden")}hideCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.add("hidden")}showScanning(){this.scanningMask&&this.scanningMask.classList.remove("hidden")}hideScanning(){this.scanningMask&&this.scanningMask.classList.add("hidden")}_loadHTML(e){const t=document.createElement("template");t.innerHTML=e.trim();const n=t.content.firstChild;return document.getElementsByTagName("body")[0].appendChild(n),n}}function sX(e,t){for(var n=0;n<t.length;n++){const a=t[n];if("string"!=typeof a&&!Array.isArray(a))for(const t in a)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(a,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>a[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}class lX{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class cX{refCount(e){return gX("refCount")}incRef(e){return gX("incRef")}timerAvailable(){return!0}time(e){return gX("time")}read(e){return gX("read")}readSync(e){return gX("readSync")}readToGPU(e,t){return gX("readToGPU")}numDataIds(){return gX("numDataIds")}disposeData(e,t){return gX("disposeData")}write(e,t,n){return gX("write")}move(e,t,n,a,o){return gX("move")}createTensorFromGPUData(e,t,n){return gX("createTensorFromGPUData")}memory(){return gX("memory")}floatPrecision(){return gX("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return gX("dispose")}}function gX(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function uX(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,pX(e,t,n)}function dX(e,t,n){return Math.max(e,Math.min(t,n))}function hX(e){return e%2===0?e:e+1}function pX(e,t,n){const a=e[t];e[t]=e[n],e[n]=a}function mX(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function IX(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function CX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";IX(AX(e,t),(()=>n+" Shapes ".concat(e," and ").concat(t," must match")))}function fX(e){IX(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function bX(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function yX(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}function AX(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function vX(e){return e%1===0}function SX(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function xX(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function GX(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return new Promise(((o,i)=>{let r=0;const s=()=>{if(e())return void o();r++;const l=t(r);null!=n&&r>=n?i():null!=a?a(s,l):setTimeout(s,l)};s()}))}function ZX(e,t){let n=1,a=-1;for(let i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==a)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(a," and dim ").concat(i));a=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found ".concat(e[i]," at dim ").concat(i));if(-1===a){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!==0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));const o=e.slice();return o[a]=t/n,o}function wX(e,t){const n=t.length;return IX((e=null==e?t.map(((e,t)=>t)):[].concat(e)).every((e=>e>=-n&&e<n)),(()=>"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e))),IX(e.every((e=>vX(e))),(()=>"All values in axis param must be integers but got axis ".concat(e))),e.map((e=>e<0?n+e:e))}function kX(e,t){const n=[],a=[],o=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||o?null:wX(t,e).sort();let r=0;for(let s=0;s<e.length;++s){if(null!=i){if(i[r]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[r]||i[r]>s)&&1===e[s]&&(n.push(e[s]),a.push(s)),i[r]<=s&&r++}1!==e[s]&&(n.push(e[s]),a.push(s))}return{newShape:n,keptDims:a}}function BX(e,t){return RX(e,t)}function RX(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function WX(e,t){for(let n=0;n<e.length;n++){const a=e[n];if(isNaN(a)||!isFinite(a))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(a,"."))}}function VX(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function NX(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function XX(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function MX(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}function TX(e){return"string"==typeof e||e instanceof String}function EX(e){return"boolean"==typeof e}function FX(e){return"number"==typeof e}function HX(e){return Array.isArray(e)?HX(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":FX(e)?"float32":TX(e)?"string":EX(e)?"bool":"float32"}function JX(e){return!!(e&&e.constructor&&e.call&&e.apply)}function YX(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function LX(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let a=t-3;a>=0;--a)n[a]=n[a+1]*e[a+1];return n}function zX(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=new Array;if(1===t.length){const i=t[0]*(a?2:1);for(let t=0;t<i;t++)o[t]=n[e+t]}else{const i=t[0],r=t.slice(1),s=r.reduce(((e,t)=>e*t))*(a?2:1);for(let t=0;t<i;t++)o[t]=zX(e+t*s,r,n,a)}return o}function KX(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];const a=e.reduce(((e,t)=>e*t))*(n?2:1);if(0===a)return[];if(a!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return zX(0,e,t,n)}function DX(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}function UX(e,t){const n=PX(e,t);for(let a=0;a<n.length;a++)n[a]=1;return n}function PX(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function OX(e,t){const n=e.reduce(((e,t)=>e*t),1);if(null==t||"float32"===t)return KX(e,new Float32Array(n));if("int32"===t)return KX(e,new Int32Array(n));if("bool"===t)return KX(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function _X(e){e.forEach((t=>{IX(Number.isInteger(t)&&t>=0,(()=>"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")))}))}function QX(e,t,n){if(0===t)return 0;if(1===t)return e[0];let a=e[e.length-1];for(let o=0;o<e.length-1;++o)a+=n[o]*e[o];return a}function jX(e,t,n){if(0===t)return[];if(1===t)return[e];const a=new Array(t);for(let o=0;o<a.length-1;++o)a[o]=Math.floor(e/n[o]),e-=a[o]*n[o];return a[a.length-1]=e,a}function qX(e){return e&&e.then&&"function"==typeof e.then}const $X="tfjsflags";class eM{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=tM,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(nM().getBool("IS_TEST")||nM().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];nM().getBool("IS_TEST")||nM().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(t,".")),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(qX(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);$X in e&&e[$X].split(",").forEach((e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){const n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,n)}))}}function tM(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,a[0],a[1]),a.join("=")})),t}function nM(){return oM}let aM,oM=null;function iM(){if(null==aM){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(!(typeof self<"u"))throw new Error("Could not find a global object");e=self}aM=e}return aM}function rM(e,t){const n=function(){const e=iM();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const a=t();return n.set(e,a),n.get(e)}}const sM="Abs",lM="Acos",cM="Acosh",gM="Add",uM="AddN",dM="All",hM="Any",pM="ArgMax",mM="ArgMin",IM="Asin",CM="Asinh",fM="Atan",bM="Atanh",yM="Atan2",AM="AvgPool",vM="AvgPoolGrad",SM="AvgPool3D",xM="AvgPool3DGrad",GM="BatchMatMul",ZM="BatchToSpaceND",wM="Bincount",kM="BitwiseAnd",BM="BroadcastTo",RM="BroadcastArgs",WM="Cast",VM="Ceil",NM="ClipByValue",XM="Complex",MM="ComplexAbs",TM="Concat",EM="Conv2D",FM="Conv2DBackpropFilter",HM="Conv2DBackpropInput",JM="Conv3D",YM="Conv3DBackpropFilterV2",LM="Conv3DBackpropInputV2",zM="Cos",KM="Cosh",DM="Cumprod",UM="Cumsum",PM="CropAndResize",OM="DenseBincount",_M="DepthToSpace",QM="DepthwiseConv2dNative",jM="DepthwiseConv2dNativeBackpropFilter",qM="DepthwiseConv2dNativeBackpropInput",$M="Diag",eT="Dilation2D",tT="Dilation2DBackpropInput",nT="Dilation2DBackpropFilter",aT="Draw",oT="RealDiv",iT="Einsum",rT="Elu",sT="EluGrad",lT="Erf",cT="Equal",gT="Exp",uT="ExpandDims",dT="Expm1",hT="FFT",pT="Fill",mT="FlipLeftRight",IT="Floor",CT="FloorDiv",fT="FusedBatchNorm",bT="GatherV2",yT="GatherNd",AT="Greater",vT="GreaterEqual",ST="Identity",xT="IFFT",GT="Imag",ZT="IsFinite",wT="IsInf",kT="IsNan",BT="LeakyRelu",RT="Less",WT="LessEqual",VT="LinSpace",NT="Log",XT="Log1p",MT="LogicalAnd",TT="LogicalNot",ET="LogicalOr",FT="LogSoftmax",HT="LRN",JT="LRNGrad",YT="Max",LT="Maximum",zT="MaxPool",KT="MaxPoolGrad",DT="MaxPool3D",UT="MaxPool3DGrad",PT="MaxPoolWithArgmax",OT="Mean",_T="Min",QT="Minimum",jT="MirrorPad",qT="Mod",$T="Multinomial",eE="Multiply",tE="Neg",nE="NotEqual",aE="NonMaxSuppressionV3",oE="NonMaxSuppressionV4",iE="NonMaxSuppressionV5",rE="OnesLike",sE="OneHot",lE="Pack",cE="PadV2",gE="Pow",uE="Prelu",dE="Prod",hE="RaggedGather",pE="RaggedRange",mE="RaggedTensorToTensor",IE="Range",CE="Real",fE="Reciprocal",bE="Relu",yE="Reshape",AE="ResizeNearestNeighbor",vE="ResizeNearestNeighborGrad",SE="ResizeBilinear",xE="ResizeBilinearGrad",GE="Relu6",ZE="Reverse",wE="Round",kE="Rsqrt",BE="ScatterNd",RE="TensorScatterUpdate",WE="SearchSorted",VE="Select",NE="Selu",XE="Slice",ME="Sin",TE="Sinh",EE="Sign",FE="Sigmoid",HE="Softplus",JE="Sqrt",YE="Sum",LE="SpaceToBatchND",zE="SplitV",KE="Softmax",DE="SparseFillEmptyRows",UE="SparseReshape",PE="SparseSegmentMean",OE="SparseSegmentSum",_E="SparseToDense",QE="SquaredDifference",jE="Square",qE="StaticRegexReplace",$E="StridedSlice",eF="StringNGrams",tF="StringSplit",nF="StringToHashBucketFast",aF="Sub",oF="Tan",iF="Tanh",rF="Tile",sF="TopK",lF="Transform",cF="Transpose",gF="Unique",uF="Unpack",dF="UnsortedSegmentSum",hF="ZerosLike",pF="Step",mF="FromPixels",IF="RotateWithOffset",CF="_FusedMatMul",fF="FusedConv2D",bF="FusedDepthwiseConv2D";function yF(){nM().getBool("IS_TEST")||nM().getBool("PROD")||console.warn(...arguments)}const AF=rM("kernelRegistry",(()=>new Map)),vF=rM("gradRegistry",(()=>new Map));function SF(e,t){const n=kF(e,t);return AF.get(n)}function xF(e){return vF.get(e)}function GF(e){const t=AF.entries(),n=[];for(;;){const{done:a,value:o}=t.next();if(a)break;const[i,r]=o,[s]=i.split("_");s===e&&n.push(r)}return n}function ZF(e){const{kernelName:t,backendName:n}=e,a=kF(t,n);AF.has(a)&&yF("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),AF.set(a,e)}function wF(e){const{kernelName:t}=e;vF.has(t)&&nM().getBool("DEBUG")&&yF("Overriding the gradient for '".concat(t,"'")),vF.set(t,e)}function kF(e,t){return"".concat(t,"_").concat(e)}function BF(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var RF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function WF(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function VF(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var a=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,a.get?a:{enumerable:!0,get:function(){return e[t]}})})),n}var NF=MF,XF=null;try{XF=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function MF(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function TF(e){return!0===(e&&e.__isLong__)}MF.prototype.__isLong__,Object.defineProperty(MF.prototype,"__isLong__",{value:!0}),MF.isLong=TF;var EF={},FF={};function HF(e,t){var n,a,o;return t?(o=0<=(e>>>=0)&&e<256)&&(a=FF[e])?a:(n=YF(e,(0|e)<0?-1:0,!0),o&&(FF[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(a=EF[e])?a:(n=YF(e,e<0?-1:0,!1),o&&(EF[e]=n),n)}function JF(e,t){if(isNaN(e))return t?QF:_F;if(t){if(e<0)return QF;if(e>=UF)return tH}else{if(e<=-PF)return nH;if(e+1>=PF)return eH}return e<0?JF(-e,t).neg():YF(e%DF|0,e/DF|0,t)}function YF(e,t,n){return new MF(e,t,n)}MF.fromInt=HF,MF.fromNumber=JF,MF.fromBits=YF;var LF=Math.pow;function zF(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return _F;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var a;if((a=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===a)return zF(e.substring(1),t,n).neg();for(var o=JF(LF(n,8)),i=_F,r=0;r<e.length;r+=8){var s=Math.min(8,e.length-r),l=parseInt(e.substring(r,r+s),n);if(s<8){var c=JF(LF(n,s));i=i.mul(c).add(JF(l))}else i=(i=i.mul(o)).add(JF(l))}return i.unsigned=t,i}function KF(e,t){return"number"==typeof e?JF(e,t):"string"==typeof e?zF(e,t):YF(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}MF.fromString=zF,MF.fromValue=KF;var DF=4294967296,UF=DF*DF,PF=UF/2,OF=HF(1<<24),_F=HF(0);MF.ZERO=_F;var QF=HF(0,!0);MF.UZERO=QF;var jF=HF(1);MF.ONE=jF;var qF=HF(1,!0);MF.UONE=qF;var $F=HF(-1);MF.NEG_ONE=$F;var eH=YF(-1,2147483647,!1);MF.MAX_VALUE=eH;var tH=YF(-1,-1,!0);MF.MAX_UNSIGNED_VALUE=tH;var nH=YF(0,-2147483648,!1);MF.MIN_VALUE=nH;var aH=MF.prototype;aH.toInt=function(){return this.unsigned?this.low>>>0:this.low},aH.toNumber=function(){return this.unsigned?(this.high>>>0)*DF+(this.low>>>0):this.high*DF+(this.low>>>0)},aH.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nH)){var t=JF(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var o=JF(LF(e,6),this.unsigned),i=this,r="";;){var s=i.div(o),l=(i.sub(s.mul(o)).toInt()>>>0).toString(e);if((i=s).isZero())return l+r;for(;l.length<6;)l="0"+l;r=""+l+r}},aH.getHighBits=function(){return this.high},aH.getHighBitsUnsigned=function(){return this.high>>>0},aH.getLowBits=function(){return this.low},aH.getLowBitsUnsigned=function(){return this.low>>>0},aH.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nH)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},aH.isZero=function(){return 0===this.high&&0===this.low},aH.eqz=aH.isZero,aH.isNegative=function(){return!this.unsigned&&this.high<0},aH.isPositive=function(){return this.unsigned||this.high>=0},aH.isOdd=function(){return 1===(1&this.low)},aH.isEven=function(){return 0===(1&this.low)},aH.equals=function(e){return TF(e)||(e=KF(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},aH.eq=aH.equals,aH.notEquals=function(e){return!this.eq(e)},aH.neq=aH.notEquals,aH.ne=aH.notEquals,aH.lessThan=function(e){return this.comp(e)<0},aH.lt=aH.lessThan,aH.lessThanOrEqual=function(e){return this.comp(e)<=0},aH.lte=aH.lessThanOrEqual,aH.le=aH.lessThanOrEqual,aH.greaterThan=function(e){return this.comp(e)>0},aH.gt=aH.greaterThan,aH.greaterThanOrEqual=function(e){return this.comp(e)>=0},aH.gte=aH.greaterThanOrEqual,aH.ge=aH.greaterThanOrEqual,aH.compare=function(e){if(TF(e)||(e=KF(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},aH.comp=aH.compare,aH.negate=function(){return!this.unsigned&&this.eq(nH)?nH:this.not().add(jF)},aH.neg=aH.negate,aH.add=function(e){TF(e)||(e=KF(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,o=65535&this.low,i=e.high>>>16,r=65535&e.high,s=e.low>>>16,l=0,c=0,g=0,u=0;return g+=(u+=o+(65535&e.low))>>>16,c+=(g+=a+s)>>>16,l+=(c+=n+r)>>>16,l+=t+i,YF((g&=65535)<<16|(u&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},aH.subtract=function(e){return TF(e)||(e=KF(e)),this.add(e.neg())},aH.sub=aH.subtract,aH.multiply=function(e){if(this.isZero())return _F;if(TF(e)||(e=KF(e)),XF)return YF(XF.mul(this.low,this.high,e.low,e.high),XF.get_high(),this.unsigned);if(e.isZero())return _F;if(this.eq(nH))return e.isOdd()?nH:_F;if(e.eq(nH))return this.isOdd()?nH:_F;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(OF)&&e.lt(OF))return JF(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,o=65535&this.low,i=e.high>>>16,r=65535&e.high,s=e.low>>>16,l=65535&e.low,c=0,g=0,u=0,d=0;return u+=(d+=o*l)>>>16,g+=(u+=a*l)>>>16,u&=65535,g+=(u+=o*s)>>>16,c+=(g+=n*l)>>>16,g&=65535,c+=(g+=a*s)>>>16,g&=65535,c+=(g+=o*r)>>>16,c+=t*l+n*s+a*r+o*i,YF((u&=65535)<<16|(d&=65535),(c&=65535)<<16|(g&=65535),this.unsigned)},aH.mul=aH.multiply,aH.divide=function(e){if(TF(e)||(e=KF(e)),e.isZero())throw Error("division by zero");var t,n,a;if(XF)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?YF((this.unsigned?XF.div_u:XF.div_s)(this.low,this.high,e.low,e.high),XF.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?QF:_F;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return QF;if(e.gt(this.shru(1)))return qF;a=QF}else{if(this.eq(nH))return e.eq(jF)||e.eq($F)?nH:e.eq(nH)?jF:(t=this.shr(1).div(e).shl(1)).eq(_F)?e.isNegative()?jF:$F:(n=this.sub(e.mul(t)),a=t.add(n.div(e)));if(e.eq(nH))return this.unsigned?QF:_F;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=_F}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),i=o<=48?1:LF(2,o-48),r=JF(t),s=r.mul(e);s.isNegative()||s.gt(n);)s=(r=JF(t-=i,this.unsigned)).mul(e);r.isZero()&&(r=jF),a=a.add(r),n=n.sub(s)}return a},aH.div=aH.divide,aH.modulo=function(e){return TF(e)||(e=KF(e)),XF?YF((this.unsigned?XF.rem_u:XF.rem_s)(this.low,this.high,e.low,e.high),XF.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},aH.mod=aH.modulo,aH.rem=aH.modulo,aH.not=function(){return YF(~this.low,~this.high,this.unsigned)},aH.and=function(e){return TF(e)||(e=KF(e)),YF(this.low&e.low,this.high&e.high,this.unsigned)},aH.or=function(e){return TF(e)||(e=KF(e)),YF(this.low|e.low,this.high|e.high,this.unsigned)},aH.xor=function(e){return TF(e)||(e=KF(e)),YF(this.low^e.low,this.high^e.high,this.unsigned)},aH.shiftLeft=function(e){return TF(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?YF(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):YF(0,this.low<<e-32,this.unsigned)},aH.shl=aH.shiftLeft,aH.shiftRight=function(e){return TF(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?YF(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):YF(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},aH.shr=aH.shiftRight,aH.shiftRightUnsigned=function(e){if(TF(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?YF(this.low>>>e|t<<32-e,t>>>e,this.unsigned):YF(32===e?t:t>>>e-32,0,this.unsigned)},aH.shru=aH.shiftRightUnsigned,aH.shr_u=aH.shiftRightUnsigned,aH.toSigned=function(){return this.unsigned?YF(this.low,this.high,!1):this},aH.toUnsigned=function(){return this.unsigned?this:YF(this.low,this.high,!0)},aH.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},aH.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},aH.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},MF.fromBytes=function(e,t,n){return n?MF.fromBytesLE(e,t):MF.fromBytesBE(e,t)},MF.fromBytesLE=function(e,t){return new MF(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},MF.fromBytesBE=function(e,t){return new MF(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const oH=WF(NF),iH=oH||sX({__proto__:null,default:oH},[NF]);function rH(e){return iH.fromString(e,!0,16)}const sH=rH("c3a5c85c97cb3127"),lH=rH("b492b66fbe98f273"),cH=rH("9ae16a3b2f90404f");function gH(e){return e.xor(e.shru(47))}function uH(e,t,n){const a=e.slice(t,t+n);return iH.fromBytes(Array.from(a),!0,!0)}function dH(e,t){return uH(e,t,8)}function hH(e,t){return uH(e,t,4)}function pH(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function mH(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rH("9ddfea08eb382d69"),a=e.xor(t).mul(n);a=a.xor(a.shru(47));let o=t.xor(a).mul(n);return o=o.xor(o.shru(47)),o=o.mul(n),o}function IH(e,t,n,a){return function(e,t,n,a,o,i){o=o.add(e),i=pH(i.add(o).add(a),21);const r=o;return o=(o=o.add(t)).add(n),i=i.add(pH(o,44)),[o.add(a),i.add(r)]}(dH(e,t),dH(e,t+8),dH(e,t+16),dH(e,t+24),n,a)}function CH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=iH.fromNumber(81,!0);if(t<=32)return t<=16?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){const n=cH.add(2*t),a=dH(e,0).add(cH),o=dH(e,t-8);return mH(pH(o,37).mul(n).add(a),pH(a,25).add(o).mul(n),n)}if(t>=4){const n=cH.add(2*t);return mH(hH(e,0).shl(3).add(t),hH(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),a=t+(e[t-1]<<2);return gH(cH.mul(n).xor(sH.mul(a))).mul(cH)}return cH}(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=cH.add(2*t),a=dH(e,0).mul(lH),o=dH(e,8),i=dH(e,t-8).mul(n),r=dH(e,t-16).mul(cH);return mH(pH(a.add(o),43).add(pH(i,30)).add(r),a.add(pH(o.add(cH),18)).add(i),n)}(e,t);if(t<=64)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=cH.add(2*t),a=dH(e,0).mul(cH),o=dH(e,8),i=dH(e,t-8).mul(n),r=dH(e,t-16).mul(cH),s=pH(a.add(o),43).add(pH(i,30)).add(r),l=mH(s,a.add(pH(o.add(cH),18)).add(i),n),c=dH(e,16).mul(n),g=dH(e,24),u=s.add(dH(e,t-32)).mul(n),d=l.add(dH(e,t-24)).mul(n);return mH(pH(c.add(g),43).add(pH(u,30)).add(d),c.add(pH(g.add(a),18)).add(u),n)}(e,t);let a=n,o=n.mul(lH).add(113),i=gH(o.mul(cH).add(113)).mul(cH),r=[iH.UZERO,iH.UZERO],s=[iH.UZERO,iH.UZERO];a=a.mul(cH).add(dH(e,0));let l=0;const c=64*(t-1>>6),g=c+(t-1&63)-63;do{a=pH(a.add(o).add(r[0]).add(dH(e,l+8)),37).mul(lH),o=pH(o.add(r[1]).add(dH(e,l+48)),42).mul(lH),a=a.xor(s[1]),o=o.add(r[0]).add(dH(e,l+40)),i=pH(i.add(s[0]),33).mul(lH),r=IH(e,l,r[1].mul(lH),a.add(s[0])),s=IH(e,l+32,i.add(s[1]),o.add(dH(e,l+16))),[i,a]=[a,i],l+=64}while(l!==c);const u=lH.add(i.and(255).shl(1));return l=g,s[0]=s[0].add(t-1&63),r[0]=r[0].add(s[0]),s[0]=s[0].add(r[0]),a=pH(a.add(o).add(r[0]).add(dH(e,l+8)),37).mul(u),o=pH(o.add(r[1]).add(dH(e,l+48)),42).mul(u),a=a.xor(s[1].mul(9)),o=o.add(r[0].mul(9).add(dH(e,l+40))),i=pH(i.add(s[0]),33).mul(u),r=IH(e,l,r[1].mul(u),a.add(s[0])),s=IH(e,l+32,i.add(s[1]),o.add(dH(e,l+16))),[i,a]=[a,i],mH(mH(r[0],s[0],u).add(gH(o).mul(sH)).add(i),mH(r[1],s[1],u).add(a),u)}function fH(e,t){return"string"===t?vH(e):bH([e],t)}function bH(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=GH(e)),nM().getBool("DEBUG")&&WX(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type ".concat(t))}function yH(){return nM().platform.now()}function AH(e,t){return nM().platform.fetch(e,t)}function vH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",nM().platform.encode(e,t)}function SH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",nM().platform.decode(e,t)}function xH(e){return null!=nM().platform.isTypedArray?nM().platform.isTypedArray(e):BF(e)}function GH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||qX(e)||null==e||xH(e)&&n)t.push(e);else if(Array.isArray(e)||xH(e))for(let a=0;a<e.length;++a)GH(e[a],t,n);else{let a=-1;for(const t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(a=Math.max(a,Number(t)));for(let o=0;o<=a;o++)GH(e[o],t,n)}return t}const ZH=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:AX,arraysEqualWithNull:yX,assert:IX,assertNonNegativeIntegerDimensions:_X,assertNonNull:fX,assertShapesMatch:CX,bytesFromStringArray:MX,bytesPerElement:XX,checkConversionForErrors:WX,clamp:dX,computeStrides:LX,convertBackendValuesAndArrayBuffer:DX,createScalarValue:fH,createShuffledIndices:function(e){const t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return uX(t),t},decodeString:SH,distSquared:function(e,t){let n=0;for(let a=0;a<e.length;a++){const o=Number(e[a])-Number(t[a]);n+=o*o}return n},encodeString:vH,fetch:AH,fingerPrint64:CH,flatten:GH,getArrayFromDType:RX,getTypedArrayFromDType:BX,hasEncodingLoss:NX,hexToLong:rH,indexToLoc:jX,inferDtype:HX,inferFromImplicitShape:ZX,isBoolean:EX,isFunction:JX,isInt:vX,isNumber:FX,isPromise:qX,isScalarShape:function(e){return 0===e.length},isString:TX,isTypedArray:xH,isValidDtype:VX,locToIndex:QX,makeOnesTypedArray:UX,makeZerosNestedTypedArray:OX,makeZerosTypedArray:PX,nearestDivisor:YX,nearestLargerEven:hX,now:yH,parseAxisParam:wX,randUniform:function(e,t){const n=Math.random();return t*n+(1-n)*e},repeatedTry:GX,rightPad:xX,shuffle:uX,shuffleCombo:function(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together First array length was ".concat(e.length,"Second array length was ").concat(t.length));let n=e.length,a=0;for(;n>0;)a=Math.random()*n|0,n--,pX(e,n,a),pX(t,n,a)},sizeFromShape:bX,sizeToSquarishShape:SX,squeezeShape:kX,sum:mX,swap:pX,tanh:function(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{const t=Math.exp(2*e);return(t-1)/(t+1)}},toNestedArray:KX,toTypedArray:bH},Symbol.toStringTag,{value:"Module"}));class wH{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new BH)}profileKernel(e,t,n){let a;const o=()=>{a=n()};let i;const r=yH();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const e of a)e.dataSync();i=Promise.resolve({kernelMs:yH()-r})}if(nM().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let s=0;s<a.length;s++){const t=a[s];t.data().then((n=>{kH(n,t.dtype,e)}))}return{kernelName:e,outputs:a,inputs:t,timeMs:i.then((e=>e.kernelMs)),extraInfo:i.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:a,inputs:o,extraInfo:i}=e;n.forEach((e=>{Promise.all([e.data(),a,i]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],o,n[2])}))}))}}function kH(e,t,n){if("float32"!==t)return!1;for(let a=0;a<e.length;a++){const t=e[a];if(isNaN(t)||!isFinite(t))return console.warn("Found ".concat(t," in the result of '").concat(n,"'")),!0}return!1}class BH{logKernelProfile(e,t,n,a,o,i){const r="number"==typeof a?xX("".concat(a,"ms"),9):a.error,s=xX(e,25),l=t.rank,c=t.size,g=xX(t.shape.toString(),14);let u="";for(const d in o){const e=o[d];if(null!=e){const n=e.shape||t.shape,a=n.length;u+="".concat(d,": ").concat(a,"D ").concat(a>0?n:""," ")}}console.log("%c".concat(s,"\t%c").concat(r,"\t%c").concat(l,"D ").concat(g,"\t%c").concat(c,"\t%c").concat(u,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}const RH=20,WH=3,VH=7;function NH(e,t,n,a){const o=LX(t),i=function(e,t,n,a){const o=bX(t),i=a[a.length-1],r=new Array(i).fill(0),s=t.length,l="complex64"===n?EH(e):e;if(s>1)for(let c=0;c<o/i;c++){const e=c*i;for(let t=0;t<i;t++)r[t]=Math.max(r[t],XH(l[e+t],0,n).length)}return r}(e,t,n,o),r=t.length,s=TH(e,t,n,o,i),l=["Tensor"];return a&&(l.push("  dtype: ".concat(n)),l.push("  rank: ".concat(r)),l.push("  shape: [".concat(t,"]")),l.push("  values:")),l.push(s.map((e=>"    "+e)).join("\n")),l.join("\n")}function XH(e,t,n){let a;return a=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(VH))," + ").concat(parseFloat(e[1].toFixed(VH)),"j"):TX(e)?"'".concat(e,"'"):"bool"===n?MH(e):parseFloat(e.toFixed(VH)).toString(),xX(a,t)}function MH(e){return 0===e?"false":"true"}function TH(e,t,n,a,o){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const r="complex64"===n?2:1,s=t[0],l=t.length;if(0===l){if("complex64"===n){return[XH(EH(e)[0],0,n)]}return"bool"===n?[MH(e[0])]:[e[0].toString()]}if(1===l){if(s>RH){const t=WH*r;let a=Array.from(e.slice(0,t)),i=Array.from(e.slice((s-WH)*r,s*r));return"complex64"===n&&(a=EH(a),i=EH(i)),["["+a.map(((e,t)=>XH(e,o[t],n))).join(", ")+", ..., "+i.map(((e,t)=>XH(e,o[s-WH+t],n))).join(", ")+"]"]}return["["+("complex64"===n?EH(e):Array.from(e)).map(((e,t)=>XH(e,o[t],n))).join(", ")+"]"]}const c=t.slice(1),g=a.slice(1),u=a[0]*r,d=[];if(s>RH){for(let t=0;t<WH;t++){const a=t*u,i=a+u;d.push(...TH(e.slice(a,i),c,n,g,o,!1))}d.push("...");for(let t=s-WH;t<s;t++){const a=t*u,i=a+u;d.push(...TH(e.slice(a,i),c,n,g,o,t===s-1))}}else for(let m=0;m<s;m++){const t=m*u,a=t+u;d.push(...TH(e.slice(t,a),c,n,g,o,m===s-1))}const h=2===l?",":"";d[0]="["+(s>0?d[0]+h:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+h;let p=",\n";for(let m=2;m<l;m++)p+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function EH(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class FH{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=bX(e),null!=n){const e=n.length;IX(e===this.size,(()=>"Length of values '".concat(e,"' does not match the size inferred by the shape '").concat(this.size,"'.")))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||RX(t,this.size),this.strides=LX(e)}set(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];0===n.length&&(n=[0]),IX(n.length===this.rank,(()=>"The number of provided coordinates (".concat(n.length,") must match the rank (").concat(this.rank,")")));const o=this.locToIndex(n);this.values[o]=e}get(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);let a=0;for(const i of t){if(i<0||i>=this.shape[a]){const e="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(e)}a++}let o=t[t.length-1];for(let i=0;i<t.length-1;++i)o+=this.strides[i]*t[i];return this.values[o]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return HH().makeTensor(this.values,this.shape,this.dtype)}}let HH=null,JH=null;class YH{constructor(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=bX(e),this.strides=LX(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return JH.buffer(this.shape,this.dtype,e)}bufferSync(){return JH.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return KX(this.shape,e,"complex64"===this.dtype)}arraySync(){return KX(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=HH().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map((e=>SH(e)))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),HH().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=HH().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>SH(e)))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await HH().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),HH().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return JH.print(this,e)}clone(){return this.throwIfDisposed(),JH.clone(this)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return NH(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),JH.cast(this,e)}variable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),HH().makeVariable(this,e,t,n)}}function LH(){return rM("Tensor",(()=>YH))}Object.defineProperty(YH,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),LH();class zH extends YH{constructor(e,t,n,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!AX(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));HH().disposeTensor(this),this.dataId=e.dataId,HH().incRef(this,null)}dispose(){HH().disposeVariable(this),this.isDisposedInternal=!0}}var KH,DH,UH,PH,OH,_H;Object.defineProperty(zH,Symbol.hasInstance,{value:e=>e instanceof YH&&null!=e.assign&&e.assign instanceof Function}),(DH=KH||(KH={})).R0="R0",DH.R1="R1",DH.R2="R2",DH.R3="R3",DH.R4="R4",DH.R5="R5",DH.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(UH||(UH={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(PH||(PH={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(OH||(OH={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(_H||(_H={}));const QH={float32:OH,int32:UH,bool:PH,complex64:_H};function jH(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return QH[e][t]}function qH(e){return jH(e,"int32")}function $H(e){return null!=e&&"object"==typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function eJ(e){return typeof GPUBuffer<"u"&&null!=e&&"object"==typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function tJ(e,t){if(e.dtype===t.dtype)return[e,t];const n=jH(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function nJ(e,t){IX(e.dtype===t.dtype,(()=>"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")))}function aJ(e,t){return t.some((t=>t.id===e.id))}function oJ(e){const t=[];return iJ(e,t,new Set),t}function iJ(e,t,n){if(null==e)return;if(e instanceof YH)return void t.push(e);if(!function(e){return Array.isArray(e)||"object"==typeof e}(e))return;const a=e;for(const o in a){const e=a[o];n.has(e)||(n.add(e),iJ(e,t,n))}}const rJ=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:nJ,getTensorsInContainer:oJ,isTensorInList:aJ,makeTypesMatch:tJ},Symbol.toStringTag,{value:"Module"}));function sJ(e){return null!=e.kernelName}class lJ{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class cJ{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new lJ}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error("The highest priority backend '".concat(e,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(yF("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error("Backend name '".concat(e,"' not found in registry"));if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new wH(this.backendInstance),!0}setupRegisteredKernels(){GF(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){GF(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{const n=t.factory();if(!n||n instanceof cX||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,a=n.then((n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,yF("Initialization of backend ".concat(e," failed")),yF(n.stack||n.message)),!1)));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}}catch(n){return yF("Initialization of backend ".concat(e," failed")),yF(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:a,asyncInit:o}=this.initializeBackend(n);if(o||a)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),a=n.backend,o=this.readSync(t),i=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,o,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((()=>this.startScope(a)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(a){throw t(),a}}nextTensorId(){return cJ.nextTensorId++}nextVariableId(){return cJ.nextVariableId++}clone(e){const t=uJ.runKernel(ST,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{const t={x:e},n={dtype:"float32"};return uJ.runKernel(WM,t,n)}})),[],{}),t}runKernel(e,t,n){if(null==this.backendName&&this.backend,null==SF(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const a=this.backend.numDataIds();let o=0;n.forEach((e=>{o+="complex64"===e.dtype?3:1}));const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],r=a-t-o-i;if(r>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(r," data ids) after running '").concat(e,"'"))}runKernelFunc(e){let t,n=[];const a=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;let r,s;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=sJ(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(sJ(e)){const{kernelName:t,inputs:o,attrs:i}=e;null==this.backendName&&this.backend;const l=SF(t,this.backendName);IX(null!=l,(()=>"Cannot find registered kernel '".concat(t,"' for backend '").concat(this.backendName,"'"))),r=()=>{const e=this.backend.numDataIds();s=l.kernelFunc({inputs:o,attrs:i,backend:this.backend});const r=Array.isArray(s)?s:[s];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,r);const c=r.map((e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e)));if(a){const e=this.getTensorsForGradient(t,o,c);n=this.saveTensorsForBackwardMode(e)}return c}}else{const{forwardFunc:t}=e,o=e=>{a&&(n=e.map((e=>this.keep(this.clone(e)))))};r=()=>{const e=this.backend.numDataIds();s=this.tidy((()=>t(this.backend,o)));const n=Array.isArray(s)?s:[s];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}const{inputs:c,attrs:g}=e,u=sJ(e)?null:e.backwardsFunc;let d;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(l,c,(()=>r())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs):t=r()})),a&&this.addTapeNode(l,c,t,u,n,g),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((e=>null!=c[e]?c[e].shape:null)),outputShapes:t.map((e=>e.shape)),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(s)?t:t[0]}saveTensorsForBackwardMode(e){return e.map((e=>this.keep(this.clone(e))))}getTensorsForGradient(e,t,n){const a=xF(e);if(null!=a){const e=a.inputsToSave||[],o=a.outputsToSave||[];let i;a.saveAllInputs?(IX(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),i=Object.keys(t).map((e=>t[e]))):i=e.map((e=>t[e]));const r=n.filter(((e,t)=>o[t]));return i.concat(r)}return[]}makeTensor(e,t,n,a){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;let o=e;"string"===n&&TX(e[0])&&(o=e.map((e=>vH(e))));const i=a.write(o,t,n),r=new YH(t,n,i,this.nextTensorId());if(this.trackTensor(r,a),"string"===n){const e=this.state.tensorInfo.get(i),t=MX(o);this.state.numBytes+=t-e.bytes,e.bytes=t}return r}makeTensorFromDataId(e,t,n,a){const o={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(o,a)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:a,dtype:o}=e,i=new YH(a,o,n,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=a&&a!==e.dtype&&(e=e.cast(a));const o=new zH(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name ".concat(o.name," was already registered"));return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*XX(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof zH||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*XX(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,a,o,i){const r={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},s=xF(e);null!=s&&(a=s.gradFunc),null!=a&&(r.gradient=e=>(e=e.map(((e,t)=>{if(null==e){const e=n[t],a=PX(e.size,e.dtype);return this.makeTensor(a,e.shape,e.dtype)}return e})),a(e.length>1?e:e[0],o,i))),this.state.activeTape.push(r)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=oJ(e),n=new Set(t.map((e=>e.id)));for(let o=0;o<this.state.activeScope.track.length;o++){const e=this.state.activeScope.track[o];!e.kept&&!n.has(e.id)&&e.dispose()}const a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{!e.kept&&e.scopeId===a.id&&this.track(e)}))}gradients(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(IX(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));const o=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));IX(o instanceof YH,(()=>"The result y returned by f() must be a tensor."));const i=function(e,t,n){const a={},o={};for(let l=0;l<t.length;l++)a[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],i=n.inputs;for(const e in i){const r=i[e];let s=!1;for(let e=0;e<t.length;e++)if(a[r.id]){n.outputs.forEach((e=>a[e.id]=!0)),s=!0,o[n.id]=!0;break}if(s)break}}const i={};i[n.id]=!0;const r={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(i[t.outputs[e].id]){for(const e in n)i[n[e].id]=!0,r[t.id]=!0;break}}const s=[];for(let l=0;l<e.length;l++){const t=e[l];if(o[t.id]&&r[t.id]){const e={};for(const o in t.inputs){const n=t.inputs[o];a[n.id]&&(e[o]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,s.push(n)}}return s}(this.state.activeTape,t,o);if(!a&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const e={};e[o.id]=null!==n&&void 0!==n?n:function(e){const t=UX(bX(e),"float32");return uJ.makeTensor(t,e,"float32")}(o.shape),function(e,t,n,a){for(let o=t.length-1;o>=0;o--){const i=t[o],r=[];if(i.outputs.forEach((t=>{const n=e[t.id];null!=n?r.push(n):r.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(i.kernelName,"."));const s=i.gradient(r);for(const t in i.inputs){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));const o=n((()=>s[t]()));if("float32"!==o.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(o.dtype,"'"));const r=i.inputs[t];if(!AX(o.shape,r.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(o.shape,"', which does not match the shape of the input '").concat(r.shape,"'"));if(null==e[r.id])e[r.id]=o;else{const t=e[r.id];e[r.id]=a(t,o),t.dispose()}}}}(e,i,(e=>this.tidy(e)),dJ);const a=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(const t of e.saved)t.dispose()})),this.state.activeTape=null),{value:o,grads:a}}))}customGrad(e){var t=this;return IX(JX(e),(()=>"The f passed in customGrad(f) must be a function.")),function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];let i;IX(a.every((e=>e instanceof YH)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};a.forEach(((e,t)=>{r[t]=e}));return t.runKernelFunc({forwardFunc:(t,n)=>(i=e(...a,n),IX(i.value instanceof YH,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),IX(JX(i.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),i.value),backwardsFunc:(e,t)=>{const n=i.gradFunc(e,t),o=Array.isArray(n)?n:[n];IX(o.length===a.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),IX(o.every((e=>e instanceof YH)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const r={};return o.forEach(((e,t)=>{r[t]=()=>e})),r},inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=yH(),n=await this.backend.time(e);return n.wallMs=yH()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new lJ;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function gJ(){const e=iM();if(null==e._tfengine){const t=new eM(e);e._tfengine=new cJ(t)}return function(e){oM=e}(e._tfengine.ENV),function(e){HH=e}((()=>e._tfengine)),e._tfengine}cJ.nextTensorId=0,cJ.nextVariableId=0;const uJ=gJ();function dJ(e,t){const n={a:e,b:t};return uJ.runKernel(gM,n)}let hJ;function pJ(e){if(void 0!==hJ)return hJ;if(e||typeof navigator<"u"&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function mJ(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}const IJ=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:mJ,isMobile:pJ,mockIsMobile:function(e){hJ=e}},Symbol.toStringTag,{value:"Module"})),CJ=nM();function fJ(e,t){let n=e;if(xH(e))return"string"===t?[]:[e.length];if($H(e)){const t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(eJ(e))return[e.buffer.size/(null==t?4:XX(t))];if(!Array.isArray(e))return[];const a=[];for(;Array.isArray(n)||xH(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&nM().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&bJ(e,a,[]),a}function bJ(e,t,n){if(n=n||[],!Array.isArray(e)&&!xH(e))return void IX(0===t.length,(()=>"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")));IX(t.length>0,(()=>"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements"))),IX(e.length===t[0],(()=>"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")));const a=t.slice(1);for(let o=0;o<e.length;++o)bJ(e[o],a,n.concat(o))}function yJ(e,t,n,a){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(a,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function AJ(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof LH())return yJ(a,e.dtype,t,n),e;let o=HX(e);if("string"!==o&&["bool","int32","float32"].indexOf(a)>=0&&(o=a),yJ(a,o,t,n),null==e||!xH(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){const a=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(a,"'"))}const i=fJ(e,o);!xH(e)&&!Array.isArray(e)&&(e=[e]);const r="string"!==o?bH(e,o):GH(e,[],!0);return uJ.makeTensor(r,i,o)}function vJ(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map(((e,o)=>AJ(e,"".concat(t,"[").concat(o,"]"),n,a)))}CJ.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),CJ.registerFlag("IS_BROWSER",(()=>mJ())),CJ.registerFlag("IS_NODE",(()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u")),CJ.registerFlag("IS_CHROME",(()=>typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),CJ.registerFlag("IS_SAFARI",(()=>typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor))),CJ.registerFlag("PROD",(()=>!1)),CJ.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>CJ.getBool("DEBUG"))),CJ.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),CJ.registerFlag("IS_TEST",(()=>!1)),CJ.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>CJ.getBool("DEBUG"))),CJ.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),CJ.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),CJ.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));const SJ="__op";function xJ(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));let n=t[0];const a=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=SJ;const o=function(){uJ.startScope(n);try{const e=a(...arguments);return qX(e)&&console.error("Cannot return a Promise inside of tidy."),uJ.endScope(e),e}catch(cpe){throw uJ.endScope(null),cpe}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}const GJ=xJ({complex_:function(e,t){const n=AJ(e,"real","complex"),a=AJ(t,"imag","complex");CX(n.shape,a.shape,"real and imag shapes, ".concat(n.shape," and ").concat(a.shape,", must match in call to tf.complex()."));const o={real:n,imag:a};return uJ.runKernel(XM,o)}});function ZJ(e,t,n,a){if(null==a)a=HX(e);else if("complex64"===a)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(eJ(e)||$H(e)){if("float32"!==a&&"int32"!==a)throw new Error("Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ".concat(a,"."));return uJ.backend.createTensorFromGPUData(e,t||n,a)}if(!xH(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){_X(t);const e=bX(t),a=bX(n);IX(e===a,(()=>"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(e," values but has ").concat(a)));for(let o=0;o<n.length;++o){const e=n[o],a=o!==n.length-1||e!==bX(t.slice(o));IX(n[o]===t[o]||!a,(()=>"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")))}}return!xH(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==a?bH(e,a):GH(e,[],!0),uJ.makeTensor(e,t,a)}function wJ(e,t,n){return ZJ(e,t,fJ(e,n),n)}const kJ={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class BJ{static join(e){return new BJ(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e||(e instanceof Array||(e=[e]),0===(e=e.map((e=>xH(e)?e.buffer:e))).length))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){const a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+a.byteLength;this.shards.push({buffer:a,start:t,end:o}),t=o}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));const a=new ArrayBuffer(t-e),o=new Uint8Array(a);let i=0;for(let r=n;r<this.shards.length;r++){const n=this.shards[r],a=e+i-n.start,s=i,l=Math.min(t,n.end)-n.start,c=new Uint8Array(n.buffer,a,l-a);if(o.set(c,s),i+=c.length,t<n.end)break}return a}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=function(e,t){let n=0,a=e.length;for(;n<=a;){const o=Math.floor((a-n)/2)+n,i=t(e[o]);if(0===i)return o;i<0?a=o:n=o+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function RJ(){return uJ}function WJ(){return uJ.memory()}function VJ(e,t){return uJ.tidy(e,t)}function NJ(e){oJ(e).forEach((e=>e.dispose()))}function XJ(e){return uJ.keep(e)}function MJ(){return uJ.backendName}function TJ(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return uJ.registerBackend(e,t,n)}function EJ(){return uJ.backend}const FJ=4;async function HJ(e,t){const n=[],a=[],o=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);for(let i=0;i<o.length;++i){const r=o[i],s=Array.isArray(e)?e[i].tensor:e[r];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(r,"': ").concat(s.dtype));const l={name:r,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){const e=new Promise((async e=>{const t=await s.bytes(),n=t.reduce(((e,t)=>e+t.length),0)+FJ*t.length,a=new Uint8Array(n);let o=0;for(let i=0;i<t.length;i++){const e=t[i],n=new Uint8Array(new Uint32Array([e.length]).buffer);a.set(n,o),o+=FJ,a.set(e,o),o+=e.length}e(a)}));a.push(e)}else a.push(s.data());null!=t&&(l.group=t),n.push(l)}return{data:UJ(await Promise.all(a)),specs:n}}function JJ(e,t){const n=new BJ(e),a={};let o=0;for(const i of t){const e=YJ(i,((e,t)=>n.slice(o+e,o+t)));a[i.name]=zJ(i,n.slice(o,o+e)),o+=e}return a}function YJ(e,t){const n=bX(e.shape);let a;if("quantization"in e){const t=e.quantization;a=kJ[t.dtype]}else{if("string"===e.dtype){let e=0;for(let a=0;a<n;a++)e+=FJ+new Uint32Array(t(e,e+FJ))[0];return e}a=kJ[e.dtype]}return n*a}async function LJ(e,t){const n=bX(e.shape);let a;if("quantization"in e){const t=e.quantization;a=kJ[t.dtype]}else{if("string"===e.dtype){let e=0;for(let a=0;a<n;a++)e+=FJ+new Uint32Array(await t(e,e+FJ))[0];return e}a=kJ[e.dtype]}return n*a}function zJ(e,t){const n=e.name,a=e.dtype,o=e.shape,i=bX(o);let r,s=0;if("quantization"in e){const o=e.quantization;if("uint8"===o.dtype||"uint16"===o.dtype){if(!("min"in o)||!("scale"in o))throw new Error("Weight ".concat(e.name," with quantization ").concat(o.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==o.dtype)throw new Error("Weight ".concat(e.name," has unknown quantization dtype ").concat(o.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==a)throw new Error("Weight ".concat(e.name," is quantized with ").concat(o.dtype," which only supports weights of type float32 not ").concat(a,"."))}const l=kJ[o.dtype],c="uint8"===o.dtype?new Uint8Array(t):new Uint16Array(t);if("float32"===a)if("uint8"===o.dtype||"uint16"===o.dtype){r=new Float32Array(c.length);for(let e=0;e<c.length;e++){const t=c[e];r[e]=t*o.scale+o.min}}else{if("float16"!==o.dtype)throw new Error("Unsupported quantization type ".concat(o.dtype," for weight type float32."));r=function(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;!(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return a=>{const o=new ArrayBuffer(4*a.length),i=new Uint32Array(o);for(let r=0;r<a.length;r++){const o=a[r],s=e[n[o>>10]+(1023&o)]+t[o>>10];i[r]=s}return new Float32Array(o)}}()(c)}else{if("int32"!==a)throw new Error("Unsupported dtype in weight '".concat(n,"': ").concat(a));if("uint8"!==o.dtype&&"uint16"!==o.dtype)throw new Error("Unsupported quantization type ".concat(o.dtype," for weight type int32."));r=new Int32Array(c.length);for(let e=0;e<c.length;e++){const t=c[e];r[e]=Math.round(t*o.scale+o.min)}}s+=i*l}else if("string"===a){const n=bX(e.shape);r=[];for(let e=0;e<n;e++){const e=new Uint32Array(t.slice(s,s+FJ))[0];s+=FJ;const n=new Uint8Array(t.slice(s,s+e));r.push(n),s+=e}}else{const e=kJ[a];if("float32"===a)r=new Float32Array(t);else if("int32"===a)r=new Int32Array(t);else{if("bool"!==a){if("complex64"===a){r=new Float32Array(t);const e=new Float32Array(r.length/2),n=new Float32Array(r.length/2);for(let t=0;t<e.length;t++)e[t]=r[2*t],n[t]=r[2*t+1];const a=wJ(e,o,"float32"),i=wJ(n,o,"float32"),s=GJ(a,i);return a.dispose(),i.dispose(),s}throw new Error("Unsupported dtype in weight '".concat(n,"': ").concat(a))}r=new Uint8Array(t)}s+=i*e}return wJ(r,o,a)}async function KJ(e,t,n){let a=new Uint8Array(t);for(;a.byteLength<n;){const{done:t,value:o}=await e.read();if(t&&null==o){const e=n-a.byteLength;throw new Error("Reader is done but ".concat(e," bytes are still expected"))}const i=new Uint8Array(a.length+o.byteLength);i.set(a,0),i.set(new Uint8Array(o),a.length),a=i}return a.buffer}async function DJ(e,t){const n={},a=e.getReader();let o=new ArrayBuffer(0);for(const i of t){const e=await LJ(i,(async(e,t)=>(o=await KJ(a,o,t),o.slice(e,t))));o=await KJ(a,o,e);const t=o.slice(0,e);o=o.slice(e);const r=zJ(i,t);if(n[i.name]=r,"webgpu"===MJ()){const e=EJ();"uploadToGPU"in e&&bX(r.shape)>=nM().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&e.uploadToGPU(r.dataId)}}return n}function UJ(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));let t=0;const n=[];e.forEach((e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));const a=new Uint8Array(t);let o=0;return n.forEach((e=>{a.set(new Uint8Array(e.buffer),o),o+=e.byteLength})),a.buffer}const PJ=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function OJ(e){return PJ?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function _J(e){return BJ.join(e)}function QJ(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function jJ(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function qJ(e,t,n){const a={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(a.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");a.weightSpecs=t,a.weightData=n}return null!=e.signature&&(a.signature=e.signature),null!=e.userDefinedMetadata&&(a.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(a.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(a.initializerSignature=e.initializerSignature),a}async function $J(e,t){let n,a;return null!=e.weightsManifest&&([n,a]=await t(e.weightsManifest)),qJ(e,n,a)}function eY(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:OJ(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:OJ(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new BJ(e.weightData).byteLength}}function tY(e){const t=[];for(const n of e)t.push(...n.weights);return t}class nY{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==nY.instance&&(nY.instance=new nY),nY.instance}static registerSaveRouter(e){nY.getInstance().saveRouters.push(e)}static registerLoadRouter(e){nY.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return nY.getHandlers(e,"save")}static getLoadHandlers(e,t){return nY.getHandlers(e,"load",t)}static getHandlers(e,t,n){const a=[];return("load"===t?nY.getInstance().loadRouters:nY.getInstance().saveRouters).forEach((t=>{const o=t(e,n);null!==o&&a.push(o)})),a}}const aY=e=>nY.getSaveHandlers(e),oY=(e,t)=>nY.getLoadHandlers(e,t),iY="tensorflowjs",rY="models_store",sY="model_info_store";function lY(){if(!nM().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function cY(e){const t=e.result;t.createObjectStore(rY,{keyPath:"modelPath"}),t.createObjectStore(sY,{keyPath:"modelPath"})}class gY{constructor(e){if(this.indexedDB=lY(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const a=this.indexedDB.open(iY,1);a.onupgradeneeded=()=>cY(a),a.onsuccess=()=>{const o=a.result;if(null==t){const t=o.transaction(rY,"readonly"),a=t.objectStore(rY).get(this.modelPath);a.onsuccess=()=>{if(null==a.result)return o.close(),n(new Error("Cannot find model with path '".concat(this.modelPath,"' in IndexedDB.")));e(a.result.modelArtifacts)},a.onerror=e=>(o.close(),n(a.error)),t.oncomplete=()=>o.close()}else{t.weightData=BJ.join(t.weightData);const a=eY(t),i=o.transaction(sY,"readwrite");let r,s,l=i.objectStore(sY);try{r=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(oX){return n(oX)}r.onsuccess=()=>{s=o.transaction(rY,"readwrite");const r=s.objectStore(rY);let c;try{c=r.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(g){return n(g)}c.onsuccess=()=>e({modelArtifactsInfo:a}),c.onerror=e=>{l=i.objectStore(sY);const t=l.delete(this.modelPath);t.onsuccess=()=>(o.close(),n(c.error)),t.onerror=e=>(o.close(),n(c.error))}},r.onerror=e=>(o.close(),n(r.error)),i.oncomplete=()=>{null==s?o.close():s.oncomplete=()=>o.close()}}},a.onerror=e=>n(a.error)}))}}gY.URL_SCHEME="indexeddb://";const uY=e=>nM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(gY.URL_SCHEME)?function(e){return new gY(e)}(e.slice(gY.URL_SCHEME.length)):null;nY.registerSaveRouter(uY),nY.registerLoadRouter(uY);class dY{constructor(){this.indexedDB=lY()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open(iY,1);n.onupgradeneeded=()=>cY(n),n.onsuccess=()=>{const a=n.result,o=a.transaction(sY,"readonly"),i=o.objectStore(sY).getAll();i.onsuccess=()=>{const t={};for(const e of i.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},i.onerror=e=>(a.close(),t(i.error)),o.oncomplete=()=>a.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){return e=function(e){return e.startsWith(gY.URL_SCHEME)?e.slice(gY.URL_SCHEME.length):e}(e),new Promise(((t,n)=>{const a=this.indexedDB.open(iY,1);a.onupgradeneeded=()=>cY(a),a.onsuccess=()=>{const o=a.result,i=o.transaction(sY,"readwrite"),r=i.objectStore(sY),s=r.get(e);let l;s.onsuccess=()=>{if(null==s.result)return o.close(),n(new Error("Cannot find model with path '".concat(e,"' in IndexedDB.")));{const a=r.delete(e),i=()=>{l=o.transaction(rY,"readwrite");const a=l.objectStore(rY).delete(e);a.onsuccess=()=>t(s.result.modelArtifactsInfo),a.onerror=e=>n(s.error)};a.onsuccess=i,a.onerror=e=>(i(),o.close(),n(s.error))}},s.onerror=e=>(o.close(),n(s.error)),i.oncomplete=()=>{null==l?o.close():l.oncomplete=()=>o.close()}},a.onerror=e=>n(a.error)}))}}const hY="/",pY="tensorflowjs_models",mY="info",IY="model_topology",CY="weight_specs",fY="weight_data",bY="model_metadata";function yY(e){return{info:[pY,e,mY].join(hY),topology:[pY,e,IY].join(hY),weightSpecs:[pY,e,CY].join(hY),weightData:[pY,e,fY].join(hY),modelMetadata:[pY,e,bY].join(hY)}}function AY(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function vY(e){const t=e.split(hY);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(hY)}class SY{constructor(e){if(!nM().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=yY(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=eY(e),o=BJ.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(PJ)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let a=0,o=t.length;a<o;a++)n+=String.fromCharCode(t[a]);return btoa(n)}(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}}catch{throw AY(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."))}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));t.modelTopology=n;const a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==a)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));t.weightSpecs=a;const o=this.LS.getItem(this.keys.modelMetadata);if(null!=o){const e=JSON.parse(o);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(null==i)throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));return t.weightData=function(e){if(PJ){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}(i),t}}SY.URL_SCHEME="localstorage://";const xY=e=>nM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(SY.URL_SCHEME)?function(e){return new SY(e)}(e.slice(SY.URL_SCHEME.length)):null;nY.registerSaveRouter(xY),nY.registerLoadRouter(xY);class GY{constructor(){IX(nM().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),IX(typeof window>"u"||typeof window.localStorage<"u",(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=pY+hY,n=hY+mY;for(let a=0;a<this.LS.length;++a){const o=this.LS.key(a);if(o.startsWith(t)&&o.endsWith(n)){e[vY(o)]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=function(e){return e.startsWith(SY.URL_SCHEME)?e.slice(SY.URL_SCHEME.length):e}(e);const t=yY(e);if(null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '".concat(e,"'"));const n=JSON.parse(this.LS.getItem(t.info));return AY(t),n}}const ZY="://";class wY{constructor(){this.managers={}}static getInstance(){return null==wY.instance&&(wY.instance=new wY),wY.instance}static registerManager(e,t){IX(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith(ZY)&&(e=e.slice(0,e.indexOf(ZY))),IX(e.length>0,(()=>"scheme must not be an empty string."));const n=wY.getInstance();IX(null==n.managers[e],(()=>"A model store manager is already registered for scheme '".concat(e,"'."))),n.managers[e]=t}static getManager(e){const t=wY.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}static getSchemes(){return Object.keys(wY.getInstance().managers)}}function kY(e){if(-1===e.indexOf(ZY))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(wY.getSchemes().join(",")));return{scheme:e.split(ZY)[0],path:e.split(ZY)[1]}}async function BY(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];IX(e!==t,(()=>"Old path and new path are the same: '".concat(e,"'")));const a=nY.getLoadHandlers(e);IX(a.length>0,(()=>"Copying failed because no load handler is found for source URL ".concat(e,"."))),IX(a.length<2,(()=>"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(e,".")));const o=a[0],i=nY.getSaveHandlers(t);IX(i.length>0,(()=>"Copying failed because no save handler is found for destination URL ".concat(t,"."))),IX(i.length<2,(()=>"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(t,".")));const r=i[0],s=kY(e).scheme,l=kY(e).path,c=s===kY(e).scheme,g=await o.load();n&&c&&await wY.getManager(s).removeModel(l);const u=await r.save(g);return n&&!c&&await wY.getManager(s).removeModel(l),u.modelArtifactsInfo}class RY{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){typeof window>"u"||!nM().getBool("USE_SETTIMEOUTCUSTOM")?setTimeout(e,t):(this.functionRefs.push(e),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}}),!0)))}isTypedArray(e){return BF(e)}}if(nM().get("IS_BROWSER")){nM().setPlatform("browser",new RY);try{wY.registerManager(SY.URL_SCHEME,new GY)}catch{}try{wY.registerManager(gY.URL_SCHEME,new dY)}catch{}}const WY=()=>require("node-fetch");let VY;function NY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",_X(e),new FH(e,t,n)}nM().get("IS_NODE")&&!nM().get("IS_BROWSER")&&nM().setPlatform("node",new class{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=nM().global.fetch?nM().global.fetch(e,t):(null==VY&&(VY=WY()),VY(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}});const XY=xJ({cast_:function(e,t){const n=AJ(e,"x","cast");if(!VX(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const a={x:n},o={dtype:t};return uJ.runKernel(WM,a,o)}});const MY=xJ({clone_:function(e){const t={x:AJ(e,"x","clone","string_or_numeric")};return uJ.runKernel(ST,t)}});function TY(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}gJ();!function(e){JH=e}({buffer:NY,cast:XY,clone:MY,print:TY});const EY=xJ({add_:function(e,t){let n=AJ(e,"a","add"),a=AJ(t,"b","add");[n,a]=tJ(n,a);const o={a:n,b:a};return uJ.runKernel(gM,o)}});const FY=xJ({floorDiv_:function(e,t){let n=AJ(e,"a","floorDiv"),a=AJ(t,"b","floorDiv");[n,a]=tJ(n,a);const o={a:n,b:a};return uJ.runKernel(CT,o)}});const HY=xJ({div_:function(e,t){let n=AJ(e,"a","div"),a=AJ(t,"b","div");if([n,a]=tJ(n,a),"int32"===n.dtype&&"int32"===a.dtype)return FY(n,a);const o={a:n,b:a};return uJ.runKernel(oT,o,{})}});const JY=xJ({mul_:function(e,t){let n=AJ(e,"a","mul"),a=AJ(t,"b","mul");[n,a]=tJ(n,a);const o={a:n,b:a};return uJ.runKernel(eE,o)}});const YY=xJ({abs_:function(e){const t=AJ(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return uJ.runKernel(MM,e)}{const e={x:t};return uJ.runKernel(sM,e)}}});const LY=xJ({acos_:function(e){const t={x:AJ(e,"x","acos")};return uJ.runKernel(lM,t)}});const zY=xJ({acosh_:function(e){const t={x:AJ(e,"x","acosh")};return uJ.runKernel(cM,t)}});const KY=xJ({all_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={x:AJ(e,"x","all","bool")},o={axis:t,keepDims:n};return uJ.runKernel(dM,a,o)}});const DY=xJ({any_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={x:AJ(e,"x","any","bool")},o={axis:t,keepDims:n};return uJ.runKernel(hM,a,o)}});const UY=xJ({argMax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:AJ(e,"x","argMax")},a={axis:t};return uJ.runKernel(pM,n,a)}});const PY=xJ({argMin_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:AJ(e,"x","argMin")},a={axis:t};return uJ.runKernel(mM,n,a)}});const OY=xJ({asin_:function(e){const t={x:AJ(e,"x","asin")};return uJ.runKernel(IM,t)}});const _Y=xJ({asinh_:function(e){const t={x:AJ(e,"x","asinh")};return uJ.runKernel(CM,t)}});const QY=xJ({atan_:function(e){const t={x:AJ(e,"x","atan")};return uJ.runKernel(fM,t)}});const jY=xJ({atan2_:function(e,t){let n=AJ(e,"a","atan2"),a=AJ(t,"b","atan2");[n,a]=tJ(n,a);const o={a:n,b:a};return uJ.runKernel(yM,o)}});const qY=xJ({atanh_:function(e){const t={x:AJ(e,"x","atanh")};return uJ.runKernel(bM,t)}});function $Y(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return nL(e,[...t,e[3]],n,i,a,null,null,dL(o))}function eL(e,t,n,a,o,i){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";const[s,l]=iL(t);let c;if("channelsLast"===r)c=[s,l,e[3],e[3]];else{if("channelsFirst"!==r)throw new Error("Unknown dataFormat ".concat(r));c=[s,l,e[1],e[1]]}return nL(e,c,n,a,o,i,!1,r)}function tL(e,t,n,a,o,i){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC";const[s,l,c]=rL(t);let g,u;if("NDHWC"===r)u="channelsLast",g=[s,l,c,e[4],e[4]];else{if("NCDHW"!==r)throw new Error("Unknown dataFormat ".concat(r));u="channelsFirst",g=[s,l,c,e[1],e[1]]}return aL(e,g,n,a,o,!1,u,i)}function nL(e,t,n,a,o,i){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",[l,c,g,u]=[-1,-1,-1,-1];if("channelsLast"===s)[l,c,g,u]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));[l,u,c,g]=e}const[d,h,,p]=t,[m,I]=iL(n),[C,f]=iL(a),b=sL(d,C),y=sL(h,f),{padInfo:A,outHeight:v,outWidth:S}=function(e,t,n,a,o,i,r,s,l){let c,g,u;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const o=function(e,t,n,a,o){null==a&&(a=oL(e,t,n));const i=e[0],r=e[1],s=lL((i-t+2*a)/n+1,o),l=lL((r-t+2*a)/n+1,o);return[s,l]}([t,n],i,a,e,s);g=o[0],u=o[1]}else if("same"===e){g=Math.ceil(t/a),u=Math.ceil(n/o);const e=Math.max(0,(g-1)*a+i-t),s=Math.max(0,(u-1)*o+r-n),l=Math.floor(e/2),d=e-l,h=Math.floor(s/2);c={top:l,bottom:d,left:h,right:s-h,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},g=Math.ceil((t-i+1)/a),u=Math.ceil((n-r+1)/o);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));{const d="channelsLast"===l?e[1][0]:e[2][0],h="channelsLast"===l?e[1][1]:e[2][1],p="channelsLast"===l?e[2][0]:e[3][0],m="channelsLast"===l?e[2][1]:e[3][1];c={top:d,bottom:h,left:p,right:m,type:0===d&&0===h&&0===p&&0===m?"VALID":"EXPLICIT"},g=lL((t-i+d+h)/a+1,s),u=lL((n-r+p+m)/o+1,s)}}return{padInfo:c,outHeight:g,outWidth:u}}(o,c,g,m,I,b,y,i,s),x=r?p*u:p;let G;return"channelsFirst"===s?G=[l,x,v,S]:"channelsLast"===s&&(G=[l,v,S,x]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:g,inChannels:u,outHeight:v,outWidth:S,outChannels:x,padInfo:A,strideHeight:m,strideWidth:I,filterHeight:d,filterWidth:h,effectiveFilterHeight:b,effectiveFilterWidth:y,dilationHeight:C,dilationWidth:f,inShape:e,outShape:G,filterShape:t}}function aL(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,[l,c,g,u,d]=[-1,-1,-1,-1,-1];if("channelsLast"===r)[l,c,g,u,d]=e;else{if("channelsFirst"!==r)throw new Error("Unknown dataFormat ".concat(r));[l,d,c,g,u]=e}const[h,p,m,,I]=t,[C,f,b]=rL(n),[y,A,v]=rL(a),S=sL(h,y),x=sL(p,A),G=sL(m,v),{padInfo:Z,outDepth:w,outHeight:k,outWidth:B}=function(e,t,n,a,o,i,r,s,l,c,g){let u,d,h,p;if("valid"===e&&(e=0),"number"==typeof e){u={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const m=function(e,t,n,a,o,i){null==o&&(o=oL(e,t[0],a[0]));const r=[0,0,0,n];for(let s=0;s<3;s++)e[s]+2*o>=t[s]&&(r[s]=lL((e[s]-t[s]+2*o)/a[s]+1,i));return r}([t,n,a,1],[s,l,c],1,[o,i,r],e,g);d=m[0],h=m[1],p=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/o),h=Math.ceil(n/i),p=Math.ceil(a/r);const e=(d-1)*o+s-t,g=(h-1)*i+l-n,m=(p-1)*r+c-a,I=Math.floor(e/2),C=e-I,f=Math.floor(g/2),b=g-f,y=Math.floor(m/2);u={top:f,bottom:b,left:y,right:m-y,front:I,back:C,type:"SAME"}}}return{padInfo:u,outDepth:d,outHeight:h,outWidth:p}}(o,c,g,u,C,f,b,S,x,G,s),R=i?I*d:I;let W;return"channelsFirst"===r?W=[l,R,w,k,B]:"channelsLast"===r&&(W=[l,w,k,B,R]),{batchSize:l,dataFormat:r,inDepth:c,inHeight:g,inWidth:u,inChannels:d,outDepth:w,outHeight:k,outWidth:B,outChannels:R,padInfo:Z,strideDepth:C,strideHeight:f,strideWidth:b,filterDepth:h,filterHeight:p,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:x,effectiveFilterWidth:G,dilationDepth:y,dilationHeight:A,dilationWidth:v,inShape:e,outShape:W,filterShape:t}}function oL(e,t,n){const a=sL(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+a)/2)}function iL(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function rL(e){return"number"==typeof e?[e,e,e]:e}function sL(e,t){return t<=1?e:e+(e-1)*(t-1)}function lL(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function cL(e){const[t,n,a]=iL(e);return 1===t&&1===n&&1===a}function gL(e,t){return cL(e)||cL(t)}function uL(e){return iL(e).every((e=>e>0))}function dL(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function hL(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)IX(vX(t),(()=>"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")));else{if("object"!=typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((t=>{t.forEach((t=>{IX(vX(t),(()=>"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")))}))}))}}}const pL=xJ({reshape_:function(e,t){const n={x:AJ(e,"x","reshape","string_or_numeric")},a={shape:t};return uJ.runKernel(yE,n,a)}});const mL=xJ({avgPool_:function(e,t,n,a,o){const i=AJ(e,"x","avgPool","float32");IX(gL(n,1),(()=>"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")));let r=i,s=!1;3===i.rank&&(s=!0,r=pL(i,[1,i.shape[0],i.shape[1],i.shape[2]])),IX(4===r.rank,(()=>"Error in avgPool: x must be rank 4 but got rank ".concat(r.rank,"."))),hL("avgPool",a,o);const l={x:r},c={filterSize:t,strides:n,pad:a,dimRoundingMode:o};let g=uJ.runKernel(AM,l,c);return g=XY(g,i.dtype),s?pL(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});const IL=xJ({avgPool3d_:function(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const r=AJ(e,"x","avgPool3d","float32");let s=r,l=!1;4===r.rank&&(l=!0,s=pL(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),IX(5===s.rank,(()=>"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,"."))),IX("NDHWC"===i,(()=>"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i))),IX("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(()=>"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'"))),hL("avgPool3d",a,o);const c={x:s},g={filterSize:t,strides:n,pad:a,dimRoundingMode:o,dataFormat:i};let u=uJ.runKernel(SM,c,g);return u=XY(u,s.dtype),l?pL(u,[u.shape[1],u.shape[2],u.shape[3],u.shape[4]]):u}});const CL=xJ({concat_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;IX(e.length>=1,(()=>"Pass at least one tensor to concat"));const n=vJ(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return MY(n[0]);const a=n,o={axis:t};return uJ.runKernel(TM,a,o)}});const fL=xJ({matMul_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=AJ(e,"a","matMul"),i=AJ(t,"b","matMul");[o,i]=tJ(o,i);const r={a:o,b:i},s={transposeA:n,transposeB:a};return uJ.runKernel(GM,r,s)}});const bL=xJ({sigmoid_:function(e){const t={x:AJ(e,"x","sigmoid","float32")};return uJ.runKernel(FE,t)}});const yL=xJ({slice_:function(e,t,n){const a=AJ(e,"x","slice","string_or_numeric");if(0===a.rank)throw new Error("Slicing scalar is not possible");const o={x:a},i={begin:t,size:n};return uJ.runKernel(XE,o,i)}});const AL=xJ({tanh_:function(e){const t={x:AJ(e,"x","tanh","float32")};return uJ.runKernel(iF,t)}});const vL=xJ({batchToSpaceND_:function(e,t,n){const a=AJ(e,"x","batchToSpaceND"),o=t.reduce(((e,t)=>e*t));IX(a.rank>=1+t.length,(()=>"input rank is ".concat(a.rank," but should be > than blockShape.length ").concat(t.length))),IX(n.length===t.length,(()=>"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length))),IX(a.shape[0]%o===0,(()=>"input tensor batch is ".concat(a.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(o)));const i={x:a},r={blockShape:t,crops:n};return uJ.runKernel(ZM,i,r)}});function SL(e){let t;return t=0===e.rank||1===e.rank?pL(e,[1,1,1,e.size]):2===e.rank?pL(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?pL(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}const xL=xJ({batchNorm_:function(e,t,n,a,o,i){null==i&&(i=.001);const r=AJ(e,"x","batchNorm"),s=AJ(t,"mean","batchNorm"),l=AJ(n,"variance","batchNorm");let c,g;null!=o&&(c=AJ(o,"scale","batchNorm")),null!=a&&(g=AJ(a,"offset","batchNorm")),IX(s.rank===l.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),IX(null==g||s.rank===g.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),IX(null==c||s.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const u={x:SL(r),scale:c,offset:g,mean:s,variance:l},d={varianceEpsilon:i},h=uJ.runKernel(fT,u,d);return pL(h,r.shape)}});const GL=xJ({batchNorm2d_:function(e,t,n,a,o,i){const r=AJ(e,"x","batchNorm"),s=AJ(t,"mean","batchNorm"),l=AJ(n,"variance","batchNorm");let c,g;return null!=o&&(c=AJ(o,"scale","batchNorm")),null!=a&&(g=AJ(a,"offset","batchNorm")),IX(2===r.rank,(()=>"Error in batchNorm2D: x must be rank 2 but got rank ".concat(r.rank,"."))),IX(2===s.rank||1===s.rank,(()=>"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(s.rank,"."))),IX(2===l.rank||1===l.rank,(()=>"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,"."))),null!=c&&IX(2===c.rank||1===c.rank,(()=>"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(c.rank,"."))),null!=g&&IX(2===g.rank||1===g.rank,(()=>"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(g.rank,"."))),xL(r,s,l,g,c,i)}});const ZL=xJ({batchNorm3d_:function(e,t,n,a,o,i){const r=AJ(e,"x","batchNorm"),s=AJ(t,"mean","batchNorm"),l=AJ(n,"variance","batchNorm");let c,g;return null!=o&&(c=AJ(o,"scale","batchNorm")),null!=a&&(g=AJ(a,"offset","batchNorm")),IX(3===r.rank,(()=>"Error in batchNorm3D: x must be rank 3 but got rank ".concat(r.rank,"."))),IX(3===s.rank||1===s.rank,(()=>"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(s.rank,"."))),IX(3===l.rank||1===l.rank,(()=>"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,"."))),null!=c&&IX(3===c.rank||1===c.rank,(()=>"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(c.rank,"."))),null!=g&&IX(3===g.rank||1===g.rank,(()=>"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(g.rank,"."))),xL(r,s,l,g,c,i)}});const wL=xJ({batchNorm4d_:function(e,t,n,a,o,i){const r=AJ(e,"x","batchNorm"),s=AJ(t,"mean","batchNorm"),l=AJ(n,"variance","batchNorm");let c,g;return null!=o&&(c=AJ(o,"scale","batchNorm")),null!=a&&(g=AJ(a,"offset","batchNorm")),IX(4===r.rank,(()=>"Error in batchNorm4D: x must be rank 4 but got rank ".concat(r.rank,"."))),IX(4===s.rank||1===s.rank,(()=>"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(s.rank,"."))),IX(4===l.rank||1===l.rank,(()=>"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,"."))),null!=c&&IX(4===c.rank||1===c.rank,(()=>"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(c.rank,"."))),null!=g&&IX(4===g.rank||1===g.rank,(()=>"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(g.rank,"."))),xL(r,s,l,g,c,i)}});const kL=xJ({bincount_:function(e,t,n){const a=AJ(e,"x","bincount"),o=AJ(t,"weights","bincount");IX("int32"===a.dtype,(()=>"Error in bincount: input dtype must be int32, but got ".concat(a.dtype))),IX(n>=0,(()=>"size must be non-negative, but got ".concat(n,"."))),IX(o.size===a.size||0===o.size,(()=>"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(a.shape,", weights shape: ").concat(o.shape,".")));const i={x:a,weights:o},r={size:n};return uJ.runKernel(wM,i,r)}});const BL=xJ({broadcastTo_:function(e,t){let n=AJ(e,"broadcastTo","x");const a=n.shape;if(_X(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=pL(n,e)}const o=n.shape,i=Array.from(t);for(let l=t.length-1;l>=0;l--)if(o[l]===t[l])i[l]=1;else if(1!==n.shape[l])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(t,"]."));if(0===i.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0)).length)return MY(n);const r={x:n},s={reps:i};return uJ.runKernel(rF,r,s)}});const RL=xJ({ceil_:function(e){const t={x:AJ(e,"x","ceil","float32")};return uJ.runKernel(VM,t)}});function WL(e,t,n){_X(e);const a={shape:e,value:t,dtype:n=n||HX(t)};return uJ.runKernel(pT,{},a)}const VL=xJ({clipByValue_:function(e,t,n){const a=AJ(e,"x","clipByValue");if(IX(t<=n,(()=>"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,")."))),t===n)return WL(a.shape,t,a.dtype);const o={x:a},i={clipValueMin:t,clipValueMax:n};return uJ.runKernel(NM,o,i)}});const NL=xJ({concat1d_:function(e){return CL(e,0)}});const XL=xJ({concat2d_:function(e,t){return CL(e,t)}});const ML=xJ({concat3d_:function(e,t){return CL(e,t)}});const TL=xJ({concat4d_:function(e,t){return CL(e,t)}});const EL=xJ({conv2d_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],r=arguments.length>6?arguments[6]:void 0;const s=AJ(e,"x","conv2d","float32"),l=AJ(t,"filter","conv2d","float32");let c=s,g=!1;3===s.rank&&(g=!0,c=pL(s,[1,s.shape[0],s.shape[1],s.shape[2]])),IX(4===c.rank,(()=>"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,"."))),IX(4===l.rank,(()=>"Error in conv2d: filter must be rank 4, but got rank ".concat(l.rank,"."))),hL("conv2d",a,r);const u="NHWC"===o?c.shape[3]:c.shape[1];IX(u===l.shape[2],(()=>"Error in conv2d: depth of input (".concat(u,") must match input depth for filter ").concat(l.shape[2],"."))),IX(gL(n,i),(()=>"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'"))),IX(uL(i),(()=>"Error in conv2D: Dilated rates should be larger than 0.")),IX(uL(n),(()=>"Error in conv2D: Strides should be larger than 0."));const d={x:c,filter:l},h={strides:n,pad:a,dataFormat:o,dilations:i,dimRoundingMode:r},p=uJ.runKernel(EM,d,h);return g?pL(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const FL=xJ({conv1d_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6?arguments[6]:void 0;const s=AJ(e,"x","conv1d"),l=AJ(t,"filter","conv1d");let c=s,g=!1;2===s.rank&&(g=!0,c=pL(s,[1,s.shape[0],s.shape[1]])),IX(3===c.rank,(()=>"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,"."))),IX(3===l.rank,(()=>"Error in conv1d: filter must be rank 3, but got rank ".concat(l.rank,"."))),hL("conv1d",a,r),IX(c.shape[2]===l.shape[1],(()=>"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(l.shape[1],"."))),IX(gL(n,i),(()=>"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'"))),IX(uL(i),(()=>"Error in conv1D: Dilated rates should be larger than 0.")),IX(uL(n),(()=>"Error in conv1D: Stride should be larger than 0.")),IX("NWC"===o,(()=>"Error in conv1d: got dataFormat of ".concat(o," but only NWC is currently supported.")));const u=pL(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=pL(c,[c.shape[0],1,c.shape[1],c.shape[2]]),h=EL(d,u,[1,n],a,"NHWC",[1,i],r);return pL(h,g?[h.shape[2],h.shape[3]]:[h.shape[0],h.shape[2],h.shape[3]])}});const HL=xJ({conv2DBackpropInput_:function(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",r=arguments.length>6?arguments[6]:void 0;IX(e.length===t.rank,(()=>"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")));let s=e,l=t,c=!1;3===t.rank&&(c=!0,l=pL(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),IX(4===s.length,(()=>"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,"."))),IX(4===l.rank,(()=>"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(l.rank))),IX(4===n.rank,(()=>"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)));const g="NHWC"===i?s[3]:s[1],u="NHWC"===i?l.shape[3]:l.shape[1];IX(g===n.shape[2],(()=>"Error in conv2dDerInput: depth of input (".concat(g,") must match input depth for filter ").concat(n.shape[2],"."))),IX(u===n.shape[3],(()=>"Error in conv2dDerInput: depth of output (".concat(u,") must match output depth for filter ").concat(n.shape[3],"."))),hL("conv2dDerInput",o,r);const d={dy:l,filter:n},h={strides:a,pad:o,dataFormat:i,dimRoundingMode:r,inputShape:s},p=uJ.runKernel(HM,d,h);return c?pL(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const JL=xJ({conv2dTranspose_:function(e,t,n,a,o,i){const r=AJ(e,"x","conv2dTranspose"),s=AJ(t,"filter","conv2dTranspose");return HL(n,r,s,a,o,"NHWC",i)}});const YL=xJ({conv3d_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1];const r=AJ(e,"x","conv3d"),s=AJ(t,"filter","conv3d");let l=r,c=!1;4===r.rank&&(c=!0,l=pL(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),IX(5===l.rank,(()=>"Error in conv3d: input must be rank 5, but got rank ".concat(l.rank,"."))),IX(5===s.rank,(()=>"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,"."))),IX(l.shape[4]===s.shape[3],(()=>"Error in conv3d: depth of input (".concat(l.shape[4],") must match input depth for filter ").concat(s.shape[3],"."))),IX(gL(n,i),(()=>"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'"))),IX("NDHWC"===o,(()=>"Error in conv3d: got dataFormat of ".concat(o," but only NDHWC is currently supported."))),IX(uL(i),(()=>"Error in conv3D: Dilated rates should be larger than 0.")),IX(uL(n),(()=>"Error in conv3D: Strides should be larger than 0."));const g={x:l,filter:s},u={strides:n,pad:a,dataFormat:o,dilations:i},d=uJ.runKernel(JM,g,u);return c?pL(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const LL=xJ({conv3DBackpropInput_:function(e,t,n,a,o){IX(e.length===t.rank,(()=>"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")));let i=e,r=t,s=!1;4===t.rank&&(s=!0,r=pL(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);const l=i[4],c=r.shape[4];IX(5===i.length,(()=>"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,"."))),IX(5===r.rank,(()=>"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(r.rank))),IX(5===n.rank,(()=>"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank))),IX(l===n.shape[3],(()=>"Error in conv3dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[3],"."))),IX(c===n.shape[4],(()=>"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")));const g={dy:r,filter:n},u={pad:o,strides:a,inputShape:i},d=uJ.runKernel(LM,g,u);return s?pL(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const zL=xJ({conv3dTranspose_:function(e,t,n,a,o){const i=AJ(e,"x","conv3dTranspose"),r=AJ(t,"filter","conv3dTranspose");return LL(n,i,r,a,o)}});const KL=xJ({cos_:function(e){const t={x:AJ(e,"x","cos","float32")};return uJ.runKernel(zM,t)}});const DL=xJ({cosh_:function(e){const t={x:AJ(e,"x","cosh","float32")};return uJ.runKernel(KM,t)}});const UL=xJ({cumprod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o={x:AJ(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:a};return uJ.runKernel(DM,o,i)}});const PL=xJ({cumsum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o={x:AJ(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:a};return uJ.runKernel(UM,o,i)}});const OL=xJ({denseBincount_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=AJ(e,"x","denseBincount"),i=AJ(t,"weights","denseBincount");IX("int32"===o.dtype,(()=>"Error in denseBincount: input dtype must be int32, but got ".concat(o.dtype))),IX(o.rank<=2,(()=>"Error in denseBincount: input must be at most rank 2, but got rank ".concat(o.rank,"."))),IX(n>=0,(()=>"size must be non-negative, but got ".concat(n,"."))),IX(i.size===o.size||0===i.size,(()=>"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(o.shape,", weights shape: ").concat(i.shape,".")));const r={x:o,weights:i},s={size:n,binaryOutput:a};return uJ.runKernel(OM,r,s)}});const _L=xJ({depthToSpace_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC";const a=AJ(e,"x","depthToSpace","float32"),o="NHWC"===n?a.shape[1]:a.shape[2],i="NHWC"===n?a.shape[2]:a.shape[3],r="NHWC"===n?a.shape[3]:a.shape[1];IX(t>1,(()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(t))),IX(o*t>=0,(()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(o," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(a.shape))),IX(i*t>=0,(()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(a.shape))),IX(r%(t*t)===0,(()=>"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(r," for depthToSpace with input shape ").concat(a.shape)));const s={x:a},l={blockSize:t,dataFormat:n};return uJ.runKernel(_M,s,l)}});const QL=xJ({depthwiseConv2d_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],r=arguments.length>6?arguments[6]:void 0;const s=AJ(e,"x","depthwiseConv2d","float32"),l=AJ(t,"filter","depthwiseConv2d","float32");let c=s,g=!1;3===s.rank&&(g=!0,c=pL(s,[1,s.shape[0],s.shape[1],s.shape[2]])),IX(4===c.rank,(()=>"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,"."))),IX(4===l.rank,(()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(l.rank,".")));const u="NHWC"===o?c.shape[3]:c.shape[1];IX(u===l.shape[2],(()=>"Error in depthwiseConv2d: number of input channels (".concat(u,") must match the inChannels dimension in filter ").concat(l.shape[2],"."))),hL("depthwiseConv2d",a,r);const d={x:c,filter:l},h={strides:n,pad:a,dataFormat:o,dilations:i,dimRoundingMode:r},p=uJ.runKernel(QM,d,h);return g?pL(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const jL=xJ({dilation2d_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC";const r=AJ(e,"x","dilation2d"),s=AJ(t,"filter","dilation2d");IX(3===r.rank||4===r.rank,(()=>"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(r.rank,"."))),IX(3===s.rank,(()=>"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,"."))),IX("NHWC"===i,(()=>"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)));let l=r,c=!1;3===r.rank&&(l=pL(r,[1,r.shape[0],r.shape[1],r.shape[2]]),c=!0),IX(l.shape[3]===s.shape[2],(()=>"Error in dilation2d:  input and filter must have the same depth: ".concat(l.shape[3]," vs ").concat(s.shape[2])));const g={x:l,filter:s},u={strides:n,pad:a,dilations:o},d=uJ.runKernel(eT,g,u);return c?pL(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});function qL(e,t){const n=e.length,a=[];for(let o=0;o<n;o++){const i=n-1-o,r=e[i]||1;(t[t.length-1-o]||1)>1&&1===r&&a.unshift(i)}return a}function $L(e,t){const n=[];for(let a=0;a<t.length;a++){const o=e[e.length-a-1],i=t.length-a-1,r=t[i];(null==o||1===o&&r>1)&&n.unshift(i)}return n}function ez(e,t){const n=Math.max(e.length,t.length),a=new Array(n);for(let o=0;o<n;o++){let i=e[e.length-o-1];null==i&&(i=1);let r=t[t.length-o-1];if(null==r&&(r=1),1===i)a[n-o-1]=r;else if(1===r)a[n-o-1]=i;else{if(i!==r){const n="Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,".");throw Error(n)}a[n-o-1]=i}}return a}const tz=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:ez,getBroadcastDims:qL,getReductionAxes:$L},Symbol.toStringTag,{value:"Module"}));const nz=xJ({equal_:function(e,t){let n=AJ(e,"a","equal","string_or_numeric"),a=AJ(t,"b","equal","string_or_numeric");[n,a]=tJ(n,a),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(cT,o)}});const az=xJ({where_:function(e,t,n){const a=AJ(t,"a","where"),o=AJ(n,"b","where"),i=AJ(e,"condition","where","bool"),r=ez(ez(i.shape,a.shape),o.shape),s={condition:BL(i,r),t:BL(a,r),e:BL(o,r)};return uJ.runKernel(VE,s)}});const oz=xJ({zerosLike_:function(e){const t={x:AJ(e,"x","zerosLike")};return uJ.runKernel(hF,t)}});const iz=xJ({divNoNan_:function(e,t){let n=AJ(e,"a","div"),a=AJ(t,"b","div");[n,a]=tJ(n,a);const o=HY(n,a),i=oz(o),r=nz(a,i);return az(r,i,o)}});const rz=xJ({dot_:function(e,t){const n=AJ(e,"t1","dot"),a=AJ(t,"t2","dot");IX((1===n.rank||2===n.rank)&&(1===a.rank||2===a.rank),(()=>"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(a.rank,".")));const o=1===n.rank?n.size:n.shape[1],i=1===a.rank?a.size:a.shape[0];if(IX(o===i,(()=>"Error in dot: inner dimensions of inputs must match, but got ".concat(o," and ").concat(i,"."))),1===n.rank&&1===a.rank){const e=pL(n,[1,-1]),t=pL(a,[-1,1]),o=fL(e,t);return pL(o,[])}if(1===n.rank&&2===a.rank){const e=pL(n,[1,-1]),t=pL(a,[a.shape[0],a.shape[1]]),o=fL(e,t);return pL(o,[o.size])}if(2===n.rank&&1===a.rank){const e=pL(a,[-1,1]),t=fL(n,e);return pL(t,[t.size])}{const e=pL(a,[a.shape[0],a.shape[1]]);return fL(n,e)}}});const sz=xJ({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];const o=n.map(((e,t)=>AJ(e,"tensors".concat(t),"einsum"))),i={equation:e};return uJ.runKernel(iT,o,i)}});const lz=xJ({elu_:function(e){const t={x:AJ(e,"x","elu","float32")};return uJ.runKernel(rT,t)}});const cz=xJ({erf_:function(e){let t=AJ(e,"x","erf");IX("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=XY(t,"float32"));const n={x:t};return uJ.runKernel(lT,n)}});function gz(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function uz(e,t,n){const a=e.length+t.length,o=[];let i=0,r=0;for(let s=0;s<a;s++)-1===n.indexOf(s)?o.push(e[i++]):o.push(t[r++]);return o}function dz(e,t){const n=[],a=e.length;for(let o=0;o<a;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map((t=>e[t]))]}function hz(e,t){return uz(e,t.map((e=>1)),t)}function pz(e,t,n){IX(gz(t,n),(()=>"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")))}function mz(e,t){if(gz(e,t))return null;const n=[];for(let a=0;a<t;++a)-1===e.indexOf(a)&&n.push(a);return e.forEach((e=>n.push(e))),n}function Iz(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))}function Cz(e,t){const n=[];for(let a=t-e;a<t;++a)n.push(a);return n}const fz=xJ({max_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={x:AJ(e,"x","max")},o={reductionIndices:t,keepDims:n};return uJ.runKernel(YT,a,o)}});const bz=xJ({min_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={x:AJ(e,"x","min")},o={axis:t,keepDims:n};return uJ.runKernel(_T,a,o)}});const yz=xJ({pow_:function(e,t){let n=AJ(e,"base","pow"),a=AJ(t,"exp","pow");[n,a]=tJ(n,a);const o={a:n,b:a};return uJ.runKernel(gE,o)}});function Az(e,t){if((xH(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&xH(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ZJ(e,[],[],t)}const vz=xJ({sqrt_:function(e){const t={x:AJ(e,"x","sqrt","float32")};return uJ.runKernel(JE,t)}});const Sz=xJ({square_:function(e){const t=AJ(e,"x","square");return uJ.runKernel("Square",{x:t},{})}});const xz=xJ({sum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=AJ(e,"x","sum");"bool"===a.dtype&&(a=XY(a,"int32"));const o={x:a},i={axis:t,keepDims:n};return uJ.runKernel(YE,o,i)}});function Gz(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return YY(e);if(1!==e.rank&&null===n)return Gz(pL(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return xz(YY(e),n);if(t===1/0)return fz(YY(e),n);if(t===-1/0)return bz(YY(e),n);if("euclidean"===t||2===t)return vz(xz(yz(YY(e),Az(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return fz(xz(YY(e),n[0]),n[1]-1);if(t===1/0)return fz(xz(YY(e),n[1]),n[0]);if(t===-1/0)return bz(xz(YY(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return vz(xz(Sz(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}const Zz=xJ({norm_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=Gz(e=AJ(e,"x","norm"),t,n);let i=o.shape;if(a){const t=wX(n,e.shape);i=hz(o.shape,t)}return pL(o,i)}});const wz=xJ({euclideanNorm_:function(e){return Zz(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});const kz=xJ({exp_:function(e){const t={x:AJ(e,"x","exp")};return uJ.runKernel(gT,t)}});const Bz=xJ({expandDims_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=AJ(e,"x","expandDims","string_or_numeric");IX(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));const a={input:n},o={dim:t};return uJ.runKernel(uT,a,o)}});const Rz=xJ({expm1_:function(e){const t={x:AJ(e,"x","expm1")};return uJ.runKernel(dT,t)}});const Wz=xJ({tile_:function(e,t){const n=AJ(e,"x","tile","string_or_numeric");IX(n.rank===t.length,(()=>"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")));const a={x:n},o={reps:t};return uJ.runKernel(rF,a,o)}});const Vz=xJ({eye_:function(e,t,n){null==t&&(t=e);const a=NY([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),o=e<=t?e:t;for(let r=0;r<o;++r)a.set(1,r,r);const i=pL(a.toTensor(),[e,t]);if(null==n)return i;if(1===n.length)return Wz(Bz(i,0),[n[0],1,1]);if(2===n.length)return Wz(Bz(Bz(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return Wz(Bz(Bz(Bz(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});const Nz=xJ({floor_:function(e){const t={x:AJ(e,"x","floor","float32")};return uJ.runKernel(IT,t)}});const Xz=xJ({gather_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o={x:AJ(e,"x","gather"),indices:AJ(t,"indices","gather","int32")},i={axis:n,batchDims:a};return uJ.runKernel(bT,o,i)}});const Mz=xJ({greater_:function(e,t){let n=AJ(e,"a","greater","string_or_numeric"),a=AJ(t,"b","greater","string_or_numeric");[n,a]=tJ(n,a),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(AT,o)}});const Tz=xJ({greaterEqual_:function(e,t){let n=AJ(e,"a","greaterEqual","string_or_numeric"),a=AJ(t,"b","greaterEqual","string_or_numeric");[n,a]=tJ(n,a),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(vT,o)}});const Ez=xJ({imag_:function(e){const t={input:AJ(e,"input","imag")};return uJ.runKernel(GT,t)}});const Fz=xJ({isFinite_:function(e){const t={x:AJ(e,"x","isFinite")};return uJ.runKernel(ZT,t)}});const Hz=xJ({isInf_:function(e){const t={x:AJ(e,"x","isInf")};return uJ.runKernel(wT,t)}});const Jz=xJ({isNaN_:function(e){const t={x:AJ(e,"x","isNaN")};return uJ.runKernel(kT,t)}});const Yz=xJ({leakyRelu_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;const n={x:AJ(e,"x","leakyRelu")},a={alpha:t};return uJ.runKernel(BT,n,a)}});const Lz=xJ({less_:function(e,t){let n=AJ(e,"a","less","string_or_numeric"),a=AJ(t,"b","less","string_or_numeric");[n,a]=tJ(n,a),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(RT,o)}});const zz=xJ({lessEqual_:function(e,t){let n=AJ(e,"a","lessEqual","string_or_numeric"),a=AJ(t,"b","lessEqual","string_or_numeric");[n,a]=tJ(n,a),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(WT,o)}});const Kz=xJ({localResponseNormalization_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const i=AJ(e,"x","localResponseNormalization");IX(4===i.rank||3===i.rank,(()=>"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,"."))),IX(vX(t),(()=>"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")));let r=i,s=!1;3===i.rank&&(s=!0,r=pL(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:r},c={depthRadius:t,bias:n,alpha:a,beta:o},g=uJ.runKernel(HT,l,c);return s?pL(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});const Dz=xJ({log_:function(e){const t={x:AJ(e,"x","log","float32")};return uJ.runKernel(NT,t)}});const Uz=xJ({log1p_:function(e){const t={x:AJ(e,"x","log1p")};return uJ.runKernel(XT,t)}});function Pz(e,t){IX(JX(e),(()=>"The f passed in variableGrads(f) must be a function")),IX(null==t||Array.isArray(t)&&t.every((e=>e instanceof zH)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=t;if(!n){t=[];for(const e in uJ.registeredVariables)t.push(uJ.registeredVariables[e])}const a=n?t.filter((e=>!e.trainable)):null,o=t.length;t=t.filter((e=>e.trainable)),IX(t.length>0,(()=>"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(o," variables is trainable.")));const{value:i,grads:r}=uJ.gradients(e,t,null,!0);IX(r.some((e=>null!=e)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),IX(0===i.rank,(()=>"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(i.rank," tensor")));const s={};return t.forEach(((e,t)=>{null!=r[t]&&(s[e.name]=r[t])})),null!=a&&a.forEach((e=>s[e.name]=null)),{value:i,grads:s}}function Oz(e){return uJ.customGrad(e)}function _z(e){if(e.filter((e=>null==e)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}const Qz=xJ({neg_:function(e){const t={x:AJ(e,"x","neg")};return uJ.runKernel(tE,t)}});const jz=xJ({softplus_:function(e){const t={x:AJ(e,"x","softplus")};return uJ.runKernel(HE,t)}});const qz=xJ({logSigmoid_:function(e){const t=AJ(e,"x","logSigmoid");return Oz((e=>({value:Qz(jz(Qz(e))),gradFunc:t=>JY(t,bL(Qz(e)))})))(t)}});const $z=xJ({sub_:function(e,t){let n=AJ(e,"a","sub"),a=AJ(t,"b","sub");[n,a]=tJ(n,a);const o={a:n,b:a};return uJ.runKernel(aF,o)}});const eK=xJ({logSoftmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=AJ(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return Oz(((e,n)=>{const a=fz(e,t,!0),o=$z(e,a),i=$z(XY(o,"float32"),Dz(xz(kz(o),t,!0)));return n([i]),{value:i,gradFunc:(e,n)=>{const[a]=n,o=kz(a);return $z(e,JY(xz(e,t,!0),o))}}}))(n)}});const tK=xJ({logSumExp_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=AJ(e,"x","logSumExp"),o=wX(t,a.shape),i=fz(a,o,!0),r=$z(a,i),s=kz(r),l=xz(s,o),c=Dz(l),g=EY(pL(i,c.shape),c);if(n){const e=hz(g.shape,o);return pL(g,e)}return g}});const nK=xJ({logicalAnd_:function(e,t){const n=AJ(e,"a","logicalAnd","bool"),a=AJ(t,"b","logicalAnd","bool");ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(MT,o)}});const aK=xJ({logicalNot_:function(e){const t={x:AJ(e,"x","logicalNot","bool")};return uJ.runKernel(TT,t)}});const oK=xJ({logicalOr_:function(e,t){const n=AJ(e,"a","logicalOr","bool"),a=AJ(t,"b","logicalOr","bool");ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(ET,o)}});const iK=xJ({logicalXor_:function(e,t){const n=AJ(e,"a","logicalXor","bool"),a=AJ(t,"b","logicalXor","bool");return ez(n.shape,a.shape),nK(oK(e,t),aK(nK(e,t)))}});const rK=xJ({maxPool_:function(e,t,n,a,o){const i=AJ(e,"x","maxPool");let r=i,s=!1;3===i.rank&&(s=!0,r=pL(i,[1,i.shape[0],i.shape[1],i.shape[2]])),IX(4===r.rank,(()=>"Error in maxPool: input must be rank 4 but got rank ".concat(r.rank,"."))),IX(gL(n,1),(()=>"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'"))),hL("maxPool",a,o);const l={x:r},c={filterSize:t,strides:n,pad:a,dimRoundingMode:o},g=uJ.runKernel(zT,l,c);return s?pL(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});const sK=xJ({maxPool3d_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const r=AJ(e,"x","maxPool3d");let s=r,l=!1;4===r.rank&&(l=!0,s=pL(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),IX(5===s.rank,(()=>"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,"."))),IX("NDHWC"===i,(()=>"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i))),hL("maxPool3d",a,o);const c={x:s},g={filterSize:t,strides:n,pad:a,dimRoundingMode:o,dataFormat:i},u=uJ.runKernel(DT,c,g);return l?pL(u,[u.shape[1],u.shape[2],u.shape[3],u.shape[4]]):u}});const lK=xJ({maximum_:function(e,t){let n=AJ(e,"a","maximum"),a=AJ(t,"b","maximum");[n,a]=tJ(n,a),"bool"===n.dtype&&(n=XY(n,"int32"),a=XY(a,"int32")),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(LT,o)}});const cK=xJ({mean_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={x:AJ(e,"x","mean")},o={axis:t,keepDims:n};return uJ.runKernel(OT,a,o)}});function gK(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(_X(e),"complex64"===t){const t=gK(e,"float32"),n=gK(e,"float32");return GJ(t,n)}const n=PX(bX(e),t);return uJ.makeTensor(n,e,t)}function uK(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(_X(e),"complex64"===t){const t=uK(e,"float32"),n=gK(e,"float32");return GJ(t,n)}const n=UX(bX(e),t);return uJ.makeTensor(n,e,t)}const dK=xJ({minimum_:function(e,t){let n=AJ(e,"a","minimum"),a=AJ(t,"b","minimum");[n,a]=tJ(n,a),"bool"===n.dtype&&(n=XY(n,"int32"),a=XY(a,"int32")),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(QT,o)}});const hK=xJ({mirrorPad_:function(e,t,n){IX("reflect"===n||"symmetric"===n,(()=>"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")));const a=AJ(e,"x","mirrorPad");if(0===a.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");IX(t.length===a.rank,(()=>"Padding doesn't match input. Must be ".concat(a.rank,". Got ").concat(t.length,".")));const o="reflect"===n?1:0;for(let s=0;s<a.rank;s++)IX(2===t[s].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),IX(t[s][0]>=0&&t[s][0]<=a.shape[s]-o&&t[s][1]>=0&&t[s][1]<=a.shape[s]-o,(()=>"Padding in dimension ".concat(s," cannot be greater than or equal to ").concat(a.shape[s]-o," or less than 0 for input of shape ").concat(a.shape)));const i={paddings:t,mode:n},r={x:a};return uJ.runKernel(jT,r,i)}});const pK=xJ({mod_:function(e,t){let n=AJ(e,"a","mod"),a=AJ(t,"b","mod");[n,a]=tJ(n,a);const o={a:n,b:a};return uJ.runKernel(qT,o)}});const mK=xJ({moments_:function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=wX(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=AJ(e,"x","moments")).shape),a=cK(e,n,t);let o=a.shape;t||(o=hz(a.shape,n));const i=Sz($z(XY(e,"float32"),pL(a,o)));return{mean:a,variance:cK(i,n,t)}}});const IK=xJ({notEqual_:function(e,t){let n=AJ(e,"a","notEqual","string_or_numeric"),a=AJ(t,"b","notEqual","string_or_numeric");[n,a]=tJ(n,a),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(nE,o)}});const CK=xJ({oneHot_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));const i={indices:AJ(e,"indices","oneHot","int32")},r={dtype:o,depth:t,onValue:n,offValue:a};return uJ.runKernel(sE,i,r)}});const fK=xJ({onesLike_:function(e){const t={x:AJ(e,"x","onesLike")};return uJ.runKernel(rE,t)}});const bK=xJ({pad_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=AJ(e,"x","pad");if(0===a.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:t,constantValue:n},i={x:a};return uJ.runKernel(cE,i,o)}});const yK=xJ({spaceToBatchND_:function(e,t,n){const a=AJ(e,"x","spaceToBatchND");IX(a.rank>=1+t.length,(()=>"input rank ".concat(a.rank," should be > than [blockShape] ").concat(t.length))),IX(n.length===t.length,(()=>"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length))),IX(a.shape.reduce(((e,a,o)=>o>0&&o<=t.length?e&&(a+n[o-1][0]+n[o-1][1])%t[o-1]===0:e),!0),(()=>"input spatial dimensions ".concat(a.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())));const o={x:a},i={blockShape:t,paddings:n};return uJ.runKernel(LE,o,i)}});const AK=xJ({pool_:function(e,t,n,a,o,i,r){null==o&&(o=[1,1]),null==i&&(i=1),0===a&&(a="valid");const s=AJ(e,"x","maxPool");let l=s,c=!1;3===s.rank&&(c=!0,l=pL(s,[1,s.shape[0],s.shape[1],s.shape[2]])),IX(gL(i,o),(()=>"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(o,"'")));const g=eL(l.shape,t,i,o,a),u=[g.dilationHeight,g.dilationWidth];let d;d="same"===a?function(e,t){const n=e.map(((e,n)=>e+(e-1)*(t[n]-1))).map((e=>e-1)),a=n.map((e=>Math.floor(e/2))),o=n.map(((e,t)=>e-a[t]));return n.map(((e,t)=>[a[t],o[t]]))}([g.filterHeight,g.filterWidth],u):[[0,0],[0,0]];const h=1===u[0]&&1===u[1],[p,m]=function(e,t,n){const a=n.map((e=>e[0])),o=n.map((e=>e[1])),i=e.concat(a,o),r=t.map(((e,t)=>(e-i[t]%e)%e)),s=o.map(((e,t)=>e+r[t])),l=t.map(((e,t)=>[a[t],s[t]])),c=t.map(((e,t)=>[0,r[t]]));return[l,c]}([g.inHeight,g.inWidth],u,d),I=h?a:"valid",C=h?l:yK(l,u,p),f=("avg"===n?()=>mL(C,t,i,I,r):()=>rK(C,t,i,I,r))(),b=h?f:vL(f,u,m);return c?pL(b,[b.shape[1],b.shape[2],b.shape[3]]):b}});const vK=xJ({prelu_:function(e,t){const n={x:AJ(e,"x","prelu"),alpha:AJ(t,"alpha","prelu")};return uJ.runKernel(uE,n)}});const SK=xJ({prod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=AJ(e,"x","prod");"bool"===a.dtype&&(a=XY(a,"int32"));const o={x:a},i={axis:t,keepDims:n};return uJ.runKernel(dE,o,i)}});var xK={exports:{}};!function(e){!function(e,t,n){function a(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var a=.02519603282416938*(e+=t.charCodeAt(n));a-=e=a>>>0,e=(a*=e)>>>0,e+=4294967296*(a-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new a(e),i=t&&t.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,i&&("object"==typeof i&&o(i,n),r.state=function(){return o(n,{})}),r}t&&t.exports?t.exports=i:this.alea=i}(0,e)}(xK);var GK=xK.exports,ZK={exports:{}};!function(e){!function(e,t,n){function a(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var a=0;a<n.length+64;a++)t.x^=0|n.charCodeAt(a),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new a(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&o(i,n),r.state=function(){return o(n,{})}),r}t&&t.exports?t.exports=i:this.xor128=i}(0,e)}(ZK);var wK=ZK.exports,kK={exports:{}};!function(e){!function(e,t,n){function a(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var a=0;a<n.length+64;a++)t.x^=0|n.charCodeAt(a),a==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new a(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&o(i,n),r.state=function(){return o(n,{})}),r}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)}(kK);var BK=kK.exports,RK={exports:{}};!function(e){!function(e,t,n){function a(e){var t=this;t.next=function(){var e,n,a=t.x,o=t.i;return e=a[o],n=(e^=e>>>7)^e<<24,n^=(e=a[o+1&7])^e>>>10,n^=(e=a[o+3&7])^e>>>3,n^=(e=a[o+4&7])^e<<7,e=a[o+7&7],n^=(e^=e<<13)^e<<9,a[o]=n,t.i=o+1&7,n},function(e,t){var n,a=[];if(t===(0|t))a[0]=t;else for(t=""+t,n=0;n<t.length;++n)a[7&n]=a[7&n]<<15^t.charCodeAt(n)+a[n+1&7]<<13;for(;a.length<8;)a.push(0);for(n=0;n<8&&0===a[n];++n);for(8==n?a[7]=-1:a[n],e.x=a,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.x&&o(i,n),r.state=function(){return o(n,{})}),r}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)}(RK);var WK=RK.exports,VK={exports:{}};!function(e){!function(e,t,n){function a(e){var t=this;t.next=function(){var e,n,a=t.w,o=t.X,i=t.i;return t.w=a=a+1640531527|0,n=o[i+34&127],e=o[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[i]=n^e,t.i=i,n+(a^a>>>16)|0},function(e,t){var n,a,o,i,r,s=[],l=128;for(t===(0|t)?(a=t,t=null):(t+="\0",a=0,l=Math.max(l,t.length)),o=0,i=-32;i<l;++i)t&&(a^=t.charCodeAt((i+32)%t.length)),0===i&&(r=a),a^=a<<10,a^=a>>>15,a^=a<<4,a^=a>>>13,i>=0&&(r=r+1640531527|0,o=0==(n=s[127&i]^=a+r)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,i=512;i>0;--i)a=s[o+34&127],n=s[o=o+1&127],a^=a<<13,n^=n<<17,a^=a>>>15,n^=n>>>12,s[o]=a^n;e.w=r,e.X=s,e.i=o}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.X&&o(i,n),r.state=function(){return o(n,{})}),r}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)}(VK);var NK=VK.exports,XK={exports:{}};!function(e){!function(e,t,n){function a(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,a=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-a|0,a=a<<24^a>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-a|0,t.d=a<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var a=0;a<n.length+20;a++)t.b^=0|n.charCodeAt(a),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new a(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&o(i,n),r.state=function(){return o(n,{})}),r}t&&t.exports?t.exports=i:this.tychei=i}(0,e)}(XK);var MK=XK.exports,TK={exports:{}};const EK=VF(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));!function(e){!function(t,n,a){var o,i=256,r="random",s=a.pow(i,6),l=a.pow(2,52),c=2*l,g=i-1;function u(e,g,u){var C=[],f=m(p((g=1==g?{entropy:!0}:g||{}).entropy?[e,I(n)]:null!==e&&void 0!==e?e:function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(e)),I(e)}catch{var a=t.navigator,r=a&&a.plugins;return[+new Date,t,r,t.screen,I(n)]}}(),3),C),b=new d(C),y=function(){for(var e=b.g(6),t=s,n=0;e<l;)e=(e+n)*i,t*=i,n=b.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|b.g(4)},y.quick=function(){return b.g(4)/4294967296},y.double=y,m(I(b.S),n),(g.pass||u||function(e,t,n,o){return o&&(o.S&&h(o,b),e.state=function(){return h(b,{})}),n?(a[r]=e,t):e})(y,f,"global"in g?g.global:this==a,g.state)}function d(e){var t,n=e.length,a=this,o=0,r=a.i=a.j=0,s=a.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[r=g&r+e[o%n]+(t=s[o])],s[r]=t;(a.g=function(e){for(var t,n=0,o=a.i,r=a.j,s=a.S;e--;)t=s[o=g&o+1],n=n*i+s[g&(s[o]=s[r=g&r+t])+(s[r]=t)];return a.i=o,a.j=r,n})(i)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){var n,a=[],o=typeof e;if(t&&"object"==o)for(n in e)try{a.push(p(e[n],t-1))}catch{}return a.length?a:"string"==o?e:e+"\0"}function m(e,t){for(var n,a=e+"",o=0;o<a.length;)t[g&o]=g&(n^=19*t[g&o])+a.charCodeAt(o++);return I(t)}function I(e){return String.fromCharCode.apply(0,e)}if(m(a.random(),n),e.exports){e.exports=u;try{o=EK}catch{}}else a["seed"+r]=u}(typeof self<"u"?self:RF,[],Math)}(TK);var FK=GK,HK=wK,JK=BK,YK=WK,LK=NK,zK=MK,KK=TK.exports;KK.alea=FK,KK.xor128=HK,KK.xorwow=JK,KK.xorshift7=YK,KK.xor4096=LK,KK.tychei=zK;var DK=KK;class UK{constructor(e,t,n,a,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const i=o||Math.random();this.random=DK.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let a,o,i;do{a=2*this.random()-1,o=2*this.random()-1,i=a*a+o*o}while(i>=1||0===i);const r=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*a*r,t=this.mean+this.stdDev*o*r,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class PK{constructor(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;const o=a||Math.random();this.randu=DK.alea(o.toString()),this.randn=new UK(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,a,o,i;for(;;){do{a=this.randn.nextValue(),i=1+this.c*a}while(i<=0);if(i*=i*i,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-i+Math.log(i)),o=this.randu(),o<t||Math.log(o)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}class OK{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==a&&(a=Math.random()),"number"==typeof a&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=DK.alea(a)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const _K=xJ({randomNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(_X(e),null!=a&&"bool"===a)throw new Error("Unsupported data type ".concat(a));const i=new UK(t,n,a,!1,o),r=NY(e,a);for(let s=0;s<r.values.length;s++)r.values[s]=i.nextValue();return r.toTensor()}});const QK=xJ({randomUniform_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",o=arguments.length>4?arguments[4]:void 0;_X(e);const i=NY(e,a),r=new OK(t,n,null,o);for(let s=0;s<i.values.length;s++)i.values[s]=r.nextValue();return i.toTensor()}});function jK(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");const o={start:e,stop:t,step:n,dtype:a};return uJ.runKernel(IE,{},o)}const qK=xJ({real_:function(e){const t={input:AJ(e,"input","real")};return uJ.runKernel(CE,t)}});const $K=xJ({reciprocal_:function(e){const t={x:AJ(e,"x","reciprocal")};return uJ.runKernel(fE,t)}});const eD=xJ({relu_:function(e){const t={x:AJ(e,"x","relu")};return uJ.runKernel(bE,t)}});const tD=xJ({relu6_:function(e){const t={x:AJ(e,"x","relu6")};return uJ.runKernel(GE,t)}});const nD=xJ({reverse_:function(e,t){const n={x:AJ(e,"x","reverse")},a={dims:t};return uJ.runKernel(ZE,n,a)}});const aD=xJ({round_:function(e){const t={x:AJ(e,"x","round")};return uJ.runKernel(wE,t)}});const oD=xJ({rsqrt_:function(e){const t={x:AJ(e,"x","rsqrt","float32")};return uJ.runKernel(kE,t)}});const iD=xJ({selu_:function(e){const t={x:AJ(e,"x","selu")};return uJ.runKernel(NE,t)}});const rD=xJ({separableConv2d_:function(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC";const s=AJ(e,"x","separableConv2d"),l=AJ(t,"depthwiseFilter","separableConv2d"),c=AJ(n,"pointwiseFilter","separableConv2d");let g=s,u=!1;if(3===s.rank&&(u=!0,g=pL(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===r)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");IX(4===g.rank,(()=>"Error in separableConv2d: input must be rank 4, but got rank ".concat(g.rank,"."))),IX(4===l.rank,(()=>"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(l.rank,"."))),IX(4===c.rank,(()=>"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(l.rank,"."))),IX(1===c.shape[0],(()=>"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],"."))),IX(1===c.shape[1],(()=>"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")));const d=l.shape[2],h=l.shape[3];IX(c.shape[2]===d*h,(()=>"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(d*h,", but got ").concat(c.shape[2],".")));const p=QL(g,l,a,o,r,i),m=EL(p,c,1,"valid",r);return u?pL(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const sD=xJ({sign_:function(e){const t={x:AJ(e,"x","sign")};return uJ.runKernel(EE,t)}});const lD=xJ({sin_:function(e){const t={x:AJ(e,"x","sin","float32")};return uJ.runKernel(ME,t)}});const cD=xJ({sinh_:function(e){const t={x:AJ(e,"x","sinh")};return uJ.runKernel(TE,t)}});const gD=xJ({slice1d_:function(e,t,n){const a=AJ(e,"x","slice1d");return IX(1===a.rank,(()=>"slice1d expects a rank-1 tensor, but got a rank-".concat(a.rank," tensor"))),yL(a,[t],[n])}});const uD=xJ({slice2d_:function(e,t,n){const a=AJ(e,"x","slice2d");return IX(2===a.rank,(()=>"slice2d expects a rank-2 tensor, but got a rank-".concat(a.rank," tensor"))),yL(a,t,n)}});const dD=xJ({slice3d_:function(e,t,n){const a=AJ(e,"x","slice3d");return IX(3===a.rank,(()=>"slice3d expects a rank-3 tensor, but got a rank-".concat(a.rank," tensor"))),yL(a,t,n)}});const hD=xJ({slice4d_:function(e,t,n){const a=AJ(e,"x","slice4d");return IX(4===a.rank,(()=>"slice4d expects a rank-4 tensor, but got a rank-".concat(a.rank," tensor"))),yL(a,t,n)}});const pD=xJ({softmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=AJ(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));const a={logits:n},o={dim:t};return uJ.runKernel(KE,a,o)}});const mD=xJ({fft_:function(e){IX("complex64"===e.dtype,(()=>"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")));const t={input:e};return uJ.runKernel(hT,t)}});const ID=xJ({ifft_:function(e){IX("complex64"===e.dtype,(()=>"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")));const t={input:e};return uJ.runKernel(xT,t)}});const CD=xJ({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let a;if(t<=2){const o=pL(e,[n,t]);a=ID(o)}else{const o=[n,2*(t-1)],i=pL(qK(e),[n,t]),r=pL(Ez(e),[n,t]),s=nD(yL(i,[0,1],[n,t-2]),1),l=JY(nD(yL(r,[0,1],[n,t-2]),1),Az(-1)),c=CL([i,s],1),g=CL([r,l],1),u=pL(GJ(c,g),[o[0],o[1]]);a=ID(u)}if(a=qK(a),3===e.rank&&0!==e.shape[0]){const t=a,n=e.shape[0];a=pL(a,[n,a.shape[0]/n,a.shape[1]]),t.dispose()}return a}});const fD=xJ({split_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a={x:AJ(e,"x","split")},o={numOrSizeSplits:t,axis:n};return uJ.runKernel(zE,a,o)}});const bD=xJ({rfft_:function(e,t){IX("float32"===e.dtype,(()=>"The dtype for rfft() must be real value but got ".concat(e.dtype)));let n=e.shape[e.shape.length-1];const a=e.size/n;let o;if(null!=t&&t<n){const a=e.shape.map((e=>0)),i=e.shape.map((e=>e));i[e.shape.length-1]=t,o=yL(e,a,i),n=t}else if(null!=t&&t>n){const a=e.shape.map((e=>e));a[e.shape.length-1]=t-n,o=CL([e,gK(a)],e.shape.length-1),n=t}else o=e;const i=oz(o),r=pL(GJ(o,i),[a,n]),s=mD(r),l=Math.floor(n/2)+1,c=qK(s),g=Ez(s),u=fD(c,[l,n-l],c.shape.length-1),d=fD(g,[l,n-l],g.shape.length-1),h=o.shape.slice();return h[o.shape.length-1]=l,pL(GJ(u[0],d[0]),h)}});const yD=xJ({squaredDifference_:function(e,t){let n=AJ(e,"a","squaredDifference"),a=AJ(t,"b","squaredDifference");[n,a]=tJ(n,a),ez(n.shape,a.shape);const o={a:n,b:a};return uJ.runKernel(QE,o,{})}});const AD=xJ({squeeze_:function(e,t){const n=AJ(e,"x","squeeze","string_or_numeric");return pL(n,kX(n.shape,t).newShape)}});const vD=xJ({stack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=vJ(e,"tensors","stack","string_or_numeric");IX(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&IX(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const a=n,o={axis:t};return uJ.runKernel(lE,a,o)}});const SD=xJ({step_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:AJ(e,"x","step")},a={alpha:t};return uJ.runKernel(pF,n,a)}});const xD=xJ({stridedSlice_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const c={x:AJ(e,"x","stridedSlice","string_or_numeric")},g={begin:t,end:n,strides:a,beginMask:o,endMask:i,ellipsisMask:r,newAxisMask:s,shrinkAxisMask:l};return uJ.runKernel($E,c,g)}});const GD=xJ({tan_:function(e){const t={x:AJ(e,"x","tan","float32")};return uJ.runKernel(oF,t)}});function ZD(e,t){fX(e);const n=fJ(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ZJ(e,null,n,t)}function wD(e,t,n){if(fX(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const a=fJ(e,n);if(2!==a.length&&1!==a.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===a.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ZJ(e,t,a,n)}function kD(e,t,n){if(fX(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const a=fJ(e,n);if(3!==a.length&&1!==a.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===a.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ZJ(e,t,a,n)}function BD(e,t,n){const a=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(a,", and batchDim: ").concat(o,".");if(n.rank<o)throw new Error(i+" update.rank < ".concat(o,". "));if(e.length<a+(n.rank-o))throw new Error(i+" Output shape length < ".concat(a+(n.rank-o)));if(n.rank!==o+e.length-a)throw new Error(i+" update.rank != ".concat(o+e.length-a));for(let r=0;r<o;++r)if(n.shape[r]!==t.shape[r])throw new Error(i+" updates.shape[".concat(r,"] (").concat(n.shape[r],") != indices.shape[").concat(r,"] (").concat(t.shape[r],")."));for(let r=0;r<n.rank-o;++r)if(n.shape[r+o]!==e[r+a])throw new Error(i+" updates.shape[".concat(r+o,"] (").concat(n.shape[r+o],") != shape[").concat(r+o,"] (").concat(e[r+o],")"))}function RD(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}BD(n,t,e)}function WD(e,t,n){const a=t.shape.length,o=a>1?t.shape[a-1]:1,i=n.length;let r=1;for(let l=o;l<i;++l)r*=n[l];const s=o<1?1:o;return{sliceRank:o,numUpdates:bX(t.shape)/s,sliceSize:r,strides:[...LX(n.slice(0,o)),1],outputSize:bX(n)}}const VD=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:WD,validateInput:RD,validateUpdateShape:BD},Symbol.toStringTag,{value:"Module"}));const ND=xJ({topk_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=AJ(e,"x","topk");if(0===a.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const o=a.shape[a.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(o,") but got ").concat(t));const i={x:a},r={k:t,sorted:n},[s,l]=uJ.runKernel(sF,i,r);return{values:s,indices:l}}});const XD=xJ({truncatedNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(_X(e),null!=a&&"bool"===a)throw new Error("Unsupported data type $ { dtype }");const i=new UK(t,n,a,!0,o),r=NY(e,a);for(let s=0;s<r.values.length;s++)r.values[s]=i.nextValue();return r.toTensor()}});const MD=xJ({unique_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=AJ(e,"x","unique","string_or_numeric");IX(n.rank>0,(()=>"The input tensor must be at least 1D"));const a={x:n},o={axis:t},[i,r]=uJ.runKernel(gF,a,o);return{values:i,indices:r}}});const TD=xJ({unsortedSegmentSum_:function(e,t,n){const a=AJ(e,"x","unsortedSegmentSum"),o=AJ(t,"segmentIds","unsortedSegmentSum","int32");IX(vX(n),(()=>"numSegments must be of dtype int"));const i={x:a,segmentIds:o},r={numSegments:n};return uJ.runKernel(dF,i,r)}});const ED=xJ({unstack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=AJ(e,"x","unstack","string_or_numeric");IX(t>=-n.shape.length&&t<n.shape.length,(()=>"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")));const a={value:n},o={axis:t};return uJ.runKernel(uF,a,o)}});function FD(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return uJ.makeVariable(e,t,n,a)}function HD(e,t){const n=[];for(let i=0;i<t.length;i++)t[i]&&n.push(i);const a=NY(e,"int32"),o=NY([n.length,e.length],"int32");for(let i=0;i<n.length;i++){const t=a.indexToLoc(n[i]),r=i*e.length;o.values.set(t,r)}return o.toTensor()}const JD=xJ({transpose_:function(e,t,n){const a=AJ(e,"x","transpose");if(null==t&&(t=a.shape.map(((e,t)=>t)).reverse()),IX(a.rank===t.length,(()=>"Error in transpose: rank of input ".concat(a.rank," must match length of perm ").concat(t,"."))),t.forEach((e=>{IX(e>=0&&e<a.rank,(()=>"All entries in 'perm' must be between 0 and ".concat(a.rank-1," but got ").concat(t)))})),a.rank<=1)return a.clone();const o={x:a},i={perm:t};return"complex64"===a.dtype?VJ((()=>{let e=qK(a),t=Ez(a);return e=uJ.runKernel(cF,{x:e},i),t=uJ.runKernel(cF,{x:t},i),n&&(t=Qz(t)),GJ(e,t)})):uJ.runKernel(cF,o,i)}});const YD=xJ({dropout_:function(e,t,n,a){const o=AJ(e,"x","dropout");if(IX("float32"===o.dtype,(()=>"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(o.dtype," tensor instead."))),IX(t>=0&&t<1,(()=>"rate must be a float in the range [0, 1), but got ".concat(t,"."))),0===t)return e instanceof YH?o.clone():o;const i=function(e,t){if(null==t)return e.shape.slice();if(AX(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let a=0;a<e.shape.length;a++)null==t[a]&&null!=e.shape[a]?n.push(e.shape[a]):n.push(t[a]);return n}return t}(o,n),r=1-t,s=HY(Nz(EY(QK(i,0,1,"float32",a),r)),r);return JY(o,s)}});function LD(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function zD(e,t,n){const a=1-e%2,o=new Float32Array(e);for(let i=0;i<e;++i){const r=2*Math.PI*i/(e+a-1);o[i]=t-n*Math.cos(r)}return ZD(o,"float32")}const KD=xJ({conv2DBackpropFilter_:function(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",r=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=pL(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=pL(t,[1,t.shape[0],t.shape[1],t.shape[2]])),IX(4===s.rank,(()=>"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,"."))),IX(4===l.rank,(()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(l.shape,"."))),IX(4===n.length,(()=>"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")));const c="NHWC"===i?s.shape[3]:s.shape[1],g="NHWC"===i?l.shape[3]:l.shape[1];IX(c===n[2],(()=>"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],"."))),IX(g===n[3],(()=>"Error in conv2dDerFilter: depth of dy (".concat(g,") must match output depth for filter (").concat(n[3],")."))),hL("conv2dDerFilter",o,r);const u={x:s,dy:l},d={strides:a,pad:o,dataFormat:i,dimRoundingMode:r,filterShape:n};return uJ.runKernel(FM,u,d)}});function DD(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return JY(e,SD(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function UD(e,t){let n=t;const a=$L(e.shape,t.shape);return a.length>0&&(n=xz(n,a)),pL(n,e.shape)}function PD(e,t,n,a){if("linear"===t)return e;if("relu"===t)return eD(e);if("elu"===t)return lz(e);if("relu6"===t)return tD(e);if("prelu"===t)return vK(e,n);if("leakyrelu"===t)return Yz(e,a);if("sigmoid"===t)return bL(e);throw new Error("Unknown fused activation ".concat(t,"."))}const OD=(e,t)=>!(e>0)||"linear"===t;const _D=xJ({fusedConv2d_:function(e){let{x:t,filter:n,strides:a,pad:o,dataFormat:i="NHWC",dilations:r=[1,1],dimRoundingMode:s,bias:l,activation:c="linear",preluActivationWeights:g,leakyreluAlpha:u}=e;if(c=c||"linear",!1===OD(uJ.state.gradientDepth,c)){IX("NHWC"===i,(()=>"Error in fused conv2d: got dataFormat of ".concat(i," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")));let e=EL(t,n,a,o,i,r,s);return null!=l&&(e=EY(e,l)),PD(e,c,g,u)}const d=AJ(t,"x","conv2d","float32"),h=AJ(n,"filter","conv2d","float32");let p=d,m=!1;3===d.rank&&(m=!0,p=pL(d,[1,d.shape[0],d.shape[1],d.shape[2]])),IX(4===p.rank,(()=>"Error in fused conv2d: input must be rank 4, but got rank ".concat(p.rank,"."))),IX(4===h.rank,(()=>"Error in fused conv2d: filter must be rank 4, but got rank ".concat(h.rank,"."))),hL("fused conv2d",o,s);const I="NHWC"===i?p.shape[3]:p.shape[1];IX(h.shape[2]===I,(()=>"Error in conv2d: depth of input (".concat(I,") must match input depth for filter ").concat(h.shape[2],"."))),IX(gL(a,r),(()=>"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(r,"'")));const C=nL(p.shape,h.shape,a,r,o,s);let f,b;if(null!=l&&(f=AJ(l,"bias","fused conv2d"),[f]=tJ(f,d),"NHWC"===i?ez(C.outShape,f.shape):(IX(f.shape.length<=1,(()=>"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(f.shape.length,"."))),IX(0===f.shape.length||f.shape[0]===C.outChannels||1===f.shape[0],(()=>"Error in fused conv2d: bias shape (".concat(f.shape,") is not compatible with the number of output channels (").concat(C.outChannels,")"))))),null!=g){const e=g.shape;if(IX(e.length<=1||3===e.length,(()=>"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(e.length,"."))),1===e.length)IX(1===e[0]||e[0]===C.outChannels,(()=>"Error in fused conv2d: PReLU activation weights (".concat(e,") is not compatible with the number of output channels (").concat(C.outChannels,").")));else if(3===e.length)try{ez(e,C.outShape)}catch{const t="Error in fused conv2d: PReLU activation weights (".concat(e,") is not compatible with the output shape of the conv2d (").concat(C.outShape,").");throw Error(t)}b=AJ(g,"prelu weights","fused conv2d")}const y=(e,t)=>{IX("NHWC"===i,(()=>"Error in gradient of fused conv2D: got dataFormat of ".concat(i," but only NHWC is currently supported.")));const[n,s,l,g]=t,u=DD(e,l,c);IX(cL(r),(()=>"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")));const d=[HL(s.shape,u,n,a,o),KD(s,u,n.shape,a,o)];if(null!=g){const e=UD(g,u);d.push(e)}return d},A={x:p,filter:h,bias:f,preluActivationWeights:b},v={strides:a,pad:o,dataFormat:i,dilations:r,dimRoundingMode:s,activation:c,leakyreluAlpha:u};return null==l?Oz(((e,t,n)=>{let a=uJ.runKernel(fF,A,v);return n([t,e,a]),m&&(a=pL(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:y}}))(p,h):Oz(((e,t,n,a)=>{let o=uJ.runKernel(fF,A,v);return a([t,e,o,n]),m&&(o=pL(o,[o.shape[1],o.shape[2],o.shape[3]])),{value:o,gradFunc:y}}))(p,h,f)}});const QD=xJ({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],r=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=pL(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=pL(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={x:s,dy:l},g={strides:a,pad:o,dimRoundingMode:r,dilations:i,filterShape:n};return uJ.runKernel(jM,c,g)}});const jD=xJ({depthwiseConv2dNativeBackpropInput_:function(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],r=arguments.length>6?arguments[6]:void 0,s=t,l=!1;3===t.rank&&(l=!0,s=pL(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={dy:s,filter:n},g={strides:a,pad:o,dimRoundingMode:r,dilations:i,inputShape:e},u=uJ.runKernel(qM,c,g);return l?pL(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const qD=xJ({fusedMatMul_:function(e){let{a:t,b:n,transposeA:a=!1,transposeB:o=!1,bias:i,activation:r="linear",preluActivationWeights:s,leakyreluAlpha:l=.2}=e;if(!1===OD(uJ.state.gradientDepth,r)){let e=fL(t,n,a,o);return null!=i&&(e=EY(e,i)),PD(e,r,s,l)}let c=AJ(t,"a","fused matMul"),g=AJ(n,"b","fused matMul");[c,g]=tJ(c,g);const u=a?c.shape[c.rank-2]:c.shape[c.rank-1],d=o?g.shape[g.rank-1]:g.shape[g.rank-2],h=a?c.shape[c.rank-1]:c.shape[c.rank-2],p=o?g.shape[g.rank-2]:g.shape[g.rank-1],m=c.shape.slice(0,-2),I=g.shape.slice(0,-2),C=bX(m),f=bX(I);IX(u===d,(()=>"Error in fused matMul: inner shapes (".concat(u,") and (").concat(d,") of Tensors with shapes ").concat(c.shape," and ").concat(g.shape," and transposeA=").concat(a," and transposeB=").concat(o," must match.")));const b=ez(c.shape.slice(0,-2),g.shape.slice(0,-2)).concat([h,p]),y=pL(c,a?[C,u,h]:[C,h,u]),A=pL(g,o?[f,p,d]:[f,d,p]);let v,S;null!=i&&(v=AJ(i,"bias","fused matMul"),[v]=tJ(v,c),ez(b,v.shape)),null!=s&&(S=AJ(s,"prelu weights","fused matMul"));const x=(e,t)=>{const[n,s,l,c]=t,g=DD(pL(e,l.shape),l,r);let u,d;if(a||o?!a&&o?(u=fL(g,s,!1,!1),d=fL(g,n,!0,!1)):a&&!o?(u=fL(s,g,!1,!0),d=fL(n,g,!1,!1)):(u=fL(s,g,!0,!0),d=fL(g,n,!0,!0)):(u=fL(g,s,!1,!0),d=fL(n,g,!0,!1)),null!=i){return[u,d,UD(c,g)]}return[u,d]},G={a:y,b:A,bias:v,preluActivationWeights:S},Z={transposeA:a,transposeB:o,activation:r,leakyreluAlpha:l};return null==i?Oz(((e,t,n)=>{const a=uJ.runKernel(CF,G,Z);return n([e,t,a]),{value:pL(a,b),gradFunc:x}}))(y,A):Oz(((e,t,n,a)=>{const o=uJ.runKernel(CF,G,Z);return a([e,t,o,n]),{value:pL(o,b),gradFunc:x}}))(y,A,v)}});const $D=xJ({hammingWindow_:function(e){return zD(e,.54,.46)}});const eU=xJ({hannWindow_:function(e){return zD(e,.5,.5)}});const tU=xJ({frame_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0;const r=[];for(;i+t<=e.size;)r.push(yL(e,i,t)),i+=n;if(a)for(;i<e.size;){const a=i+t-e.size,s=CL([yL(e,i,t-a),WL([a],o)]);r.push(s),i+=n}return 0===r.length?wD([],[0,t]):pL(CL(r),[r.length,t])}});const nU=xJ({stft_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:eU;null==a&&(a=LD(t));const i=tU(e,t,n),r=JY(i,o(t));return bD(r,a)}});const aU=xJ({cropAndResize_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const r=AJ(e,"image","cropAndResize"),s=AJ(t,"boxes","cropAndResize","float32"),l=AJ(n,"boxInd","cropAndResize","int32"),c=s.shape[0];IX(4===r.rank,(()=>"Error in cropAndResize: image must be rank 4,but got rank ".concat(r.rank,"."))),IX(2===s.rank&&4===s.shape[1],(()=>"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,"."))),IX(1===l.rank&&l.shape[0]===c,(()=>"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,"."))),IX(2===a.length,(()=>"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(a.length,"."))),IX(a[0]>=1&&a[1]>=1,(()=>"cropSize must be atleast [1,1], but was ".concat(a))),IX("bilinear"===o||"nearest"===o,(()=>"method must be bilinear or nearest, but was ".concat(o)));const g={image:r,boxes:s,boxInd:l},u={method:o,extrapolationValue:i,cropSize:a};return uJ.runKernel(PM,g,u)}});const oU=xJ({flipLeftRight_:function(e){const t=AJ(e,"image","flipLeftRight","float32");IX(4===t.rank,(()=>"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")));const n={image:t};return uJ.runKernel(mT,n,{})}});const iU=xJ({grayscaleToRGB_:function(e){const t=AJ(e,"image","grayscaleToRGB"),n=t.rank-1,a=t.shape[n];IX(t.rank>=2,(()=>"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,"."))),IX(1===a,(()=>"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(a,".")));const o=new Array(t.rank);return o.fill(1,0,n),o[n]=3,Wz(t,o)}});const rU=xJ({rgbToGrayscale_:function(e){const t=AJ(e,"image","RGBToGrayscale"),n=t.rank-1,a=t.shape[n];IX(t.rank>=2,(()=>"Error in RGBToGrayscale: images must be at least rank 2, but got rank ".concat(t.rank,"."))),IX(3===a,(()=>"Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ".concat(a,".")));const o=t.dtype,i=XY(t,"float32"),r=ZD([.2989,.587,.114]);let s;switch(t.rank){case 2:s=sz("ij,j->i",i,r);break;case 3:s=sz("ijk,k->ij",i,r);break;case 4:s=sz("ijkl,l->ijk",i,r);break;case 5:s=sz("ijklm,m->ijkl",i,r);break;case 6:s=sz("ijklmn,n->ijklm",i,r);break;default:throw new Error("Not a valid tensor rank.")}return s=Bz(s,-1),XY(s,o)}});const sU=xJ({rotateWithOffset_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const o=AJ(e,"image","rotateWithOffset","float32");IX(4===o.rank,(()=>"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(o.rank,".")));const i={image:o},r={radians:t,fillValue:n,center:a};return uJ.runKernel(IF,i,r)}});function lU(e,t,n,a,o,i){null==a&&(a=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);const r=e.shape[0];return n=Math.min(n,r),IX(0<=a&&a<=1,(()=>"iouThreshold must be in [0, 1], but was '".concat(a,"'"))),IX(2===e.rank,(()=>"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'"))),IX(4===e.shape[1],(()=>"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1]))),IX(1===t.rank,(()=>"scores must be a 1D tensor")),IX(t.shape[0]===r,(()=>"scores has incompatible shape with boxes. Expected ".concat(r,", but was ").concat(t.shape[0]))),IX(0<=i&&i<=1,(()=>"softNmsSigma must be in [0, 1], but was '".concat(i,"'"))),{maxOutputSize:n,iouThreshold:a,scoreThreshold:o,softNmsSigma:i}}const cU=xJ({nonMaxSuppression_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=AJ(e,"boxes","nonMaxSuppression","float32"),r=AJ(t,"scores","nonMaxSuppression","float32"),s=lU(i,r,n,a,o);n=s.maxOutputSize,a=s.iouThreshold,o=s.scoreThreshold;const l={maxOutputSize:n,iouThreshold:a,scoreThreshold:o};return uJ.runKernel(aE,{boxes:i,scores:r},l)}});function gU(e,t,n){const a=function(e,t,n){return function(e,t,n){let a=0,o=e.length,i=0,r=!1;for(;a<o;){i=a+(o-a>>>1);const s=n(t,e[i]);s>0?a=i+1:(o=i,r=!s)}return r?a:-a-1}(e,t,n||uU)}(e,t,n),o=a<0?-(a+1):a;e.splice(o,0,t)}function uU(e,t){return e>t?1:e<t?-1:0}function dU(e,t,n,a,o){return mU(e,t,n,a,o,0)}function hU(e,t,n,a,o,i){return mU(e,t,n,a,o,0,!1,i,!0)}function pU(e,t,n,a,o,i){return mU(e,t,n,a,o,i,!0)}function mU(e,t,n,a,o,i){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const c=[];for(let I=0;I<t.length;I++)t[I]>o&&c.push({score:t[I],boxIndex:I,suppressBeginIndex:0});c.sort(fU);const g=i>0?-.5/i:0,u=[],d=[];for(;u.length<n&&c.length>0;){const t=c.pop(),{score:n,boxIndex:i,suppressBeginIndex:r}=t;if(n<o)break;let s=!1;for(let l=u.length-1;l>=r;--l){const n=IU(e,i,u[l]);if(n>=a){s=!0;break}if(t.score=t.score*CU(a,g,n),t.score<=o)break}t.suppressBeginIndex=u.length,s||(t.score===n?(u.push(i),d.push(t.score)):t.score>o&&gU(c,t,fU))}const h=u.length,p=n-h;s&&p>0&&(u.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const m={selectedIndices:u};return r&&(m.selectedScores=d),l&&(m.validOutputs=h),m}function IU(e,t,n){const a=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),i=Math.min(a[0],a[2]),r=Math.min(a[1],a[3]),s=Math.max(a[0],a[2]),l=Math.max(a[1],a[3]),c=Math.min(o[0],o[2]),g=Math.min(o[1],o[3]),u=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-i)*(l-r),p=(u-c)*(d-g);if(h<=0||p<=0)return 0;const m=Math.max(i,c),I=Math.max(r,g),C=Math.min(s,u),f=Math.min(l,d),b=Math.max(C-m,0)*Math.max(f-I,0);return b/(h+p-b)}function CU(e,t,n){const a=Math.exp(t*n*n);return n<=e?a:0}function fU(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const bU=async function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=AJ(e,"boxes","nonMaxSuppressionAsync"),r=AJ(t,"scores","nonMaxSuppressionAsync"),s=lU(i,r,n,a,o);n=s.maxOutputSize,a=s.iouThreshold,o=s.scoreThreshold;const l=await Promise.all([i.data(),r.data()]),c=l[0],g=l[1],{selectedIndices:u}=dU(c,g,n,a,o);return i!==e&&i.dispose(),r!==t&&r.dispose(),ZD(u,"int32")};const yU=xJ({nonMaxSuppressionWithScore_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const r=AJ(e,"boxes","nonMaxSuppression"),s=AJ(t,"scores","nonMaxSuppression"),l=lU(r,s,n,a,o,i);n=l.maxOutputSize,a=l.iouThreshold,o=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:r,scores:s},g={maxOutputSize:n,iouThreshold:a,scoreThreshold:o,softNmsSigma:i},u=uJ.runKernel(iE,c,g);return{selectedIndices:u[0],selectedScores:u[1]}}});const AU=async function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const r=AJ(e,"boxes","nonMaxSuppressionAsync"),s=AJ(t,"scores","nonMaxSuppressionAsync"),l=lU(r,s,n,a,o,i);n=l.maxOutputSize,a=l.iouThreshold,o=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([r.data(),s.data()]),g=c[0],u=c[1],{selectedIndices:d,selectedScores:h}=pU(g,u,n,a,o,i);return r!==e&&r.dispose(),s!==t&&s.dispose(),{selectedIndices:ZD(d,"int32"),selectedScores:ZD(h)}};const vU=xJ({nonMaxSuppressionPadded_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=AJ(e,"boxes","nonMaxSuppression"),s=AJ(t,"scores","nonMaxSuppression"),l=lU(r,s,n,a,o,null),c={boxes:r,scores:s},g={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:i},u=uJ.runKernel(oE,c,g);return{selectedIndices:u[0],validOutputs:u[1]}}});const SU=async function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=AJ(e,"boxes","nonMaxSuppressionAsync"),s=AJ(t,"scores","nonMaxSuppressionAsync"),l=lU(r,s,n,a,o,null),c=l.maxOutputSize,g=l.iouThreshold,u=l.scoreThreshold,[d,h]=await Promise.all([r.data(),s.data()]),{selectedIndices:p,validOutputs:m}=hU(d,h,c,g,u,i);return r!==e&&r.dispose(),s!==t&&s.dispose(),{selectedIndices:ZD(p,"int32"),validOutputs:Az(m,"int32")}};const xU=xJ({resizeBilinear_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=AJ(e,"images","resizeBilinear");IX(3===o.rank||4===o.rank,(()=>"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(o.rank,"."))),IX(2===t.length,(()=>"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,"."))),IX(!1===a||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let i=o,r=!1;3===o.rank&&(r=!0,i=pL(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const s={images:i},l={alignCorners:n,halfPixelCenters:a,size:t},c=uJ.runKernel(SE,s,l);return r?pL(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const GU=xJ({resizeNearestNeighbor_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=AJ(e,"images","resizeNearestNeighbor");IX(3===o.rank||4===o.rank,(()=>"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(o.rank,"."))),IX(2===t.length,(()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,"."))),IX("float32"===o.dtype||"int32"===o.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),IX(!1===a||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let i=o,r=!1;3===o.rank&&(r=!0,i=pL(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const s={images:i},l={alignCorners:n,halfPixelCenters:a,size:t},c=uJ.runKernel(AE,s,l);return r?pL(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const ZU=xJ({threshold_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const o=AJ(e,"image","threshold"),i=o.shape[0]*o.shape[1];let r,s,l,c,g=JY(ZD([a]),255);if(IX(3===o.rank,(()=>"Error in threshold: image must be rank 3,but got rank ".concat(o.rank,"."))),IX(3===o.shape[2]||1===o.shape[2],(()=>"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(o.shape[2],"."))),IX("int32"===o.dtype||"float32"===o.dtype,(()=>"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(o.dtype,"."))),IX("otsu"===t||"binary"===t,(()=>"Method must be binary or otsu, but was ".concat(t))),3===o.shape[2]){[r,s,l]=fD(o,[1,1,1],-1);const e=JY(r,.2989),t=JY(s,.587),n=JY(l,.114);c=EY(EY(e,t),n)}else c=e;if("otsu"===t){g=function(e,t){let n,a,o,i,r,s,l=ZD([-1]),c=ZD([0]),g=ZD([0]);for(let u=0;u<e.size-1;u++){n=yL(e,0,u+1),a=yL(e,u+1),r=HY(xz(n),t),s=HY(xz(a),t);const d=xz(JY(n,jK(0,n.size)));o=HY(d,xz(n));const h=WL(a.shape,n.size),p=EY(jK(0,a.size),h),m=JY(a,p);i=HY(xz(m),xz(a));const I=$z(o,i),C=$z(o,i),f=JY(r,s);g=JY(JY(f,I),C);const b=Mz(g,c);c=az(b,g,c),l=az(b,ZD([u]),l)}return l}(kL(XY(aD(c),"int32"),wJ([]),256),i)}const u=n?zz(c,g):Mz(c,g);return XY(JY(u,255),"int32")}});const wU=xJ({transform_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0;const r=AJ(e,"image","transform","float32"),s=AJ(t,"transforms","transform","float32");IX(4===r.rank,(()=>"Error in transform: image must be rank 4,but got rank ".concat(r.rank,"."))),IX(2===s.rank&&(s.shape[0]===r.shape[0]||1===s.shape[0])&&8===s.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),IX(null==i||2===i.length,(()=>"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")));const l={image:r,transforms:s},c={interpolation:n,fillMode:a,fillValue:o,outputShape:i};return uJ.runKernel(lF,l,c)}});const kU=xJ({bandPart_:function(e,t,n){const a=AJ(e,"a","bandPart");IX(a.rank>=2,(()=>"bandPart(): Rank must be at least 2, got ".concat(a.rank,".")));const o=a.shape,[i,r]=a.shape.slice(-2);let s,l;"number"==typeof t?(IX(t%1===0,(()=>"bandPart(): numLower must be an integer, got ".concat(t,"."))),IX(t<=i,(()=>"bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(i,")."))),s=AJ(t<0?i:t,"numLower","bandPart")):(IX("int32"===t.dtype,(()=>"bandPart(): numLower's dtype must be an int32.")),s=az(Lz(t,0),i,dK(t,i))),"number"==typeof n?(IX(n%1===0,(()=>"bandPart(): numUpper must be an integer, got ".concat(n,"."))),IX(n<=r,(()=>"bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(r,")."))),l=AJ(n<0?r:n,"numUpper","bandPart")):(IX("int32"===n.dtype,(()=>"bandPart(): numUpper's dtype must be an int32.")),l=az(Lz(n,0),r,dK(n,r)));const c=pL(jK(0,i,1,"int32"),[-1,1]),g=jK(0,r,1,"int32"),u=$z(c,g),d=nK(zz(u,s),Tz(u,Qz(l))),h=gK([i,r],a.dtype);return pL(vD(ED(pL(a,[-1,i,r])).map((e=>az(d,e,h)))),o)}});const BU=xJ({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,IX(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=e[0].shape[0];for(let t=1;t<e.length;++t)IX(e[t].shape[0]===n,(()=>"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")))}else t=!0,e=fD(e,e.shape[0],0).map((e=>AD(e,[0])));IX(e.length<=e[0].shape[0],(()=>"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")));const n=[],a=e;for(let o=0;o<e.length;++o)n.push(uJ.tidy((()=>{let e=a[o];if(o>0)for(let t=0;t<o;++t){const a=JY(xz(JY(n[t],e)),n[t]);e=$z(e,a)}return HY(e,Zz(e,"euclidean"))})));return t?vD(n,0):n}});function RU(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return uJ.tidy((()=>{IX(2===e.shape.length,(()=>"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")));const n=e.shape[0],a=e.shape[1];let o=Vz(n),i=MY(e);const r=wD([[1]],[1,1]);let s=MY(r);const l=n>=a?a:n;for(let e=0;e<l;++e){const t=i,l=s,c=o;[s,i,o]=uJ.tidy((()=>{const t=yL(i,[e,e],[n-e,1]),l=Zz(t),c=yL(i,[e,e],[1,1]),g=az(Mz(c,0),wD([[-1]]),wD([[1]])),u=$z(c,JY(g,l)),d=HY(t,u);s=1===d.shape[0]?MY(r):CL([r,yL(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const h=Qz(HY(fL(g,u),l)),p=yL(i,[e,0],[n-e,a]),m=JY(h,s),I=JD(s);if(0===e)i=$z(p,fL(m,fL(I,p)));else{const t=$z(p,fL(m,fL(I,p)));i=CL([yL(i,[0,0],[e,a]),t],0)}const C=JD(m),f=yL(o,[0,e],[n,o.shape[1]-e]);if(0===e)o=$z(f,fL(fL(f,s),C));else{const t=$z(f,fL(fL(f,s),C));o=CL([yL(o,[0,0],[n,e]),t],1)}return[s,i,o]})),NJ([t,l,c])}return!t&&n>a&&(o=yL(o,[0,0],[n,a]),i=yL(i,[0,0],[a,a])),[o,i]}))}const WU=xJ({qr_:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(IX(e.rank>=2,(()=>"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank))),2===e.rank)return RU(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),a=ED(pL(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],i=[];a.forEach((e=>{const[n,a]=RU(e,t);o.push(n),i.push(a)}));return[pL(vD(o,0),e.shape),pL(vD(i,0),e.shape)]}}});var VU;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(VU||(VU={}));const NU=xJ({computeWeightedLoss_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:VU.SUM_BY_NONZERO_WEIGHTS;const a=AJ(e,"losses","computeWeightedLoss");let o=null;null!=t&&(o=AJ(t,"weights","computeWeightedLoss"));const i=null==o?a:JY(a,o);if(n===VU.NONE)return i;if(n===VU.SUM)return xz(i);if(n===VU.MEAN){if(null==o)return cK(i);{const e=a.size/o.size,t=HY(xz(i),xz(o));return e>1?HY(t,Az(e)):t}}if(n===VU.SUM_BY_NONZERO_WEIGHTS){if(null==o)return HY(xz(i),Az(a.size));{const e=JY(o,uK(a.shape)),t=XY(xz(IK(e,Az(0))),"float32");return HY(xz(i),t)}}throw Error("Unknown reduction: ".concat(n))}});const XU=xJ({absoluteDifference_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:VU.SUM_BY_NONZERO_WEIGHTS;const o=AJ(e,"labels","absoluteDifference"),i=AJ(t,"predictions","absoluteDifference");let r=null;null!=n&&(r=AJ(n,"weights","absoluteDifference")),CX(o.shape,i.shape,"Error in absoluteDifference: ");const s=YY($z(o,i));return NU(s,r,a)}});const MU=xJ({cosineDistance_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:VU.SUM_BY_NONZERO_WEIGHTS;const i=AJ(e,"labels","cosineDistance"),r=AJ(t,"predictions","cosineDistance");let s=null;null!=a&&(s=AJ(a,"weights","cosineDistance")),CX(i.shape,r.shape,"Error in cosineDistance: ");const l=Az(1),c=$z(l,xz(JY(i,r),n,!0));return NU(c,s,o)}});const TU=xJ({hingeLoss_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:VU.SUM_BY_NONZERO_WEIGHTS,o=AJ(e,"labels","hingeLoss");const i=AJ(t,"predictions","hingeLoss");let r=null;null!=n&&(r=AJ(n,"weights","hingeLoss")),CX(o.shape,i.shape,"Error in hingeLoss: ");const s=Az(1);o=$z(JY(Az(2),o),s);const l=eD($z(s,JY(o,i)));return NU(l,r,a)}});const EU=xJ({huberLoss_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:VU.SUM_BY_NONZERO_WEIGHTS;const i=AJ(e,"labels","huberLoss"),r=AJ(t,"predictions","huberLoss");let s=null;null!=n&&(s=AJ(n,"weights","huberLoss")),CX(i.shape,r.shape,"Error in huberLoss: ");const l=Az(a),c=YY($z(r,i)),g=dK(c,l),u=$z(c,g),d=EY(JY(Az(.5),Sz(g)),JY(l,u));return NU(d,s,o)}});const FU=xJ({logLoss_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:VU.SUM_BY_NONZERO_WEIGHTS;const i=AJ(e,"labels","logLoss"),r=AJ(t,"predictions","logLoss");let s=null;null!=n&&(s=AJ(n,"weights","logLoss")),CX(i.shape,r.shape,"Error in logLoss: ");const l=Az(1),c=Az(a),g=Qz(JY(i,Dz(EY(r,c)))),u=JY($z(l,i),Dz(EY($z(l,r),c))),d=$z(g,u);return NU(d,s,o)}});const HU=xJ({meanSquaredError_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:VU.SUM_BY_NONZERO_WEIGHTS;const o=AJ(e,"labels","meanSquaredError"),i=AJ(t,"predictions","meanSquaredError");let r=null;null!=n&&(r=AJ(n,"weights","meanSquaredError")),CX(o.shape,i.shape,"Error in meanSquaredError: ");const s=yD(o,i);return NU(s,r,a)}});const JU=xJ({sigmoidCrossEntropy_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:VU.SUM_BY_NONZERO_WEIGHTS,i=AJ(e,"multiClassLabels","sigmoidCrossEntropy");const r=AJ(t,"logits","sigmoidCrossEntropy");let s=null;if(null!=n&&(s=AJ(n,"weights","sigmoidCrossEntropy")),CX(i.shape,r.shape,"Error in sigmoidCrossEntropy: "),a>0){const e=Az(a),t=Az(1),n=Az(.5);i=EY(JY(i,$z(t,e)),JY(n,e))}const l=function(e,t){const n=AJ(e,"labels","sigmoidCrossEntropyWithLogits"),a=AJ(t,"logits","sigmoidCrossEntropyWithLogits");CX(n.shape,a.shape,"Error in sigmoidCrossEntropyWithLogits: ");const o=eD(a),i=JY(a,n),r=Uz(kz(Qz(YY(a))));return EY($z(o,i),r)}(i,r);return NU(l,s,o)}});const YU=xJ({softmaxCrossEntropy_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:VU.SUM_BY_NONZERO_WEIGHTS,i=AJ(e,"onehotLabels","softmaxCrossEntropy");const r=AJ(t,"logits","softmaxCrossEntropy");let s=null;if(null!=n&&(s=AJ(n,"weights","softmaxCrossEntropy")),CX(i.shape,r.shape,"Error in softmaxCrossEntropy: "),a>0){const e=Az(a),t=Az(1),n=Az(i.shape[1]);i=EY(JY(i,$z(t,e)),HY(e,n))}const l=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(n));return Oz(((e,t,a)=>{const o=tK(t,[n],!0),i=$z(XY(t,"float32"),o);a([e,i]);const r=Qz(JY(i,e));return{value:xz(r,[n]),gradFunc:(e,t)=>{const[a,o]=t,i=hz(e.shape,[n]);return[JY(pL(e,i),$z(XY(a,"float32"),kz(o))),JY(pL(e,i),$z(kz(o),XY(a,"float32")))]}}}))(e,t)}(i,r);return NU(l,s,o)}});const LU=xJ({sparseFillEmptyRows_:function(e,t,n,a){const o=AJ(e,"indices","sparseFillEmptyRows","int32"),i=AJ(t,"values","sparseFillEmptyRows"),r=AJ(n,"denseShape","sparseFillEmptyRows","int32"),s=AJ(a,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==o.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(o.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==r.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(r.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));const l={indices:o,values:i,denseShape:r,defaultValue:s},c=uJ.runKernel(DE,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});const zU=xJ({sparseReshape_:function(e,t,n){const a=AJ(e,"inputIndices","sparseReshape","int32"),o=AJ(t,"inputShape","sparseReshape","int32"),i=AJ(n,"newShape","sparseReshape","int32");if(2!==a.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==o.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(o.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));const r={inputIndices:a,inputShape:o,newShape:i},s=uJ.runKernel(UE,r);return{outputIndices:s[0],outputShape:s[1]}}});const KU=xJ({sparseSegmentMean_:function(e,t,n){const a=AJ(e,"data","sparseSegmentMean"),o=AJ(t,"indices","sparseSegmentMean","int32"),i=AJ(n,"segmentIds","sparseSegmentMean","int32");if(a.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==o.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(o.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));const r={data:a,indices:o,segmentIds:i};return uJ.runKernel(PE,r)}});const DU=xJ({sparseSegmentSum_:function(e,t,n){const a=AJ(e,"data","sparseSegmentSum"),o=AJ(t,"indices","sparseSegmentSum","int32"),i=AJ(n,"segmentIds","sparseSegmentSum","int32");if(a.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==o.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(o.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));const r={data:a,indices:o,segmentIds:i};return uJ.runKernel(OE,r)}});const UU=xJ({stringNGrams_:function(e,t,n,a,o,i,r,s){const l=AJ(e,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error("Data must be a vector, saw: ".concat(l.shape));const c=AJ(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const g={separator:n,nGramWidths:a,leftPad:o,rightPad:i,padWidth:r,preserveShortSequences:s},u={data:l,dataSplits:c},d=uJ.runKernel(eF,u,g);return{nGrams:d[0],nGramsSplits:d[1]}}});const PU=xJ({stringSplit_:function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=AJ(e,"input","stringSplit","string"),o=AJ(t,"delimiter","stringSplit","string");if(1!==a.rank)throw new Error("Input should be Tensor1D but received shape ".concat(a.shape));if(0!==o.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(o.shape));const i={skipEmpty:n},r={input:a,delimiter:o},s=uJ.runKernel(tF,r,i);return{indices:s[0],values:s[1],shape:s[2]}}});const OU=xJ({stringToHashBucketFast_:function(e,t){const n=AJ(e,"input","stringToHashBucketFast","string"),a={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const o={input:n};return uJ.runKernel(nF,o,a)}});const _U=xJ({staticRegexReplace_:function(e,t,n){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=AJ(e,"input","staticRegexReplace","string"),i={pattern:t,rewrite:n,replaceGlobal:a};return uJ.runKernel(qE,{x:o},i)}}),QU={fft:mD,ifft:ID,rfft:bD,irfft:CD},jU={hammingWindow:$D,hannWindow:eU,frame:tU,stft:nU},qU={flipLeftRight:oU,grayscaleToRGB:iU,resizeNearestNeighbor:GU,resizeBilinear:xU,rgbToGrayscale:rU,rotateWithOffset:sU,cropAndResize:aU,nonMaxSuppression:cU,nonMaxSuppressionAsync:bU,nonMaxSuppressionWithScore:yU,nonMaxSuppressionWithScoreAsync:AU,nonMaxSuppressionPadded:vU,nonMaxSuppressionPaddedAsync:SU,threshold:ZU,transform:wU},$U={bandPart:kU,gramSchmidt:BU,qr:WU},eP={absoluteDifference:XU,computeWeightedLoss:NU,cosineDistance:MU,hingeLoss:TU,huberLoss:EU,logLoss:FU,meanSquaredError:HU,sigmoidCrossEntropy:JU,softmaxCrossEntropy:YU},tP={sparseFillEmptyRows:LU,sparseReshape:zU,sparseSegmentMean:KU,sparseSegmentSum:DU},nP={stringNGrams:UU,stringSplit:PU,stringToHashBucketFast:OU,staticRegexReplace:_U},aP=new Map,oP=new Map;class iP{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class rP{constructor(){this.classNameMap={}}static getMap(){return null==rP.instance&&(rP.instance=new rP),rP.instance}static register(e){rP.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function sP(e,t,n){IX(null!=e.className,(()=>"Class being registered does not have the static className property defined.")),IX("string"==typeof e.className,(()=>"className is required to be a string, but got type "+typeof e.className)),IX(e.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),typeof t>"u"&&(t="Custom"),typeof n>"u"&&(n=e.className);const a=t+">"+n;return rP.register(e),aP.set(a,e),oP.set(e,a),e}const lP=Object.freeze(Object.defineProperty({__proto__:null,Serializable:iP,SerializationMap:rP,getRegisteredName:function(e){return oP.has(e)?oP.get(e):e.className},registerClass:sP},Symbol.toStringTag,{value:"Module"}));class cP extends iP{minimize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const{value:a,grads:o}=this.computeGradients(e,n);if(null!=n){const e=n.map((e=>({name:e.name,tensor:o[e.name]})));this.applyGradients(e)}else this.applyGradients(o);return NJ(o),t?a:(a.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return Pz(e,t)}dispose(){null!=this.iterations_&&NJ(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Az(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class ".concat(this.getClassName()))}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(cP,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class gP extends cP{static get className(){return"Adadelta"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=uJ.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const a=uJ.registeredVariables[t],o=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accum_grad"),variable:VJ((()=>oz(a).variable(o)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:"".concat(t,"/accum_var"),variable:VJ((()=>oz(a).variable(o)))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const r=this.accumulatedGrads[n].variable,s=this.accumulatedUpdates[n].variable;VJ((()=>{const e=EY(JY(r,this.rho),JY(Sz(i),1-this.rho)),t=JY(HY(vz(EY(s,this.epsilon)),vz(EY(r,this.epsilon))),i),n=EY(JY(s,this.rho),JY(Sz(t),1-this.rho));r.assign(e),s.assign(n);const o=EY(JY(t,-this.learningRate),a);a.assign(o)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(NJ(this.accumulatedGrads.map((e=>e.variable))),NJ(this.accumulatedUpdates.map((e=>e.variable))))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedUpdates=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}class uP extends cP{static get className(){return"Adagrad"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const a=uJ.registeredVariables[t];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accumulator"),variable:VJ((()=>WL(a.shape,this.initialAccumulatorValue).variable(!1)))});const o=Array.isArray(e)?e[n].tensor:e[t];if(null==o)return;const i=this.accumulatedGrads[n].variable;VJ((()=>{const e=EY(i,Sz(o));i.assign(e);const t=EY(JY(HY(o,vz(EY(e,uJ.backend.epsilon()))),-this.learningRate),a);a.assign(t)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&NJ(this.accumulatedGrads.map((e=>e.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}class dP extends cP{static get className(){return"Adam"}constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=a,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],VJ((()=>{this.accBeta1=Az(t).variable(),this.accBeta2=Az(n).variable()})),null==a&&(this.epsilon=uJ.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);VJ((()=>{const n=$z(1,this.accBeta1),a=$z(1,this.accBeta2);t.forEach(((t,o)=>{const i=uJ.registeredVariables[t],r=!1;null==this.accumulatedFirstMoment[o]&&(this.accumulatedFirstMoment[o]={originalName:"".concat(t,"/m"),variable:VJ((()=>oz(i).variable(r)))}),null==this.accumulatedSecondMoment[o]&&(this.accumulatedSecondMoment[o]={originalName:"".concat(t,"/v"),variable:VJ((()=>oz(i).variable(r)))});const s=Array.isArray(e)?e[o].tensor:e[t];if(null==s)return;const l=this.accumulatedFirstMoment[o].variable,c=this.accumulatedSecondMoment[o].variable,g=EY(JY(l,this.beta1),JY(s,1-this.beta1)),u=EY(JY(c,this.beta2),JY(Sz(s),1-this.beta2)),d=HY(g,n),h=HY(u,a);l.assign(g),c.assign(u);const p=EY(JY(HY(d,EY(vz(h),this.epsilon)),-this.learningRate),i);i.assign(p)})),this.accBeta1.assign(JY(this.accBeta1,this.beta1)),this.accBeta2.assign(JY(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&NJ(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedSecondMoment&&NJ(this.accumulatedSecondMoment.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),VJ((()=>{this.accBeta1.assign(yz(this.beta1,this.iterations_+1)),this.accBeta2.assign(yz(this.beta2,this.iterations_+1))}));const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedSecondMoment=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}class hP extends cP{static get className(){return"Adamax"}constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=a,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],VJ((()=>{this.iteration=Az(0).variable(),this.accBeta1=Az(t).variable()})),null==a&&(this.epsilon=uJ.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);VJ((()=>{const n=$z(1,this.accBeta1),a=HY(-this.learningRate,EY(JY(this.iteration,this.decay),1));t.forEach(((t,o)=>{const i=uJ.registeredVariables[t],r=!1;null==this.accumulatedFirstMoment[o]&&(this.accumulatedFirstMoment[o]={originalName:"".concat(t,"/m"),variable:oz(i).variable(r)}),null==this.accumulatedWeightedInfNorm[o]&&(this.accumulatedWeightedInfNorm[o]={originalName:"".concat(t,"/v"),variable:oz(i).variable(r)});const s=Array.isArray(e)?e[o].tensor:e[t];if(null==s)return;const l=this.accumulatedFirstMoment[o].variable,c=this.accumulatedWeightedInfNorm[o].variable,g=EY(JY(l,this.beta1),JY(s,1-this.beta1)),u=JY(c,this.beta2),d=YY(s),h=lK(u,d);l.assign(g),c.assign(h);const p=EY(JY(HY(a,n),HY(g,EY(h,this.epsilon))),i);i.assign(p)})),this.iteration.assign(EY(this.iteration,1)),this.accBeta1.assign(JY(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&NJ(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedWeightedInfNorm&&NJ(this.accumulatedWeightedInfNorm.map((e=>e.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class pP extends cP{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const o=uJ.registeredVariables[t];VJ((()=>{const e=EY(JY(this.c,a),o);o.assign(e)}))})),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=XJ(Az(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class mP extends pP{static get className(){return"Momentum"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=Az(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const a=uJ.registeredVariables[t];null==this.accumulations[n]&&(this.accumulations[n]={originalName:"".concat(t,"/momentum"),variable:VJ((()=>oz(a).variable(!1)))});const o=this.accumulations[n].variable,i=Array.isArray(e)?e[n].tensor:e[t];null!=i&&VJ((()=>{let e;const t=EY(JY(this.m,o),i);e=this.useNesterov?EY(JY(this.c,EY(i,JY(t,this.m))),a):EY(JY(this.c,t),a),o.assign(t),a.assign(e)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&NJ(this.accumulations.map((e=>e.variable)))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class IP extends cP{static get className(){return"RMSProp"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=a,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,null==a&&(this.epsilon=uJ.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const a=uJ.registeredVariables[t],o=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:"".concat(t,"/rms"),variable:VJ((()=>oz(a).variable(o)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:"".concat(t,"/momentum"),variable:VJ((()=>oz(a).variable(o)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:"".concat(t,"/mg"),variable:VJ((()=>oz(a).variable(o)))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const r=this.accumulatedMeanSquares[n].variable,s=this.accumulatedMoments[n].variable;VJ((()=>{const e=EY(JY(r,this.decay),JY(Sz(i),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,o=EY(JY(t,this.decay),JY(i,1-this.decay)),l=HY(JY(i,this.learningRate),vz($z(e,EY(Sz(o),this.epsilon)))),c=EY(JY(s,this.momentum),l);r.assign(e),t.assign(o),s.assign(c);const g=$z(a,c);a.assign(g)}else{const e=EY(JY(r,this.decay),JY(Sz(i),1-this.decay)),t=EY(JY(s,this.momentum),HY(JY(i,this.learningRate),vz(EY(e,this.epsilon))));r.assign(e),s.assign(t);const n=$z(a,t);a.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&NJ(this.accumulatedMeanSquares.map((e=>e.variable))),null!=this.accumulatedMeanGrads&&this.centered&&NJ(this.accumulatedMeanGrads.map((e=>e.variable))),null!=this.accumulatedMoments&&NJ(this.accumulatedMoments.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedMoments=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const CP=[gP,uP,dP,hP,mP,IP,pP];function fP(e,t,n,a){var o,i,r;IX(null!=(r=e)&&Array.isArray(r)&&r.length>0,(()=>"promises must be a none empty array")),n=null!==(o=n)&&void 0!==o?o:0,a=null!==(i=a)&&void 0!==i?i:1,function(e,t){IX(e>=0&&e<=1,(()=>"Progress fraction must be in range [0, 1], but got startFraction ".concat(e))),IX(t>=0&&t<=1,(()=>"Progress fraction must be in range [0, 1], but got endFraction ".concat(t))),IX(t>=e,(()=>"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)))}(n,a);let s=0;return Promise.all(e.map((o=>(o.then((o=>{const i=n+ ++s/e.length*(a-n);return t(i),o})),o))))}async function bP(e,t){null==t&&(t={});const n=null==t.fetchFunc?nM().platform.fetch:t.fetchFunc,a=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),o=(null==t.onProgress?await Promise.all(a):await fP(a,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(o):await fP(o,t.onProgress,.5,1)}async function yP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return AP((e=>bP(e,{requestInit:a})))(e,t,n)}function AP(e){return async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;const o=t.map((()=>!1)),i={},r=null!=a?a.map((()=>!1)):[],s=[];if(t.forEach(((e,t)=>{let n=0;e.weights.forEach((e=>{const l="quantization"in e?e.quantization.dtype:e.dtype,c=kJ[l]*bX(e.shape),g=()=>{o[t]=!0,null==i[t]&&(i[t]=[]),i[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach(((t,n)=>{t===e.name&&(g(),r[n]=!0)})):g(),s.push(e.name),n+=c}))})),!r.every((e=>e))){const e=a.filter(((e,t)=>!r[t]));throw new Error("Could not find weights in manifest with names: ".concat(e.join(", "),". \nManifest JSON has weights with names: ").concat(s.join(", "),"."))}const l=o.reduce(((e,t,n)=>(t&&e.push(n),e)),[]),c=[];l.forEach((e=>{t[e].paths.forEach((e=>{const t=n+(n.endsWith("/")?"":"/")+e;c.push(t)}))}));const g=await e(c),u={};let d=0;return l.forEach((e=>{const n=t[e].paths.length,a=new BJ(g.slice(d,d+n));i[e].forEach((e=>{const t=JJ(a.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const n in t)u[n]=t[n]})),d+=n})),u}}class vP{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(IX("function"==typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=nM().platform.fetch,IX(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&IX(2===e.length,(()=>"URL paths for http must have a length of 2, (actual length is ".concat(e.length,")."))),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=jJ(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData){const n=BJ.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}const a=await this.fetch(this.path,t);if(a.ok)return{modelArtifactsInfo:eY(e),responses:[a]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(a.status,"."))}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ").concat(e.status,". Please verify this URL points to the model JSON of the model to load."));let t;try{t=await e.json()}catch{let e="Failed to parse model JSON of response from ".concat(this.path,".");throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=t.modelTopology,a=t.weightsManifest;if(null==n&&null==a)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();return $J(await this.loadModelJSON(),(e=>this.loadWeights(e)))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=tY(e.weightsManifest);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:()=>function(e,t){var n;const a=null==t.fetchFunc?nM().platform.fetch:t.fetchFunc;let o,i=0;return null===(n=t.onProgress)||void 0===n||n.call(t,0),new ReadableStream({pull:async n=>{for(var r;i<e.length;){o||(o=(await a(e[i],t.requestInit,{isBinary:!0})).body.getReader());const{done:s,value:l}=await o.read();if(!s)return void n.enqueue(l);i++,o=void 0,null===(r=t.onProgress)||void 0===r||r.call(t,i/e.length)}n.close()}})}(t,this.loadOptions)})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,a]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),a=e.substring(0,t),o=n>t?e.substring(n):"";return[a+"/",o]}(t),o=this.weightPathPrefix||n,i=[],r=[];for(const s of e)for(const e of s.paths)null!=this.weightUrlConverter?r.push(this.weightUrlConverter(e)):i.push(o+e+a);return this.weightUrlConverter&&i.push(...await Promise.all(r)),i}async loadWeights(e){const t=await this.getWeightUrls(e);return[tY(e),await bP(t,this.loadOptions)]}}function SP(e){return null!=e.match(vP.URL_SCHEME_REGEX)}vP.URL_SCHEME_REGEX=/^https?:\/\//;const xP=(e,t)=>{if(typeof fetch>"u"&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>SP(e))):SP(e),n)return GP(e,t)}return null};function GP(e,t){return new vP(e,t)}function ZP(e,t){return GP(e,t)}nY.registerSaveRouter(xP),nY.registerLoadRouter(xP);let wP,kP=!1;function BP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,a=!1,o=!1,i=!1,r=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)a=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)r=!0;else{if(!(typeof ImageBitmap<"u"&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));s=!0}if(null!=SF(mF,uJ.backendName)){const n={pixels:e},a={numChannels:t};return uJ.runKernel(mF,n,a)}const[l,c]=o?[e.videoWidth,e.videoHeight]:[e.width,e.height];let g,u;if(r)g=e.getContext("2d").getImageData(0,0,l,c).data;else if(a||n)g=e.data;else if(i||o||s){if(null==wP)if(typeof document>"u"){if(!(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u"))throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");wP=new OffscreenCanvas(1,1).getContext("2d")}else wP=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});wP.canvas.width=l,wP.canvas.height=c,wP.drawImage(e,0,0,l,c),g=wP.getImageData(0,0,l,c).data}if(4===t)u=new Int32Array(g);else{const e=l*c;u=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)u[n*t+e]=g[4*n+e]}return kD(u,[c,l,t],"int32")}function RP(e){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function WP(e){if(2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(e.rank,"."));const t=2===e.rank?1:e.shape[2];if(t>4||2===t)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(t));if("float32"!==e.dtype&&"int32"!==e.dtype)throw new Error("Unsupported type for toPixels: ".concat(e.dtype,". Please use float32 or int32 tensors."))}const VP=xJ({fromPixels_:BP}),NP=Object.freeze(Object.defineProperty({__proto__:null,draw:function(e,t,n){let a=AJ(e,"img","draw");if(!(e instanceof YH)){const e=a;a=XY(e,"int32"),e.dispose()}WP(a),function(e){const t=(null==e?void 0:e.alpha)||1;if(t>1||t<0)throw new Error("Alpha value ".concat(t," is suppoed to be in range [0 - 1]."))}(null==n?void 0:n.imageOptions);const o={image:a},i={canvas:t,options:n};uJ.runKernel(aT,o,i)},fromPixels:VP,fromPixelsAsync:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=null;if(nM().getBool("WRAP_TO_IMAGEBITMAP")&&RP(e)){let t;try{t=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch{t=null}n=null!=t&&t.width===e.width&&t.height===e.height?t:e}else n=e;return BP(n,t)},toPixels:async function(e,t){let n=AJ(e,"img","toPixels");if(!(e instanceof YH)){const e=n;n=XY(e,"int32"),e.dispose()}WP(n);const[a,o]=n.shape.slice(0,2),i=2===n.rank?1:n.shape[2],r=await n.data(),s="float32"===n.dtype?255:1,l=new Uint8ClampedArray(o*a*4);for(let c=0;c<a*o;++c){const e=[0,0,0,255];for(let a=0;a<i;a++){const t=r[c*i+a];if("float32"===n.dtype){if(t<0||t>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(t,"."))}else if("int32"===n.dtype&&(t<0||t>255))throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(t,"."));1===i?(e[0]=t*s,e[1]=t*s,e[2]=t*s):e[a]=t*s}const t=4*c;l[t+0]=Math.round(e[0]),l[t+1]=Math.round(e[1]),l[t+2]=Math.round(e[2]),l[t+3]=Math.round(e[3])}if(null!=t){kP||null!=SF(aT,uJ.backendName)&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),kP=!0),t.width=o,t.height=a;const e=t.getContext("2d"),n=new ImageData(l,o,a);e.putImageData(n,0,0)}return n!==e&&n.dispose(),l}},Symbol.toStringTag,{value:"Module"}));function XP(e,t){const n=e.shape.length,a=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(a<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(a,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[a-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[a-1]," vs. ").concat(n));if(0===bX(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));const o=t.shape,i=o[o.length-1];let r=1;for(let u=0;u<o.length-1;++u)r*=o[u];const s=e.shape,l=o.slice();l.pop();let c=1;for(let u=i;u<n;++u)c*=s[u],l.push(s[u]);const g=[...LX(e.shape).map((e=>e/c)),1].slice(0,i);return[l,r,c,g]}const MP=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:XP},Symbol.toStringTag,{value:"Module"})),TP=-2,EP=-1;function FP(e,t,n){const a=e.shape.length;IX(a===t.length,(()=>"Error in slice".concat(a,"D: Length of begin ").concat(t," must match the rank of the array (").concat(a,")."))),IX(a===n.length,(()=>"Error in slice".concat(a,"D: Length of size ").concat(n," must match the rank of the array (").concat(a,").")));for(let o=0;o<a;++o)IX(t[o]+n[o]<=e.shape[o],(()=>"Error in slice".concat(a,"D: begin[").concat(o,"] + size[").concat(o,"] (").concat(t[o]+n[o],") would overflow input.shape[").concat(o,"] (").concat(e.shape[o],")")))}function HP(e,t,n){const a=[];for(let o=0;o<e.length;o++)a[o]=Math.ceil((t[o]-e[o])/n[o]);return a}function JP(e,t,n,a){const o=[...e];for(let i=o.length;i<a.length;i++)o.push(1);for(let i=0;i<n;i++)0===i?o[t]=1:(o.splice(t,0,1),o.pop());return o}function YP(e,t,n){return n<=e?n:n-(t-1)}function LP(e,t){const n=[];for(let a=0;a<e;a++)n.push(t+a);return n}function zP(e,t,n,a,o){const i=[...o],r=LP(n,t);for(let s=0;s<i.length;s++)if(r.indexOf(s)>-1)i[s]=0;else{const o=YP(t,n,s);let r=a[o];e&1<<o&&(r=0),i[s]=r}return i}function KP(e,t,n,a,o){const i=[...o],r=LP(n,t);for(let s=0;s<i.length;s++)if(r.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{const o=YP(t,n,s);let r=a[o];e&1<<o&&(r=Number.MAX_SAFE_INTEGER),i[s]=r}for(let s=0;s<i.length;s++){const e=o[s];i[s]<0&&(i[s]+=e),i[s]=dX(0,i[s],o[s])}return i}function DP(e,t,n){let a=e[t];return(n&1<<t||null==a)&&(a=1),a}function UP(e,t,n,a,o,i){let r=t[o];const s=n[o]||1;(e&1<<o||i&1<<o||null==r)&&(r=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=a[o];return r<0&&(r+=l),r=dX(0,r,l-1),r}function PP(e,t,n,a,o,i){let r=t[o];const s=n[o]||1;(e&1<<o||i&1<<o||null==r)&&(r=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=a[o];return r<0&&(r+=l),r=s>0?dX(0,r,l):dX(-1,r,l-1),r}function OP(e,t,n){let a=n.length;for(let o=0;o<n.length;o++)if(n[o]>1){a=o;break}for(let o=a+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function _P(e,t){let n=e.length>0?e[e.length-1]:1;for(let a=0;a<e.length-1;a++)n+=e[a]*t[a];return n}function QP(e,t,n){let a;const o=e.shape.length;let i;return a="number"==typeof t?[t,...new Array(o-1).fill(0)]:t.length<o?t.concat(new Array(o-t.length).fill(0)):t.slice(),a.forEach((e=>{IX(-1!==e,(()=>"slice() does not support negative begin indexing."))})),i=null==n?new Array(o).fill(-1):"number"==typeof n?[n,...new Array(o-1).fill(-1)]:n.length<o?n.concat(new Array(o-n.length).fill(-1)):n,i=i.map(((t,n)=>t>=0?t:(IX(-1===t,(()=>"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,"."))),e.shape[n]-a[n]))),[a,i]}function jP(e,t,n,a,o,i,r,s,l){let c;if(null==a?(c=new Array(t.length),c.fill(1)):c=a,null!=r&&r&r-1)throw new Error("Multiple ellipses in slice is not allowed.");let g=!1;const u={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:o,endMask:i,ellipsisMask:r,newAxisMask:s,shrinkAxisMask:l};for(let f=0;f<u.dims;f++)g&&1<<f&s&&u.numAddAxisAfterEllipsis++,1<<f&r&&(g=!0);g||(u.ellipsisMask|=1<<u.dims,u.dims++);const d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let a=0;a<e.dims;a++)if(1<<a&e.ellipsisMask){const o=Math.min(t.dims-(e.dims-a)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<o;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=a}else if(1<<a&e.newAxisMask)t.finalShapeGatherIndices.push(TP),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[a]),null!=e.end&&(t.end[n]=e.end[a]),t.strides[n]=e.strides[a],e.beginMask&1<<a&&(t.beginMask|=1<<n),e.endMask&1<<a&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<a?(t.finalShapeGatherIndices.push(EP),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(a)),t.inputShapeGatherIndicesSparse[n]=a,n++}}(u,d);let h=!0,p=!0,m=!0;const I=[],C=[];for(let f=0;f<e.length;++f){if(0===d.strides[f])throw Error("strides[".concat(f,"] must be non-zero"));const t=!!(d.shrinkAxisMask&1<<f),n=e[f];if(-1===n){I.push(t?1:-1);continue}const a=[d.beginMask&1<<f,d.endMask&1<<f],o=[d.strides[f]>0?0:-1,d.strides[f]>0?n:n-1];if(t&&d.strides[f]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[f];const i=!!(d.beginMask&1<<f&&d.endMask&1<<f);if(d.beginValid&&d.endValid){if(t){const e=d.begin[f]<0?n+d.begin[f]:d.begin[f];if(d.begin[f]=e,d.end[f]=d.begin[f]+1,e<0||e>=n)throw Error("slice index ".concat(d.begin[f]," of dimension ").concat(f," out of bounds."))}else d.begin[f]=qP(d.begin[f],0,d.strides[f],n,a,o),d.end[f]=qP(d.end[f],1,d.strides[f],n,a,o);const e=1===d.strides[f]&&0===d.begin[f]&&d.end[f]===n;h=h&&e,p=p&&(0===f&&1===d.strides[f]||e)}else h=h&&1===d.strides[f]&&i,p=p&&(0===f&&1===d.strides[f]||i);let r,s=!1;if(d.beginValid&&d.endValid?(r=d.end[f]-d.begin[f],s=!0):t?(r=1,s=!0):i&&n>=0&&(r=d.strides[f]<0?-n:n,s=!0),s){let e;e=0===r||r<0!=d.strides[f]<0?0:Math.trunc(r/d.strides[f])+(r%d.strides[f]!==0?1:0),I.push(e)}else I.push(-1)}for(let f=0;f<d.finalShapeGatherIndices.length;++f){const e=d.finalShapeGatherIndices[f];e>=0?C.push(I[e]):e===TP&&C.push(1)}return{finalShapeSparse:C.filter(((e,t)=>d.finalShapeGatherIndices[t]!==TP)),finalShape:C,isIdentity:h,sliceDim0:p,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function qP(e,t,n,a,o,i){if(o[t])return n>0?i[t]:i[t+1&1];{const t=e<0?a+e:e;return t<i[0]?i[0]:t>i[1]?i[1]:t}}const $P=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:FP,computeFlatOffset:_P,computeOutShape:HP,getNormalizedAxes:function(e,t,n,a,o,i,r,s,l){const c=e.length;let g=new Array(c),u=new Array(c),d=new Array(c);if(t.length&&n>0){const l=t[0],c=n+1;g=zP(r,l,c,a,e),u=KP(s,l,c,o,e),d=JP(i,l,c,e)}else for(let h=0;h<c;h++)g[h]=UP(r,a,i,e,h,l),u[h]=PP(s,o,i,e,h,l),d[h]=DP(i,h,l);return{begin:g,end:u,strides:d}},isSliceContinous:OP,maskToAxes:function(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t},parseSliceParams:QP,sliceInfo:jP,startForAxis:UP,startIndicesWithElidedDims:zP,stopForAxis:PP,stopIndicesWithElidedDims:KP,stridesForAxis:DP,stridesWithElidedDims:JP},Symbol.toStringTag,{value:"Module"}));class eO{static sgd(e){return new pP(e)}static momentum(e,t){return new mP(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}static rmsprop(e){return new IP(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}static adam(){return new dP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}static adadelta(){return new gP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}static adamax(){return new hP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}static adagrad(e){return new uP(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}const tO=eO,nO=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e();function aO(){return new Promise((e=>nO((()=>e()))))}function oO(e,t){const n=e[0].length;e.forEach(((e,t)=>{IX(e.length===n,(()=>"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")))})),IX(t>=0&&t<n,(()=>"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")));const a=e[0];e.forEach(((e,o)=>{for(let i=0;i<n;i++)IX(i===t||e[i]===a[i],(()=>"Error in concat".concat(n,"D: Shape of tensors[").concat(o,"] (").concat(e,") does not match the shape of the rest (").concat(a,") along the non-concatenated axis ").concat(o,".")))}))}function iO(e,t){const n=e[0].slice();for(let a=1;a<e.length;a++)n[t]+=e[a][t];return n}var rO;function sO(e,t,n){let a=new Array;if(null==n&&null==t)return a;if(null==t)for(;a.length<e+n.length;)a.push(-1);else a=t.slice();if(null==n)return a;if(e+n.length!==a.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(a.length));for(let o=1;o<n.length;++o){const i=n[o],r=a[a.length-n.length+o],s=a[r];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(o+e,"] = ").concat(i," but shape[").concat(o+e,"] = ").concat(s))}else a[r]=i}return a}function lO(e){const t={FIRST_DIM_SIZE:rO.FIRST_DIM_SIZE,VALUE_ROWIDS:rO.VALUE_ROWIDS,ROW_LENGTHS:rO.ROW_LENGTHS,ROW_SPLITS:rO.ROW_SPLITS,ROW_LIMITS:rO.ROW_LIMITS,ROW_STARTS:rO.ROW_STARTS},n=[];for(const a of e){if(!(a in t))break;n.push(t[a])}return n}function cO(e){return 0===e.length?0:e[0]===rO.FIRST_DIM_SIZE?e.length-1:e.length}function gO(e,t){if(null==e||null==t)return;const n=e.length,a=t.length;if(n>=a)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(a,")"));for(let o=0;o<Math.min(n,a-1);++o){const n=e[o],a=t[o+1];if(n>=0&&a>=0&&1!==n&&n!==a)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(o-e.length,"] = ").concat(n," but ragged tensor input.flatValues.shape[").concat(o-e.length,"] = ").concat(a))}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(rO||(rO={}));const uO=30;function dO(e){return e<=uO?e:YX(e,Math.floor(Math.sqrt(e)))}function hO(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function pO(e,t,n){let a=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);const n=t.length;for(let o=0;o<n;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(n+1))}return a}function mO(e,t){const n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(let a=t+1;a<e;++a)a<=2*t?(n.push(a),n.push(a-(t+1))):n.push(a)}else{const a=[],o=[];for(let n=1;n<e;++n)n>=2*t+1||n%2===1?o.push(n):a.push(n);n.push(...a),n.push(0),n.push(...o)}return n}function IO(e,t,n){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=[];a?o.push(e[0]/n):o.push(e[0]*n);for(let i=1;i<e.length;++i)i<=t.length?a?o.push(t[i-1]*e[i]):o.push(e[i]/t[i-1]):o.push(e[i]);return o}function CO(e,t){const n=[0];for(let a=0;a<t;++a)n.push(e[a][0]);return n}function fO(e,t,n){const a=e.slice(0,1);for(let o=0;o<n;++o)a.push(e[o+1]-t[o][0]-t[o][1]);return a}const bO=1.7580993408473768,yO=1.0507009873554805,AO=.3275911,vO=.254829592,SO=-.284496736,xO=1.421413741,GO=-1.453152027,ZO=1.061405429;function wO(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));const n=new Float32Array(2*e.length);for(let a=0;a<n.length;a+=2)n[a]=e[a/2],n[a+1]=t[a/2];return n}function kO(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let a=0;a<e.length;a+=2)t[a/2]=e[a],n[a/2]=e[a+1];return{real:t,imag:n}}function BO(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),a=new Float32Array(t);for(let o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],a[Math.floor(o/4)]=e[o+1];return{real:n,imag:a}}function RO(e){const t=Math.floor(e.length/4),n=new Float32Array(t),a=new Float32Array(t);for(let o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],a[Math.floor(o/4)]=e[o+1];return{real:n,imag:a}}function WO(e,t){return{real:e[2*t],imag:e[2*t+1]}}function VO(e,t,n,a){e[2*a]=t,e[2*a+1]=n}function NO(e,t){const n=new Float32Array(e/2),a=new Float32Array(e/2);for(let o=0;o<Math.ceil(e/2);o++){const i=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(i),a[o]=Math.sin(i)}return{real:n,imag:a}}function XO(e,t,n){const a=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(a),imag:Math.sin(a)}}const MO="->",TO=/->/g,EO=",",FO="...";function HO(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(TO,"").length)/MO.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(MO,'").'));const[a,o]=e.split(MO);IX(-1===a.indexOf(FO),(()=>'The ellipsis notation ("'.concat(FO,'") is not supported yet.')));const i=a.split(EO),r=i.length;if(t!==r)throw new Error("Expected ".concat(r," input tensors, received ").concat(t));if(r>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const s=[];for(let u=0;u<o.length;++u){const e=o[u];if(!i.some((t=>-1!==t.indexOf(e))))throw new Error("Output subscripts contain the label ".concat(e," not present in the input subscripts."));-1===s.indexOf(e)&&s.push(e)}for(let u=0;u<a.length;++u){const e=a[u];-1===s.indexOf(e)&&e!==EO&&s.push(e)}const l=new Array(i.length);for(let u=0;u<r;++u){if(new Set(i[u].split("")).size!==i[u].length)throw new Error("Found duplicate axes in input component ".concat(i[u],". Support for duplicate axes in input is not implemented yet."));l[u]=[];for(let e=0;e<i[u].length;++e)l[u].push(s.indexOf(i[u][e]))}const c=s.length,g=[];for(let u=o.length;u<c;++u)g.push(u);return{allDims:s,summedDims:g,idDims:l}}function JO(e,t){let n=new Array(e);n.fill(-1);for(let o=0;o<t.length;++o)n[t[o]]=o;const a=[];for(let o=0;o<e;++o)-1===n[o]&&a.push(o);return n=n.filter((e=>-1!==e)),{permutationIndices:n,expandDims:a}}function YO(e,t,n){const a=new Array(e);for(let o=0;o<n.length;++o){const e=n[o].shape;for(let n=0;n<t[o].length;++n)void 0===a[t[o][n]]?a[t[o][n]]=e[n]:IX(a[t[o][n]]===e[n],(()=>"Expected dimension ".concat(a[t[o][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(e),", but got dimension ").concat(e[n])))}}function LO(e,t){const n=e,a=[];let o=0;0===e.length&&n.push(-1),o=e.length+1;for(let r=0;r<o;++r)a.push([]);const i=[];for(let r=0;r<n.length;++r){const e=KO(t,n[r]);for(const t of e)-1===i.indexOf(t)&&(a[r].push(t),i.push(t))}return{path:n,steps:a}}function zO(e){return e.every(((e,t)=>e===t))}function KO(e,t){const n=[];for(let a=0;a<e.length;++a)(0===e[a].length||-1!==e[a].indexOf(t)||-1===t)&&n.push(a);return n}function DO(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=[];if("number"==typeof t)IX(e.shape[n]%t===0,(()=>"Number of splits must evenly divide the axis.")),a=new Array(t).fill(e.shape[n]/t);else{const o=t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0);IX(o<=1,(()=>"There should be only one negative value in split array."));const i=t.indexOf(-1);if(-1!==i){const a=t.reduce(((e,t)=>t>0?e+t:e));t[i]=e.shape[n]-a}IX(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),a=t}return a}function UO(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function PO(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function OO(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function _O(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function QO(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function jO(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function qO(e,t){const n=bX(e),a=bX(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(a,". inputShape=").concat(e," outputShape= ").concat(t)}function $O(e,t){const n=bX(e),a=bX(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(a,". inputShape=").concat(e," outputShape=").concat(t)}function e_(){return"segment ids must be >= 0"}function t_(){return"segment ids are not increasing"}function n_(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function a_(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function o_(e,t){let n,a=!1;for(e<=uO?(n=e,a=!0):n=YX(e,Math.floor(Math.sqrt(e)));!a;)n>t||n===e?a=!0:n=YX(e,n+1);return n}function i_(e,t,n){const a=[],o=e.length;for(let i=0;i<o;i++)i!==t?a.push(e[i]):a.push(n);return a}function r_(e,t,n,a){const o=t.shape.length,i=e.shape.length;if(0!==a&&(a<-o||a>o))throw new Error("Expect batchDims in the range of [-".concat(o,", ").concat(o,"], but got ").concat(a));if(a<0&&(a+=o),a>i)throw new Error("batchDims (".concat(a,") must be less than rank(x) (\n    ").concat(i,")."));if(n<a)throw new Error("batchDims (".concat(a,") must be less than or equal to axis (").concat(n,")."));for(let u=0;u<a;++u)if(e.shape[u]!==t.shape[u])throw new Error("x.shape[".concat(u,"]: ").concat(e.shape[u]," should be equal to indices.shape[").concat(u,"]: ").concat(t.shape[u],"."));const r=e.shape[n],s=[];let l=1,c=1,g=1;for(let u=0;u<a;++u)s.push(e.shape[u]),l*=e.shape[u];for(let u=a;u<n;u++)s.push(e.shape[u]),c*=e.shape[u];for(let u=a;u<o;u++)s.push(t.shape[u]);for(let u=n+1;u<i;u++)s.push(e.shape[u]),g*=e.shape[u];return{batchSize:l,sliceSize:g,outerSize:c,dimSize:r,outputShape:s}}const s_=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:r_,computeOutShape:i_,segOpComputeOptimalWindowSize:o_},Symbol.toStringTag,{value:"Module"}));function l_(e){try{return e.map((e=>SH(e)))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(t))}}function c_(e){return e.map((e=>vH(e)))}const g_=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:vO,ERF_A2:SO,ERF_A3:xO,ERF_A4:GO,ERF_A5:ZO,ERF_P:AO,PARALLELIZE_THRESHOLD:uO,get RowPartitionType(){return rO},SELU_SCALE:yO,SELU_SCALEALPHA:bO,applyActivation:PD,assertAndGetBroadcastShape:ez,assertAxesAreInnerMostDims:pz,assertParamsConsistent:oO,assignToTypedArray:VO,axesAreInnerMostDims:gz,calculateShapes:WD,checkEinsumDimSizes:YO,checkPadOnDimRoundingMode:hL,combineLocations:uz,combineRaggedTensorToTensorShapes:sO,complexWithEvenIndex:BO,complexWithOddIndex:RO,computeConv2DInfo:nL,computeConv3DInfo:aL,computeDefaultPad:oL,computeDilation2DInfo:$Y,computeOptimalWindowSize:dO,computeOutAndReduceShapes:dz,computeOutShape:iO,computePool2DInfo:eL,computePool3DInfo:tL,convertConv2DDataFormat:dL,decodeEinsumEquation:HO,eitherStridesOrDilationsAreOne:gL,expandShapeToKeepDim:hz,exponent:XO,exponents:NO,fromStringArrayToUint8:c_,fromUint8ToStringArray:l_,getAxesPermutation:mz,getBroadcastDims:qL,getComplexWithIndex:WO,getEinsumComputePath:LO,getEinsumPermutation:JO,getFusedBiasGradient:UD,getFusedDyActivation:DD,getImageCenter:hO,getInnerMostAxes:Cz,getPermuted:mO,getRaggedRank:cO,getReductionAxes:$L,getReshaped:pO,getReshapedPermuted:IO,getRowPartitionTypesHelper:lO,getSliceBeginCoords:CO,getSliceSize:fO,getSparseFillEmptyRowsIndicesDenseShapeMismatch:UO,getSparseFillEmptyRowsNegativeIndexErrorMessage:PO,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:OO,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:jO,getSparseReshapeInputOutputMismatchErrorMessage:$O,getSparseReshapeInputOutputMultipleErrorMessage:qO,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:_O,getSparseReshapeNegativeOutputDimErrorMessage:QO,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:a_,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:e_,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:t_,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:n_,getUndoAxesPermutation:Iz,isIdentityPermutation:zO,log:function(){nM().getBool("IS_TEST")||nM().getBool("PROD")||console.log(...arguments)},mergeRealAndImagArrays:wO,prepareAndValidate:XP,prepareSplitSize:DO,segment_util:s_,shouldFuse:OD,slice_util:$P,splitRealAndImagArrays:kO,stridesOrDilationsArePositive:uL,tupleValuesAreOne:cL,upcastType:jH,validateDefaultValueShape:gO,validateInput:RD,validateUpdateShape:BD,warn:yF},Symbol.toStringTag,{value:"Module"}));!function(){for(const e of CP)sP(e)}();const u_={kernelName:sM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(e,SD(XY(n,"float32"),-1))}}},d_={kernelName:lM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Sz(XY(n,"float32")),a=vz($z(Az(1),t));return Qz(HY(e,a))}}}},h_={kernelName:cM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=vz($z(Sz(XY(n,"float32")),1));return HY(e,t)}}}},p_={kernelName:gM,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=ez(n.shape,a.shape);return{a:()=>{let t=e;const a=$L(n.shape,o);return a.length>0&&(t=xz(t,a)),pL(t,n.shape)},b:()=>{let t=e;const n=$L(a.shape,o);return n.length>0&&(t=xz(t,n)),pL(t,a.shape)}}}},m_={kernelName:uM,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach(((t,a)=>{n[a]=()=>e.clone()})),n}},I_={kernelName:pM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>oz(n)}}},C_={kernelName:mM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>oz(n)}}},f_={kernelName:IM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,vz($z(Az(1),Sz(XY(n,"float32")))))}}},b_={kernelName:CM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=vz(EY(Az(1),Sz(XY(n,"float32"))));return HY(e,t)}}}},y_={kernelName:yM,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=ez(n.shape,a.shape);return{a:()=>{const t=EY(Sz(n),Sz(a));let i=JY(e,HY(a,t));const r=$L(n.shape,o);return r.length>0&&(i=xz(i,r)),pL(i,n.shape)},b:()=>{const t=EY(Sz(n),Sz(a));let i=Qz(JY(e,HY(n,t)));const r=$L(a.shape,o);return r.length>0&&(i=xz(i,r)),pL(i,a.shape)}}}},A_={kernelName:fM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,EY(Sz(XY(n,"float32")),1))}}},v_={kernelName:bM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,$z(Az(1),Sz(XY(n,"float32"))))}}};const S_=xJ({avgPool3dGrad_:function(e,t,n,a,o,i){const r=AJ(e,"dy","avgPool3dGrad"),s=AJ(t,"input","avgPool3dGrad");let l=r,c=s,g=!1;4===s.rank&&(g=!0,l=pL(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]),c=pL(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),IX(5===l.rank,(()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,"."))),IX(5===c.rank,(()=>"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,"."))),hL("avgPool3dGrad",o,i);const u={dy:l,input:c},d={filterSize:n,strides:a,pad:o,dimRoundingMode:i},h=uJ.runKernel(xM,u,d);return g?pL(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),x_={kernelName:SM,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{filterSize:o,strides:i,pad:r,dimRoundingMode:s}=n;return{x:()=>S_(e,a,o,i,r,s)}}};const G_=xJ({avgPoolGrad_:function(e,t,n,a,o){const i=AJ(e,"dy","avgPoolGrad"),r=AJ(t,"input","avgPoolGrad");IX(r.rank===i.rank,(()=>"Rank of input (".concat(r.rank,") does not match rank of dy (").concat(i.rank,")")));let s=r,l=i,c=!1;3===r.rank&&(c=!0,s=pL(r,[1,r.shape[0],r.shape[1],r.shape[2]]),l=pL(i,[1,i.shape[0],i.shape[1],i.shape[2]])),IX(4===l.rank,(()=>"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(l.rank,"."))),IX(4===s.rank,(()=>"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")));const g={dy:l,input:s},u={filterSize:n,strides:a,pad:o},d=uJ.runKernel(vM,g,u);return c?pL(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Z_={kernelName:AM,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{filterSize:o,strides:i,pad:r}=n;return{x:()=>G_(e,a,o,i,r)}}},w_={kernelName:GM,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[a,o]=t,{transposeA:i,transposeB:r}=n;return i||r?!i&&r?{a:()=>fL(e,o,!1,!1),b:()=>fL(e,a,!0,!1)}:i&&!r?{a:()=>fL(o,e,!1,!0),b:()=>fL(a,e,!1,!1)}:{a:()=>fL(o,e,!0,!0),b:()=>fL(e,a,!0,!0)}:{a:()=>fL(e,o,!1,!0),b:()=>fL(a,e,!0,!1)}}},k_={kernelName:ZM,gradFunc:(e,t,n)=>{const{blockShape:a,crops:o}=n;return{x:()=>yK(e,a,o)}}},B_={kernelName:BM,gradFunc:(e,t,n)=>{const a=n,o=a.inputShape,i=a.shape,r=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])r[l]=1;else if(1!==o[l])throw new Error("broadcastTo(): [".concat(o,"] cannot be broadcast to [").concat(i,"]."));const s=[];for(let l=0;l<r.length;l++)r[l]>1&&s.push(l);return{x:()=>xz(e,s,!0)}}},R_={kernelName:WM,gradFunc:e=>({x:()=>e.clone()})},W_={kernelName:VM,gradFunc:e=>({x:()=>oz(e)})},V_={kernelName:NM,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{clipValueMin:o,clipValueMax:i}=n;return{x:()=>az(nK(Tz(a,o),zz(a,i)),e,oz(e))}}},N_={kernelName:MM,inputsToSave:["x"],gradFunc:u_.gradFunc},X_={kernelName:TM,saveAllInputs:!0,gradFunc:(e,t,n)=>{const a=t.map((e=>e.shape)),{axis:o}=n,i=wX(o,t[0].shape)[0],r=a.map((e=>e[i]));return fD(e,r,i).map((e=>()=>e))}},M_={kernelName:EM,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[a,o]=t,{dilations:i,strides:r,pad:s,dataFormat:l}=n;return IX(cL(i),(()=>"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(i,"'"))),{x:()=>HL(a.shape,e,o,r,s,l),filter:()=>KD(a,e,o.shape,r,s,l)}}},T_={kernelName:HM,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[a,o]=t,{strides:i,pad:r,dataFormat:s,dimRoundingMode:l}=n;return{dy:()=>EL(e,o,i,r,s,1,l),filter:()=>KD(e,a,o.shape,i,r,s,l)}}};const E_=xJ({conv3DBackpropFilter_:function(e,t,n,a,o){let i=e;4===e.rank&&(i=pL(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let r=t;4===r.rank&&(r=pL(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),IX(5===i.rank,(()=>"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,"."))),IX(5===r.rank,(()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(r.shape,"."))),IX(5===n.length,(()=>"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,"."))),IX(i.shape[4]===n[3],(()=>"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],"."))),IX(r.shape[4]===n[4],(()=>"Error in conv3dDerFilter: depth of dy (".concat(r.shape[4],") must match output depth for filter (").concat(n[4],").")));const s={x:i,dy:r},l={strides:a,pad:o,filterShape:n};return uJ.runKernel(YM,s,l)}}),F_={kernelName:JM,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:a,strides:o,pad:i}=n;IX(cL(a),(()=>"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(a,"'")));const[r,s]=t;return{x:()=>LL(r.shape,e,s,o,i),filter:()=>E_(r,e,s.shape,o,i)}}},H_={kernelName:zM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(Qz(lD(XY(n,"float32"))),e)}}},J_={kernelName:KM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(cD(XY(n,"float32")),e)}}},Y_={kernelName:UM,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{axis:o,exclusive:i,reverse:r}=n;return{x:()=>{const t=mz([o],a.rank);let n=PL(e,o,i,!r);return null!=t&&(n=JD(n,t)),n}}}},L_={kernelName:QM,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:a,strides:o,pad:i,dimRoundingMode:r}=n,s=null!==a&&void 0!==a?a:[1,1];IX(cL(s),(()=>"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")));const[l,c]=t;return IX(4===l.rank,(()=>"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(l.rank,"."))),IX(4===c.rank,(()=>"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(c.rank,"."))),IX(l.shape[3]===c.shape[2],(()=>"Error in gradient of depthwiseConv2d: number of input channels (".concat(l.shape[3],") must match the inChannels dimension in filter ").concat(c.shape[2],"."))),IX(gL(o,s),(()=>"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(o," and dilations '").concat(s,"'."))),hL("depthwiseConv2d",i,r),{x:()=>jD(l.shape,e,c,o,i,s,r),filter:()=>QD(l,e,c.shape,o,i,s,r)}}},z_={kernelName:eT,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[a,o]=t,i={x:a,filter:o,dy:e},r={x:a,filter:o,dy:e};return{x:()=>uJ.runKernel(tT,i,n),filter:()=>uJ.runKernel(nT,r,n)}}},K_={kernelName:rT,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,a={dy:e,y:n};return{x:()=>uJ.runKernel(sT,a)}}},D_={kernelName:lT,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,a=JY(kz(Qz(Sz(n))),2/Math.sqrt(Math.PI));return{x:()=>JY(e,a)}}},U_={kernelName:gT,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(e,n)}}},P_={kernelName:uT,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>pL(e,n.shape)}}},O_={kernelName:dT,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(e,kz(n))}}},__={kernelName:IT,gradFunc:e=>({x:()=>oz(e)})},Q_={kernelName:CT,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=ez(n.shape,a.shape);return{a:()=>{const t=HY(e,XY(a,"float32")),i=$L(n.shape,o);return i.length>0?pL(xz(t,i),n.shape):t},b:()=>{let t=JY(e,XY(n,"float32"));const i=$L(a.shape,o);i.length>0&&(t=pL(xz(t,i),a.shape));const r=Sz(a);return Qz(HY(t,XY(r,"float32")))}}}},j_={kernelName:fT,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:a}=n,[o,i,r,s]=t,l=null!==s&&void 0!==s?s:Az(1),c=$L(i.shape,o.shape),g=[];if(1===i.rank){for(let e=0;e<o.shape.length-1;++e)g.push(o.shape[e]);g.push(1)}const u=$z(o,i),d=JY(e,l),h=oD(EY(r,Az(a))),p=JY(JY(JY(h,h),h),Az(-.5));return{x:()=>1===i.rank?pL(JY(JY(e,Wz(pL(h,[1,1,1,i.shape[0]]),g)),l),o.shape):pL(JY(JY(e,h),l),o.shape),mean:()=>{let e=JY(JY(h,Az(-1)),d);return 1===i.rank&&(e=xz(e,c)),pL(e,i.shape)},variance:()=>{let e=JY(JY(p,u),d);return 1===i.rank&&(e=xz(e,c)),pL(e,i.shape)},scale:()=>{const t=JY(u,h);let n=JY(e,t);return 1===i.rank&&(n=xz(n,c)),pL(n,i.shape)},offset:()=>{let t=e;return 1===i.rank&&(t=xz(t,c)),pL(t,i.shape)}}}},q_={kernelName:bT,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[a,o]=t,{axis:i,batchDims:r}=n,s=wX(i,a.shape)[0],l=(e,t,n)=>()=>{const a=e.shape,o=t.size,r=a.slice(0,s),l=r.length,c=a.slice(i,a.length).slice(1),g=c.length,u=$_(0,l),d=$_(l+1,l+1+g),h=eQ([r,[o],c]),p=pL(n,h),m=pL(t,[o]),I=eQ([[l],u,d]),C=JD(p,I);let f=TD(C,m,e.shape[s]);const b=Iz(I);return f=JD(f,b),f};if(1===r){const t=a.shape[0],n=a.split(t,0);return{x:()=>vD(n.map(((t,n)=>l(t,o.slice(n,1),e.slice(n,1))()))).reshape(a.shape),indices:()=>o}}return{x:l(a,o,e),indices:()=>o}}};function $_(e,t){const n=[];for(let a=e;a<t;++a)n.push(a);return n}function eQ(e){const t=[];for(let n=0;n<e.length;++n)for(let a=0;a<e[n].length;++a)t.push(e[n][a]);return t}const tQ={kernelName:vT,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t;return{a:()=>oz(n),b:()=>oz(a)}}},nQ={kernelName:ST,gradFunc:e=>({x:()=>XY(e,"float32")})},aQ={kernelName:ZT,gradFunc:e=>({x:()=>oz(e)})},oQ={kernelName:wT,gradFunc:e=>({x:()=>oz(e)})},iQ={kernelName:kT,gradFunc:e=>({x:()=>oz(e)})},rQ={kernelName:BT,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{alpha:o}=n,i=Mz(a,0);return{x:()=>az(i,e,JY(e,o))}}},sQ={kernelName:XT,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,EY(n,1))}}},lQ={kernelName:NT,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,XY(n,"float32"))}}},cQ={kernelName:FT,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[a]=t,{axis:o}=n;return{logits:()=>{const t=kz(a);return $z(e,JY(xz(e,o,!0),t))}}}};const gQ=xJ({localResponseNormalizationBackprop_:function(e,t,n){const a={x:e,y:t,dy:n},o={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return uJ.runKernel(JT,a,o)}}),uQ={kernelName:HT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[a,o]=t,{depthRadius:i,bias:r,alpha:s,beta:l}=n;return{x:()=>gQ(a,o,e,i,r,s,l)}}};function dQ(e,t,n,a){return t.rank<n.rank&&(t=pL(t,hz(t.shape,a))),e.rank<n.rank&&(e=pL(e,hz(e.shape,a))),{x:()=>JY(e,XY(nz(n,t),e.dtype))}}const hQ={kernelName:YT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const a=n,{reductionIndices:o}=a,i=t[0],r=dQ(e,t[1],i,wX(o,i.shape));return{x:()=>r.x()}}},pQ={kernelName:LT,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t;return{a:()=>JY(e,XY(Tz(n,a),"float32")),b:()=>JY(e,XY(Lz(n,a),"float32"))}}};const mQ=xJ({maxPool3dGrad_:function(e,t,n,a,o,i,r){const s=AJ(e,"dy","maxPool3dGrad"),l=AJ(t,"input","maxPool3dGrad"),c=AJ(n,"output","maxPool3dGrad");let g=s,u=l,d=c,h=!1;4===l.rank&&(h=!0,g=pL(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),u=pL(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=pL(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),IX(5===g.rank,(()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(g.rank,"."))),IX(5===u.rank,(()=>"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(u.rank,"."))),IX(5===d.rank,(()=>"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(d.rank,"."))),hL("maxPool3dGrad",i,r);const p={dy:g,input:u,output:d},m={filterSize:a,strides:o,pad:i,dimRoundingMode:r},I=uJ.runKernel(UT,p,m);return h?pL(I,[I.shape[1],I.shape[2],I.shape[3],I.shape[4]]):I}}),IQ={kernelName:DT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[a,o]=t,{filterSize:i,strides:r,pad:s,dimRoundingMode:l}=n;return{x:()=>mQ(e,a,o,i,r,s,l)}}};const CQ=xJ({maxPoolGrad_:function(e,t,n,a,o,i,r){const s=AJ(e,"dy","maxPoolGrad"),l=AJ(t,"input","maxPoolGrad"),c=AJ(n,"output","maxPoolGrad");IX(l.rank===s.rank,(()=>"Rank of input (".concat(l.rank,") does not match rank of dy (").concat(s.rank,")"))),IX(4===s.rank,(()=>"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,"."))),IX(4===l.rank,(()=>"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(l.rank,"."))),hL("maxPoolGrad",i,r);const g={dy:s,input:l,output:c},u={filterSize:a,strides:o,pad:i,dimRoundingMode:r};return uJ.runKernel(KT,g,u)}}),fQ={kernelName:zT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[a,o]=t,{filterSize:i,strides:r,pad:s}=n;return{x:()=>CQ(e,a,o,i,r,s)}}},bQ={kernelName:OT,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{axis:o}=n,i=wX(o,a.shape),r=bX(dz(a.shape,i)[1]);return{x:()=>{const t=a.shape.slice();i.forEach((e=>{t[e]=1}));const n=pL(e,t);return HY(JY(n,uK(a.shape,"float32")),r)}}}},yQ={kernelName:_T,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const a=n,{axis:o}=a,[i,r]=t,s=dQ(e,r,i,wX(o,i.shape));return{x:()=>s.x()}}},AQ={kernelName:QT,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t;return{a:()=>JY(e,XY(zz(n,a),"float32")),b:()=>JY(e,XY(Mz(n,a),"float32"))}}},vQ={kernelName:jT,inputsToSave:["x"],gradFunc:(e,t,n)=>{const a=t[0],{paddings:o}=n,i=o.map((e=>e[0]));return{x:()=>yL(e,i,a.shape)}}},SQ={kernelName:qT,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=ez(n.shape,a.shape);return{a:()=>{const t=$L(n.shape,o);return t.length>0?pL(xz(e,t),n.shape):e},b:()=>{const t=JY(e,Qz(Nz(HY(n,a)))),i=$L(a.shape,o);return i.length>0?pL(xz(t,i),a.shape):t}}}},xQ={kernelName:eE,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=ez(n.shape,a.shape);return{a:()=>{const t=JY(e,XY(a,"float32")),i=$L(n.shape,o);return i.length>0?pL(xz(t,i),n.shape):t},b:()=>{const t=JY(e,XY(n,"float32")),i=$L(a.shape,o);return i.length>0?pL(xz(t,i),a.shape):t}}}},GQ={kernelName:tE,gradFunc:e=>({x:()=>Qz(e)})},ZQ={kernelName:rE,gradFunc:e=>({x:()=>oz(e)})},wQ={kernelName:lE,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:a}=n;return ED(e,a).map((e=>()=>e))}},kQ={kernelName:cE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const a=t[0],{paddings:o}=n,i=o.map((e=>e[0]));return{x:()=>yL(e,i,a.shape)}}},BQ={kernelName:gE,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,a,o]=t,i=n,r=a,s=ez(i.shape,r.shape);return{a:()=>{const t=XY(r,"float32");let n=JY(e,JY(t,yz(i,$z(t,Az(1)))));const a=$L(i.shape,s);return a.length>0&&(n=xz(n,a)),pL(n,i.shape)},b:()=>{const t=Mz(i,0),n=az(t,Dz(i),oz(i));let a=JY(e,JY(o,n));const l=$L(r.shape,s);return l.length>0&&(a=xz(a,l)),pL(a,r.shape)}}}},RQ={kernelName:uE,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,a]=t,o=Mz(n,0);return{x:()=>az(o,e,JY(e,a)),alpha:()=>{let t=az(o,oz(e),JY(e,n));const i=$L(a.shape,e.shape);return i.length>0&&(t=xz(t,i)),pL(t,a.shape)}}}};function WQ(e,t,n){const a=e.shape.length,o=a-n.length,i=mz(n,a);let r=e;null!=i&&(r=JD(e,i));const s=r.shape.slice(),l=s.splice(a-n.length,n.length).reduce(((e,t)=>e*t),1);s.push(l);let c=function(e,t,n){const a=e.shape.slice();a[n]=1;const o=pL(t,a),i=UL(e,n,!0,!1),r=UL(e,n,!0,!0),s=JY(i,r);return JY(o,s)}(r.reshape(s),t,o);if(c=c.reshape(r.shape),null!=i){const e=Iz(i);c=JD(c,e)}return c}const VQ={kernelName:dE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{axis:o}=n;let i=[];return i=null==o?a.shape.map(((e,t)=>t)):"number"==typeof o?[o]:o,{x:()=>WQ(a,e,i)}}},NQ={kernelName:oT,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=ez(n.shape,a.shape);return{a:()=>{const t=HY(e,XY(a,"float32")),i=$L(n.shape,o);return i.length>0?pL(xz(t,i),n.shape):t},b:()=>{let t=JY(e,XY(n,"float32"));const i=$L(a.shape,o);i.length>0&&(t=pL(xz(t,i),a.shape));const r=Sz(a);return Qz(HY(t,XY(r,"float32")))}}}},XQ={kernelName:fE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,Qz(Sz(n)))}}},MQ={kernelName:GE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,a=JY(zz(n,6),SD(n));return{x:()=>JY(e,XY(a,"float32"))}}},TQ={kernelName:bE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(e,XY(SD(n),"float32"))}}},EQ={kernelName:yE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pL(e,n.shape)}}},FQ={kernelName:SE,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[a]=t,o={dy:e,images:a};return{images:()=>uJ.runKernel(xE,o,n)}}},HQ={kernelName:AE,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[a]=t,o={dy:e,images:a};return{images:()=>uJ.runKernel(vE,o,n)}}},JQ={kernelName:ZE,gradFunc:(e,t,n)=>{const{dims:a}=n,o=wX(a,e.shape);return{x:()=>nD(e,o)}}},YQ={kernelName:wE,gradFunc:e=>({x:()=>oz(e)})},LQ={kernelName:kE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Qz(HY(e,JY(yz(n,1.5),2)))}}},zQ={kernelName:VE,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>XY(oz(n),"float32"),t:()=>JY(e,XY(n,e.dtype)),e:()=>JY(e,XY(aK(n),e.dtype))}}},KQ={kernelName:NE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Mz(n,Az(0)),a=Az(bO),o=Az(yO),i=JY(e,o),r=JY(JY(e,a),kz(XY(n,"float32")));return az(t,i,r)}}}},DQ={kernelName:FE,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(e,JY(n,$z(Az(1),n)))}}},UQ={kernelName:EE,gradFunc:e=>({x:()=>oz(e)})},PQ={kernelName:ME,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(KL(XY(n,"float32")),e)}}},OQ={kernelName:TE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(DL(XY(n,"float32")),e)}}},_Q={kernelName:XE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{begin:o,size:i}=n,r=a.shape,[s,l]=QP(a,o,i),c=[];for(let g=0;g<e.rank;g++)c.push([s[g],r[g]-s[g]-l[g]]);return{x:()=>bK(e,c)}}},QQ={kernelName:KE,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[a]=t,{dim:o}=n,i=JY(e,a);return{logits:()=>$z(i,JY(xz(i,[o],true),a))}}},jQ={kernelName:HE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(e,bL(n))}}},qQ={kernelName:LE,gradFunc:(e,t,n)=>{const{blockShape:a,paddings:o}=n;return{x:()=>vL(e,a,o)}}},$Q={kernelName:zE,gradFunc:(e,t,n)=>{const{axis:a}=n;return{x:()=>CL(e,a)}}},ej={kernelName:JE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,JY(vz(XY(n,"float32")),2))}}},tj={kernelName:jE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY(e,JY(XY(n,"float32"),2))}}},nj={kernelName:QE,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=Az(2);return{a:()=>JY(e,JY(o,$z(n,a))),b:()=>JY(e,JY(o,$z(a,n)))}}},aj={kernelName:pF,gradFunc:e=>({x:()=>oz(e)})},oj={kernelName:aF,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,a]=t,o=ez(n.shape,a.shape);return{a:()=>{let t=e;const a=$L(n.shape,o);return a.length>0&&(t=xz(t,a)),pL(t,n.shape)},b:()=>{let t=e;const n=$L(a.shape,o);return n.length>0&&(t=xz(t,n)),pL(Qz(t),a.shape)}}}},ij={kernelName:YE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,o=a.shape.slice(),{axis:i}=n;wX(i,a.shape).forEach((e=>{o[e]=1}));const r=pL(e,o),s=JY(r,uK(a.shape,"float32"));return{x:()=>s}}},rj={kernelName:oF,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>HY(e,Sz(KL(n)))}}},sj={kernelName:iF,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>JY($z(Az(1),Sz(n)),e)}}},lj={kernelName:rF,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[a]=t,{reps:o}=n;return{x:()=>{let t=oz(a);if(1===a.rank)for(let n=0;n<o[0];++n)t=EY(t,yL(e,[n*a.shape[0]],[a.shape[0]]));else if(2===a.rank)for(let n=0;n<o[0];++n)for(let i=0;i<o[1];++i)t=EY(t,yL(e,[n*a.shape[0],i*a.shape[1]],[a.shape[0],a.shape[1]]));else if(3===a.rank)for(let n=0;n<o[0];++n)for(let i=0;i<o[1];++i)for(let r=0;r<o[2];++r)t=EY(t,yL(e,[n*a.shape[0],i*a.shape[1],r*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(4!==a.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(a.rank," tensors yet."));for(let n=0;n<o[0];++n)for(let i=0;i<o[1];++i)for(let r=0;r<o[2];++r)for(let s=0;s<o[3];++s)t=EY(t,yL(e,[n*a.shape[0],i*a.shape[1],r*a.shape[2],s*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return t}}}},cj={kernelName:cF,gradFunc:(e,t,n)=>{const a=n,{perm:o}=a,i=Iz(o);return{x:()=>JD(e,i)}}},gj={kernelName:uF,gradFunc:(e,t,n)=>{const a=n,{axis:o}=a;return{value:()=>vD(e,o)}}},uj={kernelName:dF,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=lK(t,oz(t)),a=Xz(e,n);let o=Tz(t,Az(0,"int32"));const i=a.rank-o.rank;for(let s=0;s<i;++s)o=Bz(o,s+1);o=nK(o,uK(a.shape,"bool"));const r=oz(a);return az(o,a,r)}(e,n)}}};const dj={kernelName:hF,gradFunc:e=>({x:()=>oz(e)})},hj=[u_,d_,h_,p_,m_,I_,C_,f_,b_,y_,A_,v_,x_,Z_,w_,k_,B_,R_,W_,V_,N_,X_,T_,M_,F_,H_,J_,Y_,L_,z_,NQ,K_,D_,U_,P_,O_,Q_,__,j_,q_,tQ,nQ,aQ,oQ,iQ,rQ,sQ,lQ,cQ,uQ,hQ,hQ,pQ,IQ,fQ,bQ,yQ,AQ,vQ,SQ,xQ,GQ,{kernelName:sE,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>gK(n.shape,"float32")}}},ZQ,wQ,kQ,kQ,BQ,RQ,VQ,XQ,MQ,TQ,EQ,FQ,HQ,JQ,YQ,LQ,zQ,KQ,DQ,UQ,PQ,OQ,_Q,QQ,jQ,qQ,qQ,$Q,$Q,ej,nj,tj,aj,oj,ij,rj,sj,lj,cj,gj,uj,dj];for(const n of hj)wF(n);LH().prototype.abs=function(){return this.throwIfDisposed(),YY(this)},LH().prototype.acos=function(){return this.throwIfDisposed(),LY(this)},LH().prototype.acosh=function(){return this.throwIfDisposed(),zY(this)},LH().prototype.add=function(e){return this.throwIfDisposed(),EY(this,e)},LH().prototype.all=function(e,t){return this.throwIfDisposed(),KY(this,e,t)},LH().prototype.any=function(e,t){return this.throwIfDisposed(),DY(this,e,t)},LH().prototype.argMax=function(e){return this.throwIfDisposed(),UY(this,e)},LH().prototype.argMin=function(e){return this.throwIfDisposed(),PY(this,e)},LH().prototype.asScalar=function(){return this.throwIfDisposed(),IX(1===this.size,(()=>"The array must have only 1 element.")),pL(this,[])},LH().prototype.asType=function(e){return this.throwIfDisposed(),XY(this,e)},LH().prototype.as1D=function(){return this.throwIfDisposed(),pL(this,[this.size])},LH().prototype.as2D=function(e,t){return this.throwIfDisposed(),pL(this,[e,t])},LH().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),pL(this,[e,t,n])},LH().prototype.as4D=function(e,t,n,a){return this.throwIfDisposed(),pL(this,[e,t,n,a])},LH().prototype.as5D=function(e,t,n,a,o){return this.throwIfDisposed(),pL(this,[e,t,n,a,o])},LH().prototype.asin=function(){return this.throwIfDisposed(),OY(this)},LH().prototype.asinh=function(){return this.throwIfDisposed(),_Y(this)},LH().prototype.atan=function(){return this.throwIfDisposed(),QY(this)},LH().prototype.atan2=function(e){return this.throwIfDisposed(),jY(this,e)},LH().prototype.atanh=function(){return this.throwIfDisposed(),qY(this)},LH().prototype.avgPool=function(e,t,n,a){return this.throwIfDisposed(),mL(this,e,t,n,a)},LH().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),vL(this,e,t)},LH().prototype.batchNorm=function(e,t,n,a,o){return this.throwIfDisposed(),xL(this,e,t,n,a,o)},LH().prototype.broadcastTo=function(e){return this.throwIfDisposed(),BL(this,e)},LH().prototype.cast=function(e){return this.throwIfDisposed(),XY(this,e)},LH().prototype.ceil=function(){return this.throwIfDisposed(),RL(this)},LH().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),VL(this,e,t)},LH().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof YH&&(e=[e]),CL([this,...e],t)},LH().prototype.conv1d=function(e,t,n,a,o,i){return this.throwIfDisposed(),FL(this,e,t,n,a,o,i)},LH().prototype.conv2dTranspose=function(e,t,n,a,o){return this.throwIfDisposed(),JL(this,e,t,n,a,o)},LH().prototype.conv2d=function(e,t,n,a,o,i){return this.throwIfDisposed(),EL(this,e,t,n,a,o,i)},LH().prototype.cos=function(){return this.throwIfDisposed(),KL(this)},LH().prototype.cosh=function(){return this.throwIfDisposed(),DL(this)},LH().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),UL(this,e,t,n)},LH().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),PL(this,e,t,n)},LH().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),_L(this,e,t)},LH().prototype.depthwiseConv2d=function(e,t,n,a,o,i){return this.throwIfDisposed(),QL(this,e,t,n,a,o,i)},LH().prototype.dilation2d=function(e,t,n,a,o){return this.throwIfDisposed(),jL(this,e,t,n,a,o)},LH().prototype.divNoNan=function(e){return this.throwIfDisposed(),iz(this,e)},LH().prototype.div=function(e){return this.throwIfDisposed(),HY(this,e)},LH().prototype.dot=function(e){return this.throwIfDisposed(),rz(this,e)},LH().prototype.elu=function(){return this.throwIfDisposed(),lz(this)},LH().prototype.equal=function(e){return this.throwIfDisposed(),nz(this,e)},LH().prototype.erf=function(){return this.throwIfDisposed(),cz(this)},LH().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),wz(this,e,t)},LH().prototype.exp=function(){return this.throwIfDisposed(),kz(this)},LH().prototype.expandDims=function(e){return this.throwIfDisposed(),Bz(this,e)},LH().prototype.expm1=function(){return this.throwIfDisposed(),Rz(this)},LH().prototype.fft=function(){return this.throwIfDisposed(),mD(this)},LH().prototype.flatten=function(){return this.throwIfDisposed(),pL(this,[this.size])},LH().prototype.floor=function(){return this.throwIfDisposed(),Nz(this)},LH().prototype.floorDiv=function(e){return this.throwIfDisposed(),FY(this,e)},LH().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Xz(this,e,t,n)},LH().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Tz(this,e)},LH().prototype.greater=function(e){return this.throwIfDisposed(),Mz(this,e)},LH().prototype.ifft=function(){return this.throwIfDisposed(),ID(this)},LH().prototype.irfft=function(){return this.throwIfDisposed(),CD(this)},LH().prototype.isFinite=function(){return this.throwIfDisposed(),Fz(this)},LH().prototype.isInf=function(){return this.throwIfDisposed(),Hz(this)},LH().prototype.isNaN=function(){return this.throwIfDisposed(),Jz(this)},LH().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Yz(this,e)},LH().prototype.lessEqual=function(e){return this.throwIfDisposed(),zz(this,e)},LH().prototype.less=function(e){return this.throwIfDisposed(),Lz(this,e)},LH().prototype.localResponseNormalization=function(e,t,n,a){return this.throwIfDisposed(),Kz(this,e,t,n,a)},LH().prototype.logSigmoid=function(){return this.throwIfDisposed(),qz(this)},LH().prototype.logSoftmax=function(e){return this.throwIfDisposed(),eK(this,e)},LH().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),tK(this,e,t)},LH().prototype.log=function(){return this.throwIfDisposed(),Dz(this)},LH().prototype.log1p=function(){return this.throwIfDisposed(),Uz(this)},LH().prototype.logicalAnd=function(e){return this.throwIfDisposed(),nK(this,e)},LH().prototype.logicalNot=function(){return this.throwIfDisposed(),aK(this)},LH().prototype.logicalOr=function(e){return this.throwIfDisposed(),oK(this,e)},LH().prototype.logicalXor=function(e){return this.throwIfDisposed(),iK(this,e)},LH().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),fL(this,e,t,n)},LH().prototype.maxPool=function(e,t,n,a){return this.throwIfDisposed(),rK(this,e,t,n,a)},LH().prototype.max=function(e,t){return this.throwIfDisposed(),fz(this,e,t)},LH().prototype.maximum=function(e){return this.throwIfDisposed(),lK(this,e)},LH().prototype.mean=function(e,t){return this.throwIfDisposed(),cK(this,e,t)},LH().prototype.min=function(e,t){return this.throwIfDisposed(),bz(this,e,t)},LH().prototype.minimum=function(e){return this.throwIfDisposed(),dK(this,e)},LH().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),hK(this,e,t)},LH().prototype.mod=function(e){return this.throwIfDisposed(),pK(this,e)},LH().prototype.mul=function(e){return this.throwIfDisposed(),JY(this,e)},LH().prototype.neg=function(){return this.throwIfDisposed(),Qz(this)},LH().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Zz(this,e,t,n)},LH().prototype.notEqual=function(e){return this.throwIfDisposed(),IK(this,e)},LH().prototype.oneHot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),CK(this,e,t,n)},LH().prototype.onesLike=function(){return this.throwIfDisposed(),fK(this)},LH().prototype.pad=function(e,t){return this.throwIfDisposed(),bK(this,e,t)},LH().prototype.pool=function(e,t,n,a,o,i){return this.throwIfDisposed(),AK(this,e,t,n,a,o,i)},LH().prototype.pow=function(e){return this.throwIfDisposed(),yz(this,e)},LH().prototype.prelu=function(e){return this.throwIfDisposed(),vK(this,e)},LH().prototype.prod=function(e,t){return this.throwIfDisposed(),SK(this,e,t)},LH().prototype.reciprocal=function(){return this.throwIfDisposed(),$K(this)},LH().prototype.relu=function(){return this.throwIfDisposed(),eD(this)},LH().prototype.relu6=function(){return this.throwIfDisposed(),tD(this)},LH().prototype.reshapeAs=function(e){return this.throwIfDisposed(),pL(this,e.shape)},LH().prototype.reshape=function(e){return this.throwIfDisposed(),pL(this,e)},LH().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),xU(this,e,t,n)},LH().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),GU(this,e,t,n)},LH().prototype.reverse=function(e){return this.throwIfDisposed(),nD(this,e)},LH().prototype.rfft=function(){return this.throwIfDisposed(),bD(this)},LH().prototype.round=function(){return this.throwIfDisposed(),aD(this)},LH().prototype.rsqrt=function(){return this.throwIfDisposed(),oD(this)},LH().prototype.selu=function(){return this.throwIfDisposed(),iD(this)},LH().prototype.separableConv2d=function(e,t,n,a,o,i){return this.throwIfDisposed(),rD(this,e,t,n,a,o,i)},LH().prototype.sigmoid=function(){return this.throwIfDisposed(),bL(this)},LH().prototype.sign=function(){return this.throwIfDisposed(),sD(this)},LH().prototype.sin=function(){return this.throwIfDisposed(),lD(this)},LH().prototype.sinh=function(){return this.throwIfDisposed(),cD(this)},LH().prototype.slice=function(e,t){return this.throwIfDisposed(),yL(this,e,t)},LH().prototype.softmax=function(e){return this.throwIfDisposed(),pD(this,e)},LH().prototype.softplus=function(){return this.throwIfDisposed(),jz(this)},LH().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),yK(this,e,t)},LH().prototype.split=function(e,t){return this.throwIfDisposed(),fD(this,e,t)},LH().prototype.sqrt=function(){return this.throwIfDisposed(),vz(this)},LH().prototype.square=function(){return this.throwIfDisposed(),Sz(this)},LH().prototype.squaredDifference=function(e){return this.throwIfDisposed(),yD(this,e)},LH().prototype.squeeze=function(e){return this.throwIfDisposed(),AD(this,e)},LH().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof YH?[this,e]:[this,...e];return vD(n,t)},LH().prototype.step=function(e){return this.throwIfDisposed(),SD(this,e)},LH().prototype.stridedSlice=function(e,t,n,a,o,i,r,s){return this.throwIfDisposed(),xD(this,e,t,n,a,o,i,r,s)},LH().prototype.sub=function(e){return this.throwIfDisposed(),$z(this,e)},LH().prototype.sum=function(e,t){return this.throwIfDisposed(),xz(this,e,t)},LH().prototype.tan=function(){return this.throwIfDisposed(),GD(this)},LH().prototype.tanh=function(){return this.throwIfDisposed(),AL(this)},LH().prototype.tile=function(e){return this.throwIfDisposed(),Wz(this,e)},LH().prototype.toBool=function(){return this.throwIfDisposed(),XY(this,"bool")},LH().prototype.toFloat=function(){return this.throwIfDisposed(),XY(this,"float32")},LH().prototype.toInt=function(){return this.throwIfDisposed(),XY(this,"int32")},LH().prototype.topk=function(e,t){return this.throwIfDisposed(),ND(this,e,t)},LH().prototype.transpose=function(e){return this.throwIfDisposed(),JD(this,e)},LH().prototype.unique=function(e){return this.throwIfDisposed(),MD(this,e)},LH().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),TD(this,e,t)},LH().prototype.unstack=function(e){return this.throwIfDisposed(),ED(this,e)},LH().prototype.where=function(e,t){return this.throwIfDisposed(),az(e,this,t)},LH().prototype.zerosLike=function(){return this.throwIfDisposed(),oz(this)};class pj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pj.prototype)}}class mj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mj.prototype)}}class Ij extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ij.prototype)}}class Cj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Cj.prototype)}}class fj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,fj.prototype)}}class bj{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}function yj(e,t){if(Array.isArray(e)){let n=[];for(let a=0;a<t;a++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function Aj(e,t){if(!e)throw new fj(t)}function vj(e,t){let n=0;for(const a of e)a===t&&n++;return n}function Sj(e){return 1===e.length?e[0]:e}function xj(e){return Array.isArray(e)?e:[e]}function Gj(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function Zj(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,((e,t)=>t.toUpperCase()))}let wj={};function kj(e){if(null==e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Bj(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((e=>Bj(e)));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"==typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!=typeof t.value?Bj(t):e[n]=t.value)}}}function Rj(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){const o=e;let i;if(o in n)i=n[o];else if(o in wj)i=wj[o];else if(i=t[o],null==i)throw new Ij("Unknown ".concat(a,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(a," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(a," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}{const i=e;if(null==i.className||null==i.config)throw new Ij("".concat(a,": Improper config format: ").concat(JSON.stringify(i),".\n'className' and 'config' must set."));const r=i.className;let s,l;if(r in n?[s,l]=n[r]:r in wj?[s,l]=wj.className:r in t&&([s,l]=t[r]),null==s)throw new Ij("Unknown ".concat(a,": ").concat(r,". This may be due to one of the following reasons:\n1. The ").concat(a," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(a," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=l){const e={};for(const n of Object.keys(wj))e[n]=wj[n];for(const o of Object.keys(n))e[o]=n[o];i.config.customObjects=e;const t=Object.assign({},wj);for(const o of Object.keys(n))wj[o]=n[o];Bj(i.config);const a=l(s,i.config,n,o);return wj=Object.assign({},t),a}{const e=Object.assign({},wj);for(const a of Object.keys(n))wj[a]=n[a];const t=new s(i.config);return wj=Object.assign({},e),t}}}function Wj(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Vj(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function Nj(e){if(null==e)throw new Ij("Invalid value in obj: ".concat(JSON.stringify(e)));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function Xj(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new Ij("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Mj(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return Aj(n>=0),Aj(a>=n),Array.isArray(e)&&e.length>=n&&e.length<=a&&e.every((e=>typeof e===t))}function Tj(e,t){Array.isArray(e)?(IX(e.length>0,(()=>"".concat(t," is unexpectedly an empty array."))),e.forEach(((e,n)=>Tj(e,"element ".concat(n+1," of ").concat(t))))):IX(Number.isInteger(e)&&e>0,(()=>"Expected ".concat(t," to be a positive integer, but got ").concat(Ej(e),".")))}function Ej(e){return null===e?"null":Array.isArray(e)?"["+e.map((e=>Ej(e))).join(",")+"]":"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function Fj(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}let Hj=0;function Jj(){return Hj++}const Yj={};function Lj(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in Yj||(Yj[e]=0),Yj[e]+=1,e+Yj[e].toString()}const zj=["channelsFirst","channelsLast"],Kj=["nearest","bilinear"],Dj=["valid","same","causal"],Uj=["max","avg"],Pj=["sum","mul","concat","ave"],Oj=new Map;function _j(e){Xj(zj,"DataFormat",e)}function Qj(e){Xj(Dj,"PaddingMode",e)}function jj(e){Xj(Uj,"PoolMode",e)}const qj=[],$j="/";function eq(e,t){qj.push(e);try{const e=t();return qj.pop(),e}catch(Pke){throw qj.pop(),Pke}}function tq(e){if(!oq(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===qj.length?"":qj.join($j)+$j)+e}function nq(e){if(!oq(e))throw new Error("Not a valid tensor name: '"+e+"'");Oj.has(e)||Oj.set(e,0);const t=Oj.get(e);if(Oj.set(e,Oj.get(e)+1),t>0){const n="".concat(e,"_").concat(t);return Oj.set(n,1),n}return e}const aq=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function oq(e){return!!e.match(aq)}function iq(e){return e===parseInt(e.toString(),10)}function rq(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let a=1;for(let o=t;o<n;++o)a*=e[o];return a}function sq(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const a=e[n];a<t&&(t=a)}return t}function lq(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const a=e[n];a>t&&(t=a)}return t}function cq(e,t){if(t<e)throw new Ij("end (".concat(t,") < begin (").concat(e,") is forbidden."));const n=[];for(let a=e;a<t;++a)n.push(a);return n}let gq;function uq(){return null==gq&&(gq=EJ().epsilon()),gq}function dq(e,t){return XY(e,t)}function hq(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),pL(e,n)}function pq(e,t,n){return VJ((()=>{switch(e.rank){case 1:return gD(e,t,n);case 2:return uD(e,[t,0],[n,e.shape[1]]);case 3:return dD(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return hD(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return yL(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return yL(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new Ij("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function mq(e,t,n){return VJ((()=>{switch(e.rank){case 1:return gD(e,t,n);case 2:return uD(e,[0,t],[e.shape[0],n]);case 3:return dD(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return hD(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new Ij("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Iq(e,t,n,a){return VJ((()=>{switch(e.rank){case 1:return gD(e,t,n);case 2:switch(a){case 1:return pq(e,t,n);case 2:return mq(e,t,n);default:throw new Ij("The axis is not within the rank of the tensor ".concat(a))}case 3:switch(a){case 1:return pq(e,t,n);case 2:return dD(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return mq(e,t,n);default:throw new Ij("The axis is not within the rank of the tensor ".concat(a))}case 4:switch(a){case 1:return pq(e,t,n);case 2:return hD(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return hD(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return mq(e,t,n);default:throw new Ij("The axis is not within the rank of the tensor ".concat(a))}default:throw new Ij("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Cq(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(t=e[0].rank,n=0!==t?t:0),n===e[0].rank&&(n=-1),CL(e,n)}function fq(e,t){switch(e.rank){case 1:return NL([e,t]);case 2:return XL([e,t],0);case 3:return ML([e,t],0);case 4:return TL([e,t],0);default:throw new Ij("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function bq(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new Ij("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return Wz(e,t)}function yq(e){return _K(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function Aq(e,t,n,a){if(e.rank<2||t.rank<2)throw new Cj("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new Cj("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape))}if(2===e.rank&&2===t.rank)return qD({a:e,b:t,transposeA:!1,transposeB:!1,bias:a?xq(e.rank,a,"channelsLast"):null,activation:n});{const o=e.shape.slice(),i=o.pop();e=pL(e,[-1,i]);const r=t.shape.slice(),s=r.pop(),l=r.pop(),c=[...r,s],g=Array.from({length:t.rank},((e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n));t=pL(JD(t,g),[l,-1]);const u=[...o,...c];return pL(qD({a:e,b:t,transposeA:!1,transposeB:!1,bias:a?xq(e.rank,a,"channelsLast"):null,activation:n}),u)}}function vq(e,t,n){return VJ((()=>(t=Array.isArray(t)?ZD(t,"int32"):XY(t,"int32"),Xz(e,t,n))))}function Sq(e){return JY(e,e)}function xq(e,t,n){const a=t.shape;if(1!==t.rank&&t.rank!==e)throw new Ij("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return 1===a.length?pL(t,[1,a[0],1,1,1]):pL(t,[1,a[3],a[0],a[1],a[2]]);if("channelsLast"===n)return 1===a.length?pL(t,[1,1,1,1,a[0]]):pL(t,[1].concat(a))}else if(4===e){if("channelsFirst"===n)return 1===a.length?pL(t,[1,a[0],1,1]):pL(t,[1,a[2],a[0],a[1]]);if("channelsLast"===n)return 1===a.length?pL(t,[1,1,1,a[0]]):pL(t,[1].concat(a))}else if(3===e){if("channelsFirst"===n)return 1===a.length?pL(t,[1,a[0],1]):pL(t,[1,a[1],a[0]]);if("channelsLast"===n)return 1===a.length?pL(t,[1,1,a[0]]):pL(t,[1].concat(a))}else if(e<3)return t;throw new Ij("Unsupported input rank by biasAdd: ".concat(t.rank))}function Gq(e,t,n){return VJ((()=>(null==n&&(n="channelsLast"),_j(n),EY(e,xq(e.rank,t,n)))))}function Zq(e,t,n,a){return VJ((()=>YD(e,t,n,a)))}function wq(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}const kq=["fanIn","fanOut","fanAvg"],Bq=["normal","uniform","truncatedNormal"];class Rq extends iP{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Wq extends Rq{apply(e,t){return gK(e,t)}}Wq.className="Zeros",sP(Wq);class Vq extends Rq{apply(e,t){return uK(e,t)}}Vq.className="Ones",sP(Vq);class Nq extends Rq{constructor(e){if(super(),"object"!=typeof e)throw new Ij("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new Ij("config must have value set but got ".concat(e));this.value=e.value}apply(e,t){return VJ((()=>JY(Az(this.value),uK(e,t))))}getConfig(){return{value:this.value}}}Nq.className="Constant",sP(Nq);class Xq extends Rq{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return QK(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Xq.className="RandomUniform",sP(Xq);class Mq extends Rq{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Cj("randomNormal does not support dType ".concat(t,"."));return yq(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Mq.className="RandomNormal",sP(Mq);class Tq extends Rq{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Cj("truncatedNormal does not support dType ".concat(t,"."));return XD(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Tq.className="TruncatedNormal",sP(Tq);class Eq extends Rq{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return VJ((()=>{if(2!==e.length||e[0]!==e[1])throw new Ij("Identity matrix initializer can only be used for 2D square matrices.");return JY(this.gain,Vz(e[0]))}))}getConfig(){return{gain:this.gain}}}Eq.className="Identity",sP(Eq);class Fq extends Rq{constructor(e){if(super(),e.scale<0)throw new Ij("scale must be a positive float. Got: ".concat(e.scale));this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,function(e){Xj(kq,"FanMode",e)}(this.mode),this.distribution=null==e.distribution?"normal":e.distribution,function(e){Xj(Bq,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e){let t,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(_j(a),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===a){const a=rq(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===a){const a=rq(e,0,e.length-2);t=e[e.length-2]*a,n=e[e.length-1]*a}}else{const a=rq(e);t=Math.sqrt(a),n=Math.sqrt(a)}return[t,n]}(e),a=n[0],o=n[1];let i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,a):"fanOut"===this.mode?i/=Math.max(1,o):i/=Math.max(1,(a+o)/2),"normal"===this.distribution){const n=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Cj("".concat(this.getClassName()," does not support dType ").concat(t,"."));return XD(e,0,n,t,this.seed)}{const n=Math.sqrt(3*i);return QK(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Fq.className="VarianceScaling",sP(Fq);class Hq extends Fq{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Fq.className}}Hq.className="GlorotUniform",sP(Hq);class Jq extends Fq{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Fq.className}}Jq.className="GlorotNormal",sP(Jq);class Yq extends Fq{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Fq.className}}Yq.className="HeNormal",sP(Yq);class Lq extends Fq{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Fq.className}}Lq.className="HeUniform",sP(Lq);class zq extends Fq{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Fq.className}}zq.className="LeCunNormal",sP(zq);class Kq extends Fq{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Fq.className}}Kq.className="LeCunUniform",sP(Kq);class Dq extends Rq{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return VJ((()=>{if(e.length<2)throw new Cj("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));const n=bX(e.slice(0,-1)),a=e[e.length-1],o=n*a;o>this.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more than ".concat(this.ELEMENTS_WARN_SLOW," (").concat(o,") elements: Slowness may result."));const i=yq([Math.max(a,n),Math.min(a,n)],0,1,t,this.seed),r=$U.qr(i,!1);let s=r[0];const l=r[1].flatten().stridedSlice([0],[Math.min(a,n)*Math.min(a,n)],[Math.min(a,n)+1]);return s=JY(s,l.sign()),n<a&&(s=s.transpose()),JY(Az(this.gain),s.reshape(e))}))}getConfig(){return{gain:this.gain,seed:this.seed}}}Dq.className="Orthogonal",sP(Dq);const Uq={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Pq(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Rj(e,rP.getMap().classNameMap,t,"initializer")}function Oq(e){return kj(e)}function _q(e){if("string"==typeof e){const t=e in Uq?Uq[e]:e;if("GlorotNormal"===t)return new Jq;if("GlorotUniform"===t)return new Hq;if("HeNormal"===t)return new Yq;if("HeUniform"===t)return new Lq;if("LeCunNormal"===t)return new zq;if("LeCunUniform"===t)return new Kq;{const e={};return e.className=t,e.config={},Pq(e)}}return e instanceof Rq?e:Pq(e)}function Qq(e){return Array.isArray(e)&&Array.isArray(e[0])}function jq(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function qq(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new Ij("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function $q(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new Ij("Expected exactly 1 Shape; got ".concat(e.length))}return e}function e$(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce(((e,t)=>e*t));return t}const t$="Variable";class n${constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t$,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.dtype=null!==n&&void 0!==n?n:"float32",this.shape=e.shape,this.id=Jj(),a=null!==(t=a)&&void 0!==t?t:t$,this.originalName=tq(a),this.name=nq(this.originalName),this.trainable_=o,this.constraint=i,this.val=FD(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function a$(e){return e.map((e=>e.read()))}function o$(e){e.forEach((e=>{e[0].write(e[1])}))}class i${constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class r${constructor(e,t,n,a,o,i,r){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=a,this.callArgs=o,this.outputTensorIndex=r,this.id=Jj(),null!=i&&(this.originalName=tq(i),this.name=nq(this.originalName)),this.rank=t.length}}let s$=0;class l${constructor(e,t){this.callArgs=t,this.id=s$++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let c$=0;class g$ extends iP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=c$++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=Gj(e)+"_"+Lj(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new mj("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new Ij("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}getInputAt(e){return Sj(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Sj(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new pj("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new pj("Layer ".concat(this.name," is not connected, no input to return."));return Sj(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new pj("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new pj("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return Sj(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((e=>e()))}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach((t=>t.trainable=e)),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((e=>e.trainable)):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((e=>!e.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=xj(e);if(null==this.inputSpec||0===this.inputSpec.length)return;const n=xj(this.inputSpec);if(t.length!==n.length)throw new Ij("Layer ".concat(this.name," expects ").concat(n.length," inputs, but it received ").concat(t.length," input tensors. Input received: ").concat(e));for(let a=0;a<t.length;a++){const e=t[a],o=n[a];if(null==o)continue;const i=e.rank;if(null!=o.ndim&&i!==o.ndim)throw new Ij("Input ".concat(a," is incompatible with layer ").concat(this.name,": expected ndim=").concat(o.ndim,", found ndim=").concat(i));if(null!=o.maxNDim&&i>o.maxNDim)throw new Ij("Input ".concat(a," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(o.maxNDim,", found ndim=").concat(i));if(null!=o.minNDim&&i<o.minNDim)throw new Ij("Input ".concat(a," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(o.minNDim,", found ndim=").concat(i,"."));if(null!=o.dtype&&e.dtype!==o.dtype)throw new Ij("Input ".concat(a," is incompatible with layer ").concat(this.name," : expected dtype=").concat(o.dtype,", found dtype=").concat(e.dtype,"."));if(o.axes){const t=e.shape;for(const e in o.axes){const n=Number(e),i=o.axes[e],r=n>=0?t[n]:t[t.length+n];if(null!=i&&-1===[i,null].indexOf(r))throw new Ij("Input ".concat(a," is incompatible with layer ").concat(this.name,": expected axis ").concat(n," of input shape to have value ").concat(i," but got shape ").concat(t,"."))}}if(null!=o.shape)for(let t=0;t<o.shape.length;++t){const n=o.shape[t],i=e.shape[t];if(null!=n&&null!=i&&n!==i)throw new Ij("Input ".concat(a," is incompatible with layer ").concat(this.name,": expected shape=").concat(o.shape,", found shape=").concat(e.shape,"."))}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=xj(e),a=function(e){let t=!0;for(const n of xj(e))if(!(n instanceof r$)){t=!1;break}return t}(e),o=function(e){let t=!0;for(const n of xj(e))if(n instanceof r$){t=!1;break}return t}(e);if(a===o)throw new Ij("Arguments to apply() must be all SymbolicTensors or all Tensors");return eq(this.name,(()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of xj(e))t.push(n.shape);this.build(Sj(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let a=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,a);const o=xj(a),i=[];for(let e of o)-1!==n.indexOf(e)&&(e=e.clone()),i.push(e);if(a=Sj(i),null!=this.activityRegularizer)throw new Cj("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}{const n=function(e){e=xj(e);const t=[];for(const n of e)t.push(n.shape);return Sj(t)}(e),a=this.computeOutputShape(n);let o;const i="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),o=null!=a&&a.length>0&&Array.isArray(a[0])?a.map(((n,a)=>new r$(i,n,this,xj(e),t,this.name,a))):new r$(i,a,this,xj(e),t,this.name),this.addInboundNode(e,o,null,null,n,a,t),this._refCount++,null!=this.activityRegularizer)throw new Cj("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}}))}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{let t=!1;this.batchInputShape.forEach(((n,a)=>{null!=n&&null!=e[a]&&e[a]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new pj("The layer ".concat(this.name," has never been called and thus has no defined output shape."));const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new pj("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}countParams(){if(!this.built)throw new mj("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return e$(this.weights)}build(e){this.built=!0}getWeights(){return a$(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}setWeights(e){VJ((()=>{const t=this.weights;if(t.length!==e.length)throw new Ij('You called setWeights(weights) on layer "'.concat(this.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(t.length," weights. Provided weights: ").concat(e,"..."));if(0===t.length)return;const n=[],a=a$(t);for(let o=0;o<a.length;++o){const i=a[o],r=t[o],s=e[o];if(!AX(i.shape,s.shape))throw new Ij("Layer weight shape ".concat(i.shape," not compatible with provided weight shape ").concat(s.shape));n.push([r,s])}o$(n)}))}addWeight(e,t,n,a,o,i,r,s){if(-1!==this._addedWeightNames.indexOf(e))throw new Ij("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(a=null!=s?s():_q("zeros"));const l=a.apply(t,n),c=new n$(l,n,e,i,r);return l.dispose(),null!=o&&this.addLoss((()=>o.apply(c.read()))),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=xj(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((e=>{if(null!=e)throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."))}))}return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;const a=this.computeMask(e,n),o=xj(t),i=xj(a);if(o.length!==i.length)throw new Error("".concat(this.name," outputs ").concat(o.length," tensors but ").concat(o.length," masks for those tensors"));for(let r=0;r<o.length;r++)o[r].kerasMask=i[r]}addInboundNode(e,t,n,a,o,i){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const s=xj(e);t=xj(t),n=xj(n),a=xj(a),o=jq(o),i=jq(i);const l=[],c=[],g=[];for(const u of s)l.push(u.sourceLayer),c.push(u.nodeIndex),g.push(u.tensorIndex);new l$({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:g,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:a,inputShapes:o,outputShapes:i},r);for(let u=0;u<t.length;u++)t[u].sourceLayer=this,t[u].nodeIndex=this.inboundNodes.length-1,t[u].tensorIndex=u}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach((e=>e.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}dispose(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function u$(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const a=u$(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of a)-1===t.indexOf(e)&&t.push(e)}return t}}}class d$ extends g${constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:Lj("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new Ij("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new Ij("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new Ij("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const a=new r$(this.dtype,this.batchInputShape,this,[],{},this.name);a.nodeIndex=0,a.tensorIndex=0,new l$({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new Ij("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function h$(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new Ij("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new d$({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}d$.className="InputLayer",sP(d$);class p${constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof p$)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new Ij("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return XY(t,e.dtype)}catch{throw new Ij("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof r$){if(null==this.id2Value[e.id])throw new Ij("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new Ij("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}}getMask(e){if(e instanceof r$){if(null==this.id2Value[e.id])throw new Ij("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new Ij("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&NJ(this.id2Mask)}}const m$=new bj,I$=new bj;function C$(e,t,n,a){const o=null!=n&&n.training,i=Array.isArray(e),r=i?e:[e],s=r.map((e=>e.name)),l=[],c=t.names();for(const p of s)-1!==c.indexOf(p)?l.push(t.getValue(p)):l.push(null);null!=a&&(a.maxNumTensors=-1/0,a.minNumTensors=1/0);const g=s.join(",")+"|"+t.names().sort().join(",");let u,d=m$.get(g);if(null==d){const e=function(e,t){IX(null!=e&&e.length>0,(()=>"Expected at least one fetch, got none"));let n=[],a={};if(1===e.length){const o=b$(e[0],t);n=o.sorted,a=o.recipientMap}else{const o=new Set;for(const i of e){const{sorted:e,recipientMap:r}=b$(i,t);for(const t of e)o.has(t.name)||(n.push(t),o.add(t.name));for(const t in r)null==a[t]&&(a[t]=new Set),r[t].forEach((e=>a[t].add(e)))}}return{sorted:n,recipientCounts:f$(a)}}(r,t);d=e.sorted,u=e.recipientCounts,m$.put(g,d),I$.put(g,u)}u={},o||Object.assign(u,I$.get(g));const h=new p$(t);for(let p=0;p<d.length;++p){if(null!=a){const e=WJ().numTensors;e>a.maxNumTensors&&(a.maxNumTensors=e),e<a.minNumTensors&&(a.minNumTensors=e)}const e=d[p],i=e.sourceLayer;if(i instanceof d$)continue;const r=[],c=[],g=[];let m=!1;for(const n of e.inputs){const e=h.getValue(n),a=h.getMask(n);r.push(e),c.push(a),null!=a&&(m=!0),o||(u[n.name]--,0===u[n.name]&&!t.hasKey(n)&&-1===s.indexOf(n.name)&&!e.isDisposed&&!0!==n.sourceLayer.stateful&&g.push(e))}m&&((n=n||{}).mask=c[0]);const I=xj(i.apply(r,n));let C=null;i.supportsMasking&&(C=i.computeMask(r,c));const f=y$(e),b=Array.isArray(f)?f:[f];for(let t=0;t<b.length;++t){h.hasKey(b[t])||h.add(b[t],I[t],Array.isArray(C)?C[0]:C);const e=s.indexOf(b[t].name);-1!==e&&(l[e]=I[t])}o||NJ(g)}return h.disposeMasks(),i?l:l[0]}function f$(e){const t={};for(const n in e)t[n]=e[n].size;return t}function b$(e,t){const n=new Set,a=[],o={};for(const s of t.names())n.add(s);const i=[],r=[];for(i.push(e);i.length>0;){const e=i[i.length-1];if(n.has(e.name)){i.pop();continue}const t=r[r.length-1]===i.length-1;if(0===e.inputs.length||t)i.pop(),a.push(e),n.add(e.name),t&&r.pop();else{r.push(i.length-1);for(const t of e.inputs)null==o[t.name]&&(o[t.name]=new Set),o[t.name].add(e.name),!n.has(t.name)&&i.push(t)}}return{sorted:a,recipientMap:o}}function y$(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const a of e.sourceLayer.inboundNodes[t].outputTensors)if(a.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}function A$(e,t){return VJ((()=>vz(xz(JY(e,e),t,!0))))}nM().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(()=>100),(function(e){null!=m$&&m$.setMaxEntries(e),null!=I$&&I$.setMaxEntries(e)}));class v$ extends iP{getConfig(){return{}}}class S$ extends v${constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return VJ((()=>{const t=A$(e,this.axis),n=VL(t,0,this.maxValue);return JY(e,HY(n,EY(uq(),t)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}S$.className="MaxNorm",sP(S$);class x$ extends v${constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return VJ((()=>HY(e,EY(uq(),A$(e,this.axis)))))}getConfig(){return{axis:this.axis}}}x$.className="UnitNorm",sP(x$);class G$ extends v${apply(e){return eD(e)}}G$.className="NonNeg",sP(G$);class Z$ extends v${constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return VJ((()=>{const t=A$(e,this.axis),n=EY(JY(this.rate,VL(t,this.minValue,this.maxValue)),JY(1-this.rate,t));return JY(e,HY(n,EY(uq(),t)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Z$.className="MinMaxNorm",sP(Z$);const w$={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function k$(e){return kj(e)}function B$(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Rj(e,rP.getMap().classNameMap,t,"constraint")}function R$(e){if(null==e)return null;if("string"==typeof e){return B$({className:e in w$?w$[e]:e,config:{}})}return e instanceof v$?e:B$(e)}async function W$(e){if(null==e)return;const t=[],n=[],a=[];for(const o in e){const i=e[o];if("number"!=typeof i){const e=i;t.push(e.data()),n.push(o),a.push(e)}}if(t.length>0){const o=await Promise.all(t);for(let t=0;t<o.length;++t)e[n[t]]=o[t][0];NJ(a)}}function V$(e){if(null!=e)for(const t in e){const n=e[t];"number"!=typeof n&&n.dispose()}}var N$;!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(N$||(N$={}));class X${constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class M${constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class T$ extends X${constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const a in t){const e=t[a];if("number"==typeof e)this.totals.hasOwnProperty(a)||(this.totals[a]=0),this.totals[a]=this.totals[a]+e*n;else{let t;a in this.totals?t=this.totals[a]:this.totals[a]=0;const o=VJ((()=>EY(this.totals[a],JY(e,n))));this.totals[a]=o,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"==typeof this.totals[n]?t[n]=this.totals[n]/this.seen:VJ((()=>{const e=JY(HY(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),XJ(t[n])})))}}class E$ extends X${async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const o in this.history){const a=this.history[o];for(let i=0;i<a.length;++i)if("number"!=typeof a[i]){const r=a[i];e.push(r.data()),t.push(o),n.push(i)}}const a=await Promise.all(e);for(let o=0;o<a.length;++o)this.history[t[o]][n[o]].dispose(),this.history[t[o]][n[o]]=a[o][0]}}class F$ extends X${constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||aO,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");FX(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let a,o=null!=n?n():yH();return function(){const i=null!=n?n():yH();return i-o<t||(o=i,a=e(...arguments)),a}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const a=[];null!=this.yield&&(await W$(n),a.push(this.yield(e,t,n))),a.push(this.nextFrameFunc()),await Promise.all(a)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await W$(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await W$(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await W$(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await W$(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):FX(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await W$(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await W$(e),await this.trainEnd(e))}}function H$(e,t){return null==e&&(e={}),e instanceof X$?[e]:Array.isArray(e)&&e[0]instanceof X$?e:xj(e).map((e=>new F$(e,t)))}class J${constructor(){}static registerCallbackConstructor(e,t){IX(e>=0&&Number.isInteger(e),(()=>"Verbosity level is expected to be an integer >= 0, but got ".concat(e))),J$.checkForDuplicate(t),null==J$.constructors[e]&&(J$.constructors[e]=[]),J$.constructors[e].push(t)}static checkForDuplicate(e){for(const t in J$.constructors)J$.constructors[+t].forEach((t=>{if(t===e)throw new Ij("Duplicate callback constructor.")}))}static clear(){J$.constructors={}}static createCallbacks(e){const t=[];for(const n in J$.constructors){const a=+n;e>=a&&t.push(...J$.constructors[a])}return t.map((e=>new e))}}function Y$(e,t,n,a,o,i,r,s,l){const c=new E$,g=[new T$,...J$.createCallbacks(t)];null!=e&&g.push(...e),g.push(c);const u=new M$(g);return u.setParams({epochs:n,initialEpoch:a,samples:o,steps:i,batchSize:r,verbose:t,doValidation:s,metrics:l}),{callbackList:u,history:c}}function L$(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Rj(e,rP.getMap().classNameMap,t,"layer",n)}function z$(e,t){return VJ((()=>{"float32"!==e.dtype&&(e=XY(e,"float32"));const n=xz(Sq(e),t,!0),a=WL(n.shape,uq()),o=vz(lK(n,a));return HY(e,o)}))}function K$(e,t){return VJ((()=>cK(Sq($z(t,e)),-1)))}function D$(e,t){return VJ((()=>cK(YY($z(t,e)),-1)))}function U$(e,t){return VJ((()=>{const n=$z(e,t),a=VL(YY(e),uq(),Number.MAX_VALUE),o=YY(HY(n,a));return JY(100,cK(o,-1))}))}function P$(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return VJ((()=>{if(n)t=pD(t);else{const e=xz(t,t.shape.length-1,!0);t=HY(t,e)}return t=VL(t,uq(),1-uq()),Qz(xz(JY(XY(e,"float32"),Dz(t)),t.shape.length-1))}))}function O$(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return VJ((()=>{const a=XY(Nz(function(e){const t=[rq(e.shape)];return pL(e,t)}(e)),"int32"),o=(t=VL(t,uq(),1-uq())).shape;return P$(pL(CK(a,o[o.length-1]),o),t,n)}))}function _$(e,t){return VJ((()=>{let n;return n=VL(t,uq(),1-uq()),n=Dz(HY(n,$z(1,n))),cK(function(e,t){if(!AX(e.shape,t.shape))throw new Ij("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return VJ((()=>{const n=eD(t),a=Qz(YY(t));return EY($z(n,JY(t,e)),Uz(kz(a)))}))}(e,n),-1)}))}function Q$(e,t){return VJ((()=>{const n=z$(e,-1),a=z$(t,-1),o=JY(n,a);return Qz(xz(o,-1))}))}J$.constructors={};const j$={meanSquaredError:K$,meanAbsoluteError:D$,meanAbsolutePercentageError:U$,meanSquaredLogarithmicError:function(e,t){return VJ((()=>{const n=VL(t,uq(),Number.MAX_VALUE),a=Dz(EY(1,n)),o=VL(e,uq(),Number.MAX_VALUE),i=Dz(EY(1,o));return cK(Sq($z(a,i)),-1)}))},squaredHinge:function(e,t){return VJ((()=>{const n=lK(0,$z(1,JY(e,t)));return cK(Sq(n),-1)}))},hinge:function(e,t){return VJ((()=>{const n=lK(0,$z(1,JY(e,t)));return cK(n,-1)}))},categoricalHinge:function(e,t){return VJ((()=>{const n=xz(JY(e,t),-1),a=fz(JY($z(1,e),t),-1);return lK(0,EY(1,$z(a,n)))}))},logcosh:function(e,t){return VJ((()=>{const n=Math.log(2),a=$z(t,e),o=$z(EY(a,jz(JY(-2,a))),n);return cK(o,-1)}))},categoricalCrossentropy:P$,sparseCategoricalCrossentropy:O$,binaryCrossentropy:_$,kullbackLeiblerDivergence:function(e,t){return VJ((()=>{const n=VL(e,uq(),1),a=VL(t,uq(),1);return xz(JY(e,Dz(HY(n,a))),-1)}))},poisson:function(e,t){return VJ((()=>{const n=Dz(EY(uq(),t));return cK($z(t,JY(e,n)),-1)}))},cosineProximity:Q$};function q$(e){if("string"==typeof e){if(e in j$)return j$[e];let t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new Ij(t)}return e}function $$(e,t){return VJ((()=>{const n=JY(.5,fK(t)),a=dq(Mz(t,n),e.dtype);return cK(nz(e,a),-1)}))}function e0(e,t){return VJ((()=>dq(nz(UY(e,-1),UY(t,-1)),"float32")))}function t0(e,t){return VJ((()=>XY(xz(nK(nz(e,1),nz(t,1))),"float32")))}function n0(e,t){return VJ((()=>{const n=t0(e,t),a=function(e,t){return VJ((()=>XY(xz(nK(nz(e,0),nz(t,1))),"float32")))}(e,t),o=EY(n,a);return XY(az(Mz(o,0),HY(n,o),0),"float32")}))}function a0(e,t){return VJ((()=>{const n=t0(e,t),a=function(e,t){return VJ((()=>XY(xz(nK(nz(e,1),nz(t,0))),"float32")))}(e,t),o=EY(n,a);return XY(az(Mz(o,0),HY(n,o),0),"float32")}))}function o0(e,t){return _$(e,t)}function i0(e,t){return e.rank===t.rank&&(e=AD(e,[e.rank-1])),(t=UY(t,-1)).dtype!==e.dtype&&(t=XY(t,e.dtype)),XY(nz(e,t),"float32")}const r0=P$,s0=O$,l0={binaryAccuracy:$$,categoricalAccuracy:e0,precision:n0,categoricalCrossentropy:r0,sparseCategoricalCrossentropy:s0,mse:K$,MSE:K$,mae:D$,MAE:D$,mape:U$,MAPE:U$,cosine:Q$};function c0(e){if("string"==typeof e&&e in l0)return l0[e];if("string"!=typeof e&&null!=e)return e;throw new Ij("Unknown metric ".concat(e))}function g0(e){if(Aj(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;{let t;for(const n of Object.keys(j$))if(j$[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(l0))if(l0[n]===e){t=n;break}return void 0!==t?t:e.name}}const u0=1048576;function d0(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!h0(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>u0&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(n.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ").concat(u0,"."))}}function h0(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t)if("string"!=typeof n||!h0(e[n]))return!1;return!0}if(Array.isArray(e)){for(const t of e)if(!h0(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function p0(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log;const o=function(e){let t=!0;const n=[],a=[];for(const o in e.nodesByDepth)n.push(e.nodesByDepth[o]);for(const o of n){if(o.length>1||1===o.length&&o[0].inboundLayers.length>1){t=!1;break}a.push(...o)}if(t)for(const o of e.layers){let e=!1;for(const n of o.inboundNodes)if(-1!==a.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),i=["Layer (type)","Input Shape","Output shape","Param #"];let r;if(o?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((e=>Math.floor(t*e)))),!o){i.push("Receives inputs"),r=[];for(const t in e.nodesByDepth)r.push(...e.nodesByDepth[t])}a("_".repeat(t)),m0(i,n,a),a("=".repeat(t));const s=e.layers;for(let g=0;g<s.length;++g)o?I0(s[g],n,a):C0(s[g],n,r,a),a((g===s.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=function(e){let t;return t=null!=e.collectedTrainableWeights?e$(e.collectedTrainableWeights):e$(e.trainableWeights),t}(e),c=e$(e.nonTrainableWeights);a("Total params: ".concat(l+c)),a("Trainable params: ".concat(l)),a("Non-trainable params: ".concat(c)),a("_".repeat(t))}function m0(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,a="";for(let o=0;o<e.length;++o)o>0&&(a=a.slice(0,a.length-1)+" "),a+=e[o],a=a.slice(0,t[o]),a+=" ".repeat(t[o]-a.length);n(a)}function I0(e,t,n){let a,o;try{o=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch{o="multiple"}try{a=JSON.stringify(e.outputShape)}catch{a="multiple"}const i=e.name,r=e.getClassName();m0(["".concat(i," (").concat(r,")"),o,a,e.countParams().toString()],t,n)}function C0(e,t,n,a){let o,i;try{i=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch{i="multiple"}try{o=JSON.stringify(e.outputShape)}catch{o="multiple"}const r=[];for(const g of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(g)))for(let e=0;e<g.inboundLayers.length;++e){const t=g.inboundLayers[e].name,n=g.nodeIndices[e],a=g.tensorIndices[e];r.push("".concat(t,"[").concat(n,"][").concat(a,"]"))}const s=e.name,l=e.getClassName(),c=0===r.length?"":r[0];m0(["".concat(s," (").concat(l,")"),i,o,e.countParams().toString(),c],t,a);for(let g=1;g<r.length;++g)m0(["","","","",r[g]],t,a)}function f0(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function b0(e,t){if(null===e)return null;if("string"==typeof e)return Zj(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],a=e.length;for(let o=0;o<a;++o){const a=e[o];f0(t,o,a)?n.push(a):n.push(b0(a,t))}return n}{const t={};for(const n of Object.keys(e)){const a=e[n];if("name"===n&&"string"==typeof a)t[n]=a;else{const e=Zj(n);t[e]=b0(a,e)}}return t}}function y0(e,t){if(null==e)return null;if("string"==typeof e)return Gj(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],a=e.length;for(let o=0;o<a;++o){const a=e[o];f0(t,o,a)?n.push(a):n.push(y0(a,t))}return n}{const t={};for(const n of Object.keys(e)){const a=e[n],o=Gj(n);t[o]="name"!==n&&"className"!==n||"string"!=typeof a?y0(a,n):a}return t}}const A0="4.16.0";class v0 extends g${constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=Lj(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Vj(this.inputs).length!==this.inputs.length)throw new Ij("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(this.inputs.map((e=>e.name))));Vj(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(this.outputs.map((e=>e.name)))),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const e=C.sourceLayer,t=C.nodeIndex,n=C.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const C of this.inputs){const e=C.sourceLayer,t=C.nodeIndex,n=C.tensorIndex;Aj(0===t,"input layer has >1 nodes"),Aj(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const t=this.inputLayers[C];if(!(t instanceof d$))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(C," (0-based) originates from layer type ").concat(t.getClassName(),"."));this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map((e=>e.shape)),this.internalOutputShapes=this.outputs.map((e=>e.shape));const t={},n={},a={},o={},i={},r=[],s=(e,t,n,a,o,l)=>{(null==a||null==o||null==l)&&(a=e.sourceLayer,o=e.nodeIndex,l=e.tensorIndex);const c=a.inboundNodes[o];if(-1!==n.indexOf(c))throw new mj("The tensor ".concat(e.name,' at layer "').concat(a.name,'" is part of a cycle.'));if(-1!==t.indexOf(c))return;this.containerNodes.add(v0.nodeKey(a,o)),a.id in i||(i[a.id]=Object.keys(i).length),-1===n.indexOf(c)&&n.push(c);const g=c.inboundLayers.length;for(let i=0;i<g;i++){const e=c.inputTensors[i],a=c.inboundLayers[i],o=c.nodeIndices[i],r=c.tensorIndices[i];s(e,t,n,a,o,r)}for(t.push(c);n.indexOf(c)>=0;)n.splice(n.indexOf(c),1);r.push(c)},l=[],c=[];for(const C of this.outputs)s(C,l,c);const g=r.slice().reverse();for(const C of g){n[C.id]=C,C.id in t||(t[C.id]=0);let e=t[C.id];const i=null==a[C.outboundLayer.id]?0:a[C.outboundLayer.id];e=Math.max(e,i),a[C.outboundLayer.id]=e,o[C.outboundLayer.id]=C.outboundLayer,t[C.id]=e;for(let a=0;a<C.inboundLayers.length;a++){const o=C.inboundLayers[a],i=C.nodeIndices[a],r=o.inboundNodes[i],s=null==t[r.id]?0:t[r.id];t[r.id]=Math.max(e+1,s),n[r.id]=r}}const u={};for(const C in t){const e=t[C];e in u||(u[e]=[]),u[e].push(n[C])}const d={};for(const C in a){const e=a[C];e in d||(d[e]=[]),d[e].push(o[C])}let h=Object.keys(d).map((e=>parseInt(e,10))).sort(Wj);this.layers=[];for(const C of h){const e=d[C];e.sort(((e,t)=>{const n=i[e.id],a=i[t.id];return n<a?-1:n>a?1:0}));for(const t of e)t instanceof v0&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,h=Object.keys(u).map((e=>parseInt(e,10))).sort(Wj);const p=this.inputs.slice(),m=[];for(const C of h)for(const e of u[C]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new mj("Graph disconnected: cannot obtain value for tensor ".concat(n,' at layer "').concat(t.name,'". The following previous layers were accessed without issue: ').concat(m));for(const t of e.outputTensors)p.push(t);m.push(t.name)}}this.nodesByDepth=u;const I=this.layers.map((e=>e.name));for(const C of I){const e=I.filter((e=>e===C)).length;if(1!==e)throw new mj('The name "'.concat(C,'" is used ').concat(e," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(I))}this.outboundNodes=[],this.inboundNodes=[],new l$({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((e=>null)),outputMasks:this.outputs.map((e=>null)),inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs.map((e=>e.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach((t=>{t._trainableWeights.forEach((t=>t.trainable=e))})),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new Ij("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n={};let a=0;const o=(e=>{const t=Object.keys(e);if(0===t.length)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))})(e);o&&this.parseWeights(e);for(const r of this.layers)for(const[e,t]of r.weights.entries()){const i=o?"".concat(t.name.split("/").slice(0,-1).join("/")+"/").concat(e):t.originalName;if(null!=n[i])throw new Ij("Duplicate weight name: ".concat(i));n[i]=t,a++}const i=[];for(const r in e){let a=r;if(null==n[r]){const e=r.split("/");a=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[a])i.push([n[a],e[r]]);else if(t)throw new Ij("Provided weight data has no target variable: ".concat(r));delete n[a]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new Ij("".concat(e.length," of ").concat(a," weights are not set: ").concat(e))}o$(i)}parseWeights(e){for(const t in Object.keys(e)){const n=t.split("/"),a=["vars","layer_checkpoint_dependencies"],o=n.map((e=>e.startsWith("_")?e.slice(1):e)).filter((e=>!a.includes(e))).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(A0),t.backend="TensorFlow.js",t}toJSON(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=y0(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return VJ((()=>{e=xj(e);const n=new p$;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return C$(this.outputs,n,t)}))}computeMask(e,t){return VJ((()=>{let n;return e=xj(e),n=null==t?yj(null,e.length):xj(t),this.runInternalGraph(e,n)[1]}))}computeOutputShape(e){const t=jq(e);if(t.length!==this.inputLayers.length)throw new Ij("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));const n={};for(let r=0;r<t.length;r++){const e=this.inputLayers[r],a=t[r];n[e.name+"_0_0"]=a}const a=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(Wj);if(a.length>1)for(const r of a){const e=this.nodesByDepth[r];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((e=>e.id)).indexOf(e.id))continue;const a=[];for(let r=0;r<t.inboundLayers.length;r++){const e=t.inboundLayers[r],o=t.nodeIndices[r],i=t.tensorIndices[r],s=n["".concat(e.name,"_").concat(o,"_").concat(i)];a.push(s)}const o=jq(e.computeOutputShape(Sj(a))),i=e.inboundNodes.indexOf(t);for(let t=0;t<o.length;t++){n["".concat(e.name,"_").concat(i,"_").concat(t)]=o[t]}}}const o=[],i=[];for(let r=0;r<this.outputLayers.length;r++){const e=this.outputLayers[r],t=this.outputLayersNodeIndices[r],n=this.outputLayersTensorIndices[r],a="".concat(e.name,"_").concat(t,"_").concat(n);i.push(a)}for(let r=0;r<i.length;r++){const e=i[r];Aj(e in n),o.push(n[e])}return Sj(o)}runInternalGraph(e,t){null==t&&(t=yj(null,e.length));const n={};for(let s=0;s<this.inputs.length;++s){const a=this.inputs[s],o=e[s],i=t[s];n[a.id]=[o,i]}const a=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(Wj);for(const s of a){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer,a=t.inputTensors,o=t.outputTensors,i=new Array;for(const t of a)t.id in n&&i.push(n[t.id]);if(i.length===a.length){let a,r,s,l,c={};if(null!=t.callArgs&&(c=t.callArgs),1===i.length){const[t,n]=i[0];null==c.mask&&(c.mask=n),s=xj(e.call(t,c)),l=xj(e.computeMask(t,n)),a=[t],r=[n]}else a=i.map((e=>e[0])),r=i.map((e=>e[1])),null==c.mask&&(c.mask=r),s=xj(e.call(a,c)),l=xj(e.computeMask(a,r));if(e.activityRegularizer)throw new Cj("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<o.length;++e){const t=o[e],a=s[e],i=l[e];n[t.id]=[a,i]}}}}const o=[],i=[],r=[];for(const s of this.outputs){Aj(s.id in n,"Could not compute output ".concat(s.name," : ").concat(s.id));const[e,t]=n[s.id];r.push(e.shape),o.push(e),i.push(t)}return[o,i,r]}buildNodeConversionMap(e){const t={};let n;for(const a of this.layers){n=a instanceof v0?1:0;for(let e=0;e<a.inboundNodes.length;e++){const o=v0.nodeKey(a,e);this.containerNodes.has(o)&&(t[o]=n,n+=1)}}return t}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new Ij("Provide either a layer name or layer index");if("number"==typeof e)return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new Ij("No such layer: ".concat(e))}findLayer(e){if(this.layers.length<=e)throw new Ij("Was asked to retrieve layer at index ".concat(e,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[e]}calculateLosses(){return VJ((()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const a=v0.nodeKey(t,n);this.containerNodes.has(a)&&e.push(...t.calculateLosses())}return e}))}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const i of this.layers){const e=i.getClassName(),a=i.getConfig(),o=[];for(let n=0;n<i.inboundNodes.length;n++){const e=i.inboundNodes[n],a=v0.nodeKey(i,n);let r={};if(this.containerNodes.has(a)){if(e.callArgs)try{JSON.stringify(e.callArgs),r=e.callArgs}catch{console.warn("Layer ".concat(i.name," was passed non-serializable keyword arguments: ").concat(e.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),r={}}if(e.inboundLayers.length>0){const n=[];for(let a=0;a<e.inboundLayers.length;a++){const o=e.inboundLayers[a],i=e.nodeIndices[a],s=e.tensorIndices[a];let l=t[v0.nodeKey(o,i)];null==l&&(l=0),n.push([o.name,l,s,r])}o.push(n)}}}const r={};r.name=i.name,r.className=e,r.config=a,r.inboundNodes=o,n.push(r)}e.layers=n;const a=[];for(let i=0;i<this.inputLayers.length;i++){const e=this.inputLayers[i],n=this.inputLayersNodeIndices[i],o=v0.nodeKey(e,n);if(!this.containerNodes.has(o))continue;let r=t[o];null==r&&(r=0);const s=this.inputLayersTensorIndices[i];a.push([e.name,r,s])}e.inputLayers=a;const o=[];for(let i=0;i<this.outputLayers.length;i++){const e=this.outputLayers[i],n=this.outputLayersNodeIndices[i],a=v0.nodeKey(e,n);if(!this.containerNodes.has(a))continue;let r=t[a];null==r&&(r=0);const s=this.outputLayersTensorIndices[i];o.push([e.name,r,s])}return e.outputLayers=o,e}static fromConfig(e,t){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={},o={};function i(e,t){e.name in o?o[e.name].push(t):o[e.name]=[t]}function r(e,t){const n=[];let o;for(const r of t){const s=r[0],l=r[1],c=r[2];if(o=null==r[3]?{}:r[3],!(s in a))return void i(e,t);const g=a[s];if(g.inboundNodes.length<=l)return void i(e,t);const u=g.inboundNodes[l];n.push(u.outputTensors[c])}n.length>0&&e.apply(Sj(n),o)}function s(e){const o=e.name,r=L$(e,null!=t.customObjects?t.customObjects:{});r.setFastWeightInitDuringBuild(n),a[o]=r,e.inboundNodes.forEach((e=>{if(!(e instanceof Array))throw new Ij("Corrupted configuration, expected array for nodeData: ".concat(e));i(r,e)}))}const l=t.name,c=t.layers;for(const p of c)s(p);for(;!Nj(o);)for(const e of c){const t=a[e.name];if(t.name in o){const e=o[t.name];delete o[t.name];for(const n of e)r(t,n)}}const g=[],u=[],d=t.inputLayers;for(const p of d){const e=p[0],t=p[1],n=p[2];Aj(e in a);const o=a[e].inboundNodes[t].outputTensors;g.push(o[n])}const h=t.outputLayers;for(const p of h){const e=p[0],t=p[1],n=p[2];Aj(e in a);const o=a[e].inboundNodes[t].outputTensors;u.push(o[n])}return new e({inputs:g,outputs:u,name:l})}get stateful(){if(this._stateful)throw new Ij("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){VJ((()=>{this.layers.forEach((e=>{e.stateful&&e.resetStates()}))}))}}function S0(e,t){return function(e,t,n){const a=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>null));if(1===a)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==a)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(a," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){const n=[];return t.forEach((t=>{t in e?n.push(e[t]):n.push(null)})),n}throw new Error("The model has multiple (".concat(a,") outputs, so ").concat(n," must be either an array with ").concat(a," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}async function x0(e,t,n,a){if(null!=t||null!=a)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=VJ((()=>{if(1===e.shape.length)return MY(e);if(2===e.shape.length){if(e.shape[1]>1)return UY(e,1);if(1===e.shape[1])return pL(e,[e.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(e.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(e.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),a=Array.from(await t.data());NJ(t);const o=[];return a.forEach((e=>{if(null==n[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));o.push(n[e])})),ZD(o,"float32")}return null}function G0(e,t){return JY(e,t)}function Z0(e,t){let n,a;const o=t;n=o.xs,a=o.ys,IX(null!=n&&null!=a,(()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)));const i=w0("input",e.inputNames,n),r=w0("output",e.outputNames,a),s=i[0].shape[0];IX(i.length===e.inputs.length,(()=>"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")"))),IX(r.length===e.outputs.length,(()=>"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(r.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")));for(let l=0;l<i.length;l++)IX(i[l].shape[0]===s,(()=>"Batch size mismatch: input ".concat(e.inputNames[l]," has ").concat(i[l].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")));for(let l=0;l<r.length;l++)IX(r[l].shape[0]===s,(()=>"Batch size mismatch: output ".concat(e.outputNames[l]," has ").concat(r[l].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")));return{xs:i,ys:r}}function w0(e,t,n){if(n instanceof YH)return[n];if(Array.isArray(n))return IX(n.length===t.length,(()=>"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,"."))),n;{const a=[];for(const o of t){if(null==n[o])throw new Ij("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}return a}}async function k0(e,t,n){const a=null!=n.batchesPerEpoch;if(IX(null!=e.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),IX(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),IX(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(n.epochs))),IX(!a||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(n.batchesPerEpoch))),IX(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const o=null!=n.validationData;let i,r;if(o)if(B0(n.validationData))IX(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(n.validationBatches)));else{const e=function(e){if(3===e.length)throw new Cj("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);i=e.xs,r=e.ys}const s=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let c;c=o?l.slice().concat(l.map((e=>"val_"+e))):l.slice();const g=H$(n.callbacks,n.yieldEvery),u=null==n.verbose?1:n.verbose,{callbackList:d,history:h}=Y$(g,u,n.epochs,null,null,function(e,t){let n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,o,c);d.setModel(e),e.history=h,await d.onTrainBegin(),e.stopTraining_=!1;let p=null==n.initialEpoch?0:n.initialEpoch,m=await t.iterator();for(;p<n.epochs;){const c={};await d.onEpochBegin(p);let g=0,u=0;for(a||(m=await t.iterator());!a||g<n.batchesPerEpoch;){const t=await m.next();if(a&&t.done){console.warn("You provided `batchesPerEpoch` as ".concat(n.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(g," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(n.batchesPerEpoch*n.epochs," batches). You may need to use the repeat() function when building your dataset."));break}if(null!=t.value){const{xs:a,ys:o}=Z0(e,t.value),i={};i.batch=u,i.size=a[0].shape[0],await d.onBatchBegin(u,i);const r=[];if(null!=n.classWeight){const t=S0(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)r.push(await x0(o[e],null,t[e]))}const c=a.concat(o).concat(r),h=s(c);NJ(c);for(let e=0;e<l.length;++e){const t=l[e],n=h[e];i[t]=n,XJ(n)}await d.onBatchEnd(u,i),V$(i),u++,g++}if(a?g>=n.batchesPerEpoch:t.done){if(o){let t;t=B0(n.validationData)?xj(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):xj(e.evaluate(i,r,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)c["val_".concat(e.metricsNames[n])]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(p,c),p++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function B0(e){return"function"==typeof e.iterator}function R0(e){IX(e>0&&Number.isInteger(e),(()=>"batchSize is required to be a positive integer, but got ".concat(e)))}function W0(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((e=>pq(e,t,n-t))):pq(e,t,n-t)}function V0(e,t){return VJ((()=>null==e?null:Array.isArray(e)?e.map((e=>V0(e,t))):vq(e,"int32"===t.dtype?t:XY(t,"int32"))))}function N0(e,t){const n=[];let a=0,o=null;for(;a<e;)o=a+t,o>=e&&(o=e),n.push([a,o]),a=o;return n}function X0(e){const t=[];e instanceof YH&&(e=[e]);for(let n=0;n<e.length;++n){const a=e[n];if(1===a.rank)t.push(hq(a,1));else{if(0===a.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(a)}}return t}function M0(e,t){if(null==e)return;const n=[];if(t instanceof YH)n.push(t.id);else if(Array.isArray(t))t.forEach((e=>n.push(e.id)));else if(null!=t)for(const o in t){const e=t[o];n.push(e.id)}const a=[];if(e instanceof YH)-1===n.indexOf(e.id)&&a.push(e);else if(Array.isArray(e))e.forEach((e=>{-1===n.indexOf(e.id)&&a.push(e)}));else if(null!=e)for(const o in e){const t=e[o];-1===n.indexOf(t.id)&&a.push(t)}a.forEach((e=>{e.isDisposed||e.dispose()}))}function T0(e){return Array.isArray(e)}function E0(e){return!function(e){return e instanceof YH}(e)&&!T0(e)}function F0(e,t,n){let a,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){let t=!1;if(T0(e)&&e.length>0)t=!0;else if(E0(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new Ij("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map((e=>null));if(E0(e)){a=[];for(const n of t){if(null==e[n])throw new Ij('No data provided for "'.concat(n,'". Need data for each key in: ').concat(t));a.push(e[n])}}else if(T0(e)){if(e.length!==t.length)throw new Ij("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));a=e}else{if(t.length>1)throw new Ij("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));a=[e]}if(a=X0(a),null!=n)for(let r=0;r<t.length;++r){if(null==n[r])continue;const e=a[r];if(e.shape.length!==n[r].length)throw new Ij("Error when checking ".concat(i,": expected ").concat(t[r]," to have ").concat(n[r].length," dimension(s). but got array with shape ").concat(e.shape));for(let t=0;t<n[r].length;++t){if(0===t&&!o)continue;const a=e.shape[t],s=n[r][t];if(null!=s&&s>=0&&a!==s)throw new Ij("".concat(i," expected a batch of elements where each example has shape [").concat(n[r].slice(1,n[r].length),"] (i.e.,tensor shape [*,").concat(n[r].slice(1,n[r].length),"]) but the ").concat(i," received an input with ").concat(e.shape[0]," examples, each with shape [").concat(e.shape.slice(1,e.shape.length),"] (tensor shape [").concat(e.shape,"])"))}}return a}function H0(e,t,n){let a,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new Ij("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));a=e}else{if(t.length>1)throw new Ij("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));a=[e]}if(null!=n)for(let r=0;r<t.length;++r){if(null==n[r])continue;const e=a[r];if(e.shape.length!==n[r].length)throw new Ij("Error when checking ".concat(i,": expected ").concat(t[r]," to have ").concat(n[r].length," dimension(s), but got array with shape ").concat(JSON.stringify(e.shape)));for(let a=0;a<n[r].length;++a){if(0===a&&!o)continue;const s=e.shape[a],l=n[r][a];if(null!=l&&l!==s)throw new Ij("Error when checking ".concat(i,": expected ").concat(t[r]," to have shape ").concat(JSON.stringify(n[r])," but got array with shape ").concat(JSON.stringify(e.shape),"."))}}}class J0 extends v0{constructor(e){super(e),this.isTraining=!1}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new Ij("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");p0(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>tO.adagrad(.01),Adadelta:()=>tO.adadelta(1,.95,uq()),Adam:()=>tO.adam(.001,.9,.999,uq()),Adamax:()=>tO.adamax(.002,.9,.999,uq(),0),RMSProp:()=>tO.rmsprop(.001,.9,0,uq()),SGD:()=>tO.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new Ij("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof cP))throw new Ij("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Ij("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));t=e.loss.map((e=>q$(e)))}else{const n=q$(e.loss);this.outputs.forEach((e=>{t.push(n)}))}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new Ij('Unknown entry in loss dictionary: "'.concat(t,'". Only expected the following keys: ').concat(this.outputNames));for(const n of this.outputNames)null==e.loss[n]&&console.warn('Output "'.concat(n,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(n," during training")),t.push(q$(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const e=this.internalOutputShapes[i],t=this.outputNames[i];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[i])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],eq("loss",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}}));const a=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>[]));let n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((e=>n));{const e=[];for(const a of t){let t=n.hasOwnProperty(a)?n[a]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),o=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};eq("metric",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,a,i;for(const r of t){if("string"==typeof r&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(r)){const t=this.internalOutputShapes[e];let o;1===t[t.length-1]||this.lossFunctions[e]===_$?-1!==["accuracy","acc"].indexOf(r)?a=$$:-1!==["crossentropy","ce"].indexOf(r)&&(a=o0):this.lossFunctions[e]===O$?-1!==["accuracy","acc"].indexOf(r)?a=i0:-1!==["crossentropy","ce"].indexOf(r)&&(a=s0):-1!==["accuracy","acc"].indexOf(r)?a=e0:-1!==["crossentropy","ce"].indexOf(r)&&(a=r0),-1!==["accuracy","acc"].indexOf(r)?o="acc":-1!==["crossentropy","ce"].indexOf(r)&&(o="ce"),i=a,n=""+o}else i=c0(r),n=""+g0(r);let t;eq(n,(()=>{t=i})),o(e,n,t)}})(a[e])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=null==n.batchSize?32:n.batchSize;R0(a);const o=this.standardizeUserDataXY(e,t,!0,a);try{const e=o[0].concat(o[1]);this.makeTestFunction();const t=this.testFunction;return Sj(this.testLoop(t,e,a,n.verbose,n.steps))}finally{M0(o[0],e),M0(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const a=null!=(n=n||{}).batches,o=e.testFunction;let i=[];if(n.verbose>0)throw new Cj("Verbose mode is not implemented yet.");IX(!a||n.batches>0&&Number.isInteger(n.batches),(()=>"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(n.batches))));const r=function(e){return"function"==typeof e.next}(t)?t:await t.iterator();let s=0,l=0;for(;!a||l<n.batches;){const t=await r.next();if(i=VJ((()=>{if(t.value){const{xs:n,ys:a}=Z0(e,t.value),r=n.concat(a),c=VJ((()=>o(r)));if(NJ(r),0===l)for(let e=0;e<c.length;++e)i.push(Az(0));const g=r[0].shape[0];for(let e=0;e<c.length;++e){const t=c[e],n=i[e];i[e]=VJ((()=>EY(i[e],JY(g,t)))),l>0&&NJ(n)}NJ(c),s+=g,++l}return i})),t.done){a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(n.batches," batches). You may need to use the repeat() function when building your dataset."));break}}for(let c=0;c<i.length;++c){const e=i[c];i[c]=HY(i[c],s),NJ(e)}return Sj(i)}(this,e,t)}checkNumSamples(e,t,n){let a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(a=null,null!=t)throw new Ij("If ".concat(o," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new Ij("Either the input data should have a defined shape, or ".concat(o," shoud be specified."));a=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return a}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new Ij("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),a=n?t:[t],o=this.retrieveSymbolicTensors(a),i=new p$;if(e instanceof YH&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Ij("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(let t=0;t<this.inputs.length;++t)i.add(this.inputs[t],e[t])}else for(const s of this.inputs){const t=e[s.name];if(null==t)throw new Ij("No value is provided for the model's input ".concat(s.name));i.add(s,t)}const r=C$(o,i);return n?r:r[0]}retrieveSymbolicTensors(e){const t=yj(null,e.length);let n=e.length;for(const a of this.layers){const o=Array.isArray(a.output)?a.output:[a.output],i=o.map((e=>e.name));for(let a=0;a<e.length;++a){const r=i.indexOf(e[a]);if(-1!==r&&(t[a]=o[r],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach(((t,a)=>{null==t&&n.push(e[a])})),new Ij("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(n)))}return t}predictLoop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return VJ((()=>{const a=this.checkNumSamples(e);if(n)throw new Cj("Verbose predictLoop() is not implemented yet.");const o=N0(a,t),i=this.outputs.map((e=>[]));for(let t=0;t<o.length;++t)VJ((()=>{const n=o[t][0],a=o[t][1],i=W0(e,n,a),r=[];if(Array.isArray(i))for(let e=0;e<i.length;++e)r.push({key:this.inputs[e],value:i[e]});else r.push({key:this.inputs[0],value:i});const s=new p$(r);return C$(this.outputs,s)})).forEach(((e,t)=>i[t].push(e)));return Sj(i.map((e=>CL(e,0))))}))}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=X0(e);H0(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return R0(e),this.predictLoop(n,e)}finally{M0(n,e)}}predictOnBatch(e){H0(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t){let n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new mj("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let o=0;o<this.feedOutputShapes.length;++o){const e=this.feedOutputShapes[o];this.feedLossFns[o]===O$?a.push(e.slice(0,e.length-1).concat([1])):a.push(e)}if(function(e,t,n){const a=Vj(e.map((e=>e.shape[0])));a.sort();const o=Vj(t.map((e=>e.shape[0])));if(o.sort(),a.length>1)throw new Ij("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map((e=>e.shape)))));if(o.length>1)throw new Ij("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map((e=>e.shape)))));if(a.length>0&&o.length>0&&!AX(a,o))throw new Ij("Input Tensors should have the same number of samples as target Tensors. Found ".concat(a[0]," input sample(s) and ").concat(o[0]," target sample(s)."))}(e=F0(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=F0(t,this.feedOutputNames,a,!1,"target")),function(e,t,n){const a=[K$,_$,P$];for(let o=0;o<e.length;++o){const i=e[o],r=t[o],s=n[o];if(null!=r){if(r===P$&&1===i.shape[i.shape.length-1])throw new Ij("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==a.indexOf(r)){const e=i.shape.slice(1),t=s.slice(1);for(let n=0;n<e.length;++n){const a=e[n],o=t[n];if(null!=o&&a!==o)throw new Ij("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new Ij("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}async standardizeUserData(e,t,n,a){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5?arguments[5]:void 0;const[r,s]=this.standardizeUserDataXY(e,t,o,i);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=a){const e=S0(a,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await x0(s[t],null,e[t]))}return[r,s,l]}testLoop(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;return VJ((()=>{const i=this.checkNumSamples(t,n,o,"steps"),r=[];if(a>0)throw new Cj("Verbose mode is not implemented yet.");if(null!=o)throw new Cj("steps mode in testLoop() is not implemented yet");{const a=N0(i,n),o=ZD(cq(0,i));for(let n=0;n<a.length;++n){const i=a[n][0],s=a[n][1],l=pq(o,i,s-i),c=V0(t,l),g=e(c);if(0===n)for(let e=0;e<g.length;++e)r.push(Az(0));for(let e=0;e<g.length;++e){const t=g[e];r[e]=EY(r[e],JY(s-i,t))}}for(let e=0;e<r.length;++e)r[e]=HY(r[e],i)}return r}))}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const a=e[n];let o=a;if(vj(e,a)>1){const t=vj(e.slice(0,n),a);o+="_".concat(t)}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),i=[],r=this.collectedTrainableWeights.map((e=>e.read()));return[this.optimizer_.minimize((()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const r=new p$(e),s=C$(this.outputs,r,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(a[n],s[n]);null!=o[n]&&(e=G0(e,o[n]));const i=cK(e);t.push(i),l=0===n?e:EY(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],o=this.metricsTensors[n][1];e=cK(t(a[o],s[o]))}XJ(e),i.push(e)}return l=cK(l),this.calculateLosses().forEach((e=>{l=EY(l,e)})),l}),!0,r)].concat(i)}}makeTestFunction(){this.testFunction=e=>VJ((()=>{const t=[];let n;const a=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let e=0;e<this.inputs.length;++e)i.push({key:this.inputs[e],value:a[e]});const r=new p$(i),s=C$(this.outputs,r);for(let e=0;e<this.lossFunctions.length;++e){const a=this.lossFunctions[e],i=cK(a(o[e],s[e]));n=0===e?i:EY(n,i),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],a=this.metricsTensors[e][1],i=cK(n(o[a],s[a]));t.push(i)}return t}))}async fit(e,t){let n,a,o,i,r,s,l,c,g,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;try{const d=null==u.batchSize?32:u.batchSize;R0(d);const h=await this.standardizeUserData(e,t,u.sampleWeight,u.classWeight,!1,d);n=h[0],a=h[1],g=h[2];let p,m=!1;if(null!=u.validationData&&u.validationData.length>0){if(m=!0,2!==u.validationData.length)throw 3===u.validationData.length?new Cj("validationData including sample weights is not supported yet."):new Ij("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(u.validationData," is invalid."));r=u.validationData[0],s=u.validationData[1];const e=await this.standardizeUserData(r,s,null,null,!0,d);l=e[0],c=e[1],p=l.concat(c)}else if(null!=u.validationSplit&&u.validationSplit>0&&u.validationSplit<1){m=!0;const e=Math.floor(n[0].shape[0]*(1-u.validationSplit)),t=n[0].shape[0];l=W0(n,e,t),o=n,n=W0(n,0,e),c=W0(a,e,t),i=a,a=W0(a,0,e),p=l.concat(c)}else null!=u.validationSteps&&(m=!0);const I=n.concat(a).concat(g);this.checkTrainableWeightsConsistency();const C=this.makeTrainFunction(),f=this.getDedupedMetricsNames();let b,y;m?(this.makeTestFunction(),b=this.testFunction,y=f.slice().concat(f.map((e=>"val_"+e)))):(b=null,p=[],y=f.slice());const A=H$(u.callbacks,u.yieldEvery);return await this.fitLoop(C,I,f,d,u.epochs,u.verbose,A,b,p,u.shuffle,y,u.initialEpoch,null,null)}finally{this.isTraining=!1,M0(n,e),M0(a,t),M0(o,e),M0(i,t),M0(l,r),M0(c,s),null!=g&&NJ(g)}}async fitLoop(e,t,n,a,o,i,r,s,l,c,g,u,d,h){null==a&&(a=32),null==o&&(o=1),null==c&&(c=!0),null==u&&(u=0);let p=!1;if(null!=s&&null!=l&&(p=!0),null!=h&&(p=!0,null==d))throw new Ij("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(t,a,d,"steps_per_epoch");let I;null!=m&&(I=cq(0,m)),null==i&&(i=1);const{callbackList:C,history:f}=Y$(r,i,o,u,m,d,a,p,g);C.setModel(this),this.history=f,await C.onTrainBegin(),this.stopTraining_=!1;for(let b=u;b<o;++b){await C.onEpochBegin(b);const o={};if(null!=d)throw new Cj("stepsPerEpoch mode is not implemented yet.");{if("batch"===c)throw new Cj("batch shuffling is not implemneted yet");c&&uX(I);const i=ZD(I),r=N0(m,a);for(let c=0;c<r.length;++c){const g={};if(await C.onBatchBegin(c,g),VJ((()=>{const u=r[c][0],d=r[c][1],h=pq(i,u,d-u);g.batch=c,g.size=d-u;const m=V0(t,h),I=e(m);for(let e=0;e<n.length;++e){const t=n[e],a=I[e];g[t]=a,XJ(a)}if(c===r.length-1&&p){const e=this.testLoop(s,l,a);for(let t=0;t<n.length;++t){const a=n[t],i=e[t];XJ(i),o["val_"+a]=i}}})),await C.onBatchEnd(c,g),V$(g),this.stopTraining_)break}i.dispose()}if(await C.onEpochEnd(b,o),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return k0(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),a=n[0],o=n[1],i=this.makeTrainFunction()(a.concat(o)),r=[];for(const s of i){const e=await s.data();r.push(e[0])}return NJ(i),M0(n[0],e),M0(n[1],t),Sj(r)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,a=n?this.trainableWeights:this.weights,o=this.getWeights(n);for(let i=0;i<a.length;++i)n&&!a[i].trainable||t.push({name:a[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=WJ().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-WJ().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=Gj(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!=typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((e=>Gj(e)))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const a of t){if("string"!=typeof n[a])throw new Error("Serialization of non-string loss is not supported.");e[a]=Gj(n[a])}}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[Gj(g0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((e=>Gj(g0(e))));{const e={};for(const t in this.metrics)e[t]=Gj(g0(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=L$(b0(e.optimizer_config));let n,a;if("string"==typeof e.loss)n=Zj(e.loss);else if(Array.isArray(e.loss))n=e.loss.map((e=>Zj(e)));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=Zj(e.loss[t])}if(Array.isArray(e.metrics))a=e.metrics.map((e=>Zj(e)));else if(null!=e.metrics){a={};for(const t in e.metrics)a[t]=Zj(e.metrics[t])}this.compile({loss:n,metrics:a,optimizer:t})}async save(e,t){if("string"==typeof e){const t=aY(e);if(0===t.length)throw new Ij("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new Ij("Found more than one (".concat(t.length,") save handlers for URL '").concat(e,"'"));e=t[0]}if(null==e.save)throw new Ij("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await HJ(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(A0),convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){a.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:o}=await HJ(await this.optimizer.getWeights(),e);n.specs.push(...o),n.data=_J([n.data,t])}return null!=this.userDefinedMetadata&&(d0(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=n.data,a.weightSpecs=n.specs,e.save(a)}setUserDefinedMetadata(e){d0(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}J0.className="Model",sP(J0);class Y0 extends J0{}Y0.className="Functional",sP(Y0);class L0 extends J0{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:Lj("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some((e=>e<0)))throw new Ij("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}add(e){const t=e instanceof L0||e instanceof J0;let n;if(t){if(n=e,1!==n.outputs.length)throw new Ij("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new Ij("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new Ij("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=h$({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new Ij("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new Ij("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=u$(this.outputs[0])}this.inboundNodes=[],new l$({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:yj(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if($q(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new J0({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new mj("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new mj("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new mj("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new mj("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t){let n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new Ij("Legacy serialization format not supported yet.");n=t}else IX(null!=t.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),n=t.layers,delete t.layers,o=t;const i=new e(o);if(!(i instanceof L0))throw new Cj("Sequential.fromConfig called on non-Sequential input: ".concat(i));for(const r of n){const e=L$(r,void 0,a);a&&e.setFastWeightInitDuringBuild(!0),i.add(e)}return i}set stopTraining(e){if(null==this.model)throw new Ij("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new Ij("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}L0.className="Sequential",sP(L0);let z0=class extends iP{getConfig(){return{}}};class K0 extends z0{apply(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new Cj("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return lz(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}K0.className="elu",sP(K0);class D0 extends z0{apply(e){return iD(e)}}D0.className="selu",sP(D0);class U0 extends z0{apply(e){return eD(e)}}U0.className="relu",sP(U0);class P0 extends z0{apply(e){return VJ((()=>dK(6,eD(e))))}}P0.className="relu6",sP(P0);class O0 extends z0{apply(e){return e}}O0.className="linear",sP(O0);class _0 extends z0{apply(e){return bL(e)}}_0.className="sigmoid",sP(_0);class Q0 extends z0{apply(e){return function(e){return VJ((()=>{const t=EY(.5,JY(.2,e));return VL(t,0,1)}))}(e)}}Q0.className="hardSigmoid",sP(Q0);class j0 extends z0{apply(e){return jz(e)}}j0.className="softplus",sP(j0);class q0 extends z0{apply(e){return function(e){return VJ((()=>HY(e,EY(YY(e),1))))}(e)}}q0.className="softsign",sP(q0);class $0 extends z0{apply(e){return AL(e)}}$0.className="tanh",sP($0);let e1=class extends z0{apply(e){return pD(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}};e1.className="softmax",sP(e1);class t1 extends z0{apply(e){return eK(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}t1.className="logSoftmax",sP(t1);class n1 extends z0{apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return VJ((()=>JY(bL(JY(e,t)),e)))}}n1.className="swish",sP(n1);class a1 extends z0{apply(e){return VJ((()=>JY(e,AL(jz(e)))))}}function o1(e){return e.getClassName()}function i1(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Rj(e,rP.getMap().classNameMap,t,"activation")}function r1(e){if(null==e){const e={className:"linear",config:{}};return i1(e)}if("string"==typeof e){const t={};return t.className=e,t.config={},i1(t)}return e instanceof z0?e:i1(e)}function s1(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}a1.className="mish",sP(a1);class l1 extends iP{}class c1 extends l1{constructor(e){super(),s1(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return VJ((()=>{let t=gK([1]);return this.hasL1&&(t=EY(t,xz(JY(this.l1,YY(e))))),this.hasL2&&(t=EY(t,xz(JY(this.l2,Sq(e))))),pL(t,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}c1.className="L1L2",sP(c1);const g1={l1l2:"L1L2"};function u1(e){return kj(e)}function d1(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Rj(e,rP.getMap().classNameMap,t,"regularizer")}function h1(e){if(null==e)return null;if("string"==typeof e){return d1({className:e in g1?g1[e]:e,config:{}})}return e instanceof l1?e:d1(e)}class p1 extends g${constructor(e){super(null!==e&&void 0!==e?e:{}),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=qq(e);let n=eD(e);return null!=this.maxValue&&(n=VL(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}p1.className="ReLU",sP(p1);class m1 extends g${constructor(e){var t;super(null!==(t=e)&&void 0!==t?t:{}),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=qq(e);return Yz(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}m1.className="LeakyReLU",sP(m1);class I1 extends g${constructor(e){var t;if(super(null!==(t=e)&&void 0!==t?t:{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=_q(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=h1(e.alphaRegularizer),this.alphaConstraint=R$(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new Ij("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=$q(e)).slice(1);if(null!=this.sharedAxes)for(const a of this.sharedAxes)t[a-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let a=1;a<e.length;++a)n[a]=e[a];this.inputSpec=[new i$({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=qq(e),vK(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Oq(this.alphaInitializer),alphaRegularizer:u1(this.alphaRegularizer),alphaConstraint:k$(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}I1.className="PReLU",sP(I1);let C1=class extends g${constructor(e){var t;if(super(null!==(t=e)&&void 0!==t?t:{}),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new Cj("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=qq(e);return lz(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};C1.className="ELU",sP(C1);class f1 extends g${constructor(e){var t;super(null!==(t=e)&&void 0!==t?t:{}),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=qq(e);return JY(n,XY(Mz(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}f1.className="ThresholdedReLU",sP(f1);class b1 extends g${constructor(e){var t;super(null!==(t=e)&&void 0!==t?t:{}),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new e1).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){return VJ((()=>{let n=qq(e);const a=t.mask;if(null!=a){const e=JY($z(uK(n.shape),XY(a,n.dtype)),Az(-1e9));n=EY(n,e)}return this.axis instanceof Array?this.axis.length>1?kz($z(n,tK(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)}))}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function y1(e,t,n){if("number"==typeof e)return yj(e,t);if(e.length!==t)throw new Ij("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(let a=0;a<t;++a){const o=e[a];if(!iq(o))throw new Ij("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(o))}return e}function A1(e,t,n,a){if(null==e)return e;let o;return o="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((o+a-1)/a)}function v1(e,t,n,a){if(null==e)return null;if("valid"===a)e=e*t+lq([n-t,0]);else{if("same"!==a)throw new Ij("Unsupport padding mode: ".concat(a,"."));e*=t}return e}function S1(e,t){return VJ((()=>(_j(t),"channelsFirst"===t?JD(e,[0,2,3,1]):e)))}function x1(e,t){return VJ((()=>(_j(t),"channelsFirst"===t?JD(e,[0,2,3,4,1]):e)))}function G1(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return VJ((()=>{if(null==i&&(i="channelsLast"),_j(i),3!==e.rank&&4!==e.rank)throw new Ij("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new Ij("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));let l=S1(e,i);if("causal"===o)throw new Cj("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=_D({x:l,filter:t,strides:a,pad:"same"===o?"same":"valid",dilations:r,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(l=JD(l,[0,3,1,2])),l}))}b1.className="Softmax",sP(b1);class Z1 extends g${constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Z1.verifyArgs(t),this.rank=e,Tj(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new Cj("Convolution layer for rank other than 1, 2, or 3 (".concat(this.rank,") is not implemented yet."));if(this.kernelSize=y1(t.kernelSize,e,"kernelSize"),this.strides=y1(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,Qj(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,_j(this.dataFormat),this.activation=r1(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=_q(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=R$(t.biasConstraint),this.biasRegularizer=h1(t.biasRegularizer),this.activityRegularizer=h1(t.activityRegularizer),this.dilationRate=y1(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new Ij("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(this.dilationRate)));if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new Ij("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(this.dilationRate)))}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new Ij("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(this.dilationRate)))}static verifyArgs(e){if(Aj("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!Mj(e.kernelSize,"number",1,3))throw new Ij("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:o1(this.activation),useBias:this.useBias,biasInitializer:Oq(this.biasInitializer),biasRegularizer:u1(this.biasRegularizer),activityRegularizer:u1(this.activityRegularizer),biasConstraint:k$(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class w1 extends Z1{constructor(e,t){super(e,t),this.kernel=null,w1.verifyArgs(t),this.filters=t.filters,Tj(this.filters,"filters"),this.kernelInitializer=_q(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=R$(t.kernelConstraint),this.kernelRegularizer=h1(t.kernelRegularizer)}build(e){e=$q(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Ij("The channel dimension of the input should be defined. Found ".concat(e[t]));const n=e[t],a=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return VJ((()=>{let t;e=qq(e);const n=null==this.bias?null:this.bias.read(),a=Fj(this.activation.getClassName());if(null!=a&&2===this.rank)t=G1(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,a);else{if(1===this.rank)t=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return VJ((()=>{if(null==i&&(i="channelsLast"),_j(i),3!==e.shape.length)throw new Ij("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new Ij("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new Ij("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=JD(e,[0,2,1])),"causal"===o)throw new Cj("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let s=FL(e,t,a,"same"===o?"same":"valid","NWC",r);return null!=n&&(s=Gq(s,n)),s}))}(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=G1(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new Cj("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0;return VJ((()=>{if(null==i&&(i="channelsLast"),_j(i),4!==e.rank&&5!==e.rank)throw new Ij("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new Ij("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));let s=x1(e,i);if("causal"===o)throw new Cj("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=YL(s,t,a,"same"===o?"same":"valid","NDHWC",r),null!=n&&(s=Gq(s,n)),"channelsFirst"===i&&(s=JD(s,[0,4,1,2,3])),s}))}(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t}))}computeOutputShape(e){e=$q(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<n.length;++o){const e=A1(n[o],this.kernelSize[o],this.padding,this.strides[o],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[o]);t.push(e)}let a=[e[0]];return"channelsLast"===this.dataFormat?(a=a.concat(t),a.push(this.filters)):(a.push(this.filters),a=a.concat(t)),a}getConfig(){const e={filters:this.filters,kernelInitializer:Oq(this.kernelInitializer),kernelRegularizer:u1(this.kernelRegularizer),kernelConstraint:k$(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new Ij("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}class k1 extends w1{constructor(e){super(2,e),k1.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!Mj(e.kernelSize,"number",1,2))throw new Ij("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}k1.className="Conv2D",sP(k1);class B1 extends w1{constructor(e){super(3,e),B1.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new Ij("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}B1.className="Conv3D",sP(B1);class R1 extends k1{constructor(e){if(super(e),this.inputSpec=[new i$({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new Ij("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(this.padding))}build(e){if(4!==(e=$q(e)).length)throw new Ij("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Ij("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],a=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new i$({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return VJ((()=>{let t=qq(e);if(4!==t.shape.length)throw new Ij("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));const n=t.shape,a=n[0];let o,i;"channelsFirst"===this.dataFormat?(o=2,i=3):(o=1,i=2);const r=n[o],s=n[i],l=this.kernelSize[0],c=this.kernelSize[1],g=this.strides[0],u=this.strides[1],d=[a,v1(r,g,l,this.padding),v1(s,u,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=JD(t,[0,2,3,1]));let h=JL(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(h=JD(h,[0,3,1,2])),null!=this.bias&&(h=Gq(h,this.bias.read(),this.dataFormat)),null!=this.activation&&(h=this.activation.apply(h)),h}))}computeOutputShape(e){const t=(e=$q(e)).slice();let n,a,o;"channelsFirst"===this.dataFormat?(n=1,a=2,o=3):(n=3,a=1,o=2);const i=this.kernelSize[0],r=this.kernelSize[1],s=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[a]=v1(t[a],s,i,this.padding),t[o]=v1(t[o],l,r,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}R1.className="Conv2DTranspose",sP(R1);class W1 extends B1{constructor(e){if(super(e),this.inputSpec=[new i$({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new Ij("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(this.padding))}build(e){if(5!==(e=$q(e)).length)throw new Ij("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Ij("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],a=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new i$({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return VJ((()=>{let t=qq(e);if(5!==t.shape.length)throw new Ij("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));const n=t.shape,a=n[0];let o,i,r;"channelsFirst"===this.dataFormat?(r=2,o=3,i=4):(r=1,o=2,i=3);const s=n[r],l=n[o],c=n[i],g=this.kernelSize[0],u=this.kernelSize[1],d=this.kernelSize[2],h=this.strides[0],p=this.strides[1],m=this.strides[2],I=[a,v1(s,h,g,this.padding),v1(l,p,u,this.padding),v1(c,m,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=JD(t,[0,2,3,4,1]));let C=zL(t,this.kernel.read(),I,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(C=JD(C,[0,4,1,2,3])),null!==this.bias&&(C=Gq(C,this.bias.read(),this.dataFormat)),null!==this.activation&&(C=this.activation.apply(C)),C}))}computeOutputShape(e){const t=(e=$q(e)).slice();let n,a,o,i;"channelsFirst"===this.dataFormat?(n=1,a=2,o=3,i=4):(n=4,a=1,o=2,i=3);const r=this.kernelSize[0],s=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],g=this.strides[1],u=this.strides[2];return t[n]=this.filters,t[a]=v1(t[a],c,r,this.padding),t[o]=v1(t[o],g,s,this.padding),t[i]=v1(t[i],u,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}W1.className="Conv3DTranspose",sP(W1);class V1 extends w1{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new Ij("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new Ij("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new Ij("SeparableConv".concat(this.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(t.padding)));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=_q(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=h1(t.depthwiseRegularizer),this.depthwiseConstraint=R$(t.depthwiseConstraint),this.pointwiseInitializer=_q(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=h1(t.pointwiseRegularizer),this.pointwiseConstraint=R$(t.pointwiseConstraint)}build(e){if((e=$q(e)).length<this.rank+2)throw new Ij("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new Ij("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[t])));const n=e[t],a=this.kernelSize.concat([n,this.depthMultiplier]),o=[];for(let r=0;r<this.rank;++r)o.push(1);o.push(n*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",a,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new i$({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return VJ((()=>{let t;if(e=qq(e),1===this.rank)throw new Cj("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=JD(e,[0,2,3,1])),t=rD(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=Gq(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=JD(t,[0,3,1,2])),t}))}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Oq(this.depthwiseInitializer),e.pointwiseInitializer=Oq(this.pointwiseInitializer),e.depthwiseRegularizer=u1(this.depthwiseRegularizer),e.pointwiseRegularizer=u1(this.pointwiseRegularizer),e.depthwiseConstraint=k$(this.depthwiseConstraint),e.pointwiseConstraint=k$(this.pointwiseConstraint),e}}V1.className="SeparableConv";class N1 extends V1{constructor(e){super(2,e)}}N1.className="SeparableConv2D",sP(N1);class X1 extends w1{constructor(e){super(1,e),X1.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!Mj(e.kernelSize,"number",1,1))throw new Ij("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}X1.className="Conv1D",sP(X1);class M1 extends g${constructor(e){super(e),"number"==typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return VJ((()=>{if(e=qq(e),"channelsLast"===this.dataFormat){const t=Iq(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Iq(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=Iq(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Iq(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}M1.className="Cropping2D",sP(M1);class T1 extends g${constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_j(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){Xj(Kj,"InterpolationFormat",e)}(this.interpolation)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return VJ((()=>{let t=qq(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=JD(t,[0,2,3,1]);const e=this.size[0]*n[2],a=this.size[1]*n[3],o="nearest"===this.interpolation?qU.resizeNearestNeighbor(t,[e,a]):qU.resizeBilinear(t,[e,a]);return JD(o,[0,3,1,2])}{const e=this.size[0]*n[1],a=this.size[1]*n[2];return"nearest"===this.interpolation?qU.resizeNearestNeighbor(t,[e,a]):qU.resizeBilinear(t,[e,a])}}))}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}T1.className="UpSampling2D",sP(T1);class E1 extends Z1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=_q(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=R$(e.depthwiseConstraint),this.depthwiseRegularizer=h1(e.depthwiseRegularizer)}build(e){if((e=$q(e)).length<4)throw new Ij("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new Ij("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));const n=e[t],a=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",a,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return VJ((()=>{let t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",o=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return VJ((()=>{null==o&&(o="channelsLast"),_j(o);let r=S1(e,o);if(4!==e.rank)throw new Ij("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new Ij("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return r=QL(r,t,n,"same"===a?"same":"valid","NHWC",i),"channelsFirst"===o&&(r=JD(r,[0,3,1,2])),r}))}(e=qq(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=Gq(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t}))}computeOutputShape(e){e=$q(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],a="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=A1(t,this.kernelSize[0],this.padding,this.strides[0]),i=A1(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],a,o,i]:[e[0],o,i,a]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Oq(this.depthwiseInitializer),e.depthwiseRegularizer=u1(this.depthwiseRegularizer),e.depthwiseConstraint=k$(this.depthwiseRegularizer),e}}function F1(e,t,n,a){if(Array.isArray(e)){if(null!=t||null!=n)throw new Ij("When inputs is an array, neither initialState or constants should be provided");null!=a&&(n=e.slice(e.length-a,e.length),e=e.slice(0,e.length-a)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function o(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=o(t),constants:n=o(n)}}function H1(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return VJ((()=>{const l=t.shape.length;if(l<3)throw new Ij("Input should be at least 3D, but is ".concat(l,"D."));const c=[1,0].concat(cq(2,l));if(t=JD(t,c),null!=i)throw new Cj("The rnn() functoin of the deeplearn.js backend does not support constants yet.");r&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=o&&(o=XY(XY(o,"bool"),"float32"),o.rank===l-1&&(o=Bz(o,-1)),o=JD(o,c)),a&&(t=nD(t,0),null!=o&&(o=nD(o,0)));const g=[];let u,d=n;const h=t.shape[0],p=ED(t);let m,I;null!=o&&(m=ED(o));for(let t=0;t<h;++t){const n=p[t],a=VJ((()=>e(n,d)));if(null==o)u=a[0],d=a[1];else{const e=VJ((()=>{const e=m[t],n=$z(fK(e),e);return{output:EY(JY(a[0],e),JY(d[0],n)),newStates:d.map(((t,o)=>EY(JY(a[1][o],e),JY(t,n))))}}));u=e.output,d=e.newStates}s&&g.push(u)}return s&&(I=vD(g,1)),[u,I,d]}))}E1.className="DepthwiseConv2D",sP(E1);class J1 extends g${constructor(e){let t;if(super(e),null==e.cell)throw new Ij("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new O1({cells:e.cell}):e.cell,null==t.stateSize)throw new Ij("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new i$({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return cq(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((e=>null))}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Qq(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let a;if(a=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const a of t)n.push([e[0],a]);return[a].concat(n)}return a}computeMask(e,t){return VJ((()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map((e=>null));return[e].concat(t)}return e}))}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new Cj("Constants support is not implemented in RNN yet.");Qq(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new i$({shape:[t,null,...n]});const a=[e[0]].concat(e.slice(2));let o;if(this.cell.build(a),o=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!AX(this.stateSpec.map((e=>e.shape[e.shape.length-1])),o))throw new Ij("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=o.map((e=>new i$({shape:[null,e]})));this.stateful&&this.resetStates()}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];VJ((()=>{if(!this.stateful)throw new pj("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new Ij("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>gK([n,e]))):this.states_=[gK([n,this.cell.stateSize])];else if(null==e)NJ(this.states_),null!=this.keptStates&&(NJ(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>gK([n,e]))):this.states_[0]=gK([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Ij("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===t?this.keptStates.push(this.states_.slice()):NJ(this.states_);for(let t=0;t<this.states_.length;++t){const a=e[t],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,i=[n,o];if(!AX(a.shape,i))throw new Ij("State ".concat(t," is incompatible with layer ").concat(this.name,": expected shape=").concat(i,", received shape=").concat(a.shape));this.states_[t]=a}}this.states_=this.states_.map((e=>XJ(e.clone())))}))}apply(e,t){let n=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});const o=F1(e,n,a,this.numConstants);e=o.inputs,n=o.initialState,a=o.constants;let i=[],r=[];if(null!=n){t.initialState=n,i=i.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new i$({shape:e.shape}));r=r.concat(this.stateSpec)}if(null!=a&&(t.constants=a,i=i.concat(a),this.numConstants=a.length),i[0]instanceof r$){const n=[e].concat(i),a=this.inputSpec.concat(r),o=this.inputSpec;this.inputSpec=a;const s=super.apply(n,t);return this.inputSpec=o,s}return super.apply(e,t)}call(e,t){return VJ((()=>{const n=null==t?null:t.mask,a=null==t?null:t.training;let o=null==t?null:t.initialState;e=qq(e),null==o&&(o=this.stateful?this.states_:this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new Ij("RNN Layer has ".concat(i," state(s) but was passed ").concat(o.length," initial state(s)."));this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const r={training:a},s=H1(((e,t)=>{const n=this.cell.call([e].concat(t),r);return[n[0],n.slice(1)]}),e,o,this.goBackwards,n,null,this.unroll,this.returnSequences),l=s[0],c=s[1],g=s[2];this.stateful&&this.resetStates(g,a);const u=this.returnSequences?c:l;return this.returnState?[u].concat(g):u}))}getInitialState(e){return VJ((()=>{let t=gK(e.shape);return t=xz(t,[1,2]),t=hq(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((e=>e>1?bq(t,[1,e]):t)):this.cell.stateSize>1?[bq(t,[1,this.cell.stateSize])]:[t]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===J1.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=L$(t.cell,n);return new e(Object.assign(t,{cell:a}))}}J1.className="RNN",sP(J1);class Y1 extends g${}class L1 extends Y1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Tj(this.units,"units"),this.activation=r1(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=_q(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_q(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_q(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=h1(e.kernelRegularizer),this.recurrentRegularizer=h1(e.recurrentRegularizer),this.biasRegularizer=h1(e.biasRegularizer),this.kernelConstraint=R$(e.kernelConstraint),this.recurrentConstraint=R$(e.recurrentConstraint),this.biasConstraint=R$(e.biasConstraint),this.dropout=sq([1,lq([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=sq([1,lq([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=$q(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return VJ((()=>{if(2!==e.length)throw new Ij("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));let n=e[1];e=e[0];const a=null!=t.training&&t.training;let o;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=_1({ones:()=>fK(e),rate:this.dropout,training:a,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=_1({ones:()=>fK(n),rate:this.recurrentDropout,training:a,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,r=this.recurrentDropoutMask;o=Aq(null!=i?JY(e,i):e,this.kernel.read()),null!=this.bias&&(o=Gq(o,this.bias.read())),null!=r&&(n=JY(n,r));let s=EY(o,Aq(n,this.recurrentKernel.read()));return null!=this.activation&&(s=this.activation.apply(s)),[s,s]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:o1(this.activation),useBias:this.useBias,kernelInitializer:Oq(this.kernelInitializer),recurrentInitializer:Oq(this.recurrentInitializer),biasInitializer:Oq(this.biasInitializer),kernelRegularizer:u1(this.kernelRegularizer),recurrentRegularizer:u1(this.recurrentRegularizer),biasRegularizer:u1(this.biasRegularizer),activityRegularizer:u1(this.activityRegularizer),kernelConstraint:k$(this.kernelConstraint),recurrentConstraint:k$(this.recurrentConstraint),biasConstraint:k$(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}L1.className="SimpleRNNCell",sP(L1);class z1 extends J1{constructor(e){e.cell=new L1(e),super(e)}call(e,t){return VJ((()=>{null!=this.cell.dropoutMask&&(NJ(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(NJ(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,a=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:a,initialState:o})}))}static fromConfig(e,t){return new e(t)}}z1.className="SimpleRNN",sP(z1);class K1 extends Y1{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Ij("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Tj(this.units,"units"),this.activation=r1(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=r1(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=_q(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_q(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_q(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=h1(e.kernelRegularizer),this.recurrentRegularizer=h1(e.recurrentRegularizer),this.biasRegularizer=h1(e.biasRegularizer),this.kernelConstraint=R$(e.kernelConstraint),this.recurrentConstraint=R$(e.recurrentConstraint),this.biasConstraint=R$(e.biasConstraint),this.dropout=sq([1,lq([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=sq([1,lq([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=$q(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return VJ((()=>{if(2!==e.length)throw new Ij("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));const n=null!=t.training&&t.training;let a=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=_1({ones:()=>fK(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=_1({ones:()=>fK(a),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let r,s,l;0<this.dropout&&this.dropout<1&&(e=JY(e,o[0]));let c=Aq(e,this.kernel.read());this.useBias&&(c=Gq(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(a=JY(a,i[0]));const g=this.recurrentKernel.read(),[u,d]=fD(g,[2*this.units,this.units],g.rank-1),h=Aq(a,u),[p,m,I]=fD(c,3,c.rank-1),[C,f]=fD(h,2,h.rank-1);r=this.recurrentActivation.apply(EY(p,C)),s=this.recurrentActivation.apply(EY(m,f));const b=Aq(JY(s,a),d);l=this.activation.apply(EY(I,b));const y=EY(JY(r,a),JY(EY(1,Qz(r)),l));return[y,y]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:o1(this.activation),recurrentActivation:o1(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Oq(this.kernelInitializer),recurrentInitializer:Oq(this.recurrentInitializer),biasInitializer:Oq(this.biasInitializer),kernelRegularizer:u1(this.kernelRegularizer),recurrentRegularizer:u1(this.recurrentRegularizer),biasRegularizer:u1(this.biasRegularizer),activityRegularizer:u1(this.activityRegularizer),kernelConstraint:k$(this.kernelConstraint),recurrentConstraint:k$(this.recurrentConstraint),biasConstraint:k$(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}K1.className="GRUCell",sP(K1);class D1 extends J1{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new K1(e),super(e)}call(e,t){return VJ((()=>{null!=this.cell.dropoutMask&&(NJ(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(NJ(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,a=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:a,initialState:o})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}D1.className="GRU",sP(D1);class U1 extends Y1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Tj(this.units,"units"),this.activation=r1(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=r1(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=_q(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_q(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_q(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=h1(e.kernelRegularizer),this.recurrentRegularizer=h1(e.recurrentRegularizer),this.biasRegularizer=h1(e.biasRegularizer),this.kernelConstraint=R$(e.kernelConstraint),this.recurrentConstraint=R$(e.recurrentConstraint),this.biasConstraint=R$(e.biasConstraint),this.dropout=sq([1,lq([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=sq([1,lq([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=$q(e))[e.length-1];let a;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;a=new(t=class extends Rq{apply(t,a){const o=e.apply([n]),i=(new Vq).apply([n]),r=e.apply([2*n]);return fq(fq(o,i),r)}},t.className="CustomInit",t)}else a=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,a,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return VJ((()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new Ij("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));let a=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=_1({ones:()=>fK(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=_1({ones:()=>fK(a),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,r=this.recurrentDropoutMask;let s,l,c,g;0<this.dropout&&this.dropout<1&&(e=JY(e,i[0]));let u=Aq(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(a=JY(a,r[0])),u=EY(u,Aq(a,this.recurrentKernel.read())),this.useBias&&(u=Gq(u,this.bias.read()));const[d,h,p,m]=fD(u,4,u.rank-1);s=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(h),c=EY(JY(l,o),JY(s,this.activation.apply(p))),g=this.recurrentActivation.apply(m);const I=JY(g,this.activation.apply(c));return[I,I,c]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:o1(this.activation),recurrentActivation:o1(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Oq(this.kernelInitializer),recurrentInitializer:Oq(this.recurrentInitializer),biasInitializer:Oq(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:u1(this.kernelRegularizer),recurrentRegularizer:u1(this.recurrentRegularizer),biasRegularizer:u1(this.biasRegularizer),activityRegularizer:u1(this.activityRegularizer),kernelConstraint:k$(this.kernelConstraint),recurrentConstraint:k$(this.recurrentConstraint),biasConstraint:k$(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}U1.className="LSTMCell",sP(U1);class P1 extends J1{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new U1(e),super(e)}call(e,t){return VJ((()=>{null!=this.cell.dropoutMask&&(NJ(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(NJ(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,a=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:a,initialState:o})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}P1.className="LSTM",sP(P1);class O1 extends Y1{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return VJ((()=>{let n=e.slice(1);const a=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?a.push(n.splice(0,e.stateSize.length)):a.push(n.splice(0,1));a.reverse();const o=[];let i;for(let r=0;r<this.cells.length;++r){const s=this.cells[r];n=a[r],i=0===r?[e[0]].concat(n):[i[0]].concat(n),i=s.call(i,t),o.push(i.slice(1))}n=[];for(const e of o.slice().reverse())n.push(...e);return[i[0]].concat(n)}))}build(e){let t;Qq(e)&&(e=e[0]),this.cells.forEach(((n,a)=>{eq("RNNCell_".concat(a),(()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map((e=>({className:e.getClassName(),config:e.getConfig()})))};return Object.assign(Object.assign({},e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=[];for(const o of t.cells)a.push(L$(o,n));return new e({cells:a})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return a$(e)}setWeights(e){const t=[];for(const n of this.cells){const a=n.weights.length,o=e.splice(a);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],o[e]])}o$(t)}}function _1(e){const{ones:t,rate:n,training:a=!1,count:o=1,dropoutFunc:i}=e,r=()=>null!=i?i(t(),n):Zq(t(),n),s=()=>wq(r,t,a);return!o||o<=1?XJ(s().clone()):Array(o).fill(void 0).map(s).map((e=>XJ(e.clone())))}O1.className="StackedRNNCells",sP(O1);class Q1 extends J1{constructor(e){if(e.unroll)throw new Cj("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Cj("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new i$({ndim:5})]}call(e,t){return VJ((()=>{if(null!=this.cell.dropoutMask&&(NJ(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(NJ(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new Ij("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,a=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:a,initialState:o})}))}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return VJ((()=>{const{stateSize:t}=this.cell,n=e.shape,a=this.computeSingleOutputShape(n),o=gK([a[0],...a.slice(2)]);return Array.isArray(t)?Array(t.length).fill(o):[o]}))}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];VJ((()=>{if(!this.stateful)throw new pj("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,a=this.computeSingleOutputShape(n),o=[a[0],...a.slice(2)];if(null==n[0])throw new Ij("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>gK(o))):this.states_=[gK(o)];else if(null==e)NJ(this.states_),null!=this.keptStates&&(NJ(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>gK(o))):this.states_[0]=gK(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Ij("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));t?this.keptStates.push(this.states_.slice()):NJ(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],a=o;if(!AX(n.shape,a))throw new Ij("State ".concat(t," is incompatible with layer ").concat(this.name,": expected shape=").concat(a,", received shape=").concat(n.shape));this.states_[t]=n}}this.states_=this.states_.map((e=>XJ(e.clone())))}))}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:a,padding:o,strides:i,dilationRate:r}=this.cell,s="channelsFirst"===t,l=e[s?3:2],c=e[s?4:3],g=A1(l,a[0],o,i[0],r[0]),u=A1(c,a[1],o,i[1],r[1]);return[...e.slice(0,2),...s?[n,g,u]:[g,u,n]]}}Q1.className="ConvRNN2D";class j1 extends U1{constructor(e){const{filters:t,kernelSize:n,strides:a,padding:o,dataFormat:i,dilationRate:r}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Tj(this.filters,"filters"),this.kernelSize=y1(n,2,"kernelSize"),this.kernelSize.forEach((e=>Tj(e,"kernelSize"))),this.strides=y1(a||1,2,"strides"),this.strides.forEach((e=>Tj(e,"strides"))),this.padding=o||"valid",Qj(this.padding),this.dataFormat=i||"channelsLast",_j(this.dataFormat),this.dilationRate=y1(r||1,2,"dilationRate"),this.dilationRate.forEach((e=>Tj(e,"dilationRate")))}build(e){var t;e=$q(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new Ij("The channel dimension of the input should be defined. Found ".concat(e[n]));const a=e[n],o=this.kernelSize.concat([a,4*this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,a=this.filters;e=new((t=class extends Rq{apply(e,t){return Cq([n.apply([a]),uK([a]),n.apply([2*a])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return VJ((()=>{if(3!==e.length)throw new Ij("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));const n=t.training||!1,a=e[0],o=e[1],i=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=_1({ones:()=>fK(a),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,s=(e,t,n)=>t&&t[n]?JY(t[n],e):e;let l=s(a,r,0),c=s(a,r,1),g=s(a,r,2),u=s(a,r,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=_1({ones:()=>fK(o),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let h=s(o,d,0),p=s(o,d,1),m=s(o,d,2),I=s(o,d,3);const[C,f,b,y]=fD(this.kernel.read(),4,3),[A,v,S,x]=this.useBias?fD(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,C,A,this.padding),c=this.inputConv(c,f,v,this.padding),g=this.inputConv(g,b,S,this.padding),u=this.inputConv(u,y,x,this.padding);const[G,Z,w,k]=fD(this.recurrentKernel.read(),4,3);h=this.recurrentConv(h,G),p=this.recurrentConv(p,Z),m=this.recurrentConv(m,w),I=this.recurrentConv(I,k);const B=this.recurrentActivation.apply(EY(l,h)),R=this.recurrentActivation.apply(EY(c,p)),W=EY(JY(R,i),JY(B,this.activation.apply(EY(g,m)))),V=JY(this.recurrentActivation.apply(EY(u,I)),this.activation.apply(W));return[V,V,W]}))}getConfig(){const e=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n}(super.getConfig(),["units"]),t={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},e),t)}inputConv(e,t,n,a){const o=EL(e,t,this.strides,a||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?Gq(o,n,this.dataFormat):o}recurrentConv(e,t){return EL(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}j1.className="ConvLSTM2DCell",sP(j1);class q1 extends Q1{constructor(e){const t=new j1(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}q1.className="ConvLSTM2D",sP(q1);class $1 extends g${constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let a=0;a<this.noiseShape.length;++a)n.push(null==this.noiseShape[a]?t[a]:this.noiseShape[a]);return n}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);const n=qq(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,a=this.getNoiseShape(n);return wq((()=>Zq(n,this.rate,a,this.seed)),(()=>n),e)}return e}))}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}$1.className="Dropout",sP($1);class e2 extends $1{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}e2.className="SpatialDropout1D",sP(e2);class t2 extends g${constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Tj(this.units,"units"),this.activation=r1(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=_q(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=_q(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=R$(e.kernelConstraint),this.biasConstraint=R$(e.biasConstraint),this.kernelRegularizer=h1(e.kernelRegularizer),this.biasRegularizer=h1(e.biasRegularizer),this.activityRegularizer=h1(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=$q(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=$q(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);const n=qq(e),a=Fj(this.activation.getClassName());let o;return null!=a?o=Aq(n,this.kernel.read(),a,this.bias?this.bias.read():null):(o=Aq(n,this.kernel.read()),null!=this.bias&&(o=Gq(o,this.bias.read())),null!=this.activation&&(o=this.activation.apply(o))),o}))}getConfig(){const e={units:this.units,activation:o1(this.activation),useBias:this.useBias,kernelInitializer:Oq(this.kernelInitializer),biasInitializer:Oq(this.biasInitializer),kernelRegularizer:u1(this.kernelRegularizer),biasRegularizer:u1(this.biasRegularizer),activityRegularizer:u1(this.activityRegularizer),kernelConstraint:k$(this.kernelConstraint),biasConstraint:k$(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}t2.className="Dense",sP(t2);class n2 extends g${constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=$q(e);for(const t of e.slice(1))if(null==t)throw new Ij('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'));return[e[0],rq(e,1)]}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);let n=qq(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=JD(n,e)}return function(e){if(e.rank<=1)throw new Ij("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));const t=[e.shape[0],rq(e.shape,1)];return pL(e,t)}(n)}))}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}n2.className="Flatten",sP(n2);class a2 extends g${constructor(e){super(e),this.supportsMasking=!0,this.activation=r1(e.activation)}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);const n=qq(e);return this.activation.apply(n)}))}getConfig(){const e={activation:o1(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}a2.className="Activation",sP(a2);class o2 extends g${constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return VJ((()=>function(e,t){return VJ((()=>{if(2!==e.shape.length)throw new Ij("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return bq(hq(e,1),[1,t,1])}))}(e=qq(e),this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}o2.className="RepeatVector",sP(o2);class i2 extends g${constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",a=t.slice();let o=1,i=null;for(let s=0;s<a.length;++s){const e=a[s];if(this.isUnknown(e)){if(null!==i)throw new Ij("Can only specifiy one unknown dimension.");i=s}else o*=e}const r=rq(e);if(null!==i){if(0===o||r%o!==0)throw new Ij(n);a[i]=r/o}else if(r!==o)throw new Ij(n);return a}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);const n=qq(e),a=n.shape,o=a.slice(0,1).concat(this.fixUnknownDimension(a.slice(1),this.targetShape));return pL(n,o)}))}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}i2.className="Reshape",sP(i2);class r2 extends g${constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));const t=cq(1,e.dims.length+1);if(!AX(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new i$({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=$q(e)).slice();return this.dims.forEach(((n,a)=>{t[a+1]=e[n]})),t}call(e,t){return JD(qq(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}r2.className="Permute",sP(r2);class s2 extends g${constructor(e){super(null!==e&&void 0!==e?e:{}),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=qq(e);return DY(IK(n,this.maskValue),-1)}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);const n=qq(e),a=DY(IK(n,this.maskValue),-1,!0);return JY(n,XY(a,n.dtype))}))}}s2.className="Masking",sP(s2);class l2 extends g${constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(xj(e.inputLength))}this.inputDim=e.inputDim,Tj(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Tj(this.outputDim,"outputDim"),this.embeddingsInitializer=_q(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=h1(e.embeddingsRegularizer),this.activityRegularizer=h1(e.activityRegularizer),this.embeddingsConstraint=R$(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return VJ((()=>this.maskZero?(e=qq(e),IK(e,oz(e))):null))}computeOutputShape(e){if(e=$q(e),null==this.inputLength)return[...e,this.outputDim];const t=xj(this.inputLength);if(t.length!==e.length-1)throw new Ij('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));{let n=0;for(let a=0;a<t.length;++a){const o=t[a],i=e[a+1];if(null!=o&&null!=i&&o!==i)throw new Ij('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==o&&(t[n]=i),n++}}return[e[0],...t,this.outputDim]}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);let n=qq(e);"int32"!==n.dtype&&(n=dq(n,"int32"));const a=vq(this.embeddings.read(),pL(n,[n.size]));return pL(a,$q(this.computeOutputShape(n.shape)))}))}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Oq(this.embeddingsInitializer),embeddingsRegularizer:u1(this.embeddingsRegularizer),activityRegularizer:u1(this.activityRegularizer),embeddingsConstraint:k$(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}l2.className="Embedding",sP(l2);class c2 extends g${constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Cj}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let a=0;a<t.length;++a){const o=e[e.length-t.length+a],i=t[a];if(null==o||null==i||o<0||i<0)n.push(null);else if(1===o)n.push(i);else if(1===i)n.push(o);else{if(o!==i)throw new Ij("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(o)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[$q(e)]),e.length<2)throw new Ij("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));let t=[];for(const o of e)null!=o&&null!==o[0]&&t.push(o[0]);if(t=Vj(t),t.length>1)throw new Ij("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));let n=null==e[0]?null:e[0].slice(1);for(let o=1;o<e.length;++o){const t=null==e[o]?null:e[o].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const a=e.map((e=>e.length));-1===e.indexOf(null)&&1===Vj(a).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return VJ((()=>{if(this.reshapeRequired){const t=[],n=e.map((e=>e.rank));if(-1===n.indexOf(null)){const a=lq(n);for(let n of e){const e=n.rank;for(let t=0;t<a-e;++t)n=hq(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const i of e){const e=i.rank;if(null==e){const e=i.shape,a=e[0],o=e.slice(1).concat([a]);let r=pL(i,[a].concat(rq(e.slice(1))));r=JD(r,[1,0]),r=pL(r,o),t.push(r),n=!0}else if(e>1){const a=cq(1,e).concat([0]);t.push(JD(i,a)),n=!0}else t.push(i)}let a=this.mergeFunction(t);const o=a.rank;if(n)if(null==o){const e=a.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));a=pL(JD(pL(a,[-1,t]),[1,0]),n)}else if(o>1){const e=[o-1].concat(cq(0,o-1));a=JD(a,e)}return a}}return this.mergeFunction(e)}))}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let a=1;a<e.length;++a){const n=null==e[a]?null:e[a].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const a of e)null!=a&&null!==a[0]&&n.push(a[0]);return n=Vj(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return VJ((()=>{if(null==t)return null;if(!Array.isArray(t))throw new Ij("`mask` should be an Array");if(!Array.isArray(e))throw new Ij("`inputs` should be an Array");if(t.length!==e.length)throw new Ij("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((e=>null==e)))return null;let n=(t=t.map((e=>null==e?e:Bz(e,0))))[0];for(let e=1;e<t.length-1;++e)n=nK(n,t[e]);return n}))}}class g2 extends c2{constructor(e){super(e)}mergeFunction(e){return VJ((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=EY(t,e[n]);return t}))}}g2.className="Add",sP(g2);class u2 extends c2{constructor(e){super(e)}mergeFunction(e){return VJ((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=JY(t,e[n]);return t}))}}u2.className="Multiply",sP(u2);class d2 extends c2{constructor(e){super(e)}mergeFunction(e){return VJ((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=EY(t,e[n]);return JY(1/e.length,t)}))}}d2.className="Average",sP(d2);class h2 extends c2{constructor(e){super(e)}mergeFunction(e){return VJ((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=lK(t,e[n]);return t}))}}h2.className="Maximum",sP(h2);class p2 extends c2{constructor(e){super(e)}mergeFunction(e){return VJ((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=dK(t,e[n]);return t}))}}p2.className="Minimum",sP(p2);class m2 extends c2{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new Ij("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const a of e)if(null!=a){t=!1;break}if(t)return;const n=[];for(let a=0;a<e.length;++a){const t=e[a].slice();t.splice(this.axis,1);let o=!1;for(const e of n)if(AX(e,t)){o=!0;break}o||n.push(t)}if(n.length>1)throw new Ij("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return VJ((()=>Cq(e,this.axis)))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Ij("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),a=this.axis<0?n.length+this.axis:this.axis;for(const o of t.slice(1)){if(null==n[a]||null==o[a]){n[a]=null;break}n[a]+=o[a]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new Ij("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Ij("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Ij("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return VJ((()=>{let n=!0;if(t.forEach((e=>{null==e||(n=!1)})),n)return null;const a=[];for(let i=0;i<e.length;++i)null==t[i]?a.push(XY(fK(e[i]),"bool")):t[i].rank<e[i].rank?a.push(Bz(t[i],-1)):a.push(t[i]);const o=CL(a,this.axis);return KY(o,-1,!1)}))}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function I2(e,t){for(;e<0;)e+=t;return e}m2.className="Concatenate",sP(m2);class C2 extends c2{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){IX(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new Cj("Dot layer does not support tensors of 4D or higher rank yet.");const a=this.interpretAxes(t,n);if(t[a[0]]!==n[a[1]])throw new Ij("Dimension incompatibility: ".concat(t[a[0]]," !== ").concat(n[a[1]]))}mergeFunction(e){if(2!==e.length)throw new Ij("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));let t,n=e[0],a=e[1];return t=Array.isArray(this.axes)?this.axes.map(((t,n)=>I2(t,e[n].shape.length))):[I2(this.axes,n.shape.length),I2(this.axes,a.shape.length)],this.normalize&&(n=z$(n,t[0]),a=z$(a,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new Cj("batchDot is not implemented for tensors of 4D or higher rank yet");if(IX(e.shape.length>=2,(()=>"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length))),IX(e.shape.length>=2,(()=>"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length))),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new Cj("batchDot is not implemented for complex64-type Tensors yet.");const a=e.shape.length,o=t.shape.length;null==n&&(n=[a-1,o-2]);const i=n;return VJ((()=>{let n,r;if(a>o){n=a-o;const e=[];for(let t=0;t<n;++t)e.push(1);t=pL(t,t.shape.concat(e))}else if(o>a){n=o-a;const t=[];for(let e=0;e<n;++e)t.push(1);e=pL(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)r=i[0]===i[1]?xz(JY(e,t),i[0]):xz(JY(JD(e,[1,0]),t),i[1]);else{const n=i[0]!==e.shape.length-1,a=i[1]===t.shape.length-1;r=fL(e,t,n,a)}if(n>0){let e;e=a>o?a+o-3:a-1;const t=[];for(let a=e;a<e+n;++a)t.push(a);r=AD(r,t)}return 1===r.shape.length&&(r=Bz(r,1)),r}))}(n,a,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[I2(this.axes,e.length),I2(this.axes,t.length)],n}computeOutputShape(e){IX(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new Cj("Dot layer does not support tensors of 4D or higher rank yet.");const a=this.interpretAxes(t,n);t.splice(a[0],1),n.splice(a[1],1),n.splice(0,1);const o=t.concat(n);return 1===o.length&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}C2.className="Dot",sP(C2);class f2 extends g${constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);const n=qq(e);return wq((()=>EY(yq(n.shape,0,this.stddev),n)),(()=>n),t.training||!1)}))}}f2.className="GaussianNoise",sP(f2);class b2 extends g${constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return VJ((()=>{this.invokeCallHook(e,t);const n=qq(e);return this.rate>0&&this.rate<1?wq((()=>{const e=Math.sqrt(this.rate/(1-this.rate));return JY(n,yq(n.shape,1,e))}),(()=>n),t.training||!1):n}))}}b2.className="GaussianDropout",sP(b2);class y2 extends g${constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||qq(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return VJ((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return wq((()=>{const t=qq(e),a=-1.7580993408473766;let o=Tz(QK(n),this.rate);o=dq(o,"float32");const i=((1-this.rate)*(1+this.rate*a**2))**-.5,r=-i*a*this.rate,s=EY(JY(t,o),JY(EY(o,-1),a));return EY(JY(s,i),r)}),(()=>qq(e)),t.training||!1)}return e}))}}function A2(e,t,n,a,o){let i,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=GL(e,t,n,a,o,r);else if(3===e.rank)i=ZL(e,t,n,a,o,r);else{if(4!==e.rank)throw new Cj("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=wL(e,t,n,a,o,r)}return i}function v2(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return AX(a.slice().sort(),cq(0,e.rank-1))?function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return VJ((()=>{const i=mK(e,a),r=i.mean,s=i.variance;return[A2(e,r,s,n,t,o),r,s]}))}(e,t,n,a,o):function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return VJ((()=>{const i=mK(e,a),r=i.mean,s=i.variance,l=[];for(const t of cq(0,e.rank))-1!==a.indexOf(t)?l.push(1):l.push(e.shape[t]);const c=pL(r,l),g=pL(s,l),u=null==t?null:pL(t,l),d=null==n?null:pL(n,l);return[A2(e,c,g,d,u,o),r,s]}))}(e,t,n,a,o)}y2.className="AlphaDropout",sP(y2);class S2 extends g${constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=_q(e.betaInitializer||"zeros"),this.gammaInitializer=_q(e.gammaInitializer||"ones"),this.movingMeanInitializer=_q(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=_q(e.movingVarianceInitializer||"ones"),this.betaConstraint=R$(e.betaConstraint),this.gammaConstraint=R$(e.gammaConstraint),this.betaRegularizer=h1(e.betaRegularizer),this.gammaRegularizer=h1(e.gammaRegularizer)}build(e){e=$q(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new Ij("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new i$({ndim:e.length,axes:{[t]:n}})];const a=[n];this.scale&&(this.gamma=this.addWeight("gamma",a,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",a,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",a,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",a,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return VJ((()=>{const n=null!=t.training&&t.training,a=qq(e),o=a.shape,i=o.length,r=cq(0,i),s=this.axis>=0?this.axis:this.axis+i;r.splice(s,1);const l=yj(1,i);l[s]=o[s];const c=r.slice();c.sort();const g=!AX(c,cq(0,i).slice(0,i-1));if(!n)return(()=>{if(g){const e=pL(this.movingMean.read(),l),t=pL(this.movingVariance.read(),l),n=this.center?pL(this.beta.read(),l):null,o=this.scale?pL(this.gamma.read(),l):null;return A2(a,e,t,n,o,this.epsilon)}return A2(a,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[u,d,h]=v2(a,this.gamma.read(),this.beta.read(),r,this.epsilon),p=(e,t,n)=>{VJ((()=>{const a=1-n,o=e.read(),i=JY($z(o,t),a);e.write($z(o,i))}))};return(()=>{p(this.movingMean,d,this.momentum),p(this.movingVariance,h,this.momentum)})(),u}))}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Oq(this.betaInitializer),gammaInitializer:Oq(this.gammaInitializer),movingMeanInitializer:Oq(this.movingMeanInitializer),movingVarianceInitializer:Oq(this.movingVarianceInitializer),betaRegularizer:u1(this.betaRegularizer),gammaRegularizer:u1(this.gammaRegularizer),betaConstraint:k$(this.betaConstraint),gammaConstraint:k$(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}S2.className="BatchNormalization",sP(S2);class x2 extends g${constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received ".concat(this.axis))}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(this.axis)));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(this.axis)))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=_q(e.betaInitializer||"zeros"),this.gammaInitializer=_q(e.gammaInitializer||"ones"),this.betaRegularizer=h1(e.betaRegularizer),this.gammaRegularizer=h1(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=$q(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error("Invalid axis: ".concat(o));if(this.axis.length!==Vj(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));const n=this.axis.map((t=>e[t])),a=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,a):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,a):this.beta=null,this.built=!0}call(e,t){const n=qq(e),a=n.shape,o=a.length;return VJ((()=>{let{mean:e,variance:t}=mK(n,this.axis,!0);const i=yj(1,o);for(const n of this.axis)i[n]=a[n];const r=e=>null!=e&&e.shape.length!==o?pL(e,i):e;let s=this.scale?r(this.gamma.read()):null,l=this.center?r(this.beta.read()):null;const c=[],g=[];for(let n=0;n<o;++n)-1!==this.axis.indexOf(n)?(c.push(a[n]),g.push(1)):(c.push(1),g.push(a[n]));return e=Wz(e,c),t=Wz(t,c),null!=s&&(s=Wz(s,g)),null!=l&&(l=Wz(l,g)),A2(n,e,t,l,s,this.epsilon)}))}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Oq(this.betaInitializer),gammaInitializer:Oq(this.gammaInitializer),betaRegularizer:u1(this.betaRegularizer),gammaRegularizer:u1(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}x2.className="LayerNormalization",sP(x2);class G2 extends g${constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new Ij("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));let t,n;if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new Ij("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(t=e.padding[0],2!==e.padding[1].length)throw new Ij("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new i$({ndim:4})]}computeOutputShape(e){let t,n;return e=$q(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return VJ((()=>function(e,t,n){return VJ((()=>{if(4!==e.rank)throw new Ij("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new Ij("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new Ij("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));let a;return a="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],bK(e,a)}))}(qq(e),this.padding,this.dataFormat)))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function Z2(e,t,n,a,o,i){return VJ((()=>{let r;_j(o),jj(i),Qj(a),null==n&&(n=[1,1]),null==a&&(a="valid"),null==o&&(o="channelsLast"),null==i&&(i="max"),e=S1(e,o);const s="same"===a?"same":"valid";return r="max"===i?rK(e,t,n,s):mL(e,t,n,s),"channelsFirst"===o&&(r=JD(r,[0,3,1,2])),r}))}function w2(e,t,n,a,o,i){return VJ((()=>{let r;_j(o),jj(i),Qj(a),null==n&&(n=[1,1,1]),null==a&&(a="valid"),null==o&&(o="channelsLast"),null==i&&(i="max"),e=x1(e,o);const s="same"===a?"same":"valid";return r="max"===i?sK(e,t,n,s):IL(e,t,n,s),"channelsFirst"===o&&(r=JD(r,[0,4,1,2,3])),r}))}G2.className="ZeroPadding2D",sP(G2);class k2 extends g${constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new Ij("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));this.poolSize=e.poolSize}if(Tj(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new Ij("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));this.strides=e.strides}Tj(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,Qj(this.padding),this.inputSpec=[new i$({ndim:3})]}computeOutputShape(e){const t=A1((e=$q(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return VJ((()=>{this.invokeCallHook(e,t),e=hq(qq(e),2);const n=this.poolingFunction(qq(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return AD(n,[2])}))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class B2 extends k2{constructor(e){super(e)}poolingFunction(e,t,n,a,o){return _j(o),Qj(a),Z2(e,t,n,a,o,"max")}}B2.className="MaxPooling1D",sP(B2);class R2 extends k2{constructor(e){super(e)}poolingFunction(e,t,n,a,o){return _j(o),Qj(a),Z2(e,t,n,a,o,"avg")}}R2.className="AveragePooling1D",sP(R2);class W2 extends g${constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new Ij("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides];Tj(this.poolSize,"poolSize"),Tj(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_j(this.dataFormat),Qj(this.padding),this.inputSpec=[new i$({ndim:4})]}computeOutputShape(e){e=$q(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=A1(t,this.poolSize[0],this.padding,this.strides[0]),n=A1(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return VJ((()=>(this.invokeCallHook(e,t),this.poolingFunction(qq(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class V2 extends W2{constructor(e){super(e)}poolingFunction(e,t,n,a,o){return _j(o),Qj(a),Z2(e,t,n,a,o,"max")}}V2.className="MaxPooling2D",sP(V2);class N2 extends W2{constructor(e){super(e)}poolingFunction(e,t,n,a,o){return _j(o),Qj(a),Z2(e,t,n,a,o,"avg")}}N2.className="AveragePooling2D",sP(N2);class X2 extends g${constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new Ij("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Tj(this.poolSize,"poolSize"),Tj(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_j(this.dataFormat),Qj(this.padding),this.inputSpec=[new i$({ndim:5})]}computeOutputShape(e){e=$q(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],a="channelsFirst"===this.dataFormat?e[4]:e[3];return t=A1(t,this.poolSize[0],this.padding,this.strides[0]),n=A1(n,this.poolSize[1],this.padding,this.strides[1]),a=A1(a,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,a]:[e[0],t,n,a,e[4]]}call(e,t){return VJ((()=>(this.invokeCallHook(e,t),this.poolingFunction(qq(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class M2 extends X2{constructor(e){super(e)}poolingFunction(e,t,n,a,o){return _j(o),Qj(a),w2(e,t,n,a,o,"max")}}M2.className="MaxPooling3D",sP(M2);class T2 extends X2{constructor(e){super(e)}poolingFunction(e,t,n,a,o){return _j(o),Qj(a),w2(e,t,n,a,o,"avg")}}T2.className="AveragePooling3D",sP(T2);class E2 extends g${constructor(e){super(e),this.inputSpec=[new i$({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Cj}}class F2 extends E2{constructor(e){super(e||{})}call(e,t){return VJ((()=>{const t=qq(e);return cK(t,1)}))}}F2.className="GlobalAveragePooling1D",sP(F2);class H2 extends E2{constructor(e){super(e||{})}call(e,t){return VJ((()=>{const t=qq(e);return fz(t,1)}))}}H2.className="GlobalMaxPooling1D",sP(H2);class J2 extends g${constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_j(this.dataFormat),this.inputSpec=[new i$({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Cj}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Y2 extends J2{call(e,t){return VJ((()=>{const t=qq(e);return"channelsLast"===this.dataFormat?cK(t,[1,2]):cK(t,[2,3])}))}}Y2.className="GlobalAveragePooling2D",sP(Y2);class L2 extends J2{call(e,t){return VJ((()=>{const t=qq(e);return"channelsLast"===this.dataFormat?fz(t,[1,2]):fz(t,[2,3])}))}}L2.className="GlobalMaxPooling2D",sP(L2);class z2 extends g${constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=L$(t.layer,n);delete t.layer;const o={layer:a};return Object.assign(o,t),new e(o)}}class K2 extends z2{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=$q(e)).length<3)throw new Ij("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=$q(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),a=e[1];return[n[0],a].concat(n.slice(1))}call(e,t){return VJ((()=>H1(((e,n)=>[qq(this.layer.call(e,t)),[]]),e=qq(e),[],!1,null,null,!1,!0)[1]))}}K2.className="TimeDistributed",sP(K2);class D2 extends z2{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=L$(n),t.goBackwards=!0!==t.goBackwards;const a={};if(a.className=e.layer.getClassName(),a.config=t,this.backwardLayer=L$(a),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){Xj(Pj,"BidirectionalMergeMode",e)}(this.mergeMode),e.weights)throw new Cj("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,a,o=this.forwardLayer.computeOutputShape(e);return Array.isArray(o)&&Array.isArray(o[0])||(o=[o]),this.returnState&&(a=o.slice(1)),t=o[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(a).concat(a.slice()):[t].concat(a).concat(a.slice()):Sj(n)}apply(e,t){let n=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});const o=F1(e,n,a,this.numConstants);if(e=o.inputs,n=o.initialState,a=o.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==a)return super.apply(e,t);const i=[],r=[];if(null!=n){const e=n.length;if(e%2>0)throw new Ij("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,i.push(...n);const a=n.map((e=>new i$({shape:e.shape})));this.forwardLayer.stateSpec=a.slice(0,e/2),this.backwardLayer.stateSpec=a.slice(e/2),r.push(...a)}if(null!=a)throw new Cj("Support for constants in Bidirectional layers is not implemented yet.");const s=i[0]instanceof r$;for(const l of i)if(l instanceof r$!==s)throw new Ij("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(s){const n=[e].concat(i),a=this.inputSpec.concat(r),o=this.inputSpec;this.inputSpec=a;const s=super.apply(n,t);return this.inputSpec=o,s}return super.apply(e,t)}call(e,t){return VJ((()=>{const n=t.initialState;let a,o,i,r;if(null==n)a=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const i=n.slice(0,n.length/2),r=n.slice(n.length/2);a=this.forwardLayer.call(e,Object.assign(t,{initialState:i})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:r}))}return this.returnState&&(Array.isArray(a)&&(i=a.slice(1).concat(o.slice(1))),a=a[0],o=o[0]),this.returnSequences&&(o=nD(o,1)),"concat"===this.mergeMode?r=Cq([a,o]):"sum"===this.mergeMode?r=EY(a,o):"ave"===this.mergeMode?r=JY(.5,EY(a,o)):"mul"===this.mergeMode?r=JY(a,o):null==this.mergeMode&&(r=[a,o]),this.returnState?null==this.mergeMode?r.concat(i):[r].concat(i):r}))}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){eq(this.forwardLayer.name,(()=>{this.forwardLayer.build(e)})),eq(this.backwardLayer.name,(()=>{this.backwardLayer.build(e)})),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map((e=>null));return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=L$(t.layer);if(delete t.layer,null!=t.numConstants)throw new Cj("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const a=t;return a.layer=n,new e(a)}}D2.className="Bidirectional",sP(D2);class U2 extends g${constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return VJ((()=>("float32"!==(e=qq(e)).dtype&&(e=dq(e,"float32")),EY(JY(e,this.scale),this.offset))))}}U2.className="Rescaling",sP(U2);const{resizeBilinear:P2,cropAndResize:O2}=qU;class _2 extends g${constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,a,o,i,r,s){return VJ((()=>{let l,c=!1;const g=[t/i,n/r,(a+t)/i,(o+n)/r],u=[];3===e.rank?(c=!0,l=vD([e])):l=e;for(let e=0;e<l.shape[0];e++)u.push(g);const d=wJ(u,[u.length,4]),h=jK(0,u.length,1,"int32"),p=O2(l,d,h,[a,o],"nearest");return dq(c?qq(ED(p)):p,s)}))}upsize(e,t,n,a){return VJ((()=>dq(P2(e,[t,n]),a)))}call(e,t){return VJ((()=>{const t=qq(e),n=t.dtype,a=t.shape,o=a[a.length-3],i=a[a.length-2];let r=0;o!==this.height&&(r=Math.floor((o-this.height)/2));let s=0;return i!==this.width&&(s=Math.floor((i-this.width)/2),0===s&&(s=1)),r>=0&&s>=0?this.centerCrop(t,r,s,this.height,this.width,o,i,n):this.upsize(e,this.height,this.width,n)}))}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=$q(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}_2.className="CenterCrop",sP(_2);class Q2 extends g${constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return null==(e=$q(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return VJ((()=>{let n;if("int32"!==(e=qq(e)).dtype&&(e=dq(e,"int32")),typeof t.countWeights<"u"){if("count"!==this.outputMode)throw new Ij("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));n=qq(t.countWeights)}const a=fz(e),o=bz(e),i=Mz(this.numTokens,a).bufferSync().get(0),r=Tz(o,0).bufferSync().get(0);if(!i||!r)throw new Ij("Input values must be between 0 < values <= numTokens with numTokens=".concat(this.numTokens));return function(e,t,n,a){let o=qq(e);if("int32"!==o.dtype&&(o=dq(o,"int32")),"int"===t)return o;const i=o.shape;if(0===o.rank&&(o=Bz(o,-1)),"oneHot"===t&&1!==o.shape[o.shape.length-1]&&(o=Bz(o,-1)),o.rank>2)throw new Ij("When outputMode is not int, maximum output rank is 2 Received outputMode ".concat(t," and input shape ").concat(i," which would result in output rank ").concat(o.rank,"."));const r=["multiHot","oneHot"].includes(t),s=o;let l;if(l=OL(s,typeof a<"u"&&"count"===t?a:[],n,r),"tfIdf"!==t)return l;if(a)return JY(l,a);throw new Ij("When outputMode is 'tfIdf', weights must be provided.")}(e,this.outputMode,this.numTokens,n)}))}}Q2.className="CategoryEncoding",sP(Q2);const j2=new Set(["bilinear","nearest"]);class q2 extends g${constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(!j2.has(e.interpolation))throw new Ij("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));this.interpolation=e.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){const t=(e=$q(e))[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return VJ((()=>{const t=[this.height,this.width];if("bilinear"===this.interpolation)return qU.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return qU.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw new Error("Interpolation is ".concat(this.interpolation," but only ").concat([...j2]," are supported"))}))}}q2.className="Resizing",sP(q2);class $2{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}$2.className="RandomSeed";class e3 extends g${constructor(e){super(e),this.randomGenerator=new $2(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}e3.className="BaseRandomLayer";const t3=new Set(["bilinear","nearest"]);class n3 extends e3{constructor(e){super(e);const{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new Ij("Invalid factor: ".concat(this.factor,". Must be positive number or tuple of 2 numbers"));this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new Ij("factor must have values larger than -1. Got: ".concat(this.factor));if(this.widthUpper<this.widthLower)throw new Ij("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(this.widthUpper,".\n        Got lower bound: ").concat(this.widthLower,"\n      "));if(n){if(!t3.has(n))throw new Ij("Invalid interpolation parameter: ".concat(n," is not implemented"));this.interpolation=n}}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=$q(e))[2];return[this.imgHeight,-1,t]}call(e,t){return VJ((()=>{const t=qq(e);this.imgHeight=t.shape[t.shape.length-3];const n=t.shape[t.shape.length-2];this.widthFactor=QK([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let a=this.widthFactor.dataSync()[0]*n;a=Math.round(a);const o=[this.imgHeight,a];switch(this.interpolation){case"bilinear":return qU.resizeBilinear(e,o);case"nearest":return qU.resizeNearestNeighbor(e,o);default:throw new Error("Interpolation is ".concat(this.interpolation,"\n          but only ").concat([...t3]," are supported"))}}))}}n3.className="RandomWidth",sP(n3);var a3,o3,i3;function r3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(a.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const o=t(e);if(o.recurse&&null!==o.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse){if(u3(e)){const o=Array.isArray(e)?[]:{};a.add(e);for(const i in e){const r=r3(e[i],t,n,a);o[i]=r}return a.delete(e),e.__proto__&&(o.__proto__=e.__proto__),o}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,o.value),o.value}function s3(e){return l3(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:c3)}function l3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const a=e[0];if(n.has(a))throw new Error("Circular references are not supported.");const o=t(e);if(o.recurse&&null!==o.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(o.recurse){if(u3(a)){const o=Array.isArray(a)?[]:{};n.add(a);for(const i in a){const a=e.map((e=>e[i])),r=l3(a,t,n);o[i]=r}return n.delete(a),o}throw new Error("Can't recurse into non-iterable type: ".concat(a))}return o.value}function c3(e){return null===e?null:u3(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}async function g3(e,t){const n=new Map;r3(e,t,n);for(const a of Array.from(n.keys())){const e=n.get(a);if(qX(e)){const t=await e;n.set(a,t)}}return r3(e,t,n)}function u3(e){let t=!1;if(nM().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:n}=require("string_decoder");t=e instanceof n}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof YH)&&!(e instanceof Promise)&&!t)}function d3(e){return function(e,t){return r3(e,t)}(e,h3)}function h3(e){return e instanceof YH?{value:e.clone(),recurse:!1}:u3(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}nM().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(a3||(a3={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(o3||(o3={}));class p3{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class m3 extends p3{constructor(){super(m3.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let a=0;a<n;a++)t[a]=this.get(this.wrap(this.begin+a));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function I3(e){return new b3(e)}function C3(e){return new y3(e)}m3.INITIAL_CAPACITY=32;class f3{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new w3(this,e)}filter(e){return new G3(this,e)}map(e){return new Z3(this,e)}mapAsync(e){return new k3(this,e)}serialMapAsync(e){return new k3(this,e).serial()}flatmap(e){return new R3(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile((e=>!0===e))}rowMajorBatch(e){return new x3(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}columnMajorBatch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c3;return this.rowMajorBatch(e,t).map((e=>s3(e,n)))}concatenate(e,t){return new W3(I3([this,e]),t)}take(e){return e<0||null==e?this:new S3(this,e)}skip(e){return e<0||null==e?this:new v3(this,e)}prefetch(e){return new N3(this,e)}shuffle(e,t){return new X3(this,e,t)}serial(){return new A3(this)}}class b3 extends f3{constructor(e){super(),this.items=e,this.trav=0}summary(){return"Array of ".concat(this.items.length," items")}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:d3(e),done:!1}}}class y3 extends f3{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message="Error thrown while iterating through a dataset: ".concat(e.message),e}}}class A3 extends f3{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Serial")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class v3 extends f3{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Skip")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;NJ(e.value)}return this.upstream.next()}}class S3 extends f3{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return"".concat(this.upstream.summary()," -> Take")}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class x3 extends f3{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class G3 extends f3{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Filter")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;NJ(e.value)}}}class Z3 extends f3{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Map")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=oJ(e.value),n=this.transform(e.value),a=oJ(n);for(const o of t)aJ(o,a)||o.dispose();return{value:n,done:!1}}}class w3 extends f3{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> handleErrors")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class k3 extends f3{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> AsyncMap")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=oJ(e.value),n=await this.transform(e.value),a=oJ(n);for(const o of t)aJ(o,a)||o.dispose();return{value:n,done:!1}}}class B3 extends f3{constructor(){super(),this.outputQueue=new m3,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class R3 extends B3{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Flatmap")}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=oJ(e.value),n=this.transform(e.value),a=oJ(n);this.outputQueue.pushAll(n);for(const o of t)aJ(o,a)||o.dispose();return!0}}class W3 extends f3{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(i3||(i3={}));class V3 extends f3{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i3.FAIL;super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,n=0;const a=await g3(this.iterators,(function(e){return e instanceof f3?{value:e.next().then((e=>(t++,e.done&&n++,e.value))),recurse:!1}:{value:null,recurse:!0}}));if(t===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case i3.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case i3.SHORTEST:return{value:null,done:!0};case i3.LONGEST:}return this.count++,{value:a,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class N3 extends f3{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new p3(t)}summary(){return"".concat(this.upstream.summary()," -> Prefetch")}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class X3 extends N3{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=DK.alea(n||yH().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class M3{constructor(){this.size=null}batch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this;let a;return IX(e>0,(()=>"batchSize needs to be positive, but it is\n      ".concat(e))),a=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),T3((async()=>(await n.iterator()).columnMajorBatch(e,t,E3)),a)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,T3((async()=>(await t.iterator()).concatenate(await e.iterator())),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,T3((async()=>(await t.iterator()).filter((t=>VJ((()=>e(t)))))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return T3((async()=>(await t.iterator()).map((t=>VJ((()=>e(t)))))),this.size)}mapAsync(e){const t=this;return T3((async()=>(await t.iterator()).mapAsync(e)),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return T3((async()=>(await t.iterator()).prefetch(e)),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,T3((async()=>function(e,t){return new W3(e,t)}(C3((async()=>({value:await t.iterator(),done:!1}))).take(e))),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,T3((async()=>(await t.iterator()).skip(e)),n)}shuffle(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));const a=this,o=DK.alea(t||yH().toString());return T3((async()=>{let t=o.int32();return n&&(t+=o.int32()),(await a.iterator()).shuffle(e,t.toString())}),this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,T3((async()=>(await t.iterator()).take(e)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function T3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new class extends M3{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function E3(e){if(null===e)return null;return function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof YH||xH(e)}(e[0])?{value:F3(e),recurse:!1}:{value:null,recurse:!0}}function F3(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof YH?vD(e):wJ(e)}function H3(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&IX("complex64"!==e.dtype,(()=>"".concat(t," does not support complex64 tensors in the CPU backend.")))}))}M3.MAX_BUFFER_SIZE=1e4;const J3=HD;class Y3 extends cX{nextDataId(){return Y3.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new lX(this,RJ())}write(e,t,n){this.firstUse&&(this.firstUse=!1,nM().get("IS_NODE")&&yF("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const a={id:this.nextDataId()};return this.data.set(a,{values:e,dtype:n,refCount:1}),a}makeTensorInfo(e,t,n){let a;if("string"===t&&null!=n&&n.length>0&&TX(n[0])){const o=n.map((e=>vH(e)));a=this.write(o,e,t)}else a=this.write(n,e,t);return{dataId:a,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,a,o){this.data.set(e,{values:t,dtype:a,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return wO(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return DX(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>SH(e)));return NY(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return NY(e.shape,e.dtype,t)}makeOutput(e,t,n){return RJ().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=yH();return e(),{kernelMs:yH()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){H3([e],"where");const t=this.readSync(e.dataId);return J3(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function L3(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}Y3.nextDataId=0;const z3={kernelName:sM,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;H3(t,"abs");let a=new Float32Array(bX(t.shape));return a=L3(n.data.get(t.dataId).values),n.makeOutput(a,t.shape,t.dtype)}};function K3(e){return(t,n,a,o,i)=>{const r=ez(t,n),s=r.length,l=LX(r),c=BX(i,bX(r)),g=t.length,u=n.length,d=LX(t),h=LX(n),p=qL(t,r),m=qL(n,r);if(p.length+m.length===0)for(let I=0;I<c.length;++I)c[I]=e(a[I%a.length],o[I%o.length]);else for(let I=0;I<c.length;++I){const t=jX(I,s,l),n=t.slice(-g);p.forEach((e=>n[e]=0));const i=QX(n,g,d),r=t.slice(-u);m.forEach((e=>r[e]=0));const C=QX(r,u,h);c[I]=e(a[i],o[C])}return[c,r]}}function D3(e){const{inputs:t,backend:n}=e,{real:a,imag:o}=t,i=n.data.get(a.dataId).values,r=n.data.get(o.dataId).values,s=n.makeTensorInfo(a.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(a.shape,"float32",i),imag:n.makeTensorInfo(o.shape,"float32",r)},s}const U3={kernelName:XM,backendName:"cpu",kernelFunc:D3};function P3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){return D3({inputs:{real:P3(e,t,"float32"),imag:P3(e,t,"float32")},backend:e})}const a=PX(bX(t),n);return e.makeTensorInfo(t,n,a)}function O3(e){const{inputs:t,backend:n}=e,{x:a}=t;return n.incRef(a.dataId),{dataId:a.dataId,shape:a.shape,dtype:a.dtype}}const _3={kernelName:ST,backendName:"cpu",kernelFunc:O3};function Q3(e){const{inputs:t,backend:n}=e,{input:a}=t,o=n.data.get(a.dataId).complexTensorInfos.real,i=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,i)}const j3={kernelName:CE,backendName:"cpu",kernelFunc:Q3};function q3(e,t,n,a){if("int32"===a){return[t,"int32",Int32Array.from(e)]}if("bool"===a){const a=bH([0],n),[o,i]=K3(((e,t)=>e!==t?1:0))(t,[],e,a,"bool");return[i,"bool",o]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(a))}function $3(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{dtype:i}=a;if("complex64"===i){if("complex64"===o.dtype)return O3({inputs:{x:o},backend:n});const e=P3(n,o.shape,o.dtype),t=$3({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),a=D3({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),a}if("complex64"===o.dtype){const e=Q3({inputs:{input:o},backend:n}),t=$3({inputs:{x:e},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(e),t}if(!NX(o.dtype,i)){const e=O3({inputs:{x:o},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:i}}const r=n.data.get(o.dataId).values,[s,l,c]=q3(r,o.shape,o.dtype,i);return n.makeTensorInfo(s,l,c)}const e5={kernelName:WM,backendName:"cpu",kernelFunc:$3};function t5(e,t,n,a){return null==n?n=>{let{inputs:o,backend:i}=n;const{a:r,b:s}=o,l=i;H3([r,s],e);const c=l.data.get(r.dataId).values,g=l.data.get(s.dataId).values,u="string"===r.dtype?l_(c):c,d="string"===r.dtype?l_(g):g,h=a||r.dtype,[p,m]=t(r.shape,s.shape,u,d,h);return l.makeTensorInfo(m,h,p)}:e=>{let{inputs:o,backend:i}=e;const{a:r,b:s}=o,l=i;if("complex64"===r.dtype||"complex64"===s.dtype){const e=$3({inputs:{x:r},backend:l,attrs:{dtype:"complex64"}}),t=l.data.get(e.dataId),a=t.complexTensorInfos.real,o=t.complexTensorInfos.imag,i=l.data.get(a.dataId).values,c=l.data.get(o.dataId).values,g=$3({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(g.dataId),d=u.complexTensorInfos.real,h=u.complexTensorInfos.imag,p=l.data.get(d.dataId).values,m=l.data.get(h.dataId).values,[I,C,f]=n(r.shape,s.shape,i,c,p,m),b=l.makeTensorInfo(f,"float32",I),y=l.makeTensorInfo(f,"float32",C),A=D3({inputs:{real:b,imag:y},backend:l});return l.disposeIntermediateTensorInfo(e),l.disposeIntermediateTensorInfo(g),l.disposeIntermediateTensorInfo(b),l.disposeIntermediateTensorInfo(y),A}{const e=l.data.get(r.dataId).values,n=l.data.get(s.dataId).values,o=a||r.dtype,[i,c]=t(r.shape,s.shape,e,n,o);return l.makeTensorInfo(c,o,i)}}}function n5(e){return(t,n,a,o,i,r)=>{const s=ez(t,n),l=bX(s),c=s.length,g=LX(s),u=BX("float32",l),d=BX("float32",l),h=qL(t,s),p=qL(n,s),m=wO(a,o),I=wO(i,r),C=t.length,f=LX(t),b=n.length,y=LX(n);if(h.length+p.length===0)for(let A=0;A<u.length;A++){const t=A%m.length,n=A%I.length,a=e(m[2*t],m[2*t+1],I[2*n],I[2*n+1]);u[A]=a.real,d[A]=a.imag}else for(let A=0;A<u.length;A++){const t=jX(A,c,g),n=t.slice(-C);h.forEach((e=>n[e]=0));const a=QX(n,C,f),o=t.slice(-b);p.forEach((e=>o[e]=0));const i=QX(o,b,y),r=e(m[2*a],m[2*a+1],I[2*i],I[2*i+1]);u[A]=r.real,d[A]=r.imag}return[u,d,s]}}const a5=K3(((e,t)=>e+t)),o5=n5(((e,t,n,a)=>({real:e+n,imag:t+a}))),i5=t5(gM,a5,o5),r5={kernelName:gM,backendName:"cpu",kernelFunc:i5};function s5(e,t,n,a,o){const i=bX(a),r=PX(o,n);for(let s=0;s<e.length;s++){const n=e[s];if(n<0)throw new Error("Input x must be non-negative!");n>=o||(r[n]+=i>0?t[s]:1)}return r}function l5(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=e.shape[0],i=e.shape[1],r=NY([o,n],t.dtype);for(let s=0;s<o;s++)for(let o=0;o<i;o++){const i=e.get(s,o);if(i<0)throw new Error("Input x must be non-negative!");i>=n||(a?r.set(1,s,i):t.size>0?r.set(r.get(s,i)+t.get(s,o),s,i):r.set(r.get(s,i)+1,s,i))}return r}const c5=K3(((e,t)=>e&t)),g5=t5(kM,c5),u5={kernelName:kM,backendName:"cpu",kernelFunc:g5};function d5(e){return(t,n,a)=>{const o=RX(n,t.length);for(let i=0;i<t.length;++i)o[i]=e(t[i],a);return o}}function h5(e,t,n){return p5(e,d5(t),n)}function p5(e,t,n){return a=>{let{inputs:o,attrs:i,backend:r}=a;const{x:s}=o;H3(s,e);const l=r,c=l.data.get(s.dataId).values;let g;if("string"===s.dtype){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");g=l_(c)}else g=c;const u=n||s.dtype,d=t(g,u,i);return l.makeTensorInfo(s.shape,u,d)}}const m5=d5((e=>Math.ceil(e))),I5=p5(VM,m5),C5={kernelName:VM,backendName:"cpu",kernelFunc:I5};function f5(e,t,n,a){const o=RX(n,bX(t));if(a&&"string"!==n){let t=0;e.forEach((e=>{const n=bX(e.shape);o.set(e.vals,t),t+=n}))}else{let a=0;e.forEach((e=>{const i="string"===n?l_(e.vals):e.vals;let r=0;for(let n=0;n<e.shape[0];++n){const s=n*t[1]+a;for(let t=0;t<e.shape[1];++t)o[s+t]=i[r++]}a+=e.shape[1]}))}return o}const b5=K3(((e,t)=>e===t?1:0)),y5=t5(cT,b5,null,"bool"),A5={kernelName:cT,backendName:"cpu",kernelFunc:y5},v5=d5((e=>Math.exp(e))),S5=p5(gT,v5,"float32"),x5={kernelName:gT,backendName:"cpu",kernelFunc:S5},G5=d5((e=>Math.expm1(e))),Z5=p5(dT,G5),w5={kernelName:dT,backendName:"cpu",kernelFunc:Z5},k5=d5((e=>Math.floor(e))),B5=p5(IT,k5),R5={kernelName:IT,backendName:"cpu",kernelFunc:B5},W5=K3(((e,t)=>Math.floor(e/t))),V5=t5(CT,W5,null,"int32"),N5={kernelName:CT,backendName:"cpu",kernelFunc:V5};function X5(e,t,n,a,o,i,r,s,l){const c=NY([a,i],n);for(let g=0;g<a;g++){const n=[];let a=0;for(let t=0;t<o;t++){const i=e[g*o+t];a+=i*r[t],n.push(i)}if(a<0||a>=l/i)throw new Error("Invalid indices: ".concat(n," does not index into ").concat(s));for(let e=0;e<i;e++)c.values[g*i+e]=t.get(...t.indexToLoc(a*i+e))}return c}function M5(e,t,n){const a=NY(n,e.dtype);for(let o=0;o<a.size;++o){const n=a.indexToLoc(o).slice(),i=n[0],r=n[2],s=t.locToIndex([i,r]);n[2]=t.values[s];const l=e.locToIndex(n);0<=l&&l<e.values.length&&(a.values[o]=e.values[l])}return a}const T5=K3(((e,t)=>e>t?1:0)),E5=t5(AT,T5,null,"bool"),F5={kernelName:AT,backendName:"cpu",kernelFunc:E5},H5=K3(((e,t)=>e>=t?1:0)),J5=t5(vT,H5,null,"bool"),Y5={kernelName:vT,backendName:"cpu",kernelFunc:J5},L5=K3(((e,t)=>e<t?1:0)),z5=t5(RT,L5,null,"bool"),K5={kernelName:RT,backendName:"cpu",kernelFunc:z5},D5=K3(((e,t)=>e<=t?1:0)),U5=t5(WT,D5,null,"bool"),P5={kernelName:WT,backendName:"cpu",kernelFunc:U5};function O5(e,t,n){const a=(t-e)/(n-1),o=PX(n,"float32");o[0]=e;for(let i=1;i<o.length;i++)o[i]=o[i-1]+a;return o}const _5=d5((e=>Math.log(e))),Q5=p5(NT,_5),j5={kernelName:NT,backendName:"cpu",kernelFunc:Q5};function q5(e,t,n,a){const o=BX(a,bX(n));for(let i=0;i<o.length;++i){const n=i*t;let a=e[n];for(let o=0;o<t;++o){const t=e[n+o];(Number.isNaN(t)||t>a)&&(a=t)}o[i]=a}return o}const $5=K3(((e,t)=>Math.max(e,t))),e9=t5(LT,$5),t9={kernelName:LT,backendName:"cpu",kernelFunc:e9},n9=K3(((e,t)=>Math.min(e,t))),a9=t5(QT,n9),o9={kernelName:QT,backendName:"cpu",kernelFunc:a9},i9=K3(((e,t)=>e*t)),r9=n5(((e,t,n,a)=>({real:e*n-t*a,imag:e*a+t*n}))),s9=t5(eE,i9,r9),l9={kernelName:eE,backendName:"cpu",kernelFunc:s9};function c9(e,t,n){const a=fH(-1,n);return i9([],t,a,e,n)}const g9={kernelName:tE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:a}=t;H3(a,"neg");const o=n.data.get(a.dataId).values,[i,r]=c9(o,a.shape,a.dtype);return n.makeTensorInfo(r,a.dtype,i)}},u9=K3(((e,t)=>e!==t?1:0)),d9=t5(nE,u9,null,"bool"),h9={kernelName:nE,backendName:"cpu",kernelFunc:d9};function p9(e,t,n,a,o){const i=t.length,r=bX(t),s=LX(t),l=LX(o),c=BX(n,bX(o));for(let g=0;g<r;++g){const t=jX(g,i,s),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[a[e]];c[QX(n,i,l)]=e[g]}return c}function m9(e){const{inputs:t,attrs:n,backend:a}=e,{x:o}=t,{perm:i}=n;H3(o,"transpose");const r=o.shape.length,s=new Array(r);for(let c=0;c<s.length;c++)s[c]=o.shape[i[c]];const l=p9(a.data.get(o.dataId).values,o.shape,o.dtype,i,s);return{dataId:a.write(l,s,o.dtype),shape:s,dtype:o.dtype}}const I9={kernelName:cF,backendName:"cpu",kernelFunc:m9};function C9(e,t,n,a){const[o,i]=dz(e,a),r=jH(t,"int32"),s=PX(bX(o),r),l=bX(i);for(let c=0;c<s.length;++c){const e=c*l;let t=1;for(let a=0;a<l;++a)t*=n[e+a];s[c]=t}return{outVals:s,outShape:o,outDtype:r}}const f9={kernelName:dE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a;H3(o,"prod");const s=o.shape.length,l=wX(i,o.shape),c=mz(l,s);let g=l,u=o;const d=[];null!=c&&(u=m9({inputs:{x:o},backend:n,attrs:{perm:c}}),d.push(u),g=Cz(g.length,s));const h=n.data.get(u.dataId).values,{outVals:p,outShape:m,outDtype:I}=C9(u.shape,u.dtype,h,g);let C=m;return r&&(C=hz(m,l)),d.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(C,I,p)}};function b9(e,t,n,a){const o=[];let i=0;const r=t.length-1+n.length,s=new Array(r).fill(null).map((()=>[0]));!function(e,t){for(let n=0;n<e.length;++n){const a=e[n],o=n===e.length-1?t:e[n+1].length;if(0===a.length)throw new Error("Ragged splits may not be empty");if(a[0]<0)throw new Error("Ragged splits must be non-negative");if(a[a.length-1]>o)throw new Error("Ragged splits must not point past values");for(let e=1;e<a.length;++e)if(a[e-1]>a[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,a);let l=1;for(let c=0;c<t.length-1;++c){l*=t[c];const e=t[c+1];for(let t=1;t<l+1;++t)s[c].push(t*e)}for(let c=0;c<e.length;++c){let a=e[c],r=e[c]+1;for(let e=0;e<n.length;++e){const o=n[e],i=e+t.length-1;if(i>=0){const e=s[i],t=e[e.length-1]-o[a];for(let n=a;n<r;++n)s[i].push(o[n+1]+t)}a=o[a],r=o[r]}r!==a&&(o.push([a,r]),i+=r-a)}return{outSplits:s,valueSlices:o,numValues:i}}function y9(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let a=t;a<e.length;a++)n[t-1]*=e[a];return n}function A9(e,t,n,a,o){const i=t.slice();i[0]=o;const r=RX(n,bX(i)),s=e.length;return function(e,t,n,a,o,i){const r=y9(t,2)[1],s=y9(i,2)[1];let l=0;for(const c of n)for(let t=c[0];t<c[1];++t){for(let n=0;n<a;++n)o[l*s+n]=e[t*r+n];++l}}(e,t,a,0===s?0:s/t[0],r,i),[r,i]}function v9(e,t,n,a,o,i,r,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach(((e,a)=>{if(e<0||e>=n){const o=jX(a,t.length,LX(t)).join(",");throw new Error("indices[".concat(o,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,r,t[0][0]-1),0===a.length)throw new Error("params.rank must be nonzero");const l=a[0],{outSplits:c,valueSlices:g,numValues:u}=b9(i,r,e,l),d=function(e){const t=[];for(let n=0;n<e.length;++n){const a=RX("int32",e[n].length);t.push(a),e[n].forEach(((e,t)=>a[t]=e))}return t}(c),h=A9(n,a,o,g,u);return[d,h[0],h[1]]}const S9=2147483647;function x9(e,t,n,a,o,i,r){if(t.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(r.length>1)throw new Error("deltas must be a scalar or vector");const s=0===t.length,l=0===o.length,c=0===r.length,g=[];s||g.push(t[0]),l||g.push(o[0]),c||g.push(r[0]);for(let m=1;m<g.length;++m)if(g[m]!==g[m-1])throw new Error("starts, limits, and deltas must have the same shape");const u=0===g.length?1:g[0],d=RX("int32",u+1);d[0]=0;for(let m=0;m<u;++m){const t=s?e[0]:e[m],n=l?a[0]:a[m],o=c?i[0]:i[m];if(0===o)throw new Error("Requires delta != 0");let r;if(o>0&&n<t||o<0&&n>t)r=0;else if(r=Math.ceil(Math.abs((n-t)/o)),r>S9)throw new Error("Requires ((limit - start) / delta) <= ".concat(S9));d[m+1]=d[m]+r}const h=RX(n,d[u]);let p=0;for(let m=0;m<u;++m){const t=d[m+1]-d[m];let n=s?e[0]:e[m];const a=c?i[0]:i[m];for(let e=0;e<t;++e)h[p++]=n,n+=a}return[d,h]}var G9=rO;class Z9{constructor(e,t,n,a,o,i,r,s,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=r,this.rowPartitionValues=s,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=lO(c),this.raggedRank=cO(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===G9.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===G9.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case G9.VALUE_ROWIDS:return Z9.getMaxWidthValueRowID(t);case G9.ROW_SPLITS:return Z9.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(G9[this.getRowPartitionTypeByDimension(e-1)]))}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let a=0;a<t-1;++a){const t=e[a+1]-e[a];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,a=e[0],o=0;for(let i=1;i<t;++i){const t=e[i];t!==a&&(a=t,o=Math.max(i-n,o),n=i)}return Math.max(t-n,o)}tensorShapeFromTensor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return k9(e,n)}calculateOutputSize(e){const t=this.valuesShape;gO(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=sO(this.raggedRank,n,t);a[0]<0&&(a[0]=e);for(let o=1;o<=this.raggedRank;++o)a[o]<0&&(a[o]=this.getMaxWidth(o));return a}calculateFirstParentOutputIndex(e,t,n){const a=Math.min(e,n),o=[];let i=0;for(let r=0;r<a;++r,i+=t)o.push(i);for(let r=a;r<e;++r)o.push(-1);return IX(o.length===e,(()=>"Final length of result must be equal to firstDimension.")),o}calculateOutputIndexRowSplit(e,t,n,a){const o=e.length,i=[];for(let r=0;r<o-1;++r){const o=e[r+1]-e[r];let s=Math.min(a,o),l=t[r];-1===l&&(s=0);for(let e=0;e<s;++e)i.push(l),l+=n;for(let e=0;e<o-s;++e)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,n,a){const o=e.length,i=[];if(0===o)return[];let r=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));let l=t[s];i.push(l);for(let c=1;c<o;++c){const o=e[c];if(o===s)l>=0&&(++r,r<a?l+=n:l=-1);else{if(r=0,s=o,o>=t.length)throw new Error("Got nextValueRowId=".concat(o," which is not less than ").concat(t.length));l=t[o]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,n,a){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case G9.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,n,a);case G9.ROW_SPLITS:if(o.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(o.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(o,t,n,a);default:throw new Error("Unsupported partition type: ".concat(G9[i]))}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case G9.FIRST_DIM_SIZE:return e[0];case G9.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case G9.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(G9[t]))}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let i=n.length-2;i>=0;--i)n[i]=n[i+1]*t[i+1];const a=k9(t,!1),o=RX(this.valuesDType,bX(a));if(n[0]*t[0]>0){let i=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e)i=this.calculateOutputIndex(e-1,i,n[e],t[e]);this.setOutput(this.raggedRank,i,o,a)}return[a,o]}setOutput(e,t,n,a){if(0===n.length)return;const o=this.values,i=n;let r=a.slice();r=r.slice(e+1);const s=bX(r),l=t.length;let c=this.defaultValue;if(c.length!==s&&1!==c.length){const e=this.defaultValueShape;VJ((()=>{const t=pL(c,e);c=BL(t,r).dataSync()}))}let g=0,u=0,d=0;for(let h=0;h<=l;++h){let e=h<l?t[h]:-1;if(e!==d){if(u<d){const e=o.subarray(g*s);w9(i.subarray(u*s),e,(d-u)*s)}if(h>=l){const t=n.length;e=Math.floor(t/s)}if(e>d)if(1===this.defaultValue.length)i.subarray(d*s,e*s).fill(this.defaultValue[0]),d=e;else for(;e>d;){w9(i.slice(d*s),c,s),++d}e<0?(g=h+1,u=d):(g=h,u=d,d=u+1)}else++d}}}function w9(e,t,n){for(let a=0;a<n;a++)e[a]=t[a]}function k9(e,t){const n=[];for(let a of e){if(a<0){if(!t)throw new Error("Dimension ".concat(a," must be >= 0"));if(a<-1)throw new Error("Dimension ".concat(a," must be >= -1"));a=-1}n.push(a)}return n}function B9(e,t,n,a,o,i,r,s,l,c){return new Z9(e,t,n,a,o,i,r,s,l,c).compute()}function R9(e,t,n,a){if(e===t||e<t&&n<0||t<e&&n>1)return PX(0,a);const o=PX(Math.abs(Math.ceil((t-e)/n)),a);t<e&&1===n&&(n=-1),o[0]=e;for(let i=1;i<o.length;i++)o[i]=o[i-1]+n;return o}const W9=d5((e=>1/Math.sqrt(e))),V9=p5(kE,W9),N9={kernelName:kE,backendName:"cpu",kernelFunc:V9};function X9(e,t,n,a,o,i,r,s,l,c){const g=[a/o,o],u=e.values,d=t.values;if(0===a)return NY(n,t.dtype);const h=l instanceof FH?l:NY(g,t.dtype);"string"==typeof l||"number"==typeof l?h.values.fill(l):"boolean"==typeof l&&h.values.fill(+l);for(let p=0;p<i;p++){const e=[];let i=0;for(let t=0;t<r;t++){const n=u[p*r+t];e.push(n),i+=n*s[t]}if(i<0||i>=a/o)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(n));for(let n=0;n<o;n++)c?h.values[i*o+n]+=d[p*o+n]:h.values[i*o+n]=0===t.rank?d[0]:d[p*o+n]}return h}const M9=d5((e=>1/(1+Math.exp(-e)))),T9=h5(FE,(e=>1/(1+Math.exp(-e)))),E9={kernelName:FE,backendName:"cpu",kernelFunc:T9};function F9(e,t,n,a,o){const i=OP(a,t,n),r=bX(n),s=LX(a);if(i){const n=_P(t,s);return"string"===o?e.slice(n,n+r):e.subarray(n,n+r)}const l=NY(a,o,"string"===o?l_(e):e),c=NY(n,o);for(let g=0;g<c.size;++g){const e=c.indexToLoc(g),n=e.map(((e,n)=>e+t[n]));c.set(l.get(...n),...e)}return"string"===o?c_(c.values):c.values}function H9(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{begin:i,size:r}=a;H3(o,"slice");const[s,l]=QP(o,i,r);FP(o,s,l);const c=F9(n.data.get(o.dataId).values,s,l,o.shape,o.dtype);return n.makeTensorInfo(l,o.dtype,c)}const J9={kernelName:XE,backendName:"cpu",kernelFunc:H9};function Y9(e,t,n,a,o,i,r){const s=t[0],l=i[0],c=new Array(l),g=new Array(s),u=t[1];if(0===l){if(0!==s)throw new Error(UO(s));return[RX(n,0),[0,u],RX(o,0),c,g]}let d=!0,h=0;const p=new Array(l).fill(0);for(let I=0;I<s;++I){const t=e[I*u];if(t<0)throw new Error(PO(I,t));if(t>=l)throw new Error(OO(I,t,l));++p[t],d=d&&t>=h,h=t}let m=!0;for(let I=0;I<l;++I){const e=0===p[I];c[I]=e,m=m&&!e,p[I]=Math.max(p[I],1),I>0&&(p[I]+=p[I-1])}if(m&&d){const t=e,n=a;for(let e=0;e<s;++e)g[e]=e;return[t,[s,u],n,c,g]}{const t=p[l-1],i=RX(n,t*u),d=RX(o,t),h=new Array(l).fill(0);for(let n=0;n<s;++n){const t=e[n*u],o=h[t],r=(0===t?0:p[t-1])+o;h[t]++;for(let a=0;a<u;++a)i[r*u+a]=e[n*u+a];d[r]=a[n],g[n]=r}for(let e=0;e<l;++e)if(0===h[e]){const t=0===e?0:p[e-1];i[t*u+0]=e;for(let e=1;e<u;++e)i[t*u+e]=0;d[t]=r}return[i,[t,u],d,c,g]}}function L9(e,t,n,a,o){const i=bX(a),r=t[0],s=o.length,l=[];let c=1,g=-1;for(let m=0;m<s;++m){const e=o[m];if(-1===e){if(-1!==g)throw new Error(_O(g,m));g=m,l.push(1)}else{if(e<0)throw new Error(QO(m,e));c*=e,l.push(e)}}if(-1!==g){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(i/c);if(c*e!==i)throw new Error(qO(a,l));l[g]=e}if(bX(l)!==i)throw new Error($O(a,l));const u=a.length,d=[];if(u>0){d[u-1]=1;for(let e=u-2;e>=0;--e)d[e]=d[e+1]*a[e+1]}const h=[];if(s>0){h[s-1]=1;for(let e=s-2;e>=0;--e)h[e]=h[e+1]*l[e+1]}const p=RX(n,r*s);for(let m=0;m<r;++m){let t=0;for(let n=0;n<u;++n)t+=e[m*u+n]*d[n];for(let e=0;e<s;++e)p[m*s+e]=Math.trunc(t/h[e]),t%=h[e]}return[p,[r,s],l]}function z9(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=a.length,l=[t[0],e.length/t[0]],c=l[1],g=s>0?o[s-1]+1:0;if(g<0)throw new Error("segment ids must be >= 0");const u=t.slice();u[0]=g;const d=u.reduce(((e,t)=>e*t),1),h=RX(n,d);if(0===s)return g>0&&h.fill(r),[h,u];if(g<=0)throw new Error("segment ids must be >= 0");let p=0,m=1,I=0,C=o[p];for(;;){let t=0;if(m<s){if(t=o[m],C===t){++m;continue}if(C>=t)throw new Error("segment ids are not increasing")}if(C<0||C>=g)throw new Error(n_(C,g));C>I&&h.fill(r,I*c,C*c);for(let n=p;n<m;++n){const t=a[n];if(t<0||t>=l[0])throw new Error(a_(n,a[n],l[0]));for(let n=0;n<c;n++)h[C*c+n]+=e[t*c+n]}if(i)for(let e=0;e<c;e++)h[C*c+e]/=m-p;if(p=m,++m,I=C+1,C=t,m>s)break}return I<g&&h.fill(r,I*c,g*c),[h,u]}const K9=d5((e=>Math.sqrt(e))),D9=h5(JE,(e=>Math.sqrt(e))),U9={kernelName:JE,backendName:"cpu",kernelFunc:D9},P9=K3(((e,t)=>{const n=e-t;return n*n})),O9=t5(QE,P9),_9={kernelName:QE,backendName:"cpu",kernelFunc:O9},Q9=d5(((e,t)=>{const{pattern:n,replaceGlobal:a,rewrite:o}=t;return e.replace(new RegExp(n,a?"g":""),o)})),j9=p5(qE,Q9),q9={kernelName:qE,backendName:"cpu",kernelFunc:j9};function $9(e,t,n,a){const o=NY(e,t.dtype);for(let i=0;i<o.size;i++){const e=o.indexToLoc(i),r=new Array(e.length);for(let t=0;t<r.length;t++)r[t]=e[t]*n[t]+a[t];o.set(t.get(...r),...e)}return o}class e4{constructor(e,t,n,a,o,i){this.separator=vH(e),this.nGramWidths=t,this.leftPad=vH(n),this.rightPad=vH(a),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,a,o,i){for(let r=0;r<o;++r){const s=this.getPadWidth(i),l=Math.max(0,s-r),c=Math.max(0,s-(o-(r+1))),g=i-(l+c),u=t+(l>0?0:r-s);let d=0;d+=l*this.leftPad.length;for(let t=0;t<g;++t)d+=e[u+t].length;d+=c*this.rightPad.length;d+=(l+c+g-1)*this.separator.length,n[a+r]=new Uint8Array(d);const h=n[a+r];let p=0;const m=e=>e.forEach((e=>h[p++]=e));for(let e=0;e<l;++e)m(this.leftPad),m(this.separator);for(let t=0;t<g-1;++t)m(e[u+t]),m(this.separator);if(g>0){m(e[u+g-1]);for(let e=0;e<c;++e)m(this.separator),m(this.rightPad)}else{for(let e=0;e<c-1;++e)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,t){const n=e.length,a=t.length;if(a>0){let e=t[0];if(0!==e)throw new Error("First split value must be 0, got ".concat(e));for(let o=1;o<a;++o){let a=t[o]>=e;if(a=a&&t[o]<=n,!a)throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(e,", ").concat(n,"]"));e=t[o]}if(e!==n)throw new Error("Last split value must be data size. Expected ".concat(n,", got ").concat(e))}const o=a-1,i=RX("int32",a);if(0===n||0===a){const e=new Array(n);for(let t=0;t<=o;++t)i[t]=0;return[e,i]}i[0]=0;for(let s=1;s<=o;++s){const e=t[s]-t[s-1];let n=0;this.nGramWidths.forEach((t=>{n+=this.getNumNGrams(e,t)})),this.preserveShort&&e>0&&0===n&&(n=1),i[s]=i[s-1]+n}const r=new Array(i[o]);for(let s=0;s<o;++s){const n=t[s];let a=i[s];if(this.nGramWidths.forEach((o=>{const i=t[s+1]-t[s],l=this.getNumNGrams(i,o);this.createNGrams(e,n,r,a,l,o),a+=l})),this.preserveShort&&a===i[s]){const o=t[s+1]-t[s];if(0===o)continue;const i=o+2*this.padWidth;this.createNGrams(e,n,r,a,1,i)}}return[r,i]}}function t4(e,t,n,a,o,i,r,s){return new e4(n,a,o,i,r,s).compute(e,t)}function n4(e,t,n,a){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)a.push(e.subarray(t,t+1));return}if(1===t.length){const o=t[0];let i=e.indexOf(o);for(;-1!==i;){const t=e.subarray(0,i);(!n||0!==t.length)&&a.push(t),i=(e=e.subarray(i+1)).indexOf(o)}return void((!n||0!==e.length)&&a.push(e))}let o=0;for(let i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){const t=e.subarray(o,i);(!n||0!==t.length)&&a.push(t),o=i+1}}function a4(e,t,n){const a=e.length,o=[];let i=0,r=0;const s=new Array(a);for(let d=0;d<a;++d){const a=o.length;n4(e[d],t,n,o);const l=o.length-a;s[d]=l,i+=l,r=Math.max(r,l)}const l=RX("int32",2*i),c=new Array(i),g=[a,r];let u=0;for(let d=0;d<a;++d)for(let e=0;e<s[d];++e)l[2*u]=d,l[2*u+1]=e,c[u]=o[u],++u;return[l,c,g]}function o4(e,t){const n=RX("int32",e.length);for(let a=0;a<e.length;++a)n[a]=CH(e[a]).modulo(t).getLowBitsUnsigned();return n}const i4=K3(((e,t)=>e-t)),r4=n5(((e,t,n,a)=>({real:e-n,imag:t-a}))),s4=t5(aF,i4,r4),l4={kernelName:aF,backendName:"cpu",kernelFunc:s4};function c4(e,t){const n=new Array(e.rank);for(let o=0;o<n.length;o++)n[o]=e.shape[o]*t[o];const a=NY(n,e.dtype);for(let o=0;o<a.values.length;++o){const t=a.indexToLoc(o),n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=t[a]%e.shape[a];const i=e.locToIndex(n);a.values[o]=e.values[i]}return a}const g4=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function u4(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;for(;a>n;){if(a-n>600){const o=a-n+1,i=t-n+1,r=Math.log(o),s=.5*Math.exp(2*r/3),l=.5*Math.sqrt(r*s*(o-s)/o)*Math.sign(i-o/2);u4(e,t,Math.max(n,Math.floor(t-i*s/o+l)),Math.min(a,Math.floor(t+(o-i)*s/o+l)))}const o=e[t];let i=n,r=a;for(pX(e,n,t),g4(e[a],o)>0&&pX(e,n,a);i<r;){for(pX(e,i,r),i++,r--;g4(e[i],o)<0;)i+=1;for(;g4(e[r],o)>0;)r-=1}0===g4(e[n],o)?pX(e,n,r):(r+=1,pX(e,r,a)),r<=t&&(n=r+1),t<=r&&(a=r-1)}}function d4(e,t,n,a,o){const i=t[t.length-1],[r,s]=[e.length/i,i],l=BX(n,r*a),c=BX("int32",r*a);for(let u=0;u<r;u++){const t=u*s,n=e.subarray(t,t+s);let i=new Array(n.length);n.forEach(((e,t)=>i[t]={value:e,index:t})),a<i.length&&(u4(i,a),i=i.slice(0,a)),o&&i.sort(g4);const r=u*a,g=l.subarray(r,r+a),d=c.subarray(r,r+a);for(let e=0;e<a;e++)g[e]=i[e].value,d[e]=i[e].index}const g=t.slice();return g[g.length-1]=a,[NY(g,n,l),NY(g,"int32",c)]}function h4(e,t,n,a){const o=wX(t,n)[0],i=[1,n[0],1];for(let p=0;p<o;p++)i[0]*=n[p];i[1]=n[o];for(let p=o+1;p<n.length;p++)i[2]*=n[p];const r=new Map,s=new Int32Array(n[o]),l=new FH(i,a,e),c=[],g=1===i[0]&&1===i[2];for(let p=0;p<n[o];p++){let t;if(g)t=e[p].toString();else{const e=[];for(let t=0;t<i[0];t++)for(let n=0;n<i[2];n++)e.push(l.get(t,p,n));t=e.join(",")}const n=r.get(t);if(null!=n)s[p]=n;else{const e=r.size;r.set(t,e),s[p]=e,c.push(p)}}const u=i.slice();u[1]=r.size;const d=new FH(u,a);c.forEach(((e,t)=>{for(let n=0;n<i[0];n++)for(let a=0;a<i[2];a++)d.set(l.get(n,e,a),n,t,a)}));const h=n.slice();return h[o]=u[1],{outputValues:d.values,outputShape:h,indices:s}}const p4=Object.freeze(Object.defineProperty({__proto__:null,addImpl:a5,bincountImpl:s5,bincountReduceImpl:l5,bitwiseAndImpl:c5,castImpl:q3,ceilImpl:m5,concatImpl:f5,equalImpl:b5,expImpl:v5,expm1Impl:G5,floorDivImpl:W5,floorImpl:k5,gatherNdImpl:X5,gatherV2Impl:M5,greaterEqualImpl:H5,greaterImpl:T5,lessEqualImpl:D5,lessImpl:L5,linSpaceImpl:O5,logImpl:_5,maxImpl:q5,maximumImpl:$5,minimumImpl:n9,multiplyImpl:i9,negImpl:c9,notEqualImpl:u9,prodImpl:C9,raggedGatherImpl:v9,raggedRangeImpl:x9,raggedTensorToTensorImpl:B9,rangeImpl:R9,rsqrtImpl:W9,scatterImpl:X9,sigmoidImpl:M9,simpleAbsImpl:L3,sliceImpl:F9,sparseFillEmptyRowsImpl:Y9,sparseReshapeImpl:L9,sparseSegmentReductionImpl:z9,sqrtImpl:K9,squaredDifferenceImpl:P9,staticRegexReplaceImpl:Q9,stridedSliceImpl:$9,stringNGramsImpl:t4,stringSplitImpl:a4,stringToHashBucketFastImpl:o4,subImpl:i4,tileImpl:c4,topKImpl:d4,transposeImpl:p9,uniqueImpl:h4},Symbol.toStringTag,{value:"Module"}));TJ("cpu",(()=>new Y3),1);const m4=h5(rT,(e=>e>=0?e:Math.exp(e)-1)),I4={kernelName:rT,backendName:"cpu",kernelFunc:m4};function C4(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{alpha:i}=a;H3([o],"leakyRelu");const r=bX(o.shape),s=n.data.get(o.dataId).values,l=BX("float32",r);for(let c=0;c<s.length;c++)l[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(o.shape,"float32",l)}const f4={kernelName:BT,backendName:"cpu",kernelFunc:C4},b4=K3(((e,t)=>e<0?t*e:e));function y4(e){const{inputs:t,backend:n}=e,{x:a,alpha:o}=t;H3([a,o],"prelu");const i=n.data.get(a.dataId).values,r=n.data.get(o.dataId).values,[s,l]=b4(a.shape,o.shape,i,r,"float32");return n.makeTensorInfo(l,"float32",s)}const A4={kernelName:uE,backendName:"cpu",kernelFunc:y4},v4=h5(bE,(e=>Math.max(0,e))),S4={kernelName:bE,backendName:"cpu",kernelFunc:v4},x4=h5(GE,(e=>Math.min(Math.max(0,e),6))),G4={kernelName:GE,backendName:"cpu",kernelFunc:x4};function Z4(e,t,n,a,o){if("linear"===n)return O3({inputs:{x:t},backend:e});if("relu"===n)return v4({inputs:{x:t},backend:e});if("elu"===n)return m4({inputs:{x:t},backend:e});if("relu6"===n)return x4({inputs:{x:t},backend:e});if("prelu"===n)return y4({inputs:{x:t,alpha:a},backend:e});if("leakyrelu"===n)return C4({inputs:{x:t},backend:e,attrs:{alpha:o}});if("sigmoid"===n)return T9({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function w4(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{shape:i}=a,r=bX(o.shape),s=ZX(i,r),l=bX(s);IX(r===l,(()=>"The new shape (".concat(s,") has ").concat(l," elements and the old shape (").concat(o.shape,") has ").concat(r," elements. The new shape and old shape must have the same number of elements."))),n.incRef(o.dataId);const c=n.data.get(o.dataId);if(null!=c.complexTensorInfos){const e=c.complexTensorInfos.real,t=c.complexTensorInfos.imag;e.shape=s,t.shape=s}return{dataId:o.dataId,shape:s,dtype:o.dtype}}const k4={kernelName:yE,backendName:"cpu",kernelFunc:w4};function B4(e){const{inputs:t,backend:n,attrs:a}=e,{a:o,b:i}=t,{transposeA:r,transposeB:s}=a;H3([o,i],"matMul");const l=o.shape.length,c=i.shape.length,g=r?o.shape[l-2]:o.shape[l-1],u=s?i.shape[c-1]:i.shape[c-2],d=r?o.shape[l-1]:o.shape[l-2],h=s?i.shape[c-2]:i.shape[c-1],p=o.shape.slice(0,-2),m=i.shape.slice(0,-2),I=bX(p),C=bX(m),f=ez(o.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,h]);IX(g===u,(()=>"Error in matMul: inner shapes (".concat(g,") and (").concat(u,") of Tensors with shapes ").concat(o.shape," and ").concat(i.shape," and transposeA=").concat(r," and transposeB=").concat(s," must match.")));const b=s?[C,h,u]:[C,u,h],y=w4({inputs:{x:o},backend:n,attrs:{shape:r?[I,g,d]:[I,d,g]}}),A=w4({inputs:{x:i},backend:n,attrs:{shape:b}}),v=r?y.shape[1]:y.shape[2],S=r?y.shape[2]:y.shape[1],x=s?A.shape[1]:A.shape[2],G=Math.max(I,C),Z=n.data.get(y.dataId).values,w=n.data.get(A.dataId).values,k=LX(y.shape),B=LX(A.shape),[R,W,V]=r?[k[0],1,k[1]]:[k[0],k[1],1],[N,X,M]=s?[1,B[1],B[0]]:[B[1],1,B[0]],T=S*x,E=NY([G,S,x],y.dtype),F=E.values,H=n.blockSize;for(let J=0;J<G;J++){const e=J%I,t=J%C;for(let n=0;n<S;n+=H){const a=Math.min(n+H,S);for(let o=0;o<x;o+=H){const i=Math.min(o+H,x);for(let r=0;r<v;r+=H){const s=Math.min(r+H,v);for(let l=n;l<a;l++)for(let n=o;n<i;n++){let a=0;for(let o=r;o<s;o++){a+=Z[e*R+l*W+o*V]*w[o*N+n*X+t*M]}F[J*T+(l*x+n)]+=a}}}}}return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(A),n.makeTensorInfo(f,E.dtype,E.values)}const R4={kernelName:GM,backendName:"cpu",kernelFunc:B4};const W4={kernelName:CF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{a:o,b:i,bias:r,preluActivationWeights:s}=t,{transposeA:l,transposeB:c,activation:g,leakyreluAlpha:u}=a;let d,h,p;const m=[];d=B4({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:c},backend:n}),r&&(h=i5({inputs:{a:d,b:r},backend:n}),m.push(d),d=h),g&&(p=Z4(n,d,g,s,u),m.push(d),d=p);for(const I of m)n.disposeIntermediateTensorInfo(I);return d}},V4=h5(lM,(e=>Math.acos(e))),N4={kernelName:lM,backendName:"cpu",kernelFunc:V4},X4=h5(cM,(e=>Math.acosh(e))),M4={kernelName:cM,backendName:"cpu",kernelFunc:X4};const T4={kernelName:uM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,a=t;H3(t,"addN");const o=a.map((e=>n.data.get(e.dataId).values)),i=NY(a[0].shape,a[0].dtype),r=i.values;for(let s=0;s<a.length;s++){const e=o[s];for(let t=0;t<r.length;t++)r[t]+=e[t]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}};const E4={kernelName:dM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a;H3(o,"all");const s=wX(i,o.shape);let l=s;const c=mz(l,o.shape.length);let g=o;null!=c&&(g=m9({inputs:{x:o},backend:n,attrs:{perm:c}}),l=Cz(l.length,o.shape.length)),pz("all",l,g.shape.length);const[u,d]=dz(g.shape,l),h=bX(d),p=PX(bX(u),g.dtype),m=n.data.get(g.dataId).values;for(let C=0;C<p.length;++C){const e=C*h;let t=m[e];for(let n=0;n<h;++n){const a=m[e+n];t=t&&a}p[C]=t}null!=c&&n.disposeIntermediateTensorInfo(g);const I=n.makeTensorInfo(u,g.dtype,p);if(r){const e=w4({inputs:{x:I},backend:n,attrs:{shape:hz(u,s)}});return n.disposeIntermediateTensorInfo(I),e}return I}};const F4={kernelName:hM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a;H3(o,"any");const s=wX(i,o.shape);let l=s;const c=mz(l,o.shape.length);let g=o;null!=c&&(g=m9({inputs:{x:o},backend:n,attrs:{perm:c}}),l=Cz(l.length,o.shape.length)),pz("any",l,g.shape.length);const[u,d]=dz(g.shape,l),h=bX(d),p=PX(bX(u),g.dtype),m=n.data.get(g.dataId).values;for(let C=0;C<p.length;++C){const e=C*h;let t=m[e];for(let n=0;n<h;++n){const a=m[e+n];t=t||a}p[C]=t}null!=c&&n.disposeIntermediateTensorInfo(g);const I=n.makeTensorInfo(u,g.dtype,p);if(r){const e=w4({inputs:{x:I},backend:n,attrs:{shape:hz(u,s)}});return n.disposeIntermediateTensorInfo(I),e}return I}};const H4={kernelName:pM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i}=a;H3(o,"argMax");let r=wX(i,o.shape);const s=mz(r,o.shape.length);let l=o;const c=[];null!=s&&(l=m9({inputs:{x:o},backend:n,attrs:{perm:s}}),c.push(l),r=Cz(r.length,l.shape.length)),r=[r[0]],pz("argMax",r,l.shape.length);const[g,u]=dz(l.shape,r),d=PX(bX(g),"int32"),h=bX(u),p=n.data.get(l.dataId).values;for(let m=0;m<d.length;++m){const e=m*h;let t=p[e],n=0;for(let a=0;a<h;++a){const o=p[e+a];o>t&&(t=o,n=a)}d[m]=n}return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(g,"int32",d)}};const J4={kernelName:mM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i}=a;H3(o,"argMin");let r=wX(i,o.shape);const s=mz(r,o.shape.length);let l=o;const c=[];null!=s&&(l=m9({inputs:{x:o},backend:n,attrs:{perm:s}}),c.push(l),r=Cz(r.length,l.shape.length)),r=[r[0]],pz("argMin",r,l.shape.length);const[g,u]=dz(l.shape,r),d=PX(bX(g),"int32"),h=bX(u),p=n.data.get(l.dataId).values;for(let m=0;m<d.length;++m){const e=m*h;let t=p[e],n=0;for(let a=0;a<h;++a){const o=p[e+a];o<t&&(t=o,n=a)}d[m]=n}return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(g,"int32",d)}},Y4=h5(IM,(e=>Math.asin(e))),L4={kernelName:IM,backendName:"cpu",kernelFunc:Y4},z4=h5(CM,(e=>Math.asinh(e))),K4={kernelName:CM,backendName:"cpu",kernelFunc:z4},D4=h5(fM,(e=>Math.atan(e))),U4={kernelName:fM,backendName:"cpu",kernelFunc:D4},P4=K3(((e,t)=>Math.atan2(e,t))),O4=t5(yM,P4),_4={kernelName:yM,backendName:"cpu",kernelFunc:O4},Q4=h5(bM,(e=>Math.atanh(e))),j4={kernelName:bM,backendName:"cpu",kernelFunc:Q4};function q4(e,t,n,a,o,i){const r=o.strideHeight,s=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,g=o.effectiveFilterHeight,u=o.effectiveFilterWidth,d=o.padInfo.top,h=o.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=NY(o.outShape,n),I=m.values,C=o.outShape[1]*o.outShape[2]*o.outShape[3],f=o.outShape[2]*o.outShape[3],b=o.outShape[3];for(let y=0;y<o.batchSize;++y){const t=y*C,n=y*a[0];for(let m=0;m<o.inChannels;++m)for(let C=0;C<o.outHeight;++C){const y=C*r-d,A=Math.max(0,y),v=Math.min(o.inHeight,g+y),S=t+C*f;for(let t=0;t<o.outWidth;++t){const r=t*s-h,g=Math.max(0,r),d=Math.min(o.inWidth,u+r);let C=p,f=0,y=0;for(let t=A;t<v;t+=l){const o=n+t*a[1];for(let t=g;t<d;t+=c){const n=e[o+t*a[2]+m];"max"===i&&n>C?C=n:"avg"===i&&(f+=n,y++)}if(isNaN(C))break}I[S+t*b+m]="avg"===i?f/y:C}}}return m}function $4(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=NY(a.outShape,"int32"),s=a.strideHeight,l=a.strideWidth,c=a.dilationHeight,g=a.dilationWidth,u=a.effectiveFilterHeight,d=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,m=NY(t,n,e);for(let I=0;I<a.batchSize;++I)for(let e=0;e<a.inChannels;++e)for(let t=0;t<a.outHeight;++t){const n=t*s-h;let C=n;for(;C<0;)C+=c;const f=Math.min(a.inHeight,u+n);for(let s=0;s<a.outWidth;++s){const u=s*l-p;let h=u;for(;h<0;)h+=g;const b=Math.min(a.inWidth,d+u);let y=Number.NEGATIVE_INFINITY,A=-1;for(let t=C;t<f;t+=c){const r=t-n;for(let n=h;n<b;n+=g){const s=n-u,l=m.get(I,t,n,e);l>y&&(y=l,A=o?i?((I*a.inHeight+t)*a.inWidth+n)*a.inChannels+e:(t*a.inWidth+n)*a.inChannels+e:r*d+s)}}r.set(A,I,t,s,e)}}return r}function e8(e,t,n,a,o,i){const r=o.strideDepth,s=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,g=o.dilationHeight,u=o.dilationWidth,d=o.effectiveFilterDepth,h=o.effectiveFilterHeight,p=o.effectiveFilterWidth,m=o.padInfo.front,I=o.padInfo.top,C=o.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=NY(o.outShape,n),y=b.values,A=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],v=o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[3]*o.outShape[4],x=o.outShape[4];for(let G=0;G<o.batchSize;++G){const t=G*A,n=G*a[0];for(let b=0;b<o.inChannels;++b)for(let A=0;A<o.outDepth;++A){const G=A*r-m;let Z=G;for(;Z<0;)Z+=c;const w=Math.min(o.inDepth,d+G),k=t+A*v;for(let t=0;t<o.outHeight;++t){const r=t*s-I;let d=r;for(;d<0;)d+=g;const m=Math.min(o.inHeight,h+r),A=k+t*S;for(let t=0;t<o.outWidth;++t){const r=t*l-C;let s=r;for(;s<0;)s+=u;const h=Math.min(o.inWidth,p+r),I=A+t*x;let v=f,S=0,G=0;for(let t=Z;t<w;t+=c){const o=n+t*a[1];for(let t=d;t<m;t+=g){const n=o+t*a[2];for(let t=s;t<h;t+=u){const o=e[n+t*a[3]+b];if("max"===i&&o>v?v=o:"avg"===i&&(S+=o,G++),isNaN(v))break}if(isNaN(v))break}if(isNaN(v))break}y[I+b]="avg"===i?S/Math.max(G,1):v}}}}return b}const t8={kernelName:AM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t;H3(o,"avgPool");const{filterSize:i,strides:r,pad:s,dimRoundingMode:l}=a;IX(gL(r,1),(()=>"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(1,"'")));const c=eL(o.shape,i,r,1,s,l);let g;if(1===c.filterWidth&&1===c.filterHeight&&AX(c.inShape,c.outShape))g=O3({inputs:{x:o},backend:n});else{const e=n.data.get(o.dataId).values,t=LX(o.shape),a=q4(e,o.shape,o.dtype,t,c,"avg");g=n.makeTensorInfo(c.outShape,o.dtype,a.values)}return g}};const n8={kernelName:SM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{filterSize:i,strides:r,pad:s,dimRoundingMode:l,dataFormat:c}=a;H3(o,"avgPool3d");const g=tL(o.shape,i,r,1,s,l,c),u=e8(n.data.get(o.dataId).values,o.shape,o.dtype,LX(o.shape),g,"avg");return n.makeTensorInfo(u.shape,"float32",u.values)}};const a8={kernelName:xM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i}=t,{filterSize:r,strides:s,pad:l,dimRoundingMode:c}=a;H3([o,i],"avgPool3DGrad");const g=tL(i.shape,r,s,1,l,c),u=g.strideDepth,d=g.strideHeight,h=g.strideWidth,p=g.filterDepth,m=g.filterHeight,I=g.filterWidth,C=g.dilationDepth,f=g.dilationHeight,b=g.dilationWidth,y=g.effectiveFilterDepth,A=g.effectiveFilterHeight,v=g.effectiveFilterWidth,S=y-1-g.padInfo.front,x=v-1-g.padInfo.left,G=A-1-g.padInfo.top,Z=NY(i.shape,"float32"),w=1/(p*m*I),k=n.bufferSync(o);for(let B=0;B<g.batchSize;++B)for(let e=0;e<g.inChannels;++e)for(let t=0;t<g.inDepth;++t)for(let n=0;n<g.inHeight;++n)for(let a=0;a<g.inWidth;++a){const o=t-S,i=n-G,r=a-x;let s=0;for(let t=0;t<y;t+=C){const n=(o+t)/u;if(!(n<0||n>=g.outDepth||Math.floor(n)!==n))for(let t=0;t<A;t+=f){const a=(i+t)/d;if(!(a<0||a>=g.outHeight||Math.floor(a)!==a))for(let t=0;t<v;t+=b){const o=(r+t)/h;if(o<0||o>=g.outWidth||Math.floor(o)!==o)continue;s+=k.get(B,n,a,o,e)}}}Z.set(s*w,B,t,n,a,e)}return n.makeTensorInfo(Z.shape,Z.dtype,Z.values)}};const o8={kernelName:vM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i}=t,r=i;H3([o,i],"avgPoolGrad");const{filterSize:s,strides:l,pad:c}=a,g=eL(r.shape,s,l,1,c),u=g.strideHeight,d=g.strideWidth,h=g.filterHeight,p=g.filterWidth,m=g.dilationHeight,I=g.dilationWidth,C=g.effectiveFilterHeight,f=g.effectiveFilterWidth,b=f-1-g.padInfo.left,y=C-1-g.padInfo.top,A=NY(r.shape,"float32"),v=1/(h*p),S=n.data.get(o.dataId).values,x=NY(o.shape,"float32",S);for(let G=0;G<g.batchSize;++G)for(let e=0;e<g.inChannels;++e)for(let t=0;t<g.inHeight;++t)for(let n=0;n<g.inWidth;++n){const a=t-y,o=n-b;let i=0;for(let t=0;t<C;t+=m){const n=(a+t)/u;if(!(n<0||n>=g.outHeight||Math.floor(n)!==n))for(let t=0;t<f;t+=I){const a=(o+t)/d;if(a<0||a>=g.outWidth||Math.floor(a)!==a)continue;i+=x.get(G,n,a,e)}}A.set(i*v,G,t,n,e)}return n.makeTensorInfo(A.shape,A.dtype,A.values)}};const i8={kernelName:fT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,scale:i,offset:r,mean:s,variance:l}=t;IX(s.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),IX(null==r||s.shape.length===r.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),IX(null==i||s.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),H3([o,s,l,i,r],"batchNorm");let{varianceEpsilon:c}=a;null==c&&(c=.001);const g=n.data.get(o.dataId).values,u=n.data.get(s.dataId).values,d=n.data.get(l.dataId).values,h=i?n.data.get(i.dataId).values:new Float32Array([1]),p=r?n.data.get(r.dataId).values:new Float32Array([0]),m=new Float32Array(g.length),I=p.length,C=h.length,f=d.length,b=u.length;let y=0,A=0,v=0,S=0;for(let x=0;x<g.length;++x)m[x]=p[y++]+(g[x]-u[A++])*h[v++]/Math.sqrt(d[S++]+c),y>=I&&(y=0),A>=b&&(A=0),v>=C&&(v=0),S>=f&&(S=0);return n.makeTensorInfo(o.shape,o.dtype,m)}};const r8={kernelName:ZM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{blockShape:i,crops:r}=a;H3([o],"batchToSpaceND");const s=i.reduce(((e,t)=>e*t)),l=pO(o.shape,i,s),c=mO(l.length,i.length),g=IO(o.shape,i,s),u=CO(r,i.length),d=fO(g,r,i.length),h=w4({inputs:{x:o},backend:n,attrs:{shape:l}}),p=m9({inputs:{x:h},backend:n,attrs:{perm:c}}),m=w4({inputs:{x:p},backend:n,attrs:{shape:g}}),I=H9({inputs:{x:m},backend:n,attrs:{begin:u,size:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),I}};const s8={kernelName:wM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,weights:i}=t,{size:r}=a,s=s5(n.data.get(o.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,r);return n.makeTensorInfo([r],i.dtype,s)}};const l8={kernelName:RM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:a,s1:o}=t,i=n.data.get(a.dataId).values,r=n.data.get(o.dataId).values,s=ez(Array.from(i),Array.from(r));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},c8=h5(NM,((e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),g8={kernelName:NM,backendName:"cpu",kernelFunc:c8},u8={kernelName:MM,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,a=new Float32Array(bX(t.shape)),o=n.data.get(t.dataId),i=o.complexTensorInfos.real,r=o.complexTensorInfos.imag,s=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values;for(let c=0;c<s.length;c++){const e=s[c],t=l[c];a[c]=Math.hypot(e,t)}return n.makeOutput(a,t.shape,"float32")}};function d8(e){const{inputs:t,backend:n}=e,{input:a}=t,o=n.data.get(a.dataId).complexTensorInfos.imag,i=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,i)}const h8={kernelName:GT,backendName:"cpu",kernelFunc:d8};function p8(e){const{inputs:t,backend:n,attrs:a}=e,{axis:o}=a,i=wX(o,t[0].shape)[0];oO(t.map((e=>e.shape)),i);let r=iO(t.map((e=>e.shape)),i);if(0===bX(r))return n.makeTensorInfo(r,t[0].dtype,[]);const s=t.filter((e=>bX(e.shape)>0));if(1===s.length)return O3({inputs:{x:s[0]},backend:n});if("complex64"===s[0].dtype){const e=s.map((e=>Q3({inputs:{input:e},backend:n}))),t=s.map((e=>d8({inputs:{input:e},backend:n}))),a=p8({inputs:e,backend:n,attrs:{axis:i}}),o=p8({inputs:t,backend:n,attrs:{axis:i}}),r=D3({inputs:{real:a,imag:o},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),r}const l=s.map((e=>{const t=[-1,bX(e.shape.slice(i))];return w4({inputs:{x:e},backend:n,attrs:{shape:t}})})),c=l.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));r=iO(l.map((e=>e.shape)),1);const g=1===l[0].shape[0],u=f5(c,r,t[0].dtype,g),d=iO(s.map((e=>e.shape)),i),h=n.makeTensorInfo(d,t[0].dtype,u);return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),h}const m8={kernelName:TM,backendName:"cpu",kernelFunc:p8};function I8(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i}=t,{strides:r,pad:s,dataFormat:l,dilations:c,dimRoundingMode:g}=a;H3([o,i],"conv2d");const u=dL(l),d=nL(o.shape,i.shape,r,c,s,g,!1,u),h=d.filterHeight,p=d.filterWidth,m=d.dilationHeight,I=d.dilationWidth,C=d.padInfo.left,f=d.padInfo.top,b="channelsLast"===d.dataFormat,y=new FH(d.outShape,o.dtype),A=LX(o.shape),v=LX(i.shape),S=A[0],x=b?A[1]:A[2],G=b?A[2]:1,Z=b?1:A[1],w=y.strides[0],k=b?y.strides[1]:y.strides[2],B=b?y.strides[2]:1,R=b?1:y.strides[1],W=n.data.get(o.dataId).values,V=n.data.get(i.dataId).values,N=y.values;for(let X=0;X<d.batchSize;++X){const e=X*S,t=X*w;for(let n=0;n<d.outHeight;++n){const a=t+n*k,o=n*d.strideHeight-f;for(let t=0;t<h;++t){const n=o+t*m;if(n<0||n>=d.inHeight)continue;const i=t*v[0],r=e+n*x;for(let e=0;e<d.outWidth;++e){const t=a+e*B,n=e*d.strideWidth-C;for(let e=0;e<p;++e){const a=n+e*I;if(a<0||a>=d.inWidth)continue;const o=r+a*G;let s=i+e*v[1];for(let e=0;e<d.inChannels;++e){const n=W[o+e*Z];for(let e=0;e<d.outChannels;++e)N[t+e*R]+=n*V[s+e];s+=d.outChannels}}}}}}return n.makeTensorInfo(y.shape,y.dtype,N)}const C8={kernelName:EM,backendName:"cpu",kernelFunc:I8};const f8={kernelName:FM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,dy:i}=t,{strides:r,pad:s,dataFormat:l,dimRoundingMode:c,filterShape:g}=a;H3([o,i],"conv2dBackpropFilter");const u=dL(l),d=nL(o.shape,g,r,1,s,c,!1,u),{strideHeight:h,strideWidth:p,filterHeight:m,filterWidth:I}=d,C="channelsLast"===d.dataFormat,f=new FH(d.filterShape,"float32"),b=d.padInfo.left,y=d.padInfo.top,A=n.data.get(o.dataId).values,v=n.data.get(i.dataId).values,S=new FH(o.shape,o.dtype,A),x=new FH(i.shape,i.dtype,v);for(let G=0;G<m;++G){const e=Math.max(0,Math.ceil((y-G)/h)),t=Math.min(d.outHeight,(d.inHeight+y-G)/h);for(let n=0;n<I;++n){const a=Math.max(0,Math.ceil((b-n)/p)),o=Math.min(d.outWidth,(d.inWidth+b-n)/p);for(let i=0;i<d.inChannels;++i)for(let r=0;r<d.outChannels;++r){let s=0;for(let l=0;l<d.batchSize;++l)for(let c=e;c<t;++c){const e=G+c*h-y;for(let t=a;t<o;++t){const a=n+t*p-b;s+=C?S.get(l,e,a,i)*x.get(l,c,t,r):S.get(l,i,e,a)*x.get(l,r,c,t)}}f.set(s,G,n,i,r)}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};const b8={kernelName:HM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,filter:i}=t,{inputShape:r,strides:s,pad:l,dataFormat:c,dimRoundingMode:g}=a;H3([o,i],"conv2dBackpropInput");const u=LX(i.shape),d=LX(o.shape);let h=dL(c);const p=nL(r,i.shape,s,1,l,g,!1,h),m=new FH(p.inShape,"float32"),I=m.values,C=n.data.get(o.dataId).values,f=n.data.get(i.dataId).values,[b,y,A]=u,{batchSize:v,filterHeight:S,filterWidth:x,inChannels:G,inHeight:Z,inWidth:w,outChannels:k,outHeight:B,outWidth:R,strideHeight:W,strideWidth:V}=p;h=p.dataFormat;const N=S-1-p.padInfo.top,X=x-1-p.padInfo.left,M="channelsLast"===h,T=m.strides[0],E=M?m.strides[1]:m.strides[2],F=M?m.strides[2]:1,H=M?1:m.strides[1],J=d[0],Y=M?d[1]:d[2],L=M?d[2]:1,z=M?1:d[1];for(let K=0;K<v;++K)for(let e=0;e<G;++e)for(let t=0;t<Z;++t){const n=t-N,a=Math.max(0,Math.ceil(n/W)),o=Math.min(B,(S+n)/W);for(let i=0;i<w;++i){const r=i-X,s=Math.max(0,Math.ceil(r/V)),l=Math.min(R,(x+r)/V);let c=0;for(let t=a;t<o;++t){const a=t*W-n;for(let n=s;n<l;++n){const o=J*K+Y*t+L*n,i=b*(S-1-a)+y*(x-1-(n*V-r))+A*e;for(let e=0;e<k;++e){c+=C[o+z*e]*f[i+e]}}}I[T*K+E*t+F*i+H*e]=c}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const y8={kernelName:JM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i}=t,{strides:r,pad:s,dilations:l}=a;H3([o,i],"conv3d");const c=aL(o.shape,i.shape,r,l,s),{filterDepth:g,filterHeight:u,filterWidth:d,dilationDepth:h,dilationHeight:p,dilationWidth:m,padInfo:I}=c,C=I.front,f=I.left,b=I.top,y=new FH(c.outShape,o.dtype),A=n.data.get(o.dataId).values,v=n.data.get(i.dataId).values,S=y.values,x=LX(o.shape),G=LX(i.shape);for(let Z=0;Z<c.batchSize;++Z){const e=Z*x[0],t=Z*y.strides[0];for(let n=0;n<c.outDepth;++n){const a=t+n*y.strides[1],o=n*c.strideDepth-C;for(let t=0;t<g;++t){const n=o+t*h;if(n<0||n>=c.inDepth)continue;const i=t*G[0],r=e+n*x[1];for(let e=0;e<c.outHeight;++e){const t=a+e*y.strides[2],n=e*c.strideHeight-b;for(let e=0;e<u;++e){const a=n+e*p;if(a<0||a>=c.inHeight)continue;const o=i+e*G[1],s=r+a*x[2];for(let e=0;e<c.outWidth;++e){const n=t+e*c.outChannels,a=e*c.strideWidth-f;for(let e=0;e<d;++e){const t=a+e*m;if(t<0||t>=c.inWidth)continue;const i=o+e*G[2],r=s+t*c.inChannels;let l=i;for(let e=0;e<c.inChannels;++e){const t=A[r+e];for(let e=0;e<c.outChannels;++e)S[n+e]+=t*v[l+e];l+=c.outChannels}}}}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const A8={kernelName:YM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,dy:i}=t,{strides:r,pad:s,filterShape:l}=a;H3([o,i],"conv3dBackpropFilterV2");const c=LX(o.shape),g=LX(i.shape),u=aL(o.shape,l,r,1,s),d=u.strideDepth,h=u.strideHeight,p=u.strideWidth,m=u.filterDepth,I=u.filterHeight,C=u.filterWidth,f=new FH(u.filterShape,"float32"),b=f.values,[y,A,v,S]=f.strides,x=n.data.get(i.dataId).values,[G,Z,w,k]=g,B=n.data.get(o.dataId).values,[R,W,V,N]=c,X=u.padInfo.front,M=u.padInfo.left,T=u.padInfo.top;for(let E=0;E<m;++E){const e=Math.max(0,Math.ceil((X-E)/d)),t=Math.min(u.outDepth,(u.inDepth+X-E)/d),n=E*y;for(let a=0;a<I;++a){const o=Math.max(0,Math.ceil((T-a)/h)),i=Math.min(u.outHeight,(u.inHeight+T-a)/h),r=a*A+n;for(let n=0;n<C;++n){const s=Math.max(0,Math.ceil((M-n)/p)),l=Math.min(u.outWidth,(u.inWidth+M-n)/p),c=n*v+r;for(let r=0;r<u.inChannels;++r){const g=r*S+c;for(let c=0;c<u.outChannels;++c){let m=0;for(let g=0;g<u.batchSize;++g){const u=g*R,I=g*G;for(let g=e;g<t;++g){const e=(E+g*d-X)*W+u,t=g*Z+I;for(let g=o;g<i;++g){const o=(a+g*h-T)*V+e,i=g*w+t;for(let e=s;e<l;++e){const t=e*k+i;m+=B[(n+e*p-M)*N+o+r]*x[t+c]}}}}b[g+c]=m}}}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};const v8={kernelName:LM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,filter:i}=t,{pad:r,strides:s,inputShape:l}=a;H3([o],"conv3dBackpropInputV2");const c=LX(o.shape),g=LX(i.shape),u=aL(l,i.shape,s,1,r),d=new FH(u.inShape,"float32"),h=d.values,[p,m,I,C]=d.strides,f=n.data.get(o.dataId).values,[b,y,A,v]=c,S=n.data.get(i.dataId).values,[x,G,Z,w]=g,{batchSize:k,filterDepth:B,filterHeight:R,filterWidth:W,inChannels:V,inDepth:N,inHeight:X,inWidth:M,outChannels:T,outDepth:E,outHeight:F,outWidth:H,strideDepth:J,strideHeight:Y,strideWidth:L}=u,z=B-1-u.padInfo.front,K=R-1-u.padInfo.top,D=W-1-u.padInfo.left;for(let U=0;U<k;++U)for(let e=0;e<V;++e)for(let t=0;t<N;++t){const n=t-z,a=Math.max(0,Math.ceil(n/J)),o=Math.min(E,(B+n)/J);for(let i=0;i<X;++i){const r=i-K,s=Math.max(0,Math.ceil(r/Y)),l=Math.min(F,(R+r)/Y);for(let c=0;c<M;++c){const g=c-D,u=Math.max(0,Math.ceil(g/L)),d=Math.min(H,(W+g)/L);let k=0;for(let t=a;t<o;++t){const a=t*J-n;for(let n=s;n<l;++n){const o=n*Y-r;for(let i=u;i<d;++i){const r=b*U+y*t+A*n+v*i,s=x*(B-1-a)+G*(R-1-o)+Z*(W-1-(i*L-g))+w*e;for(let e=0;e<T;++e){k+=f[r+e]*S[s+e]}}}}h[p*U+m*t+I*i+C*c+e]=k}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},S8=h5(zM,(e=>Math.cos(e))),x8={kernelName:zM,backendName:"cpu",kernelFunc:S8},G8=h5(KM,(e=>Math.cosh(e))),Z8={kernelName:KM,backendName:"cpu",kernelFunc:G8};const w8={kernelName:PM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{image:o,boxes:i,boxInd:r}=t,{cropSize:s,method:l,extrapolationValue:c}=a,[g,u,d,h]=o.shape,p=i.shape[0],[m,I]=s,C=NY([p,m,I,h],"float32"),f=n.data.get(i.dataId).values,b=n.data.get(r.dataId).values,y=n.data.get(o.dataId).values,A=LX(o.shape),v=LX(C.shape);for(let S=0;S<p;S++){const e=4*S,t=f[e],n=f[e+1],a=f[e+2],o=f[e+3],i=b[S];if(i>=g)continue;const r=m>1?(a-t)*(u-1)/(m-1):0,s=I>1?(o-n)*(d-1)/(I-1):0;for(let g=0;g<m;g++){const e=m>1?t*(u-1)+g*r:.5*(t+a)*(u-1);if(e<0||e>u-1)for(let t=0;t<I;t++)for(let e=0;e<h;e++){const n=e+t*v[2]+g*v[1]+S*v[0];C.values[n]=c}else if("bilinear"===l){const t=Math.floor(e),a=Math.ceil(e),r=e-t;for(let e=0;e<I;e++){const l=I>1?n*(d-1)+e*s:.5*(n+o)*(d-1);if(l<0||l>d-1){for(let t=0;t<h;t++){const n=t+e*v[2]+g*v[1]+S*v[0];C.values[n]=c}continue}const u=Math.floor(l),p=Math.ceil(l),m=l-u;for(let n=0;n<h;n++){let o=n+u*A[2]+t*A[1]+i*A[0];const s=y[o];o=n+p*A[2]+t*A[1]+i*A[0];const l=y[o];o=n+u*A[2]+a*A[1]+i*A[0];const c=y[o];o=n+p*A[2]+a*A[1]+i*A[0];const d=s+(l-s)*m,h=c+(y[o]-c)*m;o=n+e*v[2]+g*v[1]+S*v[0],C.values[o]=d+(h-d)*r}}}else for(let t=0;t<I;++t){const a=I>1?n*(d-1)+t*s:.5*(n+o)*(d-1);if(a<0||a>d-1){for(let e=0;e<h;e++){const n=e+t*v[2]+g*v[1]+S*v[0];C.values[n]=c}continue}const r=Math.round(a),l=Math.round(e);for(let e=0;e<h;e++){const n=e+r*A[2]+l*A[1]+i*A[0],a=e+t*v[2]+g*v[1]+S*v[0];C.values[a]=y[n]}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};const k8={kernelName:DM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,exclusive:r,reverse:s}=a;H3(o,"cumprod");const l=mz([i],o.shape.length);let c=o;null!=l&&(c=m9({inputs:{x:o},backend:n,attrs:{perm:l}}));const g=Cz(1,o.shape.length)[0];if(g!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(g));const u=jH(c.dtype,"int32"),d=UX(bX(c.shape),u),h=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=s?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let C=0;C<h.length;C+=p)for(let e=0;e<p;e++){const t=m(C,e);if(0===e)d[t]=r?1:h[t];else{const n=m(C,e-1);d[t]=r?h[n]*d[n]:h[t]*d[n]}}const I=n.makeTensorInfo(c.shape,u,d);if(null!=l){const e=m9({inputs:{x:I},backend:n,attrs:{perm:Iz(l)}});return n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(c),e}return I}};const B8={kernelName:UM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,exclusive:r,reverse:s}=a;H3(o,"cumsum");const l=mz([i],o.shape.length);let c=o;null!=l&&(c=m9({inputs:{x:o},backend:n,attrs:{perm:l}}));const g=Cz(1,o.shape.length)[0];if(g!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(g));const u=jH(c.dtype,"int32"),d=PX(bX(c.shape),u),h=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=s?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let C=0;C<h.length;C+=p)for(let e=0;e<p;e++){const t=m(C,e);if(0===e)d[t]=r?0:h[t];else{const n=m(C,e-1);d[t]=r?h[n]+d[n]:h[t]+d[n]}}const I=n.makeTensorInfo(c.shape,u,d);if(null!=l){const e=m9({inputs:{x:I},backend:n,attrs:{perm:Iz(l)}});return n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(c),e}return I}};const R8={kernelName:OM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,weights:i}=t,{size:r,binaryOutput:s}=a;if(1===o.shape.length){const e=s5(n.data.get(o.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,r);return n.makeTensorInfo([r],i.dtype,e)}if(2===o.shape.length){const e=l5(n.bufferSync(o),n.bufferSync(i),r,s);return n.makeTensorInfo(e.shape,i.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(o.shape.length,"."))}};const W8={kernelName:_M,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{blockSize:i,dataFormat:r}=a;IX("NHWC"===r,(()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(r)));const s=o.shape[0],l=o.shape[1],c=o.shape[2],g=o.shape[3],u=l*i,d=c*i,h=g/(i*i),p=n.data.get(o.dataId).values,m=new Float32Array(s*u*d*h);let I=0;for(let C=0;C<s;++C)for(let e=0;e<u;++e){const t=Math.floor(e/i),n=e%i;for(let e=0;e<d;++e){const a=Math.floor(e/i),o=(n*i+e%i)*h;for(let e=0;e<h;++e){const n=e+o+g*(a+c*(t+l*C));m[I++]=p[n]}}}return n.makeTensorInfo([s,u,d,h],o.dtype,m)}};function V8(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i}=t,{strides:r,pad:s,dilations:l,dimRoundingMode:c}=a;H3([o,i],"depthwiseConv2DNative");const g=LX(o.shape),u=LX(i.shape);let d=l;null==d&&(d=[1,1]),IX(gL(r,d),(()=>"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(d,"'")));const h=nL(o.shape,i.shape,r,d,s,c,!0),{filterHeight:p,filterWidth:m,dilationHeight:I,dilationWidth:C,padInfo:f}=h,b=f.left,y=f.top,A=h.outChannels/h.inChannels,v=new FH(h.outShape,o.dtype),S=n.data.get(o.dataId).values,x=n.data.get(i.dataId).values,G=v.values;for(let Z=0;Z<h.batchSize;++Z){const e=Z*g[0],t=Z*v.strides[0];for(let n=0;n<h.outHeight;++n){const a=t+n*v.strides[1],o=n*h.strideHeight-y;for(let t=0;t<p;++t){const n=o+t*I;if(n<0||n>=h.inHeight)continue;const i=t*u[0],r=e+n*g[1];for(let e=0;e<h.outWidth;++e){const t=a+e*v.strides[2],n=e*h.strideWidth-b;for(let e=0;e<m;++e){const a=n+e*C;if(a<0||a>=h.inWidth)continue;const o=i+e*u[1],s=r+a*h.inChannels;let l=t,c=o;for(let e=0;e<h.inChannels;++e){const t=S[s+e];for(let e=0;e<A;++e)G[l+e]+=t*x[c+e];l+=A,c+=A}}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const N8={kernelName:QM,backendName:"cpu",kernelFunc:V8};const X8={kernelName:jM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,dy:i}=t,{strides:r,dilations:s,pad:l,dimRoundingMode:c,filterShape:g}=a;H3([o,i],"depthwiseConv2dNativeBackpropFilter");const u=nL(o.shape,g,r,s,l,c,!0),{strideHeight:d,strideWidth:h,filterHeight:p,filterWidth:m}=u,I=new FH(u.filterShape,"float32"),C=u.padInfo.left,f=u.padInfo.top,b=u.outChannels/u.inChannels,y=n.data.get(o.dataId).values,A=new FH(o.shape,o.dtype,y),v=n.data.get(i.dataId).values,S=new FH(i.shape,i.dtype,v);for(let x=0;x<p;++x){const e=Math.max(0,Math.ceil((f-x)/d)),t=Math.min(u.outHeight,(u.inHeight+f-x)/d);for(let n=0;n<m;++n){const a=Math.max(0,Math.ceil((C-n)/h)),o=Math.min(u.outWidth,(u.inWidth+C-n)/h);for(let i=0;i<u.outChannels;++i){const r=Math.trunc(i/b),s=i%b;let l=0;for(let c=0;c<u.batchSize;++c)for(let s=e;s<t;++s){const e=x+s*d-f;for(let t=a;t<o;++t){const a=n+t*h-C;l+=A.get(c,e,a,r)*S.get(c,s,t,i)}}I.set(l,x,n,r,s)}}}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};const M8={kernelName:qM,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,filter:i}=t,{strides:r,dilations:s,pad:l,dimRoundingMode:c,inputShape:g}=a;H3([o,i],"depthwiseConv2DNativeBackpropInput");const u=LX(o.shape),d=LX(i.shape),h=nL(g,i.shape,r,s,l,c,!0),p=new FH(h.inShape,"float32"),m=p.values,[I,C,f]=p.strides,b=n.data.get(o.dataId).values,[y,A,v]=u,S=n.data.get(i.dataId).values,[x,G,Z]=d,{batchSize:w,filterHeight:k,filterWidth:B,inChannels:R,inHeight:W,inWidth:V,outChannels:N,outHeight:X,outWidth:M,strideHeight:T,strideWidth:E}=h,F=k-1-h.padInfo.top,H=B-1-h.padInfo.left,J=N/R;for(let Y=0;Y<w;++Y)for(let e=0;e<R;++e)for(let t=0;t<W;++t){const n=t-F,a=Math.max(0,Math.ceil(n/T)),o=Math.min(X,(k+n)/T);for(let i=0;i<V;++i){const r=i-H,s=Math.max(0,Math.ceil(r/E)),l=Math.min(M,(B+r)/E);let c=0;for(let t=a;t<o;++t){const a=t*T-n;for(let n=s;n<l;++n){const o=y*Y+A*t+v*n,i=x*(k-1-a)+G*(B-1-(n*E-r))+Z*e;for(let t=0;t<J;++t){c+=b[o+(e*J+t)]*S[i+t]}}}m[I*Y+C*t+f*i+e]=c}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}};const T8={kernelName:$M,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:a}=t,o=bX(a.shape),i=n.data.get(a.dataId).values,r=NY([o,o],a.dtype),s=r.values;for(let c=0;c<i.length;c++)s[c*o+c]=i[c];const l=[...a.shape,...a.shape];return n.makeTensorInfo(l,r.dtype,r.values)}},E8={kernelName:eT,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:a}=e;const{x:o,filter:i}=t,{strides:r,pad:s,dilations:l}=a,c=n,g=c.data.get(o.dataId).values,u=o.shape.length,d=c.data.get(i.dataId).values,h=i.shape.length,{batchSize:p,inHeight:m,inWidth:I,inChannels:C,outHeight:f,outWidth:b,padInfo:y,strideHeight:A,strideWidth:v,filterHeight:S,filterWidth:x,dilationHeight:G,dilationWidth:Z,outShape:w}=$Y(o.shape,i.shape,r,s,"NHWC",l),k=bX(w),B=w.length,R=RX(o.dtype,k);for(let W=0;W<p;++W)for(let e=0;e<f;++e){const t=e*A-y.top;for(let n=0;n<b;++n){const a=n*v-y.left;for(let r=0;r<C;++r){let s=Number.MIN_SAFE_INTEGER;for(let e=0;e<S;++e){const n=t+e*G;if(n>=0&&n<m)for(let t=0;t<x;++t){const l=a+t*Z;if(l>=0&&l<I){const a=QX([W,n,l,r],u,LX(o.shape)),c=QX([e,t,r],h,LX(i.shape)),p=g[a]+d[c];p>s&&(s=p)}}}R[QX([W,e,n,r],B,LX(w))]=s}}}return{dataId:c.write(bH(R,o.dtype),w,o.dtype),shape:w,dtype:o.dtype}}},F8={kernelName:nT,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:a}=e;const{x:o,filter:i,dy:r}=t,{strides:s,pad:l,dilations:c}=a,g=n,u=KX(o.shape,g.data.get(o.dataId).values),d=KX(i.shape,g.data.get(i.dataId).values),{batchSize:h,inHeight:p,inWidth:m,inChannels:I,outHeight:C,outWidth:f,padInfo:b,strideHeight:y,strideWidth:A,filterHeight:v,filterWidth:S,dilationHeight:x,dilationWidth:G,outShape:Z}=$Y(o.shape,i.shape,s,l,"NHWC",c);IX(r.rank===Z.length,(()=>"Error in ".concat(nT,", dy must have the same rank as output ").concat(Z.length,", but got ").concat(r.rank)));const w=KX(Z,g.data.get(r.dataId).values),k=OX(i.shape,i.dtype);for(let B=0;B<h;++B)for(let e=0;e<C;++e){const t=e*y-b.top;for(let n=0;n<f;++n){const a=n*A-b.left;for(let o=0;o<I;++o){let i=Number.MIN_SAFE_INTEGER,r=0,s=0;for(let e=0;e<v;++e){const n=t+e*x;if(n>=0&&n<p)for(let t=0;t<S;++t){const l=a+t*G;if(l>=0&&l<m){const a=u[B][n][l][o]+d[e][t][o];a>i&&(i=a,r=e,s=t)}}}k[r][s][o]+=w[B][e][n][o]}}}return{dataId:g.write(bH(k,o.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},H8={kernelName:tT,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:a}=e;const{x:o,filter:i,dy:r}=t,{strides:s,pad:l,dilations:c}=a,g=n,u=KX(o.shape,g.data.get(o.dataId).values),d=KX(i.shape,g.data.get(i.dataId).values),{batchSize:h,inHeight:p,inWidth:m,inChannels:I,outHeight:C,outWidth:f,padInfo:b,strideHeight:y,strideWidth:A,filterHeight:v,filterWidth:S,dilationHeight:x,dilationWidth:G,outShape:Z}=$Y(o.shape,i.shape,s,l,"NHWC",c);IX(r.rank===Z.length,(()=>"Error in ".concat(tT,", dy must have the same rank as output ").concat(Z.length,", but got ").concat(r.rank)));const w=KX(Z,g.data.get(r.dataId).values),k=OX(o.shape,o.dtype);for(let B=0;B<h;++B)for(let e=0;e<C;++e){const t=e*y-b.top;for(let n=0;n<f;++n){const a=n*A-b.left;for(let o=0;o<I;++o){let i=Number.MIN_SAFE_INTEGER,r=t<0?0:t,s=a<0?0:a;for(let e=0;e<v;++e){const n=t+e*x;if(n>=0&&n<p)for(let t=0;t<S;++t){const l=a+t*G;if(l>=0&&l<m){const a=u[B][n][l][o]+d[e][t][o];a>i&&(i=a,r=n,s=l)}}}k[B][r][s][o]+=w[B][e][n][o]}}}return{dataId:g.write(bH(k,o.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};const J8={kernelName:aT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{image:o}=t,{canvas:i,options:r}=a,{contextOptions:s,imageOptions:l}=r||{},c=(null==l?void 0:l.alpha)||1,g=(null==s?void 0:s.contextType)||"2d";if("2d"!==g)throw new Error("Context type ".concat(s.contextType," is not supported by the CPU backend."));const u=i.getContext(g,(null==s?void 0:s.contextAttributes)||{});if(null==u)throw new Error("Could not get the context with ".concat(g," type."));const[d,h]=o.shape.slice(0,2),p=2===o.shape.length?1:o.shape[2],m=n.data.get(o.dataId).values,I="float32"===o.dtype?255:1,C=new Uint8ClampedArray(h*d*4);for(let b=0;b<d*h;++b){const e=[0,0,0,255*c];for(let n=0;n<p;n++){const t=m[b*p+n];if("float32"===o.dtype){if(t<0||t>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(t,"."))}else if("int32"===o.dtype&&(t<0||t>255))throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(t,"."));1===p?(e[0]=t*I,e[1]=t*I,e[2]=t*I):e[n]=t*I}const t=4*b;C[t+0]=Math.round(e[0]),C[t+1]=Math.round(e[1]),C[t+2]=Math.round(e[2]),C[t+3]=Math.round(e[3])}i.width=h,i.height=d;const f=new ImageData(C,h,d);return u.putImageData(f,0,0),o}};function Y8(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a;let s;H3(o,"sum"),s="bool"===o.dtype?$3({inputs:{x:o},backend:n,attrs:{dtype:"int32"}}):O3({inputs:{x:o},backend:n});const l=s.shape.length,c=wX(i,s.shape),g=mz(c,l);let u=c,d=s;null!=g&&(d=m9({inputs:{x:s},backend:n,attrs:{perm:g}}),u=Cz(u.length,l)),pz("sum",u,d.shape.length);const[h,p]=dz(d.shape,u);let m=P3(n,h,jH(d.dtype,"int32"));const I=bX(p),C=n.data.get(m.dataId).values,f=n.data.get(d.dataId).values;for(let b=0;b<C.length;++b){const e=b*I;let t=0;for(let n=0;n<I;++n)t+=f[e+n];C[b]=t}if(r){const e=m;m=w4({inputs:{x:m},backend:n,attrs:{shape:hz(m.shape,c)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(s),null!=g&&n.disposeIntermediateTensorInfo(d),m}const L8={kernelName:YE,backendName:"cpu",kernelFunc:Y8};const z8={kernelName:iT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{equation:o}=a,i=t,{allDims:r,summedDims:s,idDims:l}=HO(o,i.length);YO(r.length,l,i);const{path:c,steps:g}=LO(s,l),u=g.length;let d=null,h=r.length;const p=[];for(let m=0;m<u;++m){for(const e of g[m]){const{permutationIndices:t,expandDims:a}=JO(h,l[e]);let o;zO(t)?o=i[e]:(o=m9({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(o));const r=o.shape.slice();for(let e=0;e<a.length;++e)r.splice(a[e],0,1);AX(o.shape,r)||(o=w4({inputs:{x:o},backend:n,attrs:{shape:r}}),p.push(o)),null===d?d=o:(d=s9({inputs:{a:o,b:d},backend:n}),p.push(d))}m<u-1&&(c[m]>=0&&(d=Y8({inputs:{x:d},backend:n,attrs:{axis:c[m]-(r.length-h),keepDims:!1}}),p.push(d)),h--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}};const K8={kernelName:sT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:a,y:o}=t;H3([a,o],"eluGrad");const i=new Float32Array(bX(o.shape)),r=n.data.get(o.dataId).values,s=n.data.get(a.dataId).values;for(let l=0;l<r.length;++l){const e=r[l];i[l]=e>=0?s[l]:s[l]*(e+1)}return n.makeTensorInfo(o.shape,"float32",i)}},D8=AO,U8=vO,P8=SO,O8=xO,_8=GO,Q8=ZO,j8=h5(lT,(e=>{const t=Math.sign(e),n=Math.abs(e),a=1/(1+D8*n);return t*(1-((((Q8*a+_8)*a+O8)*a+P8)*a+U8)*a*Math.exp(-n*n))})),q8={kernelName:lT,backendName:"cpu",kernelFunc:j8};function $8(e){const{inputs:t,backend:n,attrs:a}=e,{input:o}=t,{dim:i}=a,r=o.shape.length,s=o.shape.slice();let l=i;return i<0&&(IX(-(r+1)<=i,(()=>"Axis must be in the interval [".concat(-(r+1),", ").concat(r,"]"))),l=r+i+1),s.splice(l,0,1),w4({inputs:{x:o},backend:n,attrs:{shape:s}})}const e7={kernelName:uT,backendName:"cpu",kernelFunc:$8},t7=K3(((e,t)=>e/t)),n7=t5(oT,t7),a7={kernelName:oT,backendName:"cpu",kernelFunc:n7};function o7(e,t,n){const a=e.shape,o=a[0],i=a[1],r=n.data.get(e.dataId),s=r.complexTensorInfos.real,l=r.complexTensorInfos.imag,c=[o,i],g=bX(c),u=BX("float32",g),d=BX("float32",g);for(let I=0;I<o;I++){const e=H9({inputs:{x:s},backend:n,attrs:{begin:[I,0],size:[1,i]}}),a=H9({inputs:{x:l},backend:n,attrs:{begin:[I,0],size:[1,i]}}),o=D3({inputs:{real:e,imag:a},backend:n}),{real:r,imag:c}=i7(o,t,n),g=wO(r,c);for(let t=0;t<i;t++){const e=WO(g,t);u[I*i+t]=e.real,d[I*i+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o)}const h=n.makeTensorInfo(c,"float32",u),p=n.makeTensorInfo(c,"float32",d),m=D3({inputs:{real:h,imag:p},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),m}function i7(e,t,n){const a=bX(e.shape),o=n.data.get(e.dataId),i=n.data.get(o.complexTensorInfos.real.dataId).values,r=n.data.get(o.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(a)){const o=r7(i,r,a,t,n),s=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(s,"float32",o.real),t=n.makeTensorInfo(s,"float32",o.imag),i=n.makeTensorInfo([],"float32",fH(a,"float32")),r=O3({inputs:{x:i},backend:n}),l=a7.kernelFunc({inputs:{a:e,b:i},backend:n}),c=a7.kernelFunc({inputs:{a:t,b:r},backend:n}),g=n.data.get(l.dataId).values,u=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),{real:g,imag:u}}return o}{const e=function(e,t,n){const a=new Float32Array(2*t);for(let o=0;o<t;o++){let i=0,r=0;for(let a=0;a<t;a++){const s=XO(o*a,t,n),l=WO(e,a);i+=l.real*s.real-l.imag*s.imag,r+=l.real*s.imag+l.imag*s.real}n&&(i/=t,r/=t),VO(a,i,r,o)}return a}(wO(i,r),a,t);return kO(e)}}function r7(e,t,n,a,o){if(1===n)return{real:e,imag:t};const i=wO(e,t),r=n/2,s=BO(i),l=s.real,c=s.imag,g=[l.length],u=o.makeTensorInfo(g,"float32",l),d=o.makeTensorInfo(g,"float32",c),h=D3({inputs:{real:u,imag:d},backend:o}),p=RO(i),m=p.real,I=p.imag,C=[m.length],f=o.makeTensorInfo(C,"float32",m),b=o.makeTensorInfo(C,"float32",I),y=D3({inputs:{real:f,imag:b},backend:o}),A=r7(l,c,r,a,o),v=A.real,S=A.imag,x=[v.length],G=o.makeTensorInfo(x,"float32",v),Z=o.makeTensorInfo(x,"float32",S),w=D3({inputs:{real:G,imag:Z},backend:o}),k=r7(m,I,r,a,o),B=k.real,R=k.imag,W=[B.length],V=o.makeTensorInfo(W,"float32",B),N=o.makeTensorInfo(W,"float32",R),X=D3({inputs:{real:V,imag:N},backend:o}),M=NO(n,a),T=[M.real.length],E=o.makeTensorInfo(T,"float32",M.real),F=o.makeTensorInfo(T,"float32",M.imag),H=D3({inputs:{real:E,imag:F},backend:o}),J=s9({inputs:{a:H,b:X},backend:o}),Y=i5({inputs:{a:w,b:J},backend:o}),L=s4({inputs:{a:w,b:J},backend:o}),z=Q3({inputs:{input:Y},backend:o}),K=Q3({inputs:{input:L},backend:o}),D=d8({inputs:{input:Y},backend:o}),U=d8({inputs:{input:L},backend:o}),P=p8({inputs:[z,K],backend:o,attrs:{axis:0}}),O=p8({inputs:[D,U],backend:o,attrs:{axis:0}}),_=o.data.get(P.dataId).values,Q=o.data.get(O.dataId).values;return o.disposeIntermediateTensorInfo(u),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(V),o.disposeIntermediateTensorInfo(N),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(E),o.disposeIntermediateTensorInfo(F),o.disposeIntermediateTensorInfo(H),o.disposeIntermediateTensorInfo(J),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(L),o.disposeIntermediateTensorInfo(z),o.disposeIntermediateTensorInfo(D),o.disposeIntermediateTensorInfo(K),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(P),o.disposeIntermediateTensorInfo(O),{real:_,imag:Q}}const s7={kernelName:hT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:a}=t,o=bX(a.shape),i=a.shape[a.shape.length-1],r=w4({inputs:{x:a},backend:n,attrs:{shape:[o/i,i]}}),s=o7(r,!1,n),l=w4({inputs:{x:s},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),l}};function l7(e){const{backend:t,attrs:n}=e,{shape:a,value:o,dtype:i}=n,r=i||HX(o),s=RX(r,bX(a));return function(e,t,n){e.fill(t)}(s,o),t.makeTensorInfo(a,r,s)}const c7={kernelName:pT,backendName:"cpu",kernelFunc:l7};const g7={kernelName:mT,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:a}=e;const{image:o}=t,i=a,r=BX(o.dtype,bX(o.shape)),[s,l,c,g]=o.shape,u=i.data.get(o.dataId).values;for(let d=0;d<s;d++){const e=d*c*l*g;for(let t=0;t<l;t++){const n=t*(c*g);for(let t=0;t<c;t++){const a=t*g;for(let o=0;o<g;o++){const i=Math.round(c-t-1),s=e+n+a+o;let l=u[s];if(i>=0&&i<c){l=u[e+n+i*g+o]}r[s]=l}}}}return{dataId:i.write(r,o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};const u7={kernelName:fF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i,bias:r,preluActivationWeights:s}=t,{strides:l,pad:c,dataFormat:g,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=a;let m=I8({inputs:{x:o,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:g,dilations:u,dimRoundingMode:d}});if(r){const e=m;if("NCHW"===g&&1===r.shape.length&&1!==r.shape[0]){const e=w4({inputs:{x:r},backend:n,attrs:{shape:[r.shape[0],1,1]}});m=i5({inputs:{a:m,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else m=i5({inputs:{a:m,b:r},backend:n});n.disposeIntermediateTensorInfo(e)}if(h){const e=m;if("NCHW"===g&&"prelu"===h&&1===s.shape.length&&1!==s.shape[0]){const e=w4({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=Z4(n,m,h,e,p),n.disposeIntermediateTensorInfo(e)}else m=Z4(n,m,h,s,p);n.disposeIntermediateTensorInfo(e)}return m}};const d7={kernelName:bF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i,bias:r,preluActivationWeights:s}=t,{strides:l,pad:c,dataFormat:g,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=a;let m=V8({inputs:{x:o,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:g,dilations:u,dimRoundingMode:d}});if(r){const e=m;m=i5({inputs:{a:m,b:r},backend:n}),n.disposeIntermediateTensorInfo(e)}if(h){const e=m;m=Z4(n,m,h,s,p),n.disposeIntermediateTensorInfo(e)}return m}};const h7={kernelName:yT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:a,indices:o}=t,i=bX(a.shape),r=o.shape,s=r[r.length-1],[l,c,g,u]=XP(a,o);if(0===c)return n.makeTensorInfo(l,a.dtype,[]);const d=X5(n.data.get(o.dataId).values,n.bufferSync(a),a.dtype,c,s,g,u,a.shape,i);return n.makeTensorInfo(l,a.dtype,d.values)}};const p7={kernelName:bT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,indices:i}=t,{axis:r,batchDims:s}=a;H3([o,i],"gatherV2");const l=wX(r,o.shape)[0],c=n.data.get(i.dataId).values,g=o.shape[l];for(let b=0;b<c.length;++b){const e=c[b];IX(e<=g-1&&e>=0,(()=>"GatherV2: the index value ".concat(e," is not in [0, ").concat(g-1,"]")))}let u=s;null==s&&(u=0);const d=bX(i.shape),h=r_(o,i,l,u),p=w4({inputs:{x:o},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),m=w4({inputs:{x:i},backend:n,attrs:{shape:[h.batchSize,d/h.batchSize]}}),I=[h.batchSize,h.outerSize,d/h.batchSize,h.sliceSize],C=n.bufferSync(m),f=M5(n.bufferSync(p),C,I);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(h.outputShape,f.dtype,f.values)}};const m7={kernelName:xT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:a}=t,o=bX(a.shape),i=a.shape[a.shape.length-1],r=w4({inputs:{x:a},backend:n,attrs:{shape:[o/i,i]}}),s=o7(r,!0,n),l=w4({inputs:{x:s},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),l}},I7=h5(ZT,(e=>Number.isFinite(e)?1:0),"bool"),C7={kernelName:ZT,backendName:"cpu",kernelFunc:I7},f7=h5(wT,(e=>Math.abs(e)===1/0?1:0),"bool"),b7={kernelName:wT,backendName:"cpu",kernelFunc:f7},y7=h5(kT,(e=>Number.isNaN(e)?1:0),"bool"),A7={kernelName:kT,backendName:"cpu",kernelFunc:y7};const v7={kernelName:VT,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:a,stop:o,num:i}=n,r=O5(a,o,i);return t.makeTensorInfo([r.length],"float32",r)}},S7=h5(XT,(e=>Math.log1p(e))),x7={kernelName:XT,backendName:"cpu",kernelFunc:S7},G7=K3(((e,t)=>e&&t)),Z7=t5(MT,G7,null,"bool"),w7={kernelName:MT,backendName:"cpu",kernelFunc:Z7},k7=h5(TT,(e=>e?0:1),"bool"),B7={kernelName:TT,backendName:"cpu",kernelFunc:k7},R7=K3(((e,t)=>e||t)),W7=t5(ET,R7,null,"bool"),V7={kernelName:ET,backendName:"cpu",kernelFunc:W7};const N7={kernelName:HT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{depthRadius:i,bias:r,alpha:s,beta:l}=a;H3(o,"LRN");const c=o.shape[3],g=c-1,u=n.data.get(o.dataId).values,d=bX(o.shape),h=new Float32Array(d);function p(e){const t=e%c;let n=e-t+Math.max(0,t-i);const a=e-t+Math.min(t+i,g);let o=0;for(;n<=a;n++){const e=u[n];o+=e*e}return o}for(let m=0;m<d;m++){const e=p(m),t=u[m]*Math.pow(r+s*e,-l);h[m]=t}return n.makeTensorInfo(o.shape,o.dtype,h)}};const X7={kernelName:JT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,y:i,dy:r}=t,{depthRadius:s,bias:l,alpha:c,beta:g}=a;H3(r,"LRNGrad");const u=bX(r.shape),d=r.shape[3],h=n.data.get(r.dataId).values,p=n.data.get(o.dataId).values,m=n.data.get(i.dataId).values,I=new Float32Array(u),C=u;for(let f=0;f<C;f++){const e=f%d,t=f-e+Math.max(0,e-s),n=f-e+Math.min(d,e+s+1);let a=0;for(let o=t;o<n;o++)a+=Math.pow(p[o],2);a=c*a+l;for(let o=t;o<n;o++){let e=-2*c*g*p[o]*m[f]/a;f===o&&(e+=Math.pow(a,-g)),e*=h[f],I[o]+=e}}return n.makeTensorInfo(r.shape,o.dtype,I)}};function M7(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{reductionIndices:i,keepDims:r}=a,s=n;let l=o.shape;const c=l.length,g=wX(i,l);let u=g;const d=mz(u,c);let h=s.data.get(o.dataId).values;if(null!=d){const e=new Array(c);for(let t=0;t<e.length;t++)e[t]=l[d[t]];h=p9(h,l,o.dtype,d,e),u=Cz(u.length,c),l=e}H3(o,"max"),pz("max",u,c);const[p,m]=dz(l,u),I=q5(h,bX(m),p,o.dtype),C=s.write(I,p,o.dtype);let f=p;return r&&(f=hz(p,g)),{dataId:C,shape:f,dtype:o.dtype}}const T7={kernelName:YT,backendName:"cpu",kernelFunc:M7};const E7={kernelName:zT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t;H3(o,"maxPool");const{filterSize:i,strides:r,pad:s,dimRoundingMode:l}=a;IX(gL(r,1),(()=>"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(1,"'")));const c=eL(o.shape,i,r,1,s,l);let g;if(1===c.filterWidth&&1===c.filterHeight&&AX(c.inShape,c.outShape))g=O3({inputs:{x:o},backend:n});else{const e=n.data.get(o.dataId).values,t=LX(o.shape),a=q4(e,o.shape,o.dtype,t,c,"max");g=n.makeTensorInfo(c.outShape,o.dtype,a.values)}return g}};const F7={kernelName:DT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{filterSize:i,strides:r,pad:s,dimRoundingMode:l,dataFormat:c}=a;H3(o,"maxPool3d");const g=tL(o.shape,i,r,1,s,l,c),u=e8(n.data.get(o.dataId).values,o.shape,o.dtype,LX(o.shape),g,"max");return n.makeTensorInfo(u.shape,"float32",u.values)}};const H7={kernelName:UT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i}=t,{filterSize:r,strides:s,pad:l,dimRoundingMode:c}=a;H3([o,i],"maxPool3DGrad");const g=tL(i.shape,r,s,1,l,c),u=function(e,t){const n=NY(t.outShape,"int32"),a=t.strideDepth,o=t.strideHeight,i=t.strideWidth,r=t.dilationDepth,s=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,g=t.effectiveFilterHeight,u=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let I=0;I<t.inChannels;++I)for(let C=0;C<t.outDepth;++C){const f=C*a-d;let b=f;for(;b<0;)b+=r;const y=Math.min(t.inDepth,c+f);for(let a=0;a<t.outHeight;++a){const c=a*o-h;let d=c;for(;d<0;)d+=s;const A=Math.min(t.inHeight,g+c);for(let o=0;o<t.outWidth;++o){const h=o*i-p;let v=h;for(;v<0;)v+=l;const S=Math.min(t.inWidth,u+h);let x=Number.NEGATIVE_INFINITY,G=-1;for(let t=b;t<y;t+=r){const n=t-f;for(let a=d;a<A;a+=s){const o=a-c;for(let i=v;i<S;i+=l){const r=i-h,s=e.get(m,t,a,i,I);s>=x&&(x=s,G=n*g*u+o*g+r)}}}n.set(G,m,C,a,o,I)}}}return n}(n.bufferSync(i),g),d=g.strideDepth,h=g.strideHeight,p=g.strideWidth,m=g.dilationDepth,I=g.dilationHeight,C=g.dilationWidth,f=g.effectiveFilterDepth,b=g.effectiveFilterHeight,y=g.effectiveFilterWidth,A=f-1-g.padInfo.front,v=y-1-g.padInfo.left,S=b-1-g.padInfo.top,x=NY(i.shape,"float32"),G=n.bufferSync(o);for(let Z=0;Z<g.batchSize;++Z)for(let e=0;e<g.inChannels;++e)for(let t=0;t<g.inDepth;++t)for(let n=0;n<g.inHeight;++n)for(let a=0;a<g.inWidth;++a){const o=t-A,i=n-S,r=a-v;let s=0;for(let t=0;t<f;t+=m){const n=(o+t)/d;if(!(n<0||n>=g.outDepth||Math.floor(n)!==n))for(let a=0;a<b;a+=I){const o=(i+a)/h;if(!(o<0||o>=g.outHeight||Math.floor(o)!==o))for(let i=0;i<y;i+=C){const l=(r+i)/p;if(l<0||l>=g.outWidth||Math.floor(l)!==l)continue;const c=f*b*y-1-u.get(Z,n,o,l,e)===t*b*y+a*y+i?1:0;if(0===c)continue;s+=G.get(Z,n,o,l,e)*c}}}x.set(s,Z,t,n,a,e)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};const J7={kernelName:KT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i,output:r}=t,s=i;H3([i,r],"maxPoolGrad");const{filterSize:l,strides:c,pad:g,dimRoundingMode:u}=a,d=eL(s.shape,l,c,1,g,u),h=n.data.get(s.dataId).values,p=NY(d.outShape,s.dtype,$4(h,s.shape,s.dtype,d).values),m=d.strideHeight,I=d.strideWidth,C=d.dilationHeight,f=d.dilationWidth,b=d.effectiveFilterHeight,y=d.effectiveFilterWidth,A=y-1-d.padInfo.left,v=b-1-d.padInfo.top,S=NY(s.shape,"float32"),x=n.data.get(o.dataId).values,G=NY(o.shape,"float32",x);for(let Z=0;Z<d.batchSize;++Z)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const a=t-v,o=n-A;let i=0;for(let t=0;t<b;t+=C){const n=(a+t)/m;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let a=0;a<y;a+=f){const r=(o+a)/I;if(r<0||r>=d.outWidth||Math.floor(r)!==r)continue;const s=b*y-1-p.get(Z,n,r,e)===t*y+a?1:0;if(0===s)continue;i+=G.get(Z,n,r,e)*s}}S.set(i,Z,t,n,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};const Y7={kernelName:PT,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:a}=e;const{x:o}=t,{filterSize:i,strides:r,pad:s,includeBatchInIndex:l}=n,c=a;H3(o,"MaxPoolWithArgmax");const g=c.data.get(o.dataId).values,u=eL(o.shape,i,r,[1,1],s),[d,h]=function(e,t,n,a,o){const i=q4(e,0,n,LX(t),o,"max"),r=$4(e,t,n,o,!0,a);return[i.values,r.values]}(g,o.shape,o.dtype,l,u),p=c.write(d,u.outShape,o.dtype),m=c.write(h,u.outShape,o.dtype);return[{dataId:p,shape:u.outShape,dtype:o.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};const L7={kernelName:OT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a,s=wX(i,o.shape),l=bX(dz(o.shape,s)[1]),c=[],g=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(g);const u=$3({inputs:{x:o},backend:n,attrs:{dtype:"float32"}});c.push(u);const d=n7({inputs:{a:u,b:g},backend:n});c.push(d);const h=Y8({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:r}});return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),h}};const z7={kernelName:_T,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a;H3(o,"min");const s=wX(i,o.shape);let l=s;const c=mz(l,o.shape.length);let g=o;null!=c&&(g=m9({inputs:{x:o},backend:n,attrs:{perm:c}}),l=Cz(l.length,o.shape.length)),pz("min",l,g.shape.length);const[u,d]=dz(g.shape,l),h=bX(d),p=PX(bX(u),g.dtype),m=n.data.get(g.dataId).values;for(let C=0;C<p.length;++C){const e=C*h;let t=m[e];for(let n=0;n<h;++n){const a=m[e+n];(Number.isNaN(a)||a<t)&&(t=a)}p[C]=t}null!=c&&n.disposeIntermediateTensorInfo(g);const I=n.makeTensorInfo(u,g.dtype,p);if(r){const e=w4({inputs:{x:I},backend:n,attrs:{shape:hz(u,s)}});return n.disposeIntermediateTensorInfo(I),e}return I}};const K7={kernelName:jT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{paddings:i,mode:r}=a;H3(o,"mirrorPad");const s=i.map(((e,t)=>e[0]+o.shape[t]+e[1])),l=i.map((e=>e[0])),c=i.map(((e,t)=>e[0]+o.shape[t])),g="reflect"===r?0:1,u=n.data.get(o.dataId).values,d=o.shape.length,h=LX(o.shape),p=bX(s),m=s.length,I=LX(s),C=BX(o.dtype,p);for(let f=0;f<p;f++){let e=jX(f,m,I);for(let n=0;n<m;n++)e[n]<l[n]?e[n]=2*l[n]-e[n]-g:e[n]>=c[n]&&(e[n]=2*(c[n]-1)-e[n]+g);e=e.map(((e,t)=>e-l[t]));const t=QX(e,d,h);C[f]=u[t]}return{dataId:n.write(C,s,o.dtype),shape:s,dtype:o.dtype}}},D7=K3(((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),U7=t5(qT,D7),P7={kernelName:qT,backendName:"cpu",kernelFunc:U7};function O7(e){const{inputs:t,backend:n,attrs:a}=e,{logits:o}=t,{dim:i}=a,r=o.shape.length;let s=i;if(-1===s&&(s=r-1),s!==r-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(r," and dim was ").concat(s));const l=wX([s],o.shape),c=M7({inputs:{x:o},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),g=hz(c.shape,l),u=w4({inputs:{x:c},backend:n,attrs:{shape:g}}),d=s4({inputs:{a:o,b:u},backend:n}),h=S5({inputs:{x:d},backend:n}),p=Y8({inputs:{x:h},backend:n,attrs:{axis:l,keepDims:!1}}),m=w4({inputs:{x:p},backend:n,attrs:{shape:g}}),I=n7({inputs:{a:h,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),I}const _7={kernelName:KE,backendName:"cpu",kernelFunc:O7};const Q7={kernelName:$T,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{logits:o}=t,{numSamples:i,seed:r,normalized:s}=a;H3(o,"multinomial");const l=s?o:O7({inputs:{logits:o},backend:n,attrs:{dim:-1}}),c=l.shape[0],g=l.shape[1],u=n.data.get(l.dataId).values,d=[c,i],h=PX(bX(d),"int32");for(let p=0;p<c;++p){const e=p*g,t=new Float32Array(g-1);t[0]=u[e];for(let o=1;o<t.length;++o)t[o]=t[o-1]+u[e+o];const n=DK.alea(r.toString()),a=p*i;for(let o=0;o<i;++o){const e=n();h[a+o]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){h[a+o]=n;break}}}return s||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",h)}},j7=dU;const q7={kernelName:aE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{boxes:o,scores:i}=t,{maxOutputSize:r,iouThreshold:s,scoreThreshold:l}=a;H3(o,"NonMaxSuppression");const c=n.data.get(o.dataId).values,g=n.data.get(i.dataId).values,{selectedIndices:u}=j7(c,g,r,s,l);return n.makeTensorInfo([u.length],"int32",new Int32Array(u))}},$7=hU;const e6={kernelName:oE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{boxes:o,scores:i}=t,{maxOutputSize:r,iouThreshold:s,scoreThreshold:l,padToMaxOutputSize:c}=a;H3(o,"NonMaxSuppressionPadded");const g=n.data.get(o.dataId).values,u=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:h}=$7(g,u,r,s,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},t6=pU;const n6={kernelName:iE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{boxes:o,scores:i}=t,{maxOutputSize:r,iouThreshold:s,scoreThreshold:l,softNmsSigma:c}=a;H3(o,"NonMaxSuppressionWithScore");const g=n.data.get(o.dataId).values,u=n.data.get(i.dataId).values,d=r,h=s,p=l,m=c,{selectedIndices:I,selectedScores:C}=t6(g,u,d,h,p,m);return[n.makeTensorInfo([I.length],"int32",new Int32Array(I)),n.makeTensorInfo([C.length],"float32",new Float32Array(C))]}};const a6={kernelName:sE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{indices:o}=t,{dtype:i,depth:r,onValue:s,offValue:l}=a;H3(o,"oneHot");const c=bX(o.shape),g=new Float32Array(c*r);g.fill(l);const u=n.data.get(o.dataId).values;for(let d=0;d<c;++d)u[d]>=0&&u[d]<r&&(g[d*r+u[d]]=s);return n.makeTensorInfo([...o.shape,r],i,g)}};function o6(e){const{inputs:t,backend:n}=e,{x:a}=t;if("string"===a.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===a.dtype){const e=Q3({inputs:{input:a},backend:n}),t=o6({inputs:{x:e},backend:n}),o=d8({inputs:{input:a},backend:n}),i=o6({inputs:{x:o},backend:n}),r=D3({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),r}return l7({backend:n,attrs:{shape:a.shape,value:0,dtype:a.dtype}})}const i6={kernelName:hF,backendName:"cpu",kernelFunc:o6};const r6={kernelName:rE,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:a}=t,{x:o}=n;if("string"===o.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===o.dtype){const t=Q3({inputs:{input:o},backend:a}),n=e({inputs:{x:t},backend:a}),i=d8({inputs:{input:o},backend:a}),r=o6({inputs:{x:i},backend:a}),s=D3({inputs:{real:n,imag:r},backend:a});return a.disposeIntermediateTensorInfo(t),a.disposeIntermediateTensorInfo(n),a.disposeIntermediateTensorInfo(i),a.disposeIntermediateTensorInfo(r),s}return l7({backend:a,attrs:{shape:o.shape,value:1,dtype:o.dtype}})}};function s6(e){const{inputs:t,backend:n,attrs:a}=e,{axis:o}=a;if(1===t.length)return $8({inputs:{input:t[0]},backend:n,attrs:{dim:o}});const i=t[0].shape,r=t[0].dtype;t.forEach((e=>{CX(i,e.shape,"All tensors passed to stack must have matching shapes"),IX(r===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const s=[],l=p8({inputs:t.map((e=>{const t=$8({inputs:{input:e},backend:n,attrs:{dim:o}});return s.push(t),t})),backend:n,attrs:{axis:o}});return s.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}const l6={kernelName:lE,backendName:"cpu",kernelFunc:s6};const c6={kernelName:cE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{paddings:i,constantValue:r}=a;H3(o,"pad");const s=i.map(((e,t)=>e[0]+o.shape[t]+e[1])),l=i.map((e=>e[0])),c=n.data.get(o.dataId).values,g=bX(o.shape),u=o.shape.length,d=LX(o.shape),h=bX(s),p=s.length,m=LX(s),I=BX(o.dtype,h);0!==r&&I.fill(r);for(let C=0;C<g;C++){const e=jX(C,u,d).map(((e,t)=>e+l[t]));I[QX(e,p,m)]=c[C]}return{dataId:n.write(I,s,o.dtype),shape:s,dtype:o.dtype}}},g6=K3(((e,t)=>Math.pow(e,t))),u6=t5(gE,g6),d6={kernelName:gE,backendName:"cpu",kernelFunc:u6};const h6={kernelName:hE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{paramsNestedSplits:o,paramsDenseValues:i,indices:r}=t,s=o.map((e=>n.data.get(e.dataId).values)),l=o.map((e=>e.shape)),c=n.data.get(i.dataId).values,g=n.data.get(r.dataId).values,[u,d,h]=v9(s,l,c,i.shape,i.dtype,g,r.shape),p=u.map((e=>n.makeTensorInfo([e.length],"int32",e))),m=n.makeTensorInfo(h,i.dtype,d);return p.concat([m])}};const p6={kernelName:pE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:a,limits:o,deltas:i}=t,r=n.data.get(a.dataId).values,s=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values,[c,g]=x9(r,a.shape,a.dtype,s,o.shape,l,i.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([g.length],a.dtype,g)]}};const m6={kernelName:mE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{shape:o,values:i,defaultValue:r,rowPartitionTensors:s}=t,{rowPartitionTypes:l}=a,c=n.data.get(o.dataId).values,g=n.data.get(i.dataId).values,u=n.data.get(r.dataId).values,d=s.map((e=>n.data.get(e.dataId).values)),h=s.map((e=>e.shape)),[p,m]=B9(c,o.shape,g,i.shape,i.dtype,u,r.shape,d,h,l);return n.makeTensorInfo(p,i.dtype,m)}};const I6={kernelName:IE,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:a,stop:o,dtype:i,step:r}=n,s=R9(a,o,r,i);return t.makeTensorInfo([s.length],i,s)}},C6=h5(fE,(e=>1/e)),f6={kernelName:fE,backendName:"cpu",kernelFunc:C6};const b6={kernelName:SE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o}=t,{alignCorners:i,halfPixelCenters:r,size:s}=a;H3(o,"resizeBilinear");const l=LX(o.shape),[c,g]=s,[u,d,h,p]=o.shape,m=n.data.get(o.dataId).values,I=new Float32Array(bX([u,c,g,p])),C=[i&&c>1?d-1:d,i&&g>1?h-1:h],f=[i&&c>1?c-1:c,i&&g>1?g-1:g];let b=0;const y=C[0]/f[0],A=C[1]/f[1];for(let v=0;v<u;v++)for(let e=0;e<c;e++){let t;t=r?y*(e+.5)-.5:y*e;const n=Math.max(0,Math.floor(t)),a=t-n,o=Math.min(d-1,Math.ceil(t)),i=v*l[0]+n*l[1],s=v*l[0]+o*l[1];for(let e=0;e<g;e++){let t;t=r?A*(e+.5)-.5:A*e;const n=Math.max(0,Math.floor(t)),o=t-n,c=Math.min(h-1,Math.ceil(t)),g=i+n*l[2],u=s+n*l[2],d=i+c*l[2],C=s+c*l[2];for(let e=0;e<p;e++){const t=m[g+e],n=m[u+e],i=t+(m[d+e]-t)*o,r=i+(n+(m[C+e]-n)*o-i)*a;I[b++]=r}}}return n.makeTensorInfo([u,c,g,p],"float32",I)}};const y6={kernelName:xE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o,dy:i}=t,{alignCorners:r}=a;H3([i,o],"resizeBilinearGrad");const s=LX(o.shape),[l,c,g,u]=o.shape,[,d,h]=i.shape,p=new Float32Array(l*c*g*u),m=[r&&d>1?c-1:c,r&&h>1?g-1:g],I=[r&&d>1?d-1:d,r&&h>1?h-1:h],C=m[0]/I[0],f=m[1]/I[1],b=n.data.get(i.dataId).values;let y=0;for(let A=0;A<l;A++){const e=A*s[0];for(let t=0;t<d;t++){const n=t*C,a=Math.floor(n),o=Math.min(Math.ceil(n),c-1),i=e+a*s[1],r=e+o*s[1],l=n-a,d=1-l;for(let e=0;e<h;e++){const t=e*f,n=Math.floor(t),a=Math.min(Math.ceil(t),g-1),o=t-n,c=1-o,h=i+n*s[2],m=i+a*s[2],I=r+n*s[2],C=r+a*s[2],A=d*c,v=d*o,S=l*c,x=l*o;for(let e=0;e<u;e++){const t=b[y++];p[h+e]+=t*A,p[m+e]+=t*v,p[I+e]+=t*S,p[C+e]+=t*x}}}}return n.makeTensorInfo([l,g,c,u],"float32",p)}};const A6={kernelName:AE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o}=t,{alignCorners:i,halfPixelCenters:r,size:s}=a;H3(o,"resizeNearestNeighbor");const l=LX(o.shape),[c,g]=s,[u,d,h,p]=o.shape,m=n.data.get(o.dataId).values,I=new Float32Array(u*c*g*p),C=[i&&c>1?d-1:d,i&&g>1?h-1:h],f=[i&&c>1?c-1:c,i&&g>1?g-1:g],b=C[0]/f[0],y=C[1]/f[1];let A=0;for(let v=0;v<u;v++){const e=v*l[0];for(let t=0;t<c;t++){const n=r?b*(t+.5):b*t;let a=Math.min(d-1,i?Math.round(n):Math.floor(n));r&&(a=Math.max(0,a));const o=e+a*l[1];for(let e=0;e<g;e++){const t=r?y*(e+.5):y*e;let n=Math.min(h-1,i?Math.round(t):Math.floor(t));r&&(n=Math.max(0,n));const a=o+n*l[2];for(let e=0;e<p;e++){const t=m[a+e];I[A++]=t}}}}return n.makeTensorInfo([u,c,g,p],o.dtype,I)}};const v6={kernelName:vE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o,dy:i}=t,{alignCorners:r}=a;H3([i,o],"resizeNearestNeighborGrad");const s=LX(o.shape),l=LX(i.shape),[c,g,u,d]=o.shape,[,h,p]=i.shape,m=new Float32Array(c*g*u*d),I=n.data.get(i.dataId).values,C=[r&&h>1?g-1:g,r&&p>1?u-1:u],f=[r&&h>1?h-1:h,r&&p>1?p-1:p],b=C[0]/f[0],y=C[1]/f[1],A=1/b,v=1/y,S=2*Math.ceil(A)+2,x=2*Math.ceil(v)+2;for(let G=0;G<c;G++){const e=G*s[0];for(let t=0;t<g;t++){const n=e+t*s[1],a=Math.floor(t*A),o=Math.floor(a-S/2);for(let i=0;i<u;i++){const a=n+i*s[2],c=Math.floor(i*v),C=Math.floor(c-x/2);for(let n=0;n<d;n++){let s=0;for(let a=0;a<S;a++){const c=a+o;if(c<0||c>=h)continue;const d=e+c*l[1],m=c*b;if(t===Math.min(g-1,r?Math.round(m):Math.floor(m)))for(let e=0;e<x;e++){const t=e+C;if(t<0||t>=p)continue;const a=d+t*l[2],o=t*y;i===Math.min(u-1,r?Math.round(o):Math.floor(o))&&(s+=I[a+n])}}m[a+n]=s}}}}return n.makeTensorInfo(o.shape,o.dtype,m)}};const S6={kernelName:ZE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{dims:i}=a;H3(o,"reverse");const r=o.shape.length,s=wX(i,o.shape);if(0===r)return O3({inputs:{x:o},backend:n});const l=new FH(o.shape,o.dtype),c=n.bufferSync(o);for(let g=0;g<l.size;g++){const e=l.indexToLoc(g),t=e.slice();s.forEach((e=>t[e]=o.shape[e]-1-t[e])),l.set(c.get(...t),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},x6={kernelName:IF,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:a}=e;const{image:o}=t,{radians:i,fillValue:r,center:s}=n,l=a,c=BX(o.dtype,bX(o.shape)),[g,u,d,h]=o.shape,[p,m]=hO(s,u,d),I=Math.sin(i),C=Math.cos(i),f=l.data.get(o.dataId).values;for(let b=0;b<g;b++){const e=b*d*u*h;for(let t=0;t<u;t++){const n=t*(d*h);for(let a=0;a<d;a++){const o=a*h;for(let i=0;i<h;i++){const s=[g,t,a,i],l=s[2],b=s[1];let y=(l-p)*C-(b-m)*I,A=(l-p)*I+(b-m)*C;y=Math.round(y+p),A=Math.round(A+m);let v=r;if("number"!=typeof r&&(v=3===i?255:r[i]),y>=0&&y<d&&A>=0&&A<u){v=f[e+A*(d*h)+y*h+i]}c[e+n+o+i]=v}}}}return{dataId:l.write(c,o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},G6=h5(wE,(e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),Z6={kernelName:wE,backendName:"cpu",kernelFunc:G6};const w6={kernelName:BE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{indices:o,updates:i}=t,{shape:r}=a,{sliceRank:s,numUpdates:l,sliceSize:c,strides:g,outputSize:u}=WD(0,o,r),d=X9(n.bufferSync(o),n.bufferSync(i),r,u,c,l,s,g,0,!0);return n.makeTensorInfo(r,d.dtype,d.values)}};function k6(e,t){let n=0,a=e.length,o=0;for(;n<a;)o=Math.floor((n+a)/2),e[o]<t?n=o+1:a=o;return a}function B6(e,t){let n=0,a=e.length,o=0;for(;n<a;)o=Math.floor((n+a)/2),e[o]<=t?n=o+1:a=o;return a}const R6={kernelName:WE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{sortedSequence:o,values:i}=t,{side:r}=a,s=function(e,t,n,a,o,i){const r=RX("int32",n*o);for(let s=0;s<n;++s){const n=e.slice(s*a,(s+1)*a),l=s*o;for(let e=0;e<o;++e)r[l+e]="left"===i?k6(n,t[e+l]):B6(n,t[e+l])}return r}(n.data.get(o.dataId).values,n.data.get(i.dataId).values,o.shape[0],o.shape[1],i.shape[1],r);return n.makeTensorInfo(i.shape,"int32",s)}};const W6={kernelName:VE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:a,t:o,e:i}=t;H3([a,o,i],"select");const r=a.shape.length,s=n.data.get(a.dataId).values,l=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values,g=jH(o.dtype,i.dtype),u=PX(bX(o.shape),g);let d=0;const h=0===r||r>1||1===o.shape.length?1:bX(o.shape.slice(1));for(let p=0;p<s.length;p++)for(let e=0;e<h;e++)1===s[p]?u[d++]=l[p]:u[d++]=c[p];return n.makeTensorInfo(o.shape,g,u)}},V6=bO,N6=yO,X6=h5(NE,(e=>e>=0?N6*e:V6*(Math.exp(e)-1))),M6={kernelName:NE,backendName:"cpu",kernelFunc:X6},T6=h5(EE,(e=>e<0?-1:e>0?1:0)),E6={kernelName:EE,backendName:"cpu",kernelFunc:T6},F6=h5(ME,(e=>Math.sin(e))),H6={kernelName:ME,backendName:"cpu",kernelFunc:F6},J6=h5(TE,(e=>Math.sinh(e))),Y6={kernelName:TE,backendName:"cpu",kernelFunc:J6},L6=Math.log(1.1920928955078125e-7)+2,z6=h5(HE,(e=>{const t=e>-L6,n=e<L6,a=Math.exp(e);let o;return o=n?a:t?e:Math.log(1+a),o})),K6={kernelName:HE,backendName:"cpu",kernelFunc:z6};const D6={kernelName:LE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{blockShape:i,paddings:r}=a;H3([o],"spaceToBatchND");const s=bX(i),l=[[0,0]];l.push(...r);for(let I=1+i.length;I<o.shape.length;++I)l.push([0,0]);const c=c6.kernelFunc({inputs:{x:o},backend:n,attrs:{paddings:l,constantValue:0}}),g=pO(c.shape,i,s,!1),u=mO(g.length,i.length,!1),d=IO(c.shape,i,s,!1),h=w4({inputs:{x:c},backend:n,attrs:{shape:g}}),p=m9({inputs:{x:h},backend:n,attrs:{perm:u}}),m=w4({inputs:{x:p},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),m}};const U6={kernelName:DE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:a,values:o,denseShape:i,defaultValue:r}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==a.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(a.shape));if(1!==o.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(o.shape));if(0!==r.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(r.shape));const s=n.data.get(a.dataId).values,l=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values,g=n.data.get(r.dataId).values[0],[u,d,h,p,m]=Y9(s,a.shape,a.dtype,l,o.dtype,c,g);return[n.makeTensorInfo(d,a.dtype,u),n.makeTensorInfo([d[0]],o.dtype,h),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map((e=>Number(e))))),n.makeTensorInfo([m.length],a.dtype,new Int32Array(m))]}};const P6={kernelName:UE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:a,inputShape:o,newShape:i}=t;if(2!==a.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(a.shape));if(1!==o.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(o.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const r=Array.from(n.data.get(o.dataId).values),s=n.data.get(a.dataId).values,l=Array.from(n.data.get(i.dataId).values),[c,g,u]=L9(s,a.shape,a.dtype,r,l);return[n.makeTensorInfo(g,a.dtype,c),n.makeTensorInfo([u.length],i.dtype,new Int32Array(u))]}};const O6={kernelName:PE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:a,indices:o,segmentIds:i}=t;if(a.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==o.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(o.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(o.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const r=n.data.get(a.dataId).values,s=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values,[c,g]=z9(r,a.shape,a.dtype,s,l,!0);return n.makeTensorInfo(g,a.dtype,c)}};const _6={kernelName:OE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:a,indices:o,segmentIds:i}=t;if(a.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==o.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(o.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(o.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const r=n.data.get(a.dataId).values,s=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values,[c,g]=z9(r,a.shape,a.dtype,s,l);return n.makeTensorInfo(g,a.dtype,c)}};const Q6={kernelName:_E,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{sparseIndices:o,sparseValues:i,defaultValue:r}=t,{outputShape:s}=a,{sliceRank:l,numUpdates:c,sliceSize:g,strides:u,outputSize:d}=WD(0,o,s),h=!1,p=n.bufferSync(o);let m;switch(i.dtype){case"bool":m=X9(p,n.bufferSync(i),s,d,g,c,l,u,!!n.data.get(r.dataId).values[0],h);break;case"float32":m=X9(p,n.bufferSync(i),s,d,g,c,l,u,n.data.get(r.dataId).values[0],h);break;case"int32":m=X9(p,n.bufferSync(i),s,d,g,c,l,u,n.data.get(r.dataId).values[0],h);break;case"string":m=X9(p,n.bufferSync(i),s,d,g,c,l,u,SH(n.data.get(r.dataId).values[0]),h);break;default:throw new Error("Unsupported type ".concat(i.dtype))}return n.makeTensorInfo(s,m.dtype,m.values)}};const j6={kernelName:zE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{numOrSizeSplits:i,axis:r}=a,s=wX(r,o.shape)[0],l=DO(o,i,s),c=new Array(o.shape.length).fill(0),g=o.shape.slice();return l.map((e=>{const t=[...g];t[s]=e;const a=H9({inputs:{x:o},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,a}))}},q6={kernelName:jE,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{x:a}=t,o=n;H3(a,"square");const i=o.data.get(a.dataId).values,r=new Float32Array(i.length);for(let s=0;s<i.length;++s){const e=i[s];r[s]=e*e}return{dataId:o.write(r,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},$6=h5(pF,((e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),eee={kernelName:pF,backendName:"cpu",kernelFunc:$6};const tee={kernelName:$E,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{begin:i,end:r,strides:s,beginMask:l,endMask:c,ellipsisMask:g,newAxisMask:u,shrinkAxisMask:d}=a;H3(o,"stridedSlice");const{finalShapeSparse:h,finalShape:p,isIdentity:m,sliceDim0:I,isSimpleSlice:C,begin:f,end:b,strides:y}=jP(o.shape,i,r,s,l,c,g,u,d);let A;if(m)A=w4({inputs:{x:o},backend:n,attrs:{shape:p}});else if(I||C){IX(o.shape.length>=1,(()=>"Input must have rank at least 1, got: ".concat(o.shape.length)));const e=HP(f,b,y),t=H9({inputs:{x:o},backend:n,attrs:{begin:f,size:e}});A=w4({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{const e=$9(h,n.bufferSync(o),y,f);A=n.makeTensorInfo(p,e.dtype,e.values)}return A}};const nee={kernelName:eF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{separator:o,nGramWidths:i,leftPad:r,rightPad:s,padWidth:l,preserveShortSequences:c}=a,{data:g,dataSplits:u}=t,d=n.data.get(g.dataId).values,h=n.data.get(u.dataId).values,[p,m]=t4(d,h,o,i,r,s,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(u.shape,"int32",m)]}};const aee={kernelName:tF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{skipEmpty:o}=a,{input:i,delimiter:r}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==r.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(r.shape));const s=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values[0],[c,g,u]=a4(s,l,o),d=g.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",g),n.makeTensorInfo([2],"int32",new Int32Array(u))]}};const oee={kernelName:nF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{numBuckets:o}=a,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const r=o4(n.data.get(i.dataId).values,o);return n.makeTensorInfo(i.shape,"int32",r)}},iee=h5(oF,(e=>Math.tan(e))),ree={kernelName:oF,backendName:"cpu",kernelFunc:iee},see=h5(iF,(e=>Math.tanh(e)));const lee={kernelName:RE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{tensor:a,indices:o,updates:i}=t,{sliceRank:r,numUpdates:s,sliceSize:l,strides:c,outputSize:g}=WD(0,o,a.shape),u=n.bufferSync(o),d=n.bufferSync(i),h=n.bufferSync(a),p=X9(u,d,a.shape,g,l,s,r,c,h,!1);return n.makeTensorInfo(a.shape,p.dtype,p.values)}};const cee={kernelName:rF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{reps:i}=a;H3(o,"tile");const r=c4(n.bufferSync(o),i);return n.makeTensorInfo(r.shape,r.dtype,r.values)}};const gee={kernelName:sF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{k:i,sorted:r}=a;H3(o,"topk");const s=n.data.get(o.dataId).values,[l,c]=d4(s,o.shape,o.dtype,i,r);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};const uee={kernelName:lF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:a}=e,{image:o,transforms:i}=t,{interpolation:r,fillMode:s,fillValue:l,outputShape:c}=n,[g,u,d,h]=o.shape,[p,m]=null!==c&&void 0!==c?c:[u,d],I=[g,p,m,h],C=LX(o.shape),f=C[0],b=C[1],y=C[2],A=LX(I),v=A[0],S=A[1],x=A[2],G=BX(o.dtype,bX(I));G.fill(l);const Z=a.data.get(o.dataId).values,w=a.data.get(i.dataId).values;for(let k=0;k<g;++k){const e=1===i.shape[0]?w:w.subarray(8*k,8*k+8);for(let t=0;t<p;++t)for(let n=0;n<m;++n)for(let a=0;a<h;++a){let o;const i=e[6]*n+e[7]*t+1;if(0===i)continue;const c=(e[0]*n+e[1]*t+e[2])/i,g=(e[3]*n+e[4]*t+e[5])/i,h=dee(c,d,s),p=dee(g,u,s);switch(r){case"nearest":o=pee(Z,u,d,f,b,y,k,p,h,a,l);break;case"bilinear":o=mee(Z,u,d,f,b,y,k,p,h,a,l);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(r))}G[k*v+t*S+n*x+a]=o}return a.makeTensorInfo(I,o.dtype,G)}return{dataId:a.write(G,I,o.dtype),shape:o.shape,dtype:o.dtype}}};function dee(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return dX(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return dX(0,n,t-1)}(e,t);case"nearest":return function(e,t){return dX(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function hee(e,t,n,a,o,i,r,s,l,c,g){return 0<=s&&s<t&&0<=l&&l<n?e[r*a+s*o+l*i+c]:g}function pee(e,t,n,a,o,i,r,s,l,c,g){return hee(e,t,n,a,o,i,r,Math.round(s),Math.round(l),c,g)}function mee(e,t,n,a,o,i,r,s,l,c,g){const u=Math.floor(s),d=Math.floor(l),h=u+1,p=d+1;return(h-s)*((p-l)*hee(e,t,n,a,o,i,r,u,d,c,g)+(l-d)*hee(e,t,n,a,o,i,r,u,p,c,g))+(s-u)*((p-l)*hee(e,t,n,a,o,i,r,h,d,c,g)+(l-d)*hee(e,t,n,a,o,i,r,h,p,c,g))}const Iee={kernelName:gF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:a}=e,{axis:o}=n,{x:i}=t;H3(i,"unique");const r=a.data.get(i.dataId).values,{outputValues:s,outputShape:l,indices:c}=h4(r,o,i.shape,i.dtype);return[a.makeTensorInfo(l,i.dtype,s),a.makeTensorInfo([c.length],"int32",c)]}};const Cee={kernelName:uF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{value:o}=t;let{axis:i}=a;i<0&&(i+=o.shape.length);const r=o.shape.length,s=o.shape[i],l=new Array(r-1);let c=0;for(let h=0;h<r;h++)h!==i&&(l[c++]=o.shape[h]);const g=new Array(r).fill(0),u=o.shape.slice();u[i]=1;const d=new Array(s);for(let h=0;h<d.length;h++){g[i]=h;const e=H9({inputs:{x:o},backend:n,attrs:{begin:g,size:u}});d[h]=w4({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}};const fee={kernelName:dF,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,segmentIds:i}=t,{numSegments:r}=a;H3(o,"unsortedSegmentSum");const s=[],l=[],c=o.shape.length-i.shape.length;let g=i;for(let d=0;d<c;++d){const e=$8({inputs:{input:g},backend:n,attrs:{dim:d+1}});g=e,l.push(e)}for(let d=0;d<r;++d){const e=fH(d,"int32"),t=n.makeTensorInfo([],"int32",e),a=y5({inputs:{a:t,b:g},backend:n}),i=$3({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=s9({inputs:{a:i,b:o},backend:n}),c=Y8({inputs:{x:r},backend:n,attrs:{axis:0,keepDims:!1}});s.push(c),l.push(t),l.push(a),l.push(i),l.push(r),l.push(c)}const u=s6({inputs:s,backend:n,attrs:{axis:0}});return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}},bee=[W4,z3,N4,M4,r5,T4,E4,F4,H4,J4,L4,K4,U4,_4,j4,t8,n8,a8,o8,R4,i8,r8,s8,u5,l8,e5,C5,g8,U3,u8,m8,C8,f8,b8,y8,A8,v8,x8,Z8,w8,k8,B8,R8,W8,N8,X8,M8,T8,E8,F8,H8,J8,z8,I4,K8,A5,q8,x5,e7,w5,s7,c7,g7,R5,N5,u7,d7,h7,p7,F5,Y5,_3,m7,h8,C7,b7,A7,f4,K5,P5,v7,j5,x7,w7,B7,V7,N7,X7,T7,t9,E7,F7,H7,J7,Y7,L7,z7,o9,K7,P7,Q7,l9,g9,q7,e6,n6,h9,a6,r6,l6,c6,d6,A4,f9,h6,p6,m6,I6,j3,a7,f6,S4,G4,k4,b6,y6,A6,v6,S6,x6,Z6,N9,w6,R6,W6,M6,E9,E6,H6,Y6,J9,_7,K6,D6,U6,P6,O6,_6,Q6,j6,U9,q6,_9,q9,eee,tee,nee,aee,oee,l4,L8,ree,{kernelName:iF,backendName:"cpu",kernelFunc:see},lee,cee,gee,uee,I9,Iee,Cee,fee,i6];for(const n of bee)ZF(n);const yee={},Aee={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function vee(e,t){yee[e]=t}function See(e,t){if(!(e in yee)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null!==t&&void 0!==t?t:function(e){if(!nM().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&2===e)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete yee[e]}),!1),nM().getBool("SOFTWARE_WEBGL_ENABLED")&&(Aee.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",Aee)||n.getContext("experimental-webgl",Aee):n.getContext("webgl2",Aee)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;yee[e]=n}const n=yee[e];return null==n||n.isContextLost()?(delete yee[e],See(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),yee[e])}var xee,Gee,Zee;function wee(e,t){return[t,e]}function kee(e){const t=bX(e);return SX(Math.ceil(t/4))}function Bee(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Ree(e,t){const n=e;let a,o,i,r,s,l,c,g,u,d;return 2===nM().getNumber("WEBGL_VERSION")?(a=n.R32F,o=n.R16F,i=n.RGBA16F,r=n.RGBA32F,s=n.RED,c=4,g=1,u=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(a=e.RGBA,o=e.RGBA,i=e.RGBA,r=n.RGBA,s=e.RGBA,c=4,g=4,u=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,l=e.RGBA),{internalFormatFloat:a,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:r,textureFormatFloat:s,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:g,textureTypeHalfFloat:u,textureTypeFloat:d}}function Wee(e,t){const n=t();return nM().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Nee(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(xee||(xee={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Gee||(Gee={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Zee||(Zee={}));function Vee(e){return!!(nM().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Nee(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}function Xee(e,t){return nte(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}function Mee(e,t){const n=nte(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(Wee(e,(()=>e.shaderSource(n,t))),Wee(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Tee(e,t){const n=nte(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(Wee(e,(()=>e.shaderSource(n,t))),Wee(e,(()=>e.compileShader(n))),nM().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw Fee(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const Eee=/ERROR: [0-9]+:([0-9]+):/g;function Fee(e,t){const n=Eee.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);const a=+n[1],o=e.split("\n"),i=o.length.toString().length+2,r=o.map(((e,t)=>xX((t+1).toString(),i)+e));let s=0;for(let u=0;u<r.length;u++)s=Math.max(r[u].length,s);const l=r.slice(0,a-1),c=r.slice(a-1,a),g=r.slice(a);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(xX(c[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join("\n"))}function Hee(e){return nte(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}function Jee(e,t){if(Wee(e,(()=>e.linkProgram(t))),!nM().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Yee(e,t){if(Wee(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Lee(e,t){const n=nte(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return Wee(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),Wee(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}function zee(e,t){const n=nte(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return Wee(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),Wee(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}function Kee(e){return nte(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}function Dee(e,t){const n=nM().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const n="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(e>n||t>n){const a="[".concat(e,"x").concat(t,"]"),o="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+o+".")}}function Uee(e){return nte(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}function Pee(e,t,n,a,o,i,r){const s=e.getAttribLocation(t,n);return-1!==s&&(Wee(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,a))),Wee(e,(()=>e.vertexAttribPointer(s,o,e.FLOAT,!1,i,r))),Wee(e,(()=>e.enableVertexAttribArray(s))),!0)}function Oee(e,t,n){ate(e,n),Wee(e,(()=>e.activeTexture(e.TEXTURE0+n))),Wee(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}function _ee(e,t,n){return nte(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}function Qee(e,t,n){return e.getUniformLocation(t,n)}function jee(e,t,n,a){Wee(e,(()=>Oee(e,t,a))),Wee(e,(()=>e.uniform1i(n,a)))}function qee(e,t,n){Wee(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),Wee(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function $ee(e,t){Wee(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),Wee(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function ete(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+tte(e,t))}function tte(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}function nte(e,t,n){const a=Wee(e,(()=>t()));if(null==a)throw new Error(n);return a}function ate(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,a=t+e.TEXTURE0;if(a<e.TEXTURE0||a>n){const e="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(e,"."))}}function ote(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return bX(e.slice(0,e.length-t))}function ite(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function rte(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[ote(e),...ite(e)]),t}function ste(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=nM().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=nM().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");a===1/0&&nM().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=n/2),t&&(n*=2,a*=2,1===(e=e.map(((t,n)=>n>=e.length-2?hX(e[n]):e[n]))).length&&(e=[2,e[0]])),2!==e.length&&(e=kX(e).newShape);let o=bX(e),i=null;e.length<=1&&o<=n?i=[1,o]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);const r=null!=i&&Math.max(...i)>a&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(null==i||r)if(t){const t=ote(e);let n=2,a=2;e.length&&([n,a]=ite(e)),o=t*(n/2)*(a/2),i=SX(o).map((e=>2*e))}else i=SX(o);return i}function lte(e){return e%2===0}function cte(e,t){if(AX(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e[e.length-1],a=t[t.length-1];if(n===a||lte(n)&&lte(a)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&lte(e[0])&&lte(t[0])}let gte,ute;function dte(e){if(null==gte){const t=See(e);gte=t.getParameter(t.MAX_TEXTURE_SIZE)}return gte}function hte(e){if(null==ute){const t=See(e);ute=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ute)}function pte(e){if(0===e)return 0;let t;const n=See(e);return t=mte(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:mte(n,"EXT_disjoint_timer_query")?1:0,t}function mte(e,t){return null!=e.getExtension(t)}function Ite(e){try{if(null!=See(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Cte(e){if(0===e)return!1;const t=See(e);if(1===e){if(!mte(t,"OES_texture_float"))return!1}else if(!mte(t,"EXT_color_buffer_float"))return!1;return bte(t)}function fte(e){if(0===e)return!1;const t=See(e);if(1!==e){if(mte(t,"EXT_color_buffer_float"))return bte(t);const e="EXT_color_buffer_half_float";if(mte(t,e)){const n=t.getExtension(e);return function(e,t){const n=Ree(e,t),a=e.createTexture();e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(a),e.deleteFramebuffer(o),i}(t,n)}return!1}return!(!mte(t,"OES_texture_float")||!mte(t,"WEBGL_color_buffer_float"))&&bte(t)}function bte(e){const t=Ree(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(a),o}function yte(e){return 2===e&&null!=See(e).fenceSync}function Ate(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&IX("complex64"!==e.dtype,(()=>"".concat(t," does not support complex64 tensors in the WebGL backend.")))}))}const vte=Object.freeze(Object.defineProperty({__proto__:null,assertNotComplex:Ate,bindCanvasToFramebuffer:function(e){Wee(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),Wee(e,(()=>e.viewport(0,0,e.canvas.width,e.canvas.height))),Wee(e,(()=>e.scissor(0,0,e.canvas.width,e.canvas.height)))},bindColorTextureToFramebuffer:qee,bindTextureToProgramUniformSampler:jee,bindTextureUnit:Oee,bindVertexBufferToProgramAttribute:Pee,callAndCheck:Wee,canBeRepresented:Vee,createFragmentShader:Tee,createFramebuffer:Uee,createProgram:Hee,createStaticIndexBuffer:zee,createStaticVertexBuffer:Lee,createTexture:Kee,createVertexShader:Mee,getBatchDim:ote,getExtensionOrThrow:Xee,getFramebufferErrorMessage:tte,getMaxTexturesInShader:hte,getNumChannels:function(){return 2===nM().getNumber("WEBGL_VERSION")?1:4},getProgramUniformLocation:Qee,getProgramUniformLocationOrThrow:_ee,getRowsCols:ite,getShapeAs3D:rte,getTextureShapeFromLogicalShape:ste,getWebGLDisjointQueryTimerVersion:pte,getWebGLErrorMessage:Nee,getWebGLMaxTextureSize:dte,hasExtension:mte,isCapableOfRenderingToFloatTexture:Cte,isDownloadFloatTextureEnabled:fte,isReshapeFree:cte,isWebGLFenceEnabled:yte,isWebGLVersionEnabled:Ite,linkProgram:Jee,logShaderSourceAndInfoLog:Fee,resetMaxTextureSize:function(){gte=null},resetMaxTexturesInShader:function(){ute=null},unbindColorTextureFromFramebuffer:$ee,unbindTextureUnit:function(e,t){ate(e,t),Wee(e,(()=>e.activeTexture(e.TEXTURE0+t))),Wee(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))},validateFramebuffer:ete,validateProgram:Yee,validateTextureSize:Dee},Symbol.toStringTag,{value:"Module"})),Ste=nM();function xte(){let e,t,n,a,o,i,r,s,l,c;return 2===nM().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",a="in",o="texture",i="outputColor",r="out vec4 outputColor;",s=nM().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",a="varying",o="texture2D",i="gl_FragColor",r="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:a,texture2D:o,output:i,defineOutput:r,defineSpecialNaN:s,defineSpecialInf:l,defineRound:c}}function Gte(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const a=LX(t);return a.map(((t,o)=>{const i="int ".concat(e[o]," = ").concat(n," / ").concat(t),r=o===a.length-1?"int ".concat(e[o+1]," = ").concat(n," - ").concat(e[o]," * ").concat(t):"index -= ".concat(e[o]," * ").concat(t);return"".concat(i,"; ").concat(r,";")})).join("")}function Zte(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const a=LX(t);return a.map(((t,o)=>{const i="int ".concat(e[o]," = ").concat(n," / outShapeStrides[").concat(o,"]"),r=o===a.length-1?"int ".concat(e[o+1]," = ").concat(n," - ").concat(e[o]," * outShapeStrides[").concat(o,"]"):"index -= ".concat(e[o]," * outShapeStrides[").concat(o,"]");return"".concat(i,"; ").concat(r,";")})).join("")}function wte(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const a=e.map(((e,t)=>t)),o=function(e,t){const n=e.length,a=e.map((e=>"".concat(t,"[").concat(e,"]"))),o=new Array(n-1);o[n-2]=a[n-1];for(let i=n-3;i>=0;--i)o[i]="(".concat(o[i+1]," * ").concat(a[i+1],")");return o}(a,t);return o.map(((t,a)=>{const i="int ".concat(e[a]," = ").concat(n," / ").concat(o[a]),r=a===o.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(o[a]):"index -= ".concat(e[a]," * ").concat(o[a]);return"".concat(i,"; ").concat(r,";")})).join("")}function kte(e){const t=LX(e).map((e=>e.toString()));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}Ste.registerFlag("HAS_WEBGL",(()=>Ste.getNumber("WEBGL_VERSION")>0)),Ste.registerFlag("WEBGL_VERSION",(()=>Ite(2)?2:Ite(1)?1:0)),Ste.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),Ste.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===Ste.get("WEBGL_VERSION"))),Ste.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),Ste.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),Ste.registerFlag("WEBGL_PACK",(()=>Ste.getBool("HAS_WEBGL"))),Ste.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_CLIP",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_REDUCE",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_LAZILY_UNPACK",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_CONV_IM2COL",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",(()=>Ste.getBool("WEBGL_PACK"))),Ste.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>dte(Ste.getNumber("WEBGL_VERSION")))),Ste.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>hte(Ste.getNumber("WEBGL_VERSION")))),Ste.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=Ste.getNumber("WEBGL_VERSION");return 0===e?0:pte(e)})),Ste.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>Ste.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!pJ())),Ste.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>Cte(Ste.getNumber("WEBGL_VERSION")))),Ste.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!Ste.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ste.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),Ste.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>fte(Ste.getNumber("WEBGL_VERSION")))),Ste.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>yte(Ste.getNumber("WEBGL_VERSION")))),Ste.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>Ste.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),Ste.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if("number"!=typeof e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),Ste.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>pJ()?1:-1),(e=>{if("number"!=typeof e)throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got ".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),Ste.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),Ste.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),Ste.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),Ste.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),Ste.registerFlag("WEBGL_EXP_CONV",(()=>!1)),Ste.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>Ste.getBool("IS_TEST"))),Ste.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),Ste.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),Ste.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),Ste.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));const Bte="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:Rte}=g_;function Wte(e,t,n){const a=[];if(e.forEach((e=>{const t=bX(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?a.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(a.push("uniform sampler2D ".concat(e.name,";")),a.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){const{uniformShape:t}=Yte(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:a.push("uniform int ".concat(e.name,"Shape;"));break;case 2:a.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:a.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:a.push("uniform ivec4 ".concat(e.name,"Shape;"))}a.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:a.push("uniform int outShape;");break;case 2:a.push("uniform ivec2 outShape;"),a.push("uniform int outShapeStrides;");break;case 3:a.push("uniform ivec3 outShape;"),a.push("uniform ivec2 outShapeStrides;");break;case 4:a.push("uniform ivec4 outShape;"),a.push("uniform ivec3 outShapeStrides;")}a.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{a.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));const o=a.join("\n"),i=e.map((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,o="";o+=n?Nte(e,a):Vte(e,a);const i=e.shapeInfo.logicalShape,r=t.logicalShape;return i.length<=r.length&&(o+=n?function(e,t){const n=e.name,a=n.charAt(0).toUpperCase()+n.slice(1),o="get"+a+"AtOutCoords",i=e.shapeInfo.logicalShape.length,r=t.logicalShape.length,s=Rte(e.shapeInfo.logicalShape,t.logicalShape),l=Jte(r),c=r-i;let g;const u=["x","y","z","w","u","v"];g=0===i?"":r<2&&s.length>=1?"coords = 0;":s.map((e=>"coords.".concat(u[e+c]," = 0;"))).join("\n");let d="";d=r<2&&i>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>"coords.".concat(u[t+c]))).join(", ");let h="return outputValue;";const p=1===bX(e.shapeInfo.logicalShape),m=1===bX(t.logicalShape);if(1!==i||p||m){if(p&&!m)h=1===r?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){const e=i-2,t=i-1;s.indexOf(e)>-1&&s.indexOf(t)>-1?h="return vec4(outputValue.x);":s.indexOf(e)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(t)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(o,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(g,"\n      vec4 outputValue = get").concat(a,"(").concat(d,");\n      ").concat(h,"\n    }\n  ")}(e,t):function(e,t){const n=e.name,a=n.charAt(0).toUpperCase()+n.slice(1),o="get"+a+"AtOutCoords",i=t.texShape,r=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===l&&null==e.shapeInfo.flatOffset&&AX(r,i))return"\n      float ".concat(o,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");const c=Jte(l),g=Rte(e.shapeInfo.logicalShape,t.logicalShape),u=l-s;let d;const h=["x","y","z","w","u","v"];d=0===s?"":l<2&&g.length>=1?"coords = 0;":g.map((e=>"coords.".concat(h[e+u]," = 0;"))).join("\n");let p="";return p=l<2&&s>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>"coords.".concat(h[t+u]))).join(", "),"\n    float ".concat(o,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(d,"\n      return get").concat(a,"(").concat(p,");\n    }\n  ")}(e,t)),o}(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),r=t.texShape,s=xte(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(s);let c,g,u=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(Xte,"\n    ").concat(Mte,"\n    ").concat(Tte,"\n  ")}(s);return t.isPacked?(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const a=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===a[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(a[1],".0);\n      }\n    "):1===a[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(a[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n      return 2 * (resTexRC.x * ").concat(a[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){const a=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(AX(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(a[0],", ").concat(a[1],"));\n      }\n    ");const o=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n\n      int index = resTexRC.x * ").concat(a[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(o,");\n      int c = imod(index, ").concat(o,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const a=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(e[2]/2),i=o*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n      int index = resTexRC.x * ").concat(a[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(o,");\n      int c = imod(index, ").concat(o,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const a=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(e[e.length-1]/2),i=o*Math.ceil(e[e.length-2]/2);let r=i,s="",l="b, r, c";for(let c=2;c<e.length-1;c++)r*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(r,";\n      index -= b").concat(c," * ").concat(r,";\n    ")+s,l="b".concat(c,", ")+l;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(a[0],", ").concat(a[1],"));\n      int index = resTexRC.x * ").concat(a[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(o,");\n      int c = imod(index, ").concat(o,") * 2;\n\n      return ivec").concat(e.length,"(").concat(l,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,r,n.enableShapeUniforms),g=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(s)):(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return AX(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(Zte(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");const a=Gte(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(Zte(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");const a=Gte(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){const n=Gte(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){const n=Gte(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,r,n.enableShapeUniforms),g=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(s)),n.packedInputs&&(u+=Ete),[u,l,g,o,c,i,n.userCode].join("\n")}function Vte(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(a,"() {return ").concat(n,";}");const[o,i]=e.shapeInfo.texShape;if(1===o&&1===i)return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const r=Fte(n);if(t)return"\n    float ".concat(a,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(r,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");const[s,l]=e.shapeInfo.texShape;return"\n    float ".concat(a,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(l,", ").concat(r,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){const n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int index) {\n        ").concat(Hte(e),"\n      }\n    ");const o=e.shapeInfo.texShape,i=o[0],r=o[1];if(1===r&&1===i)return"\n      float ".concat(a,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const s=Fte(n);return 1===r?t?"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(r,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(a,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(a,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(r,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=e.shapeInfo.texShape;if(null!=i&&AX(n,i)){if(t)return"\n      float ".concat(o,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(a,"TexShape[1], ").concat(a,"TexShape[0]);\n        return sampleTexture(").concat(a,", uv);\n      }\n    ");const e=i[0],n=i[1];return"\n    float ".concat(o,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(n,".0, ").concat(e,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}const{newShape:r,keptDims:s}=kX(n),l=r;if(l.length<n.length){const n=Lte(e,l),a=["row","col"];return"\n      ".concat(Vte(n,t),"\n      float ").concat(o,"(int row, int col) {\n        return ").concat(o,"(").concat(zte(a,s),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(o,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(Hte(e),"\n      }\n    ");const c=i[0],g=i[1],u=Fte(a);return 1===g?t?"\n      float ".concat(o,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(u,"), vec3(").concat(a,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(a,"TexShape[0]));\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(o,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(u,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(c,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):1===c?t?"\n      float ".concat(o,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(u,"), vec3(").concat(a,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(a,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(o,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(u,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(g,".0, 0.5);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):t?"\n      float ".concat(o,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(a,"Shape[1] + col + ").concat(u,";\n        vec2 uv = uvFromFlat(").concat(a,"TexShape[0], ").concat(a,"TexShape[1], index);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n  float ".concat(o,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(u,";\n    vec2 uv = uvFromFlat(").concat(c,", ").concat(g,", index);\n    return sampleTexture(").concat(a,", uv);\n  }\n")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=n[1]*n[2],r=n[2],{newShape:s,keptDims:l}=kX(n),c=s;if(c.length<n.length){const n=Lte(e,c),a=["row","col","depth"];return"\n        ".concat(Vte(n,t),"\n        float ").concat(o,"(int row, int col, int depth) {\n          return ").concat(o,"(").concat(zte(a,l),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(o,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(r,", 1)));\n        ").concat(Hte(e),"\n      }\n    ");const g=e.shapeInfo.texShape,u=g[0],d=g[1],h=e.shapeInfo.flatOffset;if(d===i&&null==h)return t?"\n      float ".concat(o,"(int row, int col, int depth) {\n        int stride1 = ").concat(a,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(a,"TexShape[1], ").concat(a,"TexShape[0]);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n        float ".concat(o,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(r,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(u,".0);\n          return sampleTexture(").concat(a,", uv);\n        }\n      ");if(d===r&&null==h)return t?"\n      float ".concat(o,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(a,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(a,"TexShape[1], ").concat(a,"TexShape[0]);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(o,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(u,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ");const p=Fte(a);return t?"\n    float ".concat(o,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(a,"Shape[1] * ").concat(a,"Shape[2];\n      int stride1 = ").concat(a,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(a,"TexShape[0], ").concat(a,"TexShape[1], index);\n      return sampleTexture(").concat(a,", uv);\n    }\n    "):"\n      float ".concat(o,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(r," + depth + ").concat(p,";\n        vec2 uv = uvFromFlat(").concat(u,", ").concat(d,", index);\n        return sampleTexture(").concat(a,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=n[3],r=n[2]*i,s=n[1]*r,{newShape:l,keptDims:c}=kX(n);if(l.length<n.length){const n=Lte(e,l),a=["row","col","depth","depth2"];return"\n      ".concat(Vte(n,t),"\n      float ").concat(o,"(int row, int col, int depth, int depth2) {\n        return ").concat(o,"(").concat(zte(a,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(r,", ").concat(i,", 1)));\n        ").concat(Hte(e),"\n      }\n    ");const g=e.shapeInfo.flatOffset,u=e.shapeInfo.texShape,d=u[0],h=u[1],p="int stride2 = ".concat(a,"Shape[3];"),m="int stride1 = ".concat(a,"Shape[2] * stride2;"),I="int stride0 = ".concat(a,"Shape[1] * stride1;");if(h===s&&null==g)return t?"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        ").concat(p,"\n        ").concat(m,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(a,"TexShape[1], ").concat(a,"TexShape[0]);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(r,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    ");if(h===i&&null==g)return t?"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(a,"Shape[1] * ").concat(a,"Shape[2], ").concat(a,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(a,"TexShape[1], ").concat(a,"TexShape[0]);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    ");const C=Fte(a);return t?"\n    float ".concat(o,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(p,"\n      ").concat(m,"\n      ").concat(I,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(a,"TexShape[0], ").concat(a,"TexShape[1], index + ").concat(C,");\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):"\n    float ".concat(o,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(r," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(h,", index + ").concat(C,");\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],i=t[3]*o,r=t[2]*i,s=t[1]*r,{newShape:l,keptDims:c}=kX(t);if(l.length<t.length){const t=Lte(e,l),n=["row","col","depth","depth2","depth3"];return"\n      ".concat(Vte(t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(a,"(").concat(zte(n,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(r,", ").concat(i,", ").concat(o,")) +\n          depth3;\n        ").concat(Hte(e),"\n      }\n    ");const g=e.shapeInfo.flatOffset,u=e.shapeInfo.texShape,d=u[0],h=u[1];if(h===s&&null==g)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(r,", ").concat(i,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(h===o&&null==g)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const p=Fte(n);return"\n    float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(r," + depth * ").concat(i," +\n          depth2 * ").concat(o," + depth3 + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(h,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:o,keptDims:i}=kX(t);if(o.length<t.length){const t=Lte(e,o),n=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(Vte(t),"\n      float ").concat(a,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(a,"(").concat(zte(n,i),");\n      }\n    ")}const r=t[5],s=t[4]*r,l=t[3]*s,c=t[2]*l,g=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(g,", ").concat(c,", ").concat(l,", ").concat(s,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(r,", 1)));\n        ").concat(Hte(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1];if(p===g&&null==u)return"\n      float ".concat(a,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(c,", ").concat(l,", ").concat(s,", ").concat(r,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===r&&null==u)return"\n      float ".concat(a,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const m=Fte(n);return"\n    float ".concat(a,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(g," + col * ").concat(c," + depth * ").concat(l," +\n          depth2 * ").concat(s," + depth3 * ").concat(r," + depth4 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(p,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function Nte(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=xte();return"\n    vec4 ".concat(n,"() {\n      return ").concat(a.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){const n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=xte();if(t)return"\n    vec4 ".concat(a,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");const r=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 ".concat(a,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(r[0],", ").concat(r[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=e.shapeInfo.texShape,r=i[0],s=i[1],l=xte();if(null!=i&&AX(n,i))return t?"\n      vec4 ".concat(o,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(a,"TexShape[1], ").concat(a,"TexShape[0]);\n\n        return ").concat(l.texture2D,"(").concat(a,", uv);\n      }\n    "):"\n      vec4 ".concat(o,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(r,".0);\n\n        return ").concat(l.texture2D,"(").concat(a,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(o,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(a,"TexShape[0]) / 2.0), ceil(float(").concat(a,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(a,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(l.texture2D,"(").concat(a,", uv);\n    }\n  ");const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],g=Math.ceil(n[1]/2);return"\n    vec4 ".concat(o,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(g,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(l.texture2D,"(").concat(a,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=e.shapeInfo.texShape,r=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){const a=[1,2],i=Lte(e,n.slice(1)),r=["b","row","col"];return"\n        ".concat(Nte(i,t),"\n        vec4 ").concat(o,"(int b, int row, int col) {\n          return ").concat(o,"(").concat(zte(r,a),");\n        }\n      ")}const s=xte();if(t)return"\n    vec4 ".concat(o,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(a,"TexShape[0]) / 2.0), ceil(float(").concat(a,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(a,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(a,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(s.texture2D,"(").concat(a,", uv);\n    }\n  ");const l=r[0],c=r[1],g=Math.ceil(n[2]/2),u=g*Math.ceil(n[1]/2);return"\n    vec4 ".concat(o,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(l,", ").concat(c,", ").concat(u,", ").concat(g,", b, row, col);\n      return ").concat(s.texture2D,"(").concat(a,", uv);\n    }\n  ")}(e,t);default:return function(e,t){const n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),o=xte();if(t)return"\n    vec4 ".concat(a,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(o.texture2D,"(").concat(n,", uv);\n    }\n  ");const i=e.shapeInfo.logicalShape,r=i.length,s=e.shapeInfo.texShape,l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=l[0],g=l[1],u=Math.ceil(i[r-1]/2);let d=u*Math.ceil(i[r-2]/2),h="int b, int row, int col",p="b * ".concat(d," + (row / 2) * ").concat(u," + (col / 2)");for(let m=2;m<r-1;m++)h="int b".concat(m,", ")+h,d*=i[r-m-1],p="b".concat(m," * ").concat(d," + ")+p;return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(g,";\n      int texC = index - texR * ").concat(g,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(g,", ").concat(c,");\n      return ").concat(o.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}const Xte="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Mte="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Tte="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ete="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Fte(e){return"offset".concat(e)}function Hte(e){const t=e.name,n=bX(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Jte(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Yte(e,t,n){const{newShape:a,keptDims:o}=kX(t),i=t.length,r=e&&3===i&&1===t[0],s=r?t.slice(1):a,l=!e&&i>1&&!AX(t,n)&&a.length<i||r;return{useSqueezeShape:l,uniformShape:l?s:t,keptDims:o}}function Lte(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function zte(e,t){return t.map((t=>e[t])).join(", ")}function Kte(e,t,n){const a=[],o=[];let i,r,s,l=null,c=null;c=e.getUniformLocation(n,"NAN",!1),1===nM().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));const g=!1;for(const u of t.variableNames){const o={name:u,uniform:e.getUniformLocation(n,u,g),offset:e.getUniformLocation(n,"offset".concat(u),g)};t.enableShapeUniforms&&(o.shape=e.getUniformLocation(n,"".concat(u,"Shape"),g),o.texShape=e.getUniformLocation(n,"".concat(u,"TexShape"),g)),a.push(o)}if(t.enableShapeUniforms&&(i=e.getUniformLocation(n,"outShape",g),s=e.getUniformLocation(n,"outShapeStrides",g),r=e.getUniformLocation(n,"outTexShape",g)),t.customUniforms)for(const u of t.customUniforms)o.push(e.getUniformLocation(n,u.name,g));return{variablesLocations:a,customUniformLocations:o,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:s,outTexShapeLocation:r}}function Dte(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach(((e,n)=>{const a=e.logicalShape,o=t[n],i=o.shape;if(!AX(a,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(a," and ").concat(i," must match"));if(e.isUniform&&o.isUniform)return;const r=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!AX(r,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(r," and ").concat(s," must match"))}))}function Ute(e){return nM().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class Pte{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=xee.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=xte();this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Zte(["r","c","d"],e):Gte(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class Ote{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=xee.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=xte();this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Zte(["r","c","d"],e):Gte(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class _te{constructor(e){this.variableNames=["A"],this.outTexUsage=Gee.DOWNLOAD;const t=xte();this.outputShape=e,this.userCode="\n      ".concat(Bte,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class Qte{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Gee.DOWNLOAD;const t=xte();this.outputShape=e,this.userCode="\n      ".concat(Bte,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}const jte={R:0,G:1,B:2,A:3};class qte{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const a=xte();this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let r=0;r<n.length;r++){const e=n[r];i+="\n          if(offset == ".concat(r,") {\n            result = values[").concat(jte[e],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":kte(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(n.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(n.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(i,"\n        }\n        ").concat(a.output," = vec4(").concat(o,", 0., 0., 0.);\n      }\n    ")}}class $te{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=xte();this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length);let a="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let t=0;t<=1;t++){const o=2*i+t;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(t," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),") {\n          localCoords[2] += ").concat(t,";\n          if (localCoords[1] + ").concat(i," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),") {\n            localCoords[1] += ").concat(i,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(n.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(o,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(o,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(o,"] = values[2];\n            } else {\n              result[").concat(o,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":kte(e),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(n.output," = ").concat(o,";\n        }\n    ")}}function ene(e){const t=xte();return Mee(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function tne(e){return Lee(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function nne(e){return zee(e,new Uint16Array([0,1,2,2,1,3]))}function ane(e,t,n,a,o,i){Dee(t,n);const r=Kee(e),s=e.TEXTURE_2D;return Wee(e,(()=>e.bindTexture(s,r))),Wee(e,(()=>e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),Wee(e,(()=>e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),Wee(e,(()=>e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST))),Wee(e,(()=>e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===nM().getNumber("WEBGL_VERSION")?Wee(e,(()=>e.texImage2D(s,0,a,t,n,0,o,i,null))):Wee(e,(()=>e.texStorage2D(s,1,a,t,n))),Wee(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:r,texShape:[n,t]}}function one(e){return e.internalFormatFloat}function ine(e,t,n,a){const[o,i]=wee(t,n);return ane(e,o,i,one(a),a.textureFormatFloat,e.FLOAT)}function rne(e){return e.internalFormatHalfFloat}function sne(e,t,n,a){const[o,i]=wee(t,n);return ane(e,o,i,rne(a),a.textureFormatFloat,a.textureTypeHalfFloat)}function lne(e){return e.downloadTextureFormat}function cne(e,t,n,a){const[o,i]=wee(t,n);return ane(e,o,i,lne(a),e.RGBA,e.UNSIGNED_BYTE)}function gne(e){return e.internalFormatPackedFloat}function une(e,t,n,a){const[o,i]=Bee(t,n);return ane(e,o,i,gne(a),e.RGBA,e.FLOAT)}function dne(e){return e.internalFormatPackedHalfFloat}function hne(e,t,n,a){const[o,i]=Bee(t,n);return ane(e,o,i,dne(a),e.RGBA,a.textureTypeHalfFloat)}function pne(e,t,n){return Wee(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),Pee(e,t,"clipSpacePos",n,3,20,0)&&Pee(e,t,"uv",n,2,20,12)}function mne(e,t,n,a,o,i){let r,s,l;Wee(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),o instanceof Uint8Array?(r=new Uint8Array(n*a*4),s=e.UNSIGNED_BYTE,l=e.RGBA):(r=new Float32Array(n*a*4),s=e.FLOAT,l=i.internalFormatPackedFloat),r.set(o),2===nM().getNumber("WEBGL_VERSION")?Wee(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,a,e.RGBA,s,r))):Wee(e,(()=>e.texImage2D(e.TEXTURE_2D,0,l,n,a,0,e.RGBA,s,r))),Wee(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function Ine(e,t,n){Wee(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===nM().getNumber("WEBGL_VERSION")?Wee(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):Wee(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===nM().getNumber("WEBGL_VERSION")?Wee(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):Wee(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),Wee(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function Cne(e,t,n,a){const o=e.createBuffer();Wee(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,o)));const i=16*t*n;return Wee(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ))),Wee(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),Wee(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),o}function fne(e,t,n){const a=e,o=new Float32Array(n);return a.bindBuffer(a.PIXEL_PACK_BUFFER,t),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,o),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),o}function bne(e,t,n,a){const[o,i]=wee(t,n),r=new Uint8Array(function(e,t){return e*t}(t*n,4));return Wee(e,(()=>e.readPixels(0,0,o,i,a.downloadTextureFormat,e.UNSIGNED_BYTE,r))),new Float32Array(r.buffer)}function yne(e,t,n,a,o,i,r,s){const l=e,c=new Float32Array(function(e,t){const[n,a]=Bee(e,t);return n*a*4}(i,r));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Ane(e,t,n){const a=new Float32Array(t*n*4);return Wee(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,a))),a}const vne=Object.freeze(Object.defineProperty({__proto__:null,bindVertexProgramAttributeStreams:pne,createBufferFromOutputTexture:Cne,createFloat16MatrixTexture:sne,createFloat16PackedMatrixTexture:hne,createFloat32MatrixTexture:ine,createIndexBuffer:nne,createPackedMatrixTexture:une,createUnsignedBytesMatrixTexture:cne,createVertexBuffer:tne,createVertexShader:ene,downloadByteEncodedFloatMatrixFromOutputTexture:bne,downloadFloat32MatrixFromBuffer:fne,downloadMatrixFromPackedOutputTexture:Ane,downloadPackedMatrixFromBuffer:yne,getInternalFormatForFloat16MatrixTexture:rne,getInternalFormatForFloat16PackedMatrixTexture:dne,getInternalFormatForFloat32MatrixTexture:one,getInternalFormatForPackedMatrixTexture:gne,getInternalFormatForUnsignedBytesMatrixTexture:lne,uploadDenseMatrixToTexture:mne,uploadPixelDataToTexture:Ine},Symbol.toStringTag,{value:"Module"}));class Sne{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=nM().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,vee(t,e)):this.gl=See(t),e=this.gl,2===nM().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>Wee(t,(()=>t.createVertexArray())),this.bindVertexArray=e=>Wee(t,(()=>t.bindVertexArray(e))),this.deleteVertexArray=e=>Wee(t,(()=>t.deleteVertexArray(e))),this.getVertexArray=()=>Wee(t,(()=>t.getParameter(t.VERTEX_ARRAY_BINDING)))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Wee(e,(()=>t.createVertexArrayOES())),this.bindVertexArray=n=>Wee(e,(()=>t.bindVertexArrayOES(n))),this.deleteVertexArray=n=>Wee(e,(()=>t.deleteVertexArrayOES(n))),this.getVertexArray=()=>Wee(e,(()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float";const a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===nM().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=Xee(this.gl,e),mte(this.gl,t))this.textureHalfFloatExtension=Xee(this.gl,t);else if(nM().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),mte(this.gl,a))this.colorBufferHalfFloatExtension=Xee(this.gl,a);else if(nM().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",mte(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!mte(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=tne(this.gl),this.indexBuffer=nne(this.gl),this.framebuffer=Uee(this.gl),this.textureConfig=Ree(this.gl,this.textureHalfFloatExtension)}get debug(){return nM().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Wee(e,(()=>e.finish())),Wee(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),Wee(e,(()=>e.deleteFramebuffer(this.framebuffer))),Wee(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),Wee(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),Wee(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),ine(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),sne(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),cne(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),Ine(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,a){this.throwIfDisposed(),mne(this.gl,e,t,n,a,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),hne(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),une(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&($ee(this.gl,this.framebuffer),this.outputTexture=null),Wee(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>bne(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,a,o,i){return yne(this.gl,e,0,0,0,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return fne(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const a=Cne(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(nM().getBool("WEBGL_FENCE_API_ENABLED")){const a=e,o=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=a.clientWaitSync(o,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=o}else nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>Ane(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=ene(t));const n=Hee(t);Wee(t,(()=>t.attachShader(n,this.vertexShader))),Wee(t,(()=>t.attachShader(n,e))),Jee(t,n);const a=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&Yee(t,a),a}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Wee(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),pne(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(Wee(this.gl,(()=>this.gl.deleteProgram(e))),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Yee(this.gl,this.program),Wee(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?_ee(this.gl,e,t):Qee(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Wee(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),jee(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[a,o]=Bee(t,n);this.setOutputMatrixTextureDriver(e,a,o)}setOutputMatrixWriteRegion(e,t,n,a){this.setOutputMatrixWriteRegionDriver(n,e,a,t)}setOutputPackedMatrixWriteRegion(e,t,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&Yee(this.gl,this.program),ete(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Wee(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Wee(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Xee(this.gl,2===nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await GX((()=>this.disposed||this.isQueryAvailable(e,nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),a=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),a&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in nM().platform&&(n=nM().platform.setTimeoutCustom.bind(nM().platform)),GX((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),qee(this.gl,e,this.framebuffer),this.debug&&ete(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(qee(this.gl,this.outputTexture,this.framebuffer),this.debug&&ete(this.gl)):$ee(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const a=this.gl;qee(a,e,this.framebuffer),this.debug&&ete(a),this.outputTexture=e,Wee(a,(()=>a.viewport(0,0,t,n))),Wee(a,(()=>a.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,a){this.throwIfDisposed(),Wee(this.gl,(()=>this.gl.scissor(e,t,n,a)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:xne,bincountImpl:Gne,bincountReduceImpl:Zne,bitwiseAndImpl:wne,castImpl:kne,ceilImpl:Bne,concatImpl:Rne,equalImpl:Wne,expImpl:Vne,expm1Impl:Nne,floorImpl:Xne,gatherNdImpl:Mne,gatherV2Impl:Tne,greaterImpl:Ene,greaterEqualImpl:Fne,lessImpl:Hne,lessEqualImpl:Jne,linSpaceImpl:Yne,logImpl:Lne,maxImpl:zne,maximumImpl:Kne,minimumImpl:Dne,multiplyImpl:Une,negImpl:Pne,notEqualImpl:One,prodImpl:_ne,raggedGatherImpl:Qne,raggedRangeImpl:jne,raggedTensorToTensorImpl:qne,rangeImpl:$ne,rsqrtImpl:eae,scatterImpl:tae,sigmoidImpl:nae,simpleAbsImpl:aae,sliceImpl:oae,sparseFillEmptyRowsImpl:iae,sparseReshapeImpl:rae,sparseSegmentReductionImpl:sae,sqrtImpl:lae,staticRegexReplaceImpl:cae,stridedSliceImpl:gae,stringNGramsImpl:uae,stringSplitImpl:dae,stringToHashBucketFastImpl:hae,subImpl:pae,tileImpl:mae,topKImpl:Iae,transposeImpl:Cae,uniqueImpl:fae}=p4;function bae(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>"".concat(e,".").concat(t)))}function yae(e,t){return 1===t?[e]:bae(e,t)}class Aae{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Ute(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=yae("rc",this.rank),t=Jte(this.rank),n=this.getOutOfBoundsCondition(e),a=this.getSetup(e),o=this.getOutput(e);this.userCode="\n        void main() {\n          ".concat(t," rc = getOutputCoords();\n\n          if(").concat(n,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(a,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let a=0;a<=1;a++){let o="".concat(0===n?"r":"rp1",", ").concat(0===a?"c":"cp1");for(let t=2;t<this.rank;t++)o="".concat(e[e.length-1-t],",")+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);let t="";for(let n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(a,";\n    ")}getOutput(e){const t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}class vae{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length);let n="";for(let a=0;a<4;a++){let e="thisRC = rc;";a%2===1&&(e+="thisRC.z += 1;"),a>1&&(e+="thisRC.y += 1;"),n+="\n        ".concat(e,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t?wte(["r","c","d"],"inputShape"):Gte(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(t,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":kte(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":e[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")}}class Sae{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){const a=Gae(t,n),o=Zae(e,a,n);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=xae(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const e=this.freeTextures[o].pop();return this.usedTextures[o].push(e),e}let r;return a===Zee.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===Zee.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===Zee.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===Zee.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===Zee.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(r),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),r}releaseTexture(e,t,n,a){if(null==this.freeTextures)return;const o=Gae(n,a),i=Zae(t,o,a);i in this.freeTextures||(this.freeTextures[i]=[]);const r=xae(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,a),s=nM().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=r):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=r),this.numUsedTextures--;const l=this.usedTextures[i],c=l&&l.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function xae(e,t,n,a,o){const i=function(e,t){switch(e){case Zee.PACKED_2X2_FLOAT32:return gne(t);case Zee.PACKED_2X2_FLOAT16:return dne(t);case Zee.UNPACKED_FLOAT32:return one(t);case Zee.UNPACKED_FLOAT16:return rne(t);case Zee.PACKED_4X1_UNSIGNED_BYTE:return lne(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,a);let r;if(o){const[t,n]=Bee(e[0],e[1]);r=t*n}else{const[t,n]=wee(e[0],e[1]);r=t*n}const s=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,i);return r*s}function Gae(e,t){if(e===Gee.UPLOAD)return Zee.PACKED_2X2_FLOAT32;if(e===Gee.RENDER||null==e)return function(e){return nM().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Zee.PACKED_2X2_FLOAT32:Zee.UNPACKED_FLOAT32:e?Zee.PACKED_2X2_FLOAT16:Zee.UNPACKED_FLOAT16}(t);if(e===Gee.DOWNLOAD||e===Gee.PIXELS)return Zee.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function Zae(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}class wae{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}const kae="if (isnan(x)) return x;",Bae="return x;",Rae="return abs(x);",Wae="return (x >= 0.0) ? x : (exp(x) - 1.0);",Vae=kae+"\n  return (x < 0.0) ? 0.0 : x;\n",Nae=kae+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Xae="return x;",Mae="return 1.0 / (1.0 + exp(-1.0 * x));",Tae="return x;",Eae="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Fae="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Hae="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Jae="return 1.0 / (1.0 + exp(-1.0 * x));";class Yae{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}class Lae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length);const t=e.length,n=yae("rc",t),a=Jte(t),o=function(e,t){if(1===e)return"rc";let n="";for(let a=0;a<e;a++)n+=t[a],a<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),r=t<=1?"rc":"vec2(".concat(i.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(o,");\n\n        setOutput(getChannel(packedInput, ").concat(r,"));\n      }\n    ")}}const zae=HD,Kae={};const Dae=nM().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class Uae extends cX{nextDataId(){return Uae.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!nM().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof Sne)t=e;else{const n=See(nM().getNumber("WEBGL_VERSION"),e);t=new Sne(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=See(nM().getNumber("WEBGL_VERSION"));t=new Sne(e),this.binaryCache=function(e){return e in Kae||(Kae[e]={}),Kae[e]}(nM().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Sae(this.gpgpu),this.numMBBeforeWarning=null==nM().global.screen?1024:nM().global.screen.height*nM().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new lX(this,RJ())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,a,o,i){const r=this.makeTensorInfo(t,n),s=this.texData.get(r.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[a,o]},s.texShape=[a,o];const l=rte(t),c=new qte(l,!1,i),g=this.runWebGLProgram(c,[r],n,[[a,o]]);return g.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(r),g.dataId}write(e,t,n){if((nM().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||nM().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const a={id:this.nextDataId()};return this.texData.set(a,{shape:t,dtype:n,values:e,usage:Gee.UPLOAD,refCount:1}),a}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,a,o){if(nM().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===a)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:a,values:t,usage:Gee.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:a,complexTensorInfos:o,slice:i,shape:r,isPacked:s}=t;if(null!=i){let t;t=s?new Yae(r,Xae):new wae(r,Xae);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:a}],a),o=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),o}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===a)return n;const l=null!=this.activeTimers;let c,g;if(l&&(c=yH()),"complex64"===a){g=wO(this.readSync(o.real.dataId),this.readSync(o.imag.dataId))}else g=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=yH()-c),this.convertAndCacheOnCPU(e,g)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:a,slice:o,dtype:i,complexTensorInfos:r,isPacked:s}=t;if(null!=o){let t;t=s?new Yae(a,Xae):new wae(a,Xae);const n=this.runWebGLProgram(t,[{dataId:e,shape:a,dtype:i}],i),o=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),o}if(null!=n)return this.convertAndCacheOnCPU(e);if(nM().getBool("DEBUG")&&!nM().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===nM().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,g=null;if("complex64"!==i&&nM().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);g=this.gpgpu.createBufferFromTexture(t.texture.texture,...kee(a))}if(this.pendingRead.set(e,[]),"complex64"!==i&&await this.gpgpu.createAndWaitForFence(),"complex64"===i){const e=await Promise.all([this.read(r.real.dataId),this.read(r.imag.dataId)]);c=wO(e[0],e[1])}else if(null==g)c=this.getValuesFromTexture(e);else{const e=bX(a);c=this.gpgpu.downloadFloat32MatrixFromBuffer(g,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=g){const e=this.gpgpu.gl;Wee(e,(()=>e.deleteBuffer(g)))}const u=this.convertAndCacheOnCPU(e,c),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach((e=>e(u))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&RJ().removeDataId(e,this),this.pendingDeletes--),u}readToGPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.texData.get(e),{values:a,shape:o,slice:i,dtype:r,isPacked:s,texture:l}=n;if("complex64"===r)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){let n;n=s?new Yae(o,Xae):new wae(o,Xae);const a=this.runWebGLProgram(n,[{dataId:e,shape:o,dtype:r}],r),i=this.readToGPU(a,t);return this.disposeIntermediateTensorInfo(a),i}if(null==l)throw null!=a?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),g=RJ().makeTensorFromTensorInfo(c),u=this.texData.get(c.dataId);return Object.assign({tensorRef:g},u.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>SH(e)));return NY(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return NY(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!Vee(n))throw nM().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:a}=this.texData.get(e),o=bX(t);if(nM().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),a=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(a.texture.texture,...kee(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(n),i}const i=nM().getBool("WEBGL_PACK")&&!0===a,r=i?rte(t):t,s=i?new Qte(r):new _te(r),l=this.runWebGLProgram(s,[{shape:r,dtype:n,dataId:e}],"float32"),c=this.texData.get(l.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(l),g}timerAvailable(){return nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let a=!1;null==this.programTimersStack?(this.programTimersStack=n,a=!0):this.activeTimers.push(n),this.activeTimers=n,e();const o=GH(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),i=GH(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,a&&(this.programTimersStack=null);const r={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(o);r.kernelMs=mX(e),r.getExtraProfileInfo=()=>e.map(((e,t)=>({name:i[t],ms:e}))).map((e=>"".concat(e.name,": ").concat(e.ms))).join(", ")}else r.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,r})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:yH(),endMs:null}}endTimer(e){return nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=yH(),e)}async getQueryTime(e){if(nM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:a,usage:o,isPacked:i,slice:r}=this.texData.get(e),s=r&&r.origDataId||e,l=this.dataRefCount.get(s);l>1?this.dataRefCount.set(s,l-1):(this.dataRefCount.delete(s),null!=t&&(this.numBytesInGPU-=this.computeBytes(a,n),this.textureManager.releaseTexture(t,a,o,i)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dae;return nM().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&bX(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){yF("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return zae(e.shape,t)}packedUnaryOp(e,t,n){const a=new Yae(e.shape,t),o=this.compileAndRun(a,[e],n);return RJ().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=aae(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(nM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Rae,e.dtype);const t=new wae(e.shape,Rae),n=this.compileAndRun(t,[e]);return RJ().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let a;if("string"===t&&null!=n&&n.length>0&&TX(n[0])){const o=n.map((e=>vH(e)));a=this.write(o,e,t)}else a=this.write(n,e,t);return this.texData.get(a).usage=null,{dataId:a,shape:e,dtype:t}}makeOutput(e,t,n){return RJ().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new Lae(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new Aae(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[ote(e.shape),...ite(e.shape)],a={dtype:e.dtype,shape:n,dataId:e.dataId},o=[ote(t),...ite(t)],i=new vae(o,n),r=[n],s=this.runWebGLProgram(i,[a],e.dtype,r,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:a,shape:o,dtype:i}=n;if(null!=t){IX(bX(o)<=t[0]*t[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const r=rte(o);let s;s=a?new Ote(r):new Pte(r);const l=[null!==t&&void 0!==t?t:kee(r)];return{dtype:i,shape:o,dataId:this.runWebGLProgram(s,[{shape:r,dtype:i,dataId:e}],i,l,!0,t).dataId}}runWebGLProgram(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;const r=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(r.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===xee.DENSE){const t=null!==i&&void 0!==i?i:kee(e.outputShape);s.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===bX(r.shape))return s.values=BX(r.dtype,0),r;const l=[],c=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&bX(t.shape)<=nM().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!cte(n.shape,t.shape)){const e=t,a=t.shape;t.shape=n.shape,t=this.packedReshape(t,a),l.push(t),n=this.texData.get(t.dataId),e.shape=a}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(r.dataId);const g={shape:r.shape,texData:s,isUniform:!1},u=function(e,t,n){let a="";t.concat(n).forEach((t=>{const o=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const i=t.texData.texShape,{useSqueezeShape:r,uniformShape:s,keptDims:l}=Yte(e.packedInputs,t.shape,i);let c="",g="",u="";if(1===s.length&&e.packedInputs){const e=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];c="".concat(e[0]>1,"_").concat(e[1]>1)}else if(2!==s.length||e.packedInputs){if(s.length>2&&!e.packedInputs){const e=LX(s);u="".concat(e[0]===i[1],"_").concat(e[e.length-1]===i[1])}}else g="".concat(s[0]>1,"_").concat(s[1]>1);const d=t.shape.length,h=2===s.length&&AX(t.shape,i),p=1===bX(t.shape),m=qL(t.shape,n.shape),I=!e.packedInputs&&d===n.shape.length&&AX(i,n.texData.texShape),C=e.packedInputs||s.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);a+="".concat(d,"_").concat(I,"_").concat(r?l:"","_").concat(s.length,"_").concat(p,"_").concat(m,"_").concat(h,"_").concat(c,"_").concat(g,"_").concat(u,"_").concat(C,"_").concat(o)}else{const e=t.isUniform?"uniform":t.texData.texShape;a+="".concat(t.shape,"_").concat(e,"_").concat(o)}}));const o=e.userCode;let i=e.constructor.name;return i+="_"+a+"_"+o+"".concat(nM().getNumber("WEBGL_VERSION")),i}(e,c,g),d=this.getAndSaveBinary(u,(()=>function(e,t,n,a){const o=n.map(((e,n)=>{const a={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(a.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:a}})),i=o.map((e=>e.shapeInfo)),r={logicalShape:a.shape,texShape:a.texData.texShape,isUniform:!1,isPacked:a.texData.isPacked,flatOffset:null},s=Wte(o,r,t),l=Tee(e.gl,s),c=e.createProgram(l);return nM().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:r,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:l,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:r},Kte(e,t,c)))}(this.gpgpu,e,c,g))),h=null!=this.activeTimers;let p;h&&(p=this.startTimer()),nM().get("ENGINE_COMPILE_ONLY")||function(e,t,n,a,o){t.program.enableShapeUniforms||(Dte(t.inShapeInfos,n),Dte([t.outShapeInfo],[a]));const i=a.texData.texture,r=a.texData.texShape;a.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,r[0],r[1]):e.setOutputMatrixTexture(i.texture,r[0],r[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===nM().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<n.length;++l){const a=n[l],{uniform:o,offset:i,shape:r,texShape:s}=t.variablesLocations[l];if(r){const{uniformShape:n}=Yte(t.program.packedInputs,a.shape,a.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(r,new Int32Array(n));break;case 2:e.gl.uniform2iv(r,new Int32Array(n));break;case 3:e.gl.uniform3iv(r,new Int32Array(n));break;case 4:e.gl.uniform4iv(r,new Int32Array(n))}}if(s&&e.gl.uniform2i(s,a.texData.texShape[0],a.texData.texShape[1]),null!=o){if(a.isUniform){if(bX(a.shape)<2)e.gl.uniform1f(o,a.uniformValues[0]);else{let t=a.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(o,t)}continue}null!=a.texData.slice&&null!=i&&e.gl.uniform1i(i,a.texData.slice.flatOffset),e.setInputMatrixTexture(a.texData.texture.texture,o,l)}}const s=t.outShapeLocation;if(s)switch(a.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(a.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(a.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(a.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(a.shape))}if(t.outShapeStridesLocation){const n=LX(a.shape);switch(a.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,a.texData.texShape[0],a.texData.texShape[1]),t.program.customUniforms&&o)for(let l=0;l<t.program.customUniforms.length;++l){const n=t.program.customUniforms[l],a=t.customUniformLocations[l],i=o[l];if("float"===n.type)e.gl.uniform1fv(a,i);else if("vec2"===n.type)e.gl.uniform2fv(a,i);else if("vec3"===n.type)e.gl.uniform3fv(a,i);else if("vec4"===n.type)e.gl.uniform4fv(a,i);else if("int"===n.type)e.gl.uniform1iv(a,i);else if("ivec2"===n.type)e.gl.uniform2iv(a,i);else if("ivec3"===n.type)e.gl.uniform3iv(a,i);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(a,i)}}e.executeProgram()}(this.gpgpu,d,c,g,a),l.forEach((e=>this.disposeIntermediateTensorInfo(e))),h&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const m=nM().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const e=yH();e-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!nM().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){const e=this.unpackTensor(r);return this.disposeIntermediateTensorInfo(r),e}return r}compileAndRun(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,a,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(nM().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=VJ((()=>{if(!nM().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=nM().getBool("DEBUG");nM().set("DEBUG",!1);const t=this.abs(Az(1e-8)).dataSync()[0];if(nM().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:a,values:o,texture:i,usage:r,isPacked:s}=t;if(null!=i)return;const l=null!=this.activeTimers;let c;l&&(c=yH());let g=t.texShape;if(null==g&&(g=ste(n,s),t.texShape=g),null!=o){const e=rte(n);let i,r=g[1],u=g[0];const d=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(s||!d)&&([r,u]=Bee(g[0],g[1])),i=s?new $te(e,d):new qte(e,d);const h=d?[u,r]:g,p=this.makeTensorInfo(h,a),m=this.texData.get(p.dataId);m.usage=d?Gee.PIXELS:Gee.UPLOAD,m.texShape=h,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),r,u,o);const I=[[u,r]],C=this.runWebGLProgram(i,[p],a,I,!0),f=this.texData.get(C.dataId);t.texShape=f.texShape,t.isPacked=f.isPacked,t.usage=f.usage,nM().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(t.texture=f.texture,t.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(p),l&&(this.uploadWaitMs+=yH()-c)}else{const e=this.acquireTexture(g,r,a,s);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:a}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype ".concat(t))}(t,a)),n.values}acquireTexture(e,t,n,a){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(e," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,a)}computeBytes(e,t){return e[0]*e[1]*XX(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(n){throw n}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await aO(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(Fee(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:n,infLoc:a,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:r,outTexShapeLocation:s}=Kte(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=a,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=r,e.outTexShapeLocation=s}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:a,height:o,width:i,channels:r}=e,s=RJ().backend;if(!s.gpgpu.gl.isTexture(a))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=s.writeTexture(a,t,n,o,i,r);return RJ().makeTensorFromDataId(l,t,n,s)}}function Pae(){nM().set("WEBGL_FORCE_F16_TEXTURES",!0)}Uae.nextDataId=0,mJ()&&TJ("webgl",(()=>new Uae),2);const Oae={forceHalfFloat:Pae},_ae="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class Qae{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=ez(t,n),this.enableShapeUniforms=Ute(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")}}const jae="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class qae{constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ez(t,n);const o=this.outputShape.length;this.enableShapeUniforms=Ute(o);let i="";if(a)if(0===o||1===bX(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          ".concat(Jte(o)," coords = getOutputCoords();\n        "),1===o)this.enableShapeUniforms?i+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":i+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{const e=yae("coords",o);this.enableShapeUniforms?i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[o-2]," + 1) >= outShape[").concat(o," - 2];\n            bool nextColOutOfBounds =\n              (").concat(e[o-1]," + 1) >= outShape[").concat(o," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[o-2]," + 1) >= ").concat(this.outputShape[o-2],";\n            bool nextColOutOfBounds =\n              (").concat(e[o-1]," + 1) >= ").concat(this.outputShape[o-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(i,"\n\n        setOutput(result);\n      }\n    ")}}function $ae(e){const{inputs:t,backend:n}=e,{x:a}=t;return n.incRef(a.dataId),{dataId:a.dataId,shape:a.shape,dtype:a.dtype}}const eoe={kernelName:ST,backendName:"webgl",kernelFunc:$ae};function toe(e){const{inputs:t,backend:n}=e,{real:a,imag:o}=t,i=n.makeTensorInfo(a.shape,"complex64"),r=n.texData.get(i.dataId),s=$ae({inputs:{x:a},backend:n}),l=$ae({inputs:{x:o},backend:n});return r.complexTensorInfos={real:s,imag:l},i}const noe={kernelName:XM,backendName:"webgl",kernelFunc:toe},aoe="return (a < 0.) ? b * a : a;",ooe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const ioe={kernelName:BT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{alpha:i}=a,r=n.makeTensorInfo([],"float32",fH(i,"float32")),s=nM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qae(ooe,o.shape,r.shape):new Qae(aoe,o.shape,r.shape),l=n.runWebGLProgram(s,[o,r],"float32");return n.disposeIntermediateTensorInfo(r),l}},roe="return (a < 0.) ? b * a : a;",soe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const loe={kernelName:uE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:a,alpha:o}=t,i=nM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qae(soe,a.shape,o.shape):new Qae(roe,a.shape,o.shape);return n.runWebGLProgram(i,[a,o],"float32")}},coe="if (isnan(x)) return x;";function goe(e){let{opSnippet:t,packedOpSnippet:n,cpuKernelImpl:a,dtype:o}=e;return e=>{let{inputs:i,backend:r}=e;const{x:s}=i,l=r,c=o||s.dtype;if(l.shouldExecuteOnCPU([s])&&null!=a){const e=l.texData.get(s.dataId),t=a(e.values,c);return l.makeTensorInfo(s.shape,c,t)}let g;return g=nM().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new Yae(s.shape,n):new wae(s.shape,t),l.runWebGLProgram(g,[s],c)}}function uoe(e){let{opSnippet:t,packedOpSnippet:n,checkOutOfBounds:a=!1,supportsComplex:o=!1,cpuKernelImpl:i,dtype:r}=e;return e=>{let{inputs:s,backend:l}=e;const{a:c,b:g}=s,u=l;if(o&&"complex64"===c.dtype){const e=u.texData.get(c.dataId),n=u.texData.get(g.dataId),[a,o]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,a]=e,o={dataId:n.dataId,dtype:n.dtype,shape:c.shape},i={dataId:a.dataId,dtype:a.dtype,shape:g.shape},r=new Qae(t,c.shape,g.shape);return u.runWebGLProgram(r,[o,i],jH(n.dtype,a.dtype))})),i=toe({inputs:{real:a,imag:o},backend:u});return u.disposeIntermediateTensorInfo(a),u.disposeIntermediateTensorInfo(o),i}const d=r||jH(c.dtype,g.dtype);if(("string"===c.dtype||"string"===g.dtype||u.shouldExecuteOnCPU([c,g]))&&null!=i){const e=u.texData.get(c.dataId).values,t=u.texData.get(g.dataId).values,n="string"===c.dtype?l_(e):e,a="string"===c.dtype?l_(t):t,[o,r]=i(c.shape,g.shape,n,a,d),s=u.makeTensorInfo(r,d);return u.texData.get(s.dataId).values=o,s}let h;return h=nM().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new qae(n,c.shape,g.shape,a):new Qae(t,c.shape,g.shape),u.runWebGLProgram(h,[c,g],d)}}function doe(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?Tae:Bae;if("relu"===e)return t?Fae:Vae;if("elu"===e)return t?Eae:Wae;if("relu6"===e)return t?Hae:Nae;if("prelu"===e)return t?soe:roe;if("leakyrelu"===e)return t?ooe:aoe;if("sigmoid"===e)return t?Jae:Mae;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}class hoe{constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Ute(this.outputShape.length);const c=a?e[1]:e[2],g=Math.ceil(c/2),u=a?"i * 2, rc.y":"rc.y, i * 2",d=o?"rc.z, i * 2":"i * 2, rc.z",h=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",I="";r&&(m=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):l?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),I="result = activation(result);");const C=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let f="rc.x",b="rc.x";e[0]<t[0]?f="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(b="imod(rc.x, ".concat(t[0],")")),this.userCode="\n      ".concat(m,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(g,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(f,";\n        int batchB = ").concat(b,";\n        for (int i = 0; i < ").concat(g,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(u,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(p[0],");\n          result += (").concat(h[1]," * ").concat(p[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(C,"\n\n        ").concat(I,"\n\n        setOutput(result);\n      }\n    ")}}const poe={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class moe{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ez(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")}}const Ioe="return a * b;";function Coe(e){const{inputs:t,backend:n}=e,{a:a,b:o}=t,i=jH(a.dtype,o.dtype);if("complex64"===a.dtype){const e=n.texData.get(a.dataId),t=n.texData.get(o.dataId),i=new moe(poe.REAL,a.shape,o.shape),r=new moe(poe.IMAG,a.shape,o.shape),s=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:a.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:o.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:o.shape}],l=n.runWebGLProgram(i,s,"float32"),c=n.runWebGLProgram(r,s,"float32"),g=toe({inputs:{real:l,imag:c},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),g}if(n.shouldExecuteOnCPU([a,o])){const e=n.texData.get(a.dataId),t=n.texData.get(o.dataId),[r,s]=Une(a.shape,o.shape,e.values,t.values,i),l=n.makeTensorInfo(s,i);return n.texData.get(l.dataId).values=r,l}let r;return r=nM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qae(Ioe,a.shape,o.shape):new Qae(Ioe,a.shape,o.shape),n.runWebGLProgram(r,[a,o],i)}const foe={kernelName:eE,backendName:"webgl",kernelFunc:Coe};function boe(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{shape:i}=a,r=n,s=bX(o.shape),l=ZX(i,s),c=bX(l);IX(s===c,(()=>"The new shape (".concat(l,") has ").concat(c," elements and the old shape (").concat(o.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")));const g=r.texData.get(o.dataId);return!g.isPacked||cte(o.shape,l)||null!==g.texture&&cte(g.shape,l)?(r.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype}):function(e,t,n){const a=[ote(e.shape),...ite(e.shape)],o={dtype:e.dtype,shape:a,dataId:e.dataId},i=[ote(t),...ite(t)],r=new vae(i,a),s=[a],l=n.runWebGLProgram(r,[o],e.dtype,s,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}(o,l,r)}const yoe={kernelName:yE,backendName:"webgl",kernelFunc:boe};class Aoe{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:a,inSize:o,outSize:i}=e;this.outputShape=[a,i];const r=4*Math.floor(n/4),s=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l="sumValue += dot(values * ".concat(vX(e)?e.toPrecision(2):e,", ones);")}let c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(c,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(r,";\n        if (").concat(1===s,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===s,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===s,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")}}class voe{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:a,inSize:o,outSize:i}=e;this.outputShape=[a,i];let r="0.0",s="";"prod"===t?r="1.0":"min"===t?(r="1.0 / 1e-20",s="min"):"max"===t&&(r="-1.0 / 1e-20",s="max");let l="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const c=4*Math.floor(n/4),g=n%4;let u="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(s,"(values, minMaxValue);\n        if (").concat("min"===t," || ").concat("max"===t,") {\n          minMaxValue = ").concat(s,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===t?(r="1.0",u="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(r="0.0",u="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(r,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(r,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(c,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(u,"\n        }\n\n        int inIdx = inOffset + ").concat(c,";\n        if (").concat(1===g,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(u,"\n        } else if (").concat(2===g,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(u,"\n        } else if (").concat(3===g,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(u,"\n        }\n        setOutput(").concat(l,");\n      }\n    ")}}function Soe(e,t,n,a){const o=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],a=dO(n);t.push({inSize:n,windowSize:a,outSize:Math.ceil(n/a)})}return t}(e.shape);let i=e;for(let r=0;r<o.length;r++){const{inSize:s,windowSize:l,outSize:c}=o[r];let g,u;g="mean"===n?0===r?new Aoe({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:c},s):new Aoe({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:c}):new voe({windowSize:l,inSize:s,batchSize:e.shape[0],outSize:c},n),u=i,i=a.runWebGLProgram(g,[i],t),u.dataId!==e.dataId&&a.disposeIntermediateTensorInfo(u)}return i}class xoe{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;const a=Jte(this.rank),o=function(e){const t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],a=new Array(t);for(let o=0;o<e.length;o++)a[e[o]]=n[o];return a.join()}(t);this.userCode="\n    void main() {\n      ".concat(a," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}}class Goe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let c=0;c<n.length;c++)n[c]=e[t[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));const a=Jte(this.rank),o=bae("rc",this.rank),i=new Array(this.rank);for(let c=0;c<t.length;c++)i[t[c]]=o[c];const r="vec2(".concat(i.slice(-2).join(),")"),s="++".concat(o[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(i.join(),"), ").concat(r,")");this.userCode="\n    void main() {\n      ".concat(a," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(l,";\n      if(").concat(s,") {\n        result[1] = ").concat(l,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(l,";\n        if(").concat(s,") {\n          result[3] = ").concat(l,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}}function Zoe(e,t,n){const a=nM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Goe(e.shape,t):new xoe(e.shape,t);return n.runWebGLProgram(a,[e],e.dtype)}function woe(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a;return function(e,t,n,a){const o=t,i=e.shape.length,r=wX(o,e.shape);let s=r;const l=mz(s,i),c=null!=l;let g=e;c&&(g=Zoe(e,l,a),s=Cz(s.length,i)),pz("sum",s,i);const[u,d]=dz(g.shape,s);let h=u;n&&(h=hz(u,r));const p=bX(d),m=boe({inputs:{x:g},attrs:{shape:[bX(e.shape)/p,p]},backend:a}),I=Soe(m,qH(e.dtype),"sum",a),C=boe({inputs:{x:I},attrs:{shape:h},backend:a});return a.disposeIntermediateTensorInfo(m),a.disposeIntermediateTensorInfo(I),c&&a.disposeIntermediateTensorInfo(g),C}(o,i,r,n)}const koe={kernelName:YE,backendName:"webgl",kernelFunc:woe};function Boe(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{perm:i}=a,r=n,s=o.shape.length,l=new Array(s);for(let g=0;g<l.length;g++)l[g]=o.shape[i[g]];let c;if(r.shouldExecuteOnCPU([o])){const e=r.texData.get(o.dataId).values,t=Cae(e,o.shape,o.dtype,i,l);c=r.makeTensorInfo(l,o.dtype);r.texData.get(c.dataId).values=t}else c=Zoe(o,i,r);return c}const Roe={kernelName:cF,backendName:"webgl",kernelFunc:Boe},Woe=1e3;function Voe(e){let{a:t,b:n,transposeA:a,transposeB:o,backend:i,bias:r=null,preluActivationWeights:s=null,leakyreluAlpha:l=0,activation:c=null}=e;const g=t.shape.length,u=n.shape.length,d=a?t.shape[g-2]:t.shape[g-1],h=o?n.shape[u-1]:n.shape[u-2],p=a?t.shape[g-1]:t.shape[g-2],m=o?n.shape[u-2]:n.shape[u-1],I=t.shape.slice(0,-2),C=n.shape.slice(0,-2),f=bX(I),b=bX(C),y=ez(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([p,m]);IX(d===h,(()=>"Error in matMul: inner shapes (".concat(d,") and (").concat(h,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(a," and transposeB=").concat(o," must match.")));const A=a?[f,d,p]:[f,p,d],v=o?[b,m,h]:[b,h,m],S=boe({inputs:{x:t},backend:i,attrs:{shape:A}}),x=boe({inputs:{x:n},backend:i,attrs:{shape:v}}),G=[S,x],Z=Math.max(f,b),w=a?S.shape[1]:S.shape[2],k=null!=r,B=null!=s,R="leakyrelu"===c,W=null!=c?doe(c,!0):null;let V;if((1===p||1===m)&&w>Woe&&!1===(k||B||R||null!=W)){let e=S,t=x;a&&(e=Boe({inputs:{x:S},backend:i,attrs:{perm:[0,2,1]}}),G.push(e)),o&&(t=Boe({inputs:{x:x},backend:i,attrs:{perm:[0,2,1]}}),G.push(t));const n=1===m;let r=e;1!==m&&(r=boe({inputs:{x:e},backend:i,attrs:{shape:[Z,w,1]}}),G.push(r));const s=1===m?2:1;let l=t;n&&(l=boe({inputs:{x:t},backend:i,attrs:{shape:[Z,1,w]}}),G.push(l));const c=Coe({inputs:{a:r,b:l},backend:i});V=woe({inputs:{x:c},backend:i,attrs:{axis:s,keepDims:!0}}),G.push(c)}else{const e=jH(t.dtype,n.dtype),c=new hoe(A,v,[Z,p,m],a,o,k,W,B,R),g=[S,x];if(null!=r&&g.push(r),B&&g.push(s),R){const e=i.makeTensorInfo([],"float32",fH(l,"float32"));g.push(e),G.push(e)}V=i.runWebGLProgram(c,g,e)}const N=boe({inputs:{x:V},backend:i,attrs:{shape:y}});G.push(V);for(const X of G)i.disposeIntermediateTensorInfo(X);return N}const Noe={kernelName:CF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{a:o,b:i,bias:r,preluActivationWeights:s}=t,{transposeA:l,transposeB:c,activation:g,leakyreluAlpha:u}=a;return Voe({a:o,b:i,transposeA:l,transposeB:c,backend:n,bias:r,preluActivationWeights:s,leakyreluAlpha:u,activation:g})}},Xoe="return abs(x);";const Moe={kernelName:sM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:a}=t;if(n.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){const e=n.texData.get(a.dataId),t=aae(e.values);return n.makeTensorInfo(a.shape,a.dtype,t)}let o;return o=nM().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Yae(a.shape,Xoe):new wae(a.shape,Xoe),n.runWebGLProgram(o,[a],a.dtype)}},Toe=goe({opSnippet:kae+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),Eoe={kernelName:lM,backendName:"webgl",kernelFunc:Toe},Foe=goe({opSnippet:kae+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),Hoe={kernelName:cM,backendName:"webgl",kernelFunc:Foe},Joe="return a + b;",Yoe=uoe({opSnippet:Joe,packedOpSnippet:Joe,supportsComplex:!0,cpuKernelImpl:xne}),Loe={kernelName:gM,backendName:"webgl",kernelFunc:Yoe};class zoe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>"T".concat(t)));const n=[];this.variableNames.forEach((e=>{n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));const a=this.variableNames.map((e=>"v".concat(e))).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}}class Koe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>"T".concat(t)));const n=[];this.variableNames.forEach((e=>{n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));const a=this.variableNames.map((e=>"v".concat(e))).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}}const Doe={kernelName:uM,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:a}=t,o=n;if(1===o.length)return $ae({inputs:{x:o[0]},backend:a});if(o.length>nM().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(o.length/2),n=e({inputs:o.slice(0,t),backend:a}),i=e({inputs:o.slice(t),backend:a});return e({inputs:[n,i],backend:a})}const i=o.map((e=>e.dtype)).reduce(((e,t)=>jH(e,t))),r=o.map((e=>e.shape)),s=nM().getBool("WEBGL_PACK")?new Koe(o[0].shape,r):new zoe(o[0].shape,r);return a.runWebGLProgram(s,o,i)}};const Uoe={kernelName:dM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a,s=o.shape.length,l=wX(i,o.shape);let c=l;const g=mz(c,s);let u=o;null!=g&&(u=Boe({inputs:{x:o},backend:n,attrs:{perm:g}}),c=Cz(c.length,s)),pz("all",c,s);const[d,h]=dz(u.shape,c),p=boe({inputs:{x:u},backend:n,attrs:{shape:[-1,bX(h)]}}),m=Soe(p,p.dtype,"all",n);let I;if(r){I=boe({inputs:{x:m},backend:n,attrs:{shape:hz(d,l)}})}else I=boe({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=g&&n.disposeIntermediateTensorInfo(u),I}};const Poe={kernelName:hM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a,s=o.shape.length,l=wX(i,o.shape);let c=l;const g=mz(c,s);let u=o;null!=g&&(u=Boe({inputs:{x:o},backend:n,attrs:{perm:g}}),c=Cz(c.length,s)),pz("any",c,s);const[d,h]=dz(u.shape,c),p=boe({inputs:{x:u},backend:n,attrs:{shape:[-1,bX(h)]}}),m=Soe(p,p.dtype,"any",n);let I;if(r){I=boe({inputs:{x:m},backend:n,attrs:{shape:hz(d,l)}})}else I=boe({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=g&&n.disposeIntermediateTensorInfo(u),I}};class Ooe{constructor(e,t,n){this.variableNames=["A"];const{windowSize:a,batchSize:o,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const r="max"===t?">":"<",s=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(s,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(r," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")}}class _oe{constructor(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,IX(e.length>2,(()=>"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")));const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),a||this.variableNames.push("bestIndicesA");const r=this.outputShape,s=r.length,l=Jte(s),c=yae("coords",s);let g,u;if(1===i){u=s+1;const e=Jte(u);g="\n        ".concat(e," sourceLocR = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[s-1],";\n        ").concat(e," sourceLocG = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[s-2],";\n        ").concat(e," sourceLocA = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[s-1],";\n        ").concat(e," sourceLocB = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[s-2],";")}else u=s,g="\n        ".concat(l," sourceLocR = coords;\n        ++").concat(c[s-1],";\n        ").concat(l," sourceLocG = coords;\n        ++").concat(c[s-2],";\n        ").concat(l," sourceLocA = coords;\n        --").concat(c[s-1],";\n        ").concat(l," sourceLocB = coords;\n        --").concat(c[s-2],";");const d=["x","y","z","w","u","v"].slice(0,u),h="."+d[u-1],p=d.map((e=>"int "+e)),m=yae("sourceLocR",u-1).concat("inIdx.r"),I=yae("sourceLocG",u-1).concat("inIdx.g"),C=yae("sourceLocB",u-1).concat("inIdx.b"),f=yae("sourceLocA",u-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",y=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(I.join(),"),\n                             getBestIndicesAChannel(").concat(C.join(),"),\n                             getBestIndicesAChannel(").concat(f.join(),")));"),A="vec4(\n            getAChannel(".concat(m.join(),"),\n            hasNextCol ? getAChannel(").concat(I.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(C.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(f.join(),") : 0.)"),v=a?"":"\n      float getBestIndicesAChannel(".concat(p.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(p.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(v,"\n      void main() {\n        ").concat(l," coords = getOutputCoords();\n        bool hasNextCol = ").concat(c[s-1]," < ").concat(r[s-1]-1,";\n        bool hasNextRow = ").concat(c[s-2]," < ").concat(r[s-2]-1,";\n        ").concat(g,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(h,", sourceLocG").concat(h,",\n          sourceLocB").concat(h,", sourceLocA").concat(h,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(A,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(y,"\n          vec4 candidate = ").concat(A,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(b,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}}function Qoe(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=t.shape[0],i=t.shape[1];null!=a&&(o=a.shape[0],i=a.shape[1]);const r=dO(i),s={windowSize:r,inSize:i,batchSize:o,outSize:Math.ceil(i/r)},l=new Ooe(s,n,null==a),c=[t];null!=a&&c.push(a);const g=e.runWebGLProgram(l,c,"int32");if(1===g.shape[1])return g;const u=Qoe(e,t,n,g);return e.disposeIntermediateTensorInfo(g),u}function joe(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=null!=a?a.shape:t.shape,i=dO(o[o.length-1]),r=new _oe(o,i,n,null==a),s=null==a?[t]:[t,a],l=e.runWebGLProgram(r,s,"int32");if(l.shape.length===t.shape.length){const a=joe(e,t,n,l);return e.disposeIntermediateTensorInfo(l),a}return l}function qoe(e,t,n,a){const o=[n];if(pz("arg"+a.charAt(0).toUpperCase()+a.slice(1),o,t.shape.length),!nM().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],i=e.texData.get(t.dataId);let r=t;null!==i&&i.isPacked&&(r=e.unpackTensor(t),n.push(r));const[s,l]=dz(r.shape,o),c=bX(l),g=boe({inputs:{x:r},backend:e,attrs:{shape:[-1,c]}});n.push(g);const u=Qoe(e,g,a);n.push(u);const d=boe({inputs:{x:u},backend:e,attrs:{shape:s}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),d}return joe(e,t,a)}const $oe={kernelName:pM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i}=a;let r=wX(i,o.shape);const s=mz(r,o.shape.length);let l=o;const c=[];null!=s&&(l=Boe({inputs:{x:o},backend:n,attrs:{perm:s}}),c.push(l),r=Cz(r.length,l.shape.length)),pz("argMax",[r[0]],l.shape.length);const g=qoe(n,l,r[0],"max");return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}};const eie={kernelName:mM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i}=a;let r=wX(i,o.shape);const s=mz(r,o.shape.length);let l=o;const c=[];null!=s&&(l=Boe({inputs:{x:o},backend:n,attrs:{perm:s}}),c.push(l),r=Cz(r.length,l.shape.length)),pz("argMin",[r[0]],l.shape.length);const g=qoe(n,l,r[0],"min");return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}},tie=goe({opSnippet:kae+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),nie={kernelName:IM,backendName:"webgl",kernelFunc:tie},aie=goe({opSnippet:kae+"return log(x + sqrt(x * x + 1.0));"}),oie={kernelName:CM,backendName:"webgl",kernelFunc:aie},iie=goe({opSnippet:kae+"\n  return atan(x);\n"}),rie={kernelName:fM,backendName:"webgl",kernelFunc:iie},sie=uoe({opSnippet:_ae+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+jae+"\n  return result;\n"}),lie={kernelName:yM,backendName:"webgl",kernelFunc:sie},cie=goe({opSnippet:kae+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),gie={kernelName:bM,backendName:"webgl",kernelFunc:cie};class uie{constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,r=e.strideHeight,s=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,g=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t,m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),I="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d");let C="0.0";if(p||(C="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec2 strides = ivec2(".concat(r,", ").concat(s,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(h,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(g,";\n              wR += ").concat(l,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(u,";\n                wC += ").concat(c,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(t," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?o?m:I:"wR * ".concat(u," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let f="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===t&&(f="avgValue / max(count, 1.0)");const b=4*Math.floor(i/4),y=i%4,A="\n      if (".concat(p,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(r,", ").concat(s,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(h,");\n      const float initializationValue = ").concat(C,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(C,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(g,";\n            wR += ").concat(l,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(b,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(c,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              getValue(batch, xR, xC + 3 * ").concat(c,", d)\n            );\n\n            ").concat(A,"\n          }\n\n          int xC = xCCorner + ").concat(b,";\n          if (").concat(1===y,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(A,"\n          } else if (").concat(2===y,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(A,"\n          } else if (").concat(3===y,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              initializationValue\n            );\n\n            ").concat(A,"\n          }\n        }\n        setOutput(").concat(f,");\n      }\n    ")}}class die{constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,r=e.strideDepth,s=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,g=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,I=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const f="avg"===t;let b="0.0";if(f||(b="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(r,", ").concat(s,", ").concat(l,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(I,", ").concat(C,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(c,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(h,";\n                wR += ").concat(g,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(p,";\n                  wC += ").concat(u,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(t," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?o?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(h," * ").concat(p," +\n                      wR * ").concat(p," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let y="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===t&&(y="avgValue / max(count, 1.0)");const A=4*Math.floor(i/4),v=i%4,S="\n      if (".concat(f,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(r,", ").concat(s,", ").concat(l,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(I,", ").concat(C,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(c,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(g,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(A,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(u,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(u,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(u,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(u,", ch)\n              );\n\n              ").concat(S,"\n            }\n\n            int xC = xCCorner + ").concat(A,";\n            if (").concat(1===v,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(2===v,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(u,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(3===v,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(u,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(u,", ch),\n                initializationValue\n              );\n\n              ").concat(S,"\n            }\n          }\n        }\n        setOutput(").concat(y,");\n      }\n    ")}}const hie={kernelName:AM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t;Ate(o,"avgPool");const{filterSize:i,strides:r,pad:s,dimRoundingMode:l}=a;IX(gL(r,1),(()=>"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(1,"'")));const c=eL(o.shape,i,r,1,s,l);if(1===c.filterWidth&&1===c.filterHeight&&AX(c.inShape,c.outShape))return $ae({inputs:{x:o},backend:n});const g=new uie(c,"avg",!1);return n.runWebGLProgram(g,[o],"float32")}};const pie={kernelName:SM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{filterSize:i,strides:r,pad:s,dimRoundingMode:l,dataFormat:c}=a,g=tL(o.shape,i,r,[1,1,1],s,l,c),u=new die(g,"avg",!1);return n.runWebGLProgram(u,[o],"float32")}};class mie{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,r=e.dilationWidth,s=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.top,g=l-1-e.padInfo.left,u=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(c,", ").concat(g,");\n      const float avgMultiplier = float(").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(s,";\n            wR += ").concat(i,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(l,";\n            wC+= ").concat(r,") {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class Iie{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,o=e.strideDepth,i=e.strideHeight,r=e.strideWidth,s=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,g=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=g-1-e.padInfo.front,p=u-1-e.padInfo.top,m=d-1-e.padInfo.left,I=1/(t*n*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(p,", ").concat(m,");\n      const float avgMultiplier = float(").concat(I,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(g,";\n            wD += ").concat(s,") {\n          float dyD = float(dyDCorner + wD) / ").concat(o,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(l,") {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(c,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const Cie={kernelName:xM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i}=t,r=i,{filterSize:s,strides:l,pad:c,dimRoundingMode:g}=a,u=tL(r.shape,s,l,[1,1,1],c,g),d=new Iie(u);return n.runWebGLProgram(d,[o],r.dtype)}};const fie={kernelName:vM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i}=t,r=i;Ate([o,i],"avgPoolGrad");const{filterSize:s,strides:l,pad:c}=a,g=eL(r.shape,s,l,1,c),u=new mie(g);return n.runWebGLProgram(u,[o],r.dtype)}};const bie={kernelName:GM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{a:o,b:i}=t,{transposeA:r,transposeB:s}=a;return Voe({a:o,b:i,transposeA:r,transposeB:s,backend:n})}};class yie{constructor(e,t,n,a,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],ez(e,t),ez(e,n);let r="0.0";null!=a&&(ez(e,a),this.variableNames.push("offset"),r="getOffsetAtOutCoords()");let s="1.0";null!=o&&(ez(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(r,";\n        float scale = ").concat(s,";\n        float inv = scale * inversesqrt(variance + float(").concat(i,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")}}class Aie{constructor(e,t,n,a,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ez(e,t),ez(e,n);let r="vec4(0.0)";null!=a&&(ez(e,a),this.variableNames.push("offset"),r="getOffsetAtOutCoords()");let s="vec4(1.0)";null!=o&&(ez(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(r,";\n        vec4 scale = ").concat(s,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(i,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")}}const vie={kernelName:fT,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:a}=e;const{x:o,mean:i,variance:r,offset:s,scale:l}=t;IX(i.shape.length===r.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),IX(null==s||i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),IX(null==l||i.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:c}=a;null==c&&(c=.001);const g=[o,i,r];let u=null;null!=s&&(u=s.shape,g.push(s));let d=null;null!=l&&(d=l.shape,g.push(l));const h=nM().getBool("WEBGL_PACK_NORMALIZATION")?new Aie(o.shape,i.shape,r.shape,u,d,c):new yie(o.shape,i.shape,r.shape,u,d,c);return n.runWebGLProgram(h,g,g[0].dtype)}};class Sie{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Jte(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return xie.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);let a;const o=e.map(((e,t)=>"sourceLoc.".concat(xie[t]," = start[").concat(t,"] + coords.").concat(xie[t],";")));a="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(o.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(a,"\n        setOutput(getSource(").concat(n,"));\n      }\n    ")}}const xie=["x","y","z","w","u","v"];class Gie{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Jte(this.rank),n=yae("coords",this.rank),a=yae("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),i="getChannel(getSource(".concat(a.join(),"), ").concat(o,")"),r="\n      result.x = ".concat(i,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(i,";\n        --").concat(a[this.rank-1],";\n      }\n    "),s=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(i,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(i,";\n        }\n      }\n    "),l=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map(((e,t)=>"start[".concat(t,"]"))).join(),");"):e.map(((e,t)=>"".concat(a[t]," = ").concat(n[t]," + start[").concat(t,"];"))).join("\n");this.userCode="\n      void main() {\n        ".concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(l,"\n        vec4 result = vec4(0.);\n        ").concat(r,"\n        ").concat(s,"\n        setOutput(result);\n      }\n    ")}}function Zie(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{begin:i,size:r}=a,[s,l]=QP(o,i,r);if(FP(o,s,l),0===bX(l))return n.makeTensorInfo(l,o.dtype,[]);if(n.shouldExecuteOnCPU([o])||"string"===o.dtype){const e=n.texData.get(o.dataId),t=oae(e.values,s,l,o.shape,o.dtype);return n.makeTensorInfo(l,o.dtype,t)}const{isPacked:c}=n.texData.get(o.dataId),g=OP(o.shape,s,l);if(c||!g){const e=nM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gie(l):new Sie(l),t=[s];return n.runWebGLProgram(e,[o],o.dtype,t)}return n.uploadToGPU(o.dataId),function(e,t,n,a){const o=a.texData.get(e.dataId),i=a.makeTensorInfo(n,e.dtype),r=a.texData.get(i.dataId);Object.assign(r,o),r.refCount=1,r.shape=n,r.dtype=e.dtype;let s=_P(t,LX(e.shape));o.slice&&(s+=o.slice.flatOffset),r.slice={flatOffset:s,origDataId:o.slice&&o.slice.origDataId||e.dataId};const l=a.dataRefCount.get(r.slice.origDataId)||1;return a.dataRefCount.set(r.slice.origDataId,l+1),i}(o,s,l,n)}const wie={kernelName:XE,backendName:"webgl",kernelFunc:Zie},kie={kernelName:ZM,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{blockShape:i,crops:r}=a;IX(o.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const s=i.reduce(((e,t)=>e*t)),l=pO(o.shape,i,s),c=mO(l.length,i.length),g=IO(o.shape,i,s),u=CO(r,i.length),d=fO(g,r,i.length),h=[],p=boe({inputs:{x:o},backend:n,attrs:{shape:l}}),m=Boe({inputs:{x:p},backend:n,attrs:{perm:c}}),I=boe({inputs:{x:m},backend:n,attrs:{shape:g}}),C=Zie({inputs:{x:I},backend:n,attrs:{begin:u,size:d}});return h.push(p),h.push(m),h.push(I),h.forEach((e=>n.disposeIntermediateTensorInfo(e))),C}};const Bie={kernelName:wM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,weights:i}=t,{size:r}=a,s=n.readSync(o.dataId),l=n.readSync(i.dataId),c=Gne(s,l,i.dtype,i.shape,r);return n.makeTensorInfo([r],i.dtype,c)}};const Rie={kernelName:kM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{a:a,b:o}=t,i=nM().getBool("WEBGL_PACK_BINARY_OPERATIONS"),r=nM().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([a,o])||1===r){const e=n.texData.get(a.dataId).values,t=n.texData.get(o.dataId).values,[i,r]=wne(a.shape,o.shape,e,t,a.dtype),s=n.makeTensorInfo(r,a.dtype);return n.texData.get(s.dataId).values=i,s}let s;return s=i?new qae("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",a.shape,o.shape,!1):new Qae("\n  return float(int(a.r) & int(b.r));\n",a.shape,o.shape),n.runWebGLProgram(s,[a,o],a.dtype)}};const Wie={kernelName:RM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:a,s1:o}=t,i=n.readSync(a.dataId),r=n.readSync(o.dataId),s=ez(Array.from(i),Array.from(r));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},Vie=uoe({opSnippet:"return float(a != b);",cpuKernelImpl:One,dtype:"bool"}),Nie={kernelName:nE,backendName:"webgl",kernelFunc:Vie};function Xie(e){const{inputs:t,backend:n}=e,{input:a}=t;return $ae({inputs:{x:n.texData.get(a.dataId).complexTensorInfos.real},backend:n})}const Mie={kernelName:CE,backendName:"webgl",kernelFunc:Xie},Tie="return float(int(x));";const Eie={kernelName:WM,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:a,attrs:o}=t,{x:i}=n,{dtype:r}=o;if("complex64"===r){if("complex64"===i.dtype)return $ae({inputs:{x:i},backend:a});const t=gK(i.shape),n=e({inputs:{x:i},backend:a,attrs:{dtype:"float32"}}),o=toe({inputs:{real:n,imag:t},backend:a});return t.dispose(),a.disposeIntermediateTensorInfo(n),o}if("complex64"===i.dtype){const t=Xie({inputs:{input:i},backend:a}),n=e({inputs:{x:t},backend:a,attrs:{dtype:r}});return a.disposeIntermediateTensorInfo(t),n}if(!NX(i.dtype,r)){const e=$ae({inputs:{x:i},backend:a});return{dataId:e.dataId,shape:e.shape,dtype:r}}if(a.shouldExecuteOnCPU([i])){const e=a.texData.get(i.dataId).values,[t,n,o]=kne(e,i.shape,i.dtype,r);return a.makeTensorInfo(t,n,o)}if("int32"===r)return function(e,t){const n=new wae(e.shape,Tie),a=t.runWebGLProgram(n,[e],"int32");return{dataId:a.dataId,shape:a.shape,dtype:a.dtype}}(i,a);if("bool"===r){const e=a.makeTensorInfo([],"bool",BX("bool",1)),t=Vie({inputs:{a:i,b:e},backend:a});return a.disposeIntermediateTensorInfo(e),t}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(r))}},Fie="return ceil(x);",Hie=goe({opSnippet:Fie,packedOpSnippet:Fie,cpuKernelImpl:Bne}),Jie={kernelName:VM,backendName:"webgl",kernelFunc:Hie};class Yie{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class Lie{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const zie={kernelName:NM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{clipValueMin:i,clipValueMax:r}=a;let s;s=nM().getBool("WEBGL_PACK_CLIP")?new Lie(o.shape):new Yie(o.shape);const l=[[i],[r]];return n.runWebGLProgram(s,[o],o.dtype,l)}};class Kie{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function Die(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const Uie={kernelName:MM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:a}=t,o=n.texData.get(a.dataId),i=new Kie(a.shape),r=[Die(a,o.complexTensorInfos.real),Die(a,o.complexTensorInfos.imag)];return n.runWebGLProgram(i,r,r[0].dtype)}};class Pie{constructor(e){this.outputShape=[],this.outputShape=iO(e,1),this.variableNames=e.map(((e,t)=>"T".concat(t)));const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")];for(let i=1;i<t.length;i++){const e=t[i-1];n.push("else if (yC < ".concat(t[i],") setOutput(getT").concat(i,"(yR, yC-").concat(e,"));"))}const a=t.length,o=t[t.length-1];n.push("else setOutput(getT".concat(a,"(yR, yC-").concat(o,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")}}class Oie{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=iO(e,t);const n=this.outputShape,a=n.length,o=Jte(a),i=yae("coords",a),r=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(((e,t)=>"T".concat(t)));const s=new Array(e.length-1);s[0]=e[0][t];for(let p=1;p<s.length;p++)s[p]=s[p-1]+e[p][t];const l=r[t],c=r.slice(-2),g=r.join();let u="if (".concat(l," < ").concat(s[0],") {\n        return getChannel(\n            getT0(").concat(g,"), vec2(").concat(c.join(),"));\n        }");for(let p=1;p<s.length;p++){const e=s[p-1];u+="\n        if (".concat(l," < ").concat(s[p],"  && ").concat(l," >= ").concat(s[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(_ie(r,l,e),"),\n            vec2(").concat(_ie(c,l,e),"));\n        }")}const d=s.length,h=s[s.length-1];u+="\n        return getChannel(\n          getT".concat(d,"(").concat(_ie(r,l,h),"),\n          vec2(").concat(_ie(c,l,h),"));"),this.userCode="\n      float getValue(".concat(r.map((e=>"int "+e)),") {\n        ").concat(u,"\n      }\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(i,"), 0., 0., 0.);\n\n        ").concat(i[a-1]," = ").concat(i[a-1]," + 1;\n        if (").concat(i[a-1]," < ").concat(n[a-1],") {\n          result.g = getValue(").concat(i,");\n        }\n\n        ").concat(i[a-2]," = ").concat(i[a-2]," + 1;\n        if (").concat(i[a-2]," < ").concat(n[a-2],") {\n          result.a = getValue(").concat(i,");\n        }\n\n        ").concat(i[a-1]," = ").concat(i[a-1]," - 1;\n        if (").concat(i[a-2]," < ").concat(n[a-2]," &&\n            ").concat(i[a-1]," < ").concat(n[a-1],") {\n          result.b = getValue(").concat(i,");\n        }\n        setOutput(result);\n      }\n    ")}}function _ie(e,t,n){const a=e.indexOf(t);return e.map(((e,t)=>t===a?"".concat(e," - ").concat(n):e)).join()}function Qie(e){const{inputs:t,backend:n}=e,{input:a}=t;return $ae({inputs:{x:n.texData.get(a.dataId).complexTensorInfos.imag},backend:n})}const jie={kernelName:GT,backendName:"webgl",kernelFunc:Qie};function qie(e,t,n){const a=e[0].dtype;if("complex64"===a){const a=e.map((e=>Xie({inputs:{input:e},backend:n}))),o=e.map((e=>Qie({inputs:{input:e},backend:n}))),i=qie(a,t,n),r=qie(o,t,n),s=toe({inputs:{real:i,imag:r},backend:n});return a.forEach((e=>n.disposeIntermediateTensorInfo(e))),o.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),s}let o=n.shouldExecuteOnCPU(e);if("string"===a&&(o=!0),o){const o=e.map((e=>{const a=[-1,bX(e.shape.slice(t))];return boe({inputs:{x:e},backend:n,attrs:{shape:a}})})),i=o.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),r=iO(o.map((e=>e.shape)),1),s=1===o[0].shape[0],l=Rne(i,r,a,s),c=iO(e.map((e=>e.shape)),t),g=n.makeTensorInfo(c,a,l);return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}const i=e.filter((e=>bX(e.shape)>0)),r=nM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(1===i.length){const t=r?new wae(e[0].shape,Xae):new Yae(e[0].shape,Xae);return n.runWebGLProgram(t,e,a)}const s=nM().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>s){const e=[];for(let o=0;o<i.length;o+=s){const a=i.slice(o,o+s);e.push(qie(a,t,n))}const a=qie(e,t,n);for(const t of e)n.disposeIntermediateTensorInfo(t);return a}if(r){const e=new Oie(i.map((e=>e.shape)),t);return n.runWebGLProgram(e,i,a)}const{tensors2D:l,outShape:c}=function(e,t,n){const a=iO(e.map((e=>e.shape)),t);return{tensors2D:e.map((e=>boe({inputs:{x:e},attrs:{shape:[-1,bX(e.shape.slice(t))]},backend:n}))),outShape:a}}(i,t,n),g=new Pie(l.map((e=>e.shape))),u=n.runWebGLProgram(g,l,a);l.forEach((e=>n.disposeIntermediateTensorInfo(e)));const d=boe({inputs:{x:u},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(u),d}function $ie(e){const{inputs:t,backend:n,attrs:a}=e,{axis:o}=a,i=wX(o,t[0].shape)[0],r=t.map((e=>e.shape));oO(r,i);const s=iO(t.map((e=>e.shape)),i);if(0===bX(s))return n.makeTensorInfo(s,t[0].dtype,[]);const l=t.filter((e=>bX(e.shape)>0));return 1===l.length?$ae({inputs:{x:l[0]},backend:n}):qie(l,i,n)}const ere={kernelName:TM,backendName:"webgl",kernelFunc:$ie};class tre{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,r=e.padInfo.left,s=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,g=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4,m="channelsLast"===e.dataFormat,I=m?1:2,C=m?2:3,f=m?3:1;let b="",y="";n&&(b=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):o?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),y="result = activation(result);");const A=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      const ivec2 strides = ivec2(").concat(s,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(r,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(f,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(I,"], coords[").concat(C,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(g,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(h,") *\n                    getW(wR, wC, ").concat(h,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(h,", xR, xC) *\n                    getW(wR, wC, ").concat(h,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2),\n                getW(wR, wC, ").concat(h," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1),\n                  getX(batch, xR, xC, ").concat(h," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC),\n                  getX(batch, ").concat(h," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(A,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")}}class nre{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,a=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,r=e.strideWidth,s=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,g=e.filterDepth,u=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(o,", ").concat(i,", ").concat(r,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(g,"; wF++) {\n          int xF = xFCorner + wF * ").concat(s,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(u,"; wR++) {\n            int xR = xRCorner + wR * ").concat(l,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(c,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===p,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(h,") *\n                  getW(wF, wR, wC, ").concat(h,", d2);\n              } else if (").concat(2===p,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===p,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1),\n                  getX(batch, xF, xR, xC, ").concat(h," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2),\n                  getW(wF, wR, wC, ").concat(h," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class are{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ute(this.outputShape.length);const i=e.padInfo.left,r=e.strideWidth,s=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,g=c;let u="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<c;m++)u+="\n           vec4 xTexelC".concat(2*m,";\n           int xTexelC").concat(2*m,"Ready;\n           vec4 xTexelC").concat(2*m+1,";\n           int xTexelC").concat(2*m+1,"Ready;\n           vec4 xC").concat(m,";");u+="\n     for (int r = 0; r < ".concat(l,"; r++) {\n      for (int d1 = 0; d1 < ").concat(e.inChannels,"; d1 += 2) {\n       ");for(let m=0;m<c;m++)u+="\n           xTexelC".concat(2*m," = vec4(0.0);\n           xTexelC").concat(2*m,"Ready = 0;\n           xTexelC").concat(2*m+1," = vec4(0.0);\n           xTexelC").concat(2*m+1,"Ready = 0;\n           xC").concat(m," = vec4(0.0);");u+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let m=0;m<(g+1)/2;m++){const t=2*m;if(u+="\n           xC = xCCorner + ".concat(t*s,";\n           "),1===r){if(t<c&&(i%2===1?(u+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n               "),u+=1===s&&t>0?"\n                 xC".concat(t," = vec4(xTexelC").concat(t-2,".zw, xTexelC").concat(t,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(t," = vec4(previous.zw, xTexelC").concat(t,".xy);\n                   } else {\n                     xC").concat(t," = vec4(0.0, 0.0, xTexelC").concat(t,".xy);\n                   }\n                   ")):u+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xC").concat(t," = xTexelC").concat(t,";\n                 "),t+1<c)){const e=i%2===0?hX(s):s;s%2===0&&i%2===1||s%2!==0&&i%2!==1?(u+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(e,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                     xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(t+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(t+1,"Ready = 1;\n                   }\n                   "),u+=s>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(t+1," = vec4(previous.zw, xTexelC").concat(t+1,".xy);\n                     } else {\n                      xC").concat(t+1," = vec4(0.0, 0.0, xTexelC").concat(t+1,".xy);\n                     }\n                     "):"\n                     xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".xy);\n                     ")):u+=1===e?"\n                     xC".concat(t+1," = xTexelC").concat(t,";\n                     "):"\n                     xCOffset = xC + ".concat(e,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                       xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(t+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(t+1,"Ready = 1;\n                     }\n\n                     xC").concat(t+1," = xTexelC").concat(t+1,";\n                     ")}}else t<c&&(i%2===1?(u+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n               "),t+1<c&&(u+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(t+1," = vec4(xTexelC").concat(t+1,".xy, final.xy);\n                 "))):(u+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(\n                   xTexelC").concat(t,".xy, xTexelC").concat(t+1,".xy);\n               "),t+1<c&&(u+="\n                   xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n                 "))));t<c&&(u+="\n             wTexel = getW(r, ".concat(t,", d1, d2);\n             dotProd += xC").concat(t,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(e.inChannels,") {\n               dotProd += xC").concat(t,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),t+1<c&&(u+="\n               wTexel = getW(r, ".concat(t+1,", d1, d2);\n               dotProd += xC").concat(t+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(e.inChannels,") {\n                 dotProd += xC").concat(t+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}u+="\n     }\n   ",u+="\n     }\n   ",u+="\n     }\n   ";let d="",h="";n&&(d=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(n,"\n         }"):o?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(n,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(n,"\n         }"),h="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(d,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(u,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(p,"\n         ").concat(h,"\n         setOutput(result);\n       }\n     ")}}class ore{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Ute(this.outputShape.length);const{dataFormat:n}=t,a=xte(),o="channelsLast"===n,i=o?1:2,r=o?2:3,s=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {");let l="";for(let c=0;c<=1;c++)for(let e=0;e<=1;e++)l+="\n          blockIndex = rc.z + ".concat(e,";\n          pos = rc.y + ").concat(c,";\n\n          ").concat(s,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(i,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(r,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(o,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(l,"\n\n        ").concat(a.output," = result;\n      }\n    ")}}function ire(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function rre(e){let{x:t,filter:n,convInfo:a,backend:o,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:s=0,activation:l=null}=e;const c=t.shape,g=o.texData.get(t.dataId),u=a.inChannels,d=c[0]*c[1]*c[2],h=a.outChannels,p="channelsLast"===a.dataFormat,m=!1;let I;const C=[];if(null!=r){const e=ire(r.shape,p);null!=e&&(r=boe({inputs:{x:r},backend:o,attrs:{shape:e}}),C.push(r))}if(null!=i){const e=ire(i.shape,p);null!=e&&(i=boe({inputs:{x:i},backend:o,attrs:{shape:e}}),C.push(i))}if((1!==d&&1!==h||!(u>Woe))&&g.isPacked&&p&&null!=g.texture&&c[2]%2!==0&&AX(g.shape.slice(-3),c.slice(-3))){const e=c[0]*c[1]*(c[2]+1),u={dataId:t.dataId,shape:[1,e,a.inChannels],dtype:t.dtype},d=g.shape;g.shape=g.shape.slice(),g.shape[g.shape.length-2]++,IX(cte(g.shape,u.shape),(()=>"packed reshape ".concat(g.shape," to ").concat(u.shape," isn't free")));const h=boe({inputs:{x:n},backend:o,attrs:{shape:[1,a.inChannels,a.outChannels]}});C.push(h);const p=Voe({a:u,b:h,backend:o,transposeA:false,transposeB:m,bias:i,activation:l,preluActivationWeights:r,leakyreluAlpha:s}),f=o.texData.get(p.dataId);IX(f.isPacked,(()=>"batchMatMul result is expected to be packed")),g.shape=d,f.shape=a.outShape,I=$ae({inputs:{x:p},backend:o}),I.shape=a.outShape,C.push(p)}else{const e=a.outHeight*a.outWidth,c=boe({inputs:{x:t},backend:o,attrs:{shape:p?[a.batchSize,e,a.inChannels]:[a.batchSize,a.inChannels,e]}}),g=boe({inputs:{x:n},backend:o,attrs:{shape:[1,a.inChannels,a.outChannels]}}),u=Voe({a:p?c:g,b:p?g:c,transposeA:!p,transposeB:m,backend:o,bias:i,activation:l,preluActivationWeights:r,leakyreluAlpha:s});I=boe({inputs:{x:u},backend:o,attrs:{shape:a.outShape}}),C.push(c),C.push(g),C.push(u)}for(const f of C)o.disposeIntermediateTensorInfo(f);return I}function sre(e){let{x:t,filter:n,convInfo:a,backend:o,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:s=0,activation:l=null}=e;const{filterWidth:c,filterHeight:g,inChannels:u,outWidth:d,outHeight:h,dataFormat:p}=a,m="channelsLast"===p,I=c*g*u,C=h*d,f=[a.batchSize,I,C],b=[];if(null!=r){const e=ire(r.shape,m);null!=e&&(r=boe({inputs:{x:r},backend:o,attrs:{shape:e}}),b.push(r))}if(null!=i){const e=ire(i.shape,m);null!=e&&(i=boe({inputs:{x:i},backend:o,attrs:{shape:e}}),b.push(i))}const y=boe({inputs:{x:n},backend:o,attrs:{shape:[1,I,bX(n.shape)/I]}});b.push(y);const A=new ore(f,a),v=[t.shape,[a.padInfo.top,a.padInfo.left],[a.strideHeight,a.strideWidth],[a.dilationHeight,a.dilationWidth],[a.inChannels],[a.filterWidth*a.inChannels],[a.outWidth]],S=o.runWebGLProgram(A,[t],"float32",v),x=boe({inputs:{x:S},backend:o,attrs:{shape:f}});b.push(S),b.push(x);const G=null!=i,Z=null!=r,w="leakyrelu"===l,k=l?doe(l,!0):null,B=new hoe(m?x.shape:y.shape,m?y.shape:x.shape,m?[a.batchSize,C,a.outChannels]:[a.batchSize,a.outChannels,C],!0,!1,G,k,Z,w),R=m?[x,y]:[y,x];if(i&&R.push(i),Z&&R.push(r),w){const e=o.makeTensorInfo([],"float32",fH(s,"float32"));R.push(e),b.push(e)}const W=o.runWebGLProgram(B,R,"float32"),V=boe({inputs:{x:W},backend:o,attrs:{shape:a.outShape}});b.push(W);for(const N of b)o.disposeIntermediateTensorInfo(N);return V}const lre={kernelName:EM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i}=t,{strides:r,pad:s,dataFormat:l,dilations:c,dimRoundingMode:g}=a,u=dL(l),d=nL(o.shape,i.shape,r,c,s,g,!1,u);let h;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===u&&nM().getBool("WEBGL_EXP_CONV")){const e=new are(d),t=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];h=n.runWebGLProgram(e,[o,i],"float32",t)}else if(nM().getBool("WEBGL_CONV_IM2COL"))h=sre({x:o,filter:i,convInfo:d,backend:n});else{const e=new tre(d);h=n.runWebGLProgram(e,[o,i],"float32")}else h=rre({x:o,filter:i,convInfo:d,backend:n});const p=boe({inputs:{x:h},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(h),p}};class cre{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,o=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(o,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              ").concat(i?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class gre{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,o=e.strideWidth,i="channelsLast"===e.dataFormat,r=t-1-e.padInfo.top,s=n-1-e.padInfo.left,l=i?1:2,c=i?2:3,g=i?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(r,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(g,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(l,"], coords[").concat(c,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(i,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class ure{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,r=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(o,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(i,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(r,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class dre{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,o=e.strideDepth,i=e.strideHeight,r=e.strideWidth,s=t-1-e.padInfo.front,l=n-1-e.padInfo.top,c=a-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(s,", ").concat(l,", ").concat(c,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(o,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const hre={kernelName:FM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,dy:i}=t,{strides:r,pad:s,dataFormat:l,dimRoundingMode:c,filterShape:g}=a,u=dL(l),d=nL(o.shape,g,r,1,s,c,!1,u),h=new cre(d);return n.runWebGLProgram(h,[o,i],"float32")}};class pre{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Ute(this.outputShape.length);const t=e.filterHeight,n=e.filterWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(e.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(e.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}}const mre={kernelName:HM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,filter:i}=t,{inputShape:r,strides:s,pad:l,dataFormat:c,dimRoundingMode:g}=a,u=dL(c),d=nL(r,i.shape,s,1,l,g,!1,u);if(nM().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&"channelsLast"===u){const e=[[d.strideHeight,d.strideWidth]],t=new pre(d);return n.runWebGLProgram(t,[o,i],"float32",e)}{const e=new gre(d);return n.runWebGLProgram(e,[o,i],"float32")}}};const Ire={kernelName:JM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i}=t,{strides:r,pad:s,dilations:l}=a,c=aL(o.shape,i.shape,r,l,s),g=new nre(c);return n.runWebGLProgram(g,[o,i],"float32")}};const Cre={kernelName:YM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,dy:i}=t,{strides:r,pad:s,filterShape:l}=a,c=aL(o.shape,l,r,1,s),g=new ure(c);return n.runWebGLProgram(g,[o,i],"float32")}};const fre={kernelName:LM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,filter:i}=t,{pad:r,strides:s,inputShape:l}=a,c=aL(l,i.shape,s,1,r),g=new dre(c);return n.runWebGLProgram(g,[o,i],"float32")}},bre=goe({opSnippet:coe+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(jae,"\n  return result;\n")}),yre={kernelName:zM,backendName:"webgl",kernelFunc:bre},Are=goe({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),vre={kernelName:KM,backendName:"webgl",kernelFunc:Are};class Sre{constructor(e,t,n,a,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,r,s,l]=e,[c]=t,[g,u]=n;this.outputShape=[c,g,u,l];const d="bilinear"===a?1:0,[h,p]=["".concat(r-1,".0"),"".concat(s-1,".0")],[m,I,C]=g>1?["".concat((r-1)/(g-1)),"(y2-y1) * height_ratio","y1*".concat(h," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(h)],[f,b,y]=u>1?["".concat((s-1)/(u-1)),"(x2-x1) * width_ratio","x1*".concat(p," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(p)];this.userCode="\n      const float height_ratio = float(".concat(m,");\n      const float width_ratio = float(").concat(f,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(i,") {\n          return;\n        }\n\n        float height_scale = ").concat(I,";\n        float width_scale = ").concat(b,";\n\n        float in_y = ").concat(C,";\n        if( in_y < 0.0 || in_y > ").concat(h," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n        float in_x = ").concat(y,";\n        if( in_x < 0.0 || in_x > ").concat(p," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(d," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")}}const xre={kernelName:PM,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:a}=e,{image:o,boxes:i,boxInd:r}=t,{cropSize:s,method:l,extrapolationValue:c}=a,g=new Sre(o.shape,i.shape,s,l,c);return n.runWebGLProgram(g,[o,i,r],"float32")}};var Gre;!function(e){e.Prod="*",e.Sum="+"}(Gre||(Gre={}));class Zre{constructor(e,t,n,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===Gre.Prod?"1.0":"0.0",r=n?i:"getX(".concat(wre(o,"coords",this.op),")"),s=this.outputShape[this.outputShape.length-1];let l="",c="";n?(l=a?"end != ".concat(s-1):"end != 0",c=a?"end + 1":"end - 1"):(l=a?"end + pow2 < ".concat(s):"end >= pow2",c=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(Jte(o)," coords = getOutputCoords();\n        int end = ").concat(kre(o,"coords",this.op),";\n        float val = ").concat(r,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(l,") {\n          int idx = ").concat(c,";\n          ").concat(kre(o,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(wre(o,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}}function wre(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function kre(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function Bre(e,t,n,a,o,i){const r=t.shape.length,s=mz([a],r);let l=t;null!=s&&(l=Boe({inputs:{x:t},backend:n,attrs:{perm:s}}));const c=Cz(1,r)[0];if(c!==r-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(a));const g=l.shape[c];let u=$ae({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(g))-1;d++){const t=new Zre(e,l.shape,!1,i),a=[[d]],o=u;u=n.runWebGLProgram(t,[u],u.dtype,a),n.disposeIntermediateTensorInfo(o)}if(o){const t=new Zre(e,l.shape,o,i),a=u;u=n.runWebGLProgram(t,[u],u.dtype),n.disposeIntermediateTensorInfo(a)}if(null!=s){const e=Boe({inputs:{x:u},backend:n,attrs:{perm:Iz(s)}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),e}return u}const Rre={kernelName:DM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,exclusive:r,reverse:s}=a;return Bre(Gre.Prod,o,n,i,r,s)}};const Wre={kernelName:UM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,exclusive:r,reverse:s}=a;return Bre(Gre.Sum,o,n,i,r,s)}};const Vre={kernelName:OM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,weights:i}=t,{size:r,binaryOutput:s}=a;if(1===o.shape.length){const e=n.readSync(o.dataId),t=n.readSync(i.dataId),a=Gne(e,t,i.dtype,i.shape,r);return n.makeTensorInfo([r],i.dtype,a)}if(2===o.shape.length){const e=n.bufferSync(o),t=n.bufferSync(i),a=Zne(e,t,r,s);return n.makeTensorInfo(a.shape,i.dtype,a.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(o.shape.length,"."))}};class Nre{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const Xre={kernelName:_M,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{blockSize:i,dataFormat:r}=a,s=o.shape[0],l=("NHWC"===r?o.shape[1]:o.shape[2])*i,c=("NHWC"===r?o.shape[2]:o.shape[3])*i,g=("NHWC"===r?o.shape[3]:o.shape[1])/(i*i),u=new Nre("NHWC"===r?[s,l,c,g]:[s,g,l,c],i,r);return n.runWebGLProgram(u,[o],o.dtype)}};class Mre{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ute(this.outputShape.length);const i=e.filterHeight,r=e.filterWidth,s=e.outChannels/e.inChannels;let l="",c="";n&&(l=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):o?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),c="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(l,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(s,";\n        int q = d2 - d1 * ").concat(s,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(i,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(g,"\n        ").concat(c,"\n        setOutput(result);\n      }\n    ")}}class Tre{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ute(this.outputShape.length);const i=e.outChannels/e.inChannels,r=e.padInfo.left,s=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,g=e.filterWidth,u=g;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let I=0;I<g;I++)d+="\n          vec4 xTexelC".concat(2*I,";\n          int xTexelC").concat(2*I,"Ready;\n          vec4 xTexelC").concat(2*I+1,";\n          int xTexelC").concat(2*I+1,"Ready;\n          vec4 xC").concat(I,";");d+="\n    for (int r = 0; r < ".concat(c,"; r++) {\n      ");for(let I=0;I<g;I++)d+="\n          xTexelC".concat(2*I," = vec4(0.0);\n          xTexelC").concat(2*I,"Ready = 0;\n          xTexelC").concat(2*I+1," = vec4(0.0);\n          xTexelC").concat(2*I+1,"Ready = 0;\n          xC").concat(I," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let I=0;I<(u+1)/2;I++){const e=2*I;if(d+="\n          xC = xCCorner + ".concat(e*l,";\n          "),1===s){if(e<g&&(r%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n              "),d+=1===l&&e>0?"\n                xC".concat(e," = vec4(xTexelC").concat(e-2,".zw, xTexelC").concat(e,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(e," = vec4(previous.zw, xTexelC").concat(e,".xy);\n                  } else {\n                    xC").concat(e," = vec4(0.0, 0.0, xTexelC").concat(e,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xC").concat(e," = xTexelC").concat(e,";\n                "),e+1<g)){const t=r%2===0?hX(l):l;l%2===0&&r%2===1||l%2!==0&&r%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(t,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                    xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(e+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(e+1,"Ready = 1;\n                  }\n                  "),d+=l>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(e+1," = vec4(previous.zw, xTexelC").concat(e+1,".xy);\n                    } else {\n                     xC").concat(e+1," = vec4(0.0, 0.0, xTexelC").concat(e+1,".xy);\n                    }\n                    "):"\n                    xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".xy);\n                    ")):d+=1===t?"\n                    xC".concat(e+1," = xTexelC").concat(e,";\n                    "):"\n                    xCOffset = xC + ".concat(t,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                      xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(e+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(e+1,"Ready = 1;\n                    }\n\n                    xC").concat(e+1," = xTexelC").concat(e+1,";\n                    ")}}else e<g&&(r%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n              "),e+1<g&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(e+1," = vec4(xTexelC").concat(e+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(\n                  xTexelC").concat(e,".xy, xTexelC").concat(e+1,".xy);\n              "),e+1<g&&(d+="\n                  xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n                "))));e<g&&(d+="\n            wTexel = getW(r, ".concat(e,", d1, q);\n            dotProd += xC").concat(e," * vec4(wTexel.xz, wTexel.xz);\n          "),e+1<g&&(d+="\n              wTexel = getW(r, ".concat(e+1,", d1, q);\n              dotProd += xC").concat(e+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";let h="",p="";n&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):o?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),p="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(h,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(i,";\n        int q = d2 - d1 * ").concat(i,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(m,"\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")}}const Ere={kernelName:QM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i}=t,{strides:r,pad:s,dilations:l,dimRoundingMode:c}=a;let g=l;null==g&&(g=[1,1]),IX(gL(r,g),(()=>"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(g,"'")));const u=nL(o.shape,i.shape,r,g,s,c,!0);let d;d=nM().getBool("WEBGL_PACK_DEPTHWISECONV")&&u.strideWidth<=2&&u.outChannels/u.inChannels===1?new Tre(u):new Mre(u);const h=[[u.padInfo.top,u.padInfo.left],[u.strideHeight,u.strideWidth],[u.dilationHeight,u.dilationWidth],[u.inHeight,u.inWidth]];return n.runWebGLProgram(d,[o,i],"float32",h)}};class Fre{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(i," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(o,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class Hre{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,r=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(i,", ").concat(r,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(s,"; dm++) {\n              int d2 = d1 * ").concat(s," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const Jre={kernelName:jM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,dy:i}=t,{strides:r,dilations:s,pad:l,dimRoundingMode:c,filterShape:g}=a,u=nL(o.shape,g,r,s,l,c,!0),d=new Fre(u);return n.runWebGLProgram(d,[o,i],"float32")}};const Yre={kernelName:qM,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,filter:i}=t,{strides:r,dilations:s,pad:l,dimRoundingMode:c,inputShape:g}=a,u=nL(g,i.shape,r,s,l,c,!0),d=new Hre(u);return n.runWebGLProgram(d,[o,i],"float32")}};class Lre{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const zre={kernelName:$M,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:a}=t,o=[...a.shape,...a.shape],i=bX(a.shape),r=boe({inputs:{x:a},backend:n,attrs:{shape:[i]}}),s=new Lre(i),l=n.runWebGLProgram(s,[r],r.dtype),c=boe({inputs:{x:l},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(l),c}};class Kre{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:a,strideHeight:o,strideWidth:i,filterHeight:r,filterWidth:s,dilationHeight:l,dilationWidth:c}=e,{top:g,left:u}=a;this.userCode="\n      const ivec2 strides = ivec2(".concat(o,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(g,", ").concat(u,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(r,"; h++) {\n          int hIn = hBeg + h * ").concat(l,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(s,"; w++) {\n              int wIn = wBeg + w * ").concat(c,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}}const Dre={kernelName:eT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i}=t,{strides:r,pad:s,dilations:l}=a,c=$Y(o.shape,i.shape,r,s,"NHWC",l);let g;const u=new Kre(c);g=n.runWebGLProgram(u,[o,i],"float32");const d=boe({inputs:{x:g},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(g),d}};const Ure={kernelName:iT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{equation:o}=a,i=t,{allDims:r,summedDims:s,idDims:l}=HO(o,i.length);YO(r.length,l,i);const{path:c,steps:g}=LO(s,l),u=g.length;let d=null,h=r.length;const p=[];for(let m=0;m<u;++m){for(const e of g[m]){const{permutationIndices:t,expandDims:a}=JO(h,l[e]);let o;zO(t)?o=i[e]:(o=Boe({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(o));const r=o.shape.slice();for(let e=0;e<a.length;++e)r.splice(a[e],0,1);AX(o.shape,r)||(o=boe({inputs:{x:o},backend:n,attrs:{shape:r}}),p.push(o)),null===d?d=o:(d=Coe({inputs:{a:o,b:d},backend:n}),p.push(d))}m<u-1&&(c[m]>=0&&(d=woe({inputs:{x:d},backend:n,attrs:{axis:c[m]-(r.length-h),keepDims:!1}}),p.push(d)),h--)}for(const m of p)m!==d&&n.disposeIntermediateTensorInfo(m);return d}},Pre=goe({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),Ore={kernelName:rT,backendName:"webgl",kernelFunc:Pre},_re={kernelName:sT,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:a,y:o}=t,i=nM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new qae("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",a.shape,o.shape):new Qae("return (b >= 0.0) ? a : a * (b + 1.0);",a.shape,o.shape);return n.runWebGLProgram(i,[a,o],a.dtype)}},Qre=uoe({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:Wne}),jre={kernelName:cT,backendName:"webgl",kernelFunc:Qre},qre=goe({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(AO,";\n  float a1 = ").concat(vO,";\n  float a2 = ").concat(SO,";\n  float a3 = ").concat(xO,";\n  float a4 = ").concat(GO,";\n  float a5 = ").concat(ZO,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),$re={kernelName:lT,backendName:"webgl",kernelFunc:qre},ese=goe({opSnippet:coe+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Vne,dtype:"float32"}),tse={kernelName:gT,backendName:"webgl",kernelFunc:ese};function nse(e){const{inputs:t,attrs:n,backend:a}=e,{dim:o}=n,{input:i}=t,r=i.shape.length,s=i.shape.slice();let l=o;return o<0&&(IX(-(r+1)<=o,(()=>"Axis must be in the interval [".concat(-(r+1),", ").concat(r,"]"))),l=r+o+1),s.splice(l,0,1),boe({inputs:{x:i},backend:a,attrs:{shape:s}})}const ase={kernelName:uT,backendName:"webgl",kernelFunc:nse},ose="return exp(x) - 1.0;",ise=goe({opSnippet:ose,packedOpSnippet:ose,cpuKernelImpl:Nne}),rse={kernelName:dT,backendName:"webgl",kernelFunc:ise};class sse{constructor(e,t,n){this.variableNames=["real","imag"];const a=t[1];this.outputShape=t;const o=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),i=n?"".concat(a,".0"):"1.0";let r;if("real"===e)r="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));r="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(r,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(i,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}}function lse(e,t,n){const a=n.texData.get(e.dataId),o=bX(e.shape),i=e.shape[e.shape.length-1],r=boe({inputs:{x:e},backend:n,attrs:{shape:[o/i,i]}}),s=r.shape,l=new sse("real",s,t),c=new sse("imag",s,t),g=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s}],u=n.runWebGLProgram(l,g,"float32"),d=n.runWebGLProgram(c,g,"float32"),h=toe({inputs:{real:u,imag:d},backend:n});n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d);const p=boe({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(h),p}const cse={kernelName:hT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:a}=t;return lse(a,!1,n)}};class gse{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function use(e){const{backend:t,attrs:n}=e,{shape:a,value:o}=n;let{dtype:i}=n;if(i=i||HX(o),"string"===i){const e=RX(i,bX(a));return e.fill(o),t.makeTensorInfo(a,i,e)}{const e=new gse(a,o),n=[[o]];return t.runWebGLProgram(e,[],i,n)}}const dse={kernelName:pT,backendName:"webgl",kernelFunc:use};class hse{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const pse={kernelName:mT,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{image:a}=t,o=n,i=new hse(a.shape);return o.runWebGLProgram(i,[a],a.dtype)}},mse="return floor(x);",Ise=goe({opSnippet:mse,packedOpSnippet:mse,cpuKernelImpl:Xne}),Cse={kernelName:IT,backendName:"webgl",kernelFunc:Ise},fse=uoe({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),bse={kernelName:CT,backendName:"webgl",kernelFunc:fse};class yse{constructor(e){this.variableNames=["A"];const t=xte(),[n,a]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(a,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")}}class Ase{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=xte(),[n,a]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(a,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}const vse={kernelName:mF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e;let{pixels:o}=t;const{numChannels:i}=a,r=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=r?[o.videoWidth,o.videoHeight]:[o.width,o.height],g=[c,l],u=[c,l,i];if(s||r){const e=nM().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==Sse||e!==xse)&&(xse=e,Sse=document.createElement("canvas").getContext("2d",{willReadFrequently:xse})),Sse.canvas.width=l,Sse.canvas.height=c,Sse.drawImage(o,0,0,l,c),o=Sse.canvas}const d=n.makeTensorInfo(g,"int32");n.texData.get(d.dataId).usage=Gee.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),o);const h=nM().getBool("WEBGL_PACK")?new Ase(u):new yse(u),p=n.runWebGLProgram(h,[d],"int32");return n.disposeData(d.dataId),p}};let Sse,xse=nM().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const Gse={kernelName:fF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i,bias:r,preluActivationWeights:s}=t,{strides:l,pad:c,dataFormat:g,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=a,m=dL(g),I=nL(o.shape,i.shape,l,u,c,d,!1,m);let C;const f=[],b=null!=r,y=null!=s,A="leakyrelu"===h,v=()=>{const e=[o,i],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=boe({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return f.push(t),t}return e};if(b&&e.push(t(r,g)),y&&e.push(t(s,g)),A){const t=n.makeTensorInfo([],"float32",fH(p,"float32"));e.push(t),f.push(t)}return e};if(1!==I.filterHeight||1!==I.filterWidth||1!==I.dilationHeight||1!==I.dilationWidth||1!==I.strideHeight||1!==I.strideWidth||"SAME"!==I.padInfo.type&&"VALID"!==I.padInfo.type)if(I.strideWidth<=2&&"channelsLast"===m&&nM().getBool("WEBGL_EXP_CONV")){const e=h?doe(h,!0):null,t=new are(I,b,e,y,A),a=[[I.padInfo.top,I.padInfo.left],[I.strideHeight,I.strideWidth],[I.dilationHeight,I.dilationWidth],[I.inHeight,I.inWidth]],o=v();C=n.runWebGLProgram(t,o,"float32",a)}else if(nM().getBool("WEBGL_CONV_IM2COL"))C=sre({x:o,filter:i,convInfo:I,backend:n,bias:r,activation:h,preluActivationWeights:s,leakyreluAlpha:p});else{const e=h?doe(h,!1):null,t=new tre(I,b,e,y,A),a=v();C=n.runWebGLProgram(t,a,"float32")}else C=rre({x:o,filter:i,convInfo:I,backend:n,bias:r,activation:h,preluActivationWeights:s,leakyreluAlpha:p});const S=boe({inputs:{x:C},backend:n,attrs:{shape:I.outShape}});return f.push(C),f.forEach((e=>n.disposeIntermediateTensorInfo(e))),S}};const Zse={kernelName:bF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,filter:i,bias:r,preluActivationWeights:s}=t,{strides:l,pad:c,dilations:g,dimRoundingMode:u,activation:d,leakyreluAlpha:h}=a,p=[];let m=g;null==m&&(m=[1,1]),IX(gL(l,m),(()=>"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(l," and dilations '").concat(m,"'")));const I=nL(o.shape,i.shape,l,m,c,u,!0),C=nM().getBool("WEBGL_PACK_DEPTHWISECONV")&&I.strideWidth<=2&&I.outChannels/I.inChannels===1,f=d?doe(d,C):null,b=[o,i],y=null!=r,A=null!=s,v="leakyrelu"===d;if(y&&b.push(r),A&&b.push(s),v){const e=n.makeTensorInfo([],"float32",fH(h,"float32"));b.push(e),p.push(e)}let S;S=C?new Tre(I,y,f,A,v):new Mre(I,y,f,A,v);const x=[[I.padInfo.top,I.padInfo.left],[I.strideHeight,I.strideWidth],[I.dilationHeight,I.dilationWidth],[I.inHeight,I.inWidth]],G=n.runWebGLProgram(S,b,"float32",x);return p.forEach((e=>n.disposeIntermediateTensorInfo(e))),G}};class wse{constructor(e,t,n,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=n;const o=Jte(n.length);let i="\n    int index;";for(let r=0;r<this.sliceDim;r++)i+="\n          index = round(getIndices(coords[0], ".concat(r,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[r],";\n          flattenIndex += index * ").concat(this.strides[r],";");this.userCode="\n         void main() {\n          ".concat(o," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(i,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}}const kse={kernelName:yT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:a,indices:o}=t,i=o.shape,r=i[i.length-1],s=bX(a.shape),[l,c,g,u]=XP(a,o),d=boe({inputs:{x:o},backend:n,attrs:{shape:[c,r]}}),h=boe({inputs:{x:a},backend:n,attrs:{shape:[bX(a.shape)/g,g]}});if(n.shouldExecuteOnCPU([a,o])||"string"===a.dtype){const e=n.readSync(o.dataId),t=n.bufferSync(a),i=Mne(e,t,a.dtype,c,r,g,u,a.shape,s);return n.makeTensorInfo(l,a.dtype,i.values)}const p=new wse(r,u,[c,g],a.shape),m=n.runWebGLProgram(p,[h,d],h.dtype),I=boe({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),I}};class Bse{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=Jte(this.rank),a=function(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[];for(let o=0;o<e.length;o++)2===o?a.push("index"):a.push("".concat(n[o]));return a.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(e[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}}function Rse(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,indices:i}=t,{axis:r,batchDims:s}=a,l=wX(r,o.shape)[0];if(nM().get("DEBUG")){const e=n.readSync(i.dataId),t=o.shape[l];for(let n=0;n<e.length;++n){const a=e[n];IX(a<=t-1&&a>=0,(()=>"GatherV2: the index value ".concat(a," is not in [0, ").concat(t-1,"]")))}}const c=r_(o,i,l,s),g=bX(i.shape),u=[],d=boe({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),h=boe({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,g/c.batchSize]}});u.push(d),u.push(h);const p=[c.batchSize,c.outerSize,g/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([o,i])||"string"===o.dtype){const e=n.bufferSync(h),t=n.bufferSync(d),a=Tne(t,e,p);return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c.outputShape,a.dtype,a.values)}const m=new Bse(d.shape,p),I=n.runWebGLProgram(m,[d,h],d.dtype);u.push(I);const C=boe({inputs:{x:I},backend:n,attrs:{shape:c.outputShape}});return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),C}const Wse={kernelName:bT,backendName:"webgl",kernelFunc:Rse},Vse=uoe({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:Ene,dtype:"bool"}),Nse={kernelName:AT,backendName:"webgl",kernelFunc:Vse},Xse=uoe({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Fne}),Mse={kernelName:vT,backendName:"webgl",kernelFunc:Xse};const Tse={kernelName:xT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:a}=t;return lse(a,!0,n)}},Ese=goe({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),Fse={kernelName:ZT,backendName:"webgl",kernelFunc:Ese},Hse=goe({opSnippet:"return float(isinf(x));",dtype:"bool"}),Jse={kernelName:wT,backendName:"webgl",kernelFunc:Hse},Yse=goe({opSnippet:"return float(isnan(x));",dtype:"bool"}),Lse={kernelName:kT,backendName:"webgl",kernelFunc:Yse},zse=uoe({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Hne,dtype:"bool"}),Kse={kernelName:RT,backendName:"webgl",kernelFunc:zse},Dse=uoe({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:Jne,dtype:"bool"}),Use={kernelName:WT,backendName:"webgl",kernelFunc:Dse};const Pse={kernelName:VT,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:a,stop:o,num:i}=n,r=Yne(a,o,i);return t.makeTensorInfo([r.length],"float32",r)}},Ose=goe({opSnippet:coe+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:Lne}),_se={kernelName:NT,backendName:"webgl",kernelFunc:Ose},Qse=goe({opSnippet:coe+"\n  return log(1.0 + x);\n"}),jse={kernelName:XT,backendName:"webgl",kernelFunc:Qse},qse=uoe({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),$se={kernelName:MT,backendName:"webgl",kernelFunc:qse},ele=goe({opSnippet:"return float(!(x >= 1.0));"}),tle={kernelName:TT,backendName:"webgl",kernelFunc:ele},nle=uoe({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),ale={kernelName:ET,backendName:"webgl",kernelFunc:nle};class ole{constructor(e,t,n,a,o){this.variableNames=["x"],this.outputShape=[];const i=t,r=e[3]-1;let s;this.outputShape=e;const l="float(".concat(n,") + float(").concat(a,") * sum");s=.5===o?"inversesqrt(".concat(l,")"):1===o?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(o,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(i,"; j <= ").concat(i,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(r,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(s,";\n        setOutput(val);\n      }\n    ")}}class ile{constructor(e,t,n,a,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,r=e[3]-1;let s;this.outputShape=e;const l="float(".concat(n,") + float(").concat(a,") * sum");s=.5===o?"inversesqrt(".concat(l,")"):1===o?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(o,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(i,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(i,"; j <= ").concat(i,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(r,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(s,";\n        setOutput(result);\n      }\n    ")}}const rle={kernelName:HT,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{depthRadius:i,bias:r,alpha:s,beta:l}=a,c=nM().getBool("WEBGL_PACK_NORMALIZATION")?new ile(o.shape,i,r,s,l):new ole(o.shape,i,r,s,l);return n.runWebGLProgram(c,[o],o.dtype)}};class sle{constructor(e,t,n,a,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=a,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(o,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(o,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")}}const lle={kernelName:JT,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:a}=e,{x:o,y:i,dy:r}=t,{depthRadius:s,bias:l,alpha:c,beta:g}=a,u=new sle(o.shape,s,l,c,g);return n.runWebGLProgram(u,[o,i,r],o.dtype)}};function cle(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{reductionIndices:i,keepDims:r}=a,s=o.shape.length,l=wX(i,o.shape);let c=l;const g=mz(c,s),u=null!=g,d=n.shouldExecuteOnCPU([o]);let h=o;if(u){if(d){const e=n.texData.get(h.dataId).values,t=new Array(s);for(let n=0;n<t.length;n++)t[n]=o.shape[g[n]];const a=Cae(e,o.shape,o.dtype,g,t);h=n.makeTensorInfo(t,o.dtype);n.texData.get(h.dataId).values=a}else h=Zoe(o,g,n);c=Cz(c.length,s)}pz("max",c,s);const[p,m]=dz(h.shape,c);let I,C=p;if(r&&(C=hz(p,l)),d){const e=n.texData.get(h.dataId).values,t=zne(e,bX(m),C,o.dtype);I=n.makeTensorInfo(C,o.dtype);n.texData.get(I.dataId).values=t}else I=function(e,t,n,a){const o=bX(t),i=boe({inputs:{x:e},attrs:{shape:[bX(e.shape)/o,o]},backend:a}),r=Soe(i,e.dtype,"max",a),s=boe({inputs:{x:r},attrs:{shape:n},backend:a});return a.disposeIntermediateTensorInfo(i),a.disposeIntermediateTensorInfo(r),s}(h,m,C,n);return u&&n.disposeIntermediateTensorInfo(h),I}const gle={kernelName:YT,backendName:"webgl",kernelFunc:cle},ule=uoe({opSnippet:_ae+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+jae+"\n  return result;\n",cpuKernelImpl:Kne}),dle={kernelName:LT,backendName:"webgl",kernelFunc:ule};const hle={kernelName:zT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t;Ate(o,"maxPool");const{filterSize:i,strides:r,pad:s,dimRoundingMode:l}=a;IX(gL(r,1),(()=>"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(1,"'")));const c=eL(o.shape,i,r,1,s,l);if(1===c.filterWidth&&1===c.filterHeight&&AX(c.inShape,c.outShape))return $ae({inputs:{x:o},backend:n});const g=new uie(c,"max",!1);return n.runWebGLProgram(g,[o],o.dtype)}};const ple={kernelName:DT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{filterSize:i,strides:r,pad:s,dataFormat:l,dimRoundingMode:c}=a,g=tL(o.shape,i,r,[1,1,1],s,c,l),u=new die(g,"max",!1);return n.runWebGLProgram(u,[o],o.dtype)}};class mle{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,a=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,r=o-1-e.padInfo.top,s=i-1-e.padInfo.left,l=o*i-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(r,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(o,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(i,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(l," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(i," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class Ile{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,r=e.dilationWidth,s=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,g=s-1-e.padInfo.front,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=s*l*c-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(g,", ").concat(u,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(s,";\n           wD += ").concat(o,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(l,";\n              wR += ").concat(i,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(c,";\n                wC += ").concat(r,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(h," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(l," * ").concat(c," +\n                  wR * ").concat(c," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const Cle={kernelName:UT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i}=t,r=i,{filterSize:s,strides:l,pad:c,dimRoundingMode:g}=a,u=tL(r.shape,s,l,[1,1,1],c,g),d=new die(u,"max",!0),h=n.runWebGLProgram(d,[r],r.dtype),p=new Ile(u),m=n.runWebGLProgram(p,[o,h],r.dtype);return n.disposeIntermediateTensorInfo(h),m}};const fle={kernelName:KT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{dy:o,input:i,output:r}=t,s=i;Ate([i,r],"maxPoolGrad");const{filterSize:l,strides:c,pad:g,dimRoundingMode:u}=a,d=eL(s.shape,l,c,1,g,u),h=new uie(d,"max",!0),p=n.runWebGLProgram(h,[s],s.dtype),m=new mle(d),I=n.runWebGLProgram(m,[o,p],s.dtype);return n.disposeIntermediateTensorInfo(p),I}};const ble={kernelName:PT,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:a}=e;const{x:o}=t,{filterSize:i,strides:r,pad:s,includeBatchInIndex:l}=n,c=a;IX(4===o.shape.length,(()=>"Error in maxPool: input must be rank 4 but got rank ".concat(o.shape.length,".")));const g=[1,1];IX(gL(r,g),(()=>"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(g,"'")));const u=eL(o.shape,i,r,g,s),[d,h]=function(e,t,n,a){let o=new uie(n,"max",!1);const i=a.runWebGLProgram(o,[e],"float32");return o=new uie(n,"max",!0,!0,t),[i,a.runWebGLProgram(o,[e],"float32")]}(o,l,u,c);return[d,h]}};const yle={kernelName:OT,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:a}=e;const{x:o}=t,{keepDims:i,axis:r}=n,s=a,l=o.shape.length,c=wX(r,o.shape);let g=c;const u=mz(g,l),d=null!=u,h=s.shouldExecuteOnCPU([o]),p=[];let m=o;if(d){if(h){const e=s.texData.get(m.dataId).values,t=new Array(l);for(let a=0;a<t.length;a++)t[a]=o.shape[u[a]];const n=Cae(e,o.shape,o.dtype,u,t);m=s.makeTensorInfo(t,o.dtype);s.texData.get(m.dataId).values=n}else m=Zoe(o,u,s);p.push(m),g=Cz(g.length,l)}pz("sum",g,l);const[I,C]=dz(m.shape,g);let f=I;i&&(f=hz(I,c));const b=function(e,t,n,a){const o=bX(t),i=boe({inputs:{x:e},attrs:{shape:[bX(e.shape)/o,o]},backend:a}),r=Soe(i,"float32","mean",a),s=boe({inputs:{x:r},attrs:{shape:n},backend:a});return a.disposeIntermediateTensorInfo(i),a.disposeIntermediateTensorInfo(r),s}(m,C,f,s);for(const y of p)s.disposeIntermediateTensorInfo(y);return b}};const Ale={kernelName:_T,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a,s=o.shape.length,l=wX(i,o.shape);let c=l;const g=mz(c,s);let u=o;null!=g&&(u=Boe({inputs:{x:o},backend:n,attrs:{perm:g}}),c=Cz(c.length,o.shape.length)),pz("min",c,s);const[d,h]=dz(u.shape,c),p=boe({inputs:{x:u},backend:n,attrs:{shape:[-1,bX(h)]}}),m=Soe(p,p.dtype,"min",n);let I;if(r){I=boe({inputs:{x:m},backend:n,attrs:{shape:hz(d,l)}})}else I=boe({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),null!=g&&n.disposeIntermediateTensorInfo(u),I}},vle=uoe({opSnippet:_ae+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+jae+"\n  return result;\n",cpuKernelImpl:Dne}),Sle={kernelName:QT,backendName:"webgl",kernelFunc:vle};class xle{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const a=e.length,o=Jte(a),i=t.map((e=>e[0])).join(","),r=t.map(((t,n)=>t[0]+e[n])).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),l="reflect"===n?0:1;this.userCode=1!==a?"\n      ".concat(o," start = ").concat(o,"(").concat(i,");\n      ").concat(o," end = ").concat(o,"(").concat(r,");\n\n      void main() {\n        ").concat(o," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(l,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(l,";\n          }\n        }\n        ").concat(o," coords = outC - start;\n        setOutput(getX(").concat(s,"));\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(r,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(l,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(l,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")}}class Gle{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const a=e.length,o=Jte(a),i=t.map((e=>e[0])).join(","),r=t.map(((t,n)=>t[0]+e[n])).join(","),s=yae("rc",a),l=yae("source",a),c="".concat(s[a-1]," < ").concat(this.outputShape[a-1]),g=1===a?"source":"vec2(".concat(l.slice(-2).join(),")"),u="reflect"===n?0:1;let d="";if(1===a){const e="\n        ".concat(o," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(u,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(u,";\n        }\n        source -= start;\n      ");d="\n        ".concat(o," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(g,");\n        ").concat(s[a-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(g,");\n        }\n      ")}else{const e="\n        ".concat(o," source = rc;\n        ").concat(o," lt = ").concat(o,"(lessThan(source, start));\n        ").concat(o," gte = ").concat(o,"(greaterThanEqual(source, end));\n        ").concat(o," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(u,") +\n                gte * ((end - 1) * 2 - source + ").concat(u,");\n        source -= start;\n      ");d="\n        ".concat(o," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(g,");\n        ").concat(s[a-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(g,");\n        }\n        rc = outputLoc;\n        ").concat(s[a-2]," += 1;\n        if(").concat(s[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(e,"\n          result[2] = getChannel(getX(").concat(l.join(),"), ").concat(g,");\n          ").concat(s[a-1]," += 1;\n          if(").concat(c,") {\n            ").concat(e,"\n            result[3] = getChannel(getX(").concat(l.join(),"), ").concat(g,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(o," start = ").concat(o,"(").concat(i,");\n      const ").concat(o," end = ").concat(o,"(").concat(r,");\n\n      void main() {\n        ").concat(o," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}}const Zle={kernelName:jT,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:a}=e;const{x:o}=t,{paddings:i,mode:r}=a,s=nM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gle(o.shape,i,r):new xle(o.shape,i,r);return n.runWebGLProgram(s,[o],o.dtype)}},wle=uoe({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+jae+"\n  return result;\n"}),kle={kernelName:qT,backendName:"webgl",kernelFunc:wle};class Ble{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}}const Rle=uoe({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Wle={kernelName:oT,backendName:"webgl",kernelFunc:Rle},Vle="return a - b;",Nle=uoe({opSnippet:Vle,packedOpSnippet:Vle,supportsComplex:!0,cpuKernelImpl:pae}),Xle={kernelName:aF,backendName:"webgl",kernelFunc:Nle};function Mle(e){const{inputs:t,backend:n,attrs:a}=e,{logits:o}=t,{dim:i}=a,r=wX([i],o.shape),s=cle({inputs:{x:o},backend:n,attrs:{reductionIndices:r,keepDims:!1}}),l=hz(s.shape,r),c=boe({inputs:{x:s},backend:n,attrs:{shape:l}}),g=Nle({inputs:{a:o,b:c},backend:n}),u=ese({inputs:{x:g},backend:n}),d=woe({inputs:{x:u},backend:n,attrs:{axis:r,keepDims:!1}}),h=boe({inputs:{x:d},backend:n,attrs:{shape:l}}),p=Rle({inputs:{a:u,b:h},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),p}const Tle={kernelName:KE,backendName:"webgl",kernelFunc:Mle};const Ele={kernelName:$T,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{logits:o}=t,{numSamples:i,seed:r,normalized:s}=a,l=s?o:Mle({inputs:{logits:o},backend:n,attrs:{dim:o.shape.length-1}}),c=l.shape[0],g=l.shape[1],u=new Ble(c,g,i),d=[[r]],h=n.runWebGLProgram(u,[l],"int32",d);return s||n.disposeIntermediateTensorInfo(l),h}},Fle=kae+"\n  return -x;\n";const Hle={kernelName:tE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:a}=t;if(n.shouldExecuteOnCPU([a])){const e=n.texData.get(a.dataId),[t,o]=Pne(e.values,a.shape,a.dtype);return n.makeTensorInfo(o,a.dtype,t)}let o;return o=nM().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Yae(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new wae(a.shape,Fle),n.runWebGLProgram(o,[a],a.dtype)}},Jle=dU;const Yle={kernelName:aE,backendName:"webgl",kernelFunc:function(e){yF("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:a}=e,{boxes:o,scores:i}=t,{maxOutputSize:r,iouThreshold:s,scoreThreshold:l}=a,c=n.readSync(o.dataId),g=n.readSync(i.dataId),{selectedIndices:u}=Jle(c,g,r,s,l);return n.makeTensorInfo([u.length],"int32",new Int32Array(u))}},Lle=hU;const zle={kernelName:oE,backendName:"webgl",kernelFunc:function(e){yF("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:a}=e,{boxes:o,scores:i}=t,{maxOutputSize:r,iouThreshold:s,scoreThreshold:l,padToMaxOutputSize:c}=a,g=n.readSync(o.dataId),u=n.readSync(i.dataId),{selectedIndices:d,validOutputs:h}=Lle(g,u,r,s,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},Kle=pU;const Dle={kernelName:iE,backendName:"webgl",kernelFunc:function(e){yF("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:a}=e,{boxes:o,scores:i}=t,{maxOutputSize:r,iouThreshold:s,scoreThreshold:l,softNmsSigma:c}=a,g=n.readSync(o.dataId),u=n.readSync(i.dataId),d=r,h=s,p=l,m=c,{selectedIndices:I,selectedScores:C}=Kle(g,u,d,h,p,m);return[n.makeTensorInfo([I.length],"int32",new Int32Array(I)),n.makeTensorInfo([C.length],"float32",new Float32Array(C))]}};class Ule{constructor(e,t,n,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")}}const Ple={kernelName:sE,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:a}=e,{indices:o}=t,{dtype:i,depth:r,onValue:s,offValue:l}=a,c=bX(o.shape),g=new Ule(c,r,s,l),u=boe({inputs:{x:o},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(g,[u],i);n.disposeIntermediateTensorInfo(u);const h=boe({inputs:{x:d},backend:n,attrs:{shape:[...o.shape,r]}});return n.disposeIntermediateTensorInfo(d),h}};function Ole(e){const{inputs:t,backend:n}=e,{x:a}=t;if("complex64"===a.dtype){const e=Xie({inputs:{input:a},backend:n}),t=Ole({inputs:{x:e},backend:n}),o=Qie({inputs:{input:a},backend:n}),i=Ole({inputs:{x:o},backend:n}),r=toe({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),r}return use({attrs:{shape:a.shape,dtype:a.dtype,value:"string"===a.dtype?"":0},backend:n})}const _le={kernelName:hF,backendName:"webgl",kernelFunc:Ole};const Qle={kernelName:rE,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:a}=t,{x:o}=n;if("string"===o.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===o.dtype){const t=Xie({inputs:{input:o},backend:a}),n=e({inputs:{x:t},backend:a}),i=Qie({inputs:{input:o},backend:a}),r=Ole({inputs:{x:i},backend:a}),s=toe({inputs:{real:n,imag:r},backend:a});return a.disposeIntermediateTensorInfo(t),a.disposeIntermediateTensorInfo(n),a.disposeIntermediateTensorInfo(i),a.disposeIntermediateTensorInfo(r),s}return use({attrs:{shape:o.shape,dtype:o.dtype,value:1},backend:a})}};const jle={kernelName:lE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{axis:o}=a;if(1===t.length)return nse({inputs:{input:t[0]},backend:n,attrs:{dim:o}});const i=t[0].shape,r=t[0].dtype;t.forEach((e=>{CX(i,e.shape,"All tensors passed to stack must have matching shapes"),IX(r===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const s=[],l=$ie({inputs:t.map((e=>{const t=nse({inputs:{input:e},backend:n,attrs:{dim:o}});return s.push(t),t})),backend:n,attrs:{axis:o}});return s.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}};class qle{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const a=e.length,o=Jte(a),i=t.map((e=>e[0])).join(","),r=t.map(((t,n)=>t[0]+e[n])).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(o," start = ").concat(o,"(").concat(i,");\n      ").concat(o," end = ").concat(o,"(").concat(r,");\n\n      void main() {\n        ").concat(o," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(o," coords = outC - start;\n          setOutput(getX(").concat(s,"));\n        }\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(r,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}}class $le{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const a=e.length,o=Jte(a),i=t.map((e=>e[0])).join(","),r=t.map(((t,n)=>t[0]+e[n])).join(","),s=yae("rc",a),l=yae("source",a),c="".concat(s[a-1]," < ").concat(this.outputShape[a-1]),g=1===a?"source":"vec2(".concat(l.slice(-2).join(),")"),u=["".concat(o," rc = outputLoc;"),"".concat(s[a-1]," += 1;\n       if(").concat(c,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(s[a-2]," += 1;\n       if(").concat(s[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(s[a-1]," += 1;\n         if(").concat(c,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let h="";for(let p=0,m=1===a?2:4;p<m;p++)h+="\n        ".concat(u[p],"\n        if (").concat(d,") {\n          result[").concat(p,"] = float(value);\n        } else {\n          ").concat(o," source = rc - start;\n          result[").concat(p,"] = getChannel(getX(").concat(l.join(),"), ").concat(g,");\n        }\n      ");h+=1===a?"} ":"}}",this.userCode="\n      const ".concat(o," start = ").concat(o,"(").concat(i,");\n      const ").concat(o," end = ").concat(o,"(").concat(r,");\n\n      void main() {\n        ").concat(o," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")}}const ece=e=>{const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{paddings:i,constantValue:r}=a;if(0===bX(o.shape)){return use({backend:n,attrs:{shape:i.map(((e,t)=>e[0]+o.shape[t]+e[1])),value:r,dtype:o.dtype}})}const s=nM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $le(o.shape,i,r):new qle(o.shape,i,r),l=[[r]];return n.runWebGLProgram(s,[o],o.dtype,l)},tce={kernelName:cE,backendName:"webgl",kernelFunc:ece},nce=uoe({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+jae+"\n  return result;\n"}),ace={kernelName:gE,backendName:"webgl",kernelFunc:nce};const oce={kernelName:dE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{axis:i,keepDims:r}=a,s=o.shape.length,l=[],c=wX(i,o.shape);let g=c;const u=mz(g,s);let d,h=o;if(null!=u&&(h=Boe({inputs:{x:o},backend:n,attrs:{perm:u}}),g=Cz(g.length,s),l.push(h)),pz("prod",g,s),n.shouldExecuteOnCPU([h])){const e=n.texData.get(h.dataId).values,{outVals:t,outShape:a,outDtype:o}=_ne(h.shape,h.dtype,e,g);d=n.makeTensorInfo(a,o,t)}else{const[e,t]=dz(h.shape,g),a=bX(t),i=boe({inputs:{x:h},backend:n,attrs:{shape:[-1,a]}}),r=Soe(i,qH(o.dtype),"prod",n);d=boe({inputs:{x:r},backend:n,attrs:{shape:e}}),l.push(i),l.push(r)}if(r){l.push(d);const e=hz(d.shape,c);d=boe({inputs:{x:d},backend:n,attrs:{shape:e}})}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}};const ice={kernelName:hE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{paramsNestedSplits:o,paramsDenseValues:i,indices:r}=t,{outputRaggedRank:s}=a,l=o.map((e=>n.readSync(e.dataId))),c=o.map((e=>e.shape)),g=n.readSync(i.dataId),u=n.readSync(r.dataId),[d,h,p]=Qne(l,c,g,i.shape,i.dtype,u,r.shape,s),m=d.map((e=>n.makeTensorInfo([e.length],"int32",e))),I=n.makeTensorInfo(p,i.dtype,h);return m.concat([I])}};const rce={kernelName:pE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:a,limits:o,deltas:i}=t,r=n.readSync(a.dataId),s=n.readSync(o.dataId),l=n.readSync(i.dataId),[c,g]=jne(r,a.shape,a.dtype,s,o.shape,l,i.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([g.length],a.dtype,g)]}};const sce={kernelName:mE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{shape:o,values:i,defaultValue:r,rowPartitionTensors:s}=t,{rowPartitionTypes:l}=a,c=n.readSync(o.dataId),g=n.readSync(i.dataId),u=n.readSync(r.dataId),d=s.map((e=>n.readSync(e.dataId))),h=s.map((e=>e.shape)),[p,m]=qne(c,o.shape,g,i.shape,i.dtype,u,r.shape,d,h,l);return n.makeTensorInfo(p,i.dtype,m)}},lce=e=>{const{backend:t,attrs:n}=e,{start:a,stop:o,step:i,dtype:r}=n,s=$ne(a,o,i,r);return t.makeTensorInfo([s.length],r,s)},cce={kernelName:IE,backendName:"webgl",kernelFunc:lce},gce=goe({opSnippet:"return 1.0 / x;"}),uce={kernelName:fE,backendName:"webgl",kernelFunc:gce},dce=goe({opSnippet:kae+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),hce={kernelName:bE,backendName:"webgl",kernelFunc:dce},pce=goe({opSnippet:kae+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),mce={kernelName:GE,backendName:"webgl",kernelFunc:pce};class Ice{constructor(e,t,n,a,o){this.variableNames=["A"],this.outputShape=[];const[i,r,s,l]=e;this.outputShape=[i,t,n,l];const c=[a&&t>1?r-1:r,a&&n>1?s-1:s],g=[a&&t>1?t-1:t,a&&n>1?n-1:n];let u;u=o?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/g[0],",\n          ").concat(c[1]/g[1],");\n      const vec2 inputShapeRC = vec2(").concat(r,".0, ").concat(s,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(u,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")}}class Cce{constructor(e,t,n,a,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,r,s,l]=e;this.outputShape=[i,t,n,l];const c=[a&&t>1?r-1:r,a&&n>1?s-1:s],g=[a&&t>1?t-1:t,a&&n>1?n-1:n];let u;u=o?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/g[0],",\n          ").concat(c[1]/g[1],",\n          ").concat(c[1]/g[1],");\n      const vec3 inputShapeRC = vec3(").concat(r,".0, ").concat(s,".0,\n                                     ").concat(s,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(u,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}}const fce={kernelName:SE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o}=t,{alignCorners:i,halfPixelCenters:r,size:s}=a,[l,c]=s,g=nM().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Cce(o.shape,l,c,i,r):new Ice(o.shape,l,c,i,r);return n.runWebGLProgram(g,[o],"float32")}};class bce{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,a,o]=t,[,i,r]=e,s=[n&&i>1?a-1:a,n&&r>1?o-1:o],l=[n&&i>1?i-1:i,n&&r>1?r-1:r],c=s[0]/l[0],g=s[1]/l[1],u=1/c,d=1/g,h=2*Math.ceil(u)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(g,");\n\n        const float invHeightScale = float(").concat(u,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(h,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(r,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(a-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const yce={kernelName:xE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o,dy:i}=t,{alignCorners:r}=a,s=new bce(i.shape,o.shape,r);return n.runWebGLProgram(s,[i],i.dtype)}};class Ace{constructor(e,t,n,a,o){this.variableNames=["A"],this.outputShape=[];const[i,r,s,l]=e;this.outputShape=[i,t,n,l];const c=[a&&t>1?r-1:r,a&&n>1?s-1:s],g=[a&&t>1?t-1:t,a&&n>1?n-1:n],u=a?"0.5":"0.0";let d;d=o?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/g[0],",\n          ").concat(c[1]/g[1],");\n      const vec2 inputShapeRC = vec2(").concat(r,".0, ").concat(s,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(u,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}}class vce{constructor(e,t,n,a,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,r,s,l]=e;this.outputShape=[i,t,n,l];const c=[a&&t>1?r-1:r,a&&n>1?s-1:s],g=[a&&t>1?t-1:t,a&&n>1?n-1:n],u=a?"0.5":"0.0";let d;d=o?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/g[0],",\n          ").concat(c[1]/g[1],",\n          ").concat(c[1]/g[1],");\n      const vec3 inputShapeRC = vec3(").concat(r,".0, ").concat(s,".0,\n                                     ").concat(s,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(u,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}}const Sce={kernelName:AE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o}=t,{alignCorners:i,halfPixelCenters:r,size:s}=a,[l,c]=s,g=nM().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new vce(o.shape,l,c,i,r):new Ace(o.shape,l,c,i,r);return n.runWebGLProgram(g,[o],o.dtype)}};class xce{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,a,o]=t,[,i,r]=e,s=[n&&i>1?a-1:a,n&&r>1?o-1:o],l=[n&&i>1?i-1:i,n&&r>1?r-1:r],c=s[0]/l[0],g=s[1]/l[1],u=1/c,d=1/g,h=2*Math.ceil(u)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(g,");\n\n        const float invHeightScale = float(").concat(u,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(h,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(r,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(s[0],") *\n                (float(dyR) / float(").concat(l[0],"));\n\n            float sourceFracCol =\n                float(").concat(s[1],") *\n                  (float(dyC) / float(").concat(l[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(a,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const Gce={kernelName:vE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{images:o,dy:i}=t,{alignCorners:r}=a,s=new xce(i.shape,o.shape,r);return n.runWebGLProgram(s,[i],i.dtype)}};class Zce{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      "));const a=e.map(((n,a)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]"))(a))).join(","),o=Jte(n);this.userCode="\n      void main() {\n        ".concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}}class wce{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;const a=yae("rc",n),o="".concat(a[n-1]," + 1 < ").concat(this.outputShape[n-1]),i="".concat(a[n-2]," + 1 < ").concat(this.outputShape[n-2]),r=Jte(n);function s(n){const a=e.map(((a,o)=>function(n,a){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(a[n]," - 1"):"".concat(a[n])}(o,n))),o=a.join(","),i=a.slice(-2).join(",");return"getChannel(getX(".concat(o,"), vec2(").concat(i,"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return s(e)}(a.slice()),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(a.slice()),";\n          }\n          if(").concat(i,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(a.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}}const kce={kernelName:ZE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{dims:i}=a,r=o.shape.length,s=wX(i,o.shape);if(0===r)return $ae({inputs:{x:o},backend:n});const l=nM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wce(o.shape,s):new Zce(o.shape,s);return n.runWebGLProgram(l,[o],o.dtype)}};class Bce{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],a=e[2];this.outputShape=e;let o="";o="number"==typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(o,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const Rce={kernelName:IF,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:a}=e;const{image:o}=t,{radians:i,fillValue:r,center:s}=n,l=a,c=new Bce(o.shape,r),[g,u]=hO(s,o.shape[1],o.shape[2]),d=[[g,u,Math.sin(i),Math.cos(i)]];return l.runWebGLProgram(c,[o],o.dtype,d)}},Wce=goe({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),Vce={kernelName:wE,backendName:"webgl",kernelFunc:Wce},Nce=goe({opSnippet:"return inversesqrt(x);",cpuKernelImpl:eae}),Xce={kernelName:kE,backendName:"webgl",kernelFunc:Nce};class Mce{constructor(e,t,n,a,o,i){let r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const s=Jte(o.length),l=Jte(i.length);let c="";1===n?c="i":2===n&&(c="i, j");const g="getIndices(".concat(c,")");let u="";1===a?u="i":2===a&&(u="i, coords[1]");const d="getUpdates(".concat(u,")");let h="";r&&(h="coords[0], coords[1]");const p="getDefaultValue(".concat(h,")"),m=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(o,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(g,");\n              flattenedIndex += index * ").concat(m,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(p,", sum, float(found)));\n        }\n      ")}}class Tce{constructor(e,t,n,a,o,i){let r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const s=Jte(o.length),l=Jte(i.length);let c="";1===n?c="i":2===n&&(c="i, j");const g="getIndices(".concat(c,")");let u="";1===a?u="i":2===a&&(u="i, coords[1]");const d="getUpdates(".concat(u,")");let h="";r&&(h="coords[0], coords[1]");const p="getDefaultValue(".concat(h,")"),m=t>1?"strides[j]":"strides",I=t>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(o,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(e,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(t,"; j+=2) {\n              ivec4 index = round(").concat(g,");\n              flattenedIndex += index.xz * ").concat(m,";\n              if (j + 1 < ").concat(t,") {\n                flattenedIndex += index.yw * ").concat(I,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(p,", sum, found));\n        }\n      ")}}const Ece={kernelName:BE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{indices:o,updates:i}=t,{shape:r}=a,{sliceRank:s,numUpdates:l,sliceSize:c,strides:g,outputSize:u}=WD(0,o,r),d=[u/c,c];if(0===u)return n.makeTensorInfo(r,o.dtype);const h=boe({inputs:{x:o},backend:n,attrs:{shape:[l,s]}}),p=boe({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let I;I=nM().getBool("WEBGL_PACK")?new Tce(l,s,h.shape.length,p.shape.length,g,d):new Mce(l,s,h.shape.length,p.shape.length,g,d);const C=n.runWebGLProgram(I,[p,h,m],p.dtype),f=boe({inputs:{x:C},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(m),f}};class Fce{constructor(e,t,n,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),i=2===nM().getNumber("WEBGL_VERSION")?"while (left < right) {":o,r="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(i,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(r," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}}const Hce={kernelName:WE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{sortedSequence:o,values:i}=t,{side:r}=a,s=new Fce(o.shape[0],o.shape[1],i.shape[1],r),l=[[o.shape[1]]];return n.runWebGLProgram(s,[o,i],"int32",l)}};class Jce{constructor(e,t,n){let a,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)o="resRC",a="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],r=[];for(let a=0;a<t.length;a++)r.push("".concat(n[a])),a<e&&i.push("".concat(n[a]));a=i.join(),o=r.join()}const i=Jte(n);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(o,"));\n        } else {\n          setOutput(getB(").concat(o,"));\n        }\n      }\n    ")}}const Yce={kernelName:VE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:a,t:o,e:i}=t,r=new Jce(a.shape.length,o.shape,o.shape.length);return n.runWebGLProgram(r,[a,o,i],jH(o.dtype,i.dtype))}},Lce=goe({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(bO,";\n  float scale = ").concat(yO,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),zce={kernelName:NE,backendName:"webgl",kernelFunc:Lce},Kce=goe({opSnippet:coe+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:nae}),Dce={kernelName:FE,backendName:"webgl",kernelFunc:Kce},Uce=goe({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),Pce={kernelName:EE,backendName:"webgl",kernelFunc:Uce},Oce=goe({opSnippet:coe+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(jae,"\n  return result;\n")}),_ce={kernelName:ME,backendName:"webgl",kernelFunc:Oce},Qce=goe({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),jce={kernelName:TE,backendName:"webgl",kernelFunc:Qce},qce=goe({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),$ce={kernelName:HE,backendName:"webgl",kernelFunc:qce},ege={kernelName:LE,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{blockShape:i,paddings:r}=a;IX(o.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const s=i.reduce(((e,t)=>e*t)),l=[[0,0]];l.push(...r);for(let C=1+i.length;C<o.shape.length;++C)l.push([0,0]);const c=[],g=ece({inputs:{x:o},backend:n,attrs:{paddings:l,constantValue:0}}),u=pO(g.shape,i,s,!1),d=mO(u.length,i.length,!1),h=IO(g.shape,i,s,!1),p=boe({inputs:{x:g},backend:n,attrs:{shape:u}}),m=Boe({inputs:{x:p},backend:n,attrs:{perm:d}}),I=boe({inputs:{x:m},backend:n,attrs:{shape:h}});return c.push(g),c.push(p),c.push(m),c.forEach((e=>n.disposeIntermediateTensorInfo(e))),I}};const tge={kernelName:DE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:a,values:o,denseShape:i,defaultValue:r}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==a.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(a.shape));if(1!==o.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(o.shape));if(0!==r.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(r.shape));const s=n.readSync(a.dataId),l=n.readSync(o.dataId),c=n.readSync(i.dataId),g=n.readSync(r.dataId)[0],[u,d,h,p,m]=iae(s,a.shape,a.dtype,l,o.dtype,c,g);return[n.makeTensorInfo(d,a.dtype,u),n.makeTensorInfo([d[0]],o.dtype,h),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map((e=>Number(e))))),n.makeTensorInfo([m.length],a.dtype,new Int32Array(m))]}};const nge={kernelName:UE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:a,inputShape:o,newShape:i}=t;if(2!==a.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(a.shape));if(1!==o.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(o.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const r=Array.from(n.readSync(o.dataId)),s=n.readSync(a.dataId),l=Array.from(n.readSync(i.dataId)),[c,g,u]=rae(s,a.shape,a.dtype,r,l);return[n.makeTensorInfo(g,a.dtype,c),n.makeTensorInfo([u.length],i.dtype,new Int32Array(u))]}};const age={kernelName:PE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:a,indices:o,segmentIds:i}=t;if(a.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==o.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(o.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));const r=n.readSync(a.dataId),s=n.readSync(o.dataId),l=n.readSync(i.dataId),[c,g]=sae(r,a.shape,a.dtype,s,l,!0);return n.makeTensorInfo(g,a.dtype,c)}};const oge={kernelName:OE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:a,indices:o,segmentIds:i}=t;if(a.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==o.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(o.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));const r=n.readSync(a.dataId),s=n.readSync(o.dataId),l=n.readSync(i.dataId),[c,g]=sae(r,a.shape,a.dtype,s,l);return n.makeTensorInfo(g,a.dtype,c)}};const ige={kernelName:_E,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{sparseIndices:o,sparseValues:i,defaultValue:r}=t,{outputShape:s}=a,{sliceRank:l,numUpdates:c,sliceSize:g,strides:u,outputSize:d}=WD(0,o,s),h=!1;if("string"===i.dtype){const e=n.bufferSync(o),t=n.bufferSync(i),a=SH(n.readSync(r.dataId)[0]),p=tae(e,t,s,d,g,c,l,u,a,h);return n.makeTensorInfo(s,p.dtype,p.values)}const p=new Mce(c,l,o.shape.length,i.shape.length,u,[d,1],h),m=n.runWebGLProgram(p,[i,o,r],i.dtype),I=boe({inputs:{x:m},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(m),I}};const rge={kernelName:zE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{numOrSizeSplits:i,axis:r}=a,s=wX(r,o.shape)[0],l=DO(o,i,s),c=o.shape.length,g=new Array(c).fill(0),u=o.shape.slice();return l.map((e=>{const t=[...u];t[s]=e;const a=Zie({inputs:{x:o},backend:n,attrs:{begin:g,size:t}});return g[s]+=e,a}))}},sge="return sqrt(x);",lge=goe({opSnippet:sge,packedOpSnippet:sge,cpuKernelImpl:lae}),cge={kernelName:JE,backendName:"webgl",kernelFunc:lge},gge={kernelName:jE,backendName:"webgl",kernelFunc:goe({opSnippet:"return x * x;"})},uge="return (a - b) * (a - b);",dge=uoe({opSnippet:uge,packedOpSnippet:uge}),hge={kernelName:QE,backendName:"webgl",kernelFunc:dge};const pge={kernelName:qE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t;if("string"!==o.dtype)throw new Error("Input must be of datatype string");const i=l_(n.readSync(o.dataId)),r=cae(i,"string",a);return n.makeTensorInfo(o.shape,"string",r)}};const mge={kernelName:pF,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:a}=e;const{x:o}=t,i=kae+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),r=new wae(o.shape,i);return a.runWebGLProgram(r,[o],o.dtype)}};class Ige{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const a=n.length,o=Jte(n.length),i=Jte(n.length);let r="";if(1===a)r="coords * strides + begin";else{let e=0;r=n.map(((t,a)=>(e++,1===n.length?"coords * strides[".concat(a,"] + begin[").concat(a,"]"):"coords[".concat(e-1,"] * strides[").concat(a,"] + begin[").concat(a,"]")))).join(",")}this.userCode="\n      ".concat(o," begin = ").concat(o,"(").concat(e,");\n      ").concat(o," strides = ").concat(o,"(").concat(t,");\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}}const Cge={kernelName:$E,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{begin:i,end:r,strides:s,beginMask:l,endMask:c,ellipsisMask:g,newAxisMask:u,shrinkAxisMask:d}=a,{finalShapeSparse:h,finalShape:p,isIdentity:m,sliceDim0:I,isSimpleSlice:C,begin:f,end:b,strides:y}=jP(o.shape,i,r,s,l,c,g,u,d);let A;if(m)A=boe({inputs:{x:o},backend:n,attrs:{shape:p}});else if(I||C){IX(o.shape.length>=1,(()=>"Input must have rank at least 1, got: ".concat(o.shape.length)));const e=HP(f,b,y),t=Zie({inputs:{x:o},backend:n,attrs:{begin:f,size:e}});A=boe({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else if(n.shouldExecuteOnCPU([o])){const e=n.readSync(o.dataId),t=NY(o.shape,o.dtype,e),a=gae(h,t,y,f);A=n.makeTensorInfo(p,o.dtype,a.values)}else{const e=new Ige(f,y,h);A=n.runWebGLProgram(e,[o],o.dtype)}const v=boe({inputs:{x:A},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(A),v}};const fge={kernelName:eF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{separator:o,nGramWidths:i,leftPad:r,rightPad:s,padWidth:l,preserveShortSequences:c}=a,{data:g,dataSplits:u}=t,d=n.readSync(g.dataId),h=n.readSync(u.dataId),[p,m]=uae(d,h,o,i,r,s,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(u.shape,"int32",m)]}};const bge={kernelName:tF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{skipEmpty:o}=a,{input:i,delimiter:r}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==r.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(r.shape));const s=n.readSync(i.dataId),l=n.readSync(r.dataId)[0],[c,g,u]=dae(s,l,o),d=g.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",g),n.makeTensorInfo([2],"int32",new Int32Array(u))]}};const yge={kernelName:nF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{numBuckets:o}=a,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const r=n.readSync(i.dataId),s=hae(r,o);return n.makeTensorInfo(i.shape,"int32",s)}},Age=goe({opSnippet:"return tan(x);"}),vge={kernelName:oF,backendName:"webgl",kernelFunc:Age},Sge=goe({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),xge={kernelName:iF,backendName:"webgl",kernelFunc:Sge};const Gge={kernelName:RE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{tensor:o,indices:i,updates:r}=t,{sliceRank:s,numUpdates:l,sliceSize:c,strides:g,outputSize:u}=WD(0,i,o.shape),d=[u/c,c];if(0===u)return n.makeTensorInfo(o.shape,i.dtype);const h=boe({inputs:{x:i},backend:n,attrs:{shape:[l,s]}}),p=boe({inputs:{x:r},backend:n,attrs:{shape:[l,c]}}),m=boe({inputs:{x:o},backend:n,attrs:{shape:d}}),I=new Mce(l,s,h.shape.length,p.shape.length,g,d,!1,!0),C=n.runWebGLProgram(I,[p,h,m],m.dtype),f=boe({inputs:{x:C},backend:n,attrs:{shape:o.shape}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(C),f}};class Zge{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;const a=Jte(this.rank),o=function(e){const t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],a=[];for(let o=0;o<e.length;o++)a.push("imod(".concat(n[o],", ").concat(e[o],")"));return a.join()}(e);this.userCode="\n      void main() {\n        ".concat(a," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}}function wge(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{reps:i}=a;if("string"===o.dtype||o.shape.length>5){const e=n.readSync(o.dataId),t="string"===o.dtype?e.map((e=>SH(e))):e,a=NY(o.shape,o.dtype,t),r=mae(a,i);return n.makeTensorInfo(r.shape,r.dtype,r.values)}const r=new Zge(o.shape,i);return n.runWebGLProgram(r,[o],o.dtype)}const kge={kernelName:rF,backendName:"webgl",kernelFunc:wge};class Bge{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class Rge{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function Wge(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function Vge(e){let t=1;for(;t<e;)t*=2;return t}const Nge={kernelName:sF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o}=t,{k:i,sorted:r}=a,s=nM().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=nM().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=o.shape,g=c[c.length-1];if(n.shouldExecuteOnCPU([o])||g<s||i>l){const e=n.readSync(o.dataId),[t,a]=Iae(e,c,o.dtype,i,r);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(a.shape,a.dtype,a.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,o.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===g)return[o,use({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const u=n.texData.get(o.dataId),d=null!==u&&u.isPacked,h=d?n.unpackTensor(o):o,p=bX(c)/g,m=boe({inputs:{x:h},attrs:{shape:[p,g]},backend:n});d&&Wge(n,h);const I=Vge(i),C=Vge(g);let f=null;const b=()=>null===f?[m,m]:[m,f],y=(e,t,a)=>{const o=b(),i=new Bge(a),r=[[g],[null===f?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=f;f=n.runWebGLProgram(i,o,"int32",r),Wge(n,s)};for(let G=1;G<I;G*=2){const e=2*G;for(let t=G;t>=1;t/=2)y(e,t,[p,C])}for(let G=C;G>I;G/=2){const e=b(),t=new Rge([p,G/2]),a=[[g],[null===f?1:0],[I]],o=f;f=n.runWebGLProgram(t,e,"int32",a),Wge(n,o);const i=I/2,r=2*i;for(let n=i;n>=1;n/=2)y(r,n,f.shape)}let A=f;f=Zie({inputs:{x:f},backend:n,attrs:{begin:0,size:[p,i]}}),Wge(n,A);let v=Rse({inputs:{x:m,indices:f},backend:n,attrs:{axis:1,batchDims:1}});Wge(n,m);const S=c.slice(0,-1);S.push(i),A=f,f=boe({inputs:{x:f},attrs:{shape:S},backend:n}),Wge(n,A);const x=v;return v=boe({inputs:{x:v},attrs:{shape:S},backend:n}),Wge(n,x),[v,f]}};class Xge{constructor(e,t,n,a,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const r="nearest"===n?1:2;let s;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(o,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(o,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(r," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}}const Mge={kernelName:lF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{image:o,transforms:i}=t,{interpolation:r,fillMode:s,fillValue:l,outputShape:c}=a,[g,u,d,h]=o.shape,[p,m]=null!==c&&void 0!==c?c:[u,d],I=new Xge(u,d,r,s,l,[g,p,m,h]);return n.runWebGLProgram(I,[o,i],"float32")}};const Tge={kernelName:gF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:a}=e,{axis:o}=n,{x:i}=t;Ate(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const r=a.readSync(i.dataId),{outputValues:s,outputShape:l,indices:c}=fae(r,o,i.shape,i.dtype);return[a.makeTensorInfo(l,i.dtype,s),a.makeTensorInfo([c.length],"int32",c)]}};const Ege={kernelName:uF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{value:o}=t;let{axis:i}=a;i<0&&(i+=o.shape.length);const r=o,s=r.shape.length,l=o.shape[i],c=new Array(s-1);let g=0;for(let m=0;m<s;m++)m!==i&&(c[g++]=r.shape[m]);const u=[],d=new Array(s).fill(0),h=r.shape.slice();h[i]=1;const p=new Array(l);for(let m=0;m<p.length;m++){d[i]=m;const e=Zie({inputs:{x:r},backend:n,attrs:{begin:d,size:h}}),t=boe({inputs:{x:e},backend:n,attrs:{shape:c}});p[m]=t,u.push(e)}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}};class Fge{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,a=e.batchSize,o=e.inSize,i=e.numSegments,r=i*Math.ceil(o/n);this.outputShape=[a,r];const s=4*Math.floor(n/4),l=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let g="";o%n>0&&(g="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return initializationValue;\n        }\n      "));let u="";o%n>0&&(u="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(g,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(u,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(i,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(i,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(c,"\n        } else if (").concat(2===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(c,"\n        } else if (").concat(3===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(c,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}}const Hge={kernelName:dF,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:a}=e,{x:o,segmentIds:i}=t,{numSegments:r}=a,s=o.shape.length,l=[];let c=0;const g=mz([c],s);let u=o;null!=g&&(u=Boe({inputs:{x:o},backend:n,attrs:{perm:g}}),l.push(u),c=Cz(1,s)[0]);const d=i_(u.shape,c,r),h=bX([u.shape[c]]),p=boe({inputs:{x:u},backend:n,attrs:{shape:[-1,h]}});l.push(p);const m=qH(o.dtype),I=(e,t,a,o,i)=>{const r=e.shape[0],s=e.shape[1],c=o_(s,i),g=new Fge({windowSize:c,inSize:s,batchSize:r,numSegments:i},t),u=n.compileAndRun(g,[e,a],o);if(l.push(u),u.shape[1]===i)return u;const d=lce({backend:n,attrs:{start:0,stop:i,step:1,dtype:"float32"}}),h=wge({inputs:{x:d},backend:n,attrs:{reps:[s/c]}});return l.push(d),l.push(h),I(u,t,h,o,i)},C=boe({inputs:{x:I(p,"unsortedSegmentSum",i,m,r)},backend:n,attrs:{shape:d}});let f=C;if(null!=g){l.push(C);const e=Iz(g);f=Boe({inputs:{x:f},backend:n,attrs:{perm:e}})}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}},Jge=[Noe,Moe,Eoe,Hoe,Loe,Doe,Uoe,Poe,$oe,eie,nie,oie,rie,lie,gie,hie,pie,Cie,fie,bie,vie,kie,Bie,Rie,Wie,Eie,Jie,zie,noe,Uie,ere,lre,hre,mre,Ire,Cre,fre,yre,vre,xre,Rre,Wre,Vre,Xre,Ere,Jre,Yre,zre,Dre,Ure,Ore,_re,jre,$re,tse,ase,rse,cse,dse,pse,Cse,bse,vse,Gse,Zse,kse,Wse,Nse,Mse,eoe,Tse,jie,Fse,Jse,Lse,ioe,Kse,Use,Pse,_se,jse,$se,tle,ale,rle,lle,gle,dle,hle,ple,Cle,fle,ble,yle,Ale,Sle,Zle,kle,Ele,foe,Hle,Yle,zle,Dle,Nie,Ple,Qle,jle,tce,ace,loe,oce,ice,rce,sce,cce,Mie,Wle,uce,hce,mce,yoe,fce,yce,Sce,Gce,kce,Rce,Vce,Xce,Ece,Hce,Yce,zce,Dce,Pce,_ce,jce,wie,Tle,$ce,ege,tge,nge,age,oge,ige,rge,cge,gge,hge,pge,mge,Cge,fge,bge,yge,Xle,koe,vge,xge,Gge,kge,Nge,Mge,Roe,Tge,Ege,Hge,_le];for(const n of Jge)ZF(n);const Yge="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIFd0e2NvbnN0cnVjdG9yKG49W10sZT1RdCl7aWYodGhpcy5kYXRhPW4sdGhpcy5sZW5ndGg9dGhpcy5kYXRhLmxlbmd0aCx0aGlzLmNvbXBhcmU9ZSx0aGlzLmxlbmd0aD4wKWZvcihsZXQgdD0odGhpcy5sZW5ndGg+PjEpLTE7dD49MDt0LS0pdGhpcy5fZG93bih0KX1wdXNoKG4pe3RoaXMuZGF0YS5wdXNoKG4pLHRoaXMubGVuZ3RoKyssdGhpcy5fdXAodGhpcy5sZW5ndGgtMSl9cG9wKCl7aWYodGhpcy5sZW5ndGg9PT0wKXJldHVybjtjb25zdCBuPXRoaXMuZGF0YVswXSxlPXRoaXMuZGF0YS5wb3AoKTtyZXR1cm4gdGhpcy5sZW5ndGgtLSx0aGlzLmxlbmd0aD4wJiYodGhpcy5kYXRhWzBdPWUsdGhpcy5fZG93bigwKSksbn1wZWVrKCl7cmV0dXJuIHRoaXMuZGF0YVswXX1fdXAobil7Y29uc3R7ZGF0YTplLGNvbXBhcmU6dH09dGhpcyxzPWVbbl07Zm9yKDtuPjA7KXtjb25zdCByPW4tMT4+MSxpPWVbcl07aWYodChzLGkpPj0wKWJyZWFrO2Vbbl09aSxuPXJ9ZVtuXT1zfV9kb3duKG4pe2NvbnN0e2RhdGE6ZSxjb21wYXJlOnR9PXRoaXMscz10aGlzLmxlbmd0aD4+MSxyPWVbbl07Zm9yKDtuPHM7KXtsZXQgaT0objw8MSkrMSxoPWVbaV07Y29uc3QgbD1pKzE7aWYobDx0aGlzLmxlbmd0aCYmdChlW2xdLGgpPDAmJihpPWwsaD1lW2xdKSx0KGgscik+PTApYnJlYWs7ZVtuXT1oLG49aX1lW25dPXJ9fWZ1bmN0aW9uIFF0KG8sbil7cmV0dXJuIG88bj8tMTpvPm4/MTowfWNvbnN0IHl0PW89Pntjb25zdHt2MTpuLHYyOmV9PW87bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9KG5bc11eZVtzXSk+Pj4wO3QrPVp0KHIpfXJldHVybiB0fSxadD1vPT57dmFyIG49by0obz4+MSYxNDMxNjU1NzY1KTtyZXR1cm4gbj0obj4+MiY4NTg5OTM0NTkpKyhuJjg1ODk5MzQ1OSksbj0obj4+NCkrbiYyNTI2NDUxMzUsbj0obj4+OCkrbiYxNjcxMTkzNSxuPShuPj4xNikrbiY2NTUzNSxufSxjdD0xLHZ0PW89Pntjb25zdHtrZXl3aWR0aDpuLGtleWhlaWdodDplLHF1ZXJ5d2lkdGg6dCxxdWVyeWhlaWdodDpzLG1hdGNoZXM6cn09byxpPXQqMS4yLGg9LWksbD1zKjEuMix1PS1sLGY9MTIsZz0xMCxhPS0xLGo9MSx5PTEvTWF0aC5sb2coMTApLG09TWF0aC5tYXgobixlKSxNPU1hdGguZmxvb3Iobi8yKSxUPU1hdGguZmxvb3IoZS8yKSxFPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludC5zY2FsZSxLPXJbTl0ua2V5cG9pbnQuc2NhbGU7Sz09MCYmY29uc29sZS5sb2coIkVSUk9SIGRpdmlkZSB6ZXJvIik7Y29uc3Qgdj0kL0s7RS5wdXNoKHYqbSl9RS5zb3J0KChOLCQpPT5OLSQpO2NvbnN0IFI9LjI1KkVbTWF0aC5mbG9vcihFLmxlbmd0aC8yKS0oRS5sZW5ndGglMj09MD8xOjApLTFdLHE9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGktaCkvUikpLEk9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGwtdSkvUikpLHo9cSpJLEI9eipmLGM9W10scD1bXSxTPXt9O2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludCxLPXJbTl0ua2V5cG9pbnQse3g6dix5OlYsc2NhbGU6TCxhbmdsZTpDfT14dCh7cXVlcnlwb2ludDokLGtleXBvaW50Okssa2V5Y2VudGVyWDpNLGtleWNlbnRlclk6VCxzY2FsZU9uZU92ZXJMb2dLOnl9KTtpZih2PGh8fHY+PWl8fFY8dXx8Vj49bHx8Qzw9LU1hdGguUEl8fEM+TWF0aC5QSXx8TDxhfHxMPj1qKXtjW05dPSExO2NvbnRpbnVlfWxldCBYPXEqKHYtaCkvKGktaCksd3Q9SSooVi11KS8obC11KSxwdD1mKihDK01hdGguUEkpLygyKk1hdGguUEkpLGR0PWcqKEwtYSkvKGotYSk7cFtOXT17YmluWDpYLGJpblk6d3QsYmluQW5nbGU6cHQsYmluU2NhbGU6ZHR9O2xldCBpdD1NYXRoLmZsb29yKFgtLjUpLGx0PU1hdGguZmxvb3Iod3QtLjUpLGh0PU1hdGguZmxvb3IoZHQtLjUpLGp0PShNYXRoLmZsb29yKHB0LS41KStmKSVmO2lmKGl0PDB8fGl0KzE+PXF8fGx0PDB8fGx0KzE+PUl8fGh0PDB8fGh0KzE+PWcpe2NbTl09ITE7Y29udGludWV9Zm9yKGxldCB1dD0wO3V0PDI7dXQrKyl7bGV0IGt0PWl0K3V0O2ZvcihsZXQgYnQ9MDtidDwyO2J0Kyspe2xldCB1bj1sdCtidDtmb3IobGV0IEl0PTA7SXQ8MjtJdCsrKXtsZXQgY249KGp0K0l0KSVmO2ZvcihsZXQgUnQ9MDtSdDwyO1J0Kyspe2xldCBmbj1odCtSdDtjb25zdCBOdD1rdCt1bipxK2NuKnorZm4qQjtTW050XT09PXZvaWQgMCYmKFNbTnRdPTApLFNbTnRdKz0xfX19fWNbTl09ITB9bGV0IGQ9MCxEPS0xO2lmKE9iamVjdC5rZXlzKFMpLmZvckVhY2goTj0+e1NbTl0+ZCYmKGQ9U1tOXSxEPU4pfSksZDwzKXJldHVybltdO2NvbnN0IFU9TWF0aC5mbG9vcihEJUIleiVxKSxGPU1hdGguZmxvb3IoKEQtVSklQiV6L3EpLFA9TWF0aC5mbG9vcigoRC1VLUYqcSklQi96KSxZPU1hdGguZmxvb3IoKEQtVS1GKnEtUCp6KS9CKSxHPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtpZighY1tOXSljb250aW51ZTtjb25zdCAkPXBbTl07aWYoTWF0aC5hYnMoJC5iaW5YLShVKy41KSk+PWN0fHxNYXRoLmFicygkLmJpblktKEYrLjUpKT49Y3R8fE1hdGguYWJzKCQuYmluU2NhbGUtKFkrLjUpKT49Y3QpY29udGludWU7Y29uc3QgTD1NYXRoLmFicygkLmJpbkFuZ2xlLShQKy41KSk7TWF0aC5taW4oTCxmLUwpPj1jdHx8Ry5wdXNoKHJbTl0pfXJldHVybiBHfSx4dD0oe3F1ZXJ5cG9pbnQ6byxrZXlwb2ludDpuLGtleWNlbnRlclg6ZSxrZXljZW50ZXJZOnQsc2NhbGVPbmVPdmVyTG9nSzpzfSk9PntsZXQgcj1vLmFuZ2xlLW4uYW5nbGU7cjw9LU1hdGguUEk/cis9MipNYXRoLlBJOnI+TWF0aC5QSSYmKHItPTIqTWF0aC5QSSk7Y29uc3QgaT1vLnNjYWxlL24uc2NhbGUsaD1pKk1hdGguY29zKHIpLGw9aSpNYXRoLnNpbihyKSx1PVtoLC1sLGwsaF0sZj1bdVswXSpuLngrdVsxXSpuLnksdVsyXSpuLngrdVszXSpuLnldLGc9by54LWZbMF0sYT1vLnktZlsxXTtyZXR1cm57eDp1WzBdKmUrdVsxXSp0K2cseTp1WzJdKmUrdVszXSp0K2EsYW5nbGU6cixzY2FsZTpNYXRoLmxvZyhpKSpzfX0sQXQ9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBXKG8pe3JldHVybiBBdC5jYWxsKG8pLmVuZHNXaXRoKCJBcnJheV0iKX1mdW5jdGlvbiB0ZShvKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJmFyZ3VtZW50c1sxXSE9PXZvaWQgMD9hcmd1bWVudHNbMV06e307aWYoIVcobykpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBiZSBhbiBhcnJheSIpO2lmKG8ubGVuZ3RoPT09MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IG5vdCBiZSBlbXB0eSIpO3ZhciBlPW4uZnJvbUluZGV4LHQ9ZT09PXZvaWQgMD8wOmUscz1uLnRvSW5kZXgscj1zPT09dm9pZCAwP28ubGVuZ3RoOnM7aWYodDwwfHx0Pj1vLmxlbmd0aHx8IU51bWJlci5pc0ludGVnZXIodCkpdGhyb3cgbmV3IEVycm9yKCJmcm9tSW5kZXggbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIgc21hbGxlciB0aGFuIGxlbmd0aCIpO2lmKHI8PXR8fHI+by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBFcnJvcigidG9JbmRleCBtdXN0IGJlIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIGZyb21JbmRleCBhbmQgYXQgbW9zdCBlcXVhbCB0byBsZW5ndGgiKTtmb3IodmFyIGk9b1t0XSxoPXQrMTtoPHI7aCsrKW9baF0+aSYmKGk9b1toXSk7cmV0dXJuIGl9ZnVuY3Rpb24gZWUobyl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xJiZhcmd1bWVudHNbMV0hPT12b2lkIDA/YXJndW1lbnRzWzFdOnt9O2lmKCFXKG8pKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKTt2YXIgZT1uLmZyb21JbmRleCx0PWU9PT12b2lkIDA/MDplLHM9bi50b0luZGV4LHI9cz09PXZvaWQgMD9vLmxlbmd0aDpzO2lmKHQ8MHx8dD49by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHQpKXRocm93IG5ldyBFcnJvcigiZnJvbUluZGV4IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHNtYWxsZXIgdGhhbiBsZW5ndGgiKTtpZihyPD10fHxyPm8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcihyKSl0aHJvdyBuZXcgRXJyb3IoInRvSW5kZXggbXVzdCBiZSBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBmcm9tSW5kZXggYW5kIGF0IG1vc3QgZXF1YWwgdG8gbGVuZ3RoIik7Zm9yKHZhciBpPW9bdF0saD10KzE7aDxyO2grKylvW2hdPGkmJihpPW9baF0pO3JldHVybiBpfWZ1bmN0aW9uIHF0KG8pe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MSYmYXJndW1lbnRzWzFdIT09dm9pZCAwP2FyZ3VtZW50c1sxXTp7fTtpZihXKG8pKXtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKX1lbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTt2YXIgZTtpZihuLm91dHB1dCE9PXZvaWQgMCl7aWYoIVcobi5vdXRwdXQpKXRocm93IG5ldyBUeXBlRXJyb3IoIm91dHB1dCBvcHRpb24gbXVzdCBiZSBhbiBhcnJheSBpZiBzcGVjaWZpZWQiKTtlPW4ub3V0cHV0fWVsc2UgZT1uZXcgQXJyYXkoby5sZW5ndGgpO3ZhciB0PWVlKG8pLHM9dGUobyk7aWYodD09PXMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbmltdW0gYW5kIG1heGltdW0gaW5wdXQgdmFsdWVzIGFyZSBlcXVhbC4gQ2Fubm90IHJlc2NhbGUgYSBjb25zdGFudCBhcnJheSIpO3ZhciByPW4ubWluLGk9cj09PXZvaWQgMD9uLmF1dG9NaW5NYXg/dDowOnIsaD1uLm1heCxsPWg9PT12b2lkIDA/bi5hdXRvTWluTWF4P3M6MTpoO2lmKGk+PWwpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBvcHRpb24gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4IG9wdGlvbiIpO2Zvcih2YXIgdT0obC1pKS8ocy10KSxmPTA7ZjxvLmxlbmd0aDtmKyspZVtmXT0ob1tmXS10KSp1K2k7cmV0dXJuIGV9Y29uc3QgZnQ9IiAiLnJlcGVhdCgyKSxfdD0iICIucmVwZWF0KDQpO2Z1bmN0aW9uIG5lKCl7cmV0dXJuIFR0KHRoaXMpfWZ1bmN0aW9uIFR0KG8sbj17fSl7Y29uc3R7bWF4Um93czplPTE1LG1heENvbHVtbnM6dD0xMCxtYXhOdW1TaXplOnM9OCxwYWRNaW51czpyPSJhdXRvIn09bjtyZXR1cm5gJHtvLmNvbnN0cnVjdG9yLm5hbWV9IHsKJHtmdH1bCiR7X3R9JHtzZShvLGUsdCxzLHIpfQoke2Z0fV0KJHtmdH1yb3dzOiAke28ucm93c30KJHtmdH1jb2x1bW5zOiAke28uY29sdW1uc30KfWB9ZnVuY3Rpb24gc2UobyxuLGUsdCxzKXtjb25zdHtyb3dzOnIsY29sdW1uczppfT1vLGg9TWF0aC5taW4ocixuKSxsPU1hdGgubWluKGksZSksdT1bXTtpZihzPT09ImF1dG8iKXtzPSExO3Q6Zm9yKGxldCBmPTA7ZjxoO2YrKylmb3IobGV0IGc9MDtnPGw7ZysrKWlmKG8uZ2V0KGYsZyk8MCl7cz0hMDticmVhayB0fX1mb3IobGV0IGY9MDtmPGg7ZisrKXtsZXQgZz1bXTtmb3IobGV0IGE9MDthPGw7YSsrKWcucHVzaChvZShvLmdldChmLGEpLHQscykpO3UucHVzaChgJHtnLmpvaW4oIiAiKX1gKX1yZXR1cm4gbCE9PWkmJih1W3UubGVuZ3RoLTFdKz1gIC4uLiAke2ktZX0gbW9yZSBjb2x1bW5zYCksaCE9PXImJnUucHVzaChgLi4uICR7ci1ufSBtb3JlIHJvd3NgKSx1LmpvaW4oYAoke190fWApfWZ1bmN0aW9uIG9lKG8sbixlKXtyZXR1cm4obz49MCYmZT9gICR7enQobyxuLTEpfWA6enQobyxuKSkucGFkRW5kKG4pfWZ1bmN0aW9uIHp0KG8sbil7bGV0IGU9by50b1N0cmluZygpO2lmKGUubGVuZ3RoPD1uKXJldHVybiBlO2xldCB0PW8udG9GaXhlZChuKTtpZih0Lmxlbmd0aD5uJiYodD1vLnRvRml4ZWQoTWF0aC5tYXgoMCxuLSh0Lmxlbmd0aC1uKSkpKSx0Lmxlbmd0aDw9biYmIXQuc3RhcnRzV2l0aCgiMC4wMDAiKSYmIXQuc3RhcnRzV2l0aCgiLTAuMDAwIikpcmV0dXJuIHQ7bGV0IHM9by50b0V4cG9uZW50aWFsKG4pO3JldHVybiBzLmxlbmd0aD5uJiYocz1vLnRvRXhwb25lbnRpYWwoTWF0aC5tYXgoMCxuLShzLmxlbmd0aC1uKSkpKSxzLnNsaWNlKDApfWZ1bmN0aW9uIHJlKG8sbil7by5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5hZGRTKHQpOnRoaXMuYWRkTSh0KX0sby5wcm90b3R5cGUuYWRkUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpK3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5hZGRNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSt0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5hZGQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuYWRkKHMpfSxvLnByb3RvdHlwZS5zdWI9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnN1YlModCk6dGhpcy5zdWJNKHQpfSxvLnByb3RvdHlwZS5zdWJTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciktdCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLnN1Yk09ZnVuY3Rpb24odCl7aWYodD1uLmNoZWNrTWF0cml4KHQpLHRoaXMucm93cyE9PXQucm93c3x8dGhpcy5jb2x1bW5zIT09dC5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJNYXRyaWNlcyBkaW1lbnNpb25zIG11c3QgYmUgZXF1YWwiKTtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpLXQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnN1Yj1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5zdWIocyl9LG8ucHJvdG90eXBlLnN1YnRyYWN0PW8ucHJvdG90eXBlLnN1YixvLnByb3RvdHlwZS5zdWJ0cmFjdFM9by5wcm90b3R5cGUuc3ViUyxvLnByb3RvdHlwZS5zdWJ0cmFjdE09by5wcm90b3R5cGUuc3ViTSxvLnN1YnRyYWN0PW8uc3ViLG8ucHJvdG90eXBlLm11bD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMubXVsUyh0KTp0aGlzLm11bE0odCl9LG8ucHJvdG90eXBlLm11bFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSp0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubXVsTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikqdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ubXVsPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLm11bChzKX0sby5wcm90b3R5cGUubXVsdGlwbHk9by5wcm90b3R5cGUubXVsLG8ucHJvdG90eXBlLm11bHRpcGx5Uz1vLnByb3RvdHlwZS5tdWxTLG8ucHJvdG90eXBlLm11bHRpcGx5TT1vLnByb3RvdHlwZS5tdWxNLG8ubXVsdGlwbHk9by5tdWwsby5wcm90b3R5cGUuZGl2PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5kaXZTKHQpOnRoaXMuZGl2TSh0KX0sby5wcm90b3R5cGUuZGl2Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpL3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5kaXZNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKS90LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5kaXY9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuZGl2KHMpfSxvLnByb3RvdHlwZS5kaXZpZGU9by5wcm90b3R5cGUuZGl2LG8ucHJvdG90eXBlLmRpdmlkZVM9by5wcm90b3R5cGUuZGl2UyxvLnByb3RvdHlwZS5kaXZpZGVNPW8ucHJvdG90eXBlLmRpdk0sby5kaXZpZGU9by5kaXYsby5wcm90b3R5cGUubW9kPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5tb2RTKHQpOnRoaXMubW9kTSh0KX0sby5wcm90b3R5cGUubW9kUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpJXQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5tb2RNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSV0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5tb2Q9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkubW9kKHMpfSxvLnByb3RvdHlwZS5tb2R1bHVzPW8ucHJvdG90eXBlLm1vZCxvLnByb3RvdHlwZS5tb2R1bHVzUz1vLnByb3RvdHlwZS5tb2RTLG8ucHJvdG90eXBlLm1vZHVsdXNNPW8ucHJvdG90eXBlLm1vZE0sby5tb2R1bHVzPW8ubW9kLG8ucHJvdG90eXBlLmFuZD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMuYW5kUyh0KTp0aGlzLmFuZE0odCl9LG8ucHJvdG90eXBlLmFuZFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSZ0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUuYW5kTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikmdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8uYW5kPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLmFuZChzKX0sby5wcm90b3R5cGUub3I9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLm9yUyh0KTp0aGlzLm9yTSh0KX0sby5wcm90b3R5cGUub3JTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ub3I9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkub3Iocyl9LG8ucHJvdG90eXBlLnhvcj1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMueG9yUyh0KTp0aGlzLnhvck0odCl9LG8ucHJvdG90eXBlLnhvclM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKV50KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUueG9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciledC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ueG9yPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnhvcihzKX0sby5wcm90b3R5cGUubGVmdFNoaWZ0PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5sZWZ0U2hpZnRTKHQpOnRoaXMubGVmdFNoaWZ0TSh0KX0sby5wcm90b3R5cGUubGVmdFNoaWZ0Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpPDx0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubGVmdFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik8PHQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLmxlZnRTaGlmdD1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5sZWZ0U2hpZnQocyl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTKHQpOnRoaXMuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdE0odCl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5zaWduUHJvcGFnYXRpbmdSaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdChzKX0sby5wcm90b3R5cGUucmlnaHRTaGlmdD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMucmlnaHRTaGlmdFModCk6dGhpcy5yaWdodFNoaWZ0TSh0KX0sby5wcm90b3R5cGUucmlnaHRTaGlmdFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKT4+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5yaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+Pj50LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5yaWdodFNoaWZ0PWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnJpZ2h0U2hpZnQocyl9LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdD1vLnByb3RvdHlwZS5yaWdodFNoaWZ0LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdFM9by5wcm90b3R5cGUucmlnaHRTaGlmdFMsby5wcm90b3R5cGUuemVyb0ZpbGxSaWdodFNoaWZ0TT1vLnByb3RvdHlwZS5yaWdodFNoaWZ0TSxvLnplcm9GaWxsUmlnaHRTaGlmdD1vLnJpZ2h0U2hpZnQsby5wcm90b3R5cGUubm90PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsfnRoaXMuZ2V0KHQscykpO3JldHVybiB0aGlzfSxvLm5vdD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubm90KCl9LG8ucHJvdG90eXBlLmFicz1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYWJzKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hYnM9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFicygpfSxvLnByb3RvdHlwZS5hY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hY29zPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hY29zKCl9LG8ucHJvdG90eXBlLmFjb3NoPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zaCh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYWNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFjb3NoKCl9LG8ucHJvdG90eXBlLmFzaW49ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmFzaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFzaW4oKX0sby5wcm90b3R5cGUuYXNpbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hc2luaD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXNpbmgoKX0sby5wcm90b3R5cGUuYXRhbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYXRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXRhbigpfSxvLnByb3RvdHlwZS5hdGFuaD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmF0YW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hdGFuaCgpfSxvLnByb3RvdHlwZS5jYnJ0PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jYnJ0KHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jYnJ0PWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5jYnJ0KCl9LG8ucHJvdG90eXBlLmNlaWw9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNlaWwodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNlaWw9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNlaWwoKX0sby5wcm90b3R5cGUuY2x6MzI9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNsejMyKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jbHozMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY2x6MzIoKX0sby5wcm90b3R5cGUuY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jb3ModGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvcz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY29zKCl9LG8ucHJvdG90eXBlLmNvc2g9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNvc2godGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNvc2goKX0sby5wcm90b3R5cGUuZXhwPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHAodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmV4cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuZXhwKCl9LG8ucHJvdG90eXBlLmV4cG0xPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHBtMSh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZXhwbTE9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmV4cG0xKCl9LG8ucHJvdG90eXBlLmZsb29yPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5mbG9vcih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZmxvb3I9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZsb29yKCl9LG8ucHJvdG90eXBlLmZyb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguZnJvdW5kKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5mcm91bmQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZyb3VuZCgpfSxvLnByb3RvdHlwZS5sb2c9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZyh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5sb2coKX0sby5wcm90b3R5cGUubG9nMXA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzFwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxcD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMXAoKX0sby5wcm90b3R5cGUubG9nMTA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzEwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxMD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMTAoKX0sby5wcm90b3R5cGUubG9nMj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgubG9nMih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMigpfSxvLnByb3RvdHlwZS5yb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgucm91bmQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnJvdW5kPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5yb3VuZCgpfSxvLnByb3RvdHlwZS5zaWduPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaWduKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaWduPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaWduKCl9LG8ucHJvdG90eXBlLnNpbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguc2luKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNpbigpfSxvLnByb3RvdHlwZS5zaW5oPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaW5oKCl9LG8ucHJvdG90eXBlLnNxcnQ9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnNxcnQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnNxcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNxcnQoKX0sby5wcm90b3R5cGUudGFuPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC50YW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudGFuKCl9LG8ucHJvdG90eXBlLnRhbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbmg9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnRhbmgoKX0sby5wcm90b3R5cGUudHJ1bmM9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRydW5jKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby50cnVuYz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudHJ1bmMoKX0sby5wb3c9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkucG93KHMpfSxvLnByb3RvdHlwZS5wb3c9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnBvd1ModCk6dGhpcy5wb3dNKHQpfSxvLnByb3RvdHlwZS5wb3dTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLE1hdGgucG93KHRoaXMuZ2V0KHMsciksdCkpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5wb3dNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsTWF0aC5wb3codGhpcy5nZXQocyxyKSx0LmdldChzLHIpKSk7cmV0dXJuIHRoaXN9fWZ1bmN0aW9uIFEobyxuLGUpe2xldCB0PWU/by5yb3dzOm8ucm93cy0xO2lmKG48MHx8bj50KXRocm93IG5ldyBSYW5nZUVycm9yKCJSb3cgaW5kZXggb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gWihvLG4sZSl7bGV0IHQ9ZT9vLmNvbHVtbnM6by5jb2x1bW5zLTE7aWYobjwwfHxuPnQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiB0dChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8uY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMiKTtyZXR1cm4gbn1mdW5jdGlvbiBldChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIHJvd3MiKTtyZXR1cm4gbn1mdW5jdGlvbiBpZShvLG4pe2lmKCFXKG4pKXRocm93IG5ldyBUeXBlRXJyb3IoInJvdyBpbmRpY2VzIG11c3QgYmUgYW4gYXJyYXkiKTtmb3IobGV0IGU9MDtlPG4ubGVuZ3RoO2UrKylpZihuW2VdPDB8fG5bZV0+PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigicm93IGluZGljZXMgYXJlIG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIGxlKG8sbil7aWYoIVcobikpdGhyb3cgbmV3IFR5cGVFcnJvcigiY29sdW1uIGluZGljZXMgbXVzdCBiZSBhbiBhcnJheSIpO2ZvcihsZXQgZT0wO2U8bi5sZW5ndGg7ZSsrKWlmKG5bZV08MHx8bltlXT49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJjb2x1bW4gaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gRnQobyxuLGUsdCxzKXtpZihhcmd1bWVudHMubGVuZ3RoIT09NSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiZXhwZWN0ZWQgNCBhcmd1bWVudHMiKTtpZihhdCgic3RhcnRSb3ciLG4pLGF0KCJlbmRSb3ciLGUpLGF0KCJzdGFydENvbHVtbiIsdCksYXQoImVuZENvbHVtbiIscyksbj5lfHx0PnN8fG48MHx8bj49by5yb3dzfHxlPDB8fGU+PW8ucm93c3x8dDwwfHx0Pj1vLmNvbHVtbnN8fHM8MHx8cz49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJTdWJtYXRyaXggaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gZ3QobyxuPTApe2xldCBlPVtdO2ZvcihsZXQgdD0wO3Q8bzt0KyspZS5wdXNoKG4pO3JldHVybiBlfWZ1bmN0aW9uIGF0KG8sbil7aWYodHlwZW9mIG4hPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoYCR7b30gbXVzdCBiZSBhIG51bWJlcmApfWZ1bmN0aW9uIG50KG8pe2lmKG8uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiRW1wdHkgbWF0cml4IGhhcyBubyBlbGVtZW50cyB0byBpbmRleCIpfWZ1bmN0aW9uIGhlKG8pe2xldCBuPWd0KG8ucm93cyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW2VdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIHVlKG8pe2xldCBuPWd0KG8uY29sdW1ucyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW3RdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGNlKG8pe2xldCBuPTA7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKyluKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGZlKG8pe2xldCBuPWd0KG8ucm93cywxKTtmb3IobGV0IGU9MDtlPG8ucm93czsrK2UpZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KW5bZV0qPW8uZ2V0KGUsdCk7cmV0dXJuIG59ZnVuY3Rpb24gZ2Uobyl7bGV0IG49Z3Qoby5jb2x1bW5zLDEpO2ZvcihsZXQgZT0wO2U8by5yb3dzOysrZSlmb3IobGV0IHQ9MDt0PG8uY29sdW1uczsrK3Qpblt0XSo9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBhZShvKXtsZXQgbj0xO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspbio9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBtZShvLG4sZSl7Y29uc3QgdD1vLnJvd3Mscz1vLmNvbHVtbnMscj1bXTtmb3IobGV0IGk9MDtpPHQ7aSsrKXtsZXQgaD0wLGw9MCx1PTA7Zm9yKGxldCBmPTA7ZjxzO2YrKyl1PW8uZ2V0KGksZiktZVtpXSxoKz11LGwrPXUqdTtuP3IucHVzaCgobC1oKmgvcykvKHMtMSkpOnIucHVzaCgobC1oKmgvcykvcyl9cmV0dXJuIHJ9ZnVuY3Rpb24gd2UobyxuLGUpe2NvbnN0IHQ9by5yb3dzLHM9by5jb2x1bW5zLHI9W107Zm9yKGxldCBpPTA7aTxzO2krKyl7bGV0IGg9MCxsPTAsdT0wO2ZvcihsZXQgZj0wO2Y8dDtmKyspdT1vLmdldChmLGkpLWVbaV0saCs9dSxsKz11KnU7bj9yLnB1c2goKGwtaCpoL3QpLyh0LTEpKTpyLnB1c2goKGwtaCpoL3QpL3QpfXJldHVybiByfWZ1bmN0aW9uIHBlKG8sbixlKXtjb25zdCB0PW8ucm93cyxzPW8uY29sdW1ucyxyPXQqcztsZXQgaT0wLGg9MCxsPTA7Zm9yKGxldCB1PTA7dTx0O3UrKylmb3IobGV0IGY9MDtmPHM7ZisrKWw9by5nZXQodSxmKS1lLGkrPWwsaCs9bCpsO3JldHVybiBuPyhoLWkqaS9yKS8oci0xKTooaC1pKmkvcikvcn1mdW5jdGlvbiBkZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCktbltlXSl9ZnVuY3Rpb24geWUobyxuKXtmb3IobGV0IGU9MDtlPG8ucm93cztlKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KGUsdCxvLmdldChlLHQpLW5bdF0pfWZ1bmN0aW9uIE1lKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS1uKX1mdW5jdGlvbiBFZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8uY29sdW1ucztzKyspdCs9TWF0aC5wb3coby5nZXQoZSxzKSwyKS8oby5jb2x1bW5zLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIFNlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW2VdKX1mdW5jdGlvbiBqZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5jb2x1bW5zO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8ucm93cztzKyspdCs9TWF0aC5wb3coby5nZXQocyxlKSwyKS8oby5yb3dzLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIGtlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW3RdKX1mdW5jdGlvbiBiZShvKXtjb25zdCBuPW8uc2l6ZS0xO2xldCBlPTA7Zm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKWZvcihsZXQgcz0wO3M8by5yb3dzO3MrKyllKz1NYXRoLnBvdyhvLmdldChzLHQpLDIpL247cmV0dXJuIE1hdGguc3FydChlKX1mdW5jdGlvbiBJZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCkvbil9Y2xhc3MgX3tzdGF0aWMgZnJvbTFEQXJyYXkobixlLHQpe2lmKG4qZSE9PXQubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJkYXRhIGxlbmd0aCBkb2VzIG5vdCBtYXRjaCBnaXZlbiBkaW1lbnNpb25zIik7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHRbaSplK2hdKTtyZXR1cm4gcn1zdGF0aWMgcm93VmVjdG9yKG4pe2xldCBlPW5ldyBiKDEsbi5sZW5ndGgpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KDAsdCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgY29sdW1uVmVjdG9yKG4pe2xldCBlPW5ldyBiKG4ubGVuZ3RoLDEpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KHQsMCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgemVyb3MobixlKXtyZXR1cm4gbmV3IGIobixlKX1zdGF0aWMgb25lcyhuLGUpe3JldHVybiBuZXcgYihuLGUpLmZpbGwoMSl9c3RhdGljIHJhbmQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7cmFuZG9tOnM9TWF0aC5yYW5kb219PXQ7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHMoKSk7cmV0dXJuIHJ9c3RhdGljIHJhbmRJbnQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7bWluOnM9MCxtYXg6cj0xZTMscmFuZG9tOmk9TWF0aC5yYW5kb219PXQ7aWYoIU51bWJlci5pc0ludGVnZXIocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWluIG11c3QgYmUgYW4gaW50ZWdlciIpO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1heCBtdXN0IGJlIGFuIGludGVnZXIiKTtpZihzPj1yKXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IGg9ci1zLGw9bmV3IGIobixlKTtmb3IobGV0IHU9MDt1PG47dSsrKWZvcihsZXQgZj0wO2Y8ZTtmKyspe2xldCBnPXMrTWF0aC5yb3VuZChpKCkqaCk7bC5zZXQodSxmLGcpfXJldHVybiBsfXN0YXRpYyBleWUobixlLHQpe2U9PT12b2lkIDAmJihlPW4pLHQ9PT12b2lkIDAmJih0PTEpO2xldCBzPU1hdGgubWluKG4sZSkscj10aGlzLnplcm9zKG4sZSk7Zm9yKGxldCBpPTA7aTxzO2krKylyLnNldChpLGksdCk7cmV0dXJuIHJ9c3RhdGljIGRpYWcobixlLHQpe2xldCBzPW4ubGVuZ3RoO2U9PT12b2lkIDAmJihlPXMpLHQ9PT12b2lkIDAmJih0PWUpO2xldCByPU1hdGgubWluKHMsZSx0KSxpPXRoaXMuemVyb3MoZSx0KTtmb3IobGV0IGg9MDtoPHI7aCsrKWkuc2V0KGgsaCxuW2hdKTtyZXR1cm4gaX1zdGF0aWMgbWluKG4sZSl7bj10aGlzLmNoZWNrTWF0cml4KG4pLGU9dGhpcy5jaGVja01hdHJpeChlKTtsZXQgdD1uLnJvd3Mscz1uLmNvbHVtbnMscj1uZXcgYih0LHMpO2ZvcihsZXQgaT0wO2k8dDtpKyspZm9yKGxldCBoPTA7aDxzO2grKylyLnNldChpLGgsTWF0aC5taW4obi5nZXQoaSxoKSxlLmdldChpLGgpKSk7cmV0dXJuIHJ9c3RhdGljIG1heChuLGUpe249dGhpcy5jaGVja01hdHJpeChuKSxlPXRoaXMuY2hlY2tNYXRyaXgoZSk7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IHRoaXModCxzKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgaD0wO2g8cztoKyspci5zZXQoaSxoLE1hdGgubWF4KG4uZ2V0KGksaCksZS5nZXQoaSxoKSkpO3JldHVybiByfXN0YXRpYyBjaGVja01hdHJpeChuKXtyZXR1cm4gXy5pc01hdHJpeChuKT9uOm5ldyBiKG4pfXN0YXRpYyBpc01hdHJpeChuKXtyZXR1cm4gbiE9bnVsbCYmbi5rbGFzcz09PSJNYXRyaXgifWdldCBzaXplKCl7cmV0dXJuIHRoaXMucm93cyp0aGlzLmNvbHVtbnN9YXBwbHkobil7aWYodHlwZW9mIG4hPSJmdW5jdGlvbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FsbGJhY2sgbXVzdCBiZSBhIGZ1bmN0aW9uIik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyluLmNhbGwodGhpcyxlLHQpO3JldHVybiB0aGlzfXRvMURBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5wdXNoKHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXRvMkRBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKyl7bi5wdXNoKFtdKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspbltlXS5wdXNoKHRoaXMuZ2V0KGUsdCkpfXJldHVybiBufXRvSlNPTigpe3JldHVybiB0aGlzLnRvMkRBcnJheSgpfWlzUm93VmVjdG9yKCl7cmV0dXJuIHRoaXMucm93cz09PTF9aXNDb2x1bW5WZWN0b3IoKXtyZXR1cm4gdGhpcy5jb2x1bW5zPT09MX1pc1ZlY3Rvcigpe3JldHVybiB0aGlzLnJvd3M9PT0xfHx0aGlzLmNvbHVtbnM9PT0xfWlzU3F1YXJlKCl7cmV0dXJuIHRoaXMucm93cz09PXRoaXMuY29sdW1uc31pc0VtcHR5KCl7cmV0dXJuIHRoaXMucm93cz09PTB8fHRoaXMuY29sdW1ucz09PTB9aXNTeW1tZXRyaWMoKXtpZih0aGlzLmlzU3F1YXJlKCkpe2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IGU9MDtlPD1uO2UrKylpZih0aGlzLmdldChuLGUpIT09dGhpcy5nZXQoZSxuKSlyZXR1cm4hMTtyZXR1cm4hMH1yZXR1cm4hMX1pc0VjaGVsb25Gb3JtKCl7bGV0IG49MCxlPTAsdD0tMSxzPSEwLHI9ITE7Zm9yKDtuPHRoaXMucm93cyYmczspe2ZvcihlPTAscj0hMTtlPHRoaXMuY29sdW1ucyYmcj09PSExOyl0aGlzLmdldChuLGUpPT09MD9lKys6dGhpcy5nZXQobixlKT09PTEmJmU+dD8ocj0hMCx0PWUpOihzPSExLHI9ITApO24rK31yZXR1cm4gc31pc1JlZHVjZWRFY2hlbG9uRm9ybSgpe2xldCBuPTAsZT0wLHQ9LTEscz0hMCxyPSExO2Zvcig7bjx0aGlzLnJvd3MmJnM7KXtmb3IoZT0wLHI9ITE7ZTx0aGlzLmNvbHVtbnMmJnI9PT0hMTspdGhpcy5nZXQobixlKT09PTA/ZSsrOnRoaXMuZ2V0KG4sZSk9PT0xJiZlPnQ/KHI9ITAsdD1lKToocz0hMSxyPSEwKTtmb3IobGV0IGk9ZSsxO2k8dGhpcy5yb3dzO2krKyl0aGlzLmdldChuLGkpIT09MCYmKHM9ITEpO24rK31yZXR1cm4gc31lY2hlbG9uRm9ybSgpe2xldCBuPXRoaXMuY2xvbmUoKSxlPTAsdD0wO2Zvcig7ZTxuLnJvd3MmJnQ8bi5jb2x1bW5zOyl7bGV0IHM9ZTtmb3IobGV0IHI9ZTtyPG4ucm93cztyKyspbi5nZXQocix0KT5uLmdldChzLHQpJiYocz1yKTtpZihuLmdldChzLHQpPT09MCl0Kys7ZWxzZXtuLnN3YXBSb3dzKGUscyk7bGV0IHI9bi5nZXQoZSx0KTtmb3IobGV0IGk9dDtpPG4uY29sdW1ucztpKyspbi5zZXQoZSxpLG4uZ2V0KGUsaSkvcik7Zm9yKGxldCBpPWUrMTtpPG4ucm93cztpKyspe2xldCBoPW4uZ2V0KGksdCkvbi5nZXQoZSx0KTtuLnNldChpLHQsMCk7Zm9yKGxldCBsPXQrMTtsPG4uY29sdW1ucztsKyspbi5zZXQoaSxsLG4uZ2V0KGksbCktbi5nZXQoZSxsKSpoKX1lKyssdCsrfX1yZXR1cm4gbn1yZWR1Y2VkRWNoZWxvbkZvcm0oKXtsZXQgbj10aGlzLmVjaGVsb25Gb3JtKCksZT1uLmNvbHVtbnMsdD1uLnJvd3Mscz10LTE7Zm9yKDtzPj0wOylpZihuLm1heFJvdyhzKT09PTApcy0tO2Vsc2V7bGV0IHI9MCxpPSExO2Zvcig7cjx0JiZpPT09ITE7KW4uZ2V0KHMscik9PT0xP2k9ITA6cisrO2ZvcihsZXQgaD0wO2g8cztoKyspe2xldCBsPW4uZ2V0KGgscik7Zm9yKGxldCB1PXI7dTxlO3UrKyl7bGV0IGY9bi5nZXQoaCx1KS1sKm4uZ2V0KHMsdSk7bi5zZXQoaCx1LGYpfX1zLS19cmV0dXJuIG59c2V0KCl7dGhyb3cgbmV3IEVycm9yKCJzZXQgbWV0aG9kIGlzIHVuaW1wbGVtZW50ZWQiKX1nZXQoKXt0aHJvdyBuZXcgRXJyb3IoImdldCBtZXRob2QgaXMgdW5pbXBsZW1lbnRlZCIpfXJlcGVhdChuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e3Jvd3M6ZT0xLGNvbHVtbnM6dD0xfT1uO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKGUpfHxlPD0wKXRocm93IG5ldyBUeXBlRXJyb3IoInJvd3MgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKTtpZighTnVtYmVyLmlzSW50ZWdlcih0KXx8dDw9MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJjb2x1bW5zIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIik7bGV0IHM9bmV3IGIodGhpcy5yb3dzKmUsdGhpcy5jb2x1bW5zKnQpO2ZvcihsZXQgcj0wO3I8ZTtyKyspZm9yKGxldCBpPTA7aTx0O2krKylzLnNldFN1Yk1hdHJpeCh0aGlzLHRoaXMucm93cypyLHRoaXMuY29sdW1ucyppKTtyZXR1cm4gc31maWxsKG4pe2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LG4pO3JldHVybiB0aGlzfW5lZygpe3JldHVybiB0aGlzLm11bFMoLTEpfWdldFJvdyhuKXtRKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUucHVzaCh0aGlzLmdldChuLHQpKTtyZXR1cm4gZX1nZXRSb3dWZWN0b3Iobil7cmV0dXJuIGIucm93VmVjdG9yKHRoaXMuZ2V0Um93KG4pKX1zZXRSb3cobixlKXtRKHRoaXMsbiksZT10dCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsZVt0XSk7cmV0dXJuIHRoaXN9c3dhcFJvd3MobixlKXtRKHRoaXMsbiksUSh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl7bGV0IHM9dGhpcy5nZXQobix0KTt0aGlzLnNldChuLHQsdGhpcy5nZXQoZSx0KSksdGhpcy5zZXQoZSx0LHMpfXJldHVybiB0aGlzfWdldENvbHVtbihuKXtaKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWUucHVzaCh0aGlzLmdldCh0LG4pKTtyZXR1cm4gZX1nZXRDb2x1bW5WZWN0b3Iobil7cmV0dXJuIGIuY29sdW1uVmVjdG9yKHRoaXMuZ2V0Q29sdW1uKG4pKX1zZXRDb2x1bW4obixlKXtaKHRoaXMsbiksZT1ldCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLnNldCh0LG4sZVt0XSk7cmV0dXJuIHRoaXN9c3dhcENvbHVtbnMobixlKXtaKHRoaXMsbiksWih0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxuKTt0aGlzLnNldCh0LG4sdGhpcy5nZXQodCxlKSksdGhpcy5zZXQodCxlLHMpfXJldHVybiB0aGlzfWFkZFJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KStuW3RdKTtyZXR1cm4gdGhpc31zdWJSb3dWZWN0b3Iobil7bj10dCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCktblt0XSk7cmV0dXJuIHRoaXN9bXVsUm93VmVjdG9yKG4pe249dHQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpKm5bdF0pO3JldHVybiB0aGlzfWRpdlJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KS9uW3RdKTtyZXR1cm4gdGhpc31hZGRDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkrbltlXSk7cmV0dXJuIHRoaXN9c3ViQ29sdW1uVmVjdG9yKG4pe249ZXQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpLW5bZV0pO3JldHVybiB0aGlzfW11bENvbHVtblZlY3RvcihuKXtuPWV0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KSpuW2VdKTtyZXR1cm4gdGhpc31kaXZDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkvbltlXSk7cmV0dXJuIHRoaXN9bXVsUm93KG4sZSl7USh0aGlzLG4pO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplKTtyZXR1cm4gdGhpc31tdWxDb2x1bW4obixlKXtaKHRoaXMsbik7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXRoaXMuc2V0KHQsbix0aGlzLmdldCh0LG4pKmUpO3JldHVybiB0aGlzfW1heChuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk+ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1heEluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5uJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1pbihuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk8ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1pbkluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxuJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1heFJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPmUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1heFJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk+ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1pblJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPGUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1pblJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk8ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1heENvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPmUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1heENvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik+ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fW1pbkNvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPGUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1pbkNvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik8ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fWRpYWcoKXtsZXQgbj1NYXRoLm1pbih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKSxlPVtdO2ZvcihsZXQgdD0wO3Q8bjt0KyspZS5wdXNoKHRoaXMuZ2V0KHQsdCkpO3JldHVybiBlfW5vcm0obj0iZnJvYmVuaXVzIil7bGV0IGU9MDtpZihuPT09Im1heCIpcmV0dXJuIHRoaXMubWF4KCk7aWYobj09PSJmcm9iZW5pdXMiKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKWU9ZSt0aGlzLmdldCh0LHMpKnRoaXMuZ2V0KHQscyk7cmV0dXJuIE1hdGguc3FydChlKX1lbHNlIHRocm93IG5ldyBSYW5nZUVycm9yKGB1bmtub3duIG5vcm0gdHlwZTogJHtufWApfWN1bXVsYXRpdmVTdW0oKXtsZXQgbj0wO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbis9dGhpcy5nZXQoZSx0KSx0aGlzLnNldChlLHQsbik7cmV0dXJuIHRoaXN9ZG90KG4pe18uaXNNYXRyaXgobikmJihuPW4udG8xREFycmF5KCkpO2xldCBlPXRoaXMudG8xREFycmF5KCk7aWYoZS5sZW5ndGghPT1uLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9ycyBkbyBub3QgaGF2ZSB0aGUgc2FtZSBzaXplIik7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl0Kz1lW3NdKm5bc107cmV0dXJuIHR9bW11bChuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5yb3dzLHQ9dGhpcy5jb2x1bW5zLHM9bi5jb2x1bW5zLHI9bmV3IGIoZSxzKSxpPW5ldyBGbG9hdDY0QXJyYXkodCk7Zm9yKGxldCBoPTA7aDxzO2grKyl7Zm9yKGxldCBsPTA7bDx0O2wrKylpW2xdPW4uZ2V0KGwsaCk7Zm9yKGxldCBsPTA7bDxlO2wrKyl7bGV0IHU9MDtmb3IobGV0IGY9MDtmPHQ7ZisrKXUrPXRoaXMuZ2V0KGwsZikqaVtmXTtyLnNldChsLGgsdSl9fXJldHVybiByfXN0cmFzc2VuMngyKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigyLDIpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPW4uZ2V0KDAsMCkscj10aGlzLmdldCgwLDEpLGk9bi5nZXQoMCwxKSxoPXRoaXMuZ2V0KDEsMCksbD1uLmdldCgxLDApLHU9dGhpcy5nZXQoMSwxKSxmPW4uZ2V0KDEsMSksZz0odCt1KSoocytmKSxhPShoK3UpKnMsaj10KihpLWYpLHc9dSoobC1zKSx5PSh0K3IpKmYsbT0oaC10KSoocytpKSxNPShyLXUpKihsK2YpLFQ9Zyt3LXkrTSxFPWoreSxrPWErdyxSPWctYStqK207cmV0dXJuIGUuc2V0KDAsMCxUKSxlLnNldCgwLDEsRSksZS5zZXQoMSwwLGspLGUuc2V0KDEsMSxSKSxlfXN0cmFzc2VuM3gzKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigzLDMpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPXRoaXMuZ2V0KDAsMSkscj10aGlzLmdldCgwLDIpLGk9dGhpcy5nZXQoMSwwKSxoPXRoaXMuZ2V0KDEsMSksbD10aGlzLmdldCgxLDIpLHU9dGhpcy5nZXQoMiwwKSxmPXRoaXMuZ2V0KDIsMSksZz10aGlzLmdldCgyLDIpLGE9bi5nZXQoMCwwKSxqPW4uZ2V0KDAsMSksdz1uLmdldCgwLDIpLHk9bi5nZXQoMSwwKSxtPW4uZ2V0KDEsMSksTT1uLmdldCgxLDIpLFQ9bi5nZXQoMiwwKSxFPW4uZ2V0KDIsMSksaz1uLmdldCgyLDIpLFI9KHQrcytyLWktaC1mLWcpKm0scT0odC1pKSooLWorbSksST1oKigtYStqK3ktbS1NLVQrayksej0oLXQraStoKSooYS1qK20pLEI9KGkraCkqKC1hK2opLGM9dCphLHA9KC10K3UrZikqKGEtdytNKSxTPSgtdCt1KSoody1NKSxkPSh1K2YpKigtYSt3KSxEPSh0K3Mrci1oLWwtdS1mKSpNLFU9ZiooLWErdyt5LW0tTS1UK0UpLEY9KC1yK2YrZykqKG0rVC1FKSxQPShyLWcpKihtLUUpLFk9cipULEc9KGYrZykqKC1UK0UpLE49KC1yK2grbCkqKE0rVC1rKSwkPShyLWwpKihNLWspLEs9KGgrbCkqKC1UK2spLHY9cyp5LFY9bCpFLEw9aSp3LEM9dSpqLFg9ZyprLHd0PWMrWSt2LHB0PVIreitCK2MrRitZK0csZHQ9YytwK2QrRCtZK04rSyxpdD1xK0kreitjK1krTiskLGx0PXEreitCK2MrVixodD1ZK04rJCtLK0wsanQ9YytwK1MrVStGK1ArWSx1dD1GK1ArWStHK0Msa3Q9YytwK1MrZCtYO3JldHVybiBlLnNldCgwLDAsd3QpLGUuc2V0KDAsMSxwdCksZS5zZXQoMCwyLGR0KSxlLnNldCgxLDAsaXQpLGUuc2V0KDEsMSxsdCksZS5zZXQoMSwyLGh0KSxlLnNldCgyLDAsanQpLGUuc2V0KDIsMSx1dCksZS5zZXQoMiwyLGt0KSxlfW1tdWxTdHJhc3NlbihuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5jbG9uZSgpLHQ9ZS5yb3dzLHM9ZS5jb2x1bW5zLHI9bi5yb3dzLGk9bi5jb2x1bW5zO3MhPT1yJiZjb25zb2xlLndhcm4oYE11bHRpcGx5aW5nICR7dH0geCAke3N9IGFuZCAke3J9IHggJHtpfSBtYXRyaXg6IGRpbWVuc2lvbnMgZG8gbm90IG1hdGNoLmApO2Z1bmN0aW9uIGgoZyxhLGope2xldCB3PWcucm93cyx5PWcuY29sdW1ucztpZih3PT09YSYmeT09PWopcmV0dXJuIGc7e2xldCBtPV8uemVyb3MoYSxqKTtyZXR1cm4gbT1tLnNldFN1Yk1hdHJpeChnLDAsMCksbX19bGV0IGw9TWF0aC5tYXgodCxyKSx1PU1hdGgubWF4KHMsaSk7ZT1oKGUsbCx1KSxuPWgobixsLHUpO2Z1bmN0aW9uIGYoZyxhLGosdyl7aWYoajw9NTEyfHx3PD01MTIpcmV0dXJuIGcubW11bChhKTtqJTI9PT0xJiZ3JTI9PT0xPyhnPWgoZyxqKzEsdysxKSxhPWgoYSxqKzEsdysxKSk6aiUyPT09MT8oZz1oKGcsaisxLHcpLGE9aChhLGorMSx3KSk6dyUyPT09MSYmKGc9aChnLGosdysxKSxhPWgoYSxqLHcrMSkpO2xldCB5PXBhcnNlSW50KGcucm93cy8yLDEwKSxtPXBhcnNlSW50KGcuY29sdW1ucy8yLDEwKSxNPWcuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxUPWEuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxFPWcuc3ViTWF0cml4KDAseS0xLG0sZy5jb2x1bW5zLTEpLGs9YS5zdWJNYXRyaXgoMCx5LTEsbSxhLmNvbHVtbnMtMSksUj1nLnN1Yk1hdHJpeCh5LGcucm93cy0xLDAsbS0xKSxxPWEuc3ViTWF0cml4KHksYS5yb3dzLTEsMCxtLTEpLEk9Zy5zdWJNYXRyaXgoeSxnLnJvd3MtMSxtLGcuY29sdW1ucy0xKSx6PWEuc3ViTWF0cml4KHksYS5yb3dzLTEsbSxhLmNvbHVtbnMtMSksQj1mKF8uYWRkKE0sSSksXy5hZGQoVCx6KSx5LG0pLGM9ZihfLmFkZChSLEkpLFQseSxtKSxwPWYoTSxfLnN1YihrLHopLHksbSksUz1mKEksXy5zdWIocSxUKSx5LG0pLGQ9ZihfLmFkZChNLEUpLHoseSxtKSxEPWYoXy5zdWIoUixNKSxfLmFkZChULGspLHksbSksVT1mKF8uc3ViKEUsSSksXy5hZGQocSx6KSx5LG0pLEY9Xy5hZGQoQixTKTtGLnN1YihkKSxGLmFkZChVKTtsZXQgUD1fLmFkZChwLGQpLFk9Xy5hZGQoYyxTKSxHPV8uc3ViKEIsYyk7Ry5hZGQocCksRy5hZGQoRCk7bGV0IE49Xy56ZXJvcygyKkYucm93cywyKkYuY29sdW1ucyk7cmV0dXJuIE49Ti5zZXRTdWJNYXRyaXgoRiwwLDApLE49Ti5zZXRTdWJNYXRyaXgoUCxGLnJvd3MsMCksTj1OLnNldFN1Yk1hdHJpeChZLDAsRi5jb2x1bW5zKSxOPU4uc2V0U3ViTWF0cml4KEcsRi5yb3dzLEYuY29sdW1ucyksTi5zdWJNYXRyaXgoMCxqLTEsMCx3LTEpfXJldHVybiBmKGUsbixsLHUpfXNjYWxlUm93cyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMucm93cztyKyspe2NvbnN0IGk9dGhpcy5nZXRSb3cocik7aS5sZW5ndGg+MCYmcXQoaSx7bWluOmUsbWF4OnQsb3V0cHV0Oml9KSxzLnNldFJvdyhyLGkpfXJldHVybiBzfXNjYWxlQ29sdW1ucyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspe2NvbnN0IGk9dGhpcy5nZXRDb2x1bW4ocik7aS5sZW5ndGgmJnF0KGkse21pbjplLG1heDp0LG91dHB1dDppfSkscy5zZXRDb2x1bW4ocixpKX1yZXR1cm4gc31mbGlwUm93cygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMuY29sdW1ucy8yKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQoZSx0KSxyPXRoaXMuZ2V0KGUsdGhpcy5jb2x1bW5zLTEtdCk7dGhpcy5zZXQoZSx0LHIpLHRoaXMuc2V0KGUsdGhpcy5jb2x1bW5zLTEtdCxzKX1yZXR1cm4gdGhpc31mbGlwQ29sdW1ucygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMucm93cy8yKTtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxlKSxyPXRoaXMuZ2V0KHRoaXMucm93cy0xLXQsZSk7dGhpcy5zZXQodCxlLHIpLHRoaXMuc2V0KHRoaXMucm93cy0xLXQsZSxzKX1yZXR1cm4gdGhpc31rcm9uZWNrZXJQcm9kdWN0KG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT10aGlzLnJvd3MsdD10aGlzLmNvbHVtbnMscz1uLnJvd3Mscj1uLmNvbHVtbnMsaT1uZXcgYihlKnMsdCpyKTtmb3IobGV0IGg9MDtoPGU7aCsrKWZvcihsZXQgbD0wO2w8dDtsKyspZm9yKGxldCB1PTA7dTxzO3UrKylmb3IobGV0IGY9MDtmPHI7ZisrKWkuc2V0KHMqaCt1LHIqbCtmLHRoaXMuZ2V0KGgsbCkqbi5nZXQodSxmKSk7cmV0dXJuIGl9a3JvbmVja2VyU3VtKG4pe2lmKG49Yi5jaGVja01hdHJpeChuKSwhdGhpcy5pc1NxdWFyZSgpfHwhbi5pc1NxdWFyZSgpKXRocm93IG5ldyBFcnJvcigiS3JvbmVja2VyIFN1bSBuZWVkcyB0d28gU3F1YXJlIE1hdHJpY2VzIik7bGV0IGU9dGhpcy5yb3dzLHQ9bi5yb3dzLHM9dGhpcy5rcm9uZWNrZXJQcm9kdWN0KGIuZXllKHQsdCkpLHI9Yi5leWUoZSxlKS5rcm9uZWNrZXJQcm9kdWN0KG4pO3JldHVybiBzLmFkZChyKX10cmFuc3Bvc2UoKXtsZXQgbj1uZXcgYih0aGlzLmNvbHVtbnMsdGhpcy5yb3dzKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKW4uc2V0KHQsZSx0aGlzLmdldChlLHQpKTtyZXR1cm4gbn1zb3J0Um93cyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspdGhpcy5zZXRSb3coZSx0aGlzLmdldFJvdyhlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zb3J0Q29sdW1ucyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspdGhpcy5zZXRDb2x1bW4oZSx0aGlzLmdldENvbHVtbihlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zdWJNYXRyaXgobixlLHQscyl7RnQodGhpcyxuLGUsdCxzKTtsZXQgcj1uZXcgYihlLW4rMSxzLXQrMSk7Zm9yKGxldCBpPW47aTw9ZTtpKyspZm9yKGxldCBoPXQ7aDw9cztoKyspci5zZXQoaS1uLGgtdCx0aGlzLmdldChpLGgpKTtyZXR1cm4gcn1zdWJNYXRyaXhSb3cobixlLHQpe2lmKGU9PT12b2lkIDAmJihlPTApLHQ9PT12b2lkIDAmJih0PXRoaXMuY29sdW1ucy0xKSxlPnR8fGU8MHx8ZT49dGhpcy5jb2x1bW5zfHx0PDB8fHQ+PXRoaXMuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXJndW1lbnQgb3V0IG9mIHJhbmdlIik7bGV0IHM9bmV3IGIobi5sZW5ndGgsdC1lKzEpO2ZvcihsZXQgcj0wO3I8bi5sZW5ndGg7cisrKWZvcihsZXQgaT1lO2k8PXQ7aSsrKXtpZihuW3JdPDB8fG5bcl0+PXRoaXMucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihgUm93IGluZGV4IG91dCBvZiByYW5nZTogJHtuW3JdfWApO3Muc2V0KHIsaS1lLHRoaXMuZ2V0KG5bcl0saSkpfXJldHVybiBzfXN1Yk1hdHJpeENvbHVtbihuLGUsdCl7aWYoZT09PXZvaWQgMCYmKGU9MCksdD09PXZvaWQgMCYmKHQ9dGhpcy5yb3dzLTEpLGU+dHx8ZTwwfHxlPj10aGlzLnJvd3N8fHQ8MHx8dD49dGhpcy5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKCJBcmd1bWVudCBvdXQgb2YgcmFuZ2UiKTtsZXQgcz1uZXcgYih0LWUrMSxuLmxlbmd0aCk7Zm9yKGxldCByPTA7cjxuLmxlbmd0aDtyKyspZm9yKGxldCBpPWU7aTw9dDtpKyspe2lmKG5bcl08MHx8bltyXT49dGhpcy5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKGBDb2x1bW4gaW5kZXggb3V0IG9mIHJhbmdlOiAke25bcl19YCk7cy5zZXQoaS1lLHIsdGhpcy5nZXQoaSxuW3JdKSl9cmV0dXJuIHN9c2V0U3ViTWF0cml4KG4sZSx0KXtpZihuPWIuY2hlY2tNYXRyaXgobiksbi5pc0VtcHR5KCkpcmV0dXJuIHRoaXM7bGV0IHM9ZStuLnJvd3MtMSxyPXQrbi5jb2x1bW5zLTE7RnQodGhpcyxlLHMsdCxyKTtmb3IobGV0IGk9MDtpPG4ucm93cztpKyspZm9yKGxldCBoPTA7aDxuLmNvbHVtbnM7aCsrKXRoaXMuc2V0KGUraSx0K2gsbi5nZXQoaSxoKSk7cmV0dXJuIHRoaXN9c2VsZWN0aW9uKG4sZSl7aWUodGhpcyxuKSxsZSh0aGlzLGUpO2xldCB0PW5ldyBiKG4ubGVuZ3RoLGUubGVuZ3RoKTtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9bltzXTtmb3IobGV0IGk9MDtpPGUubGVuZ3RoO2krKyl7bGV0IGg9ZVtpXTt0LnNldChzLGksdGhpcy5nZXQocixoKSl9fXJldHVybiB0fXRyYWNlKCl7bGV0IG49TWF0aC5taW4odGhpcy5yb3dzLHRoaXMuY29sdW1ucyksZT0wO2ZvcihsZXQgdD0wO3Q8bjt0KyspZSs9dGhpcy5nZXQodCx0KTtyZXR1cm4gZX1jbG9uZSgpe2xldCBuPW5ldyBiKHRoaXMucm93cyx0aGlzLmNvbHVtbnMpO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXN1bShuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBoZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIHVlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBjZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19cHJvZHVjdChuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBmZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIGdlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBhZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19bWVhbihuKXtjb25zdCBlPXRoaXMuc3VtKG4pO3N3aXRjaChuKXtjYXNlInJvdyI6e2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyllW3RdLz10aGlzLmNvbHVtbnM7cmV0dXJuIGV9Y2FzZSJjb2x1bW4iOntmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspZVt0XS89dGhpcy5yb3dzO3JldHVybiBlfWNhc2Ugdm9pZCAwOnJldHVybiBlL3RoaXMuc2l6ZTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19dmFyaWFuY2UobixlPXt9KXtpZih0eXBlb2Ygbj09Im9iamVjdCImJihlPW4sbj12b2lkIDApLHR5cGVvZiBlIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7dW5iaWFzZWQ6dD0hMCxtZWFuOnM9dGhpcy5tZWFuKG4pfT1lO2lmKHR5cGVvZiB0IT0iYm9vbGVhbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigidW5iaWFzZWQgbXVzdCBiZSBhIGJvb2xlYW4iKTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyhzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtZWFuIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4gbWUodGhpcyx0LHMpfWNhc2UiY29sdW1uIjp7aWYoIVcocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWVhbiBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIHdlKHRoaXMsdCxzKX1jYXNlIHZvaWQgMDp7aWYodHlwZW9mIHMhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIm1lYW4gbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBwZSh0aGlzLHQscyl9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXN0YW5kYXJkRGV2aWF0aW9uKG4sZSl7dHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKTtjb25zdCB0PXRoaXMudmFyaWFuY2UobixlKTtpZihuPT09dm9pZCAwKXJldHVybiBNYXRoLnNxcnQodCk7Zm9yKGxldCBzPTA7czx0Lmxlbmd0aDtzKyspdFtzXT1NYXRoLnNxcnQodFtzXSk7cmV0dXJuIHR9Y2VudGVyKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e2NlbnRlcjp0PXRoaXMubWVhbihuKX09ZTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBkZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiB5ZSh0aGlzLHQpLHRoaXN9Y2FzZSB2b2lkIDA6e2lmKHR5cGVvZiB0IT0ibnVtYmVyIil0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBNZSh0aGlzLHQpLHRoaXN9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXNjYWxlKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2xldCB0PWUuc2NhbGU7c3dpdGNoKG4pe2Nhc2Uicm93Ijp7aWYodD09PXZvaWQgMCl0PUVlKHRoaXMpO2Vsc2UgaWYoIVcodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigic2NhbGUgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBTZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZih0PT09dm9pZCAwKXQ9amUodGhpcyk7ZWxzZSBpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJzY2FsZSBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIGtlKHRoaXMsdCksdGhpc31jYXNlIHZvaWQgMDp7aWYodD09PXZvaWQgMCl0PWJlKHRoaXMpO2Vsc2UgaWYodHlwZW9mIHQhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoInNjYWxlIG11c3QgYmUgYSBudW1iZXIiKTtyZXR1cm4gSWUodGhpcyx0KSx0aGlzfWRlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtufWApfX10b1N0cmluZyhuKXtyZXR1cm4gVHQodGhpcyxuKX19Xy5wcm90b3R5cGUua2xhc3M9Ik1hdHJpeCIsdHlwZW9mIFN5bWJvbDwidSImJihfLnByb3RvdHlwZVtTeW1ib2wuZm9yKCJub2RlanMudXRpbC5pbnNwZWN0LmN1c3RvbSIpXT1uZSk7ZnVuY3Rpb24gUHQobyxuKXtyZXR1cm4gby1ufWZ1bmN0aW9uIFJlKG8pe3JldHVybiBvLmV2ZXJ5KG49PnR5cGVvZiBuPT0ibnVtYmVyIil9Xy5yYW5kb209Xy5yYW5kLF8ucmFuZG9tSW50PV8ucmFuZEludCxfLmRpYWdvbmFsPV8uZGlhZyxfLnByb3RvdHlwZS5kaWFnb25hbD1fLnByb3RvdHlwZS5kaWFnLF8uaWRlbnRpdHk9Xy5leWUsXy5wcm90b3R5cGUubmVnYXRlPV8ucHJvdG90eXBlLm5lZyxfLnByb3RvdHlwZS50ZW5zb3JQcm9kdWN0PV8ucHJvdG90eXBlLmtyb25lY2tlclByb2R1Y3Q7Y2xhc3MgYiBleHRlbmRzIF97Y29uc3RydWN0b3IobixlKXtpZihzdXBlcigpLGIuaXNNYXRyaXgobikpcmV0dXJuIG4uY2xvbmUoKTtpZihOdW1iZXIuaXNJbnRlZ2VyKG4pJiZuPj0wKWlmKHRoaXMuZGF0YT1bXSxOdW1iZXIuaXNJbnRlZ2VyKGUpJiZlPj0wKWZvcihsZXQgdD0wO3Q8bjt0KyspdGhpcy5kYXRhLnB1c2gobmV3IEZsb2F0NjRBcnJheShlKSk7ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJuQ29sdW1ucyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2Vsc2UgaWYoVyhuKSl7Y29uc3QgdD1uO2lmKG49dC5sZW5ndGgsZT1uP3RbMF0ubGVuZ3RoOjAsdHlwZW9mIGUhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIkRhdGEgbXVzdCBiZSBhIDJEIGFycmF5IHdpdGggYXQgbGVhc3Qgb25lIGVsZW1lbnQiKTt0aGlzLmRhdGE9W107Zm9yKGxldCBzPTA7czxuO3MrKyl7aWYodFtzXS5sZW5ndGghPT1lKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmNvbnNpc3RlbnQgYXJyYXkgZGltZW5zaW9ucyIpO2lmKCFSZSh0W3NdKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnB1dCBkYXRhIGNvbnRhaW5zIG5vbi1udW1lcmljIHZhbHVlcyIpO3RoaXMuZGF0YS5wdXNoKEZsb2F0NjRBcnJheS5mcm9tKHRbc10pKX19ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyIG9yIGFuIGFycmF5Iik7dGhpcy5yb3dzPW4sdGhpcy5jb2x1bW5zPWV9c2V0KG4sZSx0KXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdPXQsdGhpc31nZXQobixlKXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdfXJlbW92ZVJvdyhuKXtyZXR1cm4gUSh0aGlzLG4pLHRoaXMuZGF0YS5zcGxpY2UobiwxKSx0aGlzLnJvd3MtPTEsdGhpc31hZGRSb3cobixlKXtyZXR1cm4gZT09PXZvaWQgMCYmKGU9bixuPXRoaXMucm93cyksUSh0aGlzLG4sITApLGU9RmxvYXQ2NEFycmF5LmZyb20odHQodGhpcyxlKSksdGhpcy5kYXRhLnNwbGljZShuLDAsZSksdGhpcy5yb3dzKz0xLHRoaXN9cmVtb3ZlQ29sdW1uKG4pe1oodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspe2NvbnN0IHQ9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmNvbHVtbnMtMSk7Zm9yKGxldCBzPTA7czxuO3MrKyl0W3NdPXRoaXMuZGF0YVtlXVtzXTtmb3IobGV0IHM9bisxO3M8dGhpcy5jb2x1bW5zO3MrKyl0W3MtMV09dGhpcy5kYXRhW2VdW3NdO3RoaXMuZGF0YVtlXT10fXJldHVybiB0aGlzLmNvbHVtbnMtPTEsdGhpc31hZGRDb2x1bW4obixlKXt0eXBlb2YgZT4idSImJihlPW4sbj10aGlzLmNvbHVtbnMpLFoodGhpcyxuLCEwKSxlPWV0KHRoaXMsZSk7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXtjb25zdCBzPW5ldyBGbG9hdDY0QXJyYXkodGhpcy5jb2x1bW5zKzEpO2xldCByPTA7Zm9yKDtyPG47cisrKXNbcl09dGhpcy5kYXRhW3RdW3JdO2ZvcihzW3IrK109ZVt0XTtyPHRoaXMuY29sdW1ucysxO3IrKylzW3JdPXRoaXMuZGF0YVt0XVtyLTFdO3RoaXMuZGF0YVt0XT1zfXJldHVybiB0aGlzLmNvbHVtbnMrPTEsdGhpc319cmUoXyxiKTtjbGFzcyBzdCBleHRlbmRzIF97Y29uc3RydWN0b3Iobil7c3VwZXIoKSx0aGlzLmRhdGE9bix0aGlzLnJvd3M9bi5sZW5ndGgsdGhpcy5jb2x1bW5zPW5bMF0ubGVuZ3RofXNldChuLGUsdCl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXT10LHRoaXN9Z2V0KG4sZSl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXX19Y2xhc3MgTmV7Y29uc3RydWN0b3Iobil7bj1zdC5jaGVja01hdHJpeChuKTtsZXQgZT1uLmNsb25lKCksdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgRmxvYXQ2NEFycmF5KHQpLGk9MSxoLGwsdSxmLGcsYSxqLHcseTtmb3IoaD0wO2g8dDtoKyspcltoXT1oO2Zvcih3PW5ldyBGbG9hdDY0QXJyYXkodCksbD0wO2w8cztsKyspe2ZvcihoPTA7aDx0O2grKyl3W2hdPWUuZ2V0KGgsbCk7Zm9yKGg9MDtoPHQ7aCsrKXtmb3IoeT1NYXRoLm1pbihoLGwpLGc9MCx1PTA7dTx5O3UrKylnKz1lLmdldChoLHUpKndbdV07d1toXS09ZyxlLnNldChoLGwsd1toXSl9Zm9yKGY9bCxoPWwrMTtoPHQ7aCsrKU1hdGguYWJzKHdbaF0pPk1hdGguYWJzKHdbZl0pJiYoZj1oKTtpZihmIT09bCl7Zm9yKHU9MDt1PHM7dSsrKWE9ZS5nZXQoZix1KSxlLnNldChmLHUsZS5nZXQobCx1KSksZS5zZXQobCx1LGEpO2o9cltmXSxyW2ZdPXJbbF0scltsXT1qLGk9LWl9aWYobDx0JiZlLmdldChsLGwpIT09MClmb3IoaD1sKzE7aDx0O2grKyllLnNldChoLGwsZS5nZXQoaCxsKS9lLmdldChsLGwpKX10aGlzLkxVPWUsdGhpcy5waXZvdFZlY3Rvcj1yLHRoaXMucGl2b3RTaWduPWl9aXNTaW5ndWxhcigpe2xldCBuPXRoaXMuTFUsZT1uLmNvbHVtbnM7Zm9yKGxldCB0PTA7dDxlO3QrKylpZihuLmdldCh0LHQpPT09MClyZXR1cm4hMDtyZXR1cm4hMX1zb2x2ZShuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5MVTtpZihlLnJvd3MhPT1uLnJvd3MpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG1hdHJpeCBkaW1lbnNpb25zIik7aWYodGhpcy5pc1Npbmd1bGFyKCkpdGhyb3cgbmV3IEVycm9yKCJMVSBtYXRyaXggaXMgc2luZ3VsYXIiKTtsZXQgcz1uLmNvbHVtbnMscj1uLnN1Yk1hdHJpeFJvdyh0aGlzLnBpdm90VmVjdG9yLDAscy0xKSxpPWUuY29sdW1ucyxoLGwsdTtmb3IodT0wO3U8aTt1KyspZm9yKGg9dSsxO2g8aTtoKyspZm9yKGw9MDtsPHM7bCsrKXIuc2V0KGgsbCxyLmdldChoLGwpLXIuZ2V0KHUsbCkqZS5nZXQoaCx1KSk7Zm9yKHU9aS0xO3U+PTA7dS0tKXtmb3IobD0wO2w8cztsKyspci5zZXQodSxsLHIuZ2V0KHUsbCkvZS5nZXQodSx1KSk7Zm9yKGg9MDtoPHU7aCsrKWZvcihsPTA7bDxzO2wrKylyLnNldChoLGwsci5nZXQoaCxsKS1yLmdldCh1LGwpKmUuZ2V0KGgsdSkpfXJldHVybiByfWdldCBkZXRlcm1pbmFudCgpe2xldCBuPXRoaXMuTFU7aWYoIW4uaXNTcXVhcmUoKSl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCBtdXN0IGJlIHNxdWFyZSIpO2xldCBlPXRoaXMucGl2b3RTaWduLHQ9bi5jb2x1bW5zO2ZvcihsZXQgcz0wO3M8dDtzKyspZSo9bi5nZXQocyxzKTtyZXR1cm4gZX1nZXQgbG93ZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI+aT9zLnNldChyLGksbi5nZXQocixpKSk6cj09PWk/cy5zZXQocixpLDEpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI8PWk/cy5zZXQocixpLG4uZ2V0KHIsaSkpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgcGl2b3RQZXJtdXRhdGlvblZlY3Rvcigpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucGl2b3RWZWN0b3IpfX1mdW5jdGlvbiB4KG8sbil7bGV0IGU9MDtyZXR1cm4gTWF0aC5hYnMobyk+TWF0aC5hYnMobik/KGU9bi9vLE1hdGguYWJzKG8pKk1hdGguc3FydCgxK2UqZSkpOm4hPT0wPyhlPW8vbixNYXRoLmFicyhuKSpNYXRoLnNxcnQoMStlKmUpKTowfWNsYXNzIHZle2NvbnN0cnVjdG9yKG4pe249c3QuY2hlY2tNYXRyaXgobik7bGV0IGU9bi5jbG9uZSgpLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IEZsb2F0NjRBcnJheShzKSxpLGgsbCx1O2ZvcihsPTA7bDxzO2wrKyl7bGV0IGY9MDtmb3IoaT1sO2k8dDtpKyspZj14KGYsZS5nZXQoaSxsKSk7aWYoZiE9PTApe2ZvcihlLmdldChsLGwpPDAmJihmPS1mKSxpPWw7aTx0O2krKyllLnNldChpLGwsZS5nZXQoaSxsKS9mKTtmb3IoZS5zZXQobCxsLGUuZ2V0KGwsbCkrMSksaD1sKzE7aDxzO2grKyl7Zm9yKHU9MCxpPWw7aTx0O2krKyl1Kz1lLmdldChpLGwpKmUuZ2V0KGksaCk7Zm9yKHU9LXUvZS5nZXQobCxsKSxpPWw7aTx0O2krKyllLnNldChpLGgsZS5nZXQoaSxoKSt1KmUuZ2V0KGksbCkpfX1yW2xdPS1mfXRoaXMuUVI9ZSx0aGlzLlJkaWFnPXJ9c29sdmUobil7bj1iLmNoZWNrTWF0cml4KG4pO2xldCBlPXRoaXMuUVIsdD1lLnJvd3M7aWYobi5yb3dzIT09dCl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCByb3cgZGltZW5zaW9ucyBtdXN0IGFncmVlIik7aWYoIXRoaXMuaXNGdWxsUmFuaygpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IGlzIHJhbmsgZGVmaWNpZW50Iik7bGV0IHM9bi5jb2x1bW5zLHI9bi5jbG9uZSgpLGk9ZS5jb2x1bW5zLGgsbCx1LGY7Zm9yKHU9MDt1PGk7dSsrKWZvcihsPTA7bDxzO2wrKyl7Zm9yKGY9MCxoPXU7aDx0O2grKylmKz1lLmdldChoLHUpKnIuZ2V0KGgsbCk7Zm9yKGY9LWYvZS5nZXQodSx1KSxoPXU7aDx0O2grKylyLnNldChoLGwsci5nZXQoaCxsKStmKmUuZ2V0KGgsdSkpfWZvcih1PWktMTt1Pj0wO3UtLSl7Zm9yKGw9MDtsPHM7bCsrKXIuc2V0KHUsbCxyLmdldCh1LGwpL3RoaXMuUmRpYWdbdV0pO2ZvcihoPTA7aDx1O2grKylmb3IobD0wO2w8cztsKyspci5zZXQoaCxsLHIuZ2V0KGgsbCktci5nZXQodSxsKSplLmdldChoLHUpKX1yZXR1cm4gci5zdWJNYXRyaXgoMCxpLTEsMCxzLTEpfWlzRnVsbFJhbmsoKXtsZXQgbj10aGlzLlFSLmNvbHVtbnM7Zm9yKGxldCBlPTA7ZTxuO2UrKylpZih0aGlzLlJkaWFnW2VdPT09MClyZXR1cm4hMTtyZXR1cm4hMH1nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4uY29sdW1ucyx0PW5ldyBiKGUsZSkscyxyO2ZvcihzPTA7czxlO3MrKylmb3Iocj0wO3I8ZTtyKyspczxyP3Quc2V0KHMscixuLmdldChzLHIpKTpzPT09cj90LnNldChzLHIsdGhpcy5SZGlhZ1tzXSk6dC5zZXQocyxyLDApO3JldHVybiB0fWdldCBvcnRob2dvbmFsTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCkscixpLGgsbDtmb3IoaD10LTE7aD49MDtoLS0pe2ZvcihyPTA7cjxlO3IrKylzLnNldChyLGgsMCk7Zm9yKHMuc2V0KGgsaCwxKSxpPWg7aTx0O2krKylpZihuLmdldChoLGgpIT09MCl7Zm9yKGw9MCxyPWg7cjxlO3IrKylsKz1uLmdldChyLGgpKnMuZ2V0KHIsaSk7Zm9yKGw9LWwvbi5nZXQoaCxoKSxyPWg7cjxlO3IrKylzLnNldChyLGkscy5nZXQocixpKStsKm4uZ2V0KHIsaCkpfX1yZXR1cm4gc319Y2xhc3MgRHR7Y29uc3RydWN0b3IobixlPXt9KXtpZihuPXN0LmNoZWNrTWF0cml4KG4pLG4uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IG11c3QgYmUgbm9uLWVtcHR5Iik7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zO2NvbnN0e2NvbXB1dGVMZWZ0U2luZ3VsYXJWZWN0b3JzOnI9ITAsY29tcHV0ZVJpZ2h0U2luZ3VsYXJWZWN0b3JzOmk9ITAsYXV0b1RyYW5zcG9zZTpoPSExfT1lO2xldCBsPSEhcix1PSEhaSxmPSExLGc7aWYodDxzKWlmKCFoKWc9bi5jbG9uZSgpLGNvbnNvbGUud2FybigiQ29tcHV0aW5nIFNWRCBvbiBhIG1hdHJpeCB3aXRoIG1vcmUgY29sdW1ucyB0aGFuIHJvd3MuIENvbnNpZGVyIGVuYWJsaW5nIGF1dG9UcmFuc3Bvc2UiKTtlbHNle2c9bi50cmFuc3Bvc2UoKSx0PWcucm93cyxzPWcuY29sdW1ucyxmPSEwO2xldCBjPWw7bD11LHU9Y31lbHNlIGc9bi5jbG9uZSgpO2xldCBhPU1hdGgubWluKHQscyksaj1NYXRoLm1pbih0KzEscyksdz1uZXcgRmxvYXQ2NEFycmF5KGopLHk9bmV3IGIodCxhKSxtPW5ldyBiKHMscyksTT1uZXcgRmxvYXQ2NEFycmF5KHMpLFQ9bmV3IEZsb2F0NjRBcnJheSh0KSxFPW5ldyBGbG9hdDY0QXJyYXkoaik7Zm9yKGxldCBjPTA7YzxqO2MrKylFW2NdPWM7bGV0IGs9TWF0aC5taW4odC0xLHMpLFI9TWF0aC5tYXgoMCxNYXRoLm1pbihzLTIsdCkpLHE9TWF0aC5tYXgoayxSKTtmb3IobGV0IGM9MDtjPHE7YysrKXtpZihjPGspe3dbY109MDtmb3IobGV0IHA9YztwPHQ7cCsrKXdbY109eCh3W2NdLGcuZ2V0KHAsYykpO2lmKHdbY10hPT0wKXtnLmdldChjLGMpPDAmJih3W2NdPS13W2NdKTtmb3IobGV0IHA9YztwPHQ7cCsrKWcuc2V0KHAsYyxnLmdldChwLGMpL3dbY10pO2cuc2V0KGMsYyxnLmdldChjLGMpKzEpfXdbY109LXdbY119Zm9yKGxldCBwPWMrMTtwPHM7cCsrKXtpZihjPGsmJndbY10hPT0wKXtsZXQgUz0wO2ZvcihsZXQgZD1jO2Q8dDtkKyspUys9Zy5nZXQoZCxjKSpnLmdldChkLHApO1M9LVMvZy5nZXQoYyxjKTtmb3IobGV0IGQ9YztkPHQ7ZCsrKWcuc2V0KGQscCxnLmdldChkLHApK1MqZy5nZXQoZCxjKSl9TVtwXT1nLmdldChjLHApfWlmKGwmJmM8aylmb3IobGV0IHA9YztwPHQ7cCsrKXkuc2V0KHAsYyxnLmdldChwLGMpKTtpZihjPFIpe01bY109MDtmb3IobGV0IHA9YysxO3A8cztwKyspTVtjXT14KE1bY10sTVtwXSk7aWYoTVtjXSE9PTApe01bYysxXTwwJiYoTVtjXT0wLU1bY10pO2ZvcihsZXQgcD1jKzE7cDxzO3ArKylNW3BdLz1NW2NdO01bYysxXSs9MX1pZihNW2NdPS1NW2NdLGMrMTx0JiZNW2NdIT09MCl7Zm9yKGxldCBwPWMrMTtwPHQ7cCsrKVRbcF09MDtmb3IobGV0IHA9YysxO3A8dDtwKyspZm9yKGxldCBTPWMrMTtTPHM7UysrKVRbcF0rPU1bU10qZy5nZXQocCxTKTtmb3IobGV0IHA9YysxO3A8cztwKyspe2xldCBTPS1NW3BdL01bYysxXTtmb3IobGV0IGQ9YysxO2Q8dDtkKyspZy5zZXQoZCxwLGcuZ2V0KGQscCkrUypUW2RdKX19aWYodSlmb3IobGV0IHA9YysxO3A8cztwKyspbS5zZXQocCxjLE1bcF0pfX1sZXQgST1NYXRoLm1pbihzLHQrMSk7aWYoazxzJiYod1trXT1nLmdldChrLGspKSx0PEkmJih3W0ktMV09MCksUisxPEkmJihNW1JdPWcuZ2V0KFIsSS0xKSksTVtJLTFdPTAsbCl7Zm9yKGxldCBjPWs7YzxhO2MrKyl7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfWZvcihsZXQgYz1rLTE7Yz49MDtjLS0paWYod1tjXSE9PTApe2ZvcihsZXQgcD1jKzE7cDxhO3ArKyl7bGV0IFM9MDtmb3IobGV0IGQ9YztkPHQ7ZCsrKVMrPXkuZ2V0KGQsYykqeS5nZXQoZCxwKTtTPS1TL3kuZ2V0KGMsYyk7Zm9yKGxldCBkPWM7ZDx0O2QrKyl5LnNldChkLHAseS5nZXQoZCxwKStTKnkuZ2V0KGQsYykpfWZvcihsZXQgcD1jO3A8dDtwKyspeS5zZXQocCxjLC15LmdldChwLGMpKTt5LnNldChjLGMsMSt5LmdldChjLGMpKTtmb3IobGV0IHA9MDtwPGMtMTtwKyspeS5zZXQocCxjLDApfWVsc2V7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfX1pZih1KWZvcihsZXQgYz1zLTE7Yz49MDtjLS0pe2lmKGM8UiYmTVtjXSE9PTApZm9yKGxldCBwPWMrMTtwPHM7cCsrKXtsZXQgUz0wO2ZvcihsZXQgZD1jKzE7ZDxzO2QrKylTKz1tLmdldChkLGMpKm0uZ2V0KGQscCk7Uz0tUy9tLmdldChjKzEsYyk7Zm9yKGxldCBkPWMrMTtkPHM7ZCsrKW0uc2V0KGQscCxtLmdldChkLHApK1MqbS5nZXQoZCxjKSl9Zm9yKGxldCBwPTA7cDxzO3ArKyltLnNldChwLGMsMCk7bS5zZXQoYyxjLDEpfWxldCB6PUktMSxCPU51bWJlci5FUFNJTE9OO2Zvcig7ST4wOyl7bGV0IGMscDtmb3IoYz1JLTI7Yz49LTEmJmMhPT0tMTtjLS0pe2NvbnN0IFM9TnVtYmVyLk1JTl9WQUxVRStCKk1hdGguYWJzKHdbY10rTWF0aC5hYnMod1tjKzFdKSk7aWYoTWF0aC5hYnMoTVtjXSk8PVN8fE51bWJlci5pc05hTihNW2NdKSl7TVtjXT0wO2JyZWFrfX1pZihjPT09SS0yKXA9NDtlbHNle2xldCBTO2ZvcihTPUktMTtTPj1jJiZTIT09YztTLS0pe2xldCBkPShTIT09ST9NYXRoLmFicyhNW1NdKTowKSsoUyE9PWMrMT9NYXRoLmFicyhNW1MtMV0pOjApO2lmKE1hdGguYWJzKHdbU10pPD1CKmQpe3dbU109MDticmVha319Uz09PWM/cD0zOlM9PT1JLTE/cD0xOihwPTIsYz1TKX1zd2l0Y2goYysrLHApe2Nhc2UgMTp7bGV0IFM9TVtJLTJdO01bSS0yXT0wO2ZvcihsZXQgZD1JLTI7ZD49YztkLS0pe2xldCBEPXgod1tkXSxTKSxVPXdbZF0vRCxGPVMvRDtpZih3W2RdPUQsZCE9PWMmJihTPS1GKk1bZC0xXSxNW2QtMV09VSpNW2QtMV0pLHUpZm9yKGxldCBQPTA7UDxzO1ArKylEPVUqbS5nZXQoUCxkKStGKm0uZ2V0KFAsSS0xKSxtLnNldChQLEktMSwtRiptLmdldChQLGQpK1UqbS5nZXQoUCxJLTEpKSxtLnNldChQLGQsRCl9YnJlYWt9Y2FzZSAyOntsZXQgUz1NW2MtMV07TVtjLTFdPTA7Zm9yKGxldCBkPWM7ZDxJO2QrKyl7bGV0IEQ9eCh3W2RdLFMpLFU9d1tkXS9ELEY9Uy9EO2lmKHdbZF09RCxTPS1GKk1bZF0sTVtkXT1VKk1bZF0sbClmb3IobGV0IFA9MDtQPHQ7UCsrKUQ9VSp5LmdldChQLGQpK0YqeS5nZXQoUCxjLTEpLHkuc2V0KFAsYy0xLC1GKnkuZ2V0KFAsZCkrVSp5LmdldChQLGMtMSkpLHkuc2V0KFAsZCxEKX1icmVha31jYXNlIDM6e2NvbnN0IFM9TWF0aC5tYXgoTWF0aC5hYnMod1tJLTFdKSxNYXRoLmFicyh3W0ktMl0pLE1hdGguYWJzKE1bSS0yXSksTWF0aC5hYnMod1tjXSksTWF0aC5hYnMoTVtjXSkpLGQ9d1tJLTFdL1MsRD13W0ktMl0vUyxVPU1bSS0yXS9TLEY9d1tjXS9TLFA9TVtjXS9TLFk9KChEK2QpKihELWQpK1UqVSkvMixHPWQqVSooZCpVKTtsZXQgTj0wOyhZIT09MHx8RyE9PTApJiYoWTwwP049MC1NYXRoLnNxcnQoWSpZK0cpOk49TWF0aC5zcXJ0KFkqWStHKSxOPUcvKFkrTikpO2xldCAkPShGK2QpKihGLWQpK04sSz1GKlA7Zm9yKGxldCB2PWM7djxJLTE7disrKXtsZXQgVj14KCQsSyk7Vj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpO2xldCBMPSQvVixDPUsvVjtpZih2IT09YyYmKE1bdi0xXT1WKSwkPUwqd1t2XStDKk1bdl0sTVt2XT1MKk1bdl0tQyp3W3ZdLEs9Qyp3W3YrMV0sd1t2KzFdPUwqd1t2KzFdLHUpZm9yKGxldCBYPTA7WDxzO1grKylWPUwqbS5nZXQoWCx2KStDKm0uZ2V0KFgsdisxKSxtLnNldChYLHYrMSwtQyptLmdldChYLHYpK0wqbS5nZXQoWCx2KzEpKSxtLnNldChYLHYsVik7aWYoVj14KCQsSyksVj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpLEw9JC9WLEM9Sy9WLHdbdl09ViwkPUwqTVt2XStDKndbdisxXSx3W3YrMV09LUMqTVt2XStMKndbdisxXSxLPUMqTVt2KzFdLE1bdisxXT1MKk1bdisxXSxsJiZ2PHQtMSlmb3IobGV0IFg9MDtYPHQ7WCsrKVY9TCp5LmdldChYLHYpK0MqeS5nZXQoWCx2KzEpLHkuc2V0KFgsdisxLC1DKnkuZ2V0KFgsdikrTCp5LmdldChYLHYrMSkpLHkuc2V0KFgsdixWKX1NW0ktMl09JDticmVha31jYXNlIDQ6e2lmKHdbY108PTAmJih3W2NdPXdbY108MD8td1tjXTowLHUpKWZvcihsZXQgUz0wO1M8PXo7UysrKW0uc2V0KFMsYywtbS5nZXQoUyxjKSk7Zm9yKDtjPHomJiEod1tjXT49d1tjKzFdKTspe2xldCBTPXdbY107aWYod1tjXT13W2MrMV0sd1tjKzFdPVMsdSYmYzxzLTEpZm9yKGxldCBkPTA7ZDxzO2QrKylTPW0uZ2V0KGQsYysxKSxtLnNldChkLGMrMSxtLmdldChkLGMpKSxtLnNldChkLGMsUyk7aWYobCYmYzx0LTEpZm9yKGxldCBkPTA7ZDx0O2QrKylTPXkuZ2V0KGQsYysxKSx5LnNldChkLGMrMSx5LmdldChkLGMpKSx5LnNldChkLGMsUyk7YysrfUktLTticmVha319fWlmKGYpe2xldCBjPW07bT15LHk9Y310aGlzLm09dCx0aGlzLm49cyx0aGlzLnM9dyx0aGlzLlU9eSx0aGlzLlY9bX1zb2x2ZShuKXtsZXQgZT1uLHQ9dGhpcy50aHJlc2hvbGQscz10aGlzLnMubGVuZ3RoLHI9Yi56ZXJvcyhzLHMpO2ZvcihsZXQgYT0wO2E8czthKyspTWF0aC5hYnModGhpcy5zW2FdKTw9dD9yLnNldChhLGEsMCk6ci5zZXQoYSxhLDEvdGhpcy5zW2FdKTtsZXQgaT10aGlzLlUsaD10aGlzLnJpZ2h0U2luZ3VsYXJWZWN0b3JzLGw9aC5tbXVsKHIpLHU9aC5yb3dzLGY9aS5yb3dzLGc9Yi56ZXJvcyh1LGYpO2ZvcihsZXQgYT0wO2E8dTthKyspZm9yKGxldCBqPTA7ajxmO2orKyl7bGV0IHc9MDtmb3IobGV0IHk9MDt5PHM7eSsrKXcrPWwuZ2V0KGEseSkqaS5nZXQoaix5KTtnLnNldChhLGosdyl9cmV0dXJuIGcubW11bChlKX1zb2x2ZUZvckRpYWdvbmFsKG4pe3JldHVybiB0aGlzLnNvbHZlKGIuZGlhZyhuKSl9aW52ZXJzZSgpe2xldCBuPXRoaXMuVixlPXRoaXMudGhyZXNob2xkLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IGIodCx0aGlzLnMubGVuZ3RoKTtmb3IobGV0IGY9MDtmPHQ7ZisrKWZvcihsZXQgZz0wO2c8cztnKyspTWF0aC5hYnModGhpcy5zW2ddKT5lJiZyLnNldChmLGcsbi5nZXQoZixnKS90aGlzLnNbZ10pO2xldCBpPXRoaXMuVSxoPWkucm93cyxsPWkuY29sdW1ucyx1PW5ldyBiKHQsaCk7Zm9yKGxldCBmPTA7Zjx0O2YrKylmb3IobGV0IGc9MDtnPGg7ZysrKXtsZXQgYT0wO2ZvcihsZXQgaj0wO2o8bDtqKyspYSs9ci5nZXQoZixqKSppLmdldChnLGopO3Uuc2V0KGYsZyxhKX1yZXR1cm4gdX1nZXQgY29uZGl0aW9uKCl7cmV0dXJuIHRoaXMuc1swXS90aGlzLnNbTWF0aC5taW4odGhpcy5tLHRoaXMubiktMV19Z2V0IG5vcm0yKCl7cmV0dXJuIHRoaXMuc1swXX1nZXQgcmFuaygpe2xldCBuPU1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXSpOdW1iZXIuRVBTSUxPTixlPTAsdD10aGlzLnM7Zm9yKGxldCBzPTAscj10Lmxlbmd0aDtzPHI7cysrKXRbc10+biYmZSsrO3JldHVybiBlfWdldCBkaWFnb25hbCgpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucyl9Z2V0IHRocmVzaG9sZCgpe3JldHVybiBOdW1iZXIuRVBTSUxPTi8yKk1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXX1nZXQgbGVmdFNpbmd1bGFyVmVjdG9ycygpe3JldHVybiB0aGlzLlV9Z2V0IHJpZ2h0U2luZ3VsYXJWZWN0b3JzKCl7cmV0dXJuIHRoaXMuVn1nZXQgZGlhZ29uYWxNYXRyaXgoKXtyZXR1cm4gYi5kaWFnKHRoaXMucyl9fWZ1bmN0aW9uIE10KG8sbj0hMSl7cmV0dXJuIG89c3QuY2hlY2tNYXRyaXgobyksbj9uZXcgRHQobykuaW52ZXJzZSgpOnFlKG8sYi5leWUoby5yb3dzKSl9ZnVuY3Rpb24gcWUobyxuLGU9ITEpe3JldHVybiBvPXN0LmNoZWNrTWF0cml4KG8pLG49c3QuY2hlY2tNYXRyaXgobiksZT9uZXcgRHQobykuc29sdmUobik6by5pc1NxdWFyZSgpP25ldyBOZShvKS5zb2x2ZShuKTpuZXcgdmUobykuc29sdmUobil9Y29uc3QgX2U9MTIzNCxUZT0oKT0+KHtzZWVkOl9lLGFycmF5U2h1ZmZsZShuKXtjb25zdHthcnI6ZSxzYW1wbGVTaXplOnR9PW47Zm9yKGxldCBzPTA7czx0O3MrKyl7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCByPXRoaXMuc2VlZD4+MTYmMzI3Njc7cj1yJWUubGVuZ3RoO2xldCBpPWVbc107ZVtzXT1lW3JdLGVbcl09aX19LG5leHRJbnQobil7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCBlPXRoaXMuc2VlZD4+MTYmMzI3Njc7cmV0dXJuIGU9ZSVuLGV9fSksSj0obyxuLGUpPT4oblswXS1vWzBdKSooZVsxXS1vWzFdKS0oblsxXS1vWzFdKSooZVswXS1vWzBdKSx6ZT0obyxuLGUsdCxzLHIsaSxoKT0+IShKKG8sbixlKT4wIT1KKHMscixpKT4wfHxKKG4sZSx0KT4wIT1KKHIsaSxoKT4wfHxKKGUsdCxvKT4wIT1KKGksaCxzKT4wfHxKKHQsbyxuKT4wIT1KKGgscyxyKT4wKSxGZT0obyxuLGUsdCxzLHIpPT5KKG8sbixlKT4wPT1KKHQscyxyKT4wLFBlPW89Pntjb25zdCBuPW9bNF0qb1s4XS1vWzVdKm9bN10sZT1vWzNdKm9bOF0tb1s1XSpvWzZdLHQ9b1szXSpvWzddLW9bNF0qb1s2XTtyZXR1cm4gb1swXSpuLW9bMV0qZStvWzJdKnR9LEJ0PShvLG4pPT57Y29uc3QgZT1QZShvKTtpZihNYXRoLmFicyhlKTw9bilyZXR1cm4gbnVsbDtjb25zdCB0PTEvZTtyZXR1cm5bKG9bNF0qb1s4XS1vWzVdKm9bN10pKnQsKG9bMl0qb1s3XS1vWzFdKm9bOF0pKnQsKG9bMV0qb1s1XS1vWzJdKm9bNF0pKnQsKG9bNV0qb1s2XS1vWzNdKm9bOF0pKnQsKG9bMF0qb1s4XS1vWzJdKm9bNl0pKnQsKG9bMl0qb1szXS1vWzBdKm9bNV0pKnQsKG9bM10qb1s3XS1vWzRdKm9bNl0pKnQsKG9bMV0qb1s2XS1vWzBdKm9bN10pKnQsKG9bMF0qb1s0XS1vWzFdKm9bM10pKnRdfSxvdD0obyxuKT0+e2NvbnN0IGU9bls2XSpvWzBdK25bN10qb1sxXStuWzhdLHQ9W107cmV0dXJuIHRbMF09KG5bMF0qb1swXStuWzFdKm9bMV0rblsyXSkvZSx0WzFdPShuWzNdKm9bMF0rbls0XSpvWzFdK25bNV0pL2UsdH0sRGU9KG8sbixlLHQpPT57Y29uc3Qgcz1ydChuLG8pLHI9cnQoZSxvKSxpPXJ0KHQsbyksaD1ydChuLGUpLGw9cnQodCxlKSx1PW10KHMsciksZj1tdChyLGkpLGc9bXQocyxpKSxhPW10KGgsbCk7cmV0dXJuIE1hdGgubWluKE1hdGgubWluKE1hdGgubWluKHUsZiksZyksYSl9LEJlPShvLG4sZSx0KT0+e2NvbnN0IHM9SihvLG4sZSk8PTA7cmV0dXJuIShKKG4sZSx0KTw9MCE9PXN8fEooZSx0LG8pPD0wIT09c3x8Sih0LG8sbik8PTAhPT1zKX0scnQ9KG8sbik9PltvWzBdLW5bMF0sb1sxXS1uWzFdXSxtdD0obyxuKT0+e2NvbnN0IGU9b1swXSpuWzFdLW9bMV0qblswXTtyZXR1cm4gTWF0aC5hYnMoZSkqLjV9LFZ0PShvLG4pPT57Y29uc3R7bm9ybVBvaW50czplLHBhcmFtOnR9PVh0KG8pLHtub3JtUG9pbnRzOnMscGFyYW06cn09WHQobiksaT1zLmxlbmd0aCxoPVtdLGw9W107Zm9yKGxldCB1PTA7dTxpO3UrKyl7Y29uc3QgZj1bZVt1XVswXSxlW3VdWzFdLDEsMCwwLDAsLShlW3VdWzBdKnNbdV1bMF0pLC0oZVt1XVsxXSpzW3VdWzBdKV0sZz1bMCwwLDAsZVt1XVswXSxlW3VdWzFdLDEsLShlW3VdWzBdKnNbdV1bMV0pLC0oZVt1XVsxXSpzW3VdWzFdKV07aC5wdXNoKGYpLGgucHVzaChnKSxsLnB1c2goW3NbdV1bMF1dKSxsLnB1c2goW3NbdV1bMV1dKX10cnl7Y29uc3QgdT1uZXcgYihoKSxmPW5ldyBiKGwpLGc9dS50cmFuc3Bvc2UoKSxhPWcubW11bCh1KSxqPWcubW11bChmKSx5PU10KGEpLm1tdWwoaikudG8xREFycmF5KCk7cmV0dXJuIFZlKHksdCxyKX1jYXRjaHtyZXR1cm4gbnVsbH19LFh0PW89PntsZXQgbj0wLGU9MDtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyluKz1vW2xdWzBdLGUrPW9bbF1bMV07bGV0IHQ9bi9vLmxlbmd0aCxzPWUvby5sZW5ndGgscj0wO2ZvcihsZXQgbD0wO2w8by5sZW5ndGg7bCsrKXtjb25zdCB1PW9bbF1bMF0tdCxmPW9bbF1bMV0tcztyKz1NYXRoLnNxcnQodSp1K2YqZil9bGV0IGk9TWF0aC5zcXJ0KDIpKm8ubGVuZ3RoL3I7Y29uc3QgaD1bXTtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyloLnB1c2goWyhvW2xdWzBdLXQpKmksKG9bbF1bMV0tcykqaV0pO3JldHVybntub3JtUG9pbnRzOmgscGFyYW06e21lYW5YOnQsbWVhblk6cyxzOml9fX0sVmU9KG8sbixlKT0+e2NvbnN0IHQ9ZS5zKmUubWVhblgscz1lLnMqZS5tZWFuWSxyPVtvWzBdK3Qqb1s2XSxvWzFdK3Qqb1s3XSwob1swXSt0Km9bNl0pKi1uLm1lYW5YKyhvWzFdK3Qqb1s3XSkqLW4ubWVhblkrKG9bMl0rdCkvbi5zLG9bM10rcypvWzZdLG9bNF0rcypvWzddLChvWzNdK3Mqb1s2XSkqLW4ubWVhblgrKG9bNF0rcypvWzddKSotbi5tZWFuWSsob1s1XStzKS9uLnMsZS5zKm9bNl0sZS5zKm9bN10sZS5zKm9bNl0qLW4ubWVhblgrZS5zKm9bN10qLW4ubWVhblkrZS5zL24uc107Zm9yKGxldCBpPTA7aTw5O2krKylyW2ldPXJbaV0vcls4XTtyZXR1cm4gcn0sWGU9LjAxLFVlPTEwLCRlPTIwLExlPTEwLFV0PW89Pntjb25zdHtzcmNQb2ludHM6bixkc3RQb2ludHM6ZSxrZXlmcmFtZTp0LHF1aWNrTW9kZTpzfT1vLHI9W1swLDBdLFt0LndpZHRoLDBdLFt0LndpZHRoLHQuaGVpZ2h0XSxbMCx0LmhlaWdodF1dLGk9NDtpZihuLmxlbmd0aDxpKXJldHVybiBudWxsO2NvbnN0IGg9WGUsbD0xLyhoKmgpLHU9TWF0aC5taW4oVWUsbi5sZW5ndGgpLGY9VGUoKSxnPVtdO2ZvcihsZXQgRT0wO0U8bi5sZW5ndGg7RSsrKWdbRV09RTtmLmFycmF5U2h1ZmZsZSh7YXJyOmcsc2FtcGxlU2l6ZTpnLmxlbmd0aH0pO2NvbnN0IGE9cz9MZTokZSxqPWEqMjtsZXQgdz0wO2NvbnN0IHk9W107Zm9yKDt3PGomJnkubGVuZ3RoPGE7KXtpZih3Kz0xLGYuYXJyYXlTaHVmZmxlKHthcnI6ZyxzYW1wbGVTaXplOml9KSwhemUobltnWzBdXSxuW2dbMV1dLG5bZ1syXV0sbltnWzNdXSxlW2dbMF1dLGVbZ1sxXV0sZVtnWzJdXSxlW2dbM11dKSljb250aW51ZTtjb25zdCBFPVZ0KFtuW2dbMF1dLG5bZ1sxXV0sbltnWzJdXSxuW2dbM11dXSxbZVtnWzBdXSxlW2dbMV1dLGVbZ1syXV0sZVtnWzNdXV0pO0UhPT1udWxsJiZIZSh7SDpFLHRlc3RQb2ludHM6cn0pJiZ5LnB1c2goRSl9aWYoeS5sZW5ndGg9PT0wKXJldHVybiBudWxsO2NvbnN0IG09W107Zm9yKGxldCBFPTA7RTx5Lmxlbmd0aDtFKyspbS5wdXNoKHtIOnlbRV0sY29zdDowfSk7bGV0IE09dTtmb3IobGV0IEU9MDtFPG4ubGVuZ3RoJiZtLmxlbmd0aD4yO0UrPU0pe009TWF0aC5taW4odSxuLmxlbmd0aC1FKTtsZXQgaz1FK007Zm9yKGxldCBSPTA7UjxtLmxlbmd0aDtSKyspZm9yKGxldCBxPUU7cTxrO3ErKyl7Y29uc3QgST1DZSh7SDptW1JdLkgsc3JjUG9pbnQ6bltxXSxkc3RQb2ludDplW3FdLG9uZU92ZXJTY2FsZTI6bH0pO21bUl0uY29zdCs9SX1tLnNvcnQoKFIscSk9PlIuY29zdC1xLmNvc3QpLG0uc3BsaWNlKC1NYXRoLmZsb29yKChtLmxlbmd0aCsxKS8yKSl9bGV0IFQ9bnVsbDtmb3IobGV0IEU9MDtFPG0ubGVuZ3RoO0UrKyl7Y29uc3Qgaz1ZZSh7aW5IOm1bRV0uSH0pO2lmKE9lKHtIOmssdGVzdFBvaW50czpyLGtleWZyYW1lOnR9KSl7VD1rO2JyZWFrfX1yZXR1cm4gVH0sT2U9KHtIOm8sdGVzdFBvaW50czpuLGtleWZyYW1lOmV9KT0+e2NvbnN0IHQ9QnQobywxZS01KTtpZih0PT09bnVsbClyZXR1cm4hMTtjb25zdCBzPVtdO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKXMucHVzaChvdChuW2ldLHQpKTtyZXR1cm4hKERlKHNbMF0sc1sxXSxzWzJdLHNbM10pPGUud2lkdGgqZS5oZWlnaHQqMWUtNHx8IUJlKHNbMF0sc1sxXSxzWzJdLHNbM10pKX0sWWU9KHtpbkg6b30pPT57Y29uc3Qgbj0xL29bOF0sZT1bXTtmb3IobGV0IHQ9MDt0PDg7dCsrKWVbdF09b1t0XSpuO3JldHVybiBlWzhdPTEsZX0sQ2U9KHtIOm8sc3JjUG9pbnQ6bixkc3RQb2ludDplLG9uZU92ZXJTY2FsZTI6dH0pPT57Y29uc3Qgcz1vdChuLG8pLHI9W3NbMF0tZVswXSxzWzFdLWVbMV1dO3JldHVybiBNYXRoLmxvZygxKyhyWzBdKnJbMF0rclsxXSpyWzFdKSp0KX0sSGU9KHtIOm8sdGVzdFBvaW50czpufSk9Pntjb25zdCBlPVtdO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWVbdF09b3Qoblt0XSxvKTtmb3IobGV0IHQ9MDt0PG4ubGVuZ3RoO3QrKyl7Y29uc3Qgcz10LHI9KHQrMSklbi5sZW5ndGgsaT0odCsyKSVuLmxlbmd0aDtpZighRmUobltzXSxuW3JdLG5baV0sZVtzXSxlW3JdLGVbaV0pKXJldHVybiExfXJldHVybiEwfSwkdD0zLEx0PTYsS2U9OCxPdD0uNyxKZT0oe2tleWZyYW1lOm8scXVlcnlwb2ludHM6bixxdWVyeXdpZHRoOmUscXVlcnloZWlnaHQ6dCxkZWJ1Z01vZGU6c30pPT57bGV0IHI9e307Y29uc3QgaT1bXTtmb3IobGV0IG09MDttPG4ubGVuZ3RoO20rKyl7Y29uc3QgTT1uW21dLFQ9TS5tYXhpbWE/by5tYXhpbWFQb2ludHM6by5taW5pbWFQb2ludHM7aWYoVC5sZW5ndGg9PT0wKWNvbnRpbnVlO2NvbnN0IEU9TS5tYXhpbWE/by5tYXhpbWFQb2ludHNDbHVzdGVyLnJvb3ROb2RlOm8ubWluaW1hUG9pbnRzQ2x1c3Rlci5yb290Tm9kZSxrPVtdLFI9bmV3IFd0KFtdLChCLGMpPT5CLmQtYy5kKTtFdCh7bm9kZTpFLGtleXBvaW50czpULHF1ZXJ5cG9pbnQ6TSxxdWV1ZTpSLGtleXBvaW50SW5kZXhlczprLG51bVBvcDowfSk7bGV0IHE9LTEsST1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUix6PU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2ZvcihsZXQgQj0wO0I8ay5sZW5ndGg7QisrKXtjb25zdCBjPVRba1tCXV0scD15dCh7djE6Yy5kZXNjcmlwdG9ycyx2MjpNLmRlc2NyaXB0b3JzfSk7cDxJPyh6PUksST1wLHE9a1tCXSk6cDx6JiYoej1wKX1xIT09LTEmJih6PT09TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJ8fDEqSS96PE90KSYmaS5wdXNoKHtxdWVyeXBvaW50Ok0sa2V5cG9pbnQ6VFtxXX0pfWlmKHMmJihyLm1hdGNoZXM9aSksaS5sZW5ndGg8THQpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgaD12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczppfSk7cyYmKHIuaG91Z2hNYXRjaGVzPWgpO2NvbnN0IGw9VXQoe3NyY1BvaW50czpoLm1hcChtPT5bbS5rZXlwb2ludC54LG0ua2V5cG9pbnQueV0pLGRzdFBvaW50czpoLm1hcChtPT5bbS5xdWVyeXBvaW50LngsbS5xdWVyeXBvaW50LnldKSxrZXlmcmFtZTpvfSk7aWYobD09PW51bGwpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgdT1ZdCh7SDpsLG1hdGNoZXM6aCx0aHJlc2hvbGQ6JHR9KTtpZihzJiYoci5pbmxpZXJNYXRjaGVzPXUpLHUubGVuZ3RoPEx0KXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IGY9QnQobCwxZS01KSxnPTEwKjEwLGE9W107Zm9yKGxldCBtPTA7bTxuLmxlbmd0aDttKyspe2NvbnN0IE09blttXSxUPW90KFtNLngsTS55XSxmKTtsZXQgRT0tMSxrPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSLFI9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Y29uc3QgcT1NLm1heGltYT9vLm1heGltYVBvaW50czpvLm1pbmltYVBvaW50cztmb3IobGV0IEk9MDtJPHEubGVuZ3RoO0krKyl7Y29uc3Qgej1xW0ldO2lmKCh6LngtVFswXSkqKHoueC1UWzBdKSsoei55LVRbMV0pKih6LnktVFsxXSk+Zyljb250aW51ZTtjb25zdCBjPXl0KHt2MTp6LmRlc2NyaXB0b3JzLHYyOk0uZGVzY3JpcHRvcnN9KTtjPGs/KFI9ayxrPWMsRT1JKTpjPFImJihSPWMpfUUhPT0tMSYmKFI9PT1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUnx8MSprL1I8T3QpJiZhLnB1c2goe3F1ZXJ5cG9pbnQ6TSxrZXlwb2ludDpxW0VdfSl9cyYmKHIubWF0Y2hlczI9YSk7Y29uc3Qgaj12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczphfSk7cyYmKHIuaG91Z2hNYXRjaGVzMj1qKTtjb25zdCB3PVV0KHtzcmNQb2ludHM6ai5tYXAobT0+W20ua2V5cG9pbnQueCxtLmtleXBvaW50LnldKSxkc3RQb2ludHM6ai5tYXAobT0+W20ucXVlcnlwb2ludC54LG0ucXVlcnlwb2ludC55XSksa2V5ZnJhbWU6b30pO2lmKHc9PT1udWxsKXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IHk9WXQoe0g6dyxtYXRjaGVzOmosdGhyZXNob2xkOiR0fSk7cmV0dXJuIHMmJihyLmlubGllck1hdGNoZXMyPXkpLHtIOncsbWF0Y2hlczp5LGRlYnVnRXh0cmE6cn19LEV0PSh7bm9kZTpvLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSk9PntpZihvLmxlYWYpe2ZvcihsZXQgbD0wO2w8by5wb2ludEluZGV4ZXMubGVuZ3RoO2wrKylzLnB1c2goby5wb2ludEluZGV4ZXNbbF0pO3JldHVybn1jb25zdCBpPVtdO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKXtjb25zdCBmPW8uY2hpbGRyZW5bbF0uY2VudGVyUG9pbnRJbmRleCxnPXl0KHt2MTpuW2ZdLmRlc2NyaXB0b3JzLHYyOmUuZGVzY3JpcHRvcnN9KTtpLnB1c2goZyl9bGV0IGg9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Zm9yKGxldCBsPTA7bDxvLmNoaWxkcmVuLmxlbmd0aDtsKyspaD1NYXRoLm1pbihoLGlbbF0pO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKWlbbF0hPT1oJiZ0LnB1c2goe25vZGU6by5jaGlsZHJlbltsXSxkOmlbbF19KTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKylpW2xdPT09aCYmRXQoe25vZGU6by5jaGlsZHJlbltsXSxrZXlwb2ludHM6bixxdWVyeXBvaW50OmUscXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pO2lmKHI8S2UmJnQubGVuZ3RoPjApe2NvbnN0e25vZGU6bCxkOnV9PXQucG9wKCk7cis9MSxFdCh7bm9kZTpsLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSl9fSxZdD1vPT57Y29uc3R7SDpuLG1hdGNoZXM6ZSx0aHJlc2hvbGQ6dH09byxzPXQqdCxyPVtdO2ZvcihsZXQgaT0wO2k8ZS5sZW5ndGg7aSsrKXtjb25zdCBoPWVbaV0ucXVlcnlwb2ludCxsPWVbaV0ua2V5cG9pbnQsdT1vdChbbC54LGwueV0sbik7KHVbMF0taC54KSoodVswXS1oLngpKyh1WzFdLWgueSkqKHVbMV0taC55KTw9cyYmci5wdXNoKGVbaV0pfXJldHVybiByfTtjbGFzcyBHZXtjb25zdHJ1Y3RvcihuLGUsdD0hMSl7dGhpcy5xdWVyeVdpZHRoPW4sdGhpcy5xdWVyeUhlaWdodD1lLHRoaXMuZGVidWdNb2RlPXR9bWF0Y2hEZXRlY3Rpb24obixlKXtsZXQgdD17ZnJhbWVzOltdfSxzPW51bGw7Zm9yKGxldCBsPTA7bDxuLmxlbmd0aDtsKyspe2NvbnN0e0g6dSxtYXRjaGVzOmYsZGVidWdFeHRyYTpnfT1KZSh7a2V5ZnJhbWU6bltsXSxxdWVyeXBvaW50czplLHF1ZXJ5d2lkdGg6dGhpcy5xdWVyeVdpZHRoLHF1ZXJ5aGVpZ2h0OnRoaXMucXVlcnlIZWlnaHQsZGVidWdNb2RlOnRoaXMuZGVidWdNb2RlfSk7dC5mcmFtZXMucHVzaChnKSx1JiYocz09PW51bGx8fHMubWF0Y2hlcy5sZW5ndGg8Zi5sZW5ndGgpJiYocz17a2V5ZnJhbWVJbmRleDpsLEg6dSxtYXRjaGVzOmZ9KX1pZihzPT09bnVsbClyZXR1cm57a2V5ZnJhbWVJbmRleDotMSxkZWJ1Z0V4dHJhOnR9O2NvbnN0IHI9W10saT1bXSxoPW5bcy5rZXlmcmFtZUluZGV4XTtmb3IobGV0IGw9MDtsPHMubWF0Y2hlcy5sZW5ndGg7bCsrKXtjb25zdCB1PXMubWF0Y2hlc1tsXS5xdWVyeXBvaW50LGY9cy5tYXRjaGVzW2xdLmtleXBvaW50O3IucHVzaCh7eDp1LngseTp1Lnl9KSxpLnB1c2goe3g6KGYueCsuNSkvaC5zY2FsZSx5OihmLnkrLjUpL2guc2NhbGUsejowfSl9cmV0dXJue3NjcmVlbkNvb3JkczpyLHdvcmxkQ29vcmRzOmksa2V5ZnJhbWVJbmRleDpzLmtleWZyYW1lSW5kZXgsZGVidWdFeHRyYTp0fX19Y29uc3QgV2U9KHtzY3JlZW5Db29yZHM6byx3b3JsZENvb3JkczpuLHByb2plY3Rpb25UcmFuc2Zvcm06ZX0pPT57Y29uc3QgdD1WdChuLm1hcChtPT5bbS54LG0ueV0pLG8ubWFwKG09PlttLngsbS55XSkpLHM9bmV3IGIoW1t0WzBdLHRbMV0sdFsyXV0sW3RbM10sdFs0XSx0WzVdXSxbdFs2XSx0WzddLHRbOF1dXSkscj1uZXcgYihlKSxsPU10KHIpLm1tdWwocykudG8xREFycmF5KCksdT1NYXRoLnNxcnQobFswXSpsWzBdK2xbM10qbFszXStsWzZdKmxbNl0pLGY9TWF0aC5zcXJ0KGxbMV0qbFsxXStsWzRdKmxbNF0rbFs3XSpsWzddKSxnPSh1K2YpLzIsYT1bXTthWzBdPWxbMF0vdSxhWzNdPWxbM10vdSxhWzZdPWxbNl0vdSxhWzFdPWxbMV0vZixhWzRdPWxbNF0vZixhWzddPWxbN10vZixhWzJdPWFbM10qYVs3XS1hWzZdKmFbNF0sYVs1XT1hWzZdKmFbMV0tYVswXSphWzddLGFbOF09YVswXSphWzRdLWFbMV0qYVszXTtjb25zdCBqPU1hdGguc3FydChhWzJdKmFbMl0rYVs1XSphWzVdK2FbOF0qYVs4XSk7YVsyXS89aixhWzVdLz1qLGFbOF0vPWo7Y29uc3Qgdz1bXTtyZXR1cm4gd1swXT1sWzJdL2csd1sxXT1sWzVdL2csd1syXT1sWzhdL2csW1thWzBdLGFbMV0sYVsyXSx3WzBdXSxbYVszXSxhWzRdLGFbNV0sd1sxXV0sW2FbNl0sYVs3XSxhWzhdLHdbMl1dXX0sUWU9KG8sbik9Pltbb1swXVswXSpuWzBdWzBdK29bMF1bMl0qblsyXVswXSxvWzBdWzBdKm5bMF1bMV0rb1swXVsyXSpuWzJdWzFdLG9bMF1bMF0qblswXVsyXStvWzBdWzJdKm5bMl1bMl0sb1swXVswXSpuWzBdWzNdK29bMF1bMl0qblsyXVszXV0sW29bMV1bMV0qblsxXVswXStvWzFdWzJdKm5bMl1bMF0sb1sxXVsxXSpuWzFdWzFdK29bMV1bMl0qblsyXVsxXSxvWzFdWzFdKm5bMV1bMl0rb1sxXVsyXSpuWzJdWzJdLG9bMV1bMV0qblsxXVszXStvWzFdWzJdKm5bMl1bM11dLFtuWzJdWzBdLG5bMl1bMV0sblsyXVsyXSxuWzJdWzNdXV0sQ3Q9KG8sbixlLHQpPT57Y29uc3Qgcz1vWzBdWzBdKm4rb1swXVsxXSplK29bMF1bM10scj1vWzFdWzBdKm4rb1sxXVsxXSplK29bMV1bM10saT1vWzJdWzBdKm4rb1syXVsxXSplK29bMl1bM107cmV0dXJue3g6cyx5OnIsejppfX0sWmU9KG8sbixlLHQpPT57Y29uc3R7eDpzLHk6cix6Oml9PUN0KG8sbixlKTtyZXR1cm57eDpzL2kseTpyL2l9fSx4ZT01LEFlPTQsSHQ9MTAsdG49LjEsZW49Ljk5O2xldCBIPVtbXSxbXSxbXV0sQT1bW10sW11dLE89W1tdLFtdLFtdXTtjb25zdCBubj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dH0pPT57bGV0IHM9MCxyPTA7Zm9yKGxldCBnPTA7ZzxlLmxlbmd0aDtnKyspcys9ZVtnXS54LHIrPWVbZ10ueTtzLz1lLmxlbmd0aCxyLz1lLmxlbmd0aDtjb25zdCBpPVtdO2ZvcihsZXQgZz0wO2c8ZS5sZW5ndGg7ZysrKWkucHVzaCh7eDplW2ddLngtcyx5OmVbZ10ueS1yLHo6ZVtnXS56fSk7Y29uc3QgaD1bW10sW10sW11dO2ZvcihsZXQgZz0wO2c8MztnKyspZm9yKGxldCBhPTA7YTwzO2ErKyloW2ddW2FdPW9bZ11bYV07aFswXVszXT1vWzBdWzBdKnMrb1swXVsxXSpyK29bMF1bM10saFsxXVszXT1vWzFdWzBdKnMrb1sxXVsxXSpyK29bMV1bM10saFsyXVszXT1vWzJdWzBdKnMrb1syXVsxXSpyK29bMl1bM107Y29uc3QgbD1bMSwuOCwuNiwuNCwwXTtsZXQgdT1oLGY9bnVsbDtmb3IobGV0IGc9MDtnPGwubGVuZ3RoO2crKyl7Y29uc3QgYT1zbih7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTp1LHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkczppLHNjcmVlbkNvb3Jkczp0LGlubGllclByb2I6bFtnXX0pO2lmKHU9YS5tb2RlbFZpZXdUcmFuc2Zvcm0sYS5lcnI8eGUpe2Y9dTticmVha319cmV0dXJuIGY9PT1udWxsP251bGw6KGZbMF1bM109ZlswXVszXS1mWzBdWzBdKnMtZlswXVsxXSpyLGZbMV1bM109ZlsxXVszXS1mWzFdWzBdKnMtZlsxXVsxXSpyLGZbMl1bM109ZlsyXVszXS1mWzJdWzBdKnMtZlsyXVsxXSpyLGYpfSxzbj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dCxpbmxpZXJQcm9iOnN9KT0+e2NvbnN0IHI9czwxO2xldCBpPW8saD0wLGw9MCx1PW5ldyBBcnJheShlLmxlbmd0aCksZj1uZXcgQXJyYXkoZS5sZW5ndGgpLGc9bmV3IEFycmF5KGUubGVuZ3RoKSxhPW5ldyBBcnJheShlLmxlbmd0aCk7Zm9yKGxldCBqPTA7ajw9SHQ7aisrKXtjb25zdCB3PVFlKG4saSk7Zm9yKGxldCBFPTA7RTxlLmxlbmd0aDtFKyspe2NvbnN0IGs9WmUodyxlW0VdLngsZVtFXS55LGVbRV0ueiksUj10W0VdLngtay54LHE9dFtFXS55LWsueTtnW0VdPVIsYVtFXT1xLHVbRV09UipSK3EqcX1sZXQgeTtpZihsPTAscil7Y29uc3QgRT1NYXRoLm1heCgzLE1hdGguZmxvb3IoZS5sZW5ndGgqcyktMSk7Zm9yKGxldCBrPTA7azxlLmxlbmd0aDtrKyspZltrXT11W2tdO2Yuc29ydCgoayxSKT0+ay1SKSx5PU1hdGgubWF4KGZbRV0qQWUsMTYpO2ZvcihsZXQgaz0wO2s8ZS5sZW5ndGg7aysrKWZba10+eT9sKz15LzY6bCs9eS82KigxLSgxLWZba10veSkqKDEtZltrXS95KSooMS1mW2tdL3kpKX1lbHNlIGZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKWwrPXVbRV07aWYobC89ZS5sZW5ndGgsbDx0bnx8aj4wJiZsL2g+ZW58fGo9PT1IdClicmVhaztoPWw7Y29uc3QgbT1bXSxNPVtdO2ZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKXtpZihyJiZ1W0VdPnkpY29udGludWU7Y29uc3Qgaz1sbih7bW9kZWxWaWV3UHJvamVjdGlvblRyYW5zZm9ybTp3LG1vZGVsVmlld1RyYW5zZm9ybTppLHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkOmVbRV19KTtpZihyKXtjb25zdCBSPSgxLXVbRV0veSkqKDEtdVtFXS95KTtmb3IobGV0IHE9MDtxPDI7cSsrKWZvcihsZXQgST0wO0k8NjtJKyspa1txXVtJXSo9UjttLnB1c2goW2dbRV0qUl0pLG0ucHVzaChbYVtFXSpSXSl9ZWxzZSBtLnB1c2goW2dbRV1dKSxtLnB1c2goW2FbRV1dKTtmb3IobGV0IFI9MDtSPGsubGVuZ3RoO1IrKylNLnB1c2goa1tSXSl9Y29uc3QgVD1ybih7ZFU6bSxKX1VfUzpNfSk7aWYoVD09PW51bGwpYnJlYWs7aT1vbih7bW9kZWxWaWV3VHJhbnNmb3JtOmksZFM6VH0pfXJldHVybnttb2RlbFZpZXdUcmFuc2Zvcm06aSxlcnI6bH19LG9uPSh7bW9kZWxWaWV3VHJhbnNmb3JtOm8sZFM6bn0pPT57bGV0IGU9blswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0sdCxzLHI7ZTwxZS02Pyh0PTEscz0wLHI9MCxlPTApOihlPU1hdGguc3FydChlKSx0PW5bMF0vZSxzPW5bMV0vZSxyPW5bMl0vZSk7Y29uc3QgaT1NYXRoLmNvcyhlKSxoPU1hdGguc2luKGUpLGw9MS1pO0hbMF1bMF09dCp0KmwraSxIWzBdWzFdPXQqcypsLXIqaCxIWzBdWzJdPXQqcipsK3MqaCxIWzBdWzNdPW5bM10sSFsxXVswXT1zKnQqbCtyKmgsSFsxXVsxXT1zKnMqbCtpLEhbMV1bMl09cypyKmwtdCpoLEhbMV1bM109bls0XSxIWzJdWzBdPXIqdCpsLXMqaCxIWzJdWzFdPXIqcypsK3QqaCxIWzJdWzJdPXIqcipsK2ksSFsyXVszXT1uWzVdO2NvbnN0IHU9W1tdLFtdLFtdXTtmb3IobGV0IGY9MDtmPDM7ZisrKXtmb3IobGV0IGc9MDtnPDQ7ZysrKXVbZl1bZ109b1tmXVswXSpIWzBdW2ddK29bZl1bMV0qSFsxXVtnXStvW2ZdWzJdKkhbMl1bZ107dVtmXVszXSs9b1tmXVszXX1yZXR1cm4gdX0scm49KHtkVTpvLEpfVV9TOm59KT0+e2NvbnN0IGU9bmV3IGIobiksdD1uZXcgYihvKSxzPWUudHJhbnNwb3NlKCkscj1zLm1tdWwoZSksaT1zLm1tdWwodCk7bGV0IGg7dHJ5e2g9TXQocil9Y2F0Y2h7cmV0dXJuIG51bGx9cmV0dXJuIGgubW11bChpKS50bzFEQXJyYXkoKX0sbG49KHttb2RlbFZpZXdQcm9qZWN0aW9uVHJhbnNmb3JtOm8sbW9kZWxWaWV3VHJhbnNmb3JtOm4scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmQ6dH0pPT57Y29uc3Qgcz1uLHt4OnIseTppLHo6aH09dCxsPUN0KG8scixpKSx1PWwueipsLno7QVswXVswXT1lWzBdWzBdKmwuei91LEFbMF1bMV09ZVswXVsxXSpsLnovdSxBWzBdWzJdPShlWzBdWzJdKmwuei1lWzJdWzJdKmwueCkvdSxBWzFdWzBdPWVbMV1bMF0qbC56L3UsQVsxXVsxXT1lWzFdWzFdKmwuei91LEFbMV1bMl09KGVbMV1bMl0qbC56LWVbMl1bMl0qbC55KS91LE9bMF1bMF09c1swXVsyXSppLE9bMF1bMV09LXNbMF1bMl0qcixPWzBdWzJdPXNbMF1bMV0qci1zWzBdWzBdKmksT1swXVszXT1zWzBdWzBdLE9bMF1bNF09c1swXVsxXSxPWzBdWzVdPXNbMF1bMl0sT1sxXVswXT1zWzFdWzJdKmksT1sxXVsxXT0tc1sxXVsyXSpyLE9bMV1bMl09c1sxXVsxXSpyLXNbMV1bMF0qaSxPWzFdWzNdPXNbMV1bMF0sT1sxXVs0XT1zWzFdWzFdLE9bMV1bNV09c1sxXVsyXSxPWzJdWzBdPXNbMl1bMl0qaSxPWzJdWzFdPS1zWzJdWzJdKnIsT1syXVsyXT1zWzJdWzFdKnItc1syXVswXSppLE9bMl1bM109c1syXVswXSxPWzJdWzRdPXNbMl1bMV0sT1syXVs1XT1zWzJdWzJdO2NvbnN0IGY9W1tdLFtdXTtmb3IobGV0IGc9MDtnPDI7ZysrKWZvcihsZXQgYT0wO2E8NjthKyspe2ZbZ11bYV09MDtmb3IobGV0IGo9MDtqPDM7aisrKWZbZ11bYV0rPUFbZ11bal0qT1tqXVthXX1yZXR1cm4gZn07Y2xhc3MgaG57Y29uc3RydWN0b3Iobil7dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtPW59ZXN0aW1hdGUoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmV9KXtyZXR1cm4gV2Uoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmUscHJvamVjdGlvblRyYW5zZm9ybTp0aGlzLnByb2plY3Rpb25UcmFuc2Zvcm19KX1yZWZpbmVFc3RpbWF0ZSh7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTpuLHdvcmxkQ29vcmRzOmUsc2NyZWVuQ29vcmRzOnR9KXtyZXR1cm4gbm4oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06bix3b3JsZENvb3JkczplLHNjcmVlbkNvb3Jkczp0LHByb2plY3Rpb25UcmFuc2Zvcm06dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtfSl9fWxldCBLdD1udWxsLEp0PSExLEd0PW51bGwsU3Q9bnVsbDtvbm1lc3NhZ2U9bz0+e2NvbnN0e2RhdGE6bn09bztzd2l0Y2gobi50eXBlKXtjYXNlInNldHVwIjpuLnByb2plY3Rpb25UcmFuc2Zvcm0sS3Q9bi5tYXRjaGluZ0RhdGFMaXN0LEp0PW4uZGVidWdNb2RlLEd0PW5ldyBHZShuLmlucHV0V2lkdGgsbi5pbnB1dEhlaWdodCxKdCksU3Q9bmV3IGhuKG4ucHJvamVjdGlvblRyYW5zZm9ybSk7YnJlYWs7Y2FzZSJtYXRjaCI6Y29uc3QgZT1uLnRhcmdldEluZGV4ZXM7bGV0IHQ9LTEscz1udWxsLHI9bnVsbDtmb3IobGV0IGY9MDtmPGUubGVuZ3RoO2YrKyl7Y29uc3QgZz1lW2ZdLHtrZXlmcmFtZUluZGV4OmEsc2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6dyxkZWJ1Z0V4dHJhOnl9PUd0Lm1hdGNoRGV0ZWN0aW9uKEt0W2ddLG4uZmVhdHVyZVBvaW50cyk7aWYocj15LGEhPT0tMSl7Y29uc3QgbT1TdC5lc3RpbWF0ZSh7c2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6d30pO20mJih0PWcscz1tKTticmVha319cG9zdE1lc3NhZ2Uoe3R5cGU6Im1hdGNoRG9uZSIsdGFyZ2V0SW5kZXg6dCxtb2RlbFZpZXdUcmFuc2Zvcm06cyxkZWJ1Z0V4dHJhOnJ9KTticmVhaztjYXNlInRyYWNrVXBkYXRlIjpjb25zdHttb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfT1uLHU9U3QucmVmaW5lRXN0aW1hdGUoe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfSk7cG9zdE1lc3NhZ2Uoe3R5cGU6InRyYWNrVXBkYXRlRG9uZSIsbW9kZWxWaWV3VHJhbnNmb3JtOnV9KTticmVhaztjYXNlImRpc3Bvc2UiOmNsb3NlKCk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWVzc2FnZSB0eXBlICcke24udHlwZX0nYCl9fX0pKCk7Cg==",Lge=typeof window<"u"&&window.Blob&&new Blob([atob(Yge)],{type:"text/javascript;charset=utf-8"});function zge(e){let t;try{if(t=Lge&&(window.URL||window.webkitURL).createObjectURL(Lge),!t)throw"";const n=new Worker(t,{name:null==e?void 0:e.name});return n.addEventListener("error",(()=>{(window.URL||window.webkitURL).revokeObjectURL(t)})),n}catch{return new Worker("data:application/javascript;base64,"+Yge,{name:null==e?void 0:e.name})}finally{t&&(window.URL||window.webkitURL).revokeObjectURL(t)}}const Kge=(e,t,n,a)=>{const{x:o,y:i,z:r}=((e,t,n,a)=>({x:e[0][0]*t+e[0][1]*n+e[0][3],y:e[1][0]*t+e[1][1]*n+e[1][3],z:e[2][0]*t+e[2][1]*n+e[2][3]}))(e,t,n);return{x:o/r,y:i/r}},Dge=1e3;class Uge{constructor(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.markerDimensions=e,this.trackingDataList=t,this.projectionTransform=n,this.debugMode=i,this.trackingKeyframeList=[];for(let s=0;s<t.length;s++)this.trackingKeyframeList.push(t[s][1]);let r=0;for(let s=0;s<this.trackingKeyframeList.length;s++)r=Math.max(r,this.trackingKeyframeList[s].points.length);this.featurePointsListT=[],this.imagePixelsListT=[],this.imagePropertiesListT=[];for(let s=0;s<this.trackingKeyframeList.length;s++){const{featurePoints:e,imagePixels:t,imageProperties:n}=this._prebuild(this.trackingKeyframeList[s],r);this.featurePointsListT[s]=e,this.imagePixelsListT[s]=t,this.imagePropertiesListT[s]=n}this.kernelCaches={}}dummyRun(e){let t=[[1,1,1,1],[1,1,1,1],[1,1,1,1]];for(let n=0;n<this.featurePointsListT.length;n++)this.track(e,t,n)}track(e,t,n){let a={};const o=((e,t)=>[[e[0][0]*t[0][0]+e[0][2]*t[2][0],e[0][0]*t[0][1]+e[0][2]*t[2][1],e[0][0]*t[0][2]+e[0][2]*t[2][2],e[0][0]*t[0][3]+e[0][2]*t[2][3]],[e[1][1]*t[1][0]+e[1][2]*t[2][0],e[1][1]*t[1][1]+e[1][2]*t[2][1],e[1][1]*t[1][2]+e[1][2]*t[2][2],e[1][1]*t[1][3]+e[1][2]*t[2][3]],[t[2][0],t[2][1],t[2][2],t[2][3]]])(this.projectionTransform,t),i=this._buildAdjustedModelViewTransform(o);this.markerDimensions[n][0],this.markerDimensions[n][1],this.trackingKeyframeList[n].width,this.trackingKeyframeList[n].height;const r=this.featurePointsListT[n],s=this.imagePixelsListT[n],l=this.imagePropertiesListT[n],c=this._computeProjection(i,e,n),{matchingPointsT:g,simT:u}=this._computeMatching(r,s,l,c),d=g.arraySync(),h=u.arraySync(),p=this.trackingKeyframeList[n],m=[],I=[],C=[];for(let f=0;f<d.length;f++)if(h[f]>.8&&f<p.points.length){C.push(f);const e=Kge(o,d[f][0],d[f][1]);I.push(e),m.push({x:p.points[f].x/p.scale,y:p.points[f].y/p.scale,z:0})}return this.debugMode&&(a={projectedImage:c.arraySync(),matchingPoints:g.arraySync(),goodTrack:C,trackedPoints:I}),i.dispose(),c.dispose(),g.dispose(),u.dispose(),{worldCoords:m,screenCoords:I,debugExtra:a}}_computeMatching(e,t,n,a){const o=21,i=a.shape[0],r=a.shape[1],s=e.shape[0];if(!this.kernelCaches.computeMatching){const e={variableNames:["features","markerPixels","markerProperties","targetPixels"],outputShape:[s,441],userCode:"\n\t  void main() {\n\t    ivec2 coords = getOutputCoords();\n\n\t    int featureIndex = coords[0];\n\t    int searchOffsetIndex = coords[1];\n\n\t    int markerWidth = int(getMarkerProperties(0));\n\t    int markerHeight = int(getMarkerProperties(1));\n\t    float markerScale = getMarkerProperties(2);\n\n\t    int searchOffsetX = imod(searchOffsetIndex, ".concat(o,") * ").concat(1,";\n\t    int searchOffsetY = searchOffsetIndex / ").concat(o," * ").concat(1,";\n\n\t    int sCenterX = int(getFeatures(featureIndex, 0) * markerScale);\n\t    int sCenterY = int(getFeatures(featureIndex, 1) * markerScale);\n\n\t    int sx = sCenterX + searchOffsetX - ").concat(10,";\n\t    int sy = sCenterY + searchOffsetY - ").concat(10,";\n\n\t    if (sx < ").concat(6," || sx >= (").concat(r," - ").concat(6,") || sy < ").concat(6," || sy >= (").concat(i," - ").concat(6,")) {\n\t      setOutput(-2.);\n\t    } \n\t    else {\n\t      float sumPoint = 0.;\n\t      float sumPointSquare = 0.;\n\t      float sumTemplate = 0.;\n\t      float sumTemplateSquare = 0.;\n\t      float sumPointTemplate = 0.;\n\n\t      for (int templateOffsetY = 0; templateOffsetY < ").concat(13,"; templateOffsetY++) {\n\t\tfor (int templateOffsetX = 0; templateOffsetX < ").concat(13,"; templateOffsetX++) {\n\t\t  int fx2 = sCenterX + templateOffsetX - ").concat(6,";\n\t\t  int fy2 = sCenterY + templateOffsetY - ").concat(6,";\n\n\t\t  int sx2 = sx + templateOffsetX - ").concat(6,";\n\t\t  int sy2 = sy + templateOffsetY - ").concat(6,";\n\n\t\t  int markerPixelIndex = fy2 * markerWidth + fx2;\n\t\t  float markerPixel = getMarkerPixels(markerPixelIndex);\n\t\t  float targetPixel = getTargetPixels(sy2, sx2);\n\n\t\t  sumTemplate += markerPixel;\n\t\t  sumTemplateSquare += markerPixel * markerPixel;\n\t\t  sumPoint += targetPixel;\n\t\t  sumPointSquare += targetPixel * targetPixel;\n\t\t  sumPointTemplate += targetPixel * markerPixel;\n\t\t}\n\t      }\n\n\t      // Normalized cross-correlation\n\t      // !important divide first avoid overflow (e.g. sumPoint / count * sumPoint)\n\t      float count = float(").concat(13," * ").concat(13,");\n\t      float pointVariance = sqrt(sumPointSquare - sumPoint / count * sumPoint);\n\t      float templateVariance = sqrt(sumTemplateSquare - sumTemplate / count * sumTemplate);\n\n\t      if (pointVariance < 0.0000001) {\n\t\tsetOutput(-3.);\n\t      } else if (templateVariance < 0.0000001) {\n\t\t//setOutput(sumTemplate);\n\t\tsetOutput(-4.);\n\t      } else {\n\t\tsumPointTemplate -= sumPoint / count * sumTemplate;\n\t\tfloat sim = sumPointTemplate / pointVariance / templateVariance;  \n\t\tsetOutput(sim);\n\t      }\n\t    }\n\t  }\n\t")},t={variableNames:["featurePoints","markerProperties","maxIndex"],outputShape:[s,2],userCode:"\n\t  void main() {\n\t    ivec2 coords = getOutputCoords();\n\n\t    float markerScale = getMarkerProperties(2);\n\n\t    int featureIndex = coords[0];\n\n\t    int maxIndex = int(getMaxIndex(featureIndex));\n\t    int searchLocationIndex = maxIndex / ".concat(441,";\n\t    int searchOffsetIndex = imod(maxIndex, ").concat(441,");\n\n\t    if (coords[1] == 0) {\n\t      int searchOffsetX = imod(searchOffsetIndex, ").concat(o,") * ").concat(1,";\n\t      setOutput(getFeaturePoints(featureIndex, 0) + float(searchOffsetX - ").concat(10,") / markerScale);\n\t    }\n\t    else if (coords[1] == 1) {\n\t      int searchOffsetY = searchOffsetIndex / ").concat(o," * ").concat(1,";\n\t      setOutput(getFeaturePoints(featureIndex, 1) + float(searchOffsetY - ").concat(10,") / markerScale);\n\t    }\n\t  }\n\t")},n={variableNames:["sims","maxIndex"],outputShape:[s],userCode:"\n\t  void main() {\n\t    int featureIndex = getOutputCoords();\n\t    int maxIndex = int(getMaxIndex(featureIndex));\n\t    setOutput(getSims(featureIndex, maxIndex));\n\t  }\n\t"};this.kernelCaches.computeMatching=[e,t,n]}return VJ((()=>{const o=this.kernelCaches.computeMatching,i=this._compileAndRun(o[0],[e,t,n,a]),r=i.argMax(1);return{matchingPointsT:this._compileAndRun(o[1],[e,n,r]),simT:this._compileAndRun(o[2],[i,r])}}))}_computeProjection(e,t,n){const a=this.trackingKeyframeList[n].width,o=this.trackingKeyframeList[n].height,i=this.trackingKeyframeList[n].scale,r=a+"-"+o+"-"+i;if(this.kernelCaches.computeProjection||(this.kernelCaches.computeProjection={}),!this.kernelCaches.computeProjection[r]){const e={variableNames:["M","pixel"],outputShape:[o,a],userCode:"\n\t  void main() {\n\t      ivec2 coords = getOutputCoords();\n\n\t      float m00 = getM(0, 0) * ".concat(Dge,".;\n\t      float m01 = getM(0, 1) * ").concat(Dge,".;\n\t      float m03 = getM(0, 3) * ").concat(Dge,".;\n\t      float m10 = getM(1, 0) * ").concat(Dge,".;\n\t      float m11 = getM(1, 1) * ").concat(Dge,".;\n\t      float m13 = getM(1, 3) * ").concat(Dge,".;\n\t      float m20 = getM(2, 0) * ").concat(Dge,".;\n\t      float m21 = getM(2, 1) * ").concat(Dge,".;\n\t      float m23 = getM(2, 3) * ").concat(Dge,".;\n\n\t      float y = float(coords[0]) / float(").concat(i,");\n\t      float x = float(coords[1]) / float(").concat(i,");\n\t      float uz = (x * m20) + (y * m21) + m23;\n\t      float oneOverUz = 1. / uz;\n\n\t      float ux = (x * m00) + (y * m01) + m03;\n\t      float uy = (x * m10) + (y * m11) + m13;\n\n\t      ux = floor(ux * oneOverUz + 0.5);\n\t      uy = floor(uy * oneOverUz + 0.5);\n\t      setOutput(getPixel(int(uy), int(ux)));\n\t    }\n\t")};this.kernelCaches.computeProjection[r]=e}return VJ((()=>{const n=this.kernelCaches.computeProjection[r];return this._compileAndRun(n,[e,t])}))}_buildAdjustedModelViewTransform(e){return VJ((()=>{let t=[];for(let n=0;n<e.length;n++){t.push([]);for(let a=0;a<e[n].length;a++)t[n].push(e[n][a]/Dge)}return wJ(t,[3,4])}))}_prebuild(e,t){return VJ((()=>{const n=e.scale,a=[];for(let r=0;r<t;r++)r<e.points.length?a.push([e.points[r].x/n,e.points[r].y/n]):a.push([-1,-1]);const o=wJ(e.data,[e.width*e.height]),i=wJ([e.width,e.height,e.scale],[3]);return{featurePoints:wJ(a,[a.length,2],"float32"),imagePixels:o,imageProperties:i}}))}_compileAndRun(e,t){const n=EJ().compileAndRun(e,t);return RJ().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}}const Pge=[{sigma:.55,points:[[-1,0],[-.5,-.866025],[.5,-.866025],[1,-0],[.5,.866025],[-.5,.866025]]},{sigma:.475,points:[[0,.930969],[-.806243,.465485],[-.806243,-.465485],[-0,-.930969],[.806243,-.465485],[.806243,.465485]]},{sigma:.4,points:[[.847306,-0],[.423653,.733789],[-.423653,.733789],[-.847306,0],[-.423653,-.733789],[.423653,-.733789]]},{sigma:.325,points:[[-0,-.741094],[.641806,-.370547],[.641806,.370547],[0,.741094],[-.641806,.370547],[-.641806,-.370547]]},{sigma:.25,points:[[-.595502,0],[-.297751,-.51572],[.297751,-.51572],[.595502,-0],[.297751,.51572],[-.297751,.51572]]},{sigma:.175,points:[[0,.362783],[-.314179,.181391],[-.314179,-.181391],[-0,-.362783],[.314179,-.181391],[.314179,.181391]]},{sigma:.1,points:[[0,0]]}],Oge=[];for(let n=0;n<Pge.length;n++){const e=Pge[n].sigma;for(let t=0;t<Pge[n].points.length;t++){const a=Pge[n].points[t];Oge.push([e,a[0],a[1]])}}const _ge={};const Qge={kernelName:"BinomialFilter",backendName:"webgl",kernelFunc:e=>{const t=e.inputs.image,n=e.backend,[a,o]=function(e){const t=e.shape[1],n=e.shape[0],a="w"+t+"h"+n;if(!_ge.hasOwnProperty(a)){const e={variableNames:["p"],outputShape:[n,t],userCode:"\n        void main() {\n          ivec2 coords = getOutputCoords();\n\n          float sum = getP(coords[0], coords[1]-2);\n          sum += getP(coords[0], coords[1]-1) * 4.;\n          sum += getP(coords[0], coords[1]) * 6.;\n          sum += getP(coords[0], coords[1]+1) * 4.;\n          sum += getP(coords[0], coords[1]+2);\n          setOutput(sum);\n        }\n      "},o={variableNames:["p"],outputShape:[n,t],userCode:"\n        void main() {\n          ivec2 coords = getOutputCoords();\n\n          float sum = getP(coords[0]-2, coords[1]);\n          sum += getP(coords[0]-1, coords[1]) * 4.;\n          sum += getP(coords[0], coords[1]) * 6.;\n          sum += getP(coords[0]+1, coords[1]) * 4.;\n          sum += getP(coords[0]+2, coords[1]);\n          sum /= 256.;\n          setOutput(sum);\n        }\n      "};_ge[a]=[e,o]}return _ge[a]}(t),i=n.runWebGLProgram(a,[t],t.dtype),r=n.runWebGLProgram(o,[i],t.dtype);return n.disposeIntermediateTensorInfo(i),r}},jge={};const qge={kernelName:"BuildExtremas",backendName:"webgl",kernelFunc:e=>{let{image0:t,image1:n,image2:a}=e.inputs;const o=e.backend,i=function(e){const t=e.shape[1],n=e.shape[0],a="w"+t+"h"+n;if(!jge.hasOwnProperty(a)){const e={variableNames:["image0","image1","image2"],outputShape:[n,t],userCode:"\n        void main() {\n          ivec2 coords = getOutputCoords();\n    \n          int y = coords[0];\n          int x = coords[1];\n    \n          float value = getImage1(y, x);\n    \n          // Step 1: find local maxima/minima\n          if (value * value < ".concat(9,".) {\n            setOutput(0.);\n            return;\n          }\n          if (y < ").concat(7," || y > ").concat(n-1-7,") {\n            setOutput(0.);\n            return;\n          }\n          if (x < ").concat(7," || x > ").concat(t-1-7,") {\n            setOutput(0.);\n            return;\n          }\n    \n          bool isMax = true;\n          bool isMin = true;\n          for (int dy = -1; dy <= 1; dy++) {\n            for (int dx = -1; dx <= 1; dx++) {\n              float value0 = getImage0(y+dy, x+dx);\n              float value1 = getImage1(y+dy, x+dx);\n              float value2 = getImage2(y+dy, x+dx);\n    \n        if (value < value0 || value < value1 || value < value2) {\n          isMax = false;\n        }\n        if (value > value0 || value > value1 || value > value2) {\n          isMin = false;\n        }\n            }\n          }\n    \n          if (!isMax && !isMin) {\n            setOutput(0.);\n            return;\n          }\n    \n          // compute edge score and reject based on threshold\n          float dxx = getImage1(y, x+1) + getImage1(y, x-1) - 2. * getImage1(y, x);\n          float dyy = getImage1(y+1, x) + getImage1(y-1, x) - 2. * getImage1(y, x);\n          float dxy = 0.25 * (getImage1(y-1,x-1) + getImage1(y+1,x+1) - getImage1(y-1,x+1) - getImage1(y+1,x-1));\n    \n          float det = (dxx * dyy) - (dxy * dxy);\n    \n          if (abs(det) < 0.0001) { // determinant undefined. no solution\n            setOutput(0.);\n            return;\n          }\n    \n          float edgeScore = (dxx + dyy) * (dxx + dyy) / det;\n    \n          if (abs(edgeScore) >= ").concat(6.25," ) {\n            setOutput(0.);\n            return;\n          }\n          setOutput(getImage1(y,x));\n        }\n      ")};jge[a]=e}return jge[a]}(n);return t=RJ().runKernel("DownsampleBilinear",{image:t}),a=RJ().runKernel("UpsampleBilinear",{image:a,targetImage:n}),o.runWebGLProgram(i,[t,n,a],n.dtype)}},$ge={};const eue={kernelName:"ComputeExtremaAngles",backendName:"webgl",kernelFunc:e=>{const{histograms:t}=e.inputs,n=e.backend,a=function(e){const t=e.shape[0];if(!$ge.hasOwnProperty(t)){const n={variableNames:["histogram"],outputShape:[e.shape[0]],userCode:"\n            void main() {\n                int featureIndex = getOutputCoords();\n\n                int maxIndex = 0;\n                for (int i = 1; i < ".concat(36,"; i++) {\n                    if (getHistogram(featureIndex, i) > getHistogram(featureIndex, maxIndex)) {\n                        maxIndex = i;\n                    }\n                }\n\n                int prev = imod(maxIndex - 1 + ").concat(36,", ").concat(36,");\n                int next = imod(maxIndex + 1, ").concat(36,");\n\n                /**\n                 * Fit a quatratic to 3 points. The system of equations is:\n                 *\n                 * y0 = A*x0^2 + B*x0 + C\n                 * y1 = A*x1^2 + B*x1 + C\n                 * y2 = A*x2^2 + B*x2 + C\n                 *\n                 * This system of equations is solved for A,B,C.\n                 */\n                float p10 = float(maxIndex - 1);\n                float p11 = getHistogram(featureIndex, prev); \n                float p20 = float(maxIndex);\n                float p21 = getHistogram(featureIndex, maxIndex); \n                float p30 = float(maxIndex + 1);\n                float p31 = getHistogram(featureIndex, next); \n\n                float d1 = (p30-p20)*(p30-p10);\n                float d2 = (p10-p20)*(p30-p10);\n                float d3 = p10-p20;\n\n                // If any of the denominators are zero then, just use maxIndex.\n                    float fbin = float(maxIndex);\n                if ( abs(d1) > 0.00001 && abs(d2) > 0.00001 && abs(d3) > 0.00001) {\n                float a = p10*p10;\n                float b = p20*p20;\n\n                // Solve for the coefficients A,B,C\n                float A = ((p31-p21)/d1)-((p11-p21)/d2);\n                float B = ((p11-p21)+(A*(b-a)))/d3;\n                float C = p11-(A*a)-(B*p10);\n                fbin = -B / (2. * A);\n                }\n\n                float an = 2.0 *").concat(Math.PI," * (fbin + 0.5) / ").concat(36,". - ").concat(Math.PI,";\n                setOutput(an);\n            }\n            ")};$ge[t]=n}return $ge[t]}(t);return n.runWebGLProgram(a,[t],t.dtype)}},tue={};const nue={kernelName:"ComputeExtremaFreak",backendName:"webgl",kernelFunc:e=>{const{gaussianImagesT:t,prunedExtremas:n,prunedExtremasAngles:a,freakPointsT:o,pyramidImagesLength:i}=e.inputs,r=e.backend,s=function(e,t){const n="".concat(e,"|").concat(t.shape[0]);if(!tue.hasOwnProperty(n)){const a=[];for(let t=1;t<e;t++)a.push("image"+t);let o="float getPixel(int octave, int y, int x) {";for(let t=1;t<e;t++)o+="\n  if (octave == ".concat(t,") {\n\treturn getImage").concat(t,"(y, x);\n  }\n");o+="}";const i={variableNames:[...a,"extrema","angles","freakPoints"],outputShape:[t.shape[0],Oge.length],userCode:"\n  ".concat(o,"\n  void main() {\n\tivec2 coords = getOutputCoords();\n\tint featureIndex = coords[0];\n\tint freakIndex = coords[1];\n\n\tfloat freakSigma = getFreakPoints(freakIndex, 0);\n\tfloat freakX = getFreakPoints(freakIndex, 1);\n\tfloat freakY = getFreakPoints(freakIndex, 2);\n\n\tint octave = int(getExtrema(featureIndex, 1));\n\tfloat inputY = getExtrema(featureIndex, 2);\n\tfloat inputX = getExtrema(featureIndex, 3);\n\tfloat inputAngle = getAngles(featureIndex);\n\tfloat cos = ").concat(7,". * cos(inputAngle);\n\tfloat sin = ").concat(7,". * sin(inputAngle);\n\n\tfloat yp = inputY + freakX * sin + freakY * cos;\n\tfloat xp = inputX + freakX * cos + freakY * -sin;\n\n\tint x0 = int(floor(xp));\n\tint x1 = x0 + 1;\n\tint y0 = int(floor(yp));\n\tint y1 = y0 + 1;\n\n\tfloat f1 = getPixel(octave, y0, x0);\n\tfloat f2 = getPixel(octave, y0, x1);\n\tfloat f3 = getPixel(octave, y1, x0);\n\tfloat f4 = getPixel(octave, y1, x1);\n\n\tfloat x1f = float(x1);\n\tfloat y1f = float(y1);\n\tfloat x0f = float(x0);\n\tfloat y0f = float(y0);\n\n\t// ratio for interpolation between four neighbouring points\n\tfloat value = (x1f - xp) * (y1f - yp) * f1\n\t\t+ (xp - x0f) * (y1f - yp) * f2\n\t\t+ (x1f - xp) * (yp - y0f) * f3\n\t\t+ (xp - x0f) * (yp - y0f) * f4;\n\n\tsetOutput(value);\n  }\n")};tue[n]=i}return tue[n]}(i,n);return r.runWebGLProgram(s,[...t,n,a,o],"float32")}},aue=(Oge.length-1)*Oge.length/2,oue=Math.ceil(aue/8),iue={};const rue={kernelName:"ComputeFreakDescriptors",backendName:"webgl",kernelFunc:e=>{const{extremaFreaks:t,positionT:n}=e.inputs,{backend:a}=e,o=function(e){const t="".concat(e.shape[0]);if(!iue.hasOwnProperty(t)){const n={variableNames:["freak","p"],outputShape:[e.shape[0],oue],userCode:"\n  void main() {\n    ivec2 coords = getOutputCoords();\n    int featureIndex = coords[0];\n    int descIndex = coords[1] * 8;\n\n    int sum = 0;\n    for (int i = 0; i < 8; i++) {\n      if (descIndex + i >= ".concat(aue,") {\n        continue;\n      }\n\n      int p1 = int(getP(descIndex + i, 0));\n      int p2 = int(getP(descIndex + i, 1));\n\n      float v1 = getFreak(featureIndex, p1);\n      float v2 = getFreak(featureIndex, p2);\n\n      if (v1 < v2 + 0.01) {\n        sum += int(pow(2.0, float(7 - i)));\n      }\n    }\n    setOutput(float(sum));\n  }\n")};iue[t]=n}return iue[t]}(t);return a.runWebGLProgram(o,[t,n],"int32")}},sue={};const lue={kernelName:"ComputeLocalization",backendName:"webgl",kernelFunc:e=>{const{prunedExtremasList:t,dogPyramidImagesT:n}=e.inputs,a=e.backend,o=function(e,t){const n="".concat(e,"|").concat(t);if(!sue.hasOwnProperty(n)){const a=[];let o="float getPixel(int octave, int y, int x) {";for(let t=1;t<e;t++)a.push("image"+t),o+="\n\t\t\t\tif (octave == ".concat(t,") {\n\t\t\t\t\treturn getImage").concat(t,"(y, x);\n\t\t\t\t}\n\t\t\t");o+="}",sue[n]={variableNames:[...a,"extrema"],outputShape:[t,3,3],userCode:"\n\t\t\t".concat(o,"\n\t\t\n\t\t\tvoid main() {\n\t\t\t\tivec3 coords = getOutputCoords();\n\t\t\t\tint featureIndex = coords[0];\n\t\t\t\tfloat score = getExtrema(featureIndex, 0);\n\t\t\t\tif (score == 0.0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\n\t\t\t\tint dy = coords[1]-1;\n\t\t\t\tint dx = coords[2]-1;\n\t\t\t\tint octave = int(getExtrema(featureIndex, 1));\n\t\t\t\tint y = int(getExtrema(featureIndex, 2));\n\t\t\t\tint x = int(getExtrema(featureIndex, 3));\n\t\t\t\tsetOutput(getPixel(octave, y+dy, x+dx));\n\t\t\t}\n\t\t\t")}}return sue[n]}(n.length,t.length),i=wJ(t,[t.length,t[0].length],"int32");return a.runWebGLProgram(o,[...n.slice(1),i],n[0].dtype)}},cue=36,gue={};const uue={kernelName:"ComputeOrientationHistograms",backendName:"webgl",kernelFunc:e=>{const{gaussianImagesT:t,prunedExtremasT:n,radialPropertiesT:a,pyramidImagesLength:o}=e.inputs,i=e.backend,[r,s]=function(e,t,n){const a="".concat(n,"|").concat(e.shape[0],"|").concat(t.shape[0]);if(!gue.hasOwnProperty(a)){const o=[];for(let e=1;e<n;e++)o.push("image"+e);let i="float getPixel(int octave, int y, int x) {";for(let e=1;e<n;e++)i+="\n            if (octave == ".concat(e,") {\n                return getImage").concat(e,"(y, x);\n            }\n            ");i+="}";const r={variableNames:[...o,"extrema","radial"],outputShape:[e.shape[0],t.shape[0],2],userCode:"\n                ".concat(i,"\n\n                void main() {\n                    ivec3 coords = getOutputCoords();\n                    int featureIndex = coords[0];\n                    int radialIndex = coords[1];\n                    int propertyIndex = coords[2];\n\n                    int radialY = int(getRadial(radialIndex, 0));\n                    int radialX = int(getRadial(radialIndex, 1));\n                    float radialW = getRadial(radialIndex, 2);\n\n                    int octave = int(getExtrema(featureIndex, 1));\n                    int y = int(getExtrema(featureIndex, 2));\n                    int x = int(getExtrema(featureIndex, 3));\n\n                    int xp = x + radialX;\n                    int yp = y + radialY;\n\n                    float dy = getPixel(octave, yp+1, xp) - getPixel(octave, yp-1, xp);\n                    float dx = getPixel(octave, yp, xp+1) - getPixel(octave, yp, xp-1);\n\n                    if (propertyIndex == 0) {\n                    // be careful that atan(0, 0) gives 1.57 instead of 0 (different from js), but doesn't matter here, coz magnitude is 0\n                    \n                    float angle = atan(dy, dx) + ").concat(Math.PI,";\n                    float fbin = angle * ").concat(cue,". * ").concat(.159154943091895,";\n                    setOutput(fbin);\n                    return;\n                    }\n\n                    if (propertyIndex == 1) {\n                        float mag = sqrt(dx * dx + dy * dy);\n                        float magnitude = radialW * mag;\n                        setOutput(magnitude);\n                        return;\n                    }\n                }\n\n                ")},s={variableNames:["fbinMag"],outputShape:[e.shape[0],cue],userCode:"\n            void main() {\n                ivec2 coords = getOutputCoords();\n                int featureIndex = coords[0];\n                int binIndex = coords[1];\n\n                float sum = 0.;\n                for (int i = 0; i < ".concat(t.shape[0],"; i++) {\n                    float fbin = getFbinMag(featureIndex, i, 0);\n                    int bin = int(floor(fbin - 0.5));\n                    int b1 = imod(bin + ").concat(cue,", ").concat(cue,");\n                    int b2 = imod(bin + 1 + ").concat(cue,", ").concat(cue,");\n\n                    if (b1 == binIndex || b2 == binIndex) {\n                        float magnitude = getFbinMag(featureIndex, i, 1);\n                        float w2 = fbin - float(bin) - 0.5;\n                        float w1 = w2 * -1. + 1.;\n\n                        if (b1 == binIndex) {\n                            sum += w1 * magnitude;\n                        }\n                        if (b2 == binIndex) {\n                            sum += w2 * magnitude;\n                        }\n                    }\n                }\n                setOutput(sum);\n            }\n            ")};gue[a]=[r,s]}return gue[a]}(n,a,o),l=i.runWebGLProgram(r,[...t,n,a],a.dtype),c=i.runWebGLProgram(s,[l],a.dtype);return i.disposeIntermediateTensorInfo(l),c}},due={};const hue={kernelName:"DownsampleBilinear",backendName:"webgl",kernelFunc:e=>{const t=e.inputs.image,n=e.backend,a=function(e){const t=e.shape[1],n=e.shape[0],a="w"+t+"h"+n;if(!due.hasOwnProperty(a)){const e={variableNames:["p"],outputShape:[Math.floor(n/2),Math.floor(t/2)],userCode:"\n            void main() {\n                ivec2 coords = getOutputCoords();\n                int y = coords[0] * 2;\n                int x = coords[1] * 2;\n        \n                float sum = getP(y, x) * 0.25;\n                sum += getP(y+1,x) * 0.25; \n                sum += getP(y, x+1) * 0.25; \n                sum += getP(y+1,x+1) * 0.25;\n                setOutput(sum);\n            }\n            "};due[a]=e}return due[a]}(t);return n.runWebGLProgram(a,[t],t.dtype)}},pue={kernelName:"ExtremaReduction",backendName:"webgl",kernelFunc:e=>{const{extremasResultT:t}=e.inputs,n=e.backend,a=t.shape[0],o=t.shape[1],i={variableNames:["extrema"],outputShape:[Math.floor(a/2),Math.floor(o/2)],userCode:"\n\t\t  void main() {\n\t\t\tivec2 coords = getOutputCoords();\n\t\t\tint y = coords[0] * 2;\n\t\t\tint x = coords[1] * 2;\n  \n\t\t\tfloat location = 0.0;\n\t\t\tfloat values = getExtrema(y, x);\n  \n\t\t\tif (getExtrema(y+1, x) != 0.0) {\n\t\t\t  location = 1.0;\n\t\t  values = getExtrema(y+1, x);\n\t\t\t}\n\t\t\telse if (getExtrema(y, x+1) != 0.0) {\n\t\t\t  location = 2.0;\n\t\t  values = getExtrema(y, x+1);\n\t\t\t}\n\t\t\telse if (getExtrema(y+1, x+1) != 0.0) {\n\t\t\t  location = 3.0;\n\t\t  values = getExtrema(y+1, x+1);\n\t\t\t}\n  \n\t\t\tif (values < 0.0) {\n\t\t\t  setOutput(location * -1000.0 + values);\n\t\t\t} else {\n\t\t\t  setOutput(location * 1000.0 + values);\n\t\t\t}\n\t\t  }\n\t\t"};return n.runWebGLProgram(i,[t],t.dtype)}},mue={};const Iue={kernelName:"SmoothHistograms",backendName:"webgl",kernelFunc:e=>{let{histograms:t}=e.inputs;const n=e.backend,a=function(e){const t="h".concat(e.shape[0]);if(!mue.hasOwnProperty(t)){const n={variableNames:["histogram"],outputShape:[e.shape[0],36],userCode:"\n            void main() {\n                ivec2 coords = getOutputCoords();\n\n                int featureIndex = coords[0];\n                int binIndex = coords[1];\n\n                int prevBin = imod(binIndex - 1 + ".concat(36,", ").concat(36,");\n                int nextBin = imod(binIndex + 1, ").concat(36,");\n                float result = 0.274068619061197 * getHistogram(featureIndex, prevBin) + 0.451862761877606 * getHistogram(featureIndex, binIndex) + 0.274068619061197 * getHistogram(featureIndex, nextBin);\n\n                setOutput(result);\n            }\n            ")};mue[t]=n}return mue[t]}(t);for(let o=0;o<5;o++){const e=t;t=n.runWebGLProgram(a,[t],t.dtype),o>0&&n.disposeIntermediateTensorInfo(e)}return t}},Cue={};const fue={kernelName:"UpsampleBilinear",backendName:"webgl",kernelFunc:e=>{const{image:t,targetImage:n}=e.inputs,a=e.backend,o=function(e,t){const n=t.shape[1],a=t.shape[0],o="w"+n+"h"+a;if(!Cue.hasOwnProperty(o)){const e={variableNames:["p"],outputShape:[a,n],userCode:"\n              void main() {\n                ivec2 coords = getOutputCoords();\n                int j = coords[0];\n                int i = coords[1];\n        \n                float sj = 0.5 * float(j) - 0.25; \n                float si = 0.5 * float(i) - 0.25;\n        \n                float sj0 = floor(sj);\n                float sj1 = ceil(sj);\n                float si0 = floor(si);\n                float si1 = ceil(si);\n        \n                int sj0I = int(sj0);\n                int sj1I = int(sj1);\n                int si0I = int(si0);\n                int si1I = int(si1);\n        \n                float sum = 0.0;\n                sum += getP(sj0I, si0I) * (si1 - si) * (sj1 - sj);\n                sum += getP(sj1I, si0I) * (si1 - si) * (sj - sj0);\n                sum += getP(sj0I, si1I) * (si - si0) * (sj1 - sj);\n                sum += getP(sj1I, si1I) * (si - si0) * (sj - sj0);\n                setOutput(sum);\n              }\n            "};Cue[o]=e}return Cue[o]}(0,n);return a.runWebGLProgram(o,[t],t.dtype)}};ZF(Qge),ZF(qge),ZF(eue),ZF(nue),ZF(rue),ZF(lue),ZF(uue),ZF(hue),ZF(pue),ZF(Iue),ZF(fue);Oge.length,Oge.length;class bue{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.debugMode=n,this.width=e,this.height=t;let a=0;for(;e>=8&&t>=8&&(e/=2,t/=2,a++,5!==a););this.numOctaves=a,this.tensorCaches={},this.kernelCaches={}}detectImageData(e){const t=new Uint8ClampedArray(4*e.length);for(let a=0;a<e.length;a++)t[4*a]=e[a],t[4*a+1]=e[a],t[4*a+2]=e[a],t[4*a+3]=255;const n=new ImageData(t,this.width,this.height);return this.detect(n)}detect(e){let t=null;const n=[];for(let I=0;I<this.numOctaves;I++){let t,a;t=0===I?this._applyFilter(e):this._downsampleBilinear(n[I-1][n[I-1].length-1]),a=this._applyFilter(t),n.push([t,a])}const a=[];for(let I=0;I<this.numOctaves;I++){let e=this._differenceImageBinomial(n[I][0],n[I][1]);a.push(e)}const o=[];for(let I=1;I<this.numOctaves-1;I++){const e=this._buildExtremas(a[I-1],a[I],a[I+1]);o.push(e)}const i=this._applyPrune(o),r=this._computeLocalization(i,a),s=this._computeOrientationHistograms(r,n),l=this._smoothHistograms(s),c=this._computeExtremaAngles(l),g=this._computeExtremaFreak(n,r,c),u=this._computeFreakDescriptors(g),d=r.arraySync(),h=c.arraySync(),p=u.arraySync();this.debugMode&&(t={pyramidImages:n.map((e=>e.map((e=>e.arraySync())))),dogPyramidImages:a.map((e=>e?e.arraySync():null)),extremasResults:o.map((e=>e.arraySync())),extremaAngles:c.arraySync(),prunedExtremas:i,localizedExtremas:r.arraySync()}),n.forEach((e=>e.forEach((e=>e.dispose())))),a.forEach((e=>e&&e.dispose())),o.forEach((e=>e.dispose())),r.dispose(),s.dispose(),l.dispose(),c.dispose(),g.dispose(),u.dispose();const m=[];for(let I=0;I<d.length;I++){if(0==d[I][0])continue;const e=[];for(let r=0;r<p[I].length;r+=4){let t=16777216*p[I][r]+65536*p[I][r+1]+256*p[I][r+2]+p[I][r+3];e.push(t)}const t=d[I][1],n=d[I][2],a=d[I][3]*Math.pow(2,t)+Math.pow(2,t-1)-.5,o=n*Math.pow(2,t)+Math.pow(2,t-1)-.5,i=Math.pow(2,t);m.push({maxima:d[I][0]>0,x:a,y:o,scale:i,angle:h[I],descriptors:e})}return{featurePoints:m,debugExtra:t}}_computeFreakDescriptors(e){if(!this.tensorCaches.computeFreakDescriptors){const t=[],n=[];for(let i=0;i<e.shape[1];i++)for(let a=i+1;a<e.shape[1];a++)t.push(i),n.push(a);const a=wJ(t,[t.length]).cast("int32"),o=wJ(n,[n.length]).cast("int32");this.tensorCaches.computeFreakDescriptors={positionT:XJ(vD([a,o],1))}}const{positionT:t}=this.tensorCaches.computeFreakDescriptors;return VJ((()=>RJ().runKernel("ComputeFreakDescriptors",{extremaFreaks:e,positionT:t})))}_computeExtremaFreak(e,t,n){this.tensorCaches._computeExtremaFreak||VJ((()=>{const e=wJ(Oge);this.tensorCaches._computeExtremaFreak={freakPointsT:XJ(e)}}));const{freakPointsT:a}=this.tensorCaches._computeExtremaFreak,o=[];for(let i=1;i<e.length;i++)o.push(e[i][1]);return VJ((()=>RJ().runKernel("ComputeExtremaFreak",{gaussianImagesT:o,prunedExtremas:t,prunedExtremasAngles:n,freakPointsT:a,pyramidImagesLength:e.length})))}_computeExtremaAngles(e){return VJ((()=>RJ().runKernel("ComputeExtremaAngles",{histograms:e})))}_computeOrientationHistograms(e,t){const n=[];for(let o=1;o<t.length;o++)n.push(t[o][1]);this.tensorCaches.orientationHistograms||VJ((()=>{const e=-1/18,t=Math.ceil(4.5),n=[];for(let a=-t;a<=t;a++)for(let o=-t;o<=t;o++){const t=o*o+a*a;if(t<=20.25){const i=t*e;let r=.0013888888*(720+i*(720+i*(360+i*(120+i*(30+i*(6+i))))));n.push([a,o,r])}}this.tensorCaches.orientationHistograms={radialPropertiesT:XJ(wJ(n,[n.length,3]))}}));const{radialPropertiesT:a}=this.tensorCaches.orientationHistograms;return VJ((()=>RJ().runKernel("ComputeOrientationHistograms",{gaussianImagesT:n,prunedExtremasT:e,radialPropertiesT:a,pyramidImagesLength:t.length})))}_smoothHistograms(e){return VJ((()=>RJ().runKernel("SmoothHistograms",{histograms:e})))}_computeLocalization(e,t){return VJ((()=>{const n=RJ().runKernel("ComputeLocalization",{prunedExtremasList:e,dogPyramidImagesT:t}).arraySync(),a=[];for(let e=0;e<n.length;e++){a.push([]);for(let t=0;t<n[e].length;t++)a[e].push([])}const o=[];for(let t=0;t<e.length;t++)o[t]=[e[t][0],e[t][1],e[t][2],e[t][3]];for(let e=0;e<o.length;e++){if(0===o[e][0])continue;const t=n[e],a=.5*(t[1][2]-t[1][0]),i=.5*(t[2][1]-t[0][1]),r=t[1][2]+t[1][0]-2*t[1][1],s=t[2][1]+t[0][1]-2*t[1][1],l=.25*(t[0][0]+t[2][2]-t[0][2]-t[2][0]),c=r*s-l*l,g=(s*-a+-l*-i)/c,u=(-l*-a+r*-i)/c,d=o[e][2]+u,h=o[e][3]+g;Math.abs(c)<1e-4||(o[e][2]=d,o[e][3]=h)}return wJ(o,[o.length,o[0].length],"float32")}))}_applyPrune(e){const t=[],n=[];for(let o=0;o<100;o++){n.push([]),t.push([]);for(let e=0;e<5;e++)n[o].push([0,0,0,0]),t[o].push(0)}VJ((()=>{for(let a=0;a<e.length;a++){const o=RJ().runKernel("ExtremaReduction",{extremasResultT:e[a]}),i=a+1,r=o.arraySync(),s=o.shape[0],l=o.shape[1],c=2*l/10,g=2*s/10;for(let e=0;e<s;e++)for(let a=0;a<l;a++){const o=r[e][a];if(0==o)continue;const s=o%1e3,l=Math.floor(Math.abs(o)/1e3),u=2*a+(2===l||3===l?1:0),d=2*e+(1===l||3===l?1:0),h=Math.floor(u/c),p=10*Math.floor(d/g)+h,m=Math.abs(s);let I=5;for(;I>=1&&m>t[p][I-1];)I-=1;if(I<5){for(let e=4;e>=I+1;e--)t[p][e]=t[p][e-1],n[p][e][0]=n[p][e-1][0],n[p][e][1]=n[p][e-1][1],n[p][e][2]=n[p][e-1][2],n[p][e][3]=n[p][e-1][3];t[p][I]=m,n[p][I][0]=s,n[p][I][1]=i,n[p][I][2]=d,n[p][I][3]=u}}}}));const a=[];for(let o=0;o<100;o++)for(let e=0;e<5;e++)a.push(n[o][e]);return a}_buildExtremas(e,t,n){return VJ((()=>RJ().runKernel("BuildExtremas",{image0:e,image1:t,image2:n})))}_differenceImageBinomial(e,t){return VJ((()=>e.sub(t)))}_applyFilter(e){return VJ((()=>RJ().runKernel("BinomialFilter",{image:e})))}_downsampleBilinear(e){return VJ((()=>RJ().runKernel("DownsampleBilinear",{image:e})))}_compileAndRun(e,t){const n=EJ().compileAndRun(e,t);return RJ().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}_runWebGLProgram(e,t,n){const a=EJ().runWebGLProgram(e,t,n);return RJ().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}}class yue{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.debugMode=n,this.width=e,this.height=t;let a=Math.min(e,t)/2,o=Math.pow(2,Math.round(Math.log(a)/Math.log(2)));this.cropSize=o,this.detector=new bue(o,o,n),this.kernelCaches={},this.lastRandomIndex=4}detect(e){const t=Math.floor(this.height/2-this.cropSize/2),n=Math.floor(this.width/2-this.cropSize/2),a=this._detect(e,n,t);return this.debugMode&&(a.debugExtra.crop={startX:n,startY:t,cropSize:this.cropSize}),a}detectMoving(e){const t=this.lastRandomIndex%3,n=Math.floor(this.lastRandomIndex/3);let a=Math.floor(this.height/2-this.cropSize+n*this.cropSize/2),o=Math.floor(this.width/2-this.cropSize+t*this.cropSize/2);return o<0&&(o=0),a<0&&(a=0),o>=this.width-this.cropSize&&(o=this.width-this.cropSize-1),a>=this.height-this.cropSize&&(a=this.height-this.cropSize-1),this.lastRandomIndex=(this.lastRandomIndex+1)%9,this._detect(e,o,a)}_detect(e,t,n){const a=e.slice([n,t],[this.cropSize,this.cropSize]),{featurePoints:o,debugExtra:i}=this.detector.detect(a);return o.forEach((e=>{e.x+=t,e.y+=n})),this.debugMode&&(i.projectedImage=a.arraySync()),a.dispose(),{featurePoints:o,debugExtra:i}}}const Aue=e=>{let{image:t,ratio:n}=e;const a=Math.round(t.width*n),o=Math.round(t.height*n),i=new Uint8Array(a*o);for(let r=0;r<a;r++){let e=Math.round(1*r/n),s=Math.round(1*(r+1)/n)-1;s>=t.width&&(s=t.width-1);for(let l=0;l<o;l++){let o=Math.round(1*l/n),c=Math.round(1*(l+1)/n)-1;c>=t.height&&(c=t.height-1);let g=0,u=0;for(let n=e;n<=s;n++)for(let e=o;e<=c;e++)g+=1*t.data[e*t.width+n],u+=1;i[l*a+r]=Math.floor(g/u)}}return{data:i,width:a,height:o}},vue=e=>{const t=[];let n=100/Math.min(e.width,e.height);for(;;)if(t.push(n),n*=Math.pow(2,1/3),n>=.95){n=1;break}t.push(n),t.reverse();const a=[];for(let o=0;o<t.length;o++)e.width,t[o],e.height,t[o],a.push(Object.assign(Aue({image:e,ratio:t[o]}),{scale:t[o]}));return a},Sue=e=>{const t=Math.min(e.width,e.height),n=[],a=[];n.push(256/t),n.push(128/t);for(let o=0;o<n.length;o++)a.push(Object.assign(Aue({image:e,ratio:n[o]}),{scale:n[o]}));return a},xue=e=>{const{v1:t,v2:n}=e;let a=0;for(let o=0;o<t.length;o++){let e=(t[o]^n[o])>>>0;a+=Gue(e)}return a},Gue=e=>{var t=e-(e>>1&1431655765);return t=((t=((t=((t=(t>>2&858993459)+(858993459&t))>>4)+t&252645135)>>8)+t&16711935)>>16)+t&65535},Zue=()=>({seed:1234,arrayShuffle(e){const{arr:t,sampleSize:n}=e;for(let a=0;a<n;a++){this.seed=(214013*this.seed+2531011)%-2147483648;let e=this.seed>>16&32767;e%=t.length;let n=t[a];t[a]=t[e],t[e]=n}},nextInt(e){this.seed=(214013*this.seed+2531011)%-2147483648;let t=this.seed>>16&32767;return t%=e,t}}),wue=e=>{let{points:t}=e;const n=[];for(let o=0;o<t.length;o++)n.push(o);const a=Zue();return{rootNode:kue({points:t,pointIndexes:n,centerPointIndex:null,randomizer:a})}},kue=e=>{const{points:t,pointIndexes:n,centerPointIndex:a,randomizer:o}=e;let i=!1;(n.length<=8||n.length<=16)&&(i=!0);const r={};if(!i){const e=(e=>{const{points:t,pointIndexes:n,randomizer:a}=e,o=[];for(let l=0;l<n.length;l++)o.push(l);let i=Number.MAX_SAFE_INTEGER,r=-1;const s=[];for(let l=0;l<128;l++){a.arrayShuffle({arr:o,sampleSize:8});let e=0;const c=[];for(let a=0;a<n.length;a++){let i=Number.MAX_SAFE_INTEGER;for(let e=0;e<8;e++){const r=n[o[e]],s=xue({v1:t[n[a]].descriptors,v2:t[r].descriptors});s<i&&(c[a]=o[e],i=s)}e+=i}s.push(c),e<i&&(i=e,r=l)}return s[r]})({points:t,pointIndexes:n,randomizer:o});for(let t=0;t<e.length;t++)void 0===r[n[e[t]]]&&(r[n[e[t]]]=[]),r[n[e[t]]].push(n[t])}1===Object.keys(r).length&&(i=!0);const s={centerPointIndex:a};if(i){s.leaf=!0,s.pointIndexes=[];for(let e=0;e<n.length;e++)s.pointIndexes.push(n[e]);return s}return s.leaf=!1,s.children=[],Object.keys(r).forEach((e=>{s.children.push(kue({points:t,pointIndexes:r[e],centerPointIndex:e,randomizer:o}))})),s};var Bue=4294967295;function Rue(e,t,n){var a=Math.floor(n/4294967296),o=n;e.setUint32(t,a),e.setUint32(t+4,o)}function Wue(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}var Vue,Nue,Xue,Mue=(typeof process>"u"||"never"!==(null===(Vue=null==process?void 0:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===Vue?void 0:Vue.TEXT_ENCODING))&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function Tue(e){for(var t=e.length,n=0,a=0;a<t;){var o=e.charCodeAt(a++);if(4294967168&o)if(4294965248&o){if(o>=55296&&o<=56319&&a<t){var i=e.charCodeAt(a);56320===(64512&i)&&(++a,o=((1023&o)<<10)+(1023&i)+65536)}n+=4294901760&o?4:3}else n+=2;else n++}return n}var Eue=Mue?new TextEncoder:void 0,Fue=Mue?typeof process<"u"&&"force"!==(null===(Nue=null==process?void 0:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===Nue?void 0:Nue.TEXT_ENCODING)?200:0:Bue;var Hue=null!=Eue&&Eue.encodeInto?function(e,t,n){Eue.encodeInto(e,t.subarray(n))}:function(e,t,n){t.set(Eue.encode(e),n)};function Jue(e,t,n){for(var a=t,o=a+n,i=[],r="";a<o;){var s=e[a++];if(128&s)if(192===(224&s)){var l=63&e[a++];i.push((31&s)<<6|l)}else if(224===(240&s)){l=63&e[a++];var c=63&e[a++];i.push((31&s)<<12|l<<6|c)}else if(240===(248&s)){var g=(7&s)<<18|(l=63&e[a++])<<12|(c=63&e[a++])<<6|63&e[a++];g>65535&&(g-=65536,i.push(g>>>10&1023|55296),g=56320|1023&g),i.push(g)}else i.push(s);else i.push(s);i.length>=4096&&(r+=String.fromCharCode.apply(String,i),i.length=0)}return i.length>0&&(r+=String.fromCharCode.apply(String,i)),r}var Yue=Mue?new TextDecoder:null,Lue=Mue?typeof process<"u"&&"force"!==(null===(Xue=null==process?void 0:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===Xue?void 0:Xue.TEXT_DECODER)?200:0:Bue;var zue=function(){return function(e,t){this.type=e,this.data=t}}(),Kue=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Due=function(e){function t(n){var a=e.call(this,n)||this,o=Object.create(t.prototype);return Object.setPrototypeOf(a,o),Object.defineProperty(a,"name",{configurable:!0,enumerable:!1,value:t.name}),a}return Kue(t,e),t}(Error),Uue=4294967295,Pue=17179869183;var Oue={type:-1,encode:function(e){if(e instanceof Date){var t=function(e){var t=e.getTime(),n=Math.floor(t/1e3),a=1e6*(t-1e3*n),o=Math.floor(a/1e9);return{sec:n+o,nsec:a-1e9*o}}(e);return function(e){var t,n=e.sec,a=e.nsec;if(n>=0&&a>=0&&n<=Pue){if(0===a&&n<=Uue){var o=new Uint8Array(4);return(t=new DataView(o.buffer)).setUint32(0,n),o}var i=n/4294967296,r=4294967295&n;return o=new Uint8Array(8),(t=new DataView(o.buffer)).setUint32(0,a<<2|3&i),t.setUint32(4,r),o}return o=new Uint8Array(12),(t=new DataView(o.buffer)).setUint32(0,a),Rue(t,4,n),o}(t)}return null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:var n=t.getUint32(0);return{sec:4294967296*(3&n)+t.getUint32(4),nsec:n>>>2};case 12:return{sec:Wue(t,4),nsec:t.getUint32(0)};default:throw new Due("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},_ue=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Oue)}return e.prototype.register=function(e){var t=e.type,n=e.encode,a=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=a;else{var o=1+t;this.builtInEncoders[o]=n,this.builtInDecoders[o]=a}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++){if(null!=(a=this.builtInEncoders[n]))if(null!=(o=a(e,t)))return new zue(-1-n,o)}for(n=0;n<this.encoders.length;n++){var a,o;if(null!=(a=this.encoders[n]))if(null!=(o=a(e,t)))return new zue(n,o)}return e instanceof zue?e:null},e.prototype.decode=function(e,t,n){var a=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return a?a(e,t,n):new zue(t,e)},e.defaultCodec=new e,e}();function Que(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}var jue=function(){function e(e,t,n,a,o,i,r,s){void 0===e&&(e=_ue.defaultCodec),void 0===t&&(t=void 0),void 0===n&&(n=100),void 0===a&&(a=2048),void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===s&&(s=!1),this.extensionCodec=e,this.context=t,this.maxDepth=n,this.initialBufferSize=a,this.sortKeys=o,this.forceFloat32=i,this.ignoreUndefined=r,this.forceIntegerToFloat=s,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),a=new DataView(t);n.set(this.bytes),this.view=a,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too long string: ".concat(e," bytes in UTF-8"));this.writeU8(219),this.writeU32(e)}},e.prototype.encodeString=function(e){if(e.length>Fue){var t=Tue(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),Hue(e,this.bytes,this.pos),this.pos+=t}else{t=Tue(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,n){for(var a=e.length,o=n,i=0;i<a;){var r=e.charCodeAt(i++);if(4294967168&r){if(4294965248&r){if(r>=55296&&r<=56319&&i<a){var s=e.charCodeAt(i);56320===(64512&s)&&(++i,r=((1023&r)<<10)+(1023&s)+65536)}4294901760&r?(t[o++]=r>>18&7|240,t[o++]=r>>12&63|128,t[o++]=r>>6&63|128):(t[o++]=r>>12&15|224,t[o++]=r>>6&63|128)}else t[o++]=r>>6&31|192;t[o++]=63&r|128}else t[o++]=r}}(e,this.bytes,this.pos),this.pos+=t}},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)));this.encodeMap(e,t)}},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large binary: ".concat(t));this.writeU8(198),this.writeU32(t)}var n=Que(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else{if(!(n<4294967296))throw new Error("Too large array: ".concat(n));this.writeU8(221),this.writeU32(n)}for(var a=0,o=e;a<o.length;a++){var i=o[a];this.doEncode(i,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var n=0,a=0,o=t;a<o.length;a++){void 0!==e[o[a]]&&n++}return n},e.prototype.encodeMap=function(e,t){var n=Object.keys(e);this.sortKeys&&n.sort();var a=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(a<16)this.writeU8(128+a);else if(a<65536)this.writeU8(222),this.writeU16(a);else{if(!(a<4294967296))throw new Error("Too large map object: ".concat(a));this.writeU8(223),this.writeU32(a)}for(var o=0,i=n;o<i.length;o++){var r=i[o],s=e[r];this.ignoreUndefined&&void 0===s||(this.encodeString(r),this.doEncode(s,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large extension object: ".concat(t));this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),function(e,t,n){var a=n/4294967296,o=n;e.setUint32(t,a),e.setUint32(t+4,o)}(this.view,this.pos,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),Rue(this.view,this.pos,e),this.pos+=8},e}(),que={};function $ue(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var ede=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){e:for(var a=0,o=this.caches[n-1];a<o.length;a++){for(var i=o[a],r=i.bytes,s=0;s<n;s++)if(r[s]!==e[t+s])continue e;return i.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],a={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=a:n.push(a)},e.prototype.decode=function(e,t,n){var a=this.find(e,t,n);if(null!=a)return this.hit++,a;this.miss++;var o=Jue(e,t,n),i=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(i,o),o},e}(),tde=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function r(e){try{l(a.next(e))}catch(t){i(t)}}function s(e){try{l(a.throw(e))}catch(t){i(t)}}function l(e){e.done?o(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(r,s)}l((a=a.apply(e,t||[])).next())}))},nde=function(e,t){var n,a,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(o=2&i[0]?a.return:i[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,a=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){r.label=i[1];break}if(6===i[0]&&r.label<o[1]){r.label=o[1],o=i;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(i);break}o[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(s){i=[6,s],a=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ade=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(n){t[n]=e[n]&&function(t){return new Promise((function(a,o){(function(e,t,n,a){Promise.resolve(a).then((function(t){e({value:t,done:n})}),t)})(a,o,(t=e[n](t)).done,t.value)}))}}},ode=function(e){return this instanceof ode?(this.v=e,this):new ode(e)},ide=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,o=n.apply(e,t||[]),i=[];return a={},r("next"),r("throw"),r("return"),a[Symbol.asyncIterator]=function(){return this},a;function r(e){o[e]&&(a[e]=function(t){return new Promise((function(n,a){i.push([e,t,n,a])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof ode?Promise.resolve(e.value.v).then(l,c):g(i[0][2],e)}(o[e](t))}catch(n){g(i[0][3],n)}}function l(e){s("next",e)}function c(e){s("throw",e)}function g(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}},rde=function(e){var t=typeof e;return"string"===t||"number"===t},sde=new DataView(new ArrayBuffer(0)),lde=new Uint8Array(sde.buffer),cde=function(){try{sde.getInt8(0)}catch(DH){return DH.constructor}throw new Error("never reached")}(),gde=new cde("Insufficient data"),ude=new ede,dde=function(){function e(e,t,n,a,o,i,r,s){void 0===e&&(e=_ue.defaultCodec),void 0===t&&(t=void 0),void 0===n&&(n=Bue),void 0===a&&(a=Bue),void 0===o&&(o=Bue),void 0===i&&(i=Bue),void 0===r&&(r=Bue),void 0===s&&(s=ude),this.extensionCodec=e,this.context=t,this.maxStrLength=n,this.maxBinLength=a,this.maxArrayLength=o,this.maxMapLength=i,this.maxExtLength=r,this.keyDecoder=s,this.totalPos=0,this.pos=0,this.view=sde,this.bytes=lde,this.headByte=-1,this.stack=[]}return e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=Que(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=Que(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=Que(e),a=new Uint8Array(t.length+n.length);a.set(t),a.set(n,t.length),this.setBuffer(a)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return new RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return nde(this,(function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}}))},e.prototype.decodeAsync=function(e){var t,n,a,o;return tde(this,void 0,void 0,(function(){var i,r,s,l,c,g,u,d;return nde(this,(function(h){switch(h.label){case 0:i=!1,h.label=1;case 1:h.trys.push([1,6,7,12]),t=ade(e),h.label=2;case 2:return[4,t.next()];case 3:if((n=h.sent()).done)return[3,5];if(s=n.value,i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s);try{r=this.doDecodeSync(),i=!0}catch(p){if(!(p instanceof cde))throw p}this.totalPos+=this.pos,h.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return l=h.sent(),a={error:l},[3,12];case 7:return h.trys.push([7,,10,11]),n&&!n.done&&(o=t.return)?[4,o.call(t)]:[3,9];case 8:h.sent(),h.label=9;case 9:return[3,11];case 10:if(a)throw a.error;return[7];case 11:return[7];case 12:if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,r]}throw g=(c=this).headByte,u=c.pos,d=c.totalPos,new RangeError("Insufficient data in parsing ".concat($ue(g)," at ").concat(d," (").concat(u," in the current buffer)"))}}))}))},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return ide(this,arguments,(function(){var n,a,o,i,r,s,l,c,g;return nde(this,(function(u){switch(u.label){case 0:n=t,a=-1,u.label=1;case 1:u.trys.push([1,13,14,19]),o=ade(e),u.label=2;case 2:return[4,ode(o.next())];case 3:if((i=u.sent()).done)return[3,12];if(r=i.value,t&&0===a)throw this.createExtraByteError(this.totalPos);this.appendBuffer(r),n&&(a=this.readArraySize(),n=!1,this.complete()),u.label=4;case 4:u.trys.push([4,9,,10]),u.label=5;case 5:return[4,ode(this.doDecodeSync())];case 6:return[4,u.sent()];case 7:return u.sent(),0===--a?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((s=u.sent())instanceof cde))throw s;return[3,10];case 10:this.totalPos+=this.pos,u.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return l=u.sent(),c={error:l},[3,19];case 14:return u.trys.push([14,,17,18]),i&&!i.done&&(g=o.return)?[4,ode(g.call(o))]:[3,16];case 15:u.sent(),u.label=16;case 16:return[3,18];case 17:if(c)throw c.error;return[7];case 18:return[7];case 19:return[2]}}))}))},e.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){if(0!==(a=e-128)){this.pushMapState(a),this.complete();continue e}t={}}else if(e<160){if(0!==(a=e-144)){this.pushArrayState(a),this.complete();continue e}t=[]}else{var n=e-160;t=this.decodeUtf8String(n,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e){n=this.lookU8();t=this.decodeUtf8String(n,1)}else if(218===e){n=this.lookU16();t=this.decodeUtf8String(n,2)}else if(219===e){n=this.lookU32();t=this.decodeUtf8String(n,4)}else if(220===e){if(0!==(a=this.readU16())){this.pushArrayState(a),this.complete();continue e}t=[]}else if(221===e){if(0!==(a=this.readU32())){this.pushArrayState(a),this.complete();continue e}t=[]}else if(222===e){if(0!==(a=this.readU16())){this.pushMapState(a),this.complete();continue e}t={}}else if(223===e){if(0!==(a=this.readU32())){this.pushMapState(a),this.complete();continue e}t={}}else if(196===e){var a=this.lookU8();t=this.decodeBinary(a,1)}else if(197===e){a=this.lookU16();t=this.decodeBinary(a,2)}else if(198===e){a=this.lookU32();t=this.decodeBinary(a,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){a=this.lookU8();t=this.decodeExtension(a,1)}else if(200===e){a=this.lookU16();t=this.decodeExtension(a,2)}else{if(201!==e)throw new Due("Unrecognized type byte: ".concat($ue(e)));a=this.lookU32();t=this.decodeExtension(a,4)}this.complete();for(var o=this.stack;o.length>0;){var i=o[o.length-1];if(0===i.type){if(i.array[i.position]=t,i.position++,i.position!==i.size)continue e;o.pop(),t=i.array}else{if(1===i.type){if(!rde(t))throw new Due("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new Due("The key __proto__ is not allowed");i.key=t,i.type=2;continue e}if(i.map[i.key]=t,i.readCount++,i.readCount!==i.size){i.key=null,i.type=1;continue e}o.pop(),t=i.map}}return t}},e.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new Due("Unrecognized array type byte: ".concat($ue(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new Due("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new Due("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){var n;if(e>this.maxStrLength)throw new Due("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw gde;var a,o=this.pos+t;return a=this.stateIsMapKey()&&null!==(n=this.keyDecoder)&&void 0!==n&&n.canBeCached(e)?this.keyDecoder.decode(this.bytes,o,e):e>Lue?function(e,t,n){var a=e.subarray(t,t+n);return Yue.decode(a)}(this.bytes,o,e):Jue(this.bytes,o,e),this.pos+=t+e,a},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new Due("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw gde;var n=this.pos+t,a=this.bytes.subarray(n,n+e);return this.pos+=t+e,a},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new Due("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),a=this.decodeBinary(e,t+1);return this.extensionCodec.decode(a,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e=function(e,t){return 4294967296*e.getUint32(t)+e.getUint32(t+4)}(this.view,this.pos);return this.pos+=8,e},e.prototype.readI64=function(){var e=Wue(this.view,this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}(),hde={};class pde{constructor(){this.data=null}compileImageTargets(e,t){return new Promise((async(n,a)=>{const o=[];for(let t=0;t<e.length;t++){const n=e[t],a=this.createProcessCanvas(n).getContext("2d");a.drawImage(n,0,0,n.width,n.height);const i=a.getImageData(0,0,n.width,n.height),r=new Uint8Array(n.width*n.height);for(let e=0;e<r.length;e++){const t=4*e;r[e]=Math.floor((i.data[t]+i.data[t+1]+i.data[t+2])/3)}const s={data:r,height:n.height,width:n.width};o.push(s)}const i=50/o.length;let r=0;this.data=[];for(let e=0;e<o.length;e++){const n=o[e],a=vue(n),s=i/a.length,l=await mde(a,(()=>{r+=s,t(r)}));this.data.push({targetImage:n,imageList:a,matchingData:l})}for(let e=0;e<o.length;e++){const t=Sue(o[e]);this.data[e].trackingImageList=t}const s=await this.compileTrack({progressCallback:t,targetImages:o,basePercent:50});for(let e=0;e<o.length;e++)this.data[e].trackingData=s[e];n(this.data)}))}exportData(){const e=[];for(let t=0;t<this.data.length;t++)e.push({targetImage:{width:this.data[t].targetImage.width,height:this.data[t].targetImage.height},trackingData:this.data[t].trackingData,matchingData:this.data[t].matchingData});return function(e,t){return void 0===t&&(t=que),new jue(t.extensionCodec,t.context,t.maxDepth,t.initialBufferSize,t.sortKeys,t.forceFloat32,t.ignoreUndefined,t.forceIntegerToFloat).encodeSharedRef(e)}({v:2,dataList:e})}importData(e){const t=function(e,t){return void 0===t&&(t=hde),new dde(t.extensionCodec,t.context,t.maxStrLength,t.maxBinLength,t.maxArrayLength,t.maxMapLength,t.maxExtLength).decode(e)}(new Uint8Array(e));if(!t.v||2!==t.v)return console.error("Your compiled .mind might be outdated. Please recompile"),[];const{dataList:n}=t;this.data=[];for(let a=0;a<n.length;a++)this.data.push({targetImage:n[a].targetImage,trackingData:n[a].trackingData,matchingData:n[a].matchingData});return this.data}createProcessCanvas(e){console.warn("missing createProcessCanvas implementation")}compileTrack(e){let{progressCallback:t,targetImages:n,basePercent:a}=e;console.warn("missing compileTrack implementation")}}const mde=async(e,t)=>{const n=[];for(let a=0;a<e.length;a++){const o=e[a],i=new bue(o.width,o.height);await aO(),VJ((()=>{const e=wJ(o.data,[o.data.length],"float32").reshape([o.height,o.width]),{featurePoints:r}=i.detect(e),s=r.filter((e=>e.maxima)),l=r.filter((e=>!e.maxima)),c=wue({points:s}),g=wue({points:l});n.push({maximaPoints:s,minimaPoints:l,maximaPointsCluster:c,minimaPointsCluster:g,width:o.width,height:o.height,scale:o.scale}),t(a)}))}return n},Ide="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHp7Y29uc3RydWN0b3Iocyx0LG8pe3RoaXMuY3Vtc3VtPVtdO2ZvcihsZXQgZT0wO2U8bztlKyspe3RoaXMuY3Vtc3VtLnB1c2goW10pO2ZvcihsZXQgbj0wO248dDtuKyspdGhpcy5jdW1zdW1bZV0ucHVzaCgwKX10aGlzLmN1bXN1bVswXVswXT1zWzBdO2ZvcihsZXQgZT0xO2U8dDtlKyspdGhpcy5jdW1zdW1bMF1bZV09dGhpcy5jdW1zdW1bMF1bZS0xXStzW2VdO2ZvcihsZXQgZT0xO2U8bztlKyspdGhpcy5jdW1zdW1bZV1bMF09dGhpcy5jdW1zdW1bZS0xXVswXStzW2UqdF07Zm9yKGxldCBlPTE7ZTxvO2UrKylmb3IobGV0IG49MTtuPHQ7bisrKXRoaXMuY3Vtc3VtW2VdW25dPXNbZSp0K25dK3RoaXMuY3Vtc3VtW2UtMV1bbl0rdGhpcy5jdW1zdW1bZV1bbi0xXS10aGlzLmN1bXN1bVtlLTFdW24tMV19cXVlcnkocyx0LG8sZSl7bGV0IG49dGhpcy5jdW1zdW1bZV1bb107cmV0dXJuIHQ+MCYmKG4tPXRoaXMuY3Vtc3VtW3QtMV1bb10pLHM+MCYmKG4tPXRoaXMuY3Vtc3VtW2VdW3MtMV0pLHM+MCYmdD4wJiYobis9dGhpcy5jdW1zdW1bdC0xXVtzLTFdKSxufX1jb25zdCBDPTEwLGI9MixNPTYsRj01LEk9Ljk1LEw9LjksTz0uMixaPTgsTj0yNCoyLzMsVT1yPT57Y29uc3R7ZGF0YTpzLHdpZHRoOnQsaGVpZ2h0Om8sc2NhbGU6ZX09cixuPVt0Km9dO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKW5baV09ITE7Y29uc3QgYT1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWFbaV09LTEsYVt0KihvLTEpK2ldPS0xO2ZvcihsZXQgaT0wO2k8bztpKyspYVtpKnRdPS0xLGFbaSp0K3QtMV09LTE7Zm9yKGxldCBpPTE7aTx0LTE7aSsrKWZvcihsZXQgcD0xO3A8by0xO3ArKyl7bGV0IGY9aSt0KnAsaD0wLGM9MDtmb3IobGV0IHU9LTE7dTw9MTt1KyspaCs9c1tmK3QqdSsxXS1zW2YrdCp1LTFdLGMrPXNbZit0K3VdLXNbZi10K3VdO2gvPTMqMjU2LGMvPTMqMjU2LGFbZl09TWF0aC5zcXJ0KChoKmgrYypjKS8yKX1jb25zdCBnPW5ldyBVaW50MzJBcnJheSgxZTMpO2ZvcihsZXQgaT0wO2k8MWUzO2krKylnW2ldPTA7Y29uc3QgZD1bLTEsMSwtdCx0XTtmb3IobGV0IGk9MTtpPHQtMTtpKyspZm9yKGxldCBwPTE7cDxvLTE7cCsrKXtsZXQgZj1pK3QqcCxoPSEwO2ZvcihsZXQgYz0wO2M8ZC5sZW5ndGg7YysrKWlmKGFbZl08PWFbZitkW2NdXSl7aD0hMTticmVha31pZihoKXtsZXQgYz1NYXRoLmZsb29yKGFbZl0qMWUzKTtjPjk5OSYmKGM9OTk5KSxjPDAmJihjPTApLGdbY10rPTEsbltmXT0hMH19Y29uc3Qgdz0uMDIqdCpvO2xldCBqPTk5OSxFPTA7Zm9yKDtqPj0wJiYoRSs9Z1tqXSwhKEU+dykpOylqLS07Zm9yKGxldCBpPTA7aTxuLmxlbmd0aDtpKyspbltpXSYmYVtpXSoxZTM8aiYmKG5baV09ITEpO2NvbnN0IGw9W107Zm9yKGxldCBpPTA7aTxzLmxlbmd0aDtpKyspbFtpXT1zW2ldKnNbaV07Y29uc3QgUz1uZXcgeihzLHQsbyksRD1uZXcgeihsLHQsbyksaz1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgcD0wO3A8bztwKyspe2NvbnN0IGY9cCp0K2k7aWYoIW5bZl0pe2tbZl09MTtjb250aW51ZX1jb25zdCBoPVAoe2ltYWdlOnIsY3g6aSxjeTpwLHNkVGhyZXNoOkYsaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KTtpZihoPT09bnVsbCl7a1tmXT0xO2NvbnRpbnVlfWxldCBjPS0xO2ZvcihsZXQgdT0tQzt1PD1DO3UrKyl7Zm9yKGxldCBtPS1DO208PUM7bSsrKXtpZihtKm0rdSp1PD1iKmIpY29udGludWU7Y29uc3QgeD1SKHtpbWFnZTpyLGN4OmkrbSxjeTpwK3UsdmxlbjpoLHR4OmksdHk6cCxpbWFnZURhdGFDdW1zdW06UyxpbWFnZURhdGFTcXJDdW1zdW06RH0pO2lmKHghPT1udWxsJiZ4PmMmJihjPXgsYz5JKSlicmVha31pZihjPkkpYnJlYWt9a1tmXT1jfXJldHVybiBWKHtpbWFnZTpyLGZlYXR1cmVNYXA6ayx0ZW1wbGF0ZVNpemU6TSxzZWFyY2hTaXplOmIsb2NjU2l6ZTpOLG1heFNpbVRocmVzaDpMLG1pblNpbVRocmVzaDpPLHNkVGhyZXNoOlosaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KX0sVj1yPT57bGV0e2ltYWdlOnMsZmVhdHVyZU1hcDp0LHRlbXBsYXRlU2l6ZTpvLHNlYXJjaFNpemU6ZSxvY2NTaXplOm4sbWF4U2ltVGhyZXNoOmEsbWluU2ltVGhyZXNoOmcsc2RUaHJlc2g6ZCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an09cjtjb25zdHtkYXRhOkUsd2lkdGg6bCxoZWlnaHQ6UyxzY2FsZTpEfT1zO249TWF0aC5mbG9vcihNYXRoLm1pbihzLndpZHRoLHMuaGVpZ2h0KS8xMCk7Y29uc3Qgaz0obyoyKzEpKjMsQT1NYXRoLmZsb29yKGwvayksaT1NYXRoLmZsb29yKFMvayk7bGV0IHA9TWF0aC5mbG9vcihsL24pKk1hdGguZmxvb3IoUy9uKStBKmk7Y29uc3QgZj1bXSxoPW5ldyBGbG9hdDMyQXJyYXkoRS5sZW5ndGgpO2ZvcihsZXQgdT0wO3U8aC5sZW5ndGg7dSsrKWhbdV09dFt1XTtsZXQgYz0wO2Zvcig7YzxwOyl7bGV0IHU9YSxtPS0xLHg9LTE7Zm9yKGxldCB5PTA7eTxTO3krKylmb3IobGV0IFQ9MDtUPGw7VCsrKWhbeSpsK1RdPHUmJih1PWhbeSpsK1RdLG09VCx4PXkpO2lmKG09PT0tMSlicmVhaztjb25zdCB2PVAoe2ltYWdlOnMsY3g6bSxjeTp4LHNkVGhyZXNoOjAsaW1hZ2VEYXRhQ3Vtc3VtOncsaW1hZ2VEYXRhU3FyQ3Vtc3VtOmp9KTtpZih2PT09bnVsbCl7aFt4KmwrbV09MTtjb250aW51ZX1pZih2LyhvKjIrMSk8ZCl7aFt4KmwrbV09MTtjb250aW51ZX1sZXQgcT0xLF89LTE7Zm9yKGxldCB5PS1lO3k8PWU7eSsrKXtmb3IobGV0IFQ9LWU7VDw9ZTtUKyspe2lmKFQqVCt5Knk+ZSplfHxUPT09MCYmeT09PTApY29udGludWU7Y29uc3QgSD1SKHtpbWFnZTpzLHZsZW46dixjeDptK1QsY3k6eCt5LHR4Om0sdHk6eCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an0pO2lmKEghPT1udWxsJiYoSDxxJiYocT1ILHE8ZyYmcTx1KXx8SD5fJiYoXz1ILF8+Ljk5KSkpYnJlYWt9aWYocTxnJiZxPHV8fF8+Ljk5KWJyZWFrfWlmKHE8ZyYmcTx1fHxfPi45OSl7aFt4KmwrbV09MTtjb250aW51ZX1mLnB1c2goe3g6bSx5Onh9KSxjKz0xO2ZvcihsZXQgeT0tbjt5PD1uO3krKylmb3IobGV0IFQ9LW47VDw9bjtUKyspeCt5PDB8fHgreT49U3x8bStUPDB8fG0rVD49bHx8KGhbKHgreSkqbCsobStUKV09MSl9cmV0dXJuIGZ9LFA9KHtpbWFnZTpyLGN4OnMsY3k6dCxzZFRocmVzaDpvLGltYWdlRGF0YUN1bXN1bTplLGltYWdlRGF0YVNxckN1bXN1bTpufSk9PntpZihzLU08MHx8cytNPj1yLndpZHRofHx0LU08MHx8dCtNPj1yLmhlaWdodClyZXR1cm4gbnVsbDtjb25zdCBhPTIqTSsxLGc9YSphO2xldCBkPWUucXVlcnkocy1NLHQtTSxzK00sdCtNKTtkLz1nO2xldCB3PW4ucXVlcnkocy1NLHQtTSxzK00sdCtNKTtyZXR1cm4gdy09MipkKmUucXVlcnkocy1NLHQtTSxzK00sdCtNKSx3Kz1nKmQqZCx3L2c8bypvP251bGw6KHc9TWF0aC5zcXJ0KHcpLHcpfSxSPXI9Pntjb25zdHtpbWFnZTpzLGN4OnQsY3k6byx2bGVuOmUsdHg6bix0eTphLGltYWdlRGF0YUN1bXN1bTpnLGltYWdlRGF0YVNxckN1bXN1bTpkfT1yLHtkYXRhOncsd2lkdGg6aixoZWlnaHQ6RX09cyxsPU07aWYodC1sPDB8fHQrbD49anx8by1sPDB8fG8rbD49RSlyZXR1cm4gbnVsbDtjb25zdCBTPTIqbCsxO2xldCBEPWcucXVlcnkodC1sLG8tbCx0K2wsbytsKSxrPWQucXVlcnkodC1sLG8tbCx0K2wsbytsKSxBPTAsaT0oby1sKSpqKyh0LWwpLHA9KGEtbCkqaisobi1sKSxmPWotUztmb3IobGV0IG09MDttPFM7bSsrKXtmb3IobGV0IHg9MDt4PFM7eCsrKUErPXdbaV0qd1twXSxpKz0xLHArPTE7aSs9ZixwKz1mfWxldCBoPWcucXVlcnkobi1sLGEtbCxuK2wsYStsKTtoLz1TKlMsQS09aCpEO2xldCBjPWstRCpELyhTKlMpO3JldHVybiBjPT0wP251bGw6KGM9TWF0aC5zcXJ0KGMpLDEqQS8oZSpjKSl9LFc9KHIscyk9Pntjb25zdCB0PVtdO2ZvcihsZXQgbz0wO288ci5sZW5ndGg7bysrKXtjb25zdCBlPXJbb10sbj1VKGUpLGE9e2RhdGE6ZS5kYXRhLHNjYWxlOmUuc2NhbGUsd2lkdGg6ZS53aWR0aCxoZWlnaHQ6ZS5oZWlnaHQscG9pbnRzOm59O3QucHVzaChhKSxzKG8pfXJldHVybiB0fSxYPSh7aW1hZ2U6cixyYXRpbzpzfSk9Pntjb25zdCB0PU1hdGgucm91bmQoci53aWR0aCpzKSxvPU1hdGgucm91bmQoci5oZWlnaHQqcyksZT1uZXcgVWludDhBcnJheSh0Km8pO2ZvcihsZXQgbj0wO248dDtuKyspe2xldCBhPU1hdGgucm91bmQoMSpuL3MpLGc9TWF0aC5yb3VuZCgxKihuKzEpL3MpLTE7Zz49ci53aWR0aCYmKGc9ci53aWR0aC0xKTtmb3IobGV0IGQ9MDtkPG87ZCsrKXtsZXQgdz1NYXRoLnJvdW5kKDEqZC9zKSxqPU1hdGgucm91bmQoMSooZCsxKS9zKS0xO2o+PXIuaGVpZ2h0JiYoaj1yLmhlaWdodC0xKTtsZXQgRT0wLGw9MDtmb3IobGV0IFM9YTtTPD1nO1MrKylmb3IobGV0IEQ9dztEPD1qO0QrKylFKz0xKnIuZGF0YVtEKnIud2lkdGgrU10sbCs9MTtlW2QqdCtuXT1NYXRoLmZsb29yKEUvbCl9fXJldHVybntkYXRhOmUsd2lkdGg6dCxoZWlnaHQ6b319LFk9cj0+e2NvbnN0IHM9TWF0aC5taW4oci53aWR0aCxyLmhlaWdodCksdD1bXSxvPVtdO3QucHVzaCgyNTYvcyksdC5wdXNoKDEyOC9zKTtmb3IobGV0IGU9MDtlPHQubGVuZ3RoO2UrKylvLnB1c2goT2JqZWN0LmFzc2lnbihYKHtpbWFnZTpyLHJhdGlvOnRbZV19KSx7c2NhbGU6dFtlXX0pKTtyZXR1cm4gb307b25tZXNzYWdlPXI9Pntjb25zdHtkYXRhOnN9PXI7aWYocy50eXBlPT09ImNvbXBpbGUiKXtjb25zdHt0YXJnZXRJbWFnZXM6dH09cyxvPTEwMC90Lmxlbmd0aDtsZXQgZT0wO2NvbnN0IG49W107Zm9yKGxldCBhPTA7YTx0Lmxlbmd0aDthKyspe2NvbnN0IGc9dFthXSxkPVkoZyksdz1vL2QubGVuZ3RoLGo9VyhkLEU9PntlKz13LHBvc3RNZXNzYWdlKHt0eXBlOiJwcm9ncmVzcyIscGVyY2VudDplfSl9KTtuLnB1c2goail9cG9zdE1lc3NhZ2Uoe3R5cGU6ImNvbXBpbGVEb25lIixsaXN0Om59KX19fSkoKTsK",Cde=typeof window<"u"&&window.Blob&&new Blob([atob(Ide)],{type:"text/javascript;charset=utf-8"});function fde(e){let t;try{if(t=Cde&&(window.URL||window.webkitURL).createObjectURL(Cde),!t)throw"";const n=new Worker(t,{name:null==e?void 0:e.name});return n.addEventListener("error",(()=>{(window.URL||window.webkitURL).revokeObjectURL(t)})),n}catch{return new Worker("data:application/javascript;base64,"+Ide,{name:null==e?void 0:e.name})}finally{t&&(window.URL||window.webkitURL).revokeObjectURL(t)}}class bde extends pde{createProcessCanvas(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t}compileTrack(e){let{progressCallback:t,targetImages:n,basePercent:a}=e;return new Promise(((e,o)=>{const i=new fde;i.onmessage=n=>{"progress"===n.data.type?t(a+n.data.percent*a/100):"compileDone"===n.data.type&&e(n.data.list)},i.postMessage({type:"compile",targetImages:n})}))}}class yde{constructor(e,t){this.width=e,this.height=t,this.texShape=[t,e];const n=document.createElement("canvas").getContext("2d");n.canvas.width=e,n.canvas.height=t,this.context=n,this.program=this.buildProgram(e,t);const a=EJ();this.tempPixelHandle=a.makeTensorInfo(this.texShape,"float32"),a.texData.get(this.tempPixelHandle.dataId).usage=2}_loadInput(e){return VJ((()=>{let t=VP(e);return t=t.mean(2),t}))}loadInput(e){const t=this.context;if(t.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),e.width===this.height&&e.height===this.width){let n=this.context.canvas.width/2,a=this.context.canvas.height/2,o=90;t.save(),t.translate(n,a),t.rotate(o*Math.PI/180),t.drawImage(e,-e.width/2,-e.height/2),t.restore()}else this.context.drawImage(e,0,0,e.width,e.height);const n=EJ();return n.gpgpu.uploadPixelDataToTexture(n.getTexture(this.tempPixelHandle.dataId),this.context.canvas),this._compileAndRun(this.program,[this.tempPixelHandle])}buildProgram(e,t){const n=2===nM().getNumber("WEBGL_VERSION")?"texture":"texture2D";return{variableNames:["A"],outputShape:this.texShape,userCode:"\n\tvoid main() {\n\t  ivec2 coords = getOutputCoords();\n\t  int texR = coords[0];\n\t  int texC = coords[1];\n\t  vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(e,".0, ").concat(t,".0);\n\n\t  vec4 values = ").concat(n,"(A, uv);\n\t  setOutput((0.299 * values.r + 0.587 * values.g + 0.114 * values.b) * 255.0);\n\t}\n      ")}}_compileAndRun(e,t){const n=EJ().compileAndRun(e,t);return RJ().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}_runWebGLProgram(e,t,n){const a=EJ().runWebGLProgram(e,t,n);return RJ().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}}const Ade={memory:WJ,nextFrame:aO};class vde{constructor(e){let{inputWidth:t,inputHeight:n,onUpdate:a=null,debugMode:o=!1,maxTrack:i=1,warmupTolerance:r=null,missTolerance:s=null,filterMinCF:l=null,filterBeta:c=null}=e;this.inputWidth=t,this.inputHeight=n,this.maxTrack=i,this.filterMinCF=null===l?.001:l,this.filterBeta=null===c?1e3:c,this.warmupTolerance=null===r?5:r,this.missTolerance=null===s?5:s,this.cropDetector=new yue(this.inputWidth,this.inputHeight,o),this.inputLoader=new yde(this.inputWidth,this.inputHeight),this.markerDimensions=null,this.onUpdate=a,this.debugMode=o,this.processingVideo=!1,this.interestedTargetIndex=-1,this.trackingStates=[];const g=45*Math.PI/180,u=this.inputHeight/2/Math.tan(g/2);this.projectionTransform=[[u,0,this.inputWidth/2],[0,u,this.inputHeight/2],[0,0,1]],this.projectionMatrix=this._glProjectionMatrix({projectionTransform:this.projectionTransform,width:this.inputWidth,height:this.inputHeight,near:10,far:1e5}),this.worker=new zge,this.workerMatchDone=null,this.workerTrackDone=null,this.worker.onmessage=e=>{"matchDone"===e.data.type&&null!==this.workerMatchDone&&this.workerMatchDone(e.data),"trackUpdateDone"===e.data.type&&null!==this.workerTrackDone&&this.workerTrackDone(e.data)}}showTFStats(){console.log(Ade.memory().numTensors),console.table(Ade.memory())}addImageTargets(e){return new Promise((async(t,n)=>{const a=await(await fetch(e)).arrayBuffer();t(this.addImageTargetsFromBuffer(a))}))}addImageTargetsFromBuffer(e){const t=(new bde).importData(e),n=[],a=[],o=[];for(let i=0;i<t.length;i++)a.push(t[i].matchingData),n.push(t[i].trackingData),o.push([t[i].targetImage.width,t[i].targetImage.height]);return this.tracker=new Uge(o,n,this.projectionTransform,this.inputWidth,this.inputHeight,this.debugMode),this.worker.postMessage({type:"setup",inputWidth:this.inputWidth,inputHeight:this.inputHeight,projectionTransform:this.projectionTransform,debugMode:this.debugMode,matchingDataList:a}),this.markerDimensions=o,{dimensions:o,matchingDataList:a,trackingDataList:n}}dispose(){this.stopProcessVideo(),this.worker.postMessage({type:"dispose"})}dummyRun(e){const t=this.inputLoader.loadInput(e);this.cropDetector.detect(t),this.tracker.dummyRun(t),t.dispose()}getProjectionMatrix(){return this.projectionMatrix}getRotatedZ90Matrix(e){return[-e[1],e[0],e[2],e[3],-e[5],e[4],e[6],e[7],-e[9],e[8],e[10],e[11],-e[13],e[12],e[14],e[15]]}getWorldMatrix(e,t){return this._glModelViewMatrix(e,t)}async _detectAndMatch(e,t){const{featurePoints:n}=this.cropDetector.detectMoving(e),{targetIndex:a,modelViewTransform:o}=await this._workerMatch(n,t);return{targetIndex:a,modelViewTransform:o}}async _trackAndUpdate(e,t,n){const{worldCoords:a,screenCoords:o}=this.tracker.track(e,t,n);return a.length<4?null:await this._workerTrackUpdate(t,{worldCoords:a,screenCoords:o})}processVideo(e){if(!this.processingVideo){this.processingVideo=!0,this.trackingStates=[];for(let e=0;e<this.markerDimensions.length;e++)this.trackingStates.push({showing:!1,isTracking:!1,currentModelViewTransform:null,trackCount:0,trackMiss:0,filter:new iX({minCutOff:this.filterMinCF,beta:this.filterBeta})});(async()=>{for(;this.processingVideo;){const t=this.inputLoader.loadInput(e);if(this.trackingStates.reduce(((e,t)=>e+(t.isTracking?1:0)),0)<this.maxTrack){const e=[];for(let t=0;t<this.trackingStates.length;t++)!0!==this.trackingStates[t].isTracking&&(-1!==this.interestedTargetIndex&&this.interestedTargetIndex!==t||e.push(t));const{targetIndex:n,modelViewTransform:a}=await this._detectAndMatch(t,e);-1!==n&&(this.trackingStates[n].isTracking=!0,this.trackingStates[n].currentModelViewTransform=a)}for(let n=0;n<this.trackingStates.length;n++){const a=this.trackingStates[n];if(a.isTracking){let e=await this._trackAndUpdate(t,a.currentModelViewTransform,n);null===e?a.isTracking=!1:a.currentModelViewTransform=e}if(a.showing||a.isTracking&&(a.trackMiss=0,a.trackCount+=1,a.trackCount>this.warmupTolerance&&(a.showing=!0,a.trackingMatrix=null,a.filter.reset())),a.showing&&(a.isTracking?a.trackMiss=0:(a.trackCount=0,a.trackMiss+=1,a.trackMiss>this.missTolerance&&(a.showing=!1,a.trackingMatrix=null,this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:n,worldMatrix:null})))),a.showing){const t=this._glModelViewMatrix(a.currentModelViewTransform,n);a.trackingMatrix=a.filter.filter(Date.now(),t);let o=[];for(let e=0;e<a.trackingMatrix.length;e++)o[e]=a.trackingMatrix[e];e.width===this.inputHeight&&e.height===this.inputWidth&&(o=this.getRotatedZ90Matrix(o)),this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:n,worldMatrix:o})}}t.dispose(),this.onUpdate&&this.onUpdate({type:"processDone"}),await Ade.nextFrame()}})()}}stopProcessVideo(){this.processingVideo=!1}async detect(e){const t=this.inputLoader.loadInput(e),{featurePoints:n,debugExtra:a}=await this.cropDetector.detect(t);return t.dispose(),{featurePoints:n,debugExtra:a}}async match(e,t){const{modelViewTransform:n,debugExtra:a}=await this._workerMatch(e,[t]);return{modelViewTransform:n,debugExtra:a}}async track(e,t,n){const a=this.inputLoader.loadInput(e),o=this.tracker.track(a,t,n);return a.dispose(),o}async trackUpdate(e,t){return t.worldCoords.length<4?null:await this._workerTrackUpdate(e,t)}_workerMatch(e,t){return new Promise((async(n,a)=>{this.workerMatchDone=e=>{n({targetIndex:e.targetIndex,modelViewTransform:e.modelViewTransform,debugExtra:e.debugExtra})},this.worker.postMessage({type:"match",featurePoints:e,targetIndexes:t})}))}_workerTrackUpdate(e,t){return new Promise((async(n,a)=>{this.workerTrackDone=e=>{n(e.modelViewTransform)};const{worldCoords:o,screenCoords:i}=t;this.worker.postMessage({type:"trackUpdate",modelViewTransform:e,worldCoords:o,screenCoords:i})}))}_glModelViewMatrix(e,t){const n=this.markerDimensions[t][1];return[e[0][0],-e[1][0],-e[2][0],0,-e[0][1],e[1][1],e[2][1],0,-e[0][2],e[1][2],e[2][2],0,e[0][1]*n+e[0][3],-(e[1][1]*n+e[1][3]),-(e[2][1]*n+e[2][3]),1]}_glProjectionMatrix(e){let{projectionTransform:t,width:n,height:a,near:o,far:i}=e;const r=[[2*t[0][0]/n,0,-(2*t[0][2]/n-1),0],[0,2*t[1][1]/a,-(2*t[1][2]/a-1),0],[0,0,-(i+o)/(i-o),-2*i*o/(i-o)],[0,0,-1,0]],s=[];for(let l=0;l<4;l++)for(let e=0;e<4;e++)s.push(r[e][l]);return s}}const Sde=new _v,xde=new Ov,Gde=new _v;const Zde=new GS,wde=new GS;class kde{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this;let n,a,o,i;const r={camera:{fov:0,style:""},objects:new WeakMap},s=void 0!==e.element?e.element:document.createElement("div");s.style.overflow="hidden",this.domElement=s;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",s.appendChild(l);const c=document.createElement("div");function g(e){return Math.abs(e)<1e-10?0:e}function u(e){const t=e.elements;return"matrix3d("+g(t[0])+","+g(-t[1])+","+g(t[2])+","+g(t[3])+","+g(t[4])+","+g(-t[5])+","+g(t[6])+","+g(t[7])+","+g(t[8])+","+g(-t[9])+","+g(t[10])+","+g(t[11])+","+g(t[12])+","+g(-t[13])+","+g(t[14])+","+g(t[15])+")"}function d(e){const t=e.elements;return"translate(-50%,-50%)"+("matrix3d("+g(t[0])+","+g(t[1])+","+g(t[2])+","+g(t[3])+","+g(-t[4])+","+g(-t[5])+","+g(-t[6])+","+g(-t[7])+","+g(t[8])+","+g(t[9])+","+g(t[10])+","+g(t[11])+","+g(t[12])+","+g(t[13])+","+g(t[14])+","+g(t[15])+")")}function h(e,n,a,o){if(e.isCSS3DObject){const o=!0===e.visible&&!0===e.layers.test(a.layers);if(e.element.style.display=!0===o?"":"none",!0===o){let o;e.onBeforeRender(t,n,a),e.isCSS3DSprite?(Zde.copy(a.matrixWorldInverse),Zde.transpose(),0!==e.rotation2D&&Zde.multiply(wde.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(Sde,xde,Gde),Zde.setPosition(Sde),Zde.scale(Gde),Zde.elements[3]=0,Zde.elements[7]=0,Zde.elements[11]=0,Zde.elements[15]=1,o=d(Zde)):o=d(e.matrixWorld);const i=e.element,s=r.objects.get(e);if(void 0===s||s.style!==o){i.style.transform=o;const t={style:o};r.objects.set(e,t)}i.parentNode!==c&&c.appendChild(i),e.onAfterRender(t,n,a)}}for(let t=0,i=e.children.length;t<i;t++)h(e.children[t],n,a,o)}c.style.transformStyle="preserve-3d",l.appendChild(c),this.getSize=function(){return{width:n,height:a}},this.render=function(e,t){const s=t.projectionMatrix.elements[5]*i;let d,p;r.camera.fov!==s&&(l.style.perspective=t.isPerspectiveCamera?s+"px":"",r.camera.fov=s),t.view&&t.view.enabled?(l.style.transform="translate( ".concat(-t.view.offsetX*(n/t.view.width),"px, ").concat(-t.view.offsetY*(a/t.view.height),"px )"),l.style.transform+="scale( ".concat(t.view.fullWidth/t.view.width,", ").concat(t.view.fullHeight/t.view.height," )")):l.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),t.isOrthographicCamera&&(d=-(t.right+t.left)/2,p=(t.top+t.bottom)/2);const m=t.view&&t.view.enabled?t.view.height/t.view.fullHeight:1,I=t.isOrthographicCamera?"scale( ".concat(m," )")+"scale("+s+")translate("+g(d)+"px,"+g(p)+"px)"+u(t.matrixWorldInverse):"scale( ".concat(m," )")+"translateZ("+s+"px)"+u(t.matrixWorldInverse),C=I+"translate("+o+"px,"+i+"px)";r.camera.style!==C&&(c.style.transform=C,r.camera.style=C),h(e,e,t,I)},this.setSize=function(e,t){n=e,a=t,o=n/2,i=a/2,s.style.width=e+"px",s.style.height=t+"px",l.style.width=e+"px",l.style.height=t+"px",c.style.width=e+"px",c.style.height=t+"px"}}}const Bde=xJ({addN_:function(e){IX(Array.isArray(e),(()=>"The argument passed to tf.addN() must be a list of tensors")),IX(e.length>=1,(()=>"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)));const t=e.map(((e,t)=>AJ(e,"tensors".concat(t),"addN"))),n=t[0];t.forEach((e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((e=>{if(!AX(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const a=t;return uJ.runKernel(uM,a)}});const Rde=xJ({basicLSTMCell_:function(e,t,n,a,o,i){const r=AJ(e,"forgetBias","basicLSTMCell"),s=AJ(t,"lstmKernel","basicLSTMCell"),l=AJ(n,"lstmBias","basicLSTMCell"),c=AJ(a,"data","basicLSTMCell"),g=AJ(o,"c","basicLSTMCell"),u=AJ(i,"h","basicLSTMCell"),d=CL([c,u],1),h=fL(d,s),p=EY(h,l),m=p.shape[0],I=p.shape[1]/4,C=[m,I],f=yL(p,[0,0],C),b=yL(p,[0,I],C),y=yL(p,[0,2*I],C),A=yL(p,[0,3*I],C),v=EY(JY(bL(f),AL(b)),JY(g,bL(EY(r,y))));return[v,JY(AL(v),bL(A))]}});const Wde=xJ({bitwiseAnd_:function(e,t){const n=AJ(e,"x","bitwiseAnd"),a=AJ(t,"y","bitwiseAnd");if(!AX(n.shape,a.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(n.shape,", y: ").concat(a.shape));if("int32"!==n.dtype||"int32"!==a.dtype)throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(n.dtype," and type of y: ").concat(a.dtype));const o={a:n,b:a};return uJ.runKernel(kM,o)}});const Vde=xJ({broadcastArgs_:function(e,t){const n=AJ(e,"s0","broadcastArgs","int32"),a=AJ(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). Has rank ".concat(n.rank));if(1!==a.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). Has rank ".concat(a.rank));const o={s0:n,s1:a};return uJ.runKernel(RM,o)}});const Nde=xJ({diag_:function(e){const t={x:AJ(e,"x","diag")};return uJ.runKernel($M,t)}});const Xde=xJ({ensureShape_:function(e,t){const n=AJ(e,"x","ensureShape","string_or_numeric");if(!yX(n.shape,t))throw new Error("EnsureShape: Shape of tensor ".concat(n.shape," is not compatible with expected shape ").concat(t));return e}});function Mde(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const a={start:e,stop:t,num:n};return uJ.runKernel(VT,{},a)}const Tde=2147483648;const Ede=xJ({searchSorted_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left";const a=AJ(e,"sortedSequence","searchSorted"),o=AJ(t,"values","searchSorted"),i=a.shape[a.shape.length-1],r=o.shape[o.shape.length-1],s=pL(a,[-1,i]),l=pL(o,[-1,r]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(bX(l.shape)>=Tde)throw new Error("values tensor size must less than ".concat(Tde));if(s.shape[1]>=Tde)throw new Error("trailing dim_size must less than ".concat(Tde," for int32 output type, was ").concat(s.shape[1]));const c={sortedSequence:s,values:l},g={side:n};return uJ.runKernel(WE,c,g)}});function Fde(e,t){return Ede(e,t,"left")}const Hde=xJ({maxPoolWithArgmax_:function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i={x:AJ(e,"x","maxPoolWithArgmax")},r={filterSize:t,strides:n,pad:a,includeBatchInIndex:o},s=uJ.runKernel(PT,i,r);return{result:s[0],indexes:s[1]}}});function Jde(e,t){let{indexing:n="xy"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("xy"!==n&&"ij"!==n)throw new TypeError("".concat(n," is not a valid third argument to meshgrid"));if(void 0===e)return[];let a=AJ(e,"x","meshgrid",e instanceof YH?e.dtype:"float32");if(void 0===t)return[a];let o=AJ(t,"y","meshgrid",t instanceof YH?t.dtype:"float32");const i=bX(a.shape),r=bX(o.shape);return"xy"===n?(a=pL(a,[1,-1]),o=pL(o,[-1,1]),[fL(uK([r,1],a.dtype),a),fL(o,uK([1,i],o.dtype))]):(a=pL(a,[-1,1]),o=pL(o,[1,-1]),[fL(a,uK([1,r],a.dtype)),fL(uK([i,1],o.dtype),o)])}const Yde=xJ({multiRNNCell_:function(e,t,n,a){const o=AJ(t,"data","multiRNNCell"),i=vJ(n,"c","multiRNNCell"),r=vJ(a,"h","multiRNNCell");let s=o;const l=[];for(let u=0;u<e.length;u++){const t=e[u](s,i[u],r[u]);l.push(t[0]),l.push(t[1]),s=t[1]}const c=[],g=[];for(let u=0;u<l.length;u+=2)c.push(l[u]),g.push(l[u+1]);return[c,g]}});const Lde=xJ({multinomial_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=AJ(e,"logits","multinomial"),i=o.size,r=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(r>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(r));n=n||Math.random();const s={logits:1===r?pL(o,[1,-1]):o},l={numSamples:t,seed:n,normalized:a},c=uJ.runKernel($T,s,l);return 1===r?pL(c,[c.size]):c}});const zde=xJ({outerProduct_:function(e,t){const n=AJ(e,"v1","outerProduct"),a=AJ(t,"v2","outerProduct");IX(1===n.rank&&1===a.rank,(()=>"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(a.rank,".")));const o=pL(n,[-1,1]),i=pL(a,[1,-1]);return fL(o,i)}});const Kde=xJ({pad1d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return IX(2===t.length,(()=>"Invalid number of paddings. Must be length of 2.")),bK(e,[t],n)}});const Dde=xJ({pad2d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return IX(2===t.length&&2===t[0].length&&2===t[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),bK(e,t,n)}});const Ude=xJ({pad3d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return IX(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),bK(e,t,n)}});const Pde=xJ({pad4d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return IX(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),bK(e,t,n)}});const Ode=xJ({raggedGather_:function(e,t,n,a){const o=e.map(((e,t)=>AJ(e,"tensors".concat(t),"raggedGather","int32"))),i={paramsNestedSplits:o,paramsDenseValues:AJ(t,"paramsDenseValues","raggedGather"),indices:AJ(n,"indices","raggedGather","int32")},r={outputRaggedRank:a},s=uJ.runKernel(hE,i,r);return{outputNestedSplits:s.slice(0,s.length-1),outputDenseValues:s[s.length-1]}}});const _de=xJ({raggedRange_:function(e,t,n){const a=AJ(e,"starts","raggedRange"),o={starts:a,limits:AJ(t,"limits","raggedRange",a.dtype),deltas:AJ(n,"deltas","raggedRange",a.dtype)},i=uJ.runKernel(pE,o);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}});const Qde=xJ({raggedTensorToTensor_:function(e,t,n,a,o){const i=AJ(e,"shape","raggedTensorToTensor","int32"),r=AJ(t,"values","raggedTensorToTensor"),s=AJ(n,"defaultValue","raggedTensorToTensor",r.dtype),l=a.map(((e,t)=>AJ(e,"tensors".concat(t),"raggedTensorToTensor","int32"))),c={shape:i,values:r,defaultValue:s,rowPartitionTensors:l},g={rowPartitionTypes:o};return uJ.runKernel(mE,c,g)}});const jde=xJ({rand_:function(e,t,n){_X(e);const a=bX(e);let o=null;if(null==n||"float32"===n)o=new Float32Array(a);else if("int32"===n)o=new Int32Array(a);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));o=new Uint8Array(a)}for(let i=0;i<a;i++)o[i]=t();return uJ.makeTensor(o,e,n)}}),qde=.001,$de=.1;function ehe(){return 32===uJ.backend.floatPrecision()?qde:$de}function the(e,t,n){let a=!0;if((xH(e)||xH(t))&&(a=!1),xH(e)&&xH(t)&&(a=!0),a){const n=e.constructor.name,a=t.constructor.name;if(n!==a)throw new Error("Arrays are of different type. Actual: ".concat(n,". Expected: ").concat(a))}if(Array.isArray(e)&&Array.isArray(t)){const n=fJ(e),a=fJ(t);if(!AX(n,a))throw new Error("Arrays have different shapes. Actual: [".concat(n,"]. Expected: [").concat(a,"]"))}const o=xH(e)?e:GH(e),i=xH(t)?t:GH(t);if(o.length!==i.length)throw new Error("Arrays have different lengths actual: ".concat(o.length," vs expected: ").concat(i.length,".\nActual:   ").concat(o,".\nExpected: ").concat(i,"."));for(let r=0;r<i.length;++r){const e=o[r],t=i[r];if(!n(e,t))throw new Error("Arrays differ: actual[".concat(r,"] = ").concat(e,", expected[").concat(r,"] = ").concat(t,".\nActual:   ").concat(o,".\nExpected: ").concat(i,"."))}typeof expect<"u"&&expect().nothing()}function nhe(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}const ahe=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:$de,createVideoElement:function(e){const t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise((e=>{t.addEventListener("loadeddata",(n=>e(t))),t.load()}))},encodeStrings:function e(t){for(let n=0;n<t.length;n++){const a=t[n];Array.isArray(a)?e(a):t[n]=vH(a)}return t},expectArrayBuffersEqual:function(e,t){const n=new Float32Array(e),a=new Float32Array(t);if(n.length!==a.length)throw new Error("Expected ArrayBuffer to be of length ".concat(a.length,", but it was ").concat(n.length));for(let o=0;o<a.length;o++)if(n[o]!==a[o])throw new Error("Expected ArrayBuffer value at ".concat(o," to be ").concat(a[o]," but got ").concat(n[o]," instead"))},expectArraysClose:function(e,t,n){return null==n&&(n=ehe()),the(e,t,((e,t)=>nhe(e,t,n)))},expectArraysEqual:function(e,t){const n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return TX(e)||TX(e[0])||TX(t)||TX(t[0])?the(e,n,((e,t)=>e==t)):the(e,t,((e,t)=>nhe(e,t,0)))},expectNumbersClose:function(e,t,n){if(null==n&&(n=ehe()),!nhe(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t));typeof expect<"u"&&expect().nothing()},expectPromiseToFail:function(e,t){e().then((()=>t.fail()),(()=>t())),typeof expect<"u"&&expect().nothing()},expectValuesInRange:function(e,t,n){for(let a=0;a<e.length;a++)if(e[a]<t||e[a]>n)throw new Error("Value out of range:".concat(e[a]," low: ").concat(t,", high: ").concat(n))},play:async function(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise((t=>{e.requestVideoFrameCallback(t)}))},testEpsilon:ehe},Symbol.toStringTag,{value:"Module"}));const ohe=xJ({randomGamma_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",o=arguments.length>4?arguments[4]:void 0;if(_X(e),null==n&&(n=1),null==a&&(a="float32"),"float32"!==a&&"int32"!==a)throw new Error("Unsupported data type ".concat(a));const i=new PK(t,n,a,o),r=NY(e,a);for(let s=0;s<r.values.length;s++)r.values[s]=i.nextValue();return r.toTensor()}});const ihe=xJ({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return _K(e,0,1,t,n)}});const rhe=xJ({randomUniformInt_:function(e,t,n,a){return QK(e,t,n,"int32",a)}});const she=xJ({reverse1d_:function(e){const t=AJ(e,"x","reverse");return IX(1===t.rank,(()=>"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,"."))),nD(t,0)}});const lhe=xJ({reverse2d_:function(e,t){const n=AJ(e,"x","reverse");return IX(2===n.rank,(()=>"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,"."))),nD(n,t)}});const che=xJ({reverse3d_:function(e,t){const n=AJ(e,"x","reverse");return IX(3===n.rank,(()=>"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,"."))),nD(n,t)}});const ghe=xJ({reverse4d_:function(e,t){const n=AJ(e,"x","reverse");return IX(4===n.rank,(()=>"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,"."))),nD(n,t)}});const uhe=async function(e,t){const n=AJ(e,"x","setdiff1d"),a=AJ(t,"y","setdiff1d");IX(n.dtype===a.dtype,(()=>"x and y should have the same dtype, but got x (".concat(n.dtype,") and y (").concat(a.dtype,")."))),IX(1===n.rank,(()=>"x should be 1D tensor, but got x (".concat(n.shape,")."))),IX(1===a.rank,(()=>"y should be 1D tensor, but got y (".concat(a.shape,").")));const o=await n.data(),i=await a.data(),r=new Set(i);let s=0;for(let g=0;g<o.length;g++)r.has(o[g])||s++;const l=new FH([s],n.dtype),c=new FH([s],"int32");for(let g=0,u=0;g<o.length;g++)r.has(o[g])||(l.values[u]=o[g],c.values[u]=g,u++);return[l.toTensor(),c.toTensor()]};function dhe(e,t,n){if(fX(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");const a=fJ(e,n);if(4!==a.length&&1!==a.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===a.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ZJ(e,t,a,n)}function hhe(e,t,n){if(fX(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");const a=fJ(e,n);if(5!==a.length&&1!==a.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===a.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ZJ(e,t,a,n)}function phe(e,t,n){if(fX(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");const a=fJ(e,n);if(6!==a.length&&1!==a.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===a.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ZJ(e,t=t||a,a,n)}const mhe=xJ({tensorScatterUpdate_:function(e,t,n){const a=AJ(e,"tensor","tensorScatterupdate"),o=AJ(t,"indices","tensorScatterupdate","int32"),i=AJ(n,"updates","tensorScatterupdate");if(RD(i,o,a.shape),a.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(a.dtype," and ").concat(i.dtype,"."));const r={tensor:a,indices:o,updates:i};return uJ.runKernel(RE,r,{})}});function Ihe(e,t){return Ede(e,t,"right")}const Che=async function(e){const t=AJ(e,"condition","whereAsync","bool"),n=await t.data(),a=HD(t.shape,n);return e!==t&&t.dispose(),a};const fhe=async function(e,t,n){const a=AJ(e,"tensor","boolMask"),o=AJ(t,"mask","boolMask","bool"),i=null!==n&&void 0!==n?n:0,r=o.rank,s=a.shape;IX(r>0,(()=>"mask cannot be scalar")),CX(s.slice(i,i+r),o.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=i;m<i+r;m++)l*=s[m];const c=s.slice(0,i).concat([l],s.slice(i+r)),g=pL(a,c),u=pL(o,[-1]),d=await Che(u),h=AD(d,[1]),p=Xz(g,h,i);return e!==a&&a.dispose(),t!==o&&o.dispose(),h.dispose(),g.dispose(),u.dispose(),d.dispose(),p};const bhe=xJ({movingAverage_:function(e,t,n,a){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const i=AJ(e,"v","movingAverage"),r=AJ(t,"x","movingAverage"),s=AJ(n,"decay","movingAverage");nJ(i,r),IX(AX(i.shape,r.shape),(()=>"Shape mismatch in v and x"));const l=Az(1),c=$z(l,s);let g=JY($z(r,i),c);if(o){IX(null!=a,(()=>"When using zeroDebias: true, step is required."));const e=AJ(a,"step","movingAverage");g=HY(g,$z(l,yz(s,e)))}return EY(i,g)}});const yhe=xJ({scatterND_:function(e,t,n){_X(n);const a=AJ(e,"indices","scatterND","int32"),o=AJ(t,"updates","scatterND");RD(o,a,n);const i={indices:a,updates:o},r={shape:n};return uJ.runKernel(BE,i,r)}});const Ahe=xJ({sparseToDense_:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_X(n);const o=AJ(e,"sparseIndices","sparseToDense","int32"),i=AJ(t,"sparseValues","sparseToDense","string_or_numeric"),r=AJ(a,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,a){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));const o=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));const r=t.size;if(0!==t.rank&&(1!==t.rank||r!==o))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(o,"]"));if(t.dtype!==a.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,r);const s={sparseIndices:o,sparseValues:i,defaultValue:r},l={outputShape:n};return uJ.runKernel(_E,s,l)}});const vhe=xJ({gatherND_:function(e,t){const n=AJ(t,"indices","gatherND","int32"),a={params:AJ(e,"x","gatherND","string_or_numeric"),indices:n};return uJ.runKernel(yT,a)}});const She=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const a=AJ(e,"predictions","inTopK"),o=AJ(t,"targets","inTopK");IX(a.rank>1,(()=>"inTopK() expects the predictions to be of rank 2 or higher, but got ".concat(a.rank))),IX(a.rank-1===o.rank,(()=>"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(o.rank))),CX(a.shape.slice(0,a.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=a.shape[a.shape.length-1];IX(n>0&&n<=i,(()=>"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(i,"), but got ").concat(n)));const r=await a.data(),s=await o.data(),[l,c]=[r.length/i,i],g=BX("bool",l);for(let u=0;u<l;u++){const e=u*c,t=r.subarray(e,e+c),a=[];for(let n=0;n<t.length;n++)a.push({value:t[n],index:n});a.sort(((e,t)=>t.value-e.value)),g[u]=0;for(let o=0;o<n;o++)if(a[o].index===s[u]){g[u]=1;break}}return e!==a&&a.dispose(),t!==o&&o.dispose(),wJ(g,o.shape,"bool")};const xhe=xJ({fusedDepthwiseConv2d_:function(e){let{x:t,filter:n,strides:a,pad:o,dataFormat:i="NHWC",dilations:r=[1,1],dimRoundingMode:s,bias:l,activation:c="linear",preluActivationWeights:g,leakyreluAlpha:u}=e;if(!1===OD(uJ.state.gradientDepth,c)){let e=QL(t,n,a,o,i,r,s);return null!=l&&(e=EY(e,l)),PD(e,c,g,u)}const d=AJ(t,"x","depthwiseConv2d","float32"),h=AJ(n,"filter","depthwiseConv2d","float32");let p=d,m=!1;3===d.rank&&(m=!0,p=pL(d,[1,d.shape[0],d.shape[1],d.shape[2]])),IX(4===p.rank,(()=>"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(p.rank,"."))),IX(4===h.rank,(()=>"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(h.rank,"."))),IX(p.shape[3]===h.shape[2],(()=>"Error in fused depthwiseConv2d: number of input channels (".concat(p.shape[3],") must match the inChannels dimension in filter ").concat(h.shape[2],"."))),null==r&&(r=[1,1]),IX(gL(a,r),(()=>"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(r,"'"))),hL("fused depthwiseConv2d",o,s);const I=nL(p.shape,h.shape,a,r,o,s,!0);let C,f;null!=l&&(C=AJ(l,"bias","fused conv2d"),[C]=tJ(C,d),ez(I.outShape,C.shape)),null!=g&&(f=AJ(g,"prelu weights","fused depthwiseConv2d"));const b=(e,t)=>{IX(cL(r),(()=>"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(r,"'")));const[n,i,l,g]=t,u=DD(e,l,c),d=jD(i.shape,u,n,a,o,r,s),h=QD(i,u,n.shape,a,o,r,s);if(null!=g){return[d,h,UD(C,u)]}return[d,h]},y={x:p,filter:h,bias:C,preluActivationWeights:f},A={strides:a,pad:o,dataFormat:i,dilations:r,dimRoundingMode:s,activation:c,leakyreluAlpha:u};return null==l?Oz(((e,t,n)=>{let a=uJ.runKernel(bF,y,A);return n([t,e,a]),m&&(a=pL(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:b}}))(p,h):Oz(((e,t,n,a)=>{let o=uJ.runKernel(bF,y,A);return a([t,e,o,n]),m&&(o=pL(o,[o.shape[1],o.shape[2],o.shape[3]])),{value:o,gradFunc:b}}))(p,h,C)}}),Ghe=Object.freeze(Object.defineProperty({__proto__:null,conv2d:_D,depthwiseConv2d:xhe,matMul:qD},Symbol.toStringTag,{value:"Module"}));function Zhe(e){return new Promise((e=>setTimeout(e))).then(e)}class whe{constructor(e){if(!nM().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(whe.URL_SCHEME)&&(e=e.slice(whe.URL_SCHEME.length)),(null==e||0===e.length)&&(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=BJ.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const t=jJ(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),a=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=a,await Zhe((()=>o.dispatchEvent(new MouseEvent("click")))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await Zhe((()=>e.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:eY(e)}}}}whe.URL_SCHEME="downloads://";class khe{constructor(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise(((e,t)=>{const n=new FileReader;n.onload=n=>{const a=JSON.parse(n.target.result),o=a.modelTopology;if(null==o)return void t(new Error("modelTopology field is missing from file ".concat(this.jsonFile.name)));if(null==a.weightsManifest)return void t(new Error("weightManifest field is missing from file ".concat(this.jsonFile.name)));if(0===this.weightsFiles.length)return void e({modelTopology:o});const i=$J(a,(e=>this.loadWeights(e)));e(i)},n.onerror=e=>t("Failed to read model topology and weights manifest JSON from file '".concat(this.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")),n.readAsText(this.jsonFile)}))}loadWeights(e){const t=[],n=[];for(const i of e)t.push(...i.weights),n.push(...i.paths);const a=this.checkManifestAndWeightFiles(e),o=n.map((e=>this.loadWeightsFile(e,a[e])));return Promise.all(o).then((e=>[t,e]))}loadWeightsFile(e,t){return new Promise(((n,a)=>{const o=new FileReader;o.onload=e=>{const t=e.target.result;n(t)},o.onerror=t=>a("Failed to weights data from file of path '".concat(e,"'.")),o.readAsArrayBuffer(t)}))}checkManifestAndWeightFiles(e){const t=[],n=this.weightsFiles.map((e=>QJ(e.name))),a={};for(const o of e)o.paths.forEach((e=>{const o=QJ(e);if(-1!==t.indexOf(o))throw new Error("Duplicate file basename found in weights manifest: '".concat(o,"'"));if(t.push(o),-1===n.indexOf(o))throw new Error("Weight file with basename '".concat(o,"' is not provided."));a[e]=this.weightsFiles[n.indexOf(o)]}));if(t.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(t.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return a}}nY.registerSaveRouter((e=>nM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(whe.URL_SCHEME)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new whe(e)}(e.slice(whe.URL_SCHEME.length)):null));class Bhe{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class Rhe{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class Whe{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function Vhe(e,t,n,a){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Bhe(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bhe({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bhe({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:a}))}const Nhe=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:BJ,browserFiles:function(e){return new khe(e)},browserHTTPRequest:ZP,concatenateArrayBuffers:_J,copyModel:async function(e,t){return BY(e,t,!1)},decodeWeights:JJ,decodeWeightsStream:DJ,encodeWeights:HJ,fromMemory:function(e,t,n,a){return new Whe(Vhe(...arguments))},fromMemorySync:Vhe,getLoadHandlers:oY,getModelArtifactsForJSON:$J,getModelArtifactsForJSONSync:qJ,getModelArtifactsInfoForJSON:eY,getSaveHandlers:aY,getWeightSpecs:tY,http:GP,isHTTPScheme:SP,listModels:async function(){const e=wY.getSchemes(),t={};for(const n of e){const e=await wY.getManager(n).listModels();for(const a in e){t[n+ZY+a]=e[a]}}return t},loadWeights:yP,moveModel:async function(e,t){return BY(e,t,!0)},registerLoadRouter:e=>nY.registerLoadRouter(e),registerSaveRouter:e=>nY.registerSaveRouter(e),removeModel:async function(e){const t=kY(e);return wY.getManager(t.scheme).removeModel(t.path)},weightsLoaderFactory:AP,withSaveHandler:function(e){return new Rhe(e)},withSaveHandlerSync:function(e){return new Rhe(e)}},Symbol.toStringTag,{value:"Module"}));const Xhe=xJ({confusionMatrix_:function(e,t,n){const a=AJ(e,"labels","confusionMatrix"),o=AJ(t,"predictions","confusionMatrix");IX(null==n||n>0&&Number.isInteger(n),(()=>"If provided, numClasses must be a positive integer, but got ".concat(n))),IX(1===a.rank,(()=>"Expected the rank of labels to be 1, but got ".concat(a.rank))),IX(1===o.rank,(()=>"Expected the rank of predictions to be 1, but got ".concat(o.rank))),IX(a.shape[0]===o.shape[0],(()=>"Mismatch in the number of examples: ".concat(a.shape[0]," vs. ").concat(o.shape[0],". Labels and predictions should have the same number of elements."))),IX(n>0&&Number.isInteger(n),(()=>"numClasses is required to be a positive integer, but got ".concat(n)));const i=CK(XY(a,"int32"),n),r=CK(XY(o,"int32"),n),s=JD(i),l=fL(s,r);return XY(l,"int32")}}),Mhe=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:Xhe},Symbol.toStringTag,{value:"Module"})),The="4.16.0",Ehe=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:dU,nonMaxSuppressionV4Impl:hU,nonMaxSuppressionV5Impl:pU,whereImpl:HD},Symbol.toStringTag,{value:"Module"}));const Fhe=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:function(e){return new S$(e)},minMaxNorm:function(e){return new Z$(e)},nonNeg:function(){return new G$},unitNorm:function(e){return new x$(e)}},Symbol.toStringTag,{value:"Module"}));const Hhe=Object.freeze(Object.defineProperty({__proto__:null,constant:function(e){return new Nq(e)},glorotNormal:function(e){return new Jq(e)},glorotUniform:function(e){return new Hq(e)},heNormal:function(e){return new Yq(e)},heUniform:function(e){return new Lq(e)},identity:function(e){return new Eq(e)},leCunNormal:function(e){return new zq(e)},leCunUniform:function(e){return new Kq(e)},ones:function(){return new Vq},orthogonal:function(e){return new Dq(e)},randomNormal:function(e){return new Mq(e)},randomUniform:function(e){return new Xq(e)},truncatedNormal:function(e){return new Tq(e)},varianceScaling:function(e){return new Fq(e)},zeros:function(){return new Wq}},Symbol.toStringTag,{value:"Module"}));function Jhe(e){return h$(e)}function Yhe(e){return new R2(e)}function Lhe(e){return new N2(e)}function zhe(e){return new T2(e)}function Khe(e){return new H2(e)}function Dhe(e){return new L2(e)}function Uhe(e){return new B2(e)}function Phe(e){return new V2(e)}const Ohe=Khe,_he=Dhe,Qhe=Uhe,jhe=Phe;const qhe=Object.freeze(Object.defineProperty({__proto__:null,Layer:g$,RNN:J1,RNNCell:Y1,activation:function(e){return new a2(e)},add:function(e){return new g2(e)},alphaDropout:function(e){return new y2(e)},average:function(e){return new d2(e)},averagePooling1d:Yhe,averagePooling2d:Lhe,averagePooling3d:zhe,avgPool1d:function(e){return Yhe(e)},avgPool2d:function(e){return Lhe(e)},avgPool3d:function(e){return zhe(e)},avgPooling1d:function(e){return Yhe(e)},avgPooling2d:function(e){return Lhe(e)},avgPooling3d:function(e){return zhe(e)},batchNormalization:function(e){return new S2(e)},bidirectional:function(e){return new D2(e)},categoryEncoding:function(e){return new Q2(e)},centerCrop:function(e){return new _2(e)},concatenate:function(e){return new m2(e)},conv1d:function(e){return new X1(e)},conv2d:function(e){return new k1(e)},conv2dTranspose:function(e){return new R1(e)},conv3d:function(e){return new B1(e)},conv3dTranspose:function(e){return new W1(e)},convLstm2d:function(e){return new q1(e)},convLstm2dCell:function(e){return new j1(e)},cropping2D:function(e){return new M1(e)},dense:function(e){return new t2(e)},depthwiseConv2d:function(e){return new E1(e)},dot:function(e){return new C2(e)},dropout:function(e){return new $1(e)},elu:function(e){return new C1(e)},embedding:function(e){return new l2(e)},flatten:function(e){return new n2(e)},gaussianDropout:function(e){return new b2(e)},gaussianNoise:function(e){return new f2(e)},globalAveragePooling1d:function(e){return new F2(e)},globalAveragePooling2d:function(e){return new Y2(e)},globalMaxPool1d:Ohe,globalMaxPool2d:_he,globalMaxPooling1d:Khe,globalMaxPooling2d:Dhe,gru:function(e){return new D1(e)},gruCell:function(e){return new K1(e)},input:Jhe,inputLayer:function(e){return new d$(e)},layerNormalization:function(e){return new x2(e)},leakyReLU:function(e){return new m1(e)},lstm:function(e){return new P1(e)},lstmCell:function(e){return new U1(e)},masking:function(e){return new s2(e)},maxPool1d:Qhe,maxPool2d:jhe,maxPooling1d:Uhe,maxPooling2d:Phe,maxPooling3d:function(e){return new M2(e)},maximum:function(e){return new h2(e)},minimum:function(e){return new p2(e)},multiply:function(e){return new u2(e)},permute:function(e){return new r2(e)},prelu:function(e){return new I1(e)},randomWidth:function(e){return new n3(e)},reLU:function(e){return new p1(e)},repeatVector:function(e){return new o2(e)},rescaling:function(e){return new U2(e)},reshape:function(e){return new i2(e)},resizing:function(e){return new q2(e)},rnn:function(e){return new J1(e)},separableConv2d:function(e){return new N1(e)},simpleRNN:function(e){return new z1(e)},simpleRNNCell:function(e){return new L1(e)},softmax:function(e){return new b1(e)},spatialDropout1d:function(e){return new e2(e)},stackedRNNCells:function(e){return new O1(e)},thresholdedReLU:function(e){return new f1(e)},timeDistributed:function(e){return new K2(e)},upSampling2d:function(e){return new T1(e)},zeroPadding2d:function(e){return new G2(e)}},Symbol.toStringTag,{value:"Module"}));const $he=Object.freeze(Object.defineProperty({__proto__:null,MAPE:function(e,t){return U$(e,t)},MSE:function(e,t){return K$(e,t)},binaryAccuracy:function(e,t){return $$(e,t)},binaryCrossentropy:function(e,t){return o0(e,t)},categoricalAccuracy:function(e,t){return e0(e,t)},categoricalCrossentropy:function(e,t){return r0(e,t)},cosineProximity:function(e,t){return Q$(e,t)},mape:function(e,t){return U$(e,t)},meanAbsoluteError:function(e,t){return D$(e,t)},meanAbsolutePercentageError:function(e,t){return U$(e,t)},meanSquaredError:function(e,t){return K$(e,t)},mse:function(e,t){return K$(e,t)},precision:function(e,t){return n0(e,t)},recall:function(e,t){return a0(e,t)},sparseCategoricalAccuracy:function(e,t){return i0(e,t)}},Symbol.toStringTag,{value:"Module"})),epe=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:async function(e,t){"modelTopology"in e||(e={modelTopology:e});let n=e.modelTopology;null!=n.model_config&&(n=n.model_config);const a=L$(b0(n),t);if(null!=e.weightsManifest){const t=await yP(e.weightsManifest,e.pathPrefix,a.weights.map((e=>e.originalName))),n={};for(const e of a.weights)n[e.originalName]=t[e.originalName];a.loadWeights(n),NJ(t)}return a}},Symbol.toStringTag,{value:"Module"}));const tpe=Object.freeze(Object.defineProperty({__proto__:null,l1:function(e){return function(e){return s1(e),new c1({l1:null!=e?e.l1:null,l2:0})}(e)},l1l2:function(e){return new c1(e)},l2:function(e){return function(e){return s1(e),new c1({l2:null!=e?e.l2:null,l1:0})}(e)}},Symbol.toStringTag,{value:"Module"}));class npe extends X${constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof J0))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function ape(e,t){return e<t}function ope(e,t){return e>t}class ipe extends npe{constructor(e){if(super(),null==e&&(e={}),e.restoreBestWeights)throw new Cj("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,-1===["auto","min","max"].indexOf(this.mode)&&(console.warn("EarlyStopping mode '".concat(this.mode,"' is invalid. Falling back to mode 'auto'.")),this.mode="auto"),"min"===this.mode?this.monitorFunc=ape:"max"===this.mode||-1!==this.monitor.indexOf("acc")?this.monitorFunc=ope:this.monitorFunc=ape,this.monitorFunc===ape&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===ape?1/0:-1/0}async onEpochEnd(e,t){await W$(t);const n=this.getMonitorValue(t);null!=n&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."))}getMonitorValue(e){null==e&&(e={});const t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ").concat(Object.keys(e))),t}}const rpe={earlyStopping:function(e){return new ipe(e)}},spe={};function lpe(e){return spe[e]}function cpe(e,t,n,a,o){const i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){const e=i.inputIndexStart,r=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?e+1:i.inputIndexEnd,s=e<0?t.inputNames.length+e:e;if("tensor"===i.type)return gpe(t.inputNames[s],n,a,o);if("tensors"===i.type){const i=t.inputs.slice(e,r);return t.inputNames.slice(e,r).filter(((e,t)=>{var n;return"NoOp"!==(null===(n=i[t])||void 0===n?void 0:n.op)})).map((e=>gpe(e,n,a,o)))}const l=gpe(t.inputNames[s],n,a,o),c=l.dataSync();return"number"===i.type?c[0]:KX(l.shape,c)}const r=t.attrParams[e];return r&&r.value}function gpe(e,t,n,a){const[o,i]=ppe(e,n);if(null!=a){const e=a.getHashTableHandleByName(o);if(null!=e)return e}const r=n.currentContextIds.find((e=>!!t[hpe(o,e)]));return void 0!==r?t[hpe(o,r)][i]:void 0}function upe(e,t,n){return t[hpe(e,n.currentContextId)]}function dpe(e,t){const[n,a,o]=ppe(e,t);return[hpe(n,t&&t.currentContextId),a,o]}function hpe(e,t){return t?"".concat(e,"-").concat(t):e}function ppe(e,t){if(""===e)return["",0,void 0];const n=null!=t&&null!=t.parseNodeNameCache;if(n){const n=t.parseNodeNameCache.get(e);if(null!=n)return n}const a=e.split(":");let o;if(1===a.length)o=[e,0,void 0];else{const e=a[0],t=3===a.length?a[1]:void 0;o=[e,Number(a[a.length-1]),t]}return n&&t.parseNodeNameCache.set(e,o),o}function mpe(e,t,n){let a=cpe("pad",e,t,n);if("explicit"===a){a=cpe("explicitPaddings",e,t,n);const o=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)o[e][0]=a[2*e],o[e][1]=a[2*e+1];return o}return a}function Ipe(e){return e.kept?e:MY(e)}const Cpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),fpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),bpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),ype=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]},Symbol.toStringTag,{value:"Module"})),Ape=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]},Symbol.toStringTag,{value:"Module"})),vpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),Spe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),xpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),Gpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),Zpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]},Symbol.toStringTag,{value:"Module"})),wpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),kpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),Bpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),Rpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]},Symbol.toStringTag,{value:"Module"})),Wpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),Vpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),Npe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),Xpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),Mpe=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]},Symbol.toStringTag,{value:"Module"}));class Tpe{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[Cpe,fpe,bpe,ype,Ape,vpe,Spe,xpe,Gpe,Zpe,wpe,kpe,Bpe,Rpe,Wpe,Vpe,Npe,Xpe,Mpe].map((e=>e.json)));this.opMappers=e.reduce(((e,t)=>(e[t.tfOpName]=t,e)),{})}transformGraph(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.node,a=[],o=[],i=[],r=n.reduce(((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?a.push(e[t.name]):"Const"===t.op?o.push(e[t.name]):(null==t.input||0===t.input.length)&&i.push(e[t.name]),e)),{});let s=[];const l=[];let c={},g={};null!=t&&(c=this.mapSignatureEntries(t.inputs),g=this.mapSignatureEntries(t.outputs));const u=Object.keys(r);u.forEach((e=>{const t=r[e];t.inputNames.forEach(((e,n)=>{const[a,,o]=dpe(e),i=r[a];if(null!=i.outputs){const e=i.outputs.indexOf(o);if(-1!==e){const o="".concat(a,":").concat(e);t.inputNames[n]=o}}t.inputs.push(i),i.children.push(t)}))})),0===Object.keys(g).length?u.forEach((e=>{const t=r[e];0===t.children.length&&l.push(t)})):Object.keys(g).forEach((e=>{const[t]=dpe(e),n=r[t];null!=n&&(n.signatureKey=g[e],l.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((e=>{const[t]=dpe(e),n=r[t];n&&(n.signatureKey=c[e],s.push(n))})):s=a;let d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce(((e,t)=>(e[t.signature.name]=this.mapFunction(t),e)),{}));const h={nodes:r,inputs:s,outputs:l,weights:o,placeholders:a,signature:t,functions:d};return i.length>0&&(h.initNodes=i),h}mapSignatureEntries(e){return Object.keys(e||{}).reduce(((t,n)=>(t[e[n].name]=n,t)),{})}mapNode(e){const t=lpe(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((e=>e.startsWith("^")?e.slice(1):e)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce(((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e)),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce(((t,n)=>{const a=n.type;let o;switch(n.type){case"string":o=Fpe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Fpe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":o=Ope(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Ope(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":o=Jpe(e.attr,n.tfName,n.defaultValue||0),void 0===o&&n.tfDeprecatedName&&(o=Jpe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":o=Ppe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Ppe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":o=Hpe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Hpe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":o=Qpe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Qpe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":o=Upe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Upe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":o=_pe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=_pe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":o=zpe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=zpe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":o=Kpe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Kpe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":o=Lpe(e.attr,n.tfName,n.defaultValue),void 0===o&&n.tfDeprecatedName&&(o=Lpe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:o,type:a},t}),{})),n}mapFunction(e){const t=e.nodeDef,n=[];let a={};null!=t&&(a=t.reduce(((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e)),{}));const o=[],i=[];e.signature.inputArg.forEach((e=>{const[t]=dpe(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Ype(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,o.push(n),a[t]=n})),Object.keys(a).forEach((e=>{const t=a[e];t.inputNames.forEach(((e,n)=>{const[o,,i]=dpe(e),r=a[o];if(null!=r.outputs){const e=r.outputs.indexOf(i);if(-1!==e){const a="".concat(o,":").concat(e);t.inputNames[n]=a}}t.inputs.push(r),r.children.push(t)}))}));const r=e.ret;e.signature.outputArg.forEach((e=>{const[t,n]=dpe(r[e.name]),o=a[t];null!=o&&(o.defaultOutput=n,i.push(o))}));const s=this.mapArgsToSignature(e);return{nodes:a,inputs:o,outputs:i,weights:n,placeholders:[],signature:s}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e)),{}),outputs:e.signature.outputArg.reduce(((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t)),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function Epe(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){const t=nM().global;if(typeof t.atob<"u")return t.atob(e);if(typeof Buffer<"u")return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function Fpe(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=e[t];return null!=o?Epe(o.s,a):n}function Hpe(e,t,n){const a=e[t];return a?a.b:n}function Jpe(e,t,n){const a=e[t]||{},o=null!=a.i?a.i:null!=a.f?a.f:n;return"number"==typeof o?o:parseInt(o,10)}function Ype(e){switch("string"==typeof e&&(e=a3[e]),e){case a3.DT_FLOAT:case a3.DT_HALF:return"float32";case a3.DT_INT32:case a3.DT_INT64:case a3.DT_INT8:case a3.DT_UINT8:return"int32";case a3.DT_BOOL:return"bool";case a3.DT_DOUBLE:return"float32";case a3.DT_STRING:return"string";case a3.DT_COMPLEX64:case a3.DT_COMPLEX128:return"complex64";default:return null}}function Lpe(e,t,n){const a=e[t];return a&&a.func?a.func.name:n}function zpe(e,t,n){const a=e[t];return a&&a.type?Ype(a.type):n}function Kpe(e,t,n){const a=e[t];return a&&a.list&&a.list.type?a.list.type.map((e=>Ype(e))):n}function Dpe(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((e=>"number"==typeof e.size?e.size:parseInt(e.size,10))):[]}function Upe(e,t,n){const a=e[t];return a&&a.shape?Dpe(a.shape):n}function Ppe(e,t,n){const a=e[t];return a?((a.list.f&&a.list.f.length?a.list.f:a.list.i)||[]).map((e=>"number"==typeof e?e:parseInt(e,10))):n}function Ope(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=e[t];return o&&o.list&&o.list.s?o.list.s.map((e=>Epe(e,a))):n}function _pe(e,t,n){const a=e[t];return a&&a.list&&a.list.shape?a.list.shape.map((e=>Dpe(e))):n}function Qpe(e,t,n){const a=e[t];return a&&a.list&&a.list.b?a.list.b:n}class jpe{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((e=>this.getInput(e))),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce(((e,t)=>(e[t]=this.getAttr(t),e)),{}))}getInput(e){return gpe(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return gpe(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Jpe(this.node.rawAttrs,e,t);if(null!=n.s)return Fpe(this.node.rawAttrs,e,t);if(null!=n.b)return Hpe(this.node.rawAttrs,e,t);if(null!=n.shape)return Upe(this.node.rawAttrs,e,t);if(null!=n.type)return zpe(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Ppe(this.node.rawAttrs,e,t);if(null!=n.list.s)return Ope(this.node.rawAttrs,e,t);if(null!=n.list.shape)return _pe(this.node.rawAttrs,e,t);if(null!=n.list.b)return Qpe(this.node.rawAttrs,e,t);if(null!=n.list.type)return Kpe(this.node.rawAttrs,e,t)}return t}}const qpe=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:SJ,abs:YY,acos:LY,acosh:zY,add:EY,addN:Bde,all:KY,any:DY,argMax:UY,argMin:PY,asin:OY,asinh:_Y,atan:QY,atan2:jY,atanh:qY,avgPool:mL,avgPool3d:IL,basicLSTMCell:Rde,batchNorm:xL,batchNorm2d:GL,batchNorm3d:ZL,batchNorm4d:wL,batchToSpaceND:vL,bincount:kL,bitwiseAnd:Wde,booleanMaskAsync:fhe,broadcastArgs:Vde,broadcastTo:BL,buffer:NY,cast:XY,ceil:RL,clipByValue:VL,clone:MY,complex:GJ,concat:CL,concat1d:NL,concat2d:XL,concat3d:ML,concat4d:TL,conv1d:FL,conv2d:EL,conv2dTranspose:JL,conv3d:YL,conv3dTranspose:zL,cos:KL,cosh:DL,cosineWindow:zD,cumprod:UL,cumsum:PL,denseBincount:OL,depthToSpace:_L,depthwiseConv2d:QL,diag:Nde,dilation2d:jL,div:HY,divNoNan:iz,dot:rz,dropout:YD,einsum:sz,elu:lz,enclosingPowerOfTwo:LD,ensureShape:Xde,equal:nz,erf:cz,euclideanNorm:wz,exp:kz,expandDims:Bz,expm1:Rz,eye:Vz,fft:mD,fill:WL,floor:Nz,floorDiv:FY,fused:Ghe,gather:Xz,gatherND:vhe,greater:Mz,greaterEqual:Tz,ifft:ID,imag:Ez,image:qU,inTopKAsync:She,irfft:CD,isFinite:Fz,isInf:Hz,isNaN:Jz,leakyRelu:Yz,less:Lz,lessEqual:zz,linalg:$U,linspace:Mde,localResponseNormalization:Kz,log:Dz,log1p:Uz,logSigmoid:qz,logSoftmax:eK,logSumExp:tK,logicalAnd:nK,logicalNot:aK,logicalOr:oK,logicalXor:iK,losses:eP,lowerBound:Fde,matMul:fL,max:fz,maxPool:rK,maxPool3d:sK,maxPoolWithArgmax:Hde,maximum:lK,mean:cK,meshgrid:Jde,min:bz,minimum:dK,mirrorPad:hK,mod:pK,moments:mK,movingAverage:bhe,mul:JY,multiRNNCell:Yde,multinomial:Lde,neg:Qz,norm:Zz,notEqual:IK,oneHot:CK,ones:uK,onesLike:fK,op:xJ,outerProduct:zde,pad:bK,pad1d:Kde,pad2d:Dde,pad3d:Ude,pad4d:Pde,pool:AK,pow:yz,prelu:vK,print:TY,prod:SK,raggedGather:Ode,raggedRange:_de,raggedTensorToTensor:Qde,rand:jde,randomGamma:ohe,randomNormal:_K,randomStandardNormal:ihe,randomUniform:QK,randomUniformInt:rhe,range:jK,real:qK,reciprocal:$K,relu:eD,relu6:tD,reshape:pL,reverse:nD,reverse1d:she,reverse2d:lhe,reverse3d:che,reverse4d:ghe,rfft:bD,round:aD,rsqrt:oD,scalar:Az,scatterND:yhe,searchSorted:Ede,selu:iD,separableConv2d:rD,setdiff1dAsync:uhe,sigmoid:bL,sign:sD,signal:jU,sin:lD,sinh:cD,slice:yL,slice1d:gD,slice2d:uD,slice3d:dD,slice4d:hD,softmax:pD,softplus:jz,spaceToBatchND:yK,sparse:tP,sparseToDense:Ahe,spectral:QU,split:fD,sqrt:vz,square:Sz,squaredDifference:yD,squeeze:AD,stack:vD,step:SD,stridedSlice:xD,string:nP,sub:$z,sum:xz,tan:GD,tanh:AL,tensor:wJ,tensor1d:ZD,tensor2d:wD,tensor3d:kD,tensor4d:dhe,tensor5d:hhe,tensor6d:phe,tensorScatterUpdate:mhe,tile:Wz,topk:ND,transpose:JD,truncatedNormal:XD,unique:MD,unsortedSegmentSum:TD,unstack:ED,upperBound:Ihe,variable:FD,where:az,whereAsync:Che,zeros:gK,zerosLike:oz},Symbol.toStringTag,{value:"Module"}));function $pe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){IX(e.length===t.length,(()=>n+" Shapes ".concat(e," and ").concat(t," must match")));for(let a=0;a<e.length;a++){const o=e[a],i=t[a];IX(o<0||i<0||o===i,(()=>n+" Shapes ".concat(e," and ").concat(t," must match")))}}}function eme(e){return!("number"==typeof e||e.some((e=>e<0)))}function tme(e,t,n){let a=nme(e,n);const o=!eme(a);if(o&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(a));if(o&&t.forEach((e=>{a=nme(e.shape,a)})),!eme(a))throw new Error("Non-fully-defined elementShape: ".concat(a));return a}function nme(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));const n=[];for(let a=0;a<e.length;++a){const o=e[a],i=t[a];if(o>=0&&i>=0&&o!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[a]=o>=0?o:i}return n}class ame{constructor(e,t,n,a,o,i,r){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=a,this.identicalElementShapes=o,this.dynamicSize=i,this.clearAfterRead=r,this.tensors=[],this.closed_=!1,this.idTensor=Az(0),XJ(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach((t=>{(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));const t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map((e=>this.read(e)))}write(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),$pe(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,XJ(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(((e,n)=>this.write(e,t[n])))}gather(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return wJ([],[0].concat(this.elementShape));const n=this.readMany(e);return $pe(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),vD(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return wJ([],[0].concat(this.elementShape));const t=[];for(let a=0;a<this.size();a++)t.push(a);const n=this.readMany(t);return $pe(this.elementShape,n[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(n[0].shape,")")),CL(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,ED(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));let n=0;const a=e.map((e=>(n+=e,n)));if(n!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(n,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));const o=0===n?0:t.size/n,i=[];VJ((()=>{t=pL(t,[1,n,o]);for(let n=0;n<e.length;++n){const r=[0,0===n?0:a[n-1],0],s=[1,e[n],o];i[n]=pL(yL(t,r,s),this.elementShape)}return i}));const r=[];for(let s=0;s<e.length;s++)r[s]=s;this.writeMany(r,i)}}class ome{get id(){return this.idTensor.id}constructor(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach((e=>{if(n!==e.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(e.dtype));$pe(t,e.shape,"TensorList shape mismatch: "),XJ(e)})),this.idTensor=Az(0),this.maxNumElements=a,XJ(this.idTensor)}copy(){return new ome([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach((t=>{(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==n&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));$pe(e,this.elementShape,"TensorList shape mismatch: ");const a=tme(this.elementShape,this.tensors,e);return VJ((()=>{const e=this.tensors.map((e=>pL(e,a)));return vD(e,0)}))}popBack(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=tme(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,$pe(a.shape,e,"TensorList shape mismatch: "),pL(a,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if($pe(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");XJ(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));const t=new ome([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));$pe(this.tensors[e].shape,t,"TensorList shape mismatch: ");const a=tme(this.elementShape,this.tensors,t);return pL(this.tensors[e],a)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));$pe(this.elementShape,t.shape,"TensorList shape mismatch: "),XJ(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));$pe(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());const a=tme(this.elementShape,this.tensors,n);return 0===e.length?wJ([],[0].concat(a)):VJ((()=>{const t=e.map((e=>pL(this.tensors[e],a)));return vD(t,0)}))}concat(e,t){if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));$pe(this.elementShape,t,"TensorList shape mismatch: ");const n=tme(this.elementShape,this.tensors,t);return 0===this.size()?wJ([],[0].concat(n)):VJ((()=>{const e=this.tensors.map((e=>pL(e,n)));return CL(e,0)}))}}const ime=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const a=cpe("thenBranch",e,t,n),o=cpe("elseBranch",e,t,n),i=cpe("cond",e,t,n),r=cpe("args",e,t,n);return(await i.data())[0]?n.functionMap[a].executeFunctionAsync(r,n.tensorArrayMap,n.tensorListMap):n.functionMap[o].executeFunctionAsync(r,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const a=cpe("body",e,t,n),o=cpe("cond",e,t,n),i=cpe("args",e,t,n),r=await n.functionMap[o].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),s=i.map((e=>e.id));let l=await r[0].data();r.forEach((e=>{!e.kept&&-1===s.indexOf(e.id)&&e.dispose()}));let c=i;for(;l[0];){const e=c;c=await n.functionMap[a].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const t=c.map((e=>e.id));e.forEach((e=>{!e.kept&&-1===s.indexOf(e.id)&&-1===t.indexOf(e.id)&&e.dispose()}));const i=await n.functionMap[o].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);l=await i[0].data(),i.forEach((e=>{!e.kept&&-1===s.indexOf(e.id)&&-1===t.indexOf(e.id)&&e.dispose()}))}return c}case"LoopCond":return[Ipe(cpe("pred",e,t,n))];case"Switch":{const a=cpe("pred",e,t,n);let o=cpe("data",e,t,n);return o.kept||(o=Ipe(o)),(await a.data())[0]?[void 0,o]:[o,void 0]}case"Merge":{const a=e.inputNames.find((e=>void 0!==gpe(e,t,n)));if(a){return[Ipe(gpe(a,t,n))]}return}case"Enter":{const a=cpe("frameName",e,t,n),o=cpe("tensor",e,t,n);return n.enterFrame(a),[Ipe(o)]}case"Exit":{const a=cpe("tensor",e,t,n);return n.exitFrame(),[Ipe(a)]}case"NextIteration":{const a=cpe("tensor",e,t,n);return n.nextIteration(),[Ipe(a)]}case"TensorArrayV3":{const a=cpe("size",e,t,n),o=cpe("dtype",e,t,n),i=cpe("elementShape",e,t,n),r=cpe("dynamicSize",e,t,n),s=cpe("clearAfterRead",e,t,n),l=cpe("identicalElementShapes",e,t,n),c=cpe("name",e,t,n),g=new ame(c,o,a,i,l,r,s);return n.addTensorArray(g),[g.idTensor,Az(1)]}case"TensorArrayWriteV3":{const a=cpe("tensorArrayId",e,t,n),o=cpe("index",e,t,n),i=cpe("tensor",e,t,n),r=n.getTensorArray(a.id);return r.write(o,i),[r.idTensor]}case"TensorArrayReadV3":{const a=cpe("tensorArrayId",e,t,n),o=cpe("index",e,t,n);return[n.getTensorArray(a.id).read(o)]}case"TensorArrayGatherV3":{const a=cpe("tensorArrayId",e,t,n),o=cpe("indices",e,t,n),i=cpe("dtype",e,t,n);return[n.getTensorArray(a.id).gather(o,i)]}case"TensorArrayScatterV3":{const a=cpe("tensorArrayId",e,t,n),o=cpe("indices",e,t,n),i=cpe("tensor",e,t,n),r=n.getTensorArray(a.id);return r.scatter(o,i),[r.idTensor]}case"TensorArrayConcatV3":{const a=cpe("tensorArrayId",e,t,n),o=n.getTensorArray(a.id),i=cpe("dtype",e,t,n);return[o.concat(i)]}case"TensorArraySplitV3":{const a=cpe("tensorArrayId",e,t,n),o=cpe("tensor",e,t,n),i=cpe("lengths",e,t,n),r=n.getTensorArray(a.id);return r.split(i,o),[r.idTensor]}case"TensorArraySizeV3":{const a=cpe("tensorArrayId",e,t,n);return[Az(n.getTensorArray(a.id).size(),"int32")]}case"TensorArrayCloseV3":{const a=cpe("tensorArrayId",e,t,n),o=n.getTensorArray(a.id);return o.clearAndClose(),[o.idTensor]}case"TensorListSetItem":{const a=cpe("tensorListId",e,t,n),o=cpe("index",e,t,n),i=cpe("tensor",e,t,n),r=n.getTensorList(a.id);return r.setItem(o,i),[r.idTensor]}case"TensorListGetItem":{const a=cpe("tensorListId",e,t,n),o=cpe("index",e,t,n),i=cpe("elementShape",e,t,n),r=cpe("elementDType",e,t,n);return[n.getTensorList(a.id).getItem(o,i,r)]}case"TensorListScatterV2":case"TensorListScatter":{const a=cpe("indices",e,t,n),o=function(e,t,n,a){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));const o=Math.max(...t);if(null!=a&&-1!==a&&o>=a)throw new Error("Max index must be < array size (".concat(o,"  vs. ").concat(a,")"));const i=new ome([],n,e.dtype,a),r=ED(e,0);return t.forEach(((e,t)=>{i.setItem(e,r[t])})),i}(cpe("tensor",e,t,n),a,cpe("elementShape",e,t,n),cpe("numElements",e,t,n));return n.addTensorList(o),[o.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const a=cpe("elementShape",e,t,n),o=cpe("elementDType",e,t,n);let i;i="TensorListReserve"===e.op?"numElements":"maxNumElements";const r=cpe(i,e,t,n),s=function(e,t,n,a){return new ome([],e,t,a)}(a,o,0,"TensorListReserve"===e.op?-1:r);return n.addTensorList(s),[s.idTensor]}case"TensorListGather":{const a=cpe("tensorListId",e,t,n),o=cpe("indices",e,t,n),i=cpe("elementShape",e,t,n),r=cpe("elementDType",e,t,n);return[n.getTensorList(a.id).gather(o,r,i)]}case"TensorListStack":{const a=cpe("tensorListId",e,t,n),o=cpe("elementShape",e,t,n),i=cpe("elementDType",e,t,n),r=cpe("numElements",e,t,n);return[n.getTensorList(a.id).stack(o,i,r)]}case"TensorListFromTensor":{const a=function(e,t,n){const a=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));$pe(e.shape.slice(1),t,"TensorList shape mismatch: ");const o=ED(e);return new ome(o,t,a)}(cpe("tensor",e,t,n),cpe("elementShape",e,t,n),cpe("elementDType",e,t,n));return n.addTensorList(a),[a.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const a=cpe("tensorListId",e,t,n),o=n.getTensorList(a.id),i=cpe("dtype",e,t,n),r=cpe("elementShape",e,t,n);return[o.concat(i,r)]}case"TensorListPushBack":{const a=cpe("tensorListId",e,t,n),o=cpe("tensor",e,t,n),i=n.getTensorList(a.id);return i.pushBack(o),[i.idTensor]}case"TensorListPopBack":{const a=cpe("tensorListId",e,t,n),o=cpe("elementShape",e,t,n),i=cpe("elementDType",e,t,n);return[n.getTensorList(a.id).popBack(o,i)]}case"TensorListSplit":{const a=cpe("tensor",e,t,n),o=cpe("elementShape",e,t,n),i=function(e,t,n){let a=0;const o=t.map((e=>(a+=e,a)));if(a!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(a,", and tensor's shape is: ").concat(e.shape));const i=nme(e.shape.slice(1),n),r=0===a?0:e.size/a,s=VJ((()=>{const n=[];e=pL(e,[1,a,r]);for(let a=0;a<t.length;++a){const s=[0,0===a?0:o[a-1],0],l=[1,t[a],r];n[a]=pL(yL(e,s,l),i)}return e.dispose(),n})),l=new ome([],n,e.dtype,t.length);for(let c=0;c<s.length;c++)l.setItem(c,s[c]);return l}(a,cpe("lengths",e,t,n),o);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{const a=cpe("tensorListId",e,t,n);return[Az(n.getTensorList(a.id).size(),"int32")]}case"TensorListResize":{const a=cpe("tensorListId",e,t,n),o=cpe("size",e,t,n),i=n.getTensorList(a.id).resize(o);return n.addTensorList(i),[i.idTensor]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function rme(e,t,n){const[a,o]=cpe("fusedOps",e,t,n),i="biasadd"===a,r=!i,s="prelu"===o,l="fusedbatchnorm"===a,c=cpe("numArgs",e,t,n);if(i){if(s&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&i&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const g=cpe("strides",e,t,n),u=mpe(e,t,n),d=cpe("dataFormat",e,t,n).toUpperCase(),h=cpe("dilations",e,t,n);let[p,m]=cpe("args",e,t,n);r&&(m=p,p=void 0);return{stride:g,pad:u,dataFormat:d,dilations:h,biasArg:p,preluArg:m,activationFunc:o,leakyreluAlpha:cpe("leakyreluAlpha",e,t,n)}}function sme(e,t,n){return{boxes:cpe("boxes",e,t,n),scores:cpe("scores",e,t,n),maxOutputSize:cpe("maxOutputSize",e,t,n),iouThreshold:cpe("iouThreshold",e,t,n),scoreThreshold:cpe("scoreThreshold",e,t,n),softNmsSigma:cpe("softNmsSigma",e,t,n)}}class lme{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Az(0),this.tensorMap=new Map,XJ(this.handle)}clearAndClose(){this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Az(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),VJ((()=>{const e=ED(t),a=n.length,o=e.length;IX(a===o,(()=>"The number of elements doesn't match, keys has ".concat(a," elements, the values has ").concat(o," elements.")));for(let t=0;t<a;t++){const a=n[t],o=e[t];XJ(o),this.tensorMap.set(a,o)}return this.handle}))}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return VJ((()=>{const e=[];for(let a=0;a<n.length;a++){const o=n[a],i=this.findWithDefault(o,t);e.push(i)}return vD(e)}))}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!==n&&void 0!==n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}function cme(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:VJ;const i=((e,t,n)=>{switch(e.category){case"arithmetic":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[a.add(cpe("a",e,t,n),cpe("b",e,t,n))];case"AddN":return[a.addN(cpe("tensors",e,t,n))];case"FloorMod":case"Mod":return[a.mod(cpe("a",e,t,n),cpe("b",e,t,n))];case"Mul":return[a.mul(cpe("a",e,t,n),cpe("b",e,t,n))];case"RealDiv":case"Div":return[a.div(cpe("a",e,t,n),cpe("b",e,t,n))];case"DivNoNan":return[a.divNoNan(cpe("a",e,t,n),cpe("b",e,t,n))];case"FloorDiv":return[a.floorDiv(cpe("a",e,t,n),cpe("b",e,t,n))];case"Sub":return[a.sub(cpe("a",e,t,n),cpe("b",e,t,n))];case"Minimum":return[a.minimum(cpe("a",e,t,n),cpe("b",e,t,n))];case"Maximum":return[a.maximum(cpe("a",e,t,n),cpe("b",e,t,n))];case"Pow":return[a.pow(cpe("a",e,t,n),cpe("b",e,t,n))];case"SquaredDifference":return[a.squaredDifference(cpe("a",e,t,n),cpe("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"basic_math":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"Abs":case"ComplexAbs":return[a.abs(cpe("x",e,t,n))];case"Acos":return[a.acos(cpe("x",e,t,n))];case"Acosh":return[a.acosh(cpe("x",e,t,n))];case"Asin":return[a.asin(cpe("x",e,t,n))];case"Asinh":return[a.asinh(cpe("x",e,t,n))];case"Atan":return[a.atan(cpe("x",e,t,n))];case"Atan2":return[a.atan2(cpe("x",e,t,n),cpe("y",e,t,n))];case"Atanh":return[a.atanh(cpe("x",e,t,n))];case"Ceil":return[a.ceil(cpe("x",e,t,n))];case"Complex":return[a.complex(cpe("real",e,t,n),cpe("imag",e,t,n))];case"Cos":return[a.cos(cpe("x",e,t,n))];case"Cosh":return[a.cosh(cpe("x",e,t,n))];case"Elu":return[a.elu(cpe("x",e,t,n))];case"Erf":return[a.erf(cpe("x",e,t,n))];case"Exp":return[a.exp(cpe("x",e,t,n))];case"Expm1":return[a.expm1(cpe("x",e,t,n))];case"Floor":return[a.floor(cpe("x",e,t,n))];case"Log":return[a.log(cpe("x",e,t,n))];case"Log1p":return[a.log1p(cpe("x",e,t,n))];case"Imag":return[a.imag(cpe("x",e,t,n))];case"Neg":return[a.neg(cpe("x",e,t,n))];case"Reciprocal":return[a.reciprocal(cpe("x",e,t,n))];case"Real":return[a.real(cpe("x",e,t,n))];case"Relu":return[a.relu(cpe("x",e,t,n))];case"Round":return[a.round(cpe("x",e,t,n))];case"Selu":return[a.selu(cpe("x",e,t,n))];case"Sigmoid":return[a.sigmoid(cpe("x",e,t,n))];case"Sin":return[a.sin(cpe("x",e,t,n))];case"Sign":return[a.sign(cpe("x",e,t,n))];case"Sinh":return[a.sinh(cpe("x",e,t,n))];case"Softplus":return[a.softplus(cpe("x",e,t,n))];case"Sqrt":return[a.sqrt(cpe("x",e,t,n))];case"Square":return[a.square(cpe("x",e,t,n))];case"Tanh":return[a.tanh(cpe("x",e,t,n))];case"Tan":return[a.tan(cpe("x",e,t,n))];case"ClipByValue":return[a.clipByValue(cpe("x",e,t,n),cpe("clipValueMin",e,t,n),cpe("clipValueMax",e,t,n))];case"Relu6":return[a.relu6(cpe("x",e,t,n))];case"Rsqrt":return[a.rsqrt(gpe(e.inputNames[0],t,n))];case"LeakyRelu":return[a.leakyRelu(cpe("x",e,t,n),cpe("alpha",e,t,n))];case"Prelu":return[a.prelu(cpe("x",e,t,n),cpe("alpha",e,t,n))];case"IsNan":return[a.isNaN(gpe(e.inputNames[0],t,n))];case"IsInf":return[a.isInf(gpe(e.inputNames[0],t,n))];case"IsFinite":return[a.isFinite(gpe(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"control":return ime(e,t,n);case"convolution":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"Conv1D":{const o=cpe("stride",e,t,n),i=cpe("pad",e,t,n),r=cpe("dataFormat",e,t,n).toUpperCase(),s=cpe("dilation",e,t,n);return[a.conv1d(cpe("x",e,t,n),cpe("filter",e,t,n),o,i,r,s)]}case"Conv2D":{const o=cpe("strides",e,t,n),i=mpe(e,t,n),r=cpe("dataFormat",e,t,n).toUpperCase(),s=cpe("dilations",e,t,n);return[a.conv2d(cpe("x",e,t,n),cpe("filter",e,t,n),[o[1],o[2]],i,r,[s[1],s[2]])]}case"_FusedConv2D":{const{stride:o,pad:i,dataFormat:r,dilations:s,biasArg:l,preluArg:c,activationFunc:g,leakyreluAlpha:u}=rme(e,t,n);return[a.fused.conv2d({x:cpe("x",e,t,n),filter:cpe("filter",e,t,n),strides:[o[1],o[2]],pad:i,dataFormat:r,dilations:[s[1],s[2]],bias:l,activation:g,preluActivationWeights:c,leakyreluAlpha:u})]}case"FusedDepthwiseConv2dNative":{const{stride:o,pad:i,dataFormat:r,dilations:s,biasArg:l,preluArg:c,activationFunc:g,leakyreluAlpha:u}=rme(e,t,n);return[a.fused.depthwiseConv2d({x:cpe("x",e,t,n),filter:cpe("filter",e,t,n),strides:[o[1],o[2]],pad:i,dataFormat:r,dilations:[s[1],s[2]],bias:l,activation:g,preluActivationWeights:c,leakyreluAlpha:u})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const o=cpe("outputShape",e,t,n),i=cpe("strides",e,t,n),r=mpe(e,t,n);return[a.conv2dTranspose(cpe("x",e,t,n),cpe("filter",e,t,n),o,[i[1],i[2]],r)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const o=cpe("strides",e,t,n),i=mpe(e,t,n),r=cpe("dilations",e,t,n),s=cpe("dataFormat",e,t,n).toUpperCase();return[a.depthwiseConv2d(cpe("input",e,t,n),cpe("filter",e,t,n),[o[1],o[2]],i,s,[r[1],r[2]])]}case"Conv3D":{const o=cpe("strides",e,t,n),i=cpe("pad",e,t,n),r=cpe("dataFormat",e,t,n).toUpperCase(),s=cpe("dilations",e,t,n);return[a.conv3d(cpe("x",e,t,n),cpe("filter",e,t,n),[o[1],o[2],o[3]],i,r,[s[1],s[2],s[3]])]}case"AvgPool":{const o=cpe("strides",e,t,n),i=cpe("pad",e,t,n),r=cpe("kernelSize",e,t,n);return[a.avgPool(cpe("x",e,t,n),[r[1],r[2]],[o[1],o[2]],i)]}case"MaxPool":{const o=cpe("strides",e,t,n),i=cpe("pad",e,t,n),r=cpe("kernelSize",e,t,n);return[a.maxPool(cpe("x",e,t,n),[r[1],r[2]],[o[1],o[2]],i)]}case"MaxPoolWithArgmax":{const o=cpe("strides",e,t,n),i=cpe("pad",e,t,n),r=cpe("kernelSize",e,t,n),s=cpe("includeBatchInIndex",e,t,n),{result:l,indexes:c}=a.maxPoolWithArgmax(cpe("x",e,t,n),[r[1],r[2]],[o[1],o[2]],i,s);return[l,c]}case"AvgPool3D":{const o=cpe("strides",e,t,n),i=cpe("pad",e,t,n),r=cpe("kernelSize",e,t,n);return[a.avgPool3d(cpe("x",e,t,n),[r[1],r[2],r[3]],[o[1],o[2],o[3]],i)]}case"MaxPool3D":{const o=cpe("strides",e,t,n),i=cpe("pad",e,t,n),r=cpe("kernelSize",e,t,n);return[a.maxPool3d(cpe("x",e,t,n),[r[1],r[2],r[3]],[o[1],o[2],o[3]],i)]}case"Dilation2D":{const o=cpe("strides",e,t,n),i=cpe("pad",e,t,n),r=cpe("dilations",e,t,n),s=o[1],l=o[2],c=r[1],g=r[2];return[a.dilation2d(cpe("x",e,t,n),cpe("filter",e,t,n),[s,l],i,[c,g],"NHWC")]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"creation":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"Fill":{const o=cpe("shape",e,t,n),i=cpe("dtype",e,t,n),r=cpe("value",e,t,n);return[a.fill(o,r,i)]}case"LinSpace":{const o=cpe("start",e,t,n),i=cpe("stop",e,t,n),r=cpe("num",e,t,n);return[a.linspace(o,i,r)]}case"Multinomial":{const o=cpe("logits",e,t,n),i=cpe("numSamples",e,t,n),r=cpe("seed",e,t,n);return[a.multinomial(o,i,r)]}case"OneHot":{const o=cpe("indices",e,t,n),i=cpe("depth",e,t,n),r=cpe("onValue",e,t,n),s=cpe("offValue",e,t,n),l=cpe("dtype",e,t,n);return[a.oneHot(o,i,r,s,l)]}case"Ones":return[a.ones(cpe("shape",e,t,n),cpe("dtype",e,t,n))];case"OnesLike":return[a.onesLike(cpe("x",e,t,n))];case"RandomStandardNormal":return[a.randomStandardNormal(cpe("shape",e,t,n),cpe("dtype",e,t,n),cpe("seed",e,t,n))];case"RandomUniform":return[a.randomUniform(cpe("shape",e,t,n),cpe("minval",e,t,n),cpe("maxval",e,t,n),cpe("dtype",e,t,n))];case"RandomUniformInt":return[a.randomUniformInt(cpe("shape",e,t,n),cpe("minval",e,t,n),cpe("maxval",e,t,n),cpe("seed",e,t,n))];case"Range":{const o=cpe("start",e,t,n),i=cpe("stop",e,t,n),r=cpe("step",e,t,n);return[a.range(o,i,r,cpe("dtype",e,t,n))]}case"TruncatedNormal":{const o=cpe("shape",e,t,n),i=cpe("mean",e,t,n),r=cpe("stdDev",e,t,n),s=cpe("seed",e,t,n);return[a.truncatedNormal(o,i,r,cpe("dtype",e,t,n),s)]}case"Zeros":return[a.zeros(cpe("shape",e,t,n),cpe("dtype",e,t,n))];case"ZerosLike":return[a.zerosLike(cpe("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"dynamic":return async function(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qpe;switch(e.op){case"NonMaxSuppressionV5":{const{boxes:a,scores:i,maxOutputSize:r,iouThreshold:s,scoreThreshold:l,softNmsSigma:c}=sme(e,t,n),g=await o.image.nonMaxSuppressionWithScoreAsync(a,i,r,s,l,c);return[g.selectedIndices,g.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:a,scores:i,maxOutputSize:r,iouThreshold:s,scoreThreshold:l}=sme(e,t,n),c=cpe("padToMaxOutputSize",e,t,n),g=await o.image.nonMaxSuppressionPaddedAsync(a,i,r,s,l,c);return[g.selectedIndices,g.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:a,scores:i,maxOutputSize:r,iouThreshold:s,scoreThreshold:l}=sme(e,t,n);return[await o.image.nonMaxSuppressionAsync(a,i,r,s,l)]}case"Where":{const a=o.cast(cpe("condition",e,t,n),"bool"),i=[await o.whereAsync(a)];return a.dispose(),i}case"ListDiff":return o.setdiff1dAsync(cpe("x",e,t,n),cpe("y",e,t,n));default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n);case"evaluation":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"LowerBound":{const o=cpe("sortedSequence",e,t,n),i=cpe("values",e,t,n);return[a.lowerBound(o,i)]}case"TopKV2":{const o=cpe("x",e,t,n),i=cpe("k",e,t,n),r=cpe("sorted",e,t,n),s=a.topk(o,i,r);return[s.values,s.indices]}case"UpperBound":{const o=cpe("sortedSequence",e,t,n),i=cpe("values",e,t,n);return[a.upperBound(o,i)]}case"Unique":{const o=cpe("x",e,t,n),i=a.unique(o);return[i.values,i.indices]}case"UniqueV2":{const o=cpe("x",e,t,n),i=cpe("axis",e,t,n),r=a.unique(o,i);return[r.values,r.indices]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"image":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"ResizeBilinear":{const o=cpe("images",e,t,n),i=cpe("size",e,t,n),r=cpe("alignCorners",e,t,n),s=cpe("halfPixelCenters",e,t,n);return[a.image.resizeBilinear(o,[i[0],i[1]],r,s)]}case"ResizeNearestNeighbor":{const o=cpe("images",e,t,n),i=cpe("size",e,t,n),r=cpe("alignCorners",e,t,n),s=cpe("halfPixelCenters",e,t,n);return[a.image.resizeNearestNeighbor(o,[i[0],i[1]],r,s)]}case"CropAndResize":{const o=cpe("image",e,t,n),i=cpe("boxes",e,t,n),r=cpe("boxInd",e,t,n),s=cpe("cropSize",e,t,n),l=cpe("method",e,t,n),c=cpe("extrapolationValue",e,t,n);return[a.image.cropAndResize(o,i,r,s,l,c)]}case"ImageProjectiveTransformV3":{const o=cpe("images",e,t,n),i=cpe("transforms",e,t,n),r=cpe("outputShape",e,t,n),s=cpe("fillValue",e,t,n),l=cpe("interpolation",e,t,n),c=cpe("fillMode",e,t,n);return[a.image.transform(o,i,l.toLowerCase(),c.toLowerCase(),s,r)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"graph":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const o=cpe("default",e,t,n);return[gpe(e.name,t,n)||o];case"Placeholder":return[gpe(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[Ipe(cpe("x",e,t,n))];case"IdentityN":return cpe("x",e,t,n).map((e=>Ipe(e)));case"Shape":return[a.tensor1d(cpe("x",e,t,n).shape,"int32")];case"ShapeN":return cpe("x",e,t,n).map((e=>a.tensor1d(e.shape)));case"Size":return[a.scalar(cpe("x",e,t,n).size,"int32")];case"Rank":return[a.scalar(cpe("x",e,t,n).rank,"int32")];case"NoOp":return[a.scalar(1)];case"Print":const i=cpe("x",e,t,n),r=cpe("data",e,t,n),s=cpe("message",e,t,n),l=cpe("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(let e=0;e<r.length;e++)console.log(Array.prototype.slice.call(r[e].dataSync()).slice(0,l));return[i];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"logical":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"Equal":return[a.equal(cpe("a",e,t,n),cpe("b",e,t,n))];case"NotEqual":return[a.notEqual(cpe("a",e,t,n),cpe("b",e,t,n))];case"Greater":return[a.greater(cpe("a",e,t,n),cpe("b",e,t,n))];case"GreaterEqual":return[a.greaterEqual(cpe("a",e,t,n),cpe("b",e,t,n))];case"Less":return[a.less(cpe("a",e,t,n),cpe("b",e,t,n))];case"LessEqual":return[a.lessEqual(cpe("a",e,t,n),cpe("b",e,t,n))];case"LogicalAnd":return[a.logicalAnd(cpe("a",e,t,n),cpe("b",e,t,n))];case"LogicalNot":return[a.logicalNot(cpe("a",e,t,n))];case"LogicalOr":return[a.logicalOr(cpe("a",e,t,n),cpe("b",e,t,n))];case"Select":case"SelectV2":return[a.where(cpe("condition",e,t,n),cpe("a",e,t,n),cpe("b",e,t,n))];case"BitwiseAnd":return[a.bitwiseAnd(cpe("a",e,t,n),cpe("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"matrices":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[a.matMul(cpe("a",e,t,n),cpe("b",e,t,n),cpe("transposeA",e,t,n),cpe("transposeB",e,t,n))];case"Einsum":return[a.einsum(cpe("equation",e,t,n),...cpe("tensors",e,t,n))];case"Transpose":return[a.transpose(cpe("x",e,t,n),cpe("perm",e,t,n))];case"_FusedMatMul":const[o,i]=cpe("fusedOps",e,t,n),r="biasadd"===o,s="prelu"===i,l=cpe("numArgs",e,t,n),c=cpe("leakyreluAlpha",e,t,n);if(r){if(s&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[g,u]=cpe("args",e,t,n);return[a.fused.matMul({a:cpe("a",e,t,n),b:cpe("b",e,t,n),transposeA:cpe("transposeA",e,t,n),transposeB:cpe("transposeB",e,t,n),bias:g,activation:i,preluActivationWeights:u,leakyreluAlpha:c})];case"MatrixBandPart":return[a.linalg.bandPart(cpe("a",e,t,n),cpe("numLower",e,t,n),cpe("numUpper",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"normalization":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"EuclideanNorm":return[a.euclideanNorm(cpe("x",e,t,n),cpe("axis",e,t,n),cpe("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[a.batchNorm(cpe("x",e,t,n),cpe("mean",e,t,n),cpe("variance",e,t,n),cpe("offset",e,t,n),cpe("scale",e,t,n),cpe("epsilon",e,t,n))];case"LRN":return[a.localResponseNormalization(cpe("x",e,t,n),cpe("radius",e,t,n),cpe("bias",e,t,n),cpe("alpha",e,t,n),cpe("beta",e,t,n))];case"Softmax":return[a.softmax(cpe("x",e,t,n))];case"LogSoftmax":return[a.logSoftmax(cpe("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"ragged":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"RaggedGather":{const{outputNestedSplits:o,outputDenseValues:i}=a.raggedGather(cpe("paramsNestedSplits",e,t,n),cpe("paramsDenseValues",e,t,n),cpe("indices",e,t,n),cpe("outputRaggedRank",e,t,n));return o.concat(i)}case"RaggedRange":{const{rtNestedSplits:o,rtDenseValues:i}=a.raggedRange(cpe("starts",e,t,n),cpe("limits",e,t,n),cpe("splits",e,t,n));return[o,i]}case"RaggedTensorToTensor":return[a.raggedTensorToTensor(cpe("shape",e,t,n),cpe("values",e,t,n),cpe("defaultValue",e,t,n),cpe("rowPartitionTensors",e,t,n),cpe("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"reduction":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"Max":{const o=cpe("axis",e,t,n),i=cpe("keepDims",e,t,n);return[a.max(cpe("x",e,t,n),o,i)]}case"Mean":{const o=cpe("axis",e,t,n),i=cpe("keepDims",e,t,n);return[a.mean(cpe("x",e,t,n),o,i)]}case"Min":{const o=cpe("axis",e,t,n),i=cpe("keepDims",e,t,n);return[a.min(cpe("x",e,t,n),o,i)]}case"Sum":{const o=cpe("axis",e,t,n),i=cpe("keepDims",e,t,n);return[a.sum(cpe("x",e,t,n),o,i)]}case"All":{const o=cpe("axis",e,t,n),i=cpe("keepDims",e,t,n);return[a.all(cpe("x",e,t,n),o,i)]}case"Any":{const o=cpe("axis",e,t,n),i=cpe("keepDims",e,t,n);return[a.any(cpe("x",e,t,n),o,i)]}case"ArgMax":{const o=cpe("axis",e,t,n);return[a.argMax(cpe("x",e,t,n),o)]}case"ArgMin":{const o=cpe("axis",e,t,n);return[a.argMin(cpe("x",e,t,n),o)]}case"Prod":{const o=cpe("axis",e,t,n),i=cpe("keepDims",e,t,n);return[a.prod(cpe("x",e,t,n),o,i)]}case"Cumprod":{const o=cpe("axis",e,t,n),i=cpe("exclusive",e,t,n),r=cpe("reverse",e,t,n);return[a.cumprod(cpe("x",e,t,n),o,i,r)]}case"Cumsum":{const o=cpe("axis",e,t,n),i=cpe("exclusive",e,t,n),r=cpe("reverse",e,t,n);return[a.cumsum(cpe("x",e,t,n),o,i,r)]}case"Bincount":const o=cpe("x",e,t,n),i=cpe("weights",e,t,n),r=cpe("size",e,t,n);return[a.bincount(o,i,r)];case"DenseBincount":{const o=cpe("x",e,t,n),i=cpe("weights",e,t,n),r=cpe("size",e,t,n),s=cpe("binaryOutput",e,t,n);return[a.denseBincount(o,i,r,s)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"slice_join":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"ConcatV2":case"Concat":{const o=cpe("n",e,t,n),i=cpe("axis",e,t,n);let r=cpe("tensors",e,t,n);return r=r.slice(0,o),[a.concat(r,i)]}case"Gather":{const o=cpe("x",e,t,n),i=cpe("indices",e,t,n);return[a.gather(o,a.cast(i,"int32"),0)]}case"GatherV2":{const o=cpe("axis",e,t,n),i=cpe("batchDims",e,t,n),r=cpe("x",e,t,n),s=cpe("indices",e,t,n);return[a.gather(r,a.cast(s,"int32"),o,i)]}case"Reverse":{const o=cpe("dims",e,t,n),i=[];for(let e=0;e<o.length;e++)o[e]&&i.push(e);const r=cpe("x",e,t,n);return[a.reverse(r,i)]}case"ReverseV2":{const o=cpe("axis",e,t,n),i=cpe("x",e,t,n);return[a.reverse(i,o)]}case"Slice":{const o=cpe("begin",e,t,n),i=cpe("size",e,t,n);return[a.slice(cpe("x",e,t,n),o,i)]}case"StridedSlice":{const o=cpe("begin",e,t,n),i=cpe("end",e,t,n),r=cpe("strides",e,t,n),s=cpe("beginMask",e,t,n),l=cpe("endMask",e,t,n),c=cpe("ellipsisMask",e,t,n),g=cpe("newAxisMask",e,t,n),u=cpe("shrinkAxisMask",e,t,n),d=cpe("x",e,t,n);return[a.stridedSlice(d,o,i,r,s,l,c,g,u)]}case"Pack":return VJ((()=>{const o=cpe("axis",e,t,n),i=cpe("tensors",e,t,n),r=i[0].shape,s=a.squeeze(i[0]).shape,l=i.map((e=>{const t=AX(e.shape,r);if(!t&&!AX(a.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:a.reshape(e,r)}));return[a.stack(l,o)]}));case"Unpack":{const o=cpe("axis",e,t,n),i=cpe("tensor",e,t,n);return a.unstack(i,o)}case"Tile":{const o=cpe("reps",e,t,n);return[a.tile(cpe("x",e,t,n),o)]}case"Split":case"SplitV":{const o=cpe("axis",e,t,n),i=cpe("numOrSizeSplits",e,t,n),r=cpe("x",e,t,n);return a.split(r,i,o)}case"ScatterNd":{const o=cpe("indices",e,t,n),i=cpe("values",e,t,n),r=cpe("shape",e,t,n);return[a.scatterND(o,i,r)]}case"GatherNd":{const o=cpe("x",e,t,n),i=cpe("indices",e,t,n);return[a.gatherND(o,i)]}case"SparseToDense":{const o=cpe("sparseIndices",e,t,n),i=cpe("outputShape",e,t,n),r=cpe("sparseValues",e,t,n),s=cpe("defaultValue",e,t,n);return[a.sparseToDense(o,r,i,r.dtype===s.dtype?s:a.cast(s,r.dtype))]}case"TensorScatterUpdate":{const o=cpe("indices",e,t,n),i=cpe("values",e,t,n),r=cpe("tensor",e,t,n);return[a.tensorScatterUpdate(r,o,i)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"sparse":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"SparseFillEmptyRows":{const{outputIndices:o,outputValues:i,emptyRowIndicator:r,reverseIndexMap:s}=a.sparse.sparseFillEmptyRows(cpe("indices",e,t,n),cpe("values",e,t,n),cpe("denseShape",e,t,n),cpe("defaultValue",e,t,n));return[o,i,r,s]}case"SparseReshape":{const{outputIndices:o,outputShape:i}=a.sparse.sparseReshape(cpe("inputIndices",e,t,n),cpe("inputShape",e,t,n),cpe("newShape",e,t,n));return[o,i]}case"SparseSegmentMean":return[a.sparse.sparseSegmentMean(cpe("data",e,t,n),cpe("indices",e,t,n),cpe("segmentIds",e,t,n))];case"SparseSegmentSum":return[a.sparse.sparseSegmentSum(cpe("data",e,t,n),cpe("indices",e,t,n),cpe("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"spectral":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"FFT":return[a.fft(cpe("x",e,t,n))];case"IFFT":return[a.ifft(cpe("x",e,t,n))];case"RFFT":return[a.rfft(cpe("x",e,t,n))];case"IRFFT":return[a.irfft(cpe("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"string":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"StaticRegexReplace":return[a.string.staticRegexReplace(cpe("input",e,t,n),cpe("pattern",e,t,n),cpe("rewrite",e,t,n),cpe("replaceGlobal",e,t,n))];case"StringNGrams":{const{nGrams:o,nGramsSplits:i}=a.string.stringNGrams(cpe("data",e,t,n),cpe("dataSplits",e,t,n),cpe("separator",e,t,n),cpe("nGramWidths",e,t,n),cpe("leftPad",e,t,n),cpe("rightPad",e,t,n),cpe("padWidth",e,t,n),cpe("preserveShortSequences",e,t,n));return[o,i]}case"StringSplit":{const{indices:o,values:i,shape:r}=a.string.stringSplit(cpe("input",e,t,n),cpe("delimiter",e,t,n),cpe("skipEmpty",e,t,n));return[o,i,r]}case"StringToHashBucketFast":return[a.string.stringToHashBucketFast(cpe("input",e,t,n),cpe("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"transformation":return o((()=>function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qpe;switch(e.op){case"Cast":return[a.cast(cpe("x",e,t,n),cpe("dtype",e,t,n))];case"ExpandDims":{const o=cpe("axis",e,t,n);return[a.expandDims(cpe("x",e,t,n),o)]}case"Squeeze":{const o=cpe("axis",e,t,n);return[a.squeeze(cpe("x",e,t,n),o)]}case"Reshape":return[a.reshape(cpe("x",e,t,n),cpe("shape",e,t,n))];case"EnsureShape":return[a.ensureShape(cpe("x",e,t,n),cpe("shape",e,t,n))];case"MirrorPad":return[a.mirrorPad(cpe("x",e,t,n),cpe("padding",e,t,n),cpe("mode",e,t,n))];case"PadV2":case"Pad":return[a.pad(cpe("x",e,t,n),cpe("padding",e,t,n),cpe("constantValue",e,t,n))];case"SpaceToBatchND":{const o=cpe("blockShape",e,t,n),i=cpe("paddings",e,t,n);return[a.spaceToBatchND(cpe("x",e,t,n),o,i)]}case"BatchToSpaceND":{const o=cpe("blockShape",e,t,n),i=cpe("crops",e,t,n);return[a.batchToSpaceND(cpe("x",e,t,n),o,i)]}case"DepthToSpace":{const o=cpe("blockSize",e,t,n),i=cpe("dataFormat",e,t,n).toUpperCase();return[a.depthToSpace(cpe("x",e,t,n),o,i)]}case"BroadcastTo":return[a.broadcastTo(cpe("x",e,t,n),cpe("shape",e,t,n))];case"BroadcastArgs":return[a.broadcastArgs(cpe("s0",e,t,n),cpe("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)));case"hash_table":return(async(e,t,n,a)=>{switch(e.op){case"HashTable":case"HashTableV2":{const o=a.getHashTableHandleByName(e.name);if(null!=o)return[o];{const o=cpe("keyDType",e,t,n),i=cpe("valueDType",e,t,n),r=new lme(o,i);return a.addHashTable(e.name,r),[r.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const o=cpe("tableHandle",e,t,n,a),i=cpe("keys",e,t,n),r=cpe("values",e,t,n);return[await a.getHashTableById(o.id).import(i,r)]}case"LookupTableFind":case"LookupTableFindV2":{const o=cpe("tableHandle",e,t,n,a),i=cpe("keys",e,t,n),r=cpe("defaultValue",e,t,n);return[await a.getHashTableById(o.id).find(i,r)]}case"LookupTableSize":case"LookupTableSizeV2":{const o=cpe("tableHandle",e,t,n,a);return[a.getHashTableById(o.id).tensorSize()]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}})(e,t,n,a);case"custom":const i=lpe(e.op);if(i&&i.customExecutor)return i.customExecutor(new jpe(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}})(e,t,n);return qX(i)?i.then((e=>[].concat(e))):[].concat(i)}class gme{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0;this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=a,this.parseNodeNameCache=o,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map((e=>0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId))).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function ume(e,t,n,a){const o=new Set,i=[];let r=null,s=null;const l=new Set,c=new Set(Object.keys(e).map((e=>ppe(e)[0])));a=a||[];const g=new Set(a.map((e=>ppe(e.name)[0]))),u=[...t];for(;u.length>0;){const e=u.pop();if((Cme(e)||fme(e)||bme(e))&&null==r&&(r=e,s=r.children.map((e=>e.name)).filter((e=>o.has(e)))),o.add(e.name),null==n[e.name]&&!c.has(e.name)&&!g.has(e.name)){if(0===e.inputs.length){i.push(e.name);continue}e.inputs.forEach((e=>{l.has(e.name)||(l.add(e.name),u.push(e))}))}}return{inputs:e,outputs:t,usedNodes:o,missingInputs:i,dynamicNode:r,syncInputs:s}}function dme(e,t){const{usedNodes:n,inputs:a}=t,o=Object.keys(a).map((e=>ppe(e)[0])).map((t=>e.nodes[t])),i=e.initNodes||[],r=e=>n.has("string"==typeof e?e:e.name);function s(e){return[...new Map(e.map((e=>[e.name,e]))).values()]}const l=s([...o,...e.weights,...i]).filter(r),c=s([...l,...Object.values(e.nodes)]).filter(r),g=new Map(c.map((e=>[e.name,e]))),u={};for(const I of c){u[I.name]=u[I.name]||0;for(const e of I.children)r(e)||(u[e.name]=Number.POSITIVE_INFINITY),u[e.name]=(u[e.name]||0)+1}const d=Object.entries(u).filter((e=>{let[,t]=e;return 0===t})).map((e=>{let[t]=e;return t})),h=[...d];for(;d.length>0;){const e=d.pop(),t=g.get(e);for(const n of t.children.filter(r))0===--u[n.name]&&(h.push(n.name),d.push(n.name))}const p=h.map((e=>g.get(e))),m=function(e,t){const n=new Map(e.map((e=>[e.name,e]))),a=t.map((e=>e.name)),o=new Set(a);for(;a.length>0;){const e=a.pop(),t=n.get(e);for(const i of t.children)!n.has(i.name)||o.has(i.name)||(o.add(i.name),a.push(i.name))}return e.filter((e=>o.has(e.name)))}(p,l);return function(e,t){const n=new Map(e.map(((e,t)=>[e.name,t]))),a=new Set(t.map((e=>e.name))),o=e=>a.has("string"==typeof e?e:e.name),i=new Set(e.map((e=>e.name))),r=e=>i.has("string"==typeof e?e:e.name);for(const s of e){for(const e of s.children.filter(r)){if(!n.has(e.name))throw new hme("Child ".concat(e.name," of node ").concat(s.name," is unreachable."));if(n.get(s.name)>n.get(e.name))throw new hme("Node ".concat(s.name," is scheduled to run after its child ").concat(e.name,"."))}if(!o(s))for(const e of s.inputs){if(!n.has(e.name))throw new hme("Input ".concat(e.name," of node ").concat(s.name," is unreachable."));if(n.get(e.name)>n.get(s.name))throw new hme("Node ".concat(s.name," is scheduled to run before its input ").concat(e.name,"."))}}}(m,l),m}class hme extends Error{constructor(e){super("NodesExecutionOrderError: ".concat(e))}}const pme=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),mme=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),Ime=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Cme(e){return pme.has(e.op)}function fme(e){return mme.has(e.op)}function bme(e){return Ime.has(e.op)}class yme{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map((t=>e[t].map((e=>e.id))));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((e=>e.signatureKey||e.name))}get outputNodes(){return this._outputs.map((e=>{const t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}get functions(){return Object.keys(this._functions).reduce(((e,t)=>(e[t]=this._functions[t].signature,e)),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach((t=>{this._functionExecutorMap[t]=new yme(e.functions[t],this)}))}getCompilationKey(e,t){const n=e.map((e=>e.name)).sort(),a=t.map((e=>e.name)).sort();return n.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)}compile(e,t){const n=ume(e,t,this.weightMap,this._initNodes),{missingInputs:a,dynamicNode:o,syncInputs:i}=n;if(null!=o)throw new Error("This execution contains the node '".concat(o.name,"', which has the dynamic op '").concat(o.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(a.length>0){const n=t.map((e=>e.name)),o=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(n,"] from the provided inputs [").concat(o,"]. Missing the following inputs: [").concat(a,"]"))}const r=dme(this.graph,n),s=function(e){const t=new Map(e.map(((e,t)=>[e.name,t]))),n=Number.MAX_SAFE_INTEGER,a=e.map(((e,t)=>Cme(e)?n:t)),o=e=>{const n=a[t.get(e.name)];return null!==n&&void 0!==n?n:-1},i=e.map(((e,t)=>e.children.map(o).reduce(((e,t)=>Math.max(e,t)),a[t]))),r=new Map;for(let s=0;s<e.length;++s){const t=i[s];if(t===n)continue;const a=e[s],o=e[t];r.has(o.name)||r.set(o.name,[]),r.get(o.name).push(a)}return r}(r);return{orderedNodes:r,nodeLiveUntilMap:s}}cloneAndKeepTensor(e){if(null==e)return null;const t=e.clone();return XJ(t),t}cloneTensorList(e){return e?e.map((e=>this.cloneAndKeepTensor(e))):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map((e=>{let[t,n]=e;return[t,this.cloneTensorList(n)]})))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const a=n.map((e=>this.graph.nodes[ppe(e)[0]])),o=t.map((e=>ppe(e)[0])),i=new Set(o);let r=o.map((e=>this.graph.nodes[e]));0===r.length&&(r=this._outputs);const s=this.getCompilationKey(a,r);let l=this.compiledMap.get(s);null==l&&(l=this.compile(e,r),this.compiledMap.set(s,l));try{this.keepIntermediateTensors=nM().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(u){this.keepIntermediateTensors=!1,console.warn(u.message)}const c={},g={};return VJ((()=>{const n=new gme(this.weightMap,c,g,this.functionExecutorMap,this.parseNodeNameCache),a=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach((t=>{const[o,i]=ppe(t,n),r=[];r[i]=e[t],a[o]=r,this.keepIntermediateTensors&&(this.clonedTensorsMap[o]=this.cloneTensorList(r))}));const o=this.getFrozenTensorIds(a),{orderedNodes:r,nodeLiveUntilMap:s}=l;for(const e of r){if(a[e.name])continue;const t=cme(e,a,n,this._resourceManager);if(qX(t))throw new Error("The execution of the op '".concat(e.op,"' returned a promise. Please use model.executeAsync() instead."));a[e.name]=t,this.keepIntermediateTensors&&(this.clonedTensorsMap[e.name]=this.cloneTensorList(t)),this.checkTensorForDisposalWithNodeLiveUntilInfo(e,a,n,o,i,s.get(e.name))}return null==this.parent&&n.dispose(o),t.map((e=>gpe(e,a,n)))}))}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map((t=>e[t])).map((e=>e.map((e=>e.id)))));return new Set(t)}checkTensorForDisposal(e,t,n,a,o,i,r){if(!Cme(t)&&!i.has(e)){for(const a of n[e])null!=a&&(r[a.id]=(r[a.id]||0)+t.children.length);for(const e of t.inputs){if(Cme(e))continue;const t=upe(e.name,n,a);if(null!=t)for(const e of t){if(!e||e.kept||o.has(e.id))continue;const t=r[e.id];1===t?(e.dispose(),delete r[e.id]):null!=t&&r[e.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,n,a,o,i){function r(e){return Cme(e)||o.has(e.name)}if(!Cme(e)&&null!=i)for(const s of i){if(r(s))continue;const e=upe(s.name,t,n);for(const t of e)!t||t.kept||a.has(t.id)||t.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()})),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=nM().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(u){this.keepIntermediateTensors=!1,console.warn(u.message)}const i=new gme(this.weightMap,a,o,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const r=await this.executeWithControlFlow(e,i,t,n),s=t.map((e=>gpe(e,r,i))),l=s.map((e=>e.id)),c=Object.keys(e).map((t=>e[t].id)),g=new Set([...l,...c,...this.weightIds]);return Object.values(r).forEach((e=>{e.forEach((e=>{e&&!e.isDisposed&&!g.has(e.id)&&e.dispose()}))})),null==this.parent&&i.dispose(g),s}async executeFunctionAsync(e,t,n){const a=e.reduce(((e,t,n)=>(e[this.inputs[n].name]=t,e)),{});return this._executeAsync(a,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,a){const o=Object.keys(e),i=o.map((e=>this.graph.nodes[ppe(e)[0]])),r=n.map((e=>ppe(e)[0])),s=new Set(r);let l=r.map((e=>this.graph.nodes[e]));0===l.length&&(l=this._outputs);const{usedNodes:c,missingInputs:g,dynamicNode:u,syncInputs:d}=ume(e,l,this.weightMap,this._initNodes),h=[...i,...this.graph.weights,...this._initNodes||[]].map((e=>({node:e,contexts:t.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(e).forEach((t=>{const[n,a]=ppe(t),o=[];o[a]=e[t],p[n]=o}));const m={},I=this.getFrozenTensorIds(p),C={};for(;h.length>0;){const e=this.processStack(i,h,t,p,C,I,s,m,c);await Promise.all(e)}null==u&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const f=l.filter((e=>!Cme(e)&&!gpe(e.name,p,t))).map((e=>e.name));if(f.length>0){let e="";throw null!=u&&(e="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(f,"] from the provided inputs [").concat(o,"]. Consider providing the following inputs: [").concat(g,"]. ").concat(e))}return p}processStack(e,t,n,a,o,i,r,s,l){const c=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let g="";if("Enter"===e.node.op&&cpe("isConstant",e.node,a,n)&&([g]=dpe(e.node.name,n)),null==a[e.node.name]){const u=cme(e.node,a,n,this._resourceManager);g||([g]=dpe(e.node.name,n));const d=n.currentContext;qX(u)?c.push(u.then((c=>(a[g]=c,this.keepIntermediateTensors&&(this.clonedTensorsMap[g]=this.cloneTensorList(c)),n.currentContext=d,this.checkTensorForDisposal(g,e.node,a,n,i,r,s),this.processChildNodes(e.node,t,n,a,o,l),c)))):(a[g]=u,this.keepIntermediateTensors&&(this.clonedTensorsMap[g]=this.cloneTensorList(u)),this.checkTensorForDisposal(g,e.node,a,n,i,r,s),this.processChildNodes(e.node,t,n,a,o,l))}else this.processChildNodes(e.node,t,n,a,o,l)}return c}processChildNodes(e,t,n,a,o,i){e.children.forEach((e=>{const[r]=dpe(e.name,n);o[r]||!i.has(e.name)||("Merge"===e.op?e.inputNames.some((e=>!!gpe(e,a,n)))&&(o[r]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((e=>!!gpe(e,a,n)))&&(o[r]=!0,t.push({contexts:n.currentContext,node:e})))}))}dispose(){Object.keys(this.weightMap).forEach((e=>this.weightMap[e].forEach((e=>e.dispose()))))}checkInputShapeAndType(e){Object.keys(e).forEach((t=>{const n=e[t],[a]=ppe(t),o=this.graph.nodes[a];if(o.attrParams.shape&&o.attrParams.shape.value){const e=o.attrParams.shape.value;IX(e.length===n.shape.length&&n.shape.every(((t,n)=>-1===e[n]||e[n]===t)),(()=>"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(e,"], but was [").concat(n.shape,"]")))}o.attrParams.dtype&&o.attrParams.dtype.value&&IX(n.dtype===o.attrParams.dtype.value,(()=>"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(n.dtype)))}))}mapInputs(e){var t,n;const a={};for(const o in e){const i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[o];null!=i?a[i.name]=e[o]:a[o]=e[o]}return a}checkInputs(e){const t=Object.keys(e).filter((e=>{const[t]=ppe(e);return null==this.graph.nodes[t]}));if(t.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(t,"] that are not part of graph"))}mapOutputs(e){return e.map((e=>{var t,n;const a=null===(n=null===(t=this._signature)||void 0===t?void 0:t.outputs)||void 0===n?void 0:n[e];return null!=a?a.name:e}),{})}checkOutputs(e){e.forEach((e=>{const[t]=ppe(e);if(!this.graph.nodes[t])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}class Ame{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}const vme="?tfjs-format=file",Sme="model.json";class xme{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nhe;this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,null==t&&(this.loadOptions={}),this.resourceManager=new Ame}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return qX(e)?e.then((e=>null==e.getWeightStream?this.loadSync(e):this.loadStreaming(e))):this.loadSync(e)}loadSync(e){const t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(null==e.getWeightStream)throw new Error("Model artifacts missing streamWeights function");const t=await DJ(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;const n=this.artifacts.modelTopology;let a=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){const e=this.artifacts.userDefinedMetadata;null!=e.signature&&(a=e.signature),null!=e.structuredOutputKeys&&(this.structuredOutputKeys=e.structuredOutputKeys)}if(this.signature=a,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer),this.executor=new yme(Tpe.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){const t=Tpe.Instance.transformGraph(e.modelInitializer);this.initializer=new yme(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if("string"==typeof e){const t=this.io.getSaveHandlers(e);if(0===t.length)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new Error("Found more than one (".concat(t.length,") save handlers for URL '").concat(e,"'"));e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t={};return(e instanceof YH?[e]:e).forEach(((e,n)=>t[this.structuredOutputKeys[n]]=e)),t}return e}predict(e,t){const n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){const n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof YH)&&!Array.isArray(e)){const n=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=n)for(const t in n){const a=n[t];null!=a.resourceId&&(e[t]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-n," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));let a=0;return this.inputNodes.reduce(((t,n)=>{var o,i,r;const s=null===(r=null===(i=null===(o=this.signature)||void 0===o?void 0:o.inputs)||void 0===i?void 0:i[n])||void 0===r?void 0:r.resourceId;return t[n]=null!=s?this.resourceIdToCapturedInput[s]:e[a++],t}),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,n=Object.keys(t);for(let a=0;a<n.length;a++){const o=t[n[a]];this.resourceIdToCapturedInput[o.resourceId]=e[a]}}}execute(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce(((t,n)=>(t[n]=[e[n]],t)),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&NJ(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}const Gme="4.16.0";class Zme extends M3{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split("\n").map((e=>(e.endsWith("\r")&&(e=e.slice(0,-1)),e)))}}const wme='"',kme=Symbol("out"),Bme=Symbol("field"),Rme=Symbol("quote"),Wme=Symbol("quoteafterquote"),Vme=Symbol("quoteinquote");class Nme extends M3{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&IX(e.length===this.fullColumnNames.length,(()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+").")),this.fullColumnNames||(this.fullColumnNames=e);const t=this.fullColumnNames.reduce(((e,t)=>(e[t]=e[t]+1||1,e)),{}),n=Object.keys(t).filter((e=>t[e]>1));if(IX(0===n.length,(()=>"Duplicate column names found: "+n.toString())),this.columnConfigs)for(const a of Object.keys(this.columnConfigs))if(-1===this.fullColumnNames.indexOf(a))throw new Error('The key "'+a+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const e=await(await this.base.iterator()).next();if(e.done)throw new Error("No data was found for CSV parsing.");const t=e.value;return this.parseRow(t,!1)}return null}constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new Zme(e),t||(t={}),this.hasHeader=!1!==t.hasHeader,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(IX(null==t.delimiter,(()=>"Delimiter should not be provided when delimWhitespace is true.")),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map((e=>this.makeDataElement(e)))}makeDataElement(e){const t=this.parseRow(e),n={},a={};for(let o=0;o<this.fullColumnNames.length;o++){const i=this.fullColumnNames[o],r=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||r){const s=t[o];let l=null;if(""===s)if(r&&void 0!==r.default)l=r.default;else{if(r&&(r.required||r.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));l=void 0}else{const e=Number(s);if(isNaN(e))l=r&&"bool"===r.dtype?this.getBoolean(s):s;else if(r&&r.dtype)switch(r.dtype){case"float32":default:l=e;break;case"int32":l=Math.floor(e);break;case"bool":l=this.getBoolean(s)}else l=e}r&&r.isLabel?a[i]=l:n[i]=l}}return 0===Object.keys(a).length?n:{xs:n,ys:a}}getBoolean(e){return"1"===e||"true"===e.toLowerCase()?1:0}parseRow(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=[];let a=0;const o=e.length;let i=kme;for(let r=0;r<o;r++)switch(i){case kme:switch(e.charAt(r)){case wme:a=r+1,i=Rme;break;case this.delimiter:if(a=r+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=kme;break;default:i=Bme,a=r}break;case Bme:if(e.charAt(r)===this.delimiter)n.push(e.substring(a,r)),i=kme,a=r+1;break;case Rme:if(e.charAt(r)===wme)i=Wme;break;case Wme:switch(e.charAt(r)){case this.delimiter:n.push(e.substring(a,r-1)),i=kme,a=r+1;break;case wme:i=Rme;break;default:i=Vme}break;case Vme:if(e.charAt(r)===wme)i=Rme}if(i===Wme?n.push(e.substring(a,o-1)):n.push(e.substring(a)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}class Xme extends f3{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const t=Math.log2(this.fftSize);if(this.fftSize<0||t<4||t>14||!Number.isInteger(t))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ".concat(this.fftSize));if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=!1!==e.includeSpectrogram,this.includeWaveform=!0===e.includeWaveform,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!nM().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const t=new Xme(e);return await t.start(),t}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})}catch(n){throw new Error("Error thrown while initializing video stream: ".concat(n.message))}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ").concat(this.audioContext.sampleRate))}else this.sampleRateHz=this.audioContext.sampleRate;const t=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,t.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,t;const n=await this.getAudioData();if(this.includeSpectrogram){const t=this.flattenQueue(n.freqDataQueue);e=this.getTensorFromAudioDataArray(t,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const e=this.flattenQueue(n.timeDataQueue);t=this.getTensorFromAudioDataArray(e,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:t},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],t=[];let n=0;return new Promise((a=>{const o=setInterval((()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&a({freqDataQueue:e,timeDataQueue:t}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),t.push(this.timeData.slice())),++n===this.numFrames&&(clearInterval(o),a({freqDataQueue:e,timeDataQueue:t}))}),this.fftSize/this.sampleRateHz*1e3)}))}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const t=e[0].length,n=new Float32Array(e.length*t);return e.forEach(((e,a)=>n.set(e,a*t))),n}getTensorFromAudioDataArray(e,t){const n=new Float32Array(bX(t));return n.set(e,n.length-e.length),wJ(n,t)}}class Mme extends f3{constructor(e,t){if(super(),this.webcamVideoElement=e,this.webcamConfig=t,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=ZD([0],"int32"),this.webcamConfig.centerCrop){const e=1*this.webcamConfig.resizeWidth/this.webcamVideoElement.width,t=1*this.webcamConfig.resizeHeight/this.webcamVideoElement.height,n=(1-e)/2,a=(1-t)/2,o=n+e,i=t+a;this.cropBox=wD([a,n,i,o],[1,4])}else this.cropBox=wD([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!nM().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!t.resizeWidth||!t.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=t.resizeWidth,e.height=t.resizeHeight}const n=new Mme(e,t);return await n.start(),n}async start(){this.webcamConfig.facingMode&&IX("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(()=>"Invalid webcam facing mode: ".concat(this.webcamConfig.facingMode,". Please provide 'user' or 'environment'")));try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(Pke){throw Pke.message="Error thrown while initializing video stream: ".concat(Pke.message),Pke}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(Pke){console.log(Pke),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise((e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}}))}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=VP(this.webcamVideoElement)}catch(t){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(t)))}if(!this.resize)return{value:e,done:!1};try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(t){throw new Error("Error thrown cropping the video: ".concat(t.message))}finally{e.dispose()}}needToResize(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}cropAndResizeFrame(e){return VJ((()=>{const t=Bz(XY(e,"float32"),0);let n;n=qU.cropAndResize(t,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const a=n.shape;return pL(n,a.slice(1))}))}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach((e=>e.stop()));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}class Tme{}class Eme extends f3{split(e){return new Fme(this,e)}}class Fme extends Eme{constructor(e,t){super(),this.upstream=e,this.impl=new Hme(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class Hme extends B3{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}async pump(){const e=await this.upstream.next();if(e.done)return""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0);const t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(const n of t.slice(0,-1))this.outputQueue.push(n);return this.carryover=t[t.length-1],!0}}class Jme extends f3{decodeUTF8(){return new Yme(this)}}class Yme extends Eme{constructor(e){super(),this.upstream=e,this.impl=new Lme(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class Lme extends B3{constructor(e){if(super(),this.upstream=e,nM().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:e}=require("string_decoder");this.decoder=new e("utf8")}}summary(){return"".concat(this.upstream.summary()," -> Utf8")}async pump(){const e=await this.upstream.next();let t,n;return!e.done&&(t=e.value,n=nM().get("IS_BROWSER")?this.decoder.decode(t,{stream:!0}):this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),!0)}}class zme extends Jme{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.file=e,this.options=t,IX(e instanceof Uint8Array||!!nM().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(()=>"FileChunkIterator only supports File, Blob and Uint8Array right now.")),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1048576}summary(){return"FileChunks ".concat(this.file)}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise(((e,t)=>{const n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)e(new Uint8Array(this.file.slice(this.offset,n)));else{const a=new FileReader;a.onload=n=>{let o=a.result;if(o instanceof ArrayBuffer&&(o=new Uint8Array(o)),!(o instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(o)},a.onabort=e=>t(new Error("Aborted")),a.onerror=e=>t(new Error(e.type));const o=this.file.slice(this.offset,n);a.readAsArrayBuffer(o)}this.offset=n})),done:!1}}}const Kme=e=>({method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity});function Dme(e){return"string"==typeof e&&"file://"===e.slice(0,7)}class Ume extends Tme{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.input=e,this.options=t}async iterator(){if(Dme(this.input)&&nM().get("IS_NODE")){const e=require("fs");this.input=e.readFileSync(this.input.slice(7))}return new zme(this.input,this.options)}}class Pme extends Tme{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.url=e,this.fileOptions=t}async iterator(){return Dme(this.url)?new Ume(this.url,this.fileOptions).iterator():async function(e){let t,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;"string"==typeof e?t=e:(t=e.url,n=Kme(e));const i=await(o||AH)(t,n);if(i.ok){const e=new Uint8Array(await i.arrayBuffer());return new zme(e,a)}throw new Error(i.statusText)}(this.url,this.fileOptions)}}const Ome="4.16.0",_me=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:Nme,Dataset:M3,FileDataSource:Ume,TextLineDataset:Zme,URLDataSource:Pme,array:function(e){return T3((async()=>I3(e)),e.length)},csv:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Nme(new Pme(e),t)},func:function(e){const t=C3(e);return T3((async()=>t))},generator:function(e){return T3((async()=>{const t=await e();return C3((()=>t.next()))}))},microphone:async function(e){return Xme.create(e)},version_data:Ome,webcam:async function(e,t){return Mme.create(e,t)},zip:function(e){if(!u3(e))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(e))for(let n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(const n in e)t=null==t?e[n].size:Math.min(t,e[n].size);return T3((async()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i3.FAIL;return new V3(e,t)}(await g3(e,(e=>{if(e instanceof M3)return{value:e.iterator(),recurse:!1};if(u3(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})),i3.SHORTEST)),t)}},Symbol.toStringTag,{value:"Module"})),Qme="4.16.0",jme="4.16.0",qme={"tfjs-core":The,"tfjs-backend-cpu":Qme,"tfjs-backend-webgl":jme,"tfjs-data":Ome,"tfjs-layers":A0,"tfjs-converter":Gme,tfjs:"4.16.0"},$me=Object.freeze(Object.defineProperty({__proto__:null,Abs:sM,Acos:lM,Acosh:cM,AdadeltaOptimizer:gP,AdagradOptimizer:uP,AdamOptimizer:dP,AdamaxOptimizer:hP,Add:gM,AddN:uM,All:dM,Any:hM,ArgMax:pM,ArgMin:mM,Asin:IM,Asinh:CM,Atan:fM,Atan2:yM,Atanh:bM,AvgPool:AM,AvgPool3D:SM,AvgPool3DGrad:xM,AvgPoolGrad:vM,BatchMatMul:GM,BatchToSpaceND:ZM,Bincount:wM,BitwiseAnd:kM,BroadcastArgs:RM,BroadcastTo:BM,Callback:npe,CallbackList:M$,Cast:WM,Ceil:VM,ClipByValue:NM,Complex:XM,ComplexAbs:MM,Concat:TM,Conv2D:EM,Conv2DBackpropFilter:FM,Conv2DBackpropInput:HM,Conv3D:JM,Conv3DBackpropFilterV2:YM,Conv3DBackpropInputV2:LM,Cos:zM,Cosh:KM,CropAndResize:PM,Cumprod:DM,Cumsum:UM,CustomCallback:F$,DataStorage:lX,DenseBincount:OM,DepthToSpace:_M,DepthwiseConv2dNative:QM,DepthwiseConv2dNativeBackpropFilter:jM,DepthwiseConv2dNativeBackpropInput:qM,Diag:$M,Dilation2D:eT,Dilation2DBackpropFilter:nT,Dilation2DBackpropInput:tT,Draw:aT,get ENV(){return oM},EarlyStopping:ipe,Einsum:iT,Elu:rT,EluGrad:sT,Environment:eM,Equal:cT,Erf:lT,Exp:gT,ExpandDims:uT,Expm1:dT,FFT:hT,Fill:pT,FlipLeftRight:mT,Floor:IT,FloorDiv:CT,FromPixels:mF,FusedBatchNorm:fT,FusedConv2D:fF,FusedDepthwiseConv2D:bF,GPGPUContext:Sne,GatherNd:yT,GatherV2:bT,GraphModel:xme,Greater:AT,GreaterEqual:vT,History:E$,IFFT:xT,Identity:ST,Imag:GT,InputSpec:i$,IsFinite:ZT,IsInf:wT,IsNan:kT,KernelBackend:cX,LRN:HT,LRNGrad:JT,LayerVariable:n$,LayersModel:J0,LeakyRelu:BT,Less:RT,LessEqual:WT,LinSpace:VT,Log:NT,Log1p:XT,LogSoftmax:FT,LogicalAnd:MT,LogicalNot:TT,LogicalOr:ET,LogicalXor:"LogicalXor",LowerBound:"LowerBound",MathBackendCPU:Y3,MathBackendWebGL:Uae,MatrixBandPart:"MatrixBandPart",Max:YT,MaxPool:zT,MaxPool3D:DT,MaxPool3DGrad:UT,MaxPoolGrad:KT,MaxPoolWithArgmax:PT,Maximum:LT,Mean:OT,Min:_T,Minimum:QT,MirrorPad:jT,Mod:qT,MomentumOptimizer:mP,Multinomial:$T,Multiply:eE,Neg:tE,NonMaxSuppressionV3:aE,NonMaxSuppressionV4:oE,NonMaxSuppressionV5:iE,NotEqual:nE,OP_SCOPE_SUFFIX:SJ,OneHot:sE,OnesLike:rE,Optimizer:cP,OptimizerConstructors:eO,Pack:lE,PadV2:cE,Pool:"Pool",Pow:gE,Prelu:uE,Prod:dE,RMSPropOptimizer:IP,RNN:J1,RaggedGather:hE,RaggedRange:pE,RaggedTensorToTensor:mE,Range:IE,get Rank(){return KH},Real:CE,RealDiv:oT,Reciprocal:fE,get Reduction(){return VU},Relu:bE,Relu6:GE,Reshape:yE,ResizeBilinear:SE,ResizeBilinearGrad:xE,ResizeNearestNeighbor:AE,ResizeNearestNeighborGrad:vE,Reverse:ZE,RotateWithOffset:IF,Round:wE,Rsqrt:kE,SGDOptimizer:pP,ScatterNd:BE,SearchSorted:WE,Select:VE,Selu:NE,Sequential:L0,Sigmoid:FE,Sign:EE,Sin:ME,Sinh:TE,Slice:XE,Softmax:KE,Softplus:HE,SpaceToBatchND:LE,SparseFillEmptyRows:DE,SparseReshape:UE,SparseSegmentMean:PE,SparseSegmentSum:OE,SparseToDense:_E,SplitV:zE,Sqrt:JE,Square:jE,SquaredDifference:QE,StaticRegexReplace:qE,Step:pF,StridedSlice:$E,StringNGrams:eF,StringSplit:tF,StringToHashBucketFast:nF,Sub:aF,Sum:YE,SymbolicTensor:r$,Tan:oF,Tanh:iF,Tensor:YH,TensorBuffer:FH,TensorScatterUpdate:RE,Tile:rF,TopK:sF,Transform:lF,Transpose:cF,Unique:gF,Unpack:uF,UnsortedSegmentSum:dF,UpperBound:"UpperBound",Variable:zH,ZerosLike:hF,_FusedMatMul:CF,abs:YY,acos:LY,acosh:zY,add:EY,addN:Bde,all:KY,any:DY,argMax:UY,argMin:PY,asin:OY,asinh:_Y,atan:QY,atan2:jY,atanh:qY,avgPool:mL,avgPool3d:IL,backend:EJ,backend_util:g_,basicLSTMCell:Rde,batchNorm:xL,batchNorm2d:GL,batchNorm3d:ZL,batchNorm4d:wL,batchToSpaceND:vL,bincount:kL,bitwiseAnd:Wde,booleanMaskAsync:fhe,broadcastArgs:Vde,broadcastTo:BL,broadcast_util:tz,browser:NP,buffer:NY,callbacks:rpe,cast:XY,ceil:RL,clipByValue:VL,clone:MY,complex:GJ,concat:CL,concat1d:NL,concat2d:XL,concat3d:ML,concat4d:TL,constraints:Fhe,conv1d:FL,conv2d:EL,conv2dTranspose:JL,conv3d:YL,conv3dTranspose:zL,copyRegisteredKernels:function(e,t){GF(e).forEach((e=>{ZF(Object.assign({},e,{backendName:t}))}))},cos:KL,cosh:DL,cosineWindow:zD,cumprod:UL,cumsum:PL,customGrad:Oz,data:_me,denseBincount:OL,deprecationWarn:function(e){nM().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},depthToSpace:_L,depthwiseConv2d:QL,deregisterOp:function(e){delete spe[e]},device_util:IJ,diag:Nde,dilation2d:jL,disableDeprecationWarnings:function(){nM().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},dispose:NJ,disposeVariables:function(){uJ.disposeVariables()},div:HY,divNoNan:iz,dot:rz,dropout:YD,einsum:sz,elu:lz,enableDebugMode:function(){nM().set("DEBUG",!0)},enableProdMode:function(){nM().set("PROD",!0)},enclosingPowerOfTwo:LD,engine:RJ,ensureShape:Xde,env:nM,equal:nz,erf:cz,euclideanNorm:wz,exp:kz,expandDims:Bz,expm1:Rz,eye:Vz,fft:mD,fill:WL,findBackend:function(e){return uJ.findBackend(e)},findBackendFactory:function(e){return uJ.findBackendFactory(e)},floor:Nz,floorDiv:FY,forceHalfFloat:Pae,fused:Ghe,gather:Xz,gatherND:vhe,gather_util:MP,getBackend:MJ,getGradient:xF,getKernel:SF,getKernelsForBackend:GF,gpgpu_util:vne,grad:function(e){return IX(JX(e),(()=>"The f passed in grad(f) must be a function")),(t,n)=>{const a=AJ(t,"x","tf.grad","string_or_numeric"),o=null!=n?AJ(n,"dy","tf.grad"):null;return uJ.tidy((()=>{const{value:t,grads:n}=uJ.gradients((()=>e(a)),[a],o);return null!=o&&CX(t.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),_z(n),n[0]}))}},grads:function(e){return IX(JX(e),(()=>"The f passed in grads(f) must be a function")),(t,n)=>{IX(Array.isArray(t),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const a=vJ(t,"args","tf.grads","string_or_numeric"),o=null!=n?AJ(n,"dy","tf.grads"):null;return uJ.tidy((()=>{const{value:t,grads:n}=uJ.gradients((()=>e(...a)),a,o);return null!=o&&CX(t.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),_z(n),n}))}},greater:Mz,greaterEqual:Tz,ifft:ID,imag:Ez,image:qU,inTopKAsync:She,initializers:Hhe,input:Jhe,io:Nhe,irfft:CD,isFinite:Fz,isInf:Hz,isNaN:Jz,keep:XJ,kernel_impls:Ehe,layers:qhe,leakyRelu:Yz,less:Lz,lessEqual:zz,linalg:$U,linspace:Mde,loadGraphModel:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nhe;if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==t&&(t={}),t.fromTFHub&&"string"==typeof e&&(e=function(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat(Sme).concat(vme)}(e));const a=new xme(e,t,n);return await a.load(),a},loadGraphModelSync:function(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let t;if(e instanceof Array){const[n,a]=e;if(!n)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");t=Vhe(qJ(n,tY(n.weightsManifest),a))}else if("load"in e)t=e;else{if(!("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e))throw new Error("Unknown model format");t=Vhe(e)}const n=new xme(t);return n.load(),n},loadLayersModel:async function(e,t){if(null==t&&(t={}),"string"==typeof e){const n=oY(e,t);if(0===n.length)n.push(ZP(e,t));else if(n.length>1)throw new Ij("Found more than one (".concat(n.length,") load handlers for URL '").concat(e,"'"));e=n[0]}return async function(e,t,n){if(null==n&&(n={}),null==e.load)throw new Ij("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const a=await e.load();let o=a.modelTopology;null!=o.model_config&&(o=o.model_config);const i=null==n.strict||n.strict,r=null!=a.weightData&&null!=a.weightSpecs&&i,s=L$(b0(o),t,r),l=a.trainingConfig;if(null!=l&&s.loadTrainingConfig(l),null!=a.userDefinedMetadata&&s.setUserDefinedMetadata(a.userDefinedMetadata),null!=a.weightData){if(null==a.weightSpecs)throw new Ij("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:e,optimizerWeights:t}=function(e,t){const n=JJ(e,t),a={},o=[];return t.forEach((e=>{"optimizer"===e.group?o.push({name:e.name,tensor:n[e.name]}):a[e.name]=n[e.name]})),{modelWeights:a,optimizerWeights:o}}(a.weightData,a.weightSpecs);s.loadWeights(e,i),null!=s.optimizer&&t.length>0&&await s.optimizer.setWeights(t),NJ(e),NJ(t.map((e=>e.tensor)))}return s}(e,void 0,t)},localResponseNormalization:Kz,log:Dz,log1p:Uz,logSigmoid:qz,logSoftmax:eK,logSumExp:tK,logicalAnd:nK,logicalNot:aK,logicalOr:oK,logicalXor:iK,losses:eP,lowerBound:Fde,matMul:fL,math:Mhe,max:fz,maxPool:rK,maxPool3d:sK,maxPoolWithArgmax:Hde,maximum:lK,mean:cK,memory:WJ,meshgrid:Jde,metrics:$he,min:bz,minimum:dK,mirrorPad:hK,mod:pK,model:function(e){return new J0(e)},models:epe,moments:mK,movingAverage:bhe,mul:JY,multiRNNCell:Yde,multinomial:Lde,neg:Qz,nextFrame:aO,norm:Zz,notEqual:IK,oneHot:CK,ones:uK,onesLike:fK,op:xJ,outerProduct:zde,pad:bK,pad1d:Kde,pad2d:Dde,pad3d:Ude,pad4d:Pde,pool:AK,pow:yz,prelu:vK,print:TY,prod:SK,profile:function(e){return uJ.profile(e)},raggedGather:Ode,raggedRange:_de,raggedTensorToTensor:Qde,rand:jde,randomGamma:ohe,randomNormal:_K,randomStandardNormal:ihe,randomUniform:QK,randomUniformInt:rhe,range:jK,ready:function(){return uJ.ready()},real:qK,reciprocal:$K,registerBackend:TJ,registerCallbackConstructor:function(e,t){J$.registerCallbackConstructor(e,t)},registerGradient:wF,registerKernel:ZF,registerOp:function(e,t){const n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};spe[e]=n},regularizers:tpe,relu:eD,relu6:tD,removeBackend:function(e){uJ.removeBackend(e)},reshape:pL,reverse:nD,reverse1d:she,reverse2d:lhe,reverse3d:che,reverse4d:ghe,rfft:bD,round:aD,rsqrt:oD,scalar:Az,scatterND:yhe,scatter_util:VD,searchSorted:Ede,selu:iD,separableConv2d:rD,sequential:function(e){return new L0(e)},serialization:lP,setBackend:function(e){return uJ.setBackend(e)},setPlatform:function(e,t){nM().setPlatform(e,t)},setWebGLContext:vee,setdiff1dAsync:uhe,shared:p4,sigmoid:bL,sign:sD,signal:jU,sin:lD,sinh:cD,slice:yL,slice1d:gD,slice2d:uD,slice3d:dD,slice4d:hD,slice_util:$P,softmax:pD,softplus:jz,spaceToBatchND:yK,sparse:tP,sparseToDense:Ahe,spectral:QU,split:fD,sqrt:vz,square:Sz,squaredDifference:yD,squeeze:AD,stack:vD,step:SD,stridedSlice:xD,string:nP,sub:$z,sum:xz,sumOutType:qH,tan:GD,tanh:AL,tensor:wJ,tensor1d:ZD,tensor2d:wD,tensor3d:kD,tensor4d:dhe,tensor5d:hhe,tensor6d:phe,tensorScatterUpdate:mhe,tensor_util:rJ,test_util:ahe,tidy:VJ,tile:Wz,time:function(e){return uJ.time(e)},topk:ND,train:tO,transpose:JD,truncatedNormal:XD,unique:MD,unregisterGradient:function(e){if(!vF.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));vF.delete(e)},unregisterKernel:function(e,t){const n=kF(e,t);if(!AF.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));AF.delete(n)},unsortedSegmentSum:TD,unstack:ED,upcastType:jH,upperBound:Ihe,util:ZH,valueAndGrad:function(e){return IX(JX(e),(()=>"The f passed in valueAndGrad(f) must be a function")),(t,n)=>{IX(t instanceof YH,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),IX(null==n||n instanceof YH,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:a,value:o}=uJ.gradients((()=>e(t)),[t],n);return _z(a),{grad:a[0],value:o}}},valueAndGrads:function(e){return IX(JX(e),(()=>"The f passed in valueAndGrads(f) must be a function")),(t,n)=>{IX(Array.isArray(t)&&t.every((e=>e instanceof YH)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),IX(null==n||n instanceof YH,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const a=uJ.gradients((()=>e(...t)),t,n);return null!=n&&CX(a.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),_z(a.grads),a}},variable:FD,variableGrads:Pz,version:qme,version_converter:Gme,version_core:The,version_cpu:Qme,version_layers:A0,version_webgl:jme,webgl:Oae,webgl_util:vte,where:az,whereAsync:Che,zeros:gK,zerosLike:oz},Symbol.toStringTag,{value:"Module"})),eIe=new GS;eIe.compose(new _v,new Ov,new _v(.001,.001,.001));const tIe=(new GS).set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);class nIe{constructor(e){let{container:t,imageTargetSrc:n,maxTrack:a,uiLoading:o="yes",uiScanning:i="yes",uiError:r="yes",filterMinCF:s=null,filterBeta:l=null,warmupTolerance:c=null,missTolerance:g=null,userDeviceId:u=null,environmentDeviceId:d=null}=e;this.container=t,this.imageTargetSrc=n,this.maxTrack=a,this.filterMinCF=s,this.filterBeta=l,this.warmupTolerance=c,this.missTolerance=g,this.ui=new rX({uiLoading:o,uiScanning:i,uiError:r}),this.userDeviceId=u,this.environmentDeviceId=d,this.shouldFaceUser=!1,this.scene=new gk,this.cssScene=new gk,this.renderer=new rk({antialias:!0,alpha:!0}),this.cssRenderer=new kde({antialias:!0}),this.renderer.outputEncoding=vA,this.renderer.setPixelRatio(window.devicePixelRatio),this.camera=new IG,this.anchors=[],this.renderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.position="absolute",this.container.appendChild(this.renderer.domElement),this.container.appendChild(this.cssRenderer.domElement),window.addEventListener("resize",this.resize.bind(this))}async start(){this.ui.showLoading(),await this._startVideo(),await this._startAR()}stop(){this.controller.stopProcessVideo(),this.video.srcObject.getTracks().forEach((function(e){e.stop()})),this.video.remove()}switchCamera(){this.shouldFaceUser=!this.shouldFaceUser,this.stop(),this.start()}addAnchor(e){const t=new qw;t.visible=!1,t.matrixAutoUpdate=!1;const n={group:t,targetIndex:e,onTargetFound:null,onTargetLost:null,onTargetUpdate:null,css:!1,visible:!1};return this.anchors.push(n),this.scene.add(t),n}addCSSAnchor(e){const t=new qw;t.visible=!1,t.matrixAutoUpdate=!1;const n={group:t,targetIndex:e,onTargetFound:null,onTargetLost:null,onTargetUpdate:null,css:!0,visible:!1};return this.anchors.push(n),this.cssScene.add(t),n}_startVideo(){return new Promise(((e,t)=>{if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return this.ui.showCompatibility(),void t();const n={audio:!1,video:{}};this.shouldFaceUser?this.userDeviceId?n.video.deviceId={exact:this.userDeviceId}:n.video.facingMode="user":this.environmentDeviceId?n.video.deviceId={exact:this.environmentDeviceId}:n.video.facingMode="environment",navigator.mediaDevices.getUserMedia(n).then((t=>{this.video.addEventListener("loadedmetadata",(()=>{this.video.setAttribute("width",this.video.videoWidth),this.video.setAttribute("height",this.video.videoHeight),e()})),this.video.srcObject=t})).catch((e=>{console.log("getUserMedia error",e),t()}))}))}_startAR(){return new Promise((async(e,t)=>{const n=this.video;this.container,this.controller=new vde({inputWidth:n.videoWidth,inputHeight:n.videoHeight,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,warmupTolerance:this.warmupTolerance,missTolerance:this.missTolerance,maxTrack:this.maxTrack,onUpdate:e=>{if("updateMatrix"===e.type){const{targetIndex:t,worldMatrix:n}=e;for(let e=0;e<this.anchors.length;e++)if(this.anchors[e].targetIndex===t){if(this.anchors[e].css?this.anchors[e].group.children.forEach((e=>{e.element.style.visibility=null===n?"hidden":"visible"})):this.anchors[e].group.visible=null!==n,null!==n){let a=new GS;a.elements=[...n],a.multiply(this.postMatrixs[t]),this.anchors[e].css&&a.multiply(eIe),this.anchors[e].group.matrix=a}else this.anchors[e].group.matrix=tIe;this.anchors[e].visible&&null===n&&(this.anchors[e].visible=!1,this.anchors[e].onTargetLost&&this.anchors[e].onTargetLost()),!this.anchors[e].visible&&null!==n&&(this.anchors[e].visible=!0,this.anchors[e].onTargetFound&&this.anchors[e].onTargetFound()),this.anchors[e].onTargetUpdate&&this.anchors[e].onTargetUpdate()}this.anchors.reduce(((e,t)=>e||t.visible),!1)?this.ui.hideScanning():this.ui.showScanning()}}}),this.resize();const{dimensions:a}=await this.controller.addImageTargets(this.imageTargetSrc);this.postMatrixs=[];for(let o=0;o<a.length;o++){const e=new _v,t=new Ov,n=new _v,[i,r]=a[o];e.x=i/2,e.y=i/2+(r-i)/2,n.x=i,n.y=i,n.z=i;const s=new GS;s.compose(e,t,n),this.postMatrixs.push(s)}await this.controller.dummyRun(this.video),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video),e()}))}resize(){const{renderer:e,cssRenderer:t,camera:n,container:a,video:o}=this;if(!o)return;let i,r;this.video.setAttribute("width",this.video.videoWidth),this.video.setAttribute("height",this.video.videoHeight);const s=o.videoWidth/o.videoHeight,l=a.clientWidth/a.clientHeight;s>l?(r=a.clientHeight,i=r*s):(i=a.clientWidth,r=i/s);const c=this.controller.getProjectionMatrix(),g=this.controller.inputWidth/this.controller.inputHeight;let u,d,h;u=g>l?this.video.width/this.controller.inputWidth:this.video.height/this.controller.inputHeight,g>l?(d=a.clientHeight,d*=u):(h=a.clientWidth,d=h/this.controller.inputWidth*this.controller.inputHeight,d*=u);let p=a.clientHeight/d;const m=2*Math.atan(1/c[5]*p)*180/Math.PI,I=c[14]/(c[10]-1),C=c[14]/(c[10]+1);c[5],c[0],n.fov=m,n.near=I,n.far=C,n.aspect=a.clientWidth/a.clientHeight,n.updateProjectionMatrix(),o.style.top=-(r-a.clientHeight)/2+"px",o.style.left=-(i-a.clientWidth)/2+"px",o.style.width=i+"px",o.style.height=r+"px";const f=e.domElement,b=t.domElement;f.style.position="absolute",f.style.left=0,f.style.top=0,f.style.width=a.clientWidth+"px",f.style.height=a.clientHeight+"px",b.style.position="absolute",b.style.left=0,b.style.top=0,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px",e.setSize(a.clientWidth,a.clientHeight),t.setSize(a.clientWidth,a.clientHeight)}}window.MINDAR||(window.MINDAR={}),window.MINDAR.IMAGE||(window.MINDAR.IMAGE={}),window.MINDAR.IMAGE.MindARThree=nIe,window.MINDAR.IMAGE.tf=$me;const aIe=t=>{let{imageTargetSrc:n,onTargetFound:o,onTargetLost:i,renderARContent:r,isEnabled:s}=t;const l=(0,a.useRef)(null),[c,g]=(0,a.useState)(null),[u,d]=(0,a.useState)(null);return(0,a.useEffect)((()=>{if(!s||!l.current)return;return(async()=>{try{const t=new nIe({container:l.current,imageTargetSrc:n,uiLoading:"yes",uiScanning:"no",uiError:"yes"}),{renderer:a,scene:s,camera:c}=t,u=t.addAnchor(0);u.onTargetFound=()=>{o&&o()},u.onTargetLost=()=>{i&&i()},await t.start(),a.setAnimationLoop((()=>{a.render(s,c)})),g(t),r&&r(s,e)}catch(u){console.error("Error initializing AR:",u),d("AR \u521d\u59cb\u5316\u5931\u6557\u3002\u8acb\u6aa2\u67e5\u60a8\u7684\u8a2d\u5099\u662f\u5426\u652f\u63f4 AR \u6216\u5237\u65b0\u9801\u9762\u91cd\u8a66\u3002")}})(),()=>{c&&(c.renderer.setAnimationLoop(null),c.stop())}}),[n,o,i,s,r]),u?(0,Cc.jsx)("div",{className:"error-message",children:u}):(0,Cc.jsx)("div",{ref:l,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:1}})},oIe=n.p+"static/media/\u8fa8\u8b58\u5716_\u963f\u516c\u7684\u7bb1\u5b50.4b5022ab44acbad61a0e.mind";var iIe=n(3901);const rIe=()=>(0,Cc.jsx)("div",{style:{textAlign:"center"},children:[{value:"story:5",label:"\u7b2c\u4e00\u7ae0\u6545\u4e8b-1",url:"/?dialogIndex=5"}].map(((e,t)=>(0,Cc.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,Cc.jsx)("h3",{children:e.label}),(0,Cc.jsx)(iIe.Ay,{value:"".concat("https://sanmingmemoryjourney.com").concat(e.url),size:150})]},t)))});var sIe=n(1757);const lIe=()=>{const[e,t]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!1),[s,l]=(0,a.useState)(!0),c=(0,a.useRef)(null),g=(0,a.useCallback)((()=>t(!0)),[]),u=(0,a.useCallback)((()=>o(!0)),[]),d=(0,a.useCallback)((()=>{c.current&&c.current.submit()}),[]),h=(0,a.useCallback)(((e,t)=>{const n=new t.BoxGeometry(1,1,1),a=new t.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),o=new t.Mesh(n,a);e.add(o)}),[]),p=(0,a.useCallback)((e=>{e&&(r(!1),l(!0),e.includes("dialogIndex=5")&&(t(!0),o(!0)))}),[]),m=(0,a.useCallback)((e=>{console.error(e)}),[]),I=(0,a.useCallback)((()=>{l(!1),r(!0)}),[]);return(0,Cc.jsxs)("div",{className:"container1",children:[s&&(0,Cc.jsx)(aIe,{imageTargetSrc:oIe,onTargetFound:g,renderARContent:h,isEnabled:!0}),i&&(0,Cc.jsx)(sIe.QrReader,{delay:300,onError:m,onScan:p,style:{width:"100%"}}),e&&(0,Cc.jsx)("div",{className:"buttonContainer",children:n?(0,Cc.jsx)("div",{className:"centered-content",children:(0,Cc.jsx)("button",{className:"endButton",onClick:d,children:"\u7d50\u675f\u904a\u6232"})}):(0,Cc.jsx)("button",{className:"foundButton",onClick:u,children:"\u627e\u5230\u4e86"})}),(0,Cc.jsx)("form",{ref:c,action:"/",method:"GET",style:{display:"none"},children:(0,Cc.jsx)("input",{type:"hidden",name:"dialogIndex",value:"5"})}),(0,Cc.jsx)(rIe,{}),(0,Cc.jsx)("div",{className:"qr-button-container",children:(0,Cc.jsx)("button",{onClick:I,className:"qr-scan-button",children:"\u6383\u63cfQR Code"})})]})},cIe=n.p+"static/media/DIY\u76f8\u6a5f\u6559\u5b78\u5716-01.410ccfd9697174477613.png",gIe=()=>{const[e,t]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!1),s=q();(0,a.useEffect)((()=>{let t;return e&&(t=setTimeout((()=>{o(!0)}),9e4)),()=>clearTimeout(t)}),[e]);return(0,Cc.jsx)("div",{className:"container2",children:(0,Cc.jsxs)("div",{className:"content2",children:[!e&&!i&&(0,Cc.jsx)("button",{className:"assembleButton2",onClick:()=>{t(!0),o(!1),r(!1)},children:"\u958b\u59cb\u4fee\u76f8\u6a5f"}),e&&(0,Cc.jsxs)(Cc.Fragment,{children:[(0,Cc.jsx)("img",{src:cIe,alt:"\u7d44\u88dd\u76f8\u6a5f\u8aaa\u660e\u5716",className:"assemblyImage2"}),n&&(0,Cc.jsx)("button",{className:"finishButton2",onClick:()=>{t(!1),o(!1),r(!0)},children:"\u4fee\u597d\u4e86"})]}),i&&(0,Cc.jsx)("button",{className:"endButton2",onClick:()=>{s("/?dialogIndex=10")},children:"\u8a18\u5f97\u627e\u5c0e\u89bd\u4eba\u54e1\u62ff\u76f8\u7247\u5594!"})]})})};const uIe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M842 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1zM512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm-94-392c0-50.6 41.9-92 94-92s94 41.4 94 92v224c0 50.6-41.9 92-94 92s-94-41.4-94-92V232z"}}]},name:"audio",theme:"outlined"};var dIe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:uIe}))};const hIe=a.forwardRef(dIe);const pIe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M682 455V311l-76 76v68c-.1 50.7-42 92.1-94 92a95.8 95.8 0 01-52-15l-54 55c29.1 22.4 65.9 36 106 36 93.8 0 170-75.1 170-168z"}},{tag:"path",attrs:{d:"M833 446h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254-63 0-120.7-23-165-61l-54 54a334.01 334.01 0 00179 81v102H326c-13.9 0-24.9 14.3-25 32v36c.1 4.4 2.9 8 6 8h408c3.2 0 6-3.6 6-8v-36c0-17.7-11-32-25-32H547V782c165.3-17.9 294-157.9 294-328 0-4.4-3.6-8-8-8zm13.1-377.7l-43.5-41.9a8 8 0 00-11.2.1l-129 129C634.3 101.2 577 64 511 64c-93.9 0-170 75.3-170 168v224c0 6.7.4 13.3 1.2 19.8l-68 68A252.33 252.33 0 01258 454c-.2-4.4-3.8-8-8-8h-60c-4.4 0-8 3.6-8 8 0 53 12.5 103 34.6 147.4l-137 137a8.03 8.03 0 000 11.3l42.7 42.7c3.1 3.1 8.2 3.1 11.3 0L846.2 79.8l.1-.1c3.1-3.2 3-8.3-.2-11.4zM417 401V232c0-50.6 41.9-92 94-92 46 0 84.1 32.3 92.3 74.7L417 401z"}}]},name:"audio-muted",theme:"outlined"};var mIe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:pIe}))};const IIe=a.forwardRef(mIe),CIe=n.p+"static/media/alert.ddd3d113fa7232489f8e.mp3",fIe=()=>{const[e,t]=(0,a.useState)({step:1,inputValue:"",isCorrect:!1,showFindFragmentButton:!1,showPuzzleButton:!1,showGuideMessage:!1,showFinalButton:!1,isAlertPlaying:!1}),n=q(),o=(0,a.useRef)(null),i=()=>{t((e=>({...e,step:e.step+1,showFindFragmentButton:!1,showPuzzleButton:!1})))};(0,a.useEffect)((()=>(o.current=new Audio(CIe),o.current.loop=!0,()=>{var e;null===(e=o.current)||void 0===e||e.pause(),o.current.currentTime=0})),[]),(0,a.useEffect)((()=>{let n;return 1===e.step?n=setTimeout((()=>{t((e=>({...e,showFindFragmentButton:!0})))}),9e3):2===e.step&&(n=setTimeout((()=>{t((e=>({...e,showPuzzleButton:!0})))}),3e3)),()=>clearTimeout(n)}),[e.step]);const{step:r,inputValue:s,isCorrect:l,showFindFragmentButton:c,showPuzzleButton:g,showGuideMessage:u,showFinalButton:d,isAlertPlaying:h}=e;return(0,Cc.jsxs)("div",{className:"container3",children:[(0,Cc.jsx)("div",{className:"alert-toggle",onClick:()=>{e.isAlertPlaying?o.current.pause():o.current.play().catch((e=>{console.error("Audio playback was prevented:",e)})),t((e=>({...e,isAlertPlaying:!e.isAlertPlaying})))},children:h?(0,Cc.jsx)(hIe,{}):(0,Cc.jsx)(IIe,{})}),1===r&&(0,Cc.jsxs)("div",{className:"content3",children:[(0,Cc.jsx)("p",{className:"text3",children:"\u5c0f\u670b\u53cb\u5011! \u5feb\u5230\u9632\u7a7a\u6d1e\u65c1\u908a\u4ed4\u7d30\u627e\u627e\u770b\uff0c\u6709\u6c92\u6709\u751a\u9ebc\u89e3\u9664\u8b66\u5831\u7684\u65b9\u5f0f"}),c&&(0,Cc.jsx)("button",{className:"button3",onClick:i,children:"\u627e\u5230\u788e\u7247\u4e86"})]}),2===r&&(0,Cc.jsxs)("div",{className:"content3",children:[(0,Cc.jsx)("p",{className:"text3",children:"\u5c07\u627e\u5230\u7684\u788e\u7247\u62fc\u62fc\u770b\u5427!"}),g&&(0,Cc.jsx)("button",{className:"button3",onClick:i,children:"\u62fc\u597d\u4e86"})]}),3===r&&(0,Cc.jsxs)("div",{className:"content3",children:[(0,Cc.jsx)("input",{type:"text",placeholder:"\u8acb\u8f38\u5165\u7b54\u6848",value:s,onChange:e=>{const n=e.target.value;t((e=>({...e,inputValue:n,isCorrect:"\u4e8c\u6b21\u4e16\u754c\u5927\u6230"===n})))},className:"input3"}),l&&(0,Cc.jsx)("button",{className:"button3 endButton3",onClick:()=>{var e;null===(e=o.current)||void 0===e||e.pause(),o.current.currentTime=0,t((e=>({...e,showGuideMessage:!0,step:4}))),setTimeout((()=>{t((e=>({...e,showFinalButton:!0})))}),3600)},children:"\u7b54\u5c0d\u4e86"})]}),4===r&&u&&(0,Cc.jsxs)("div",{className:"content3",children:[(0,Cc.jsx)("p",{className:"text3",children:"\u8a18\u5f97\u627e\u5c0e\u89bd\u4eba\u54e1\u62ff\u76f8\u7247\u5594!"}),d&&(0,Cc.jsx)("button",{className:"button3 finalButton3",onClick:()=>{n("/?dialogIndex=22")},children:"\u62b5\u9054\u7cd6\u5ee0\u5bbf\u820d\u5340"})]})]})};const bIe={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"};var yIe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:bIe}))};const AIe=a.forwardRef(yIe);const vIe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"};var SIe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:vIe}))};const xIe=a.forwardRef(SIe),GIe=n.p+"static/media/\u5730\u5716\u6b63\u9762.25ec359eeca0b66d2a1c.jpg",ZIe=n.p+"static/media/\u5730\u5716\u53cd\u9762.ffddf20a9bdd6f16c163.jpg",wIe=n.p+"static/media/3-1.910c26e0b144d3c3d581.mp3",kIe=n.p+"static/media/3-2.9527e0c9cc42d6c3ebdb.mp3",BIe=n.p+"static/media/3-3.5192d86a36864597732e.mp3",RIe=()=>{const[e,t]=(0,a.useState)(""),[n,o]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!0),[s,l]=(0,a.useState)(!0),[c,g]=(0,a.useState)(!1),[u,d]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),m=q(),[I,C]=yf({isModalVisible:!1}),{isModalVisible:f}=I,b=(0,a.useMemo)((()=>[wIe,kIe,BIe]),[]),y=(0,a.useCallback)((e=>{if(h)return;p(!0);const t=new Audio(b[e]);t.play(),t.onended=()=>{p(!1),1===e&&A()}}),[h,b]),A=(0,a.useCallback)((()=>{"\u624b\u6c34\u820d"===e&&o(!0)}),[e]),v=(0,a.useCallback)((()=>{g(!0),setTimeout((()=>{d(!0)}),3e3)}),[]),S=(0,a.useCallback)((()=>{m("/?dialogIndex=37")}),[m]),x=(0,a.useCallback)((()=>{r((e=>!e))}),[]),G=(0,a.useCallback)((()=>{l((e=>!e))}),[]),Z=(0,a.useCallback)((()=>{C((e=>({...e,isModalVisible:!0})))}),[C]),w=(0,a.useCallback)((()=>{C((e=>({...e,isModalVisible:!1})))}),[C]);return(0,Cc.jsxs)("div",{className:"container4",children:[(0,Cc.jsx)(vf,{isVisible:f,showModal:Z,handleModalCancel:w}),(0,Cc.jsxs)("div",{className:"mapContainer",children:[(0,Cc.jsx)("div",{className:"audioButtonsContainer",children:b.map(((e,t)=>(0,Cc.jsx)("button",{className:"audioButton",onClick:()=>y(t),disabled:h,children:(0,Cc.jsx)(hIe,{})},t)))}),(0,Cc.jsxs)("div",{className:"mapImageContainer",children:[(0,Cc.jsx)("img",{src:i?GIe:ZIe,alt:"\u5730\u5716\u5716\u7247",className:"mapImage"}),(0,Cc.jsxs)("div",{className:"mapButtonsContainer",children:[(0,Cc.jsx)("button",{className:"mapToggleButton",onClick:x,children:(0,Cc.jsx)(AIe,{})}),(0,Cc.jsx)("button",{className:"inputToggleButton",onClick:G,children:(0,Cc.jsx)(xIe,{})})]}),s&&(0,Cc.jsxs)("div",{className:"resultContainer",children:[(0,Cc.jsx)("input",{type:"text",value:e,onInput:e=>{t(e.target.value),A()},placeholder:"\u8acb\u8f38\u5165\u95dc\u9375\u5b57",className:"input"}),n&&(0,Cc.jsx)("button",{className:"endButton",onClick:v,children:"\u7b54\u5c0d\u4e86"})]})]})]}),(0,Cc.jsxs)("div",{className:"centralContainer ".concat(c||u?"visible":""),children:[c&&(0,Cc.jsx)("div",{className:"newPrompt",children:"\u8acb\u524d\u5f80\u5c0b\u627e\u624b\u6c34\u820d"}),u&&(0,Cc.jsx)("button",{className:"navigateButton",onClick:S,children:"\u62b5\u9054\u624b\u6c34\u820d\uff0c\u9ede\u64ca\u6309\u9215"})]})]})},WIe=n.p+"static/media/\u8fa8\u8b58\u5716-\u624b\u6c34\u820d.5fe8024b4f9e7477721f.mind",VIe=()=>{const[e,t]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!0),[s,l]=(0,a.useState)(!0),c=(0,a.useRef)(null),g=(0,a.useCallback)((()=>t(!0)),[]),u=(0,a.useCallback)((()=>o(!0)),[]),d=(0,a.useCallback)((()=>{c.current&&c.current.submit()}),[]),h=(0,a.useCallback)(((e,t)=>{if(n){const n=new t.CanvasTexture(p("\u8a18\u5f97\u627e\u5c0e\u89bd\u4eba\u54e1\u62ff\u76f8\u7247\u5594")),a=new t.MeshBasicMaterial({map:n,transparent:!0}),o=new t.PlaneGeometry(1,.3),i=new t.Mesh(o,a);i.position.set(0,.5,0),e.add(i)}}),[n]),p=(0,a.useCallback)((e=>{const t=document.createElement("canvas"),n=t.getContext("2d");return t.width=256,t.height=64,n.fillStyle="black",n.fillRect(0,0,t.width,t.height),n.font="24px Arial",n.fillStyle="white",n.textAlign="center",n.textBaseline="middle",n.fillText(e,t.width/2,t.height/2),t}),[]);return(0,Cc.jsxs)("div",{className:"container5 ".concat(s?"hide-background":""),children:[(0,Cc.jsx)(aIe,{imageTargetSrc:WIe,onTargetFound:g,renderARContent:h,isEnabled:i}),(0,Cc.jsxs)("div",{className:"buttonContainer",children:[e&&!n&&(0,Cc.jsx)("button",{className:"foundButton5",onClick:u,children:"\u627e\u5230\u4e86"}),n&&(0,Cc.jsx)("div",{className:"centered-button-container",children:(0,Cc.jsx)("button",{className:"endGameButton5",onClick:d,children:"\u7d50\u675f\u904a\u6232"})})]}),(0,Cc.jsx)("form",{ref:c,action:"/",method:"GET",style:{display:"none"},children:(0,Cc.jsx)("input",{type:"hidden",name:"dialogIndex",value:"38"})})]})},NIe=a.createContext({siderHook:{addSider:()=>null,removeSider:()=>null}});const XIe={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"bars",theme:"outlined"};var MIe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:XIe}))};const TIe=a.forwardRef(MIe);const EIe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"};var FIe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:EIe}))};const HIe=a.forwardRef(FIe);const JIe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"};var YIe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:JIe}))};const LIe=a.forwardRef(YIe),zIe=e=>!isNaN(parseFloat(e))&&isFinite(e);var KIe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const DIe={xs:"479.98px",sm:"575.98px",md:"767.98px",lg:"991.98px",xl:"1199.98px",xxl:"1599.98px"},UIe=a.createContext({}),PIe=(()=>{let e=0;return function(){return e+=1,"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").concat(e)}})(),OIe=a.forwardRef(((e,t)=>{const{prefixCls:n,className:o,trigger:i,children:r,defaultCollapsed:s=!1,theme:l="dark",style:c={},collapsible:g=!1,reverseArrow:u=!1,width:d=200,collapsedWidth:h=80,zeroWidthTriggerStyle:p,breakpoint:m,onCollapse:I,onBreakpoint:C}=e,f=KIe(e,["prefixCls","className","trigger","children","defaultCollapsed","theme","style","collapsible","reverseArrow","width","collapsedWidth","zeroWidthTriggerStyle","breakpoint","onCollapse","onBreakpoint"]),{siderHook:b}=(0,a.useContext)(NIe),[y,A]=(0,a.useState)("collapsed"in e?e.collapsed:s),[v,S]=(0,a.useState)(!1);(0,a.useEffect)((()=>{"collapsed"in e&&A(e.collapsed)}),[e.collapsed]);const x=(t,n)=>{"collapsed"in e||A(t),null===I||void 0===I||I(t,n)},G=(0,a.useRef)();G.current=e=>{S(e.matches),null===C||void 0===C||C(e.matches),y!==e.matches&&x(e.matches,"responsive")},(0,a.useEffect)((()=>{function e(e){return G.current(e)}let t;if("undefined"!==typeof window){const{matchMedia:a}=window;if(a&&m&&m in DIe){t=a("screen and (max-width: ".concat(DIe[m],")"));try{t.addEventListener("change",e)}catch(n){t.addListener(e)}e(t)}}return()=>{try{null===t||void 0===t||t.removeEventListener("change",e)}catch(n){null===t||void 0===t||t.removeListener(e)}}}),[m]),(0,a.useEffect)((()=>{const e=PIe("ant-sider-");return b.addSider(e),()=>b.removeSider(e)}),[]);const Z=()=>{x(!y,"clickTrigger")},{getPrefixCls:w}=(0,a.useContext)(Be),k=a.useMemo((()=>({siderCollapsed:y})),[y]);return a.createElement(UIe.Provider,{value:k},(()=>{const e=w("layout-sider",n),s=Ce(f,["collapsed"]),m=y?h:d,I=zIe(m)?"".concat(m,"px"):String(m),C=0===parseFloat(String(h||0))?a.createElement("span",{onClick:Z,className:Ie()("".concat(e,"-zero-width-trigger"),"".concat(e,"-zero-width-trigger-").concat(u?"right":"left")),style:p},i||a.createElement(TIe,null)):null,b={expanded:u?a.createElement(LIe,null):a.createElement(HIe,null),collapsed:u?a.createElement(HIe,null):a.createElement(LIe,null)}[y?"collapsed":"expanded"],A=null!==i?C||a.createElement("div",{className:"".concat(e,"-trigger"),onClick:Z,style:{width:I}},i||b):null,S=Object.assign(Object.assign({},c),{flex:"0 0 ".concat(I),maxWidth:I,minWidth:I,width:I}),x=Ie()(e,"".concat(e,"-").concat(l),{["".concat(e,"-collapsed")]:!!y,["".concat(e,"-has-trigger")]:g&&null!==i&&!C,["".concat(e,"-below")]:!!v,["".concat(e,"-zero-width")]:0===parseFloat(I)},o);return a.createElement("aside",Object.assign({className:x},s,{style:S,ref:t}),a.createElement("div",{className:"".concat(e,"-children")},r),g||v&&C?A:null)})())}));const _Ie=OIe;const QIe=e=>{const{componentCls:t,bodyBg:n,lightSiderBg:a,lightTriggerBg:o,lightTriggerColor:i}=e;return{["".concat(t,"-sider-light")]:{background:a,["".concat(t,"-sider-trigger")]:{color:i,background:o},["".concat(t,"-sider-zero-width-trigger")]:{color:i,background:o,border:"1px solid ".concat(n),borderInlineStart:0}}}},jIe=e=>{const{antCls:t,componentCls:n,colorText:a,triggerColor:o,footerBg:i,triggerBg:r,headerHeight:s,headerPadding:l,headerColor:c,footerPadding:g,triggerHeight:u,zeroTriggerHeight:d,zeroTriggerWidth:h,motionDurationMid:p,motionDurationSlow:m,fontSize:I,borderRadius:C,bodyBg:f,headerBg:b,siderBg:y}=e;return{[n]:Object.assign(Object.assign({display:"flex",flex:"auto",flexDirection:"column",minHeight:0,background:f,"&, *":{boxSizing:"border-box"},["&".concat(n,"-has-sider")]:{flexDirection:"row",["> ".concat(n,", > ").concat(n,"-content")]:{width:0}},["".concat(n,"-header, &").concat(n,"-footer")]:{flex:"0 0 auto"},["".concat(n,"-sider")]:{position:"relative",minWidth:0,background:y,transition:"all ".concat(p,", background 0s"),"&-children":{height:"100%",marginTop:-.1,paddingTop:.1,["".concat(t,"-menu").concat(t,"-menu-inline-collapsed")]:{width:"auto"}},"&-has-trigger":{paddingBottom:u},"&-right":{order:1},"&-trigger":{position:"fixed",bottom:0,zIndex:1,height:u,color:o,lineHeight:Qt(u),textAlign:"center",background:r,cursor:"pointer",transition:"all ".concat(p)},"&-zero-width":{"> *":{overflow:"hidden"},"&-trigger":{position:"absolute",top:s,insetInlineEnd:e.calc(h).mul(-1).equal(),zIndex:1,width:h,height:d,color:o,fontSize:e.fontSizeXL,display:"flex",alignItems:"center",justifyContent:"center",background:y,borderStartStartRadius:0,borderStartEndRadius:C,borderEndEndRadius:C,borderEndStartRadius:0,cursor:"pointer",transition:"background ".concat(m," ease"),"&::after":{position:"absolute",inset:0,background:"transparent",transition:"all ".concat(m),content:'""'},"&:hover::after":{background:"rgba(255, 255, 255, 0.2)"},"&-right":{insetInlineStart:e.calc(h).mul(-1).equal(),borderStartStartRadius:C,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:C}}}}},QIe(e)),{"&-rtl":{direction:"rtl"}}),["".concat(n,"-header")]:{height:s,padding:l,color:c,lineHeight:Qt(s),background:b,["".concat(t,"-menu")]:{lineHeight:"inherit"}},["".concat(n,"-footer")]:{padding:g,color:a,fontSize:I,background:i},["".concat(n,"-content")]:{flex:"auto",color:a,minHeight:0}}},qIe=Ii("Layout",(e=>[jIe(e)]),(e=>{const{colorBgLayout:t,controlHeight:n,controlHeightLG:a,colorText:o,controlHeightSM:i,marginXXS:r,colorTextLightSolid:s,colorBgContainer:l}=e,c=1.25*a;return{colorBgHeader:"#001529",colorBgBody:t,colorBgTrigger:"#002140",bodyBg:t,headerBg:"#001529",headerHeight:2*n,headerPadding:"0 ".concat(c,"px"),headerColor:o,footerPadding:"".concat(i,"px ").concat(c,"px"),footerBg:t,siderBg:"#001529",triggerHeight:a+2*r,triggerBg:"#002140",triggerColor:s,zeroTriggerWidth:a,zeroTriggerHeight:a,lightSiderBg:l,lightTriggerBg:l,lightTriggerColor:o}}),{deprecatedTokens:[["colorBgBody","bodyBg"],["colorBgHeader","headerBg"],["colorBgTrigger","triggerBg"]]});var $Ie=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};function eCe(e){let{suffixCls:t,tagName:n,displayName:o}=e;return e=>a.forwardRef(((o,i)=>a.createElement(e,Object.assign({ref:i,suffixCls:t,tagName:n},o))))}const tCe=a.forwardRef(((e,t)=>{const{prefixCls:n,suffixCls:o,className:i,tagName:r}=e,s=$Ie(e,["prefixCls","suffixCls","className","tagName"]),{getPrefixCls:l}=a.useContext(Be),c=l("layout",n),[g,u,d]=qIe(c),h=o?"".concat(c,"-").concat(o):c;return g(a.createElement(r,Object.assign({className:Ie()(n||h,i,u,d),ref:t},s)))})),nCe=a.forwardRef(((e,t)=>{const{direction:n}=a.useContext(Be),[o,i]=a.useState([]),{prefixCls:r,className:s,rootClassName:l,children:c,hasSider:g,tagName:u,style:d}=e,h=Ce($Ie(e,["prefixCls","className","rootClassName","children","hasSider","tagName","style"]),["suffixCls"]),{getPrefixCls:p,layout:m}=a.useContext(Be),I=p("layout",r),C=function(e,t,n){return"boolean"===typeof n?n:!!e.length||Es(t).some((e=>e.type===_Ie))}(o,c,g),[f,b,y]=qIe(I),A=Ie()(I,{["".concat(I,"-has-sider")]:C,["".concat(I,"-rtl")]:"rtl"===n},null===m||void 0===m?void 0:m.className,s,l,b,y),v=a.useMemo((()=>({siderHook:{addSider:e=>{i((t=>[].concat(Le(t),[e])))},removeSider:e=>{i((t=>t.filter((t=>t!==e))))}}})),[]);return f(a.createElement(NIe.Provider,{value:v},a.createElement(u,Object.assign({ref:t,className:A,style:Object.assign(Object.assign({},null===m||void 0===m?void 0:m.style),d)},h),c)))})),aCe=eCe({tagName:"div",displayName:"Layout"})(nCe),oCe=eCe({suffixCls:"header",tagName:"header",displayName:"Header"})(tCe),iCe=eCe({suffixCls:"footer",tagName:"footer",displayName:"Footer"})(tCe),rCe=eCe({suffixCls:"content",tagName:"main",displayName:"Content"})(tCe),sCe=aCe;sCe.Header=oCe,sCe.Footer=iCe,sCe.Content=rCe,sCe.Sider=_Ie,sCe._InternalSiderContext=UIe;const lCe=sCe;function cCe(){return{width:document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight}}function gCe(e,t,n,a){var o=tr.unstable_batchedUpdates?function(e){tr.unstable_batchedUpdates(n,e)}:n;return null!==e&&void 0!==e&&e.addEventListener&&e.addEventListener(t,o,a),{remove:function(){null!==e&&void 0!==e&&e.removeEventListener&&e.removeEventListener(t,o,a)}}}var uCe=a.createContext(null);const dCe=function(e){var t=e.visible,n=e.maskTransitionName,o=e.getContainer,i=e.prefixCls,r=e.rootClassName,s=e.icons,l=e.countRender,c=e.showSwitch,g=e.showProgress,u=e.current,d=e.transform,h=e.count,p=e.scale,m=e.minScale,I=e.maxScale,C=e.closeIcon,f=e.onSwitchLeft,b=e.onSwitchRight,y=e.onClose,A=e.onZoomIn,v=e.onZoomOut,S=e.onRotateRight,x=e.onRotateLeft,G=e.onFlipX,Z=e.onFlipY,w=e.onReset,k=e.toolbarRender,B=e.zIndex,R=e.image,W=(0,a.useContext)(uCe),V=s.rotateLeft,N=s.rotateRight,X=s.zoomIn,M=s.zoomOut,T=s.close,E=s.left,F=s.right,H=s.flipX,J=s.flipY,Y="".concat(i,"-operations-operation");a.useEffect((function(){var e=function(e){e.keyCode===Ac.ESC&&y()};return t&&window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t]);var L=[{icon:J,onClick:Z,type:"flipY"},{icon:H,onClick:G,type:"flipX"},{icon:V,onClick:x,type:"rotateLeft"},{icon:N,onClick:S,type:"rotateRight"},{icon:M,onClick:v,type:"zoomOut",disabled:p<=m},{icon:X,onClick:A,type:"zoomIn",disabled:p===I}].map((function(e){var t,n=e.icon,o=e.onClick,r=e.type,s=e.disabled;return a.createElement("div",{className:Ie()(Y,(t={},Me(t,"".concat(i,"-operations-operation-").concat(r),!0),Me(t,"".concat(i,"-operations-operation-disabled"),!!s),t)),onClick:o,key:r},n)})),z=a.createElement("div",{className:"".concat(i,"-operations")},L);return a.createElement(qr,{visible:t,motionName:n},(function(e){var t=e.className,n=e.style;return a.createElement(_g,{open:!0,getContainer:null!==o&&void 0!==o?o:document.body},a.createElement("div",{className:Ie()("".concat(i,"-operations-wrapper"),t,r),style:Ke(Ke({},n),{},{zIndex:B})},null===C?null:a.createElement("button",{className:"".concat(i,"-close"),onClick:y},C||T),c&&a.createElement(a.Fragment,null,a.createElement("div",{className:Ie()("".concat(i,"-switch-left"),Me({},"".concat(i,"-switch-left-disabled"),0===u)),onClick:f},E),a.createElement("div",{className:Ie()("".concat(i,"-switch-right"),Me({},"".concat(i,"-switch-right-disabled"),u===h-1)),onClick:b},F)),a.createElement("div",{className:"".concat(i,"-footer")},g&&a.createElement("div",{className:"".concat(i,"-progress")},l?l(u+1,h):"".concat(u+1," / ").concat(h)),k?k(z,Ke(Ke({icons:{flipYIcon:L[0],flipXIcon:L[1],rotateLeftIcon:L[2],rotateRightIcon:L[3],zoomOutIcon:L[4],zoomInIcon:L[5]},actions:{onFlipY:Z,onFlipX:G,onRotateLeft:x,onRotateRight:S,onZoomOut:v,onZoomIn:A,onReset:w,onClose:y},transform:d},W?{current:u,total:h}:{}),{},{image:R})):z)))}))};var hCe={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function pCe(e,t,n,a){var o=t+n,i=(n-a)/2;if(n>a){if(t>0)return Me({},e,i);if(t<0&&o<a)return Me({},e,-i)}else if(t<0||o>a)return Me({},e,t<0?i:-i);return{}}function mCe(e,t,n,a){var o=cCe(),i=o.width,r=o.height,s=null;return e<=i&&t<=r?s={x:0,y:0}:(e>i||t>r)&&(s=Ke(Ke({},pCe("x",n,e,i)),pCe("y",a,t,r))),s}function ICe(e){var t=e.src,n=e.isCustomPlaceholder,o=e.fallback,i=Je((0,a.useState)(n?"loading":"normal"),2),r=i[0],s=i[1],l=(0,a.useRef)(!1),c="error"===r;(0,a.useEffect)((function(){var e=!0;return function(e){return new Promise((function(t){var n=document.createElement("img");n.onerror=function(){return t(!1)},n.onload=function(){return t(!0)},n.src=e}))}(t).then((function(t){!t&&e&&s("error")})),function(){e=!1}}),[t]),(0,a.useEffect)((function(){n&&!l.current?s("loading"):c&&s("normal")}),[t]);var g=function(){s("normal")};return[function(e){l.current=!1,"loading"===r&&null!==e&&void 0!==e&&e.complete&&(e.naturalWidth||e.naturalHeight)&&(l.current=!0,g())},c&&o?{src:o}:{onLoad:g,src:t},r]}function CCe(e,t){var n=e.x-t.x,a=e.y-t.y;return Math.hypot(n,a)}function fCe(e,t,n,o,i,r,s){var l=i.rotate,c=i.scale,g=i.x,u=i.y,d=Je((0,a.useState)(!1),2),h=d[0],p=d[1],m=(0,a.useRef)({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),I=function(e){m.current=Ke(Ke({},m.current),e)};return(0,a.useEffect)((function(){var e;return n&&t&&(e=gCe(window,"touchmove",(function(e){return e.preventDefault()}),{passive:!1})),function(){var t;null===(t=e)||void 0===t||t.remove()}}),[n,t]),{isTouching:h,onTouchStart:function(e){if(t){e.stopPropagation(),p(!0);var n=e.touches,a=void 0===n?[]:n;a.length>1?I({point1:{x:a[0].clientX,y:a[0].clientY},point2:{x:a[1].clientX,y:a[1].clientY},eventType:"touchZoom"}):I({point1:{x:a[0].clientX-g,y:a[0].clientY-u},eventType:"move"})}},onTouchMove:function(e){var t=e.touches,n=void 0===t?[]:t,a=m.current,o=a.point1,i=a.point2,l=a.eventType;if(n.length>1&&"touchZoom"===l){var c={x:n[0].clientX,y:n[0].clientY},g={x:n[1].clientX,y:n[1].clientY},u=function(e,t,n,a){var o=CCe(e,n),i=CCe(t,a);if(0===o&&0===i)return[e.x,e.y];var r=o/(o+i);return[e.x+r*(t.x-e.x),e.y+r*(t.y-e.y)]}(o,i,c,g),d=Je(u,2),h=d[0],p=d[1],C=CCe(c,g)/CCe(o,i);s(C,"touchZoom",h,p,!0),I({point1:c,point2:g,eventType:"touchZoom"})}else"move"===l&&(r({x:n[0].clientX-o.x,y:n[0].clientY-o.y},"move"),I({eventType:"move"}))},onTouchEnd:function(){if(n){if(h&&p(!1),I({eventType:"none"}),o>c)return r({x:0,y:0,scale:o},"touchZoom");var t=e.current.offsetWidth*c,a=e.current.offsetHeight*c,i=e.current.getBoundingClientRect(),s=i.left,g=i.top,u=l%180!==0,d=mCe(u?a:t,u?t:a,s,g);d&&r(Ke({},d),"dragRebound")}}}}var bCe=["fallback","src","imgRef"],yCe=["prefixCls","src","alt","imageInfo","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],ACe=function(e){var t=e.fallback,n=e.src,o=e.imgRef,i=ir(e,bCe),r=Je(ICe({src:n,fallback:t}),2),s=r[0],l=r[1];return a.createElement("img",yn({ref:function(e){o.current=e,s(e)}},i,l))};const vCe=function(e){var t=e.prefixCls,n=e.src,o=e.alt,i=e.imageInfo,r=e.fallback,s=e.movable,l=void 0===s||s,c=e.onClose,g=e.visible,u=e.icons,d=void 0===u?{}:u,h=e.rootClassName,p=e.closeIcon,m=e.getContainer,I=e.current,C=void 0===I?0:I,f=e.count,b=void 0===f?1:f,y=e.countRender,A=e.scaleStep,v=void 0===A?.5:A,S=e.minScale,x=void 0===S?1:S,G=e.maxScale,Z=void 0===G?50:G,w=e.transitionName,k=void 0===w?"zoom":w,B=e.maskTransitionName,R=void 0===B?"fade":B,W=e.imageRender,V=e.imgCommonProps,N=e.toolbarRender,X=e.onTransform,M=e.onChange,T=ir(e,yCe),E=(0,a.useRef)(),F=(0,a.useContext)(uCe),H=F&&b>1,J=F&&b>=1,Y=Je((0,a.useState)(!0),2),L=Y[0],z=Y[1],K=function(e,t,n,o){var i=(0,a.useRef)(null),r=(0,a.useRef)([]),s=Je((0,a.useState)(hCe),2),l=s[0],c=s[1],g=function(e,t){null===i.current&&(r.current=[],i.current=Gi((function(){c((function(e){var n=e;return r.current.forEach((function(e){n=Ke(Ke({},n),e)})),i.current=null,null===o||void 0===o||o({transform:n,action:t}),n}))}))),r.current.push(Ke(Ke({},l),e))};return{transform:l,resetTransform:function(e){c(hCe),dt(hCe,l)||null===o||void 0===o||o({transform:hCe,action:e})},updateTransform:g,dispatchZoomChange:function(a,o,i,r,s){var c=e.current,u=c.width,d=c.height,h=c.offsetWidth,p=c.offsetHeight,m=c.offsetLeft,I=c.offsetTop,C=a,f=l.scale*a;f>n?(f=n,C=n/l.scale):f<t&&(C=(f=s?f:t)/l.scale);var b=null!==i&&void 0!==i?i:innerWidth/2,y=null!==r&&void 0!==r?r:innerHeight/2,A=C-1,v=A*u*.5,S=A*d*.5,x=A*(b-l.x-m),G=A*(y-l.y-I),Z=l.x-(x-v),w=l.y-(G-S);if(a<1&&1===f){var k=h*f,B=p*f,R=cCe(),W=R.width,V=R.height;k<=W&&B<=V&&(Z=0,w=0)}g({x:Z,y:w,scale:f},o)}}}(E,x,Z,X),D=K.transform,U=K.resetTransform,P=K.updateTransform,O=K.dispatchZoomChange,_=function(e,t,n,o,i,r,s){var l=i.rotate,c=i.scale,g=i.x,u=i.y,d=Je((0,a.useState)(!1),2),h=d[0],p=d[1],m=(0,a.useRef)({diffX:0,diffY:0,transformX:0,transformY:0}),I=function(e){n&&h&&r({x:e.pageX-m.current.diffX,y:e.pageY-m.current.diffY},"move")},C=function(){if(n&&h){p(!1);var t=m.current,a=t.transformX,o=t.transformY;if(g===a||u===o)return;var i=e.current.offsetWidth*c,s=e.current.offsetHeight*c,d=e.current.getBoundingClientRect(),I=d.left,C=d.top,f=l%180!==0,b=mCe(f?s:i,f?i:s,I,C);b&&r(Ke({},b),"dragRebound")}};return(0,a.useEffect)((function(){var e,n,a,o;if(t){a=gCe(window,"mouseup",C,!1),o=gCe(window,"mousemove",I,!1);try{window.top!==window.self&&(e=gCe(window.top,"mouseup",C,!1),n=gCe(window.top,"mousemove",I,!1))}catch(i){"[rc-image] ".concat(i)}}return function(){var t,i,r,s;null===(t=a)||void 0===t||t.remove(),null===(i=o)||void 0===i||i.remove(),null===(r=e)||void 0===r||r.remove(),null===(s=n)||void 0===s||s.remove()}}),[n,h,g,u,l,t]),{isMoving:h,onMouseDown:function(e){t&&0===e.button&&(e.preventDefault(),e.stopPropagation(),m.current={diffX:e.pageX-g,diffY:e.pageY-u,transformX:g,transformY:u},p(!0))},onMouseMove:I,onMouseUp:C,onWheel:function(e){if(n&&0!=e.deltaY){var t=Math.abs(e.deltaY/100),a=1+Math.min(t,1)*o;e.deltaY>0&&(a=1/a),s(a,"wheel",e.clientX,e.clientY)}}}}(E,l,g,v,D,P,O),Q=_.isMoving,j=_.onMouseDown,q=_.onWheel,$=fCe(E,l,g,x,D,P,O),ee=$.isTouching,te=$.onTouchStart,ne=$.onTouchMove,ae=$.onTouchEnd,oe=D.rotate,ie=D.scale,re=Ie()(Me({},"".concat(t,"-moving"),Q));(0,a.useEffect)((function(){L||z(!0)}),[L]);var se=function(e){null===e||void 0===e||e.preventDefault(),null===e||void 0===e||e.stopPropagation(),C>0&&(z(!1),U("prev"),null===M||void 0===M||M(C-1,C))},le=function(e){null===e||void 0===e||e.preventDefault(),null===e||void 0===e||e.stopPropagation(),C<b-1&&(z(!1),U("next"),null===M||void 0===M||M(C+1,C))},ce=function(e){g&&H&&(e.keyCode===Ac.LEFT?se():e.keyCode===Ac.RIGHT&&le())};(0,a.useEffect)((function(){var e=gCe(window,"keydown",ce,!1);return function(){e.remove()}}),[g,H,C]);var ge=a.createElement(ACe,yn({},V,{width:e.width,height:e.height,imgRef:E,className:"".concat(t,"-img"),alt:o,style:{transform:"translate3d(".concat(D.x,"px, ").concat(D.y,"px, 0) scale3d(").concat(D.flipX?"-":"").concat(ie,", ").concat(D.flipY?"-":"").concat(ie,", 1) rotate(").concat(oe,"deg)"),transitionDuration:(!L||ee)&&"0s"},fallback:r,src:n,onWheel:q,onMouseDown:j,onDoubleClick:function(e){g&&(1!==ie?P({x:0,y:0,scale:1},"doubleClick"):O(1+v,"doubleClick",e.clientX,e.clientY))},onTouchStart:te,onTouchMove:ne,onTouchEnd:ae,onTouchCancel:ae})),ue=Ke({url:n,alt:o},i);return a.createElement(a.Fragment,null,a.createElement(XI,yn({transitionName:k,maskTransitionName:R,closable:!1,keyboard:!0,prefixCls:t,onClose:c,visible:g,classNames:{wrapper:re},rootClassName:h,getContainer:m},T,{afterClose:function(){U("close")}}),a.createElement("div",{className:"".concat(t,"-img-wrapper")},W?W(ge,Ke({transform:D,image:ue},F?{current:C}:{})):ge)),a.createElement(dCe,{visible:g,transform:D,maskTransitionName:R,closeIcon:p,getContainer:m,prefixCls:t,rootClassName:h,icons:d,countRender:y,showSwitch:H,showProgress:J,current:C,count:b,scale:ie,minScale:x,maxScale:Z,toolbarRender:N,onSwitchLeft:se,onSwitchRight:le,onZoomIn:function(){O(1+v,"zoomIn")},onZoomOut:function(){O(1/(1+v),"zoomOut")},onRotateRight:function(){P({rotate:oe+90},"rotateRight")},onRotateLeft:function(){P({rotate:oe-90},"rotateLeft")},onFlipX:function(){P({flipX:!D.flipX},"flipX")},onFlipY:function(){P({flipY:!D.flipY},"flipY")},onClose:c,onReset:function(){U("reset")},zIndex:void 0!==T.zIndex?T.zIndex+1:void 0,image:ue}))};var SCe=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"];var xCe=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],GCe=["src"];const ZCe=function(e){var t,n=e.previewPrefixCls,o=void 0===n?"rc-image-preview":n,i=e.children,r=e.icons,s=void 0===r?{}:r,l=e.items,c=e.preview,g=e.fallback,u="object"===fe(c)?c:{},d=u.visible,h=u.onVisibleChange,p=u.getContainer,m=u.current,I=u.movable,C=u.minScale,f=u.maxScale,b=u.countRender,y=u.closeIcon,A=u.onChange,v=u.onTransform,S=u.toolbarRender,x=u.imageRender,G=ir(u,xCe),Z=function(e){var t=Je(a.useState({}),2),n=t[0],o=t[1],i=a.useCallback((function(e,t){return o((function(n){return Ke(Ke({},n),{},Me({},e,t))})),function(){o((function(t){var n=Ke({},t);return delete n[e],n}))}}),[]),r=a.useMemo((function(){return e?e.map((function(e){if("string"===typeof e)return{data:{src:e}};var t={};return Object.keys(e).forEach((function(n){["src"].concat(Le(SCe)).includes(n)&&(t[n]=e[n])})),{data:t}})):Object.keys(n).reduce((function(e,t){var a=n[t],o=a.canPreview,i=a.data;return o&&e.push({data:i,id:t}),e}),[])}),[e,n]);return[r,i,!!e]}(l),w=Je(Z,3),k=w[0],B=w[1],R=w[2],W=Je(Wa(0,{value:m}),2),V=W[0],N=W[1],X=Je((0,a.useState)(!1),2),M=X[0],T=X[1],E=(null===(t=k[V])||void 0===t?void 0:t.data)||{},F=E.src,H=ir(E,GCe),J=Je(Wa(!!d,{value:d,onChange:function(e,t){null===h||void 0===h||h(e,t,V)}}),2),Y=J[0],L=J[1],z=Je((0,a.useState)(null),2),K=z[0],D=z[1],U=a.useCallback((function(e,t,n,a){var o=R?k.findIndex((function(e){return e.data.src===t})):k.findIndex((function(t){return t.id===e}));N(o<0?0:o),L(!0),D({x:n,y:a}),T(!0)}),[k,R]);a.useEffect((function(){Y?M||N(0):T(!1)}),[Y]);var P=a.useMemo((function(){return{register:B,onPreview:U}}),[B,U]);return a.createElement(uCe.Provider,{value:P},i,a.createElement(vCe,yn({"aria-hidden":!Y,movable:I,visible:Y,prefixCls:o,closeIcon:y,onClose:function(){L(!1),D(null)},mousePosition:K,imgCommonProps:H,src:F,fallback:g,icons:s,minScale:C,maxScale:f,getContainer:p,current:V,count:k.length,countRender:b,onTransform:v,toolbarRender:S,imageRender:x,onChange:function(e,t){N(e),null===A||void 0===A||A(e,t)}},G)))};var wCe=0;var kCe=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],BCe=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],RCe=function(e){var t=e.src,n=e.alt,o=e.onPreviewClose,i=e.prefixCls,r=void 0===i?"rc-image":i,s=e.previewPrefixCls,l=void 0===s?"".concat(r,"-preview"):s,c=e.placeholder,g=e.fallback,u=e.width,d=e.height,h=e.style,p=e.preview,m=void 0===p||p,I=e.className,C=e.onClick,f=e.onError,b=e.wrapperClassName,y=e.wrapperStyle,A=e.rootClassName,v=ir(e,kCe),S=c&&!0!==c,x="object"===fe(m)?m:{},G=x.src,Z=x.visible,w=void 0===Z?void 0:Z,k=x.onVisibleChange,B=void 0===k?o:k,R=x.getContainer,W=void 0===R?void 0:R,V=x.mask,N=x.maskClassName,X=x.movable,M=x.icons,T=x.scaleStep,E=x.minScale,F=x.maxScale,H=x.imageRender,J=x.toolbarRender,Y=ir(x,BCe),L=null!==G&&void 0!==G?G:t,z=Je(Wa(!!w,{value:w,onChange:B}),2),K=z[0],D=z[1],U=Je(ICe({src:t,isCustomPlaceholder:S,fallback:g}),3),P=U[0],O=U[1],_=U[2],Q=Je((0,a.useState)(null),2),j=Q[0],q=Q[1],$=(0,a.useContext)(uCe),ee=!!m,te=Ie()(r,b,A,Me({},"".concat(r,"-error"),"error"===_)),ne=(0,a.useMemo)((function(){var t={};return SCe.forEach((function(n){void 0!==e[n]&&(t[n]=e[n])})),t}),SCe.map((function(t){return e[t]}))),ae=function(e,t){var n=Je(a.useState((function(){return String(wCe+=1)})),1)[0],o=a.useContext(uCe),i={data:t,canPreview:e};return a.useEffect((function(){if(o)return o.register(n,i)}),[]),a.useEffect((function(){o&&o.register(n,i)}),[e,t]),n}(ee,(0,a.useMemo)((function(){return Ke(Ke({},ne),{},{src:L})}),[L,ne]));return a.createElement(a.Fragment,null,a.createElement("div",yn({},v,{className:te,onClick:ee?function(e){var t=function(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+(window.pageXOffset||n.scrollLeft)-(n.clientLeft||document.body.clientLeft||0),top:t.top+(window.pageYOffset||n.scrollTop)-(n.clientTop||document.body.clientTop||0)}}(e.target),n=t.left,a=t.top;$?$.onPreview(ae,L,n,a):(q({x:n,y:a}),D(!0)),null===C||void 0===C||C(e)}:C,style:Ke({width:u,height:d},y)}),a.createElement("img",yn({},ne,{className:Ie()("".concat(r,"-img"),Me({},"".concat(r,"-img-placeholder"),!0===c),I),style:Ke({height:d},h),ref:P},O,{width:u,height:d,onError:f})),"loading"===_&&a.createElement("div",{"aria-hidden":"true",className:"".concat(r,"-placeholder")},c),V&&ee&&a.createElement("div",{className:Ie()("".concat(r,"-mask"),N),style:{display:"none"===(null===h||void 0===h?void 0:h.display)?"none":void 0}},V)),!$&&ee&&a.createElement(vCe,yn({"aria-hidden":!K,visible:K,prefixCls:l,onClose:function(){D(!1),q(null)},mousePosition:j,src:L,alt:n,imageInfo:{width:u,height:d},fallback:g,getContainer:W,icons:M,movable:X,scaleStep:T,minScale:E,maxScale:F,rootClassName:A,imageRender:H,imgCommonProps:ne,toolbarRender:J},Y)))};RCe.PreviewGroup=ZCe;const WCe=RCe;const VCe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M672 418H144c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H188V494h440v326z"}},{tag:"path",attrs:{d:"M819.3 328.5c-78.8-100.7-196-153.6-314.6-154.2l-.2-64c0-6.5-7.6-10.1-12.6-6.1l-128 101c-4 3.1-3.9 9.1 0 12.3L492 318.6c5.1 4 12.7.4 12.6-6.1v-63.9c12.9.1 25.9.9 38.8 2.5 42.1 5.2 82.1 18.2 119 38.7 38.1 21.2 71.2 49.7 98.4 84.3 27.1 34.7 46.7 73.7 58.1 115.8a325.95 325.95 0 016.5 140.9h74.9c14.8-103.6-11.3-213-81-302.3z"}}]},name:"rotate-left",theme:"outlined"};var NCe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:VCe}))};const XCe=a.forwardRef(NCe);const MCe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M480.5 251.2c13-1.6 25.9-2.4 38.8-2.5v63.9c0 6.5 7.5 10.1 12.6 6.1L660 217.6c4-3.2 4-9.2 0-12.3l-128-101c-5.1-4-12.6-.4-12.6 6.1l-.2 64c-118.6.5-235.8 53.4-314.6 154.2A399.75 399.75 0 00123.5 631h74.9c-.9-5.3-1.7-10.7-2.4-16.1-5.1-42.1-2.1-84.1 8.9-124.8 11.4-42.2 31-81.1 58.1-115.8 27.2-34.7 60.3-63.2 98.4-84.3 37-20.6 76.9-33.6 119.1-38.8z"}},{tag:"path",attrs:{d:"M880 418H352c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H396V494h440v326z"}}]},name:"rotate-right",theme:"outlined"};var TCe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:MCe}))};const ECe=a.forwardRef(TCe);const FCe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"};var HCe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:FCe}))};const JCe=a.forwardRef(HCe);const YCe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-in",theme:"outlined"};var LCe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:YCe}))};const zCe=a.forwardRef(LCe);const KCe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-out",theme:"outlined"};var DCe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:KCe}))};const UCe=a.forwardRef(DCe),PCe=e=>({position:e||"absolute",inset:0}),OCe=e=>{const{iconCls:t,motionDurationSlow:n,paddingXXS:a,marginXXS:o,prefixCls:i,colorTextLightSolid:r}=e;return{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:r,background:new To("#000").setAlpha(.5).toRgbString(),cursor:"pointer",opacity:0,transition:"opacity ".concat(n),[".".concat(i,"-mask-info")]:Object.assign(Object.assign({},La),{padding:"0 ".concat(Qt(a)),[t]:{marginInlineEnd:o,svg:{verticalAlign:"baseline"}}})}},_Ce=e=>{const{previewCls:t,modalMaskBg:n,paddingSM:a,marginXL:o,margin:i,paddingLG:r,previewOperationColorDisabled:s,previewOperationHoverColor:l,motionDurationSlow:c,iconCls:g,colorTextLightSolid:u}=e,d=new To(n).setAlpha(.1),h=d.clone().setAlpha(.2);return{["".concat(t,"-footer")]:{position:"fixed",bottom:o,left:{_skip_check_:!0,value:0},width:"100%",display:"flex",flexDirection:"column",alignItems:"center",color:e.previewOperationColor},["".concat(t,"-progress")]:{marginBottom:i},["".concat(t,"-close")]:{position:"fixed",top:o,right:{_skip_check_:!0,value:o},display:"flex",color:u,backgroundColor:d.toRgbString(),borderRadius:"50%",padding:a,outline:0,border:0,cursor:"pointer",transition:"all ".concat(c),"&:hover":{backgroundColor:h.toRgbString()},["& > ".concat(g)]:{fontSize:e.previewOperationSize}},["".concat(t,"-operations")]:{display:"flex",alignItems:"center",padding:"0 ".concat(Qt(r)),backgroundColor:d.toRgbString(),borderRadius:100,"&-operation":{marginInlineStart:a,padding:a,cursor:"pointer",transition:"all ".concat(c),userSelect:"none",["&:not(".concat(t,"-operations-operation-disabled):hover > ").concat(g)]:{color:l},"&-disabled":{color:s,cursor:"not-allowed"},"&:first-of-type":{marginInlineStart:0},["& > ".concat(g)]:{fontSize:e.previewOperationSize}}}}},QCe=e=>{const{modalMaskBg:t,iconCls:n,previewOperationColorDisabled:a,previewCls:o,zIndexPopup:i,motionDurationSlow:r}=e,s=new To(t).setAlpha(.1),l=s.clone().setAlpha(.2);return{["".concat(o,"-switch-left, ").concat(o,"-switch-right")]:{position:"fixed",insetBlockStart:"50%",zIndex:e.calc(i).add(1).equal(),display:"flex",alignItems:"center",justifyContent:"center",width:e.imagePreviewSwitchSize,height:e.imagePreviewSwitchSize,marginTop:e.calc(e.imagePreviewSwitchSize).mul(-1).div(2).equal(),color:e.previewOperationColor,background:s.toRgbString(),borderRadius:"50%",transform:"translateY(-50%)",cursor:"pointer",transition:"all ".concat(r),userSelect:"none","&:hover":{background:l.toRgbString()},"&-disabled":{"&, &:hover":{color:a,background:"transparent",cursor:"not-allowed",["> ".concat(n)]:{cursor:"not-allowed"}}},["> ".concat(n)]:{fontSize:e.previewOperationSize}},["".concat(o,"-switch-left")]:{insetInlineStart:e.marginSM},["".concat(o,"-switch-right")]:{insetInlineEnd:e.marginSM}}},jCe=e=>{const{motionEaseOut:t,previewCls:n,motionDurationSlow:a,componentCls:o}=e;return[{["".concat(o,"-preview-root")]:{[n]:{height:"100%",textAlign:"center",pointerEvents:"none"},["".concat(n,"-body")]:Object.assign(Object.assign({},PCe()),{overflow:"hidden"}),["".concat(n,"-img")]:{maxWidth:"100%",maxHeight:"70%",verticalAlign:"middle",transform:"scale3d(1, 1, 1)",cursor:"grab",transition:"transform ".concat(a," ").concat(t," 0s"),userSelect:"none","&-wrapper":Object.assign(Object.assign({},PCe()),{transition:"transform ".concat(a," ").concat(t," 0s"),display:"flex",justifyContent:"center",alignItems:"center","& > *":{pointerEvents:"auto"},"&::before":{display:"inline-block",width:1,height:"50%",marginInlineEnd:-1,content:'""'}})},["".concat(n,"-moving")]:{["".concat(n,"-preview-img")]:{cursor:"grabbing","&-wrapper":{transitionDuration:"0s"}}}}},{["".concat(o,"-preview-root")]:{["".concat(n,"-wrap")]:{zIndex:e.zIndexPopup}}},{["".concat(o,"-preview-operations-wrapper")]:{position:"fixed",zIndex:e.calc(e.zIndexPopup).add(1).equal()},"&":[_Ce(e),QCe(e)]}]},qCe=e=>{const{componentCls:t}=e;return{[t]:{position:"relative",display:"inline-block",["".concat(t,"-img")]:{width:"100%",height:"auto",verticalAlign:"middle"},["".concat(t,"-img-placeholder")]:{backgroundColor:e.colorBgContainerDisabled,backgroundImage:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQuNSAyLjVoLTEzQS41LjUgMCAwIDAgMSAzdjEwYS41LjUgMCAwIDAgLjUuNWgxM2EuNS41IDAgMCAwIC41LS41VjNhLjUuNSAwIDAgMC0uNS0uNXpNNS4yODEgNC43NWExIDEgMCAwIDEgMCAyIDEgMSAwIDAgMSAwLTJ6bTguMDMgNi44M2EuMTI3LjEyNyAwIDAgMS0uMDgxLjAzSDIuNzY5YS4xMjUuMTI1IDAgMCAxLS4wOTYtLjIwN2wyLjY2MS0zLjE1NmEuMTI2LjEyNiAwIDAgMSAuMTc3LS4wMTZsLjAxNi4wMTZMNy4wOCAxMC4wOWwyLjQ3LTIuOTNhLjEyNi4xMjYgMCAwIDEgLjE3Ny0uMDE2bC4wMTUuMDE2IDMuNTg4IDQuMjQ0YS4xMjcuMTI3IDAgMCAxLS4wMi4xNzV6IiBmaWxsPSIjOEM4QzhDIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L3N2Zz4=')",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"30%"},["".concat(t,"-mask")]:Object.assign({},OCe(e)),["".concat(t,"-mask:hover")]:{opacity:1},["".concat(t,"-placeholder")]:Object.assign({},PCe())}}},$Ce=e=>{const{previewCls:t}=e;return{["".concat(t,"-root")]:WC(e,"zoom"),"&":SC(e,!0)}},efe=Ii("Image",(e=>{const t="".concat(e.componentCls,"-preview"),n=ri(e,{previewCls:t,modalMaskBg:new To("#000").setAlpha(.45).toRgbString(),imagePreviewSwitchSize:e.controlHeightLG});return[qCe(n),jCe(n),NC(ri(n,{componentCls:t})),$Ce(n)]}),(e=>({zIndexPopup:e.zIndexPopupBase+80,previewOperationColor:new To(e.colorTextLightSolid).setAlpha(.65).toRgbString(),previewOperationHoverColor:new To(e.colorTextLightSolid).setAlpha(.85).toRgbString(),previewOperationColorDisabled:new To(e.colorTextLightSolid).setAlpha(.25).toRgbString(),previewOperationSize:1.5*e.fontSizeIcon})));var tfe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const nfe={rotateLeft:a.createElement(XCe,null),rotateRight:a.createElement(ECe,null),zoomIn:a.createElement(zCe,null),zoomOut:a.createElement(UCe,null),close:a.createElement(lm,null),left:a.createElement(HIe,null),right:a.createElement(LIe,null),flipX:a.createElement(JCe,null),flipY:a.createElement(JCe,{rotate:90})},afe=e=>{var{previewPrefixCls:t,preview:n}=e,o=tfe(e,["previewPrefixCls","preview"]);const{getPrefixCls:i}=a.useContext(Be),r=i("image",t),s="".concat(r,"-preview"),l=i(),c=Od(r),[g,u,d]=efe(r,c),[h]=Wd("ImagePreview","object"===typeof n?n.zIndex:void 0),p=a.useMemo((()=>{var e;if(!1===n)return n;const t="object"===typeof n?n:{},a=Ie()(u,d,c,null!==(e=t.rootClassName)&&void 0!==e?e:"");return Object.assign(Object.assign({},t),{transitionName:Vd(l,"zoom",t.transitionName),maskTransitionName:Vd(l,"fade",t.maskTransitionName),rootClassName:a,zIndex:h})}),[n]);return g(a.createElement(WCe.PreviewGroup,Object.assign({preview:p,previewPrefixCls:s,icons:nfe},o)))};var ofe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const ife=e=>{var t;const{prefixCls:n,preview:o,className:i,rootClassName:r,style:s}=e,l=ofe(e,["prefixCls","preview","className","rootClassName","style"]),{getPrefixCls:c,locale:g=Ti,getPopupContainer:u,image:d}=a.useContext(Be),h=c("image",n),p=c(),m=g.Image||Ti.Image,I=Od(h),[C,f,b]=efe(h,I),y=Ie()(r,f,b,I),A=Ie()(i,f,null===d||void 0===d?void 0:d.className),[v]=Wd("ImagePreview","object"===typeof o?o.zIndex:void 0),S=a.useMemo((()=>{var e;if(!1===o)return o;const t="object"===typeof o?o:{},{getContainer:n,closeIcon:i}=t,r=ofe(t,["getContainer","closeIcon"]);return Object.assign(Object.assign({mask:a.createElement("div",{className:"".concat(h,"-mask-info")},a.createElement(xIe,null),null===m||void 0===m?void 0:m.preview),icons:nfe},r),{getContainer:null!==n&&void 0!==n?n:u,transitionName:Vd(p,"zoom",t.transitionName),maskTransitionName:Vd(p,"fade",t.maskTransitionName),zIndex:v,closeIcon:null!==i&&void 0!==i?i:null===(e=null===d||void 0===d?void 0:d.preview)||void 0===e?void 0:e.closeIcon})}),[o,m,null===(t=null===d||void 0===d?void 0:d.preview)||void 0===t?void 0:t.closeIcon]),x=Object.assign(Object.assign({},null===d||void 0===d?void 0:d.style),s);return C(a.createElement(WCe,Object.assign({prefixCls:h,preview:S,rootClassName:y,className:A,style:x},l)))};ife.PreviewGroup=afe;const rfe=ife,sfe=n.p+"static/media/\u8fa8\u8b58\u5716-\u795e\u793e.4177c268b3ad28916c13.mind",lfe=n.p+"static/media/\u86d9\u86d90-\u5099\u7528.6f06188ea8f46fbaaf2f.png",{Content:cfe}=lCe,gfe=()=>{const[e,t]=(0,a.useState)(!1),n=(0,a.useRef)(null),o=(0,a.useCallback)((()=>t(!0)),[]),i=(0,a.useCallback)((()=>{n.current&&n.current.submit()}),[]),r=(0,a.useCallback)(((e,t)=>{}),[]);return(0,Cc.jsxs)(lCe,{style:{minHeight:"100vh",background:"transparent"},children:[" ",(0,Cc.jsxs)(cfe,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[" ",(0,Cc.jsx)(aIe,{imageTargetSrc:sfe,onTargetFound:o,renderARContent:r}),e&&(0,Cc.jsxs)("div",{style:{textAlign:"center",paddingTop:"2rem"},children:[" ",(0,Cc.jsx)(rfe,{src:lfe,alt:"Found Image",style:{maxHeight:"70vh",width:"auto",objectFit:"contain"}}),(0,Cc.jsx)(tc,{type:"primary",onClick:i,size:"large",style:{backgroundColor:"#8b5a2b",borderColor:"#8b5a2b",color:"white",marginTop:"0.5rem"},children:"\u7d50\u675f\u904a\u6232"})]}),(0,Cc.jsxs)("form",{ref:n,action:"/",method:"GET",style:{display:"none"},children:[" ",(0,Cc.jsx)("input",{type:"hidden",name:"dialogIndex",value:"48"})," "]})]})]})};new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(Pke){}new Map;const ufe=o.startTransition;nr.flushSync,o.useId;function dfe(e){let{basename:t,children:n,future:o,window:i}=e,r=a.useRef();var s;null==r.current&&(r.current=(void 0===(s={window:i,v5Compat:!0})&&(s={}),p((function(e,t){let{pathname:n,search:a,hash:o}=e.location;return u("",{pathname:n,search:a,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:d(t)}),null,s)));let l=r.current,[c,g]=a.useState({action:l.action,location:l.location}),{v7_startTransition:h}=o||{},m=a.useCallback((e=>{h&&ufe?ufe((()=>g(e))):g(e)}),[g,h]);return a.useLayoutEffect((()=>l.listen(m)),[l,m]),a.createElement(de,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:l,future:o})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var hfe,pfe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(hfe||(hfe={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(pfe||(pfe={}));const mfe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};var Ife=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:mfe}))};const Cfe=a.forwardRef(Ife);var ffe=function(e){if(Ue()&&window.document.documentElement){var t=Array.isArray(e)?e:[e],n=window.document.documentElement;return t.some((function(e){return e in n.style}))}return!1};function bfe(e,t){return Array.isArray(e)||void 0===t?ffe(e):function(e,t){if(!ffe(e))return!1;var n=document.createElement("div"),a=n.style[e];return n.style[e]=t,n.style[e]!==a}(e,t)}var yfe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Afe={border:0,background:"transparent",padding:0,lineHeight:"inherit",display:"inline-flex"},vfe=a.forwardRef(((e,t)=>{const{style:n,noStyle:o,disabled:i,tabIndex:r=0}=e,s=yfe(e,["style","noStyle","disabled","tabIndex"]);let l={};return o||(l=Object.assign({},Afe)),i&&(l.pointerEvents="none"),l=Object.assign(Object.assign({},l),n),a.createElement("div",Object.assign({role:"button",tabIndex:r,ref:t},s,{onKeyDown:e=>{const{keyCode:t}=e;t===Ac.ENTER&&e.preventDefault()},onKeyUp:t=>{const{keyCode:n}=t,{onClick:a}=e;n===Ac.ENTER&&a&&a()},style:l}))})),Sfe=vfe;function xfe(e){var t=e.children,n=e.prefixCls,o=e.id,i=e.overlayInnerStyle,r=e.className,s=e.style;return a.createElement("div",{className:Ie()("".concat(n,"-content"),r),style:s},a.createElement("div",{className:"".concat(n,"-inner"),id:o,role:"tooltip",style:i},"function"===typeof t?t():t))}var Gfe={shiftX:64,adjustY:1},Zfe={adjustX:1,shiftY:!0},wfe=[0,0],kfe={left:{points:["cr","cl"],overflow:Zfe,offset:[-4,0],targetOffset:wfe},right:{points:["cl","cr"],overflow:Zfe,offset:[4,0],targetOffset:wfe},top:{points:["bc","tc"],overflow:Gfe,offset:[0,-4],targetOffset:wfe},bottom:{points:["tc","bc"],overflow:Gfe,offset:[0,4],targetOffset:wfe},topLeft:{points:["bl","tl"],overflow:Gfe,offset:[0,-4],targetOffset:wfe},leftTop:{points:["tr","tl"],overflow:Zfe,offset:[-4,0],targetOffset:wfe},topRight:{points:["br","tr"],overflow:Gfe,offset:[0,-4],targetOffset:wfe},rightTop:{points:["tl","tr"],overflow:Zfe,offset:[4,0],targetOffset:wfe},bottomRight:{points:["tr","br"],overflow:Gfe,offset:[0,4],targetOffset:wfe},rightBottom:{points:["bl","br"],overflow:Zfe,offset:[4,0],targetOffset:wfe},bottomLeft:{points:["tl","bl"],overflow:Gfe,offset:[0,4],targetOffset:wfe},leftBottom:{points:["br","bl"],overflow:Zfe,offset:[-4,0],targetOffset:wfe}};var Bfe=["overlayClassName","trigger","mouseEnterDelay","mouseLeaveDelay","overlayStyle","prefixCls","children","onVisibleChange","afterVisibleChange","transitionName","animation","motion","placement","align","destroyTooltipOnHide","defaultVisible","getTooltipContainer","overlayInnerStyle","arrowContent","overlay","id","showArrow"],Rfe=function(e,t){var n=e.overlayClassName,o=e.trigger,i=void 0===o?["hover"]:o,r=e.mouseEnterDelay,s=void 0===r?0:r,l=e.mouseLeaveDelay,c=void 0===l?.1:l,g=e.overlayStyle,u=e.prefixCls,d=void 0===u?"rc-tooltip":u,h=e.children,p=e.onVisibleChange,m=e.afterVisibleChange,I=e.transitionName,C=e.animation,f=e.motion,b=e.placement,y=void 0===b?"right":b,A=e.align,v=void 0===A?{}:A,S=e.destroyTooltipOnHide,x=void 0!==S&&S,G=e.defaultVisible,Z=e.getTooltipContainer,w=e.overlayInnerStyle,k=(e.arrowContent,e.overlay),B=e.id,R=e.showArrow,W=void 0===R||R,V=ir(e,Bfe),N=(0,a.useRef)(null);(0,a.useImperativeHandle)(t,(function(){return N.current}));var X=Ke({},V);"visible"in e&&(X.popupVisible=e.visible);return a.createElement(vu,yn({popupClassName:n,prefixCls:d,popup:function(){return a.createElement(xfe,{key:"content",prefixCls:d,id:B,overlayInnerStyle:w},k)},action:i,builtinPlacements:kfe,popupPlacement:y,ref:N,popupAlign:v,getPopupContainer:Z,onPopupVisibleChange:p,afterPopupVisibleChange:m,popupTransitionName:I,popupAnimation:C,popupMotion:f,defaultPopupVisible:G,autoDestroy:x,mouseLeaveDelay:c,popupStyle:g,mouseEnterDelay:s,arrow:W},X),h)};const Wfe=(0,a.forwardRef)(Rfe);const Vfe=(e,t,n)=>{const{sizePopupArrow:a,arrowPolygon:o,arrowPath:i,arrowShadowWidth:r,borderRadiusXS:s,calc:l}=e;return{pointerEvents:"none",width:a,height:a,overflow:"hidden","&::before":{position:"absolute",bottom:0,insetInlineStart:0,width:a,height:l(a).div(2).equal(),background:t,clipPath:{_multi_value_:!0,value:[o,i]},content:'""'},"&::after":{content:'""',position:"absolute",width:r,height:r,bottom:0,insetInline:0,margin:"auto",borderRadius:{_skip_check_:!0,value:"0 0 ".concat(Qt(s)," 0")},transform:"translateY(50%) rotate(-135deg)",boxShadow:n,zIndex:0,background:"transparent"}}},Nfe=8;function Xfe(e){const{contentRadius:t,limitVerticalRadius:n}=e,a=t>12?t+2:12;return{arrowOffsetHorizontal:a,arrowOffsetVertical:n?Nfe:a}}function Mfe(e,t){return e?t:{}}function Tfe(e,t,n){const{componentCls:a,boxShadowPopoverArrow:o,arrowOffsetVertical:i,arrowOffsetHorizontal:r}=e,{arrowDistance:s=0,arrowPlacement:l={left:!0,right:!0,top:!0,bottom:!0}}=n||{};return{[a]:Object.assign(Object.assign(Object.assign(Object.assign({["".concat(a,"-arrow")]:[Object.assign(Object.assign({position:"absolute",zIndex:1,display:"block"},Vfe(e,t,o)),{"&:before":{background:t}})]},Mfe(!!l.top,{[["&-placement-top > ".concat(a,"-arrow"),"&-placement-topLeft > ".concat(a,"-arrow"),"&-placement-topRight > ".concat(a,"-arrow")].join(",")]:{bottom:s,transform:"translateY(100%) rotate(180deg)"},["&-placement-top > ".concat(a,"-arrow")]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(100%) rotate(180deg)"},["&-placement-topLeft > ".concat(a,"-arrow")]:{left:{_skip_check_:!0,value:r}},["&-placement-topRight > ".concat(a,"-arrow")]:{right:{_skip_check_:!0,value:r}}})),Mfe(!!l.bottom,{[["&-placement-bottom > ".concat(a,"-arrow"),"&-placement-bottomLeft > ".concat(a,"-arrow"),"&-placement-bottomRight > ".concat(a,"-arrow")].join(",")]:{top:s,transform:"translateY(-100%)"},["&-placement-bottom > ".concat(a,"-arrow")]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(-100%)"},["&-placement-bottomLeft > ".concat(a,"-arrow")]:{left:{_skip_check_:!0,value:r}},["&-placement-bottomRight > ".concat(a,"-arrow")]:{right:{_skip_check_:!0,value:r}}})),Mfe(!!l.left,{[["&-placement-left > ".concat(a,"-arrow"),"&-placement-leftTop > ".concat(a,"-arrow"),"&-placement-leftBottom > ".concat(a,"-arrow")].join(",")]:{right:{_skip_check_:!0,value:s},transform:"translateX(100%) rotate(90deg)"},["&-placement-left > ".concat(a,"-arrow")]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(100%) rotate(90deg)"},["&-placement-leftTop > ".concat(a,"-arrow")]:{top:i},["&-placement-leftBottom > ".concat(a,"-arrow")]:{bottom:i}})),Mfe(!!l.right,{[["&-placement-right > ".concat(a,"-arrow"),"&-placement-rightTop > ".concat(a,"-arrow"),"&-placement-rightBottom > ".concat(a,"-arrow")].join(",")]:{left:{_skip_check_:!0,value:s},transform:"translateX(-100%) rotate(-90deg)"},["&-placement-right > ".concat(a,"-arrow")]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(-100%) rotate(-90deg)"},["&-placement-rightTop > ".concat(a,"-arrow")]:{top:i},["&-placement-rightBottom > ".concat(a,"-arrow")]:{bottom:i}}))}}const Efe={left:{points:["cr","cl"]},right:{points:["cl","cr"]},top:{points:["bc","tc"]},bottom:{points:["tc","bc"]},topLeft:{points:["bl","tl"]},leftTop:{points:["tr","tl"]},topRight:{points:["br","tr"]},rightTop:{points:["tl","tr"]},bottomRight:{points:["tr","br"]},rightBottom:{points:["bl","br"]},bottomLeft:{points:["tl","bl"]},leftBottom:{points:["br","bl"]}},Ffe={topLeft:{points:["bl","tc"]},leftTop:{points:["tr","cl"]},topRight:{points:["br","tc"]},rightTop:{points:["tl","cr"]},bottomRight:{points:["tr","bc"]},rightBottom:{points:["bl","cr"]},bottomLeft:{points:["tl","bc"]},leftBottom:{points:["br","cl"]}},Hfe=new Set(["topLeft","topRight","bottomLeft","bottomRight","leftTop","leftBottom","rightTop","rightBottom"]);function Jfe(e){const{arrowWidth:t,autoAdjustOverflow:n,arrowPointAtCenter:a,offset:o,borderRadius:i,visibleFirst:r}=e,s=t/2,l={};return Object.keys(Efe).forEach((e=>{const c=a&&Ffe[e]||Efe[e],g=Object.assign(Object.assign({},c),{offset:[0,0],dynamicInset:!0});switch(l[e]=g,Hfe.has(e)&&(g.autoArrow=!1),e){case"top":case"topLeft":case"topRight":g.offset[1]=-s-o;break;case"bottom":case"bottomLeft":case"bottomRight":g.offset[1]=s+o;break;case"left":case"leftTop":case"leftBottom":g.offset[0]=-s-o;break;case"right":case"rightTop":case"rightBottom":g.offset[0]=s+o}const u=Xfe({contentRadius:i,limitVerticalRadius:!0});if(a)switch(e){case"topLeft":case"bottomLeft":g.offset[0]=-u.arrowOffsetHorizontal-s;break;case"topRight":case"bottomRight":g.offset[0]=u.arrowOffsetHorizontal+s;break;case"leftTop":case"rightTop":g.offset[1]=-u.arrowOffsetHorizontal-s;break;case"leftBottom":case"rightBottom":g.offset[1]=u.arrowOffsetHorizontal+s}g.overflow=function(e,t,n,a){if(!1===a)return{adjustX:!1,adjustY:!1};const o=a&&"object"===typeof a?a:{},i={};switch(e){case"top":case"bottom":i.shiftX=2*t.arrowOffsetHorizontal+n,i.shiftY=!0,i.adjustY=!0;break;case"left":case"right":i.shiftY=2*t.arrowOffsetVertical+n,i.shiftX=!0,i.adjustX=!0}const r=Object.assign(Object.assign({},i),o);return r.shiftX||(r.adjustX=!0),r.shiftY||(r.adjustY=!0),r}(e,u,t,n),r&&(g.htmlRegion="visibleFirst")})),l}const Yfe=["blue","purple","cyan","green","magenta","pink","red","orange","yellow","volcano","geekblue","lime","gold"];function Lfe(e,t){return Yfe.reduce(((n,a)=>{const o=e["".concat(a,"1")],i=e["".concat(a,"3")],r=e["".concat(a,"6")],s=e["".concat(a,"7")];return Object.assign(Object.assign({},n),t(a,{lightColor:o,lightBorderColor:i,darkColor:r,textColor:s}))}),{})}const zfe=e=>{const{componentCls:t,tooltipMaxWidth:n,tooltipColor:a,tooltipBg:o,tooltipBorderRadius:i,zIndexPopup:r,controlHeight:s,boxShadowSecondary:l,paddingSM:c,paddingXS:g}=e;return[{[t]:Object.assign(Object.assign(Object.assign(Object.assign({},za(e)),{position:"absolute",zIndex:r,display:"block",width:"max-content",maxWidth:n,visibility:"visible",transformOrigin:"var(--arrow-x, 50%) var(--arrow-y, 50%)","&-hidden":{display:"none"},"--antd-arrow-background-color":o,["".concat(t,"-inner")]:{minWidth:"1em",minHeight:s,padding:"".concat(Qt(e.calc(c).div(2).equal())," ").concat(Qt(g)),color:a,textAlign:"start",textDecoration:"none",wordWrap:"break-word",backgroundColor:o,borderRadius:i,boxShadow:l,boxSizing:"border-box"},[["&-placement-left","&-placement-leftTop","&-placement-leftBottom","&-placement-right","&-placement-rightTop","&-placement-rightBottom"].join(",")]:{["".concat(t,"-inner")]:{borderRadius:e.min(i,Nfe)}},["".concat(t,"-content")]:{position:"relative"}}),Lfe(e,((e,n)=>{let{darkColor:a}=n;return{["&".concat(t,"-").concat(e)]:{["".concat(t,"-inner")]:{backgroundColor:a},["".concat(t,"-arrow")]:{"--antd-arrow-background-color":a}}}}))),{"&-rtl":{direction:"rtl"}})},Tfe(e,"var(--antd-arrow-background-color)"),{["".concat(t,"-pure")]:{position:"relative",maxWidth:"none",margin:e.sizePopupArrow}}]},Kfe=e=>Object.assign(Object.assign({zIndexPopup:e.zIndexPopupBase+70},Xfe({contentRadius:e.borderRadius,limitVerticalRadius:!0})),function(e){const{sizePopupArrow:t,borderRadiusXS:n,borderRadiusOuter:a}=e,o=t/2,i=o,r=1*a/Math.sqrt(2),s=o-a*(1-1/Math.sqrt(2)),l=o-n*(1/Math.sqrt(2)),c=a*(Math.sqrt(2)-1)+n*(1/Math.sqrt(2)),g=2*o-l,u=c,d=2*o-r,h=s,p=2*o-0,m=i,I=o*Math.sqrt(2)+a*(Math.sqrt(2)-2),C=a*(Math.sqrt(2)-1),f="polygon(".concat(C,"px 100%, 50% ").concat(C,"px, ").concat(2*o-C,"px 100%, ").concat(C,"px 100%)");return{arrowShadowWidth:I,arrowPath:"path('M ".concat(0," ").concat(i," A ").concat(a," ").concat(a," 0 0 0 ").concat(r," ").concat(s," L ").concat(l," ").concat(c," A ").concat(n," ").concat(n," 0 0 1 ").concat(g," ").concat(u," L ").concat(d," ").concat(h," A ").concat(a," ").concat(a," 0 0 0 ").concat(p," ").concat(m," Z')"),arrowPolygon:f}}(ri(e,{borderRadiusOuter:Math.min(e.borderRadiusOuter,4)}))),Dfe=function(e){const t=Ii("Tooltip",(e=>{const{borderRadius:t,colorTextLightSolid:n,colorBgSpotlight:a}=e,o=ri(e,{tooltipMaxWidth:250,tooltipColor:n,tooltipBorderRadius:t,tooltipBg:a});return[zfe(o),WC(e,"zoom-big-fast")]}),Kfe,{resetStyle:!1,injectStyle:!(arguments.length>1&&void 0!==arguments[1])||arguments[1]});return t(e)},Ufe=Yfe.map((e=>"".concat(e,"-inverse")));function Pfe(e,t){const n=function(e){return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?Yfe.includes(e):[].concat(Le(Ufe),Le(Yfe)).includes(e)}(t),a=Ie()({["".concat(e,"-").concat(t)]:t&&n}),o={},i={};return t&&!n&&(o.background=t,i["--antd-arrow-background-color"]=t),{className:a,overlayStyle:o,arrowStyle:i}}const Ofe=e=>{const{prefixCls:t,className:n,placement:o="top",title:i,color:r,overlayInnerStyle:s}=e,{getPrefixCls:l}=a.useContext(Be),c=l("tooltip",t),[g,u,d]=Dfe(c),h=Pfe(c,r),p=h.arrowStyle,m=Object.assign(Object.assign({},s),h.overlayStyle),I=Ie()(u,d,c,"".concat(c,"-pure"),"".concat(c,"-placement-").concat(o),n,h.className);return g(a.createElement("div",{className:I,style:p},a.createElement("div",{className:"".concat(c,"-arrow")}),a.createElement(xfe,Object.assign({},e,{className:u,prefixCls:c,overlayInnerStyle:m}),i)))};var _fe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Qfe=a.forwardRef(((e,t)=>{var n,o;const{prefixCls:i,openClassName:r,getTooltipContainer:s,overlayClassName:l,color:c,overlayInnerStyle:g,children:u,afterOpenChange:d,afterVisibleChange:h,destroyTooltipOnHide:p,arrow:m=!0,title:I,overlay:C,builtinPlacements:f,arrowPointAtCenter:b=!1,autoAdjustOverflow:y=!0}=e,A=!!m,[,v]=ai(),{getPopupContainer:S,getPrefixCls:x,direction:G}=a.useContext(Be),Z=Bi("Tooltip"),w=a.useRef(null),k=()=>{var e;null===(e=w.current)||void 0===e||e.forceAlign()};a.useImperativeHandle(t,(()=>{var e;return{forceAlign:k,forcePopupAlign:()=>{Z.deprecated(!1,"forcePopupAlign","forceAlign"),k()},nativeElement:null===(e=w.current)||void 0===e?void 0:e.nativeElement}}));const[B,R]=Wa(!1,{value:null!==(n=e.open)&&void 0!==n?n:e.visible,defaultValue:null!==(o=e.defaultOpen)&&void 0!==o?o:e.defaultVisible}),W=!I&&!C&&0!==I,V=a.useMemo((()=>{var e,t;let n=b;return"object"===typeof m&&(n=null!==(t=null!==(e=m.pointAtCenter)&&void 0!==e?e:m.arrowPointAtCenter)&&void 0!==t?t:b),f||Jfe({arrowPointAtCenter:n,autoAdjustOverflow:y,arrowWidth:A?v.sizePopupArrow:0,borderRadius:v.borderRadius,offset:v.marginXXS,visibleFirst:!0})}),[b,m,f,v]),N=a.useMemo((()=>0===I?I:C||I||""),[C,I]),X=a.createElement(MI,{space:!0},"function"===typeof N?N():N),{getPopupContainer:M,placement:T="top",mouseEnterDelay:E=.1,mouseLeaveDelay:F=.1,overlayStyle:H,rootClassName:J}=e,Y=_fe(e,["getPopupContainer","placement","mouseEnterDelay","mouseLeaveDelay","overlayStyle","rootClassName"]),L=x("tooltip",i),z=x(),K=e["data-popover-inject"];let D=B;"open"in e||"visible"in e||!W||(D=!1);const U=a.isValidElement(u)&&!We(u)?u:a.createElement("span",null,u),P=U.props,O=P.className&&"string"!==typeof P.className?P.className:Ie()(P.className,r||"".concat(L,"-open")),[_,Q,j]=Dfe(L,!K),q=Pfe(L,c),$=q.arrowStyle,ee=Object.assign(Object.assign({},g),q.overlayStyle),te=Ie()(l,{["".concat(L,"-rtl")]:"rtl"===G},q.className,J,Q,j),[ne,ae]=Wd("Tooltip",Y.zIndex),oe=a.createElement(Wfe,Object.assign({},Y,{zIndex:ne,showArrow:A,placement:T,mouseEnterDelay:E,mouseLeaveDelay:F,prefixCls:L,overlayClassName:te,overlayStyle:Object.assign(Object.assign({},$),H),getTooltipContainer:M||s||S,ref:w,builtinPlacements:V,overlay:X,visible:D,onVisibleChange:t=>{var n,a;R(!W&&t),W||(null===(n=e.onOpenChange)||void 0===n||n.call(e,t),null===(a=e.onVisibleChange)||void 0===a||a.call(e,t))},afterVisibleChange:null!==d&&void 0!==d?d:h,overlayInnerStyle:ee,arrowContent:a.createElement("span",{className:"".concat(L,"-arrow-content")}),motion:{motionName:Vd(z,"zoom-big-fast",e.transitionName),motionDeadline:1e3},destroyTooltipOnHide:!!p}),D?Ne(U,{className:O}):U);return _(a.createElement(Zd.Provider,{value:ae},oe))})),jfe=Qfe;jfe._InternalPanelDoNotUseOrYouWillBeFired=Ofe;const qfe=jfe;const $fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 170h-60c-4.4 0-8 3.6-8 8v518H310v-73c0-6.7-7.8-10.5-13-6.3l-141.9 112a8 8 0 000 12.6l141.9 112c5.3 4.2 13 .4 13-6.3v-75h498c35.3 0 64-28.7 64-64V178c0-4.4-3.6-8-8-8z"}}]},name:"enter",theme:"outlined"};var ebe=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:$fe}))};const tbe=a.forwardRef(ebe);function nbe(e,t,n){var a=t.cloneNode(!0),o=Object.create(e,{target:{value:a},currentTarget:{value:a}});return a.value=n,"number"===typeof t.selectionStart&&"number"===typeof t.selectionEnd&&(a.selectionStart=t.selectionStart,a.selectionEnd=t.selectionEnd),a.setSelectionRange=function(){t.setSelectionRange.apply(t,arguments)},o}function abe(e,t,n,a){if(n){var o=t;"click"!==t.type?"file"===e.type||void 0===a?n(o):n(o=nbe(t,e,a)):n(o=nbe(t,e,""))}}var obe=a.forwardRef((function(e,t){var n,o,i=e.inputElement,r=e.children,s=e.prefixCls,l=e.prefix,c=e.suffix,g=e.addonBefore,u=e.addonAfter,d=e.className,h=e.style,p=e.disabled,m=e.readOnly,I=e.focused,C=e.triggerFocus,f=e.allowClear,b=e.value,y=e.handleReset,A=e.hidden,v=e.classes,S=e.classNames,x=e.dataAttrs,G=e.styles,Z=e.components,w=null!==r&&void 0!==r?r:i,k=(null===Z||void 0===Z?void 0:Z.affixWrapper)||"span",B=(null===Z||void 0===Z?void 0:Z.groupWrapper)||"span",R=(null===Z||void 0===Z?void 0:Z.wrapper)||"span",W=(null===Z||void 0===Z?void 0:Z.groupAddon)||"span",V=(0,a.useRef)(null),N=function(e){return!!(e.prefix||e.suffix||e.allowClear)}(e),X=(0,a.cloneElement)(w,{value:b,className:Ie()(w.props.className,!N&&(null===S||void 0===S?void 0:S.variant))||null}),M=(0,a.useRef)(null);if(a.useImperativeHandle(t,(function(){return{nativeElement:M.current||V.current}})),N){var T,E=null;if(f){var F,H=!p&&!m&&b,J="".concat(s,"-clear-icon"),Y="object"===fe(f)&&null!==f&&void 0!==f&&f.clearIcon?f.clearIcon:"\u2716";E=a.createElement("span",{onClick:y,onMouseDown:function(e){return e.preventDefault()},className:Ie()(J,(F={},Me(F,"".concat(J,"-hidden"),!H),Me(F,"".concat(J,"-has-suffix"),!!c),F)),role:"button",tabIndex:-1},Y)}var L="".concat(s,"-affix-wrapper"),z=Ie()(L,(Me(T={},"".concat(s,"-disabled"),p),Me(T,"".concat(L,"-disabled"),p),Me(T,"".concat(L,"-focused"),I),Me(T,"".concat(L,"-readonly"),m),Me(T,"".concat(L,"-input-with-clear-btn"),c&&f&&b),T),null===v||void 0===v?void 0:v.affixWrapper,null===S||void 0===S?void 0:S.affixWrapper,null===S||void 0===S?void 0:S.variant),K=(c||f)&&a.createElement("span",{className:Ie()("".concat(s,"-suffix"),null===S||void 0===S?void 0:S.suffix),style:null===G||void 0===G?void 0:G.suffix},E,c);X=a.createElement(k,yn({className:z,style:null===G||void 0===G?void 0:G.affixWrapper,onClick:function(e){var t;null!==(t=V.current)&&void 0!==t&&t.contains(e.target)&&(null===C||void 0===C||C())}},null===x||void 0===x?void 0:x.affixWrapper,{ref:V}),l&&a.createElement("span",{className:Ie()("".concat(s,"-prefix"),null===S||void 0===S?void 0:S.prefix),style:null===G||void 0===G?void 0:G.prefix},l),X,K)}if(function(e){return!(!e.addonBefore&&!e.addonAfter)}(e)){var D="".concat(s,"-group"),U="".concat(D,"-addon"),P="".concat(D,"-wrapper"),O=Ie()("".concat(s,"-wrapper"),D,null===v||void 0===v?void 0:v.wrapper,null===S||void 0===S?void 0:S.wrapper),_=Ie()(P,Me({},"".concat(P,"-disabled"),p),null===v||void 0===v?void 0:v.group,null===S||void 0===S?void 0:S.groupWrapper);X=a.createElement(B,{className:_,ref:M},a.createElement(R,{className:O},g&&a.createElement(W,{className:U},g),X,u&&a.createElement(W,{className:U},u)))}return a.cloneElement(X,{className:Ie()(null===(n=X.props)||void 0===n?void 0:n.className,d)||null,style:Ke(Ke({},null===(o=X.props)||void 0===o?void 0:o.style),h),hidden:A})}));const ibe=obe;var rbe=["show"];var sbe,lbe=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],cbe={};function gbe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;sbe||((sbe=document.createElement("textarea")).setAttribute("tab-index","-1"),sbe.setAttribute("aria-hidden","true"),document.body.appendChild(sbe)),e.getAttribute("wrap")?sbe.setAttribute("wrap",e.getAttribute("wrap")):sbe.removeAttribute("wrap");var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getAttribute("id")||e.getAttribute("data-reactid")||e.getAttribute("name");if(t&&cbe[n])return cbe[n];var a=window.getComputedStyle(e),o=a.getPropertyValue("box-sizing")||a.getPropertyValue("-moz-box-sizing")||a.getPropertyValue("-webkit-box-sizing"),i=parseFloat(a.getPropertyValue("padding-bottom"))+parseFloat(a.getPropertyValue("padding-top")),r=parseFloat(a.getPropertyValue("border-bottom-width"))+parseFloat(a.getPropertyValue("border-top-width")),s={sizingStyle:lbe.map((function(e){return"".concat(e,":").concat(a.getPropertyValue(e))})).join(";"),paddingSize:i,borderSize:r,boxSizing:o};return t&&n&&(cbe[n]=s),s}(e,t),i=o.paddingSize,r=o.borderSize,s=o.boxSizing,l=o.sizingStyle;sbe.setAttribute("style","".concat(l,";").concat("\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important;\n  pointer-events: none !important;\n")),sbe.value=e.value||e.placeholder||"";var c,g=void 0,u=void 0,d=sbe.scrollHeight;if("border-box"===s?d+=r:"content-box"===s&&(d-=i),null!==n||null!==a){sbe.value=" ";var h=sbe.scrollHeight-i;null!==n&&(g=h*n,"border-box"===s&&(g=g+i+r),d=Math.max(g,d)),null!==a&&(u=h*a,"border-box"===s&&(u=u+i+r),c=d>u?"":"hidden",d=Math.min(u,d))}var p={height:d,overflowY:c,resize:"none"};return g&&(p.minHeight=g),u&&(p.maxHeight=u),p}var ube=["prefixCls","onPressEnter","defaultValue","value","autoSize","onResize","className","style","disabled","onChange","onInternalAutoSize"],dbe=a.forwardRef((function(e,t){var n=e,o=n.prefixCls,i=(n.onPressEnter,n.defaultValue),r=n.value,s=n.autoSize,l=n.onResize,c=n.className,g=n.style,u=n.disabled,d=n.onChange,h=(n.onInternalAutoSize,ir(n,ube)),p=Je(Wa(i,{value:r,postState:function(e){return null!==e&&void 0!==e?e:""}}),2),m=p[0],I=p[1],C=a.useRef();a.useImperativeHandle(t,(function(){return{textArea:C.current}}));var f=Je(a.useMemo((function(){return s&&"object"===fe(s)?[s.minRows,s.maxRows]:[]}),[s]),2),b=f[0],y=f[1],A=!!s,v=Je(a.useState(2),2),S=v[0],x=v[1],G=Je(a.useState(),2),Z=G[0],w=G[1],k=function(){x(0)};on((function(){A&&k()}),[r,b,y,A]),on((function(){if(0===S)x(1);else if(1===S){var e=gbe(C.current,!1,b,y);x(2),w(e)}else!function(){try{if(document.activeElement===C.current){var e=C.current,t=e.selectionStart,n=e.selectionEnd,a=e.scrollTop;C.current.setSelectionRange(t,n),C.current.scrollTop=a}}catch(Pke){}}()}),[S]);var B=a.useRef(),R=function(){Gi.cancel(B.current)};a.useEffect((function(){return R}),[]);var W=A?Z:null,V=Ke(Ke({},g),W);return 0!==S&&1!==S||(V.overflowY="hidden",V.overflowX="hidden"),a.createElement(rg,{onResize:function(e){2===S&&(null===l||void 0===l||l(e),s&&(R(),B.current=Gi((function(){k()}))))},disabled:!(s||l)},a.createElement("textarea",yn({},h,{ref:C,style:V,className:Ie()(o,c,Me({},"".concat(o,"-disabled"),u)),disabled:u,value:m,onChange:function(e){I(e.target.value),null===d||void 0===d||d(e)}})))}));const hbe=dbe;var pbe=["defaultValue","value","onFocus","onBlur","onChange","allowClear","maxLength","onCompositionStart","onCompositionEnd","suffix","prefixCls","showCount","count","className","style","disabled","hidden","classNames","styles","onResize","readOnly"],mbe=a.forwardRef((function(e,t){var n,o=e.defaultValue,i=e.value,r=e.onFocus,s=e.onBlur,l=e.onChange,c=e.allowClear,g=e.maxLength,u=e.onCompositionStart,d=e.onCompositionEnd,h=e.suffix,p=e.prefixCls,m=void 0===p?"rc-textarea":p,I=e.showCount,C=e.count,f=e.className,b=e.style,y=e.disabled,A=e.hidden,v=e.classNames,S=e.styles,x=e.onResize,G=e.readOnly,Z=ir(e,pbe),w=Je(Wa(o,{value:i,defaultValue:o}),2),k=w[0],B=w[1],R=void 0===k||null===k?"":String(k),W=Je(a.useState(!1),2),V=W[0],N=W[1],X=a.useRef(!1),M=Je(a.useState(null),2),T=M[0],E=M[1],F=(0,a.useRef)(null),H=(0,a.useRef)(null),J=function(){var e;return null===(e=H.current)||void 0===e?void 0:e.textArea},Y=function(){J().focus()};(0,a.useImperativeHandle)(t,(function(){var e;return{resizableTextArea:H.current,focus:Y,blur:function(){J().blur()},nativeElement:(null===(e=F.current)||void 0===e?void 0:e.nativeElement)||J()}})),(0,a.useEffect)((function(){N((function(e){return!y&&e}))}),[y]);var L=Je(a.useState(null),2),z=L[0],K=L[1];a.useEffect((function(){var e;z&&(e=J()).setSelectionRange.apply(e,Le(z))}),[z]);var D,U=function(e,t){return a.useMemo((function(){var n={};t&&(n.show="object"===fe(t)&&t.formatter?t.formatter:!!t);var a=n=Ke(Ke({},n),e),o=a.show,i=ir(a,rbe);return Ke(Ke({},i),{},{show:!!o,showFormatter:"function"===typeof o?o:void 0,strategy:i.strategy||function(e){return e.length}})}),[e,t])}(C,I),P=null!==(n=U.max)&&void 0!==n?n:g,O=Number(P)>0,_=U.strategy(R),Q=!!P&&_>P,j=function(e,t){var n=t;!X.current&&U.exceedFormatter&&U.max&&U.strategy(t)>U.max&&t!==(n=U.exceedFormatter(t,{max:U.max}))&&K([J().selectionStart||0,J().selectionEnd||0]),B(n),abe(e.currentTarget,e,l,n)},q=h;U.show&&(D=U.showFormatter?U.showFormatter({value:R,count:_,maxLength:P}):"".concat(_).concat(O?" / ".concat(P):""),q=a.createElement(a.Fragment,null,q,a.createElement("span",{className:Ie()("".concat(m,"-data-count"),null===v||void 0===v?void 0:v.count),style:null===S||void 0===S?void 0:S.count},D)));var $=!Z.autoSize&&!I&&!c;return a.createElement(ibe,{ref:F,value:R,allowClear:c,handleReset:function(e){B(""),Y(),abe(J(),e,l)},suffix:q,prefixCls:m,classNames:Ke(Ke({},v),{},{affixWrapper:Ie()(null===v||void 0===v?void 0:v.affixWrapper,Me(Me({},"".concat(m,"-show-count"),I),"".concat(m,"-textarea-allow-clear"),c))}),disabled:y,focused:V,className:Ie()(f,Q&&"".concat(m,"-out-of-range")),style:Ke(Ke({},b),T&&!$?{height:"auto"}:{}),dataAttrs:{affixWrapper:{"data-count":"string"===typeof D?D:void 0}},hidden:A,readOnly:G},a.createElement(hbe,yn({},Z,{maxLength:g,onKeyDown:function(e){var t=Z.onPressEnter,n=Z.onKeyDown;"Enter"===e.key&&t&&t(e),null===n||void 0===n||n(e)},onChange:function(e){j(e,e.target.value)},onFocus:function(e){N(!0),null===r||void 0===r||r(e)},onBlur:function(e){N(!1),null===s||void 0===s||s(e)},onCompositionStart:function(e){X.current=!0,null===u||void 0===u||u(e)},onCompositionEnd:function(e){X.current=!1,j(e,e.currentTarget.value),null===d||void 0===d||d(e)},className:Ie()(null===v||void 0===v?void 0:v.textarea),style:Ke(Ke({},null===S||void 0===S?void 0:S.textarea),{},{resize:null===b||void 0===b?void 0:b.resize}),disabled:y,prefixCls:m,onResize:function(e){var t;null===x||void 0===x||x(e),null!==(t=J())&&void 0!==t&&t.style.height&&E(!0)},ref:H,readOnly:G})))}));const Ibe=mbe,Cbe=e=>{let t;return"object"===typeof e&&(null===e||void 0===e?void 0:e.clearIcon)?t=e:e&&(t={clearIcon:a.createElement(im,null)}),t};const fbe=e=>({borderColor:e.hoverBorderColor,backgroundColor:e.hoverBg}),bbe=e=>({color:e.colorTextDisabled,backgroundColor:e.colorBgContainerDisabled,borderColor:e.colorBorder,boxShadow:"none",cursor:"not-allowed",opacity:1,"input[disabled], textarea[disabled]":{cursor:"not-allowed"},"&:hover:not([disabled])":Object.assign({},fbe(ri(e,{hoverBorderColor:e.colorBorder,hoverBg:e.colorBgContainerDisabled})))}),ybe=(e,t)=>({background:e.colorBgContainer,borderWidth:e.lineWidth,borderStyle:e.lineType,borderColor:t.borderColor,"&:hover":{borderColor:t.hoverBorderColor,backgroundColor:e.hoverBg},"&:focus, &:focus-within":{borderColor:t.activeBorderColor,boxShadow:t.activeShadow,outline:0,backgroundColor:e.activeBg}}),Abe=(e,t)=>({["&".concat(e.componentCls,"-status-").concat(t.status,":not(").concat(e.componentCls,"-disabled)")]:Object.assign(Object.assign({},ybe(e,t)),{["".concat(e.componentCls,"-prefix, ").concat(e.componentCls,"-suffix")]:{color:t.affixColor}}),["&".concat(e.componentCls,"-status-").concat(t.status).concat(e.componentCls,"-disabled")]:{borderColor:t.borderColor}}),vbe=(e,t)=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ybe(e,{borderColor:e.colorBorder,hoverBorderColor:e.hoverBorderColor,activeBorderColor:e.activeBorderColor,activeShadow:e.activeShadow})),{["&".concat(e.componentCls,"-disabled, &[disabled]")]:Object.assign({},bbe(e))}),Abe(e,{status:"error",borderColor:e.colorError,hoverBorderColor:e.colorErrorBorderHover,activeBorderColor:e.colorError,activeShadow:e.errorActiveShadow,affixColor:e.colorError})),Abe(e,{status:"warning",borderColor:e.colorWarning,hoverBorderColor:e.colorWarningBorderHover,activeBorderColor:e.colorWarning,activeShadow:e.warningActiveShadow,affixColor:e.colorWarning})),t)}),Sbe=(e,t)=>({["&".concat(e.componentCls,"-group-wrapper-status-").concat(t.status)]:{["".concat(e.componentCls,"-group-addon")]:{borderColor:t.addonBorderColor,color:t.addonColor}}}),xbe=e=>({"&-outlined":Object.assign(Object.assign(Object.assign({["".concat(e.componentCls,"-group")]:{"&-addon":{background:e.addonBg,border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder)},"&-addon:first-child":{borderInlineEnd:0},"&-addon:last-child":{borderInlineStart:0}}},Sbe(e,{status:"error",addonBorderColor:e.colorError,addonColor:e.colorErrorText})),Sbe(e,{status:"warning",addonBorderColor:e.colorWarning,addonColor:e.colorWarningText})),{["&".concat(e.componentCls,"-group-wrapper-disabled")]:{["".concat(e.componentCls,"-group-addon")]:Object.assign({},bbe(e))}})}),Gbe=(e,t)=>{const{componentCls:n}=e;return{"&-borderless":Object.assign({background:"transparent",border:"none","&:focus, &:focus-within":{outline:"none"},["&".concat(n,"-disabled, &[disabled]")]:{color:e.colorTextDisabled},["&".concat(n,"-status-error")]:{"&, & input, & textarea":{color:e.colorError}},["&".concat(n,"-status-warning")]:{"&, & input, & textarea":{color:e.colorWarning}}},t)}},Zbe=(e,t)=>({background:t.bg,borderWidth:e.lineWidth,borderStyle:e.lineType,borderColor:"transparent","input&, & input, textarea&, & textarea":{color:null===t||void 0===t?void 0:t.inputColor},"&:hover":{background:t.hoverBg},"&:focus, &:focus-within":{outline:0,borderColor:t.activeBorderColor,backgroundColor:e.activeBg}}),wbe=(e,t)=>({["&".concat(e.componentCls,"-status-").concat(t.status,":not(").concat(e.componentCls,"-disabled)")]:Object.assign(Object.assign({},Zbe(e,t)),{["".concat(e.componentCls,"-prefix, ").concat(e.componentCls,"-suffix")]:{color:t.affixColor}})}),kbe=(e,t)=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Zbe(e,{bg:e.colorFillTertiary,hoverBg:e.colorFillSecondary,activeBorderColor:e.colorPrimary})),{["&".concat(e.componentCls,"-disabled, &[disabled]")]:Object.assign({},bbe(e))}),wbe(e,{status:"error",bg:e.colorErrorBg,hoverBg:e.colorErrorBgHover,activeBorderColor:e.colorError,inputColor:e.colorErrorText,affixColor:e.colorError})),wbe(e,{status:"warning",bg:e.colorWarningBg,hoverBg:e.colorWarningBgHover,activeBorderColor:e.colorWarning,inputColor:e.colorWarningText,affixColor:e.colorWarning})),t)}),Bbe=(e,t)=>({["&".concat(e.componentCls,"-group-wrapper-status-").concat(t.status)]:{["".concat(e.componentCls,"-group-addon")]:{background:t.addonBg,color:t.addonColor}}}),Rbe=e=>({"&-filled":Object.assign(Object.assign(Object.assign({["".concat(e.componentCls,"-group")]:{"&-addon":{background:e.colorFillTertiary},["".concat(e.componentCls,"-filled:not(:focus):not(:focus-within)")]:{"&:not(:first-child)":{borderInlineStart:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorSplit)},"&:not(:last-child)":{borderInlineEnd:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorSplit)}}}},Bbe(e,{status:"error",addonBg:e.colorErrorBg,addonColor:e.colorErrorText})),Bbe(e,{status:"warning",addonBg:e.colorWarningBg,addonColor:e.colorWarningText})),{["&".concat(e.componentCls,"-group-wrapper-disabled")]:{["".concat(e.componentCls,"-group")]:{"&-addon":{background:e.colorFillTertiary,color:e.colorTextDisabled},"&-addon:first-child":{borderInlineStart:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder),borderTop:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder),borderBottom:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder)},"&-addon:last-child":{borderInlineEnd:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder),borderTop:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder),borderBottom:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder)}}}})}),Wbe=e=>{const{paddingBlockLG:t,lineHeightLG:n,borderRadiusLG:a,paddingInlineLG:o}=e;return{padding:"".concat(Qt(t)," ").concat(Qt(o)),fontSize:e.inputFontSizeLG,lineHeight:n,borderRadius:a}},Vbe=e=>({padding:"".concat(Qt(e.paddingBlockSM)," ").concat(Qt(e.paddingInlineSM)),fontSize:e.inputFontSizeSM,borderRadius:e.borderRadiusSM}),Nbe=e=>Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",minWidth:0,padding:"".concat(Qt(e.paddingBlock)," ").concat(Qt(e.paddingInline)),color:e.colorText,fontSize:e.inputFontSize,lineHeight:e.lineHeight,borderRadius:e.borderRadius,transition:"all ".concat(e.motionDurationMid)},(e=>({"&::-moz-placeholder":{opacity:1},"&::placeholder":{color:e,userSelect:"none"},"&:placeholder-shown":{textOverflow:"ellipsis"}}))(e.colorTextPlaceholder)),{"textarea&":{maxWidth:"100%",height:"auto",minHeight:e.controlHeight,lineHeight:e.lineHeight,verticalAlign:"bottom",transition:"all ".concat(e.motionDurationSlow,", height 0s"),resize:"vertical"},"&-lg":Object.assign({},Wbe(e)),"&-sm":Object.assign({},Vbe(e)),"&-rtl, &-textarea-rtl":{direction:"rtl"}}),Xbe=e=>{const{componentCls:t,antCls:n}=e;return{position:"relative",display:"table",width:"100%",borderCollapse:"separate",borderSpacing:0,"&[class*='col-']":{paddingInlineEnd:e.paddingXS,"&:last-child":{paddingInlineEnd:0}},["&-lg ".concat(t,", &-lg > ").concat(t,"-group-addon")]:Object.assign({},Wbe(e)),["&-sm ".concat(t,", &-sm > ").concat(t,"-group-addon")]:Object.assign({},Vbe(e)),["&-lg ".concat(n,"-select-single ").concat(n,"-select-selector")]:{height:e.controlHeightLG},["&-sm ".concat(n,"-select-single ").concat(n,"-select-selector")]:{height:e.controlHeightSM},["> ".concat(t)]:{display:"table-cell","&:not(:first-child):not(:last-child)":{borderRadius:0}},["".concat(t,"-group")]:{"&-addon, &-wrap":{display:"table-cell",width:1,whiteSpace:"nowrap",verticalAlign:"middle","&:not(:first-child):not(:last-child)":{borderRadius:0}},"&-wrap > *":{display:"block !important"},"&-addon":{position:"relative",padding:"0 ".concat(Qt(e.paddingInline)),color:e.colorText,fontWeight:"normal",fontSize:e.inputFontSize,textAlign:"center",borderRadius:e.borderRadius,transition:"all ".concat(e.motionDurationSlow),lineHeight:1,["".concat(n,"-select")]:{margin:"".concat(Qt(e.calc(e.paddingBlock).add(1).mul(-1).equal())," ").concat(Qt(e.calc(e.paddingInline).mul(-1).equal())),["&".concat(n,"-select-single:not(").concat(n,"-select-customize-input):not(").concat(n,"-pagination-size-changer)")]:{["".concat(n,"-select-selector")]:{backgroundColor:"inherit",border:"".concat(Qt(e.lineWidth)," ").concat(e.lineType," transparent"),boxShadow:"none"}},"&-open, &-focused":{["".concat(n,"-select-selector")]:{color:e.colorPrimary}}},["".concat(n,"-cascader-picker")]:{margin:"-9px ".concat(Qt(e.calc(e.paddingInline).mul(-1).equal())),backgroundColor:"transparent",["".concat(n,"-cascader-input")]:{textAlign:"start",border:0,boxShadow:"none"}}}},["".concat(t)]:{width:"100%",marginBottom:0,textAlign:"inherit","&:focus":{zIndex:1,borderInlineEndWidth:1},"&:hover":{zIndex:1,borderInlineEndWidth:1,["".concat(t,"-search-with-button &")]:{zIndex:0}}},["> ".concat(t,":first-child, ").concat(t,"-group-addon:first-child")]:{borderStartEndRadius:0,borderEndEndRadius:0,["".concat(n,"-select ").concat(n,"-select-selector")]:{borderStartEndRadius:0,borderEndEndRadius:0}},["> ".concat(t,"-affix-wrapper")]:{["&:not(:first-child) ".concat(t)]:{borderStartStartRadius:0,borderEndStartRadius:0},["&:not(:last-child) ".concat(t)]:{borderStartEndRadius:0,borderEndEndRadius:0}},["> ".concat(t,":last-child, ").concat(t,"-group-addon:last-child")]:{borderStartStartRadius:0,borderEndStartRadius:0,["".concat(n,"-select ").concat(n,"-select-selector")]:{borderStartStartRadius:0,borderEndStartRadius:0}},["".concat(t,"-affix-wrapper")]:{"&:not(:last-child)":{borderStartEndRadius:0,borderEndEndRadius:0,["".concat(t,"-search &")]:{borderStartStartRadius:e.borderRadius,borderEndStartRadius:e.borderRadius}},["&:not(:first-child), ".concat(t,"-search &:not(:first-child)")]:{borderStartStartRadius:0,borderEndStartRadius:0}},["&".concat(t,"-group-compact")]:Object.assign(Object.assign({display:"block"},{"&::before":{display:"table",content:'""'},"&::after":{display:"table",clear:"both",content:'""'}}),{["".concat(t,"-group-addon, ").concat(t,"-group-wrap, > ").concat(t)]:{"&:not(:first-child):not(:last-child)":{borderInlineEndWidth:e.lineWidth,"&:hover, &:focus":{zIndex:1}}},"& > *":{display:"inline-flex",float:"none",verticalAlign:"top",borderRadius:0},["\n        & > ".concat(t,"-affix-wrapper,\n        & > ").concat(t,"-number-affix-wrapper,\n        & > ").concat(n,"-picker-range\n      ")]:{display:"inline-flex"},"& > *:not(:last-child)":{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal(),borderInlineEndWidth:e.lineWidth},["".concat(t)]:{float:"none"},["& > ".concat(n,"-select > ").concat(n,"-select-selector,\n      & > ").concat(n,"-select-auto-complete ").concat(t,",\n      & > ").concat(n,"-cascader-picker ").concat(t,",\n      & > ").concat(t,"-group-wrapper ").concat(t)]:{borderInlineEndWidth:e.lineWidth,borderRadius:0,"&:hover, &:focus":{zIndex:1}},["& > ".concat(n,"-select-focused")]:{zIndex:1},["& > ".concat(n,"-select > ").concat(n,"-select-arrow")]:{zIndex:1},["& > *:first-child,\n      & > ".concat(n,"-select:first-child > ").concat(n,"-select-selector,\n      & > ").concat(n,"-select-auto-complete:first-child ").concat(t,",\n      & > ").concat(n,"-cascader-picker:first-child ").concat(t)]:{borderStartStartRadius:e.borderRadius,borderEndStartRadius:e.borderRadius},["& > *:last-child,\n      & > ".concat(n,"-select:last-child > ").concat(n,"-select-selector,\n      & > ").concat(n,"-cascader-picker:last-child ").concat(t,",\n      & > ").concat(n,"-cascader-picker-focused:last-child ").concat(t)]:{borderInlineEndWidth:e.lineWidth,borderStartEndRadius:e.borderRadius,borderEndEndRadius:e.borderRadius},["& > ".concat(n,"-select-auto-complete ").concat(t)]:{verticalAlign:"top"},["".concat(t,"-group-wrapper + ").concat(t,"-group-wrapper")]:{marginInlineStart:e.calc(e.lineWidth).mul(-1).equal(),["".concat(t,"-affix-wrapper")]:{borderRadius:0}},["".concat(t,"-group-wrapper:not(:last-child)")]:{["&".concat(t,"-search > ").concat(t,"-group")]:{["& > ".concat(t,"-group-addon > ").concat(t,"-search-button")]:{borderRadius:0},["& > ".concat(t)]:{borderStartStartRadius:e.borderRadius,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:e.borderRadius}}}})}},Mbe=e=>{const{componentCls:t,controlHeightSM:n,lineWidth:a,calc:o}=e,i=o(n).sub(o(a).mul(2)).sub(16).div(2).equal();return{[t]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},za(e)),Nbe(e)),vbe(e)),kbe(e)),Gbe(e)),{'&[type="color"]':{height:e.controlHeight,["&".concat(t,"-lg")]:{height:e.controlHeightLG},["&".concat(t,"-sm")]:{height:n,paddingTop:i,paddingBottom:i}},'&[type="search"]::-webkit-search-cancel-button, &[type="search"]::-webkit-search-decoration':{"-webkit-appearance":"none"}})}},Tbe=e=>{const{componentCls:t}=e;return{["".concat(t,"-clear-icon")]:{margin:0,color:e.colorTextQuaternary,fontSize:e.fontSizeIcon,verticalAlign:-1,cursor:"pointer",transition:"color ".concat(e.motionDurationSlow),"&:hover":{color:e.colorTextTertiary},"&:active":{color:e.colorText},"&-hidden":{visibility:"hidden"},"&-has-suffix":{margin:"0 ".concat(Qt(e.inputAffixPadding))}}}},Ebe=e=>{const{componentCls:t,inputAffixPadding:n,colorTextDescription:a,motionDurationSlow:o,colorIcon:i,colorIconHover:r,iconCls:s}=e,l="".concat(t,"-affix-wrapper");return{[l]:Object.assign(Object.assign(Object.assign(Object.assign({},Nbe(e)),{display:"inline-flex",["&:not(".concat(t,"-disabled):hover")]:{zIndex:1,["".concat(t,"-search-with-button &")]:{zIndex:0}},"&-focused, &:focus":{zIndex:1},["> input".concat(t)]:{padding:0},["> input".concat(t,", > textarea").concat(t)]:{fontSize:"inherit",border:"none",borderRadius:0,outline:"none",background:"transparent",color:"inherit","&::-ms-reveal":{display:"none"},"&:focus":{boxShadow:"none !important"}},"&::before":{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'},["".concat(t)]:{"&-prefix, &-suffix":{display:"flex",flex:"none",alignItems:"center","> *:not(:last-child)":{marginInlineEnd:e.paddingXS}},"&-show-count-suffix":{color:a},"&-show-count-has-suffix":{marginInlineEnd:e.paddingXXS},"&-prefix":{marginInlineEnd:n},"&-suffix":{marginInlineStart:n}}}),Tbe(e)),{["".concat(s).concat(t,"-password-icon")]:{color:i,cursor:"pointer",transition:"all ".concat(o),"&:hover":{color:r}}})}},Fbe=e=>{const{componentCls:t,borderRadiusLG:n,borderRadiusSM:a}=e;return{["".concat(t,"-group")]:Object.assign(Object.assign(Object.assign({},za(e)),Xbe(e)),{"&-rtl":{direction:"rtl"},"&-wrapper":Object.assign(Object.assign(Object.assign({display:"inline-block",width:"100%",textAlign:"start",verticalAlign:"top","&-rtl":{direction:"rtl"},"&-lg":{["".concat(t,"-group-addon")]:{borderRadius:n,fontSize:e.inputFontSizeLG}},"&-sm":{["".concat(t,"-group-addon")]:{borderRadius:a}}},xbe(e)),Rbe(e)),{["&:not(".concat(t,"-compact-first-item):not(").concat(t,"-compact-last-item)").concat(t,"-compact-item")]:{["".concat(t,", ").concat(t,"-group-addon")]:{borderRadius:0}},["&:not(".concat(t,"-compact-last-item)").concat(t,"-compact-first-item")]:{["".concat(t,", ").concat(t,"-group-addon")]:{borderStartEndRadius:0,borderEndEndRadius:0}},["&:not(".concat(t,"-compact-first-item)").concat(t,"-compact-last-item")]:{["".concat(t,", ").concat(t,"-group-addon")]:{borderStartStartRadius:0,borderEndStartRadius:0}},["&:not(".concat(t,"-compact-last-item)").concat(t,"-compact-item")]:{["".concat(t,"-affix-wrapper")]:{borderStartEndRadius:0,borderEndEndRadius:0}}})})}},Hbe=e=>{const{componentCls:t,antCls:n}=e,a="".concat(t,"-search");return{[a]:{["".concat(t)]:{"&:hover, &:focus":{borderColor:e.colorPrimaryHover,["+ ".concat(t,"-group-addon ").concat(a,"-button:not(").concat(n,"-btn-primary)")]:{borderInlineStartColor:e.colorPrimaryHover}}},["".concat(t,"-affix-wrapper")]:{borderRadius:0},["".concat(t,"-lg")]:{lineHeight:e.calc(e.lineHeightLG).sub(2e-4).equal()},["> ".concat(t,"-group")]:{["> ".concat(t,"-group-addon:last-child")]:{insetInlineStart:-1,padding:0,border:0,["".concat(a,"-button")]:{marginInlineEnd:-1,paddingTop:0,paddingBottom:0,borderStartStartRadius:0,borderStartEndRadius:e.borderRadius,borderEndEndRadius:e.borderRadius,borderEndStartRadius:0,boxShadow:"none"},["".concat(a,"-button:not(").concat(n,"-btn-primary)")]:{color:e.colorTextDescription,"&:hover":{color:e.colorPrimaryHover},"&:active":{color:e.colorPrimaryActive},["&".concat(n,"-btn-loading::before")]:{insetInlineStart:0,insetInlineEnd:0,insetBlockStart:0,insetBlockEnd:0}}}},["".concat(a,"-button")]:{height:e.controlHeight,"&:hover, &:focus":{zIndex:1}},["&-large ".concat(a,"-button")]:{height:e.controlHeightLG},["&-small ".concat(a,"-button")]:{height:e.controlHeightSM},"&-rtl":{direction:"rtl"},["&".concat(t,"-compact-item")]:{["&:not(".concat(t,"-compact-last-item)")]:{["".concat(t,"-group-addon")]:{["".concat(t,"-search-button")]:{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal(),borderRadius:0}}},["&:not(".concat(t,"-compact-first-item)")]:{["".concat(t,",").concat(t,"-affix-wrapper")]:{borderRadius:0}},["> ".concat(t,"-group-addon ").concat(t,"-search-button,\n        > ").concat(t,",\n        ").concat(t,"-affix-wrapper")]:{"&:hover, &:focus, &:active":{zIndex:2}},["> ".concat(t,"-affix-wrapper-focused")]:{zIndex:2}}}}},Jbe=e=>{const{componentCls:t,paddingLG:n}=e,a="".concat(t,"-textarea");return{[a]:{position:"relative","&-show-count":{["> ".concat(t)]:{height:"100%"},["".concat(t,"-data-count")]:{position:"absolute",bottom:e.calc(e.fontSize).mul(e.lineHeight).mul(-1).equal(),insetInlineEnd:0,color:e.colorTextDescription,whiteSpace:"nowrap",pointerEvents:"none"}},["\n        &-allow-clear > ".concat(t,",\n        &-affix-wrapper").concat(a,"-has-feedback ").concat(t,"\n      ")]:{paddingInlineEnd:n},["&-affix-wrapper".concat(t,"-affix-wrapper")]:{padding:0,["> textarea".concat(t)]:{fontSize:"inherit",border:"none",outline:"none",background:"transparent","&:focus":{boxShadow:"none !important"}},["".concat(t,"-suffix")]:{margin:0,"> *:not(:last-child)":{marginInline:0},["".concat(t,"-clear-icon")]:{position:"absolute",insetInlineEnd:e.paddingXS,insetBlockStart:e.paddingXS},["".concat(a,"-suffix")]:{position:"absolute",top:0,insetInlineEnd:e.paddingInline,bottom:0,zIndex:1,display:"inline-flex",alignItems:"center",margin:"auto",pointerEvents:"none"}}}}}},Ybe=e=>{const{componentCls:t}=e;return{["".concat(t,"-out-of-range")]:{["&, & input, & textarea, ".concat(t,"-show-count-suffix, ").concat(t,"-data-count")]:{color:e.colorError}}}},Lbe=Ii("Input",(e=>{const t=ri(e,function(e){return ri(e,{inputAffixPadding:e.paddingXXS})}(e));return[Mbe(t),Jbe(t),Ebe(t),Fbe(t),Hbe(t),Ybe(t),Pl(t)]}),(e=>{const{controlHeight:t,fontSize:n,lineHeight:a,lineWidth:o,controlHeightSM:i,controlHeightLG:r,fontSizeLG:s,lineHeightLG:l,paddingSM:c,controlPaddingHorizontalSM:g,controlPaddingHorizontal:u,colorFillAlter:d,colorPrimaryHover:h,colorPrimary:p,controlOutlineWidth:m,controlOutline:I,colorErrorOutline:C,colorWarningOutline:f,colorBgContainer:b}=e;return{paddingBlock:Math.max(Math.round((t-n*a)/2*10)/10-o,0),paddingBlockSM:Math.max(Math.round((i-n*a)/2*10)/10-o,0),paddingBlockLG:Math.ceil((r-s*l)/2*10)/10-o,paddingInline:c-o,paddingInlineSM:g-o,paddingInlineLG:u-o,addonBg:d,activeBorderColor:p,hoverBorderColor:h,activeShadow:"0 0 0 ".concat(m,"px ").concat(I),errorActiveShadow:"0 0 0 ".concat(m,"px ").concat(C),warningActiveShadow:"0 0 0 ".concat(m,"px ").concat(f),hoverBg:b,activeBg:b,inputFontSize:n,inputFontSizeLG:s,inputFontSizeSM:n}}),{resetFont:!1});var zbe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Kbe=(0,a.forwardRef)(((e,t)=>{var n,o;const{prefixCls:i,bordered:r=!0,size:s,disabled:l,status:c,allowClear:g,classNames:u,rootClassName:d,className:h,style:p,styles:m,variant:I}=e,C=zbe(e,["prefixCls","bordered","size","disabled","status","allowClear","classNames","rootClassName","className","style","styles","variant"]);const{getPrefixCls:f,direction:b,textArea:y}=a.useContext(Be),A=Ts(s),v=a.useContext(Pi),S=null!==l&&void 0!==l?l:v,{status:x,hasFeedback:G,feedbackIcon:Z}=a.useContext(sp),w=Td(x,c),k=a.useRef(null);a.useImperativeHandle(t,(()=>{var e;return{resizableTextArea:null===(e=k.current)||void 0===e?void 0:e.resizableTextArea,focus:e=>{var t,n;!function(e,t){if(!e)return;e.focus(t);const{cursor:n}=t||{};if(n){const t=e.value.length;switch(n){case"start":e.setSelectionRange(0,0);break;case"end":e.setSelectionRange(t,t);break;default:e.setSelectionRange(0,t)}}}(null===(n=null===(t=k.current)||void 0===t?void 0:t.resizableTextArea)||void 0===n?void 0:n.textArea,e)},blur:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.blur()}}}));const B=f("input",i),R=Od(B),[W,V,N]=Lbe(B,R),[X,M]=gp("textArea",I,r),T=Cbe(null!==g&&void 0!==g?g:null===y||void 0===y?void 0:y.allowClear);return W(a.createElement(Ibe,Object.assign({autoComplete:null===y||void 0===y?void 0:y.autoComplete},C,{style:Object.assign(Object.assign({},null===y||void 0===y?void 0:y.style),p),styles:Object.assign(Object.assign({},null===y||void 0===y?void 0:y.styles),m),disabled:S,allowClear:T,className:Ie()(N,R,h,d,null===y||void 0===y?void 0:y.className),classNames:Object.assign(Object.assign(Object.assign({},u),null===y||void 0===y?void 0:y.classNames),{textarea:Ie()({["".concat(B,"-sm")]:"small"===A,["".concat(B,"-lg")]:"large"===A},V,null===u||void 0===u?void 0:u.textarea,null===(n=null===y||void 0===y?void 0:y.classNames)||void 0===n?void 0:n.textarea),variant:Ie()({["".concat(B,"-").concat(X)]:M},Md(B,w)),affixWrapper:Ie()("".concat(B,"-textarea-affix-wrapper"),{["".concat(B,"-affix-wrapper-rtl")]:"rtl"===b,["".concat(B,"-affix-wrapper-sm")]:"small"===A,["".concat(B,"-affix-wrapper-lg")]:"large"===A,["".concat(B,"-textarea-show-count")]:e.showCount||(null===(o=e.count)||void 0===o?void 0:o.show)},V)}),prefixCls:B,suffix:G&&a.createElement("span",{className:"".concat(B,"-textarea-suffix")},Z),ref:k})))})),Dbe=Kbe,Ube=e=>({color:e.colorLink,textDecoration:"none",outline:"none",cursor:"pointer",transition:"color ".concat(e.motionDurationSlow),"&:focus, &:hover":{color:e.colorLinkHover},"&:active":{color:e.colorLinkActive}}),Pbe=e=>{const t={};return[1,2,3,4,5].forEach((n=>{t["\n      h".concat(n,"&,\n      div&-h").concat(n,",\n      div&-h").concat(n," > textarea,\n      h").concat(n,"\n    ")]=((e,t,n,a)=>{const{titleMarginBottom:o,fontWeightStrong:i}=a;return{marginBottom:o,color:n,fontWeight:i,fontSize:e,lineHeight:t}})(e["fontSizeHeading".concat(n)],e["lineHeightHeading".concat(n)],e.colorTextHeading,e)})),t},Obe=e=>{const{componentCls:t}=e;return{"a&, a":Object.assign(Object.assign({},Ube(e)),{textDecoration:e.linkDecoration,"&:active, &:hover":{textDecoration:e.linkHoverDecoration},["&[disabled], &".concat(t,"-disabled")]:{color:e.colorTextDisabled,cursor:"not-allowed","&:active, &:hover":{color:e.colorTextDisabled},"&:active":{pointerEvents:"none"}}})}},_be=e=>({code:{margin:"0 0.2em",paddingInline:"0.4em",paddingBlock:"0.2em 0.1em",fontSize:"85%",fontFamily:e.fontFamilyCode,background:"rgba(150, 150, 150, 0.1)",border:"1px solid rgba(100, 100, 100, 0.2)",borderRadius:3},kbd:{margin:"0 0.2em",paddingInline:"0.4em",paddingBlock:"0.15em 0.1em",fontSize:"90%",fontFamily:e.fontFamilyCode,background:"rgba(150, 150, 150, 0.06)",border:"1px solid rgba(100, 100, 100, 0.2)",borderBottomWidth:2,borderRadius:3},mark:{padding:0,backgroundColor:Vo[2]},"u, ins":{textDecoration:"underline",textDecorationSkipInk:"auto"},"s, del":{textDecoration:"line-through"},strong:{fontWeight:600},"ul, ol":{marginInline:0,marginBlock:"0 1em",padding:0,li:{marginInline:"20px 0",marginBlock:0,paddingInline:"4px 0",paddingBlock:0}},ul:{listStyleType:"circle",ul:{listStyleType:"disc"}},ol:{listStyleType:"decimal"},"pre, blockquote":{margin:"1em 0"},pre:{padding:"0.4em 0.6em",whiteSpace:"pre-wrap",wordWrap:"break-word",background:"rgba(150, 150, 150, 0.1)",border:"1px solid rgba(100, 100, 100, 0.2)",borderRadius:3,fontFamily:e.fontFamilyCode,code:{display:"inline",margin:0,padding:0,fontSize:"inherit",fontFamily:"inherit",background:"transparent",border:0}},blockquote:{paddingInline:"0.6em 0",paddingBlock:0,borderInlineStart:"4px solid rgba(100, 100, 100, 0.2)",opacity:.85}}),Qbe=e=>{const{componentCls:t,paddingSM:n}=e,a=n;return{"&-edit-content":{position:"relative","div&":{insetInlineStart:e.calc(e.paddingSM).mul(-1).equal(),marginTop:e.calc(a).mul(-1).equal(),marginBottom:"calc(1em - ".concat(Qt(a),")")},["".concat(t,"-edit-content-confirm")]:{position:"absolute",insetInlineEnd:e.calc(e.marginXS).add(2).equal(),insetBlockEnd:e.marginXS,color:e.colorTextDescription,fontWeight:"normal",fontSize:e.fontSize,fontStyle:"normal",pointerEvents:"none"},textarea:{margin:"0!important",MozTransition:"none",height:"1em"}}}},jbe=e=>({["".concat(e.componentCls,"-copy-success")]:{"\n    &,\n    &:hover,\n    &:focus":{color:e.colorSuccess}},["".concat(e.componentCls,"-copy-icon-only")]:{marginInlineStart:0}}),qbe=e=>{const{componentCls:t,titleMarginTop:n}=e;return{[t]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:e.colorText,wordBreak:"break-word",lineHeight:e.lineHeight,["&".concat(t,"-secondary")]:{color:e.colorTextDescription},["&".concat(t,"-success")]:{color:e.colorSuccess},["&".concat(t,"-warning")]:{color:e.colorWarning},["&".concat(t,"-danger")]:{color:e.colorError,"a&:active, a&:focus":{color:e.colorErrorActive},"a&:hover":{color:e.colorErrorHover}},["&".concat(t,"-disabled")]:{color:e.colorTextDisabled,cursor:"not-allowed",userSelect:"none"},"\n        div&,\n        p\n      ":{marginBottom:"1em"}},Pbe(e)),{["\n      & + h1".concat(t,",\n      & + h2").concat(t,",\n      & + h3").concat(t,",\n      & + h4").concat(t,",\n      & + h5").concat(t,"\n      ")]:{marginTop:n},"\n      div,\n      ul,\n      li,\n      p,\n      h1,\n      h2,\n      h3,\n      h4,\n      h5":{"\n        + h1,\n        + h2,\n        + h3,\n        + h4,\n        + h5\n        ":{marginTop:n}}}),_be(e)),Obe(e)),{["\n        ".concat(t,"-expand,\n        ").concat(t,"-collapse,\n        ").concat(t,"-edit,\n        ").concat(t,"-copy\n      ")]:Object.assign(Object.assign({},Ube(e)),{marginInlineStart:e.marginXXS})}),Qbe(e)),jbe(e)),{"\n  a&-ellipsis,\n  span&-ellipsis\n  ":{display:"inline-block",maxWidth:"100%"},"&-ellipsis-single-line":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis","a&, span&":{verticalAlign:"bottom"},"> code":{paddingBlock:0,maxWidth:"calc(100% - 1.2em)",display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",verticalAlign:"bottom",boxSizing:"content-box"}},"&-ellipsis-multiple-line":{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:3,WebkitBoxOrient:"vertical"}}),{"&-rtl":{direction:"rtl"}})}},$be=Ii("Typography",(e=>[qbe(e)]),(()=>({titleMarginTop:"1.2em",titleMarginBottom:"0.5em"}))),eye=e=>{const{prefixCls:t,"aria-label":n,className:o,style:i,direction:r,maxLength:s,autoSize:l=!0,value:c,onSave:g,onCancel:u,onEnd:d,component:h,enterIcon:p=a.createElement(tbe,null)}=e,m=a.useRef(null),I=a.useRef(!1),C=a.useRef(),[f,b]=a.useState(c);a.useEffect((()=>{b(c)}),[c]),a.useEffect((()=>{var e;if(null===(e=m.current)||void 0===e?void 0:e.resizableTextArea){const{textArea:e}=m.current.resizableTextArea;e.focus();const{length:t}=e.value;e.setSelectionRange(t,t)}}),[]);const y=()=>{g(f.trim())},A=h?"".concat(t,"-").concat(h):"",[v,S,x]=$be(t),G=Ie()(t,"".concat(t,"-edit-content"),{["".concat(t,"-rtl")]:"rtl"===r},o,A,S,x);return v(a.createElement("div",{className:G,style:i},a.createElement(Dbe,{ref:m,maxLength:s,value:f,onChange:e=>{let{target:t}=e;b(t.value.replace(/[\n\r]/g,""))},onKeyDown:e=>{let{keyCode:t}=e;I.current||(C.current=t)},onKeyUp:e=>{let{keyCode:t,ctrlKey:n,altKey:a,metaKey:o,shiftKey:i}=e;C.current!==t||I.current||n||a||o||i||(t===Ac.ENTER?(y(),null===d||void 0===d||d()):t===Ac.ESC&&u())},onCompositionStart:()=>{I.current=!0},onCompositionEnd:()=>{I.current=!1},onBlur:()=>{y()},"aria-label":n,rows:1,autoSize:l}),null!==p?Ne(p,{className:"".concat(t,"-edit-content-confirm")}):null))};var tye=n(646),nye=n.n(tye),aye=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function r(e){try{l(a.next(e))}catch(Pke){i(Pke)}}function s(e){try{l(a.throw(e))}catch(Pke){i(Pke)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((a=a.apply(e,t||[])).next())}))};const oye=e=>{let{copyConfig:t,children:n}=e;const[o,i]=a.useState(!1),[r,s]=a.useState(!1),l=a.useRef(null),c=()=>{l.current&&clearTimeout(l.current)},g={};t.format&&(g.format=t.format),a.useEffect((()=>c),[]);const u=ka((e=>aye(void 0,void 0,void 0,(function*(){var a;null===e||void 0===e||e.preventDefault(),null===e||void 0===e||e.stopPropagation(),s(!0);try{const o="function"===typeof t.text?yield t.text():t.text;nye()(o||String(n)||"",g),s(!1),i(!0),c(),l.current=setTimeout((()=>{i(!1)}),3e3),null===(a=t.onCopy)||void 0===a||a.call(t,e)}catch(o){throw s(!1),o}}))));return{copied:o,copyLoading:r,onClick:u}};function iye(e,t){return a.useMemo((()=>{const n=!!e;return[n,Object.assign(Object.assign({},t),n&&"object"===typeof e?e:null)]}),[e])}const rye=e=>{const t=(0,a.useRef)();return(0,a.useEffect)((()=>{t.current=e})),t.current},sye=(e,t)=>{const n=a.useRef(!1);a.useEffect((()=>{n.current?e():n.current=!0}),t)};var lye=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const cye=a.forwardRef(((e,t)=>{const{prefixCls:n,component:o="article",className:i,rootClassName:r,setContentRef:s,children:l,direction:c,style:g}=e,u=lye(e,["prefixCls","component","className","rootClassName","setContentRef","children","direction","style"]),{getPrefixCls:d,direction:h,typography:p}=a.useContext(Be),m=null!==c&&void 0!==c?c:h;let I=t;s&&(I=ve(t,s));const C=d("typography",n),[f,b,y]=$be(C),A=Ie()(C,null===p||void 0===p?void 0:p.className,{["".concat(C,"-rtl")]:"rtl"===m},i,r,b,y),v=Object.assign(Object.assign({},null===p||void 0===p?void 0:p.style),g);return f(a.createElement(o,Object.assign({className:A,style:v,ref:I},u),l))}));const gye=cye;const uye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"};var dye=function(e,t){return a.createElement(hl,yn({},e,{ref:t,icon:uye}))};const hye=a.forwardRef(dye);function pye(e){return!1===e?[!1,!1]:Array.isArray(e)?e:[e]}function mye(e,t,n){return!0===e||void 0===e?t:e||n&&t}const Iye=e=>{const{prefixCls:t,copied:n,locale:o,iconOnly:i,tooltips:r,icon:s,loading:l,tabIndex:c,onCopy:g}=e,u=pye(r),d=pye(s),{copied:h,copy:p}=null!==o&&void 0!==o?o:{},m=n?mye(u[1],h):mye(u[0],p),I="string"===typeof m?m:n?h:p;return a.createElement(qfe,{key:"copy",title:m},a.createElement(Sfe,{className:Ie()("".concat(t,"-copy"),{["".concat(t,"-copy-success")]:n,["".concat(t,"-copy-icon-only")]:i}),onClick:g,"aria-label":I,tabIndex:c},n?mye(d[1],a.createElement(nm,null),!0):mye(d[0],l?a.createElement(ml,null):a.createElement(hye,null),!0)))},Cye=a.forwardRef(((e,t)=>{let{style:n,children:o}=e;const i=a.useRef(null);return a.useImperativeHandle(t,(()=>({isExceed:()=>{const e=i.current;return e.scrollHeight>e.clientHeight},getHeight:()=>i.current.clientHeight}))),a.createElement("span",{"aria-hidden":!0,ref:i,style:Object.assign({position:"fixed",display:"block",left:0,top:0,pointerEvents:"none",backgroundColor:"rgba(255, 0, 0, 0.65)"},n)},o)}));function fye(e){const t=typeof e;return"string"===t||"number"===t}function bye(e,t){let n=0;const a=[];for(let o=0;o<e.length;o+=1){if(n===t)return a;const i=e[o],r=n+(fye(i)?String(i).length:1);if(r>t){const e=t-n;return a.push(String(i).slice(0,e)),a}a.push(i),n=r}return e}const yye={display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical"};function Aye(e){const{enableMeasure:t,width:n,text:o,children:i,rows:r,expanded:s,miscDeps:l,onEllipsis:c}=e,g=a.useMemo((()=>Es(o)),[o]),u=a.useMemo((()=>function(e){let t=0;return e.forEach((e=>{fye(e)?t+=String(e).length:t+=1})),t}(g)),[o]),d=a.useMemo((()=>i(g,!1)),[o]),[h,p]=a.useState(null),m=a.useRef(null),I=a.useRef(null),C=a.useRef(null),f=a.useRef(null),b=a.useRef(null),[y,A]=a.useState(!1),[v,S]=a.useState(0),[x,G]=a.useState(0),[Z,w]=a.useState(null);on((()=>{S(t&&n&&u?1:0)}),[n,o,r,t,g]),on((()=>{var e,t,n,a;if(1===v){S(2);const e=I.current&&getComputedStyle(I.current).whiteSpace;w(e)}else if(2===v){const o=!!(null===(e=C.current)||void 0===e?void 0:e.isExceed());S(o?3:4),p(o?[0,u]:null),A(o);const i=(null===(t=C.current)||void 0===t?void 0:t.getHeight())||0,s=(1===r?0:(null===(n=f.current)||void 0===n?void 0:n.getHeight())||0)+((null===(a=b.current)||void 0===a?void 0:a.getHeight())||0),l=Math.max(i,s);G(l+1),c(o)}}),[v]);const k=h?Math.ceil((h[0]+h[1])/2):0;on((()=>{var e;const[t,n]=h||[0,0];if(t!==n){const a=((null===(e=m.current)||void 0===e?void 0:e.getHeight())||0)>x;let o=k;n-t===1&&(o=a?t:n),p(a?[t,o]:[o,n])}}),[h,k]);const B=a.useMemo((()=>{if(3!==v||!h||h[0]!==h[1]){const e=i(g,!1);return 4!==v&&0!==v?a.createElement("span",{style:Object.assign(Object.assign({},yye),{WebkitLineClamp:r})},e):e}return i(s?g:bye(g,h[0]),y)}),[s,v,h,g].concat(Le(l))),R={width:n,margin:0,padding:0,whiteSpace:"nowrap"===Z?"normal":"inherit"};return a.createElement(a.Fragment,null,B,2===v&&a.createElement(a.Fragment,null,a.createElement(Cye,{style:Object.assign(Object.assign(Object.assign({},R),yye),{WebkitLineClamp:r}),ref:C},d),a.createElement(Cye,{style:Object.assign(Object.assign(Object.assign({},R),yye),{WebkitLineClamp:r-1}),ref:f},d),a.createElement(Cye,{style:Object.assign(Object.assign(Object.assign({},R),yye),{WebkitLineClamp:1}),ref:b},i([],!0))),3===v&&h&&h[0]!==h[1]&&a.createElement(Cye,{style:Object.assign(Object.assign({},R),{top:400}),ref:m},i(bye(g,k),!0)),1===v&&a.createElement("span",{style:{whiteSpace:"inherit"},ref:I}))}const vye=e=>{let{enableEllipsis:t,isEllipsis:n,children:o,tooltipProps:i}=e;return(null===i||void 0===i?void 0:i.title)&&t?a.createElement(qfe,Object.assign({open:!!n&&void 0},i),o):o};var Sye=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const xye=a.forwardRef(((e,t)=>{var n,o,i;const{prefixCls:r,className:s,style:l,type:c,disabled:g,children:u,ellipsis:d,editable:h,copyable:p,component:m,title:I}=e,C=Sye(e,["prefixCls","className","style","type","disabled","children","ellipsis","editable","copyable","component","title"]),{getPrefixCls:f,direction:b}=a.useContext(Be),[y]=Ed("Text"),A=a.useRef(null),v=a.useRef(null),S=f("typography",r),x=Ce(C,["mark","code","delete","underline","strong","keyboard","italic"]),[G,Z]=iye(h),[w,k]=Wa(!1,{value:Z.editing}),{triggerType:B=["icon"]}=Z,R=e=>{var t;e&&(null===(t=Z.onStart)||void 0===t||t.call(Z)),k(e)},W=rye(w);sye((()=>{var e;!w&&W&&(null===(e=v.current)||void 0===e||e.focus())}),[w]);const V=e=>{null===e||void 0===e||e.preventDefault(),R(!0)},N=e=>{var t;null===(t=Z.onChange)||void 0===t||t.call(Z,e),R(!1)},X=()=>{var e;null===(e=Z.onCancel)||void 0===e||e.call(Z),R(!1)},[M,T]=iye(p),{copied:E,copyLoading:F,onClick:H}=oye({copyConfig:T,children:u}),[J,Y]=a.useState(!1),[L,z]=a.useState(!1),[K,D]=a.useState(!1),[U,P]=a.useState(!1),[O,_]=a.useState(!0),[Q,j]=iye(d,{expandable:!1,symbol:e=>e?null===y||void 0===y?void 0:y.collapse:null===y||void 0===y?void 0:y.expand}),[q,$]=Wa(j.defaultExpanded||!1,{value:j.expanded}),ee=Q&&(!q||"collapsible"===j.expandable),{rows:te=1}=j,ne=a.useMemo((()=>ee&&(void 0!==j.suffix||j.onEllipsis||j.expandable||G||M)),[ee,j,G,M]);on((()=>{Q&&!ne&&(Y(bfe("webkitLineClamp")),z(bfe("textOverflow")))}),[ne,Q]);const[ae,oe]=a.useState(ee),ie=a.useMemo((()=>!ne&&(1===te?L:J)),[ne,L,J]);on((()=>{oe(ie&&ee)}),[ie,ee]);const re=ee&&(ae?U:K),se=ee&&1===te&&ae,le=ee&&te>1&&ae,[ce,ge]=a.useState(0),ue=e=>{var t;D(e),K!==e&&(null===(t=j.onEllipsis)||void 0===t||t.call(j,e))};a.useEffect((()=>{const e=A.current;if(Q&&ae&&e){const t=le?e.offsetHeight<e.scrollHeight:e.offsetWidth<e.scrollWidth;U!==t&&P(t)}}),[Q,ae,u,le,O,ce]),a.useEffect((()=>{const e=A.current;if("undefined"===typeof IntersectionObserver||!e||!ae||!ee)return;const t=new IntersectionObserver((()=>{_(!!e.offsetParent)}));return t.observe(e),()=>{t.disconnect()}}),[ae,ee]);let de={};de=!0===j.tooltip?{title:null!==(n=Z.text)&&void 0!==n?n:u}:a.isValidElement(j.tooltip)?{title:j.tooltip}:"object"===typeof j.tooltip?Object.assign({title:null!==(o=Z.text)&&void 0!==o?o:u},j.tooltip):{title:j.tooltip};const he=a.useMemo((()=>{const e=e=>["string","number"].includes(typeof e);if(Q&&!ae)return e(Z.text)?Z.text:e(u)?u:e(I)?I:e(de.title)?de.title:void 0}),[Q,ae,I,de.title,re]);if(w)return a.createElement(eye,{value:null!==(i=Z.text)&&void 0!==i?i:"string"===typeof u?u:"",onSave:N,onCancel:X,onEnd:Z.onEnd,prefixCls:S,className:s,style:l,direction:b,component:m,maxLength:Z.maxLength,autoSize:Z.autoSize,enterIcon:Z.enterIcon});const pe=()=>{const{expandable:e,symbol:t}=j;return e?q&&"collapsible"!==e?null:a.createElement(Sfe,{key:"expand",className:"".concat(S,"-").concat(q?"collapse":"expand"),onClick:e=>((e,t)=>{var n;$(t.expanded),null===(n=j.onExpand)||void 0===n||n.call(j,e,t)})(e,{expanded:!q}),"aria-label":q?y.collapse:null===y||void 0===y?void 0:y.expand},"function"===typeof t?t(q):t):null},me=()=>{if(!G)return;const{icon:e,tooltip:t,tabIndex:n}=Z,o=Es(t)[0]||(null===y||void 0===y?void 0:y.edit),i="string"===typeof o?o:"";return B.includes("icon")?a.createElement(qfe,{key:"edit",title:!1===t?"":o},a.createElement(Sfe,{ref:v,className:"".concat(S,"-edit"),onClick:V,"aria-label":i,tabIndex:n},e||a.createElement(Cfe,{role:"button"}))):null},fe=e=>[e&&pe(),me(),M?a.createElement(Iye,Object.assign({key:"copy"},T,{prefixCls:S,copied:E,locale:y,onCopy:H,loading:F,iconOnly:null===u||void 0===u})):null];return a.createElement(rg,{onResize:e=>{let{offsetWidth:t}=e;ge(t)},disabled:!ee},(n=>a.createElement(vye,{tooltipProps:de,enableEllipsis:ee,isEllipsis:re},a.createElement(gye,Object.assign({className:Ie()({["".concat(S,"-").concat(c)]:c,["".concat(S,"-disabled")]:g,["".concat(S,"-ellipsis")]:Q,["".concat(S,"-ellipsis-single-line")]:se,["".concat(S,"-ellipsis-multiple-line")]:le},s),prefixCls:r,style:Object.assign(Object.assign({},l),{WebkitLineClamp:le?te:void 0}),component:m,ref:ve(n,A,t),direction:b,onClick:B.includes("text")?V:void 0,"aria-label":null===he||void 0===he?void 0:he.toString(),title:I},x),a.createElement(Aye,{enableMeasure:ee&&!ae,text:u,rows:te,width:ce,onEllipsis:ue,expanded:q,miscDeps:[E,q,F,G,M]},((t,n)=>function(e,t){let{mark:n,code:o,underline:i,delete:r,strong:s,keyboard:l,italic:c}=e,g=t;function u(e,t){t&&(g=a.createElement(e,{},g))}return u("strong",s),u("u",i),u("del",r),u("code",o),u("mark",n),u("kbd",l),u("i",c),g}(e,a.createElement(a.Fragment,null,t.length>0&&n&&!q&&he?a.createElement("span",{key:"show-content","aria-hidden":!0},t):t,(e=>[e&&!q&&a.createElement("span",{"aria-hidden":!0,key:"ellipsis"},"..."),j.suffix,fe(e)])(n)))))))))})),Gye=xye;var Zye=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const wye=a.forwardRef(((e,t)=>{var{ellipsis:n,rel:o}=e,i=Zye(e,["ellipsis","rel"]);const r=Object.assign(Object.assign({},i),{rel:void 0===o&&"_blank"===i.target?"noopener noreferrer":o});return delete r.navigate,a.createElement(Gye,Object.assign({},r,{ref:t,ellipsis:!!n,component:"a"}))})),kye=wye,Bye=a.forwardRef(((e,t)=>a.createElement(Gye,Object.assign({ref:t},e,{component:"div"}))));var Rye=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Wye=(e,t)=>{var{ellipsis:n}=e,o=Rye(e,["ellipsis"]);const i=a.useMemo((()=>n&&"object"===typeof n?Ce(n,["expandable","rows"]):n),[n]);return a.createElement(Gye,Object.assign({ref:t},o,{ellipsis:i,component:"span"}))},Vye=a.forwardRef(Wye);var Nye=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Xye=[1,2,3,4,5],Mye=a.forwardRef(((e,t)=>{const{level:n=1}=e,o=Nye(e,["level"]);let i;return i=Xye.includes(n)?"h".concat(n):"h1",a.createElement(Gye,Object.assign({ref:t},o,{component:i}))})),Tye=gye;Tye.Text=Vye,Tye.Link=kye,Tye.Title=Mye,Tye.Paragraph=Bye;const Eye=Tye;function Fye(e,t,n){var a=(n||{}).atBegin;return function(e,t,n){var a,o=n||{},i=o.noTrailing,r=void 0!==i&&i,s=o.noLeading,l=void 0!==s&&s,c=o.debounceMode,g=void 0===c?void 0:c,u=!1,d=0;function h(){a&&clearTimeout(a)}function p(){for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];var s=this,c=Date.now()-d;function p(){d=Date.now(),t.apply(s,o)}function m(){a=void 0}u||(l||!g||a||p(),h(),void 0===g&&c>e?l?(d=Date.now(),r||(a=setTimeout(g?m:p,e))):p():!0!==r&&(a=setTimeout(g?m:p,void 0===g?e-c:e)))}return p.cancel=function(e){var t=(e||{}).upcomingOnly,n=void 0!==t&&t;h(),u=!n},p}(e,t,{debounceMode:!1!==(void 0!==a&&a)})}function Hye(e){let{percent:t,prefixCls:n}=e;const o="".concat(n,"-dot"),i="".concat(o,"-holder"),r="".concat(i,"-hidden"),[s,l]=a.useState(!1);on((()=>{0!==t&&l(!0)}),[0!==t]);const c=Math.max(Math.min(t,100),0),g=100,u=80*Math.PI,d=(e,t)=>a.createElement("circle",{className:Ie()(e,"".concat(o,"-circle")),r:40,cx:"50",cy:"50",strokeWidth:20,style:t});return s?a.createElement("span",{className:Ie()(i,"".concat(o,"-progress"),c<=0&&r)},a.createElement("svg",{viewBox:"0 0 ".concat(g," ").concat(g),role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":c},d("".concat(o,"-circle-bg")),d("",{strokeDasharray:"".concat(u*c/100," ").concat(u*(100-c)/100),strokeDashoffset:"".concat(u/4)}))):null}function Jye(e){const{prefixCls:t,percent:n=0}=e,o="".concat(t,"-dot"),i="".concat(o,"-holder"),r="".concat(i,"-hidden");return a.createElement(a.Fragment,null,a.createElement("span",{className:Ie()(i,n>0&&r)},a.createElement("span",{className:Ie()(o,"".concat(t,"-dot-spin"))},[1,2,3,4].map((e=>a.createElement("i",{className:"".concat(t,"-dot-item"),key:e}))))),a.createElement(Hye,{prefixCls:t,percent:n}))}function Yye(e){const{prefixCls:t,indicator:n,percent:o}=e,i="".concat(t,"-dot");return n&&a.isValidElement(n)?Ne(n,{className:Ie()(n.props.className,i),percent:o}):a.createElement(Jye,{prefixCls:t,percent:o})}const Lye=new Za("antSpinMove",{to:{opacity:1}}),zye=new Za("antRotate",{to:{transform:"rotate(405deg)"}}),Kye=e=>{const{componentCls:t,calc:n}=e;return{["".concat(t)]:Object.assign(Object.assign({},za(e)),{position:"absolute",display:"none",color:e.colorPrimary,fontSize:0,textAlign:"center",verticalAlign:"middle",opacity:0,transition:"transform ".concat(e.motionDurationSlow," ").concat(e.motionEaseInOutCirc),"&-spinning":{position:"relative",display:"inline-block",opacity:1},["".concat(t,"-text")]:{fontSize:e.fontSize,paddingTop:n(n(e.dotSize).sub(e.fontSize)).div(2).add(2).equal()},"&-fullscreen":{position:"fixed",width:"100vw",height:"100vh",backgroundColor:e.colorBgMask,zIndex:e.zIndexPopupBase,inset:0,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",opacity:0,visibility:"hidden",transition:"all ".concat(e.motionDurationMid),"&-show":{opacity:1,visibility:"visible"},[t]:{["".concat(t,"-dot-holder")]:{color:e.colorWhite},["".concat(t,"-text")]:{color:e.colorTextLightSolid}}},"&-nested-loading":{position:"relative",["> div > ".concat(t)]:{position:"absolute",top:0,insetInlineStart:0,zIndex:4,display:"block",width:"100%",height:"100%",maxHeight:e.contentHeight,["".concat(t,"-dot")]:{position:"absolute",top:"50%",insetInlineStart:"50%",margin:n(e.dotSize).mul(-1).div(2).equal()},["".concat(t,"-text")]:{position:"absolute",top:"50%",width:"100%",textShadow:"0 1px 2px ".concat(e.colorBgContainer)},["&".concat(t,"-show-text ").concat(t,"-dot")]:{marginTop:n(e.dotSize).div(2).mul(-1).sub(10).equal()},"&-sm":{["".concat(t,"-dot")]:{margin:n(e.dotSizeSM).mul(-1).div(2).equal()},["".concat(t,"-text")]:{paddingTop:n(n(e.dotSizeSM).sub(e.fontSize)).div(2).add(2).equal()},["&".concat(t,"-show-text ").concat(t,"-dot")]:{marginTop:n(e.dotSizeSM).div(2).mul(-1).sub(10).equal()}},"&-lg":{["".concat(t,"-dot")]:{margin:n(e.dotSizeLG).mul(-1).div(2).equal()},["".concat(t,"-text")]:{paddingTop:n(n(e.dotSizeLG).sub(e.fontSize)).div(2).add(2).equal()},["&".concat(t,"-show-text ").concat(t,"-dot")]:{marginTop:n(e.dotSizeLG).div(2).mul(-1).sub(10).equal()}}},["".concat(t,"-container")]:{position:"relative",transition:"opacity ".concat(e.motionDurationSlow),"&::after":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:10,width:"100%",height:"100%",background:e.colorBgContainer,opacity:0,transition:"all ".concat(e.motionDurationSlow),content:'""',pointerEvents:"none"}},["".concat(t,"-blur")]:{clear:"both",opacity:.5,userSelect:"none",pointerEvents:"none","&::after":{opacity:.4,pointerEvents:"auto"}}},"&-tip":{color:e.spinDotDefault},["".concat(t,"-dot-progress")]:{position:"absolute",top:0,insetInlineStart:0},["".concat(t,"-dot-holder")]:{width:"1em",height:"1em",fontSize:e.dotSize,display:"inline-block",transition:"transform ".concat(e.motionDurationSlow," ease, opacity ").concat(e.motionDurationSlow," ease"),transformOrigin:"50% 50%",lineHeight:1,color:e.colorPrimary,"&-hidden":{transform:"scale(0.3)",opacity:0}},["".concat(t,"-dot-progress")]:{position:"absolute",top:0,insetInlineStart:0},["".concat(t,"-dot")]:{position:"relative",display:"inline-block",fontSize:e.dotSize,width:"1em",height:"1em","&-item":{position:"absolute",display:"block",width:n(e.dotSize).sub(n(e.marginXXS).div(2)).div(2).equal(),height:n(e.dotSize).sub(n(e.marginXXS).div(2)).div(2).equal(),background:"currentColor",borderRadius:"100%",transform:"scale(0.75)",transformOrigin:"50% 50%",opacity:.3,animationName:Lye,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"alternate","&:nth-child(1)":{top:0,insetInlineStart:0,animationDelay:"0s"},"&:nth-child(2)":{top:0,insetInlineEnd:0,animationDelay:"0.4s"},"&:nth-child(3)":{insetInlineEnd:0,bottom:0,animationDelay:"0.8s"},"&:nth-child(4)":{bottom:0,insetInlineStart:0,animationDelay:"1.2s"}},"&-spin":{transform:"rotate(45deg)",animationName:zye,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear"},"&-circle":{strokeLinecap:"round",transition:["stroke-dashoffset","stroke-dasharray","stroke","stroke-width","opacity"].map((t=>"".concat(t," ").concat(e.motionDurationSlow," ease"))).join(","),fillOpacity:0,stroke:"currentcolor"},"&-circle-bg":{stroke:e.colorFillSecondary}},["&-sm ".concat(t,"-dot")]:{fontSize:e.dotSizeSM},["&-sm ".concat(t,"-dot-holder")]:{i:{width:n(n(e.dotSizeSM).sub(n(e.marginXXS).div(2))).div(2).equal(),height:n(n(e.dotSizeSM).sub(n(e.marginXXS).div(2))).div(2).equal()}},["&-lg ".concat(t,"-dot")]:{fontSize:e.dotSizeLG},["&-lg ".concat(t,"-dot-holder")]:{i:{width:n(n(e.dotSizeLG).sub(e.marginXXS)).div(2).equal(),height:n(n(e.dotSizeLG).sub(e.marginXXS)).div(2).equal()}},["&".concat(t,"-show-text ").concat(t,"-text")]:{display:"block"}})}},Dye=Ii("Spin",(e=>{const t=ri(e,{spinDotDefault:e.colorTextDescription});return[Kye(t)]}),(e=>{const{controlHeightLG:t,controlHeight:n}=e;return{contentHeight:400,dotSize:t/2,dotSizeSM:.35*t,dotSizeLG:n}})),Uye=[[30,.05],[70,.03],[96,.01]];var Pye=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};let Oye;const _ye=e=>{const{prefixCls:t,spinning:n=!0,delay:o=0,className:i,rootClassName:r,size:s="default",tip:l,wrapperClassName:c,style:g,children:u,fullscreen:d=!1,indicator:h,percent:p}=e,m=Pye(e,["prefixCls","spinning","delay","className","rootClassName","size","tip","wrapperClassName","style","children","fullscreen","indicator","percent"]),{getPrefixCls:I}=a.useContext(Be),C=I("spin",t),[f,b,y]=Dye(C),[A,v]=a.useState((()=>n&&!function(e,t){return!!e&&!!t&&!isNaN(Number(t))}(n,o))),S=function(e,t){const[n,o]=a.useState(0),i=a.useRef(),r="auto"===t;return a.useEffect((()=>(r&&e&&(o(0),i.current=setInterval((()=>{o((e=>{const t=100-e;for(let n=0;n<Uye.length;n+=1){const[a,o]=Uye[n];if(e<=a)return e+t*o}return e}))}),200)),()=>{clearInterval(i.current)})),[r,e]),r?n:t}(A,p);a.useEffect((()=>{if(n){const e=Fye(o,(()=>{v(!0)}));return e(),()=>{var t;null===(t=null===e||void 0===e?void 0:e.cancel)||void 0===t||t.call(e)}}v(!1)}),[o,n]);const x=a.useMemo((()=>"undefined"!==typeof u&&!d),[u,d]);const{direction:G,spin:Z}=a.useContext(Be),w=Ie()(C,null===Z||void 0===Z?void 0:Z.className,{["".concat(C,"-sm")]:"small"===s,["".concat(C,"-lg")]:"large"===s,["".concat(C,"-spinning")]:A,["".concat(C,"-show-text")]:!!l,["".concat(C,"-rtl")]:"rtl"===G},i,!d&&r,b,y),k=Ie()("".concat(C,"-container"),{["".concat(C,"-blur")]:A}),B=Object.assign(Object.assign({},null===Z||void 0===Z?void 0:Z.style),g),R=a.createElement("div",Object.assign({},m,{style:B,className:w,"aria-live":"polite","aria-busy":A}),a.createElement(Yye,{prefixCls:C,indicator:null!==h&&void 0!==h?h:Oye,percent:S}),l&&(x||d)?a.createElement("div",{className:"".concat(C,"-text")},l):null);return f(x?a.createElement("div",Object.assign({},m,{className:Ie()("".concat(C,"-nested-loading"),c,b,y)}),A&&a.createElement("div",{key:"loading"},R),a.createElement("div",{className:k,key:"container"},u)):d?a.createElement("div",{className:Ie()("".concat(C,"-fullscreen"),{["".concat(C,"-fullscreen-show")]:A},r,b,y)},R):R)};_ye.setDefaultIndicator=e=>{Oye=e};const Qye=_ye,jye=(0,a.createContext)(null);function qye(e){const t=(0,a.useRef)(null);return null===t.current&&(t.current=e()),t.current}const $ye=(0,a.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class eAe extends a.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function tAe(e){let{children:t,isPresent:n}=e;const o=(0,a.useId)(),i=(0,a.useRef)(null),r=(0,a.useRef)({width:0,height:0,top:0,left:0}),{nonce:s}=(0,a.useContext)($ye);return(0,a.useInsertionEffect)((()=>{const{width:e,height:t,top:a,left:l}=r.current;if(n||!i.current||!e||!t)return;i.current.dataset.motionPopId=o;const c=document.createElement("style");return s&&(c.nonce=s),document.head.appendChild(c),c.sheet&&c.sheet.insertRule('\n          [data-motion-pop-id="'.concat(o,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(a,"px !important;\n            left: ").concat(l,"px !important;\n          }\n        ")),()=>{document.head.removeChild(c)}}),[n]),(0,Cc.jsx)(eAe,{isPresent:n,childRef:i,sizeRef:r,children:a.cloneElement(t,{ref:i})})}const nAe=e=>{let{children:t,initial:n,isPresent:o,onExitComplete:i,custom:r,presenceAffectsLayout:s,mode:l}=e;const c=qye(aAe),g=(0,a.useId)(),u=(0,a.useMemo)((()=>({id:g,initial:n,isPresent:o,custom:r,onExitComplete:e=>{c.set(e,!0);for(const t of c.values())if(!t)return;i&&i()},register:e=>(c.set(e,!1),()=>c.delete(e))})),s?[Math.random()]:[o]);return(0,a.useMemo)((()=>{c.forEach(((e,t)=>c.set(t,!1)))}),[o]),a.useEffect((()=>{!o&&!c.size&&i&&i()}),[o]),"popLayout"===l&&(t=(0,Cc.jsx)(tAe,{isPresent:o,children:t})),(0,Cc.jsx)(jye.Provider,{value:u,children:t})};function aAe(){return new Map}const oAe=(0,a.createContext)({}),iAe=e=>e;let rAe=iAe,sAe=iAe;const lAe=e=>e.key||"";function cAe(e){const t=[];return a.Children.forEach(e,(e=>{(0,a.isValidElement)(e)&&t.push(e)})),t}const gAe="undefined"!==typeof window,uAe=gAe?a.useLayoutEffect:a.useEffect,dAe=e=>{let{children:t,exitBeforeEnter:n,custom:o,initial:i=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:l="sync"}=e;sAe(!n,"Replace exitBeforeEnter with mode='wait'");const c=(0,a.useMemo)((()=>cAe(t)),[t]),g=c.map(lAe),u=(0,a.useRef)(!0),d=(0,a.useRef)(c),h=qye((()=>new Map)),[p,m]=(0,a.useState)(c),[I,C]=(0,a.useState)(c);uAe((()=>{u.current=!1,d.current=c;for(let e=0;e<I.length;e++){const t=lAe(I[e]);g.includes(t)?h.delete(t):!0!==h.get(t)&&h.set(t,!1)}}),[I,g.length,g.join("-")]);const f=[];if(c!==p){let e=[...c];for(let t=0;t<I.length;t++){const n=I[t],a=lAe(n);g.includes(a)||(e.splice(t,0,n),f.push(n))}return"wait"===l&&f.length&&(e=f),C(cAe(e)),void m(c)}const{forceRender:b}=(0,a.useContext)(oAe);return(0,Cc.jsx)(Cc.Fragment,{children:I.map((e=>{const t=lAe(e),n=c===I||g.includes(t);return(0,Cc.jsx)(nAe,{isPresent:n,initial:!(u.current&&!i)&&void 0,custom:n?void 0:o,presenceAffectsLayout:s,mode:l,onExitComplete:n?void 0:()=>{if(!h.has(t))return;h.set(t,!0);let e=!0;h.forEach((t=>{t||(e=!1)})),e&&(null===b||void 0===b||b(),C(d.current),r&&r())},children:e},t)}))})},hAe=(0,a.createContext)({}),pAe=(0,a.createContext)({strict:!1}),mAe=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),IAe="data-"+mAe("framerAppearId"),CAe=!1,fAe=!1;const bAe=["read","resolveKeyframes","update","preRender","render","postRender"];function yAe(e,t){let n=!1,a=!0;const o={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,r=bAe.reduce(((e,t)=>(e[t]=function(e){let t=new Set,n=new Set,a=!1,o=!1;const i=new WeakSet;let r={delta:0,timestamp:0,isProcessing:!1};function s(t){i.has(t)&&(l.schedule(t),e()),t(r)}const l={schedule:function(e){const o=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&a?t:n;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&i.add(e),o.has(e)||o.add(e),e},cancel:e=>{n.delete(e),i.delete(e)},process:e=>{r=e,a?o=!0:(a=!0,[t,n]=[n,t],n.clear(),t.forEach(s),a=!1,o&&(o=!1,l.process(e)))}};return l}(i),e)),{}),{read:s,resolveKeyframes:l,update:c,preRender:g,render:u,postRender:d}=r,h=()=>{const i=fAe?o.timestamp:performance.now();n=!1,o.delta=a?1e3/60:Math.max(Math.min(i-o.timestamp,40),1),o.timestamp=i,o.isProcessing=!0,s.process(o),l.process(o),c.process(o),g.process(o),u.process(o),d.process(o),o.isProcessing=!1,n&&t&&(a=!1,e(h))},p=bAe.reduce(((t,i)=>{const s=r[i];return t[i]=function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,a=!0,o.isProcessing||e(h)),s.schedule(t,i,r)},t}),{});return{schedule:p,cancel:e=>{for(let t=0;t<bAe.length;t++)r[bAe[t]].cancel(e)},state:o,steps:r}}const{schedule:AAe,cancel:vAe}=yAe(queueMicrotask,!1);function SAe(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}const xAe=(0,a.createContext)({});let GAe=!1;function ZAe(e,t,n,o,i){var r;const{visualElement:s}=(0,a.useContext)(hAe),l=(0,a.useContext)(pAe),c=(0,a.useContext)(jye),g=(0,a.useContext)($ye).reducedMotion,u=(0,a.useRef)();o=o||l.renderer,!u.current&&o&&(u.current=o(e,{visualState:t,parent:s,props:n,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:g}));const d=u.current,h=(0,a.useContext)(xAe);!d||d.projection||!i||"html"!==d.type&&"svg"!==d.type||function(e,t,n,a){const{layoutId:o,layout:i,drag:r,dragConstraints:s,layoutScroll:l,layoutRoot:c}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:kAe(e.parent)),e.projection.setOptions({layoutId:o,layout:i,alwaysMeasureLayout:Boolean(r)||s&&SAe(s),visualElement:e,animationType:"string"===typeof i?i:"both",initialPromotionConfig:a,layoutScroll:l,layoutRoot:c})}(u.current,n,i,h),(0,a.useInsertionEffect)((()=>{d&&d.update(n,c)}));const p=n[IAe],m=(0,a.useRef)(Boolean(p)&&!window.MotionHandoffIsComplete&&(null===(r=window.MotionHasOptimisedAnimation)||void 0===r?void 0:r.call(window,p)));return uAe((()=>{d&&(d.updateFeatures(),AAe.render(d.render),m.current&&d.animationState&&d.animationState.animateChanges())})),(0,a.useEffect)((()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current=!1,GAe||(GAe=!0,queueMicrotask(wAe)))})),d}function wAe(){window.MotionHandoffIsComplete=!0}function kAe(e){if(e)return!1!==e.options.allowProjection?e.projection:kAe(e.parent)}function BAe(e,t,n){return(0,a.useCallback)((a=>{a&&e.mount&&e.mount(a),t&&(a?t.mount(a):t.unmount()),n&&("function"===typeof n?n(a):SAe(n)&&(n.current=a))}),[t])}function RAe(e){return"string"===typeof e||Array.isArray(e)}function WAe(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}const VAe=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],NAe=["initial",...VAe];function XAe(e){return WAe(e.animate)||NAe.some((t=>RAe(e[t])))}function MAe(e){return Boolean(XAe(e)||e.variants)}function TAe(e){const{initial:t,animate:n}=function(e,t){if(XAe(e)){const{initial:t,animate:n}=e;return{initial:!1===t||RAe(t)?t:void 0,animate:RAe(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,a.useContext)(hAe));return(0,a.useMemo)((()=>({initial:t,animate:n})),[EAe(t),EAe(n)])}function EAe(e){return Array.isArray(e)?e.join(" "):e}const FAe={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},HAe={};for(const n in FAe)HAe[n]={isEnabled:e=>FAe[n].some((t=>!!e[t]))};const JAe=Symbol.for("motionComponentSymbol");function YAe(e){let{preloadedFeatures:t,createVisualElement:n,useRender:o,useVisualState:i,Component:r}=e;t&&function(e){for(const t in e)HAe[t]={...HAe[t],...e[t]}}(t);const s=(0,a.forwardRef)((function(e,t){let s;const l={...(0,a.useContext)($ye),...e,layoutId:LAe(e)},{isStatic:c}=l,g=TAe(e),u=i(e,c);if(!c&&gAe){!function(e,t){(0,a.useContext)(pAe).strict;0}();const e=function(e){const{drag:t,layout:n}=HAe;if(!t&&!n)return{};const a={...t,...n};return{MeasureLayout:(null===t||void 0===t?void 0:t.isEnabled(e))||(null===n||void 0===n?void 0:n.isEnabled(e))?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}(l);s=e.MeasureLayout,g.visualElement=ZAe(r,u,l,n,e.ProjectionNode)}return(0,Cc.jsxs)(hAe.Provider,{value:g,children:[s&&g.visualElement?(0,Cc.jsx)(s,{visualElement:g.visualElement,...l}):null,o(r,e,BAe(u,g.visualElement,t),u,c,g.visualElement)]})}));return s[JAe]=r,s}function LAe(e){let{layoutId:t}=e;const n=(0,a.useContext)(oAe).id;return n&&void 0!==t?n+"-"+t:t}function zAe(e){function t(t){return YAe(e(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}if("undefined"===typeof Proxy)return t;const n=new Map;return new Proxy(t,{get:(e,a)=>(n.has(a)||n.set(a,t(a)),n.get(a))})}const KAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function DAe(e){return"string"===typeof e&&!e.includes("-")&&!!(KAe.indexOf(e)>-1||/[A-Z]/u.test(e))}const UAe={};const PAe=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],OAe=new Set(PAe);function _Ae(e,t){let{layout:n,layoutId:a}=t;return OAe.has(e)||e.startsWith("origin")||(n||void 0!==a)&&(!!UAe[e]||"opacity"===e)}const QAe=e=>Boolean(e&&e.getVelocity),jAe=(e,t)=>t&&"number"===typeof e?t.transform(e):e,qAe=(e,t,n)=>n>t?t:n<e?e:n,$Ae={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},eve={...$Ae,transform:e=>qAe(0,1,e)},tve={...$Ae,default:1},nve=e=>Math.round(1e5*e)/1e5,ave=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,ove=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,ive=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function rve(e){return"string"===typeof e}const sve=e=>({test:t=>rve(t)&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>"".concat(t).concat(e)}),lve=sve("deg"),cve=sve("%"),gve=sve("px"),uve=sve("vh"),dve=sve("vw"),hve={...cve,parse:e=>cve.parse(e)/100,transform:e=>cve.transform(100*e)},pve={...$Ae,transform:Math.round},mve={borderWidth:gve,borderTopWidth:gve,borderRightWidth:gve,borderBottomWidth:gve,borderLeftWidth:gve,borderRadius:gve,radius:gve,borderTopLeftRadius:gve,borderTopRightRadius:gve,borderBottomRightRadius:gve,borderBottomLeftRadius:gve,width:gve,maxWidth:gve,height:gve,maxHeight:gve,size:gve,top:gve,right:gve,bottom:gve,left:gve,padding:gve,paddingTop:gve,paddingRight:gve,paddingBottom:gve,paddingLeft:gve,margin:gve,marginTop:gve,marginRight:gve,marginBottom:gve,marginLeft:gve,rotate:lve,rotateX:lve,rotateY:lve,rotateZ:lve,scale:tve,scaleX:tve,scaleY:tve,scaleZ:tve,skew:lve,skewX:lve,skewY:lve,distance:gve,translateX:gve,translateY:gve,translateZ:gve,x:gve,y:gve,z:gve,perspective:gve,transformPerspective:gve,opacity:eve,originX:hve,originY:hve,originZ:gve,zIndex:pve,backgroundPositionX:gve,backgroundPositionY:gve,fillOpacity:eve,strokeOpacity:eve,numOctaves:pve},Ive={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Cve=PAe.length;const fve=e=>t=>"string"===typeof t&&t.startsWith(e),bve=fve("--"),yve=fve("var(--"),Ave=e=>!!yve(e)&&vve.test(e.split("/*")[0].trim()),vve=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Sve(e,t,n){const{style:a,vars:o,transformOrigin:i}=e;let r=!1,s=!1;for(const l in t){const e=t[l];if(OAe.has(l))r=!0;else if(bve(l))o[l]=e;else{const t=jAe(e,mve[l]);l.startsWith("origin")?(s=!0,i[l]=t):a[l]=t}}if(t.transform||(r||n?a.transform=function(e,t,n){let a="",o=!0;for(let i=0;i<Cve;i++){const r=PAe[i],s=e[r];if(void 0===s)continue;let l=!0;if(l="number"===typeof s?s===(r.startsWith("scale")?1:0):0===parseFloat(s),!l||n){const e=jAe(s,mve[r]);if(!l){o=!1;const t=Ive[r]||r;a+="".concat(t,"(").concat(e,") ")}n&&(t[r]=e)}}return a=a.trim(),n?a=n(t,o?"":a):o&&(a="none"),a}(t,e.transform,n):a.transform&&(a.transform="none")),s){const{originX:e="50%",originY:t="50%",originZ:n=0}=i;a.transformOrigin="".concat(e," ").concat(t," ").concat(n)}}const xve=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Gve(e,t,n){for(const a in t)QAe(t[a])||_Ae(a,n)||(e[a]=t[a])}function Zve(e,t){const n={};return Gve(n,e.style||{},e),Object.assign(n,function(e,t){let{transformTemplate:n}=e;return(0,a.useMemo)((()=>{const e=xve();return Sve(e,t,n),Object.assign({},e.vars,e.style)}),[t])}(e,t)),n}function wve(e,t){const n={},a=Zve(e,t);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=!0===e.drag?"none":"pan-".concat("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=a,n}const kve=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Bve(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||kve.has(e)}let Rve=e=>!Bve(e);try{(Wve=require("@emotion/is-prop-valid").default)&&(Rve=e=>e.startsWith("on")?!Bve(e):Wve(e))}catch(Iq){}var Wve;function Vve(e,t,n){return"string"===typeof e?e:gve.transform(t+n*e)}const Nve={offset:"stroke-dashoffset",array:"stroke-dasharray"},Xve={offset:"strokeDashoffset",array:"strokeDasharray"};function Mve(e,t,n,a){let{attrX:o,attrY:i,attrScale:r,originX:s,originY:l,pathLength:c,pathSpacing:g=1,pathOffset:u=0,...d}=t;if(Sve(e,d,a),n)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:h,style:p,dimensions:m}=e;h.transform&&(m&&(p.transform=h.transform),delete h.transform),m&&(void 0!==s||void 0!==l||p.transform)&&(p.transformOrigin=function(e,t,n){const a=Vve(t,e.x,e.width),o=Vve(n,e.y,e.height);return"".concat(a," ").concat(o)}(m,void 0!==s?s:.5,void 0!==l?l:.5)),void 0!==o&&(h.x=o),void 0!==i&&(h.y=i),void 0!==r&&(h.scale=r),void 0!==c&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const i=o?Nve:Xve;e[i.offset]=gve.transform(-a);const r=gve.transform(t),s=gve.transform(n);e[i.array]="".concat(r," ").concat(s)}(h,c,g,u,!1)}const Tve=()=>({...xve(),attrs:{}}),Eve=e=>"string"===typeof e&&"svg"===e.toLowerCase();function Fve(e,t,n,o){const i=(0,a.useMemo)((()=>{const n=Tve();return Mve(n,t,Eve(o),e.transformTemplate),{...n.attrs,style:{...n.style}}}),[t]);if(e.style){const t={};Gve(t,e.style,e),i.style={...t,...i.style}}return i}function Hve(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(t,n,o,i,r)=>{let{latestValues:s}=i;const l=(DAe(t)?Fve:wve)(n,s,r,t),c=function(e,t,n){const a={};for(const o in e)"values"===o&&"object"===typeof e.values||(Rve(o)||!0===n&&Bve(o)||!t&&!Bve(o)||e.draggable&&o.startsWith("onDrag"))&&(a[o]=e[o]);return a}(n,"string"===typeof t,e),g=t!==a.Fragment?{...c,...l,ref:o}:{},{children:u}=n,d=(0,a.useMemo)((()=>QAe(u)?u.get():u),[u]);return(0,a.createElement)(t,{...g,children:d})}}function Jve(e,t,n,a){let{style:o,vars:i}=t;Object.assign(e.style,o,a&&a.getProjectionStyles(n));for(const r in i)e.style.setProperty(r,i[r])}const Yve=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Lve(e,t,n,a){Jve(e,t,void 0,a);for(const o in t.attrs)e.setAttribute(Yve.has(o)?o:mAe(o),t.attrs[o])}function zve(e,t,n){var a;const{style:o}=e,i={};for(const r in o)(QAe(o[r])||t.style&&QAe(t.style[r])||_Ae(r,e)||void 0!==(null===(a=null===n||void 0===n?void 0:n.getValue(r))||void 0===a?void 0:a.liveStyle))&&(i[r]=o[r]);return n&&o&&"string"===typeof o.willChange&&(n.applyWillChange=!1),i}function Kve(e,t,n){const a=zve(e,t,n);for(const o in e)if(QAe(e[o])||QAe(t[o])){a[-1!==PAe.indexOf(o)?"attr"+o.charAt(0).toUpperCase()+o.substring(1):o]=e[o]}return a}function Dve(e){const t=[{},{}];return null===e||void 0===e||e.values.forEach(((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()})),t}function Uve(e,t,n,a){if("function"===typeof t){const[o,i]=Dve(a);t=t(void 0!==n?n:e.custom,o,i)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[o,i]=Dve(a);t=t(void 0!==n?n:e.custom,o,i)}return t}const Pve=e=>Array.isArray(e),Ove=e=>Boolean(e&&"object"===typeof e&&e.mix&&e.toValue),_ve=e=>Pve(e)?e[e.length-1]||0:e;function Qve(e){const t=QAe(e)?e.get():e;return Ove(t)?t.toValue():t}const jve=new Set(["opacity","clipPath","filter","transform"]);function qve(e){return OAe.has(e)?"transform":jve.has(e)?mAe(e):void 0}function $ve(e,t){-1===e.indexOf(t)&&e.push(t)}function eSe(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const tSe=e=>(t,n)=>{const o=(0,a.useContext)(hAe),i=(0,a.useContext)(jye),r=()=>function(e,t,n,a,o){let{applyWillChange:i=!1,scrapeMotionValuesFromProps:r,createRenderState:s,onMount:l}=e;const c={latestValues:oSe(t,n,a,!o&&i,r),renderState:s()};return l&&(c.mount=e=>l(t,e,c)),c}(e,t,o,i,n);return n?r():qye(r)};function nSe(e,t){const n=qve(t);n&&$ve(e,n)}function aSe(e,t,n){const a=Array.isArray(t)?t:[t];for(let o=0;o<a.length;o++){const t=Uve(e,a[o]);if(t){const{transitionEnd:e,transition:a,...o}=t;n(o,e)}}}function oSe(e,t,n,a,o){var i;const r={},s=[],l=a&&void 0===(null===(i=e.style)||void 0===i?void 0:i.willChange),c=o(e,{});for(const I in c)r[I]=Qve(c[I]);let{initial:g,animate:u}=e;const d=XAe(e),h=MAe(e);t&&h&&!d&&!1!==e.inherit&&(void 0===g&&(g=t.initial),void 0===u&&(u=t.animate));let p=!!n&&!1===n.initial;p=p||!1===g;const m=p?u:g;return m&&"boolean"!==typeof m&&!WAe(m)&&aSe(e,m,((e,t)=>{for(const n in e){let t=e[n];if(Array.isArray(t)){t=t[p?t.length-1:0]}null!==t&&(r[n]=t)}for(const n in t)r[n]=t[n]})),l&&(u&&!1!==g&&!WAe(u)&&aSe(e,u,(e=>{for(const t in e)nSe(s,t)})),s.length&&(r.willChange=s.join(","))),r}const{schedule:iSe,cancel:rSe,state:sSe,steps:lSe}=yAe("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:iAe,!0),cSe={useVisualState:tSe({scrapeMotionValuesFromProps:Kve,createRenderState:Tve,onMount:(e,t,n)=>{let{renderState:a,latestValues:o}=n;iSe.read((()=>{try{a.dimensions="function"===typeof t.getBBox?t.getBBox():t.getBoundingClientRect()}catch(Pke){a.dimensions={x:0,y:0,width:0,height:0}}})),iSe.render((()=>{Mve(a,o,Eve(t.tagName),e.transformTemplate),Lve(t,a)}))}})},gSe={useVisualState:tSe({applyWillChange:!0,scrapeMotionValuesFromProps:zve,createRenderState:xve})};function uSe(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n)}const dSe=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary;function hSe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"page";return{point:{x:e["".concat(t,"X")],y:e["".concat(t,"Y")]}}}const pSe=e=>t=>dSe(t)&&e(t,hSe(t));function mSe(e,t,n,a){return uSe(e,t,pSe(n),a)}const ISe=(e,t)=>n=>t(e(n)),CSe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(ISe)};function fSe(e){let t=null;return()=>{const n=()=>{t=null};return null===t&&(t=e,n)}}const bSe=fSe("dragHorizontal"),ySe=fSe("dragVertical");function ASe(e){let t=!1;if("y"===e)t=ySe();else if("x"===e)t=bSe();else{const e=bSe(),n=ySe();e&&n?t=()=>{e(),n()}:(e&&e(),n&&n())}return t}function vSe(){const e=ASe(!0);return!e||(e(),!1)}class SSe{constructor(e){this.isMounted=!1,this.node=e}update(){}}function xSe(e,t){const n=t?"pointerenter":"pointerleave",a=t?"onHoverStart":"onHoverEnd";return mSe(e.current,n,((n,o)=>{if("touch"===n.pointerType||vSe())return;const i=e.getProps();e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",t);const r=i[a];r&&iSe.postRender((()=>r(n,o)))}),{passive:!e.getProps()[a]})}const GSe=(e,t)=>!!t&&(e===t||GSe(e,t.parentElement));function ZSe(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,hSe(n))}const wSe=new WeakMap,kSe=new WeakMap,BSe=e=>{const t=wSe.get(e.target);t&&t(e)},RSe=e=>{e.forEach(BSe)};function WSe(e,t,n){const a=function(e){let{root:t,...n}=e;const a=t||document;kSe.has(a)||kSe.set(a,{});const o=kSe.get(a),i=JSON.stringify(n);return o[i]||(o[i]=new IntersectionObserver(RSe,{root:t,...n})),o[i]}(t);return wSe.set(e,n),a.observe(e),()=>{wSe.delete(e),a.unobserve(e)}}const VSe={some:0,all:1};const NSe={inView:{Feature:class extends SSe{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:a="some",once:o}=e,i={root:t?t.current:void 0,rootMargin:n,threshold:"number"===typeof a?a:VSe[a]};return WSe(this.node.current,i,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,o&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:a}=this.node.getProps(),i=t?n:a;i&&i(e)}))}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,n=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==n[e]}(e,t));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends SSe{constructor(){super(...arguments),this.removeStartListeners=iAe,this.removeEndListeners=iAe,this.removeAccessibleListeners=iAe,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),a=mSe(window,"pointerup",((e,t)=>{if(!this.checkPressEnd())return;const{onTap:n,onTapCancel:a,globalTapTarget:o}=this.node.getProps(),i=o||GSe(this.node.current,e.target)?n:a;i&&iSe.update((()=>i(e,t)))}),{passive:!(n.onTap||n.onPointerUp)}),o=mSe(window,"pointercancel",((e,t)=>this.cancelPress(e,t)),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=CSe(a,o),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=uSe(this.node.current,"keydown",(e=>{if("Enter"!==e.key||this.isPressing)return;this.removeEndListeners(),this.removeEndListeners=uSe(this.node.current,"keyup",(e=>{"Enter"===e.key&&this.checkPressEnd()&&ZSe("up",((e,t)=>{const{onTap:n}=this.node.getProps();n&&iSe.postRender((()=>n(e,t)))}))})),ZSe("down",((e,t)=>{this.startPress(e,t)}))})),t=uSe(this.node.current,"blur",(()=>{this.isPressing&&ZSe("cancel",((e,t)=>this.cancelPress(e,t)))}));this.removeAccessibleListeners=CSe(e,t)}}startPress(e,t){this.isPressing=!0;const{onTapStart:n,whileTap:a}=this.node.getProps();a&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&iSe.postRender((()=>n(e,t)))}checkPressEnd(){this.removeEndListeners(),this.isPressing=!1;return this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!vSe()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&iSe.postRender((()=>n(e,t)))}mount(){const e=this.node.getProps(),t=mSe(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),n=uSe(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=CSe(t,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}},focus:{Feature:class extends SSe{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(Pke){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=CSe(uSe(this.node.current,"focus",(()=>this.onFocus())),uSe(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends SSe{mount(){this.unmount=CSe(xSe(this.node,!0),xSe(this.node,!1))}unmount(){}}}};function XSe(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let a=0;a<n;a++)if(t[a]!==e[a])return!1;return!0}function MSe(e,t,n){const a=e.getProps();return Uve(a,t,void 0!==n?n:a.custom,e)}const TSe=e=>1e3*e,ESe=e=>e/1e3,FSe={type:"spring",stiffness:500,damping:25,restSpeed:10},HSe={type:"keyframes",duration:.8},JSe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},YSe=(e,t)=>{let{keyframes:n}=t;return n.length>2?HSe:OAe.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:FSe:JSe};function LSe(e,t){return e[t]||e.default||e}const zSe=!1,KSe=e=>null!==e;function DSe(e,t,n){let{repeat:a,repeatType:o="loop"}=t;const i=e.filter(KSe),r=a&&"loop"!==o&&a%2===1?0:i.length-1;return r&&void 0!==n?n:i[r]}let USe;function PSe(){USe=void 0}const OSe={now:()=>(void 0===USe&&OSe.set(sSe.isProcessing||fAe?sSe.timestamp:performance.now()),USe),set:e=>{USe=e,queueMicrotask(PSe)}},_Se=e=>/^0[^.\s]+$/u.test(e);const QSe=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),jSe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function qSe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;sAe(n<=4,'Max CSS variable fallback depth detected in property "'.concat(e,'". This may indicate a circular fallback dependency.'));const[a,o]=function(e){const t=jSe.exec(e);if(!t)return[,];const[,n,a,o]=t;return["--".concat(null!==n&&void 0!==n?n:a),o]}(e);if(!a)return;const i=window.getComputedStyle(t).getPropertyValue(a);if(i){const e=i.trim();return QSe(e)?parseFloat(e):e}return Ave(o)?qSe(o,t,n+1):o}const $Se=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),exe=e=>e===$Ae||e===gve,txe=(e,t)=>parseFloat(e.split(", ")[t]),nxe=(e,t)=>(n,a)=>{let{transform:o}=a;if("none"===o||!o)return 0;const i=o.match(/^matrix3d\((.+)\)$/u);if(i)return txe(i[1],t);{const t=o.match(/^matrix\((.+)\)$/u);return t?txe(t[1],e):0}},axe=new Set(["x","y","z"]),oxe=PAe.filter((e=>!axe.has(e)));const ixe={width:(e,t)=>{let{x:n}=e,{paddingLeft:a="0",paddingRight:o="0"}=t;return n.max-n.min-parseFloat(a)-parseFloat(o)},height:(e,t)=>{let{y:n}=e,{paddingTop:a="0",paddingBottom:o="0"}=t;return n.max-n.min-parseFloat(a)-parseFloat(o)},top:(e,t)=>{let{top:n}=t;return parseFloat(n)},left:(e,t)=>{let{left:n}=t;return parseFloat(n)},bottom:(e,t)=>{let{y:n}=e,{top:a}=t;return parseFloat(a)+(n.max-n.min)},right:(e,t)=>{let{x:n}=e,{left:a}=t;return parseFloat(a)+(n.max-n.min)},x:nxe(4,13),y:nxe(5,14)};ixe.translateX=ixe.x,ixe.translateY=ixe.y;const rxe=e=>t=>t.test(e),sxe=[$Ae,gve,cve,lve,dve,uve,{test:e=>"auto"===e,parse:e=>e}],lxe=e=>sxe.find(rxe(e)),cxe=new Set;let gxe=!1,uxe=!1;function dxe(){if(uxe){const e=Array.from(cxe).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),n=new Map;t.forEach((e=>{const t=function(e){const t=[];return oxe.forEach((n=>{const a=e.getValue(n);void 0!==a&&(t.push([n,a.get()]),a.set(n.startsWith("scale")?1:0))})),t}(e);t.length&&(n.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=n.get(e);t&&t.forEach((t=>{let[n,a]=t;var o;null===(o=e.getValue(n))||void 0===o||o.set(a)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}uxe=!1,gxe=!1,cxe.forEach((e=>e.complete())),cxe.clear()}function hxe(){cxe.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(uxe=!0)}))}class pxe{constructor(e,t,n,a,o){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=a,this.element=o,this.isAsync=i}scheduleResolve(){this.isScheduled=!0,this.isAsync?(cxe.add(this),gxe||(gxe=!0,iSe.read(hxe),iSe.resolveKeyframes(dxe))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:a}=this;for(let o=0;o<e.length;o++)if(null===e[o])if(0===o){const o=null===a||void 0===a?void 0:a.get(),i=e[e.length-1];if(void 0!==o)e[0]=o;else if(n&&t){const a=n.readValue(t,i);void 0!==a&&null!==a&&(e[0]=a)}void 0===e[0]&&(e[0]=i),a&&void 0===o&&a.set(e[0])}else e[o]=e[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),cxe.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,cxe.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const mxe=(e,t)=>n=>Boolean(rve(n)&&ive.test(n)&&n.startsWith(e)||t&&!function(e){return null==e}(n)&&Object.prototype.hasOwnProperty.call(n,t)),Ixe=(e,t,n)=>a=>{if(!rve(a))return a;const[o,i,r,s]=a.match(ave);return{[e]:parseFloat(o),[t]:parseFloat(i),[n]:parseFloat(r),alpha:void 0!==s?parseFloat(s):1}},Cxe={...$Ae,transform:e=>Math.round((e=>qAe(0,255,e))(e))},fxe={test:mxe("rgb","red"),parse:Ixe("red","green","blue"),transform:e=>{let{red:t,green:n,blue:a,alpha:o=1}=e;return"rgba("+Cxe.transform(t)+", "+Cxe.transform(n)+", "+Cxe.transform(a)+", "+nve(eve.transform(o))+")"}};const bxe={test:mxe("#"),parse:function(e){let t="",n="",a="",o="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),a=e.substring(5,7),o=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),a=e.substring(3,4),o=e.substring(4,5),t+=t,n+=n,a+=a,o+=o),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(a,16),alpha:o?parseInt(o,16)/255:1}},transform:fxe.transform},yxe={test:mxe("hsl","hue"),parse:Ixe("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:n,lightness:a,alpha:o=1}=e;return"hsla("+Math.round(t)+", "+cve.transform(nve(n))+", "+cve.transform(nve(a))+", "+nve(eve.transform(o))+")"}},Axe={test:e=>fxe.test(e)||bxe.test(e)||yxe.test(e),parse:e=>fxe.test(e)?fxe.parse(e):yxe.test(e)?yxe.parse(e):bxe.parse(e),transform:e=>rve(e)?e:e.hasOwnProperty("red")?fxe.transform(e):yxe.transform(e)};const vxe="number",Sxe="color",xxe="var",Gxe="var(",Zxe="${}",wxe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function kxe(e){const t=e.toString(),n=[],a={color:[],number:[],var:[]},o=[];let i=0;const r=t.replace(wxe,(e=>(Axe.test(e)?(a.color.push(i),o.push(Sxe),n.push(Axe.parse(e))):e.startsWith(Gxe)?(a.var.push(i),o.push(xxe),n.push(e)):(a.number.push(i),o.push(vxe),n.push(parseFloat(e))),++i,Zxe))).split(Zxe);return{values:n,split:r,indexes:a,types:o}}function Bxe(e){return kxe(e).values}function Rxe(e){const{split:t,types:n}=kxe(e),a=t.length;return e=>{let o="";for(let i=0;i<a;i++)if(o+=t[i],void 0!==e[i]){const t=n[i];o+=t===vxe?nve(e[i]):t===Sxe?Axe.transform(e[i]):e[i]}return o}}const Wxe=e=>"number"===typeof e?0:e;const Vxe={test:function(e){var t,n;return isNaN(e)&&rve(e)&&((null===(t=e.match(ave))||void 0===t?void 0:t.length)||0)+((null===(n=e.match(ove))||void 0===n?void 0:n.length)||0)>0},parse:Bxe,createTransformer:Rxe,getAnimatableNone:function(e){const t=Bxe(e);return Rxe(e)(t.map(Wxe))}},Nxe=new Set(["brightness","contrast","saturate","opacity"]);function Xxe(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[a]=n.match(ave)||[];if(!a)return e;const o=n.replace(a,"");let i=Nxe.has(t)?1:0;return a!==n&&(i*=100),t+"("+i+o+")"}const Mxe=/\b([a-z-]*)\(.*?\)/gu,Txe={...Vxe,getAnimatableNone:e=>{const t=e.match(Mxe);return t?t.map(Xxe).join(" "):e}},Exe={...mve,color:Axe,backgroundColor:Axe,outlineColor:Axe,fill:Axe,stroke:Axe,borderColor:Axe,borderTopColor:Axe,borderRightColor:Axe,borderBottomColor:Axe,borderLeftColor:Axe,filter:Txe,WebkitFilter:Txe},Fxe=e=>Exe[e];function Hxe(e,t){let n=Fxe(e);return n!==Txe&&(n=Vxe),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const Jxe=new Set(["auto","none","0"]);class Yxe extends pxe{constructor(e,t,n,a){super(e,t,n,a,null===a||void 0===a?void 0:a.owner,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t.current)return;super.readKeyframes();for(let s=0;s<e.length;s++){let n=e[s];if("string"===typeof n&&(n=n.trim(),Ave(n))){const a=qSe(n,t.current);void 0!==a&&(e[s]=a),s===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!$Se.has(n)||2!==e.length)return;const[a,o]=e,i=lxe(a),r=lxe(o);if(i!==r)if(exe(i)&&exe(r))for(let s=0;s<e.length;s++){const t=e[s];"string"===typeof t&&(e[s]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let o=0;o<e.length;o++)("number"===typeof(a=e[o])?0===a:null===a||"none"===a||"0"===a||_Se(a))&&n.push(o);var a;n.length&&function(e,t,n){let a,o=0;for(;o<e.length&&!a;){const t=e[o];"string"===typeof t&&!Jxe.has(t)&&kxe(t).values.length&&(a=e[o]),o++}if(a&&n)for(const i of t)e[i]=Hxe(n,a)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ixe[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const a=t[t.length-1];void 0!==a&&e.getValue(n,a).jump(a,!1)}measureEndState(){var e;const{element:t,name:n,unresolvedKeyframes:a}=this;if(!t.current)return;const o=t.getValue(n);o&&o.jump(this.measuredOrigin,!1);const i=a.length-1,r=a[i];a[i]=ixe[n](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==r&&void 0===this.finalKeyframe&&(this.finalKeyframe=r),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach((e=>{let[n,a]=e;t.getValue(n).set(a)})),this.resolveNoneKeyframes()}}function Lxe(e){let t;return()=>(void 0===t&&(t=e()),t)}const zxe=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!Vxe.test(e)&&"0"!==e||e.startsWith("url(")));class Kxe{constructor(e){let{autoplay:t=!0,delay:n=0,type:a="keyframes",repeat:o=0,repeatDelay:i=0,repeatType:r="loop",...s}=e;this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:t,delay:n,type:a,repeat:o,repeatDelay:i,repeatType:r,...s},this.updateFinishedPromise()}get resolved(){return this._resolved||this.hasAttemptedResolve||(hxe(),dxe()),this._resolved}onKeyframesResolved(e,t){this.hasAttemptedResolve=!0;const{name:n,type:a,velocity:o,delay:i,onComplete:r,onUpdate:s,isGenerator:l}=this.options;if(!l&&!function(e,t,n,a){const o=e[0];if(null===o)return!1;if("display"===t||"visibility"===t)return!0;const i=e[e.length-1],r=zxe(o,t),s=zxe(i,t);return rAe(r===s,"You are trying to animate ".concat(t,' from "').concat(o,'" to "').concat(i,'". ').concat(o," is not an animatable value - to enable this animation set ").concat(o," to a value animatable to ").concat(i," via the `style` property.")),!(!r||!s)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||"spring"===n&&a)}(e,n,a,o)){if(zSe||!i)return null===s||void 0===s||s(DSe(e,this.options,t)),null===r||void 0===r||r(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,t);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:t,...c},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}updateFinishedPromise(){this.currentFinishedPromise=new Promise((e=>{this.resolveFinishedPromise=e}))}}function Dxe(e,t){return t?e*(1e3/t):0}const Uxe=5;function Pxe(e,t,n){const a=Math.max(t-Uxe,0);return Dxe(n-e(a),t-a)}const Oxe=.001,_xe=.01,Qxe=10,jxe=.05,qxe=1;function $xe(e){let t,n,{duration:a=800,bounce:o=.25,velocity:i=0,mass:r=1}=e;rAe(a<=TSe(Qxe),"Spring duration must be 10 seconds or less");let s=1-o;s=qAe(jxe,qxe,s),a=qAe(_xe,Qxe,ESe(a)),s<1?(t=e=>{const t=e*s,n=t*a,o=t-i,r=tGe(e,s),l=Math.exp(-n);return Oxe-o/r*l},n=e=>{const n=e*s*a,o=n*i+i,r=Math.pow(s,2)*Math.pow(e,2)*a,l=Math.exp(-n),c=tGe(Math.pow(e,2),s);return(-t(e)+Oxe>0?-1:1)*((o-r)*l)/c}):(t=e=>Math.exp(-e*a)*((e-i)*a+1)-Oxe,n=e=>Math.exp(-e*a)*(a*a*(i-e)));const l=function(e,t,n){let a=n;for(let o=1;o<eGe;o++)a-=e(a)/t(a);return a}(t,n,5/a);if(a=TSe(a),isNaN(l))return{stiffness:100,damping:10,duration:a};{const e=Math.pow(l,2)*r;return{stiffness:e,damping:2*s*Math.sqrt(r*e),duration:a}}}const eGe=12;function tGe(e,t){return e*Math.sqrt(1-t*t)}const nGe=["duration","bounce"],aGe=["stiffness","damping","mass"];function oGe(e,t){return t.some((t=>void 0!==e[t]))}function iGe(e){let{keyframes:t,restDelta:n,restSpeed:a,...o}=e;const i=t[0],r=t[t.length-1],s={done:!1,value:i},{stiffness:l,damping:c,mass:g,duration:u,velocity:d,isResolvedFromDuration:h}=function(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!oGe(e,aGe)&&oGe(e,nGe)){const n=$xe(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}({...o,velocity:-ESe(o.velocity||0)}),p=d||0,m=c/(2*Math.sqrt(l*g)),I=r-i,C=ESe(Math.sqrt(l/g)),f=Math.abs(I)<5;let b;if(a||(a=f?.01:2),n||(n=f?.005:.5),m<1){const e=tGe(C,m);b=t=>{const n=Math.exp(-m*C*t);return r-n*((p+m*C*I)/e*Math.sin(e*t)+I*Math.cos(e*t))}}else if(1===m)b=e=>r-Math.exp(-C*e)*(I+(p+C*I)*e);else{const e=C*Math.sqrt(m*m-1);b=t=>{const n=Math.exp(-m*C*t),a=Math.min(e*t,300);return r-n*((p+m*C*I)*Math.sinh(a)+e*I*Math.cosh(a))/e}}return{calculatedDuration:h&&u||null,next:e=>{const t=b(e);if(h)s.done=e>=u;else{let o=0;m<1&&(o=0===e?TSe(p):Pxe(b,e,t));const i=Math.abs(o)<=a,l=Math.abs(r-t)<=n;s.done=i&&l}return s.value=s.done?r:t,s}}}function rGe(e){let{keyframes:t,velocity:n=0,power:a=.8,timeConstant:o=325,bounceDamping:i=10,bounceStiffness:r=500,modifyTarget:s,min:l,max:c,restDelta:g=.5,restSpeed:u}=e;const d=t[0],h={done:!1,value:d},p=e=>void 0===l?c:void 0===c||Math.abs(l-e)<Math.abs(c-e)?l:c;let m=a*n;const I=d+m,C=void 0===s?I:s(I);C!==I&&(m=C-d);const f=e=>-m*Math.exp(-e/o),b=e=>C+f(e),y=e=>{const t=f(e),n=b(e);h.done=Math.abs(t)<=g,h.value=h.done?C:n};let A,v;const S=e=>{(e=>void 0!==l&&e<l||void 0!==c&&e>c)(h.value)&&(A=e,v=iGe({keyframes:[h.value,p(h.value)],velocity:Pxe(b,e,h.value),damping:i,stiffness:r,restDelta:g,restSpeed:u}))};return S(0),{calculatedDuration:null,next:e=>{let t=!1;return v||void 0!==A||(t=!0,y(e),S(e)),void 0!==A&&e>=A?v.next(e-A):(!t&&y(e),h)}}}const sGe=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,lGe=1e-7,cGe=12;function gGe(e,t,n,a){if(e===t&&n===a)return iAe;const o=t=>function(e,t,n,a,o){let i,r,s=0;do{r=t+(n-t)/2,i=sGe(r,a,o)-e,i>0?n=r:t=r}while(Math.abs(i)>lGe&&++s<cGe);return r}(t,0,1,e,n);return e=>0===e||1===e?e:sGe(o(e),t,a)}const uGe=gGe(.42,0,1,1),dGe=gGe(0,0,.58,1),hGe=gGe(.42,0,.58,1),pGe=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,mGe=e=>t=>1-e(1-t),IGe=e=>1-Math.sin(Math.acos(e)),CGe=mGe(IGe),fGe=pGe(IGe),bGe=gGe(.33,1.53,.69,.99),yGe=mGe(bGe),AGe=pGe(yGe),vGe={linear:iAe,easeIn:uGe,easeInOut:hGe,easeOut:dGe,circIn:IGe,circInOut:fGe,circOut:CGe,backIn:yGe,backInOut:AGe,backOut:bGe,anticipate:e=>(e*=2)<1?.5*yGe(e):.5*(2-Math.pow(2,-10*(e-1)))},SGe=e=>{if(Array.isArray(e)){sAe(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[t,n,a,o]=e;return gGe(t,n,a,o)}return"string"===typeof e?(sAe(void 0!==vGe[e],"Invalid easing type '".concat(e,"'")),vGe[e]):e},xGe=(e,t,n)=>{const a=t-e;return 0===a?1:(n-e)/a},GGe=(e,t,n)=>e+(t-e)*n;function ZGe(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function wGe(e,t){return n=>n>0?t:e}const kGe=(e,t,n)=>{const a=e*e,o=n*(t*t-a)+a;return o<0?0:Math.sqrt(o)},BGe=[bxe,fxe,yxe];function RGe(e){const t=(e=>BGe.find((t=>t.test(e))))(e);if(rAe(Boolean(t),"'".concat(e,"' is not an animatable color. Use the equivalent color code instead.")),!Boolean(t))return!1;let n=t.parse(e);return t===yxe&&(n=function(e){let{hue:t,saturation:n,lightness:a,alpha:o}=e;t/=360,n/=100,a/=100;let i=0,r=0,s=0;if(n){const e=a<.5?a*(1+n):a+n-a*n,o=2*a-e;i=ZGe(o,e,t+1/3),r=ZGe(o,e,t),s=ZGe(o,e,t-1/3)}else i=r=s=a;return{red:Math.round(255*i),green:Math.round(255*r),blue:Math.round(255*s),alpha:o}}(n)),n}const WGe=(e,t)=>{const n=RGe(e),a=RGe(t);if(!n||!a)return wGe(e,t);const o={...n};return e=>(o.red=kGe(n.red,a.red,e),o.green=kGe(n.green,a.green,e),o.blue=kGe(n.blue,a.blue,e),o.alpha=GGe(n.alpha,a.alpha,e),fxe.transform(o))},VGe=new Set(["none","hidden"]);function NGe(e,t){return n=>GGe(e,t,n)}function XGe(e){return"number"===typeof e?NGe:"string"===typeof e?Ave(e)?wGe:Axe.test(e)?WGe:EGe:Array.isArray(e)?MGe:"object"===typeof e?Axe.test(e)?WGe:TGe:wGe}function MGe(e,t){const n=[...e],a=n.length,o=e.map(((e,n)=>XGe(e)(e,t[n])));return e=>{for(let t=0;t<a;t++)n[t]=o[t](e);return n}}function TGe(e,t){const n={...e,...t},a={};for(const o in n)void 0!==e[o]&&void 0!==t[o]&&(a[o]=XGe(e[o])(e[o],t[o]));return e=>{for(const t in a)n[t]=a[t](e);return n}}const EGe=(e,t)=>{const n=Vxe.createTransformer(t),a=kxe(e),o=kxe(t);return a.indexes.var.length===o.indexes.var.length&&a.indexes.color.length===o.indexes.color.length&&a.indexes.number.length>=o.indexes.number.length?VGe.has(e)&&!o.values.length||VGe.has(t)&&!a.values.length?function(e,t){return VGe.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):CSe(MGe(function(e,t){var n;const a=[],o={color:0,var:0,number:0};for(let i=0;i<t.values.length;i++){const r=t.types[i],s=e.indexes[r][o[r]],l=null!==(n=e.values[s])&&void 0!==n?n:0;a[i]=l,o[r]++}return a}(a,o),o.values),n):(rAe(!0,"Complex values '".concat(e,"' and '").concat(t,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.")),wGe(e,t))};function FGe(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return GGe(e,t,n);return XGe(e)(e,t)}function HGe(e,t){let{clamp:n=!0,ease:a,mixer:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.length;if(sAe(i===t.length,"Both input and output ranges must be the same length"),1===i)return()=>t[0];if(2===i&&e[0]===e[1])return()=>t[1];e[0]>e[i-1]&&(e=[...e].reverse(),t=[...t].reverse());const r=function(e,t,n){const a=[],o=n||FGe,i=e.length-1;for(let r=0;r<i;r++){let n=o(e[r],e[r+1]);if(t){const e=Array.isArray(t)?t[r]||iAe:t;n=CSe(e,n)}a.push(n)}return a}(t,a,o),s=r.length,l=t=>{let n=0;if(s>1)for(;n<e.length-2&&!(t<e[n+1]);n++);const a=xGe(e[n],e[n+1],t);return r[n](a)};return n?t=>l(qAe(e[0],e[i-1],t)):l}function JGe(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let a=1;a<=t;a++){const o=xGe(0,t,a);e.push(GGe(n,1,o))}}(t,e.length-1),t}function YGe(e){let{duration:t=300,keyframes:n,times:a,ease:o="easeInOut"}=e;const i=(e=>Array.isArray(e)&&"number"!==typeof e[0])(o)?o.map(SGe):SGe(o),r={done:!1,value:n[0]},s=function(e,t){return e.map((e=>e*t))}(a&&a.length===n.length?a:JGe(n),t),l=HGe(s,n,{ease:Array.isArray(i)?i:(c=n,g=i,c.map((()=>g||hGe)).splice(0,c.length-1))});var c,g;return{calculatedDuration:t,next:e=>(r.value=l(e),r.done=e>=t,r)}}const LGe=e=>{const t=t=>{let{timestamp:n}=t;return e(n)};return{start:()=>iSe.update(t,!0),stop:()=>rSe(t),now:()=>sSe.isProcessing?sSe.timestamp:OSe.now()}},zGe={decay:rGe,inertia:rGe,tween:YGe,keyframes:YGe,spring:iGe},KGe=e=>e/100;class DGe extends Kxe{constructor(e){let{KeyframeResolver:t=pxe,...n}=e;super(n),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:a,motionValue:o,keyframes:i}=this.options,r=(e,t)=>this.onKeyframesResolved(e,t);a&&o&&o.owner?this.resolver=o.owner.resolveKeyframes(i,r,a,o):this.resolver=new t(i,r,a,o),this.resolver.scheduleResolve()}initPlayback(e){const{type:t="keyframes",repeat:n=0,repeatDelay:a=0,repeatType:o,velocity:i=0}=this.options,r=zGe[t]||YGe;let s,l;r!==YGe&&"number"!==typeof e[0]&&(s=CSe(KGe,FGe(e[0],e[1])),e=[0,100]);const c=r({...this.options,keyframes:e});"mirror"===o&&(l=r({...this.options,keyframes:[...e].reverse(),velocity:-i})),null===c.calculatedDuration&&(c.calculatedDuration=function(e){let t=0,n=e.next(t);for(;!n.done&&t<2e4;)t+=50,n=e.next(t);return t>=2e4?1/0:t}(c));const{calculatedDuration:g}=c,u=g+a;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:s,calculatedDuration:g,resolvedDuration:u,totalDuration:u*(n+1)-a}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{resolved:n}=this;if(!n){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:a,generator:o,mirroredGenerator:i,mapPercentToKeyframes:r,keyframes:s,calculatedDuration:l,totalDuration:c,resolvedDuration:g}=n;if(null===this.startTime)return o.next(0);const{delay:u,repeat:d,repeatType:h,repeatDelay:p,onUpdate:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const I=this.currentTime-u*(this.speed>=0?1:-1),C=this.speed>=0?I<0:I>c;this.currentTime=Math.max(I,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let f=this.currentTime,b=o;if(d){const e=Math.min(this.currentTime,c)/g;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===h?(n=1-n,p&&(n-=p/g)):"mirror"===h&&(b=i)),f=qAe(0,1,n)*g}const y=C?{done:!1,value:s[0]}:b.next(f);r&&(y.value=r(y.value));let{done:A}=y;C||null===l||(A=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const v=null===this.holdTime&&("finished"===this.state||"running"===this.state&&A);return v&&void 0!==a&&(y.value=DSe(s,this.options,a)),m&&m(y.value),v&&this.finish(),y}get duration(){const{resolved:e}=this;return e?ESe(e.calculatedDuration):0}get time(){return ESe(this.currentTime)}set time(e){e=TSe(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=ESe(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=LGe,onPlay:t}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),t&&t();const n=this.driver.now();null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime&&"finished"!==this.state||(this.startTime=n),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const UGe=e=>Array.isArray(e)&&"number"===typeof e[0];function PGe(e){return Boolean(!e||"string"===typeof e&&e in _Ge||UGe(e)||Array.isArray(e)&&e.every(PGe))}const OGe=e=>{let[t,n,a,o]=e;return"cubic-bezier(".concat(t,", ").concat(n,", ").concat(a,", ").concat(o,")")},_Ge={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:OGe([0,.65,.55,1]),circOut:OGe([.55,0,1,.45]),backIn:OGe([.31,.01,.66,-.59]),backOut:OGe([.33,1.53,.69,.99])};function QGe(e){return jGe(e)||_Ge.easeOut}function jGe(e){return e?UGe(e)?OGe(e):Array.isArray(e)?e.map(QGe):_Ge[e]:void 0}const qGe=Lxe((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));class $Ge extends Kxe{constructor(e){super(e);const{name:t,motionValue:n,keyframes:a}=this.options;this.resolver=new Yxe(a,((e,t)=>this.onKeyframesResolved(e,t)),t,n),this.resolver.scheduleResolve()}initPlayback(e,t){var n;let{duration:a=300,times:o,ease:i,type:r,motionValue:s,name:l}=this.options;if(!(null===(n=s.owner)||void 0===n?void 0:n.current))return!1;if("spring"===(c=this.options).type||!PGe(c.ease)){const{onComplete:t,onUpdate:n,motionValue:s,...l}=this.options,c=function(e,t){const n=new DGe({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:e[0]};const o=[];let i=0;for(;!a.done&&i<2e4;)a=n.sample(i),o.push(a.value),i+=10;return{times:void 0,keyframes:o,duration:i-10,ease:"linear"}}(e,l);1===(e=c.keyframes).length&&(e[1]=e[0]),a=c.duration,o=c.times,i=c.ease,r="keyframes"}var c;const g=function(e,t,n){let{delay:a=0,duration:o=300,repeat:i=0,repeatType:r="loop",ease:s,times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={[t]:n};l&&(c.offset=l);const g=jGe(s);return Array.isArray(g)&&(c.easing=g),e.animate(c,{delay:a,duration:o,easing:Array.isArray(g)?"linear":g,fill:"both",iterations:i+1,direction:"reverse"===r?"alternate":"normal"})}(s.owner.current,l,e,{...this.options,duration:a,times:o,ease:i});return g.startTime=OSe.now(),this.pendingTimeline?(g.timeline=this.pendingTimeline,this.pendingTimeline=void 0):g.onfinish=()=>{const{onComplete:n}=this.options;s.set(DSe(e,this.options,t)),n&&n(),this.cancel(),this.resolveFinishedPromise()},{animation:g,duration:a,times:o,type:r,ease:i,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return ESe(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return ESe(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.currentTime=TSe(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return iAe;const{animation:n}=t;n.timeline=e,n.onfinish=null}else this.pendingTimeline=e;return iAe}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:n,duration:a,type:o,ease:i,times:r}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const{motionValue:e,onUpdate:t,onComplete:s,...l}=this.options,c=new DGe({...l,keyframes:n,duration:a,type:o,ease:i,times:r,isGenerator:!0}),g=TSe(this.time);e.setWithVelocity(c.sample(g-10).value,c.sample(g).value,10)}const{onStop:s}=this.options;s&&s(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:n,repeatDelay:a,repeatType:o,damping:i,type:r}=e;return qGe()&&n&&jve.has(n)&&t&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate&&!a&&"mirror"!==o&&0!==i&&"inertia"!==r}}const eZe=Lxe((()=>void 0!==window.ScrollTimeline));class tZe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}then(e,t){return Promise.all(this.animations).then(e).catch(t)}getAll(e){return this.animations[0][e]}setAll(e,t){for(let n=0;n<this.animations.length;n++)this.animations[n][e]=t}attachTimeline(e){const t=this.animations.map((t=>{if(!eZe()||!t.attachTimeline)return t.pause(),function(e,t){let n;const a=()=>{const{currentTime:a}=t,o=(null===a?0:a.value)/100;n!==o&&e(o),n=o};return iSe.update(a,!0),()=>rSe(a)}((e=>{t.time=t.duration*e}),e);t.attachTimeline(e)}));return()=>{t.forEach(((e,t)=>{e&&e(),this.animations[t].stop()}))}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach((t=>t[e]()))}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}const nZe=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0;return s=>{const l=LSe(a,e)||{},c=l.delay||a.delay||0;let{elapsed:g=0}=a;g-=TSe(c);let u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-g,onUpdate:e=>{t.set(e),l.onUpdate&&l.onUpdate(e)},onComplete:()=>{s(),l.onComplete&&l.onComplete(),r&&r()},onStop:r,name:e,motionValue:t,element:i?void 0:o};(function(e){let{when:t,delay:n,delayChildren:a,staggerChildren:o,staggerDirection:i,repeat:r,repeatType:s,repeatDelay:l,from:c,elapsed:g,...u}=e;return!!Object.keys(u).length})(l)||(u={...u,...YSe(e,u)}),u.duration&&(u.duration=TSe(u.duration)),u.repeatDelay&&(u.repeatDelay=TSe(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let d=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(u.duration=0,0===u.delay&&(d=!0)),(zSe||CAe)&&(d=!0,u.duration=0,u.delay=0),d&&!i&&void 0!==t.get()){const e=DSe(u.keyframes,l);if(void 0!==e)return iSe.update((()=>{u.onUpdate(e),u.onComplete()})),new tZe([])}return!i&&$Ge.supports(u)?new $Ge(u):new DGe(u)}};class aZe{constructor(){this.subscriptions=[]}add(e){return $ve(this.subscriptions,e),()=>eSe(this.subscriptions,e)}notify(e,t,n){const a=this.subscriptions.length;if(a)if(1===a)this.subscriptions[0](e,t,n);else for(let o=0;o<a;o++){const a=this.subscriptions[o];a&&a(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const oZe={current:void 0};class iZe{constructor(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.version="11.3.24",this.canTrackVelocity=null,this.events={},this.updateAndNotify=function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const a=OSe.now();t.updatedAt!==a&&t.setPrevFrameValue(),t.prev=t.current,t.setCurrent(e),t.current!==t.prev&&t.events.change&&t.events.change.notify(t.current),n&&t.events.renderRequest&&t.events.renderRequest.notify(t.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){var t;this.current=e,this.updatedAt=OSe.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new aZe);const n=this.events[e].add(t);return"change"===e?()=>{n(),iSe.read((()=>{this.events.change.getSize()||this.stop()}))}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return oZe.current&&oZe.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=OSe.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Dxe(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function rZe(e,t){return new iZe(e,t)}function sZe(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,rZe(n))}function lZe(e){return e.getProps()[IAe]}class cZe extends iZe{constructor(){super(...arguments),this.output=[],this.counts=new Map}add(e){const t=qve(e);if(!t)return;const n=this.counts.get(t)||0;this.counts.set(t,n+1),0===n&&(this.output.push(t),this.update());let a=!1;return()=>{if(a)return;a=!0;const e=this.counts.get(t)-1;this.counts.set(t,e),0===e&&(eSe(this.output,t),this.update())}}update(){this.set(this.output.length?this.output.join(", "):"auto")}}function gZe(e,t){var n;if(!e.applyWillChange)return;let a=e.getValue("willChange");return a||(null===(n=e.props.style)||void 0===n?void 0:n.willChange)||(a=new cZe("auto"),e.addValue("willChange",a)),o=a,Boolean(QAe(o)&&o.add)?a.add(t):void 0;var o}function uZe(e,t){let{protectedKeys:n,needsAnimating:a}=e;const o=n.hasOwnProperty(t)&&!0!==a[t];return a[t]=!1,o}function dZe(e,t){let{delay:n=0,transitionOverride:a,type:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;let{transition:r=e.getDefaultTransition(),transitionEnd:s,...l}=t;a&&(r=a);const c=[],g=o&&e.animationState&&e.animationState.getState()[o];for(const u in l){const t=e.getValue(u,null!==(i=e.latestValues[u])&&void 0!==i?i:null),a=l[u];if(void 0===a||g&&uZe(g,u))continue;const o={delay:n,elapsed:0,...LSe(r||{},u)};let s=!1;if(window.MotionHandoffAnimation){const t=lZe(e);if(t){const e=window.MotionHandoffAnimation(t,u,iSe);null!==e&&(o.elapsed=e,s=!0)}}t.start(nZe(u,t,a,e.shouldReduceMotion&&OAe.has(u)?{type:!1}:o,e,s,gZe(e,u)));const d=t.animation;d&&c.push(d)}return s&&Promise.all(c).then((()=>{iSe.update((()=>{s&&function(e,t){const n=MSe(e,t);let{transitionEnd:a={},transition:o={},...i}=n||{};i={...i,...a};for(const r in i)sZe(e,r,_ve(i[r]))}(e,s)}))})),c}function hZe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var a;const o=MSe(e,t,"exit"===n.type?null===(a=e.presenceContext)||void 0===a?void 0:a.custom:void 0);let{transition:i=e.getDefaultTransition()||{}}=o||{};n.transitionOverride&&(i=n.transitionOverride);const r=o?()=>Promise.all(dZe(e,o,n)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:o=0,staggerChildren:r,staggerDirection:s}=i;return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5?arguments[5]:void 0;const r=[],s=(e.variantChildren.size-1)*a,l=1===o?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*a}:function(){return s-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*a};return Array.from(e.variantChildren).sort(pZe).forEach(((e,a)=>{e.notify("AnimationStart",t),r.push(hZe(e,t,{...i,delay:n+l(a)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(r)}(e,t,o+a,r,s,n)}:()=>Promise.resolve(),{when:l}=i;if(l){const[e,t]="beforeChildren"===l?[r,s]:[s,r];return e().then((()=>t()))}return Promise.all([r(),s(n.delay)])}function pZe(e,t){return e.sortNodePosition(t)}const mZe=[...VAe].reverse(),IZe=VAe.length;function CZe(e){return t=>Promise.all(t.map((t=>{let{animation:n,options:a}=t;return function(e,t){let n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const o=t.map((t=>hZe(e,t,a)));n=Promise.all(o)}else if("string"===typeof t)n=hZe(e,t,a);else{const o="function"===typeof t?MSe(e,t,a.custom):t;n=Promise.all(dZe(e,o,a))}return n.then((()=>{e.notify("AnimationComplete",t)}))}(e,n,a)})))}function fZe(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!XSe(t,e)}function bZe(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function yZe(){return{animate:bZe(!0),whileInView:bZe(),whileHover:bZe(),whileTap:bZe(),whileDrag:bZe(),whileFocus:bZe(),exit:bZe()}}let AZe=0;const vZe={animation:{Feature:class extends SSe{constructor(e){super(e),e.animationState||(e.animationState=function(e){let t=CZe(e),n=yZe(),a=!0;const o=t=>(n,a)=>{var o;const i=MSe(e,a,"exit"===t?null===(o=e.presenceContext)||void 0===o?void 0:o.custom:void 0);if(i){const{transition:e,transitionEnd:t,...a}=i;n={...n,...a,...t}}return n};function i(i){const r=e.getProps(),s=e.getVariantContext(!0)||{},l=[],c=new Set;let g={},u=1/0;for(let t=0;t<IZe;t++){const d=mZe[t],h=n[d],p=void 0!==r[d]?r[d]:s[d],m=RAe(p),I=d===i?h.isActive:null;!1===I&&(u=t);let C=p===s[d]&&p!==r[d]&&m;if(C&&a&&e.manuallyAnimateOnMount&&(C=!1),h.protectedKeys={...g},!h.isActive&&null===I||!p&&!h.prevProp||WAe(p)||"boolean"===typeof p)continue;let f=fZe(h.prevProp,p)||d===i&&h.isActive&&!C&&m||t>u&&m,b=!1;const y=Array.isArray(p)?p:[p];let A=y.reduce(o(d),{});!1===I&&(A={});const{prevResolvedValues:v={}}=h,S={...v,...A},x=t=>{f=!0,c.has(t)&&(b=!0,c.delete(t)),h.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in S){const t=A[e],n=v[e];if(g.hasOwnProperty(e))continue;let a=!1;a=Pve(t)&&Pve(n)?!XSe(t,n):t!==n,a?void 0!==t&&null!==t?x(e):c.add(e):void 0!==t&&c.has(e)?x(e):h.protectedKeys[e]=!0}h.prevProp=p,h.prevResolvedValues=A,h.isActive&&(g={...g,...A}),a&&e.blockInitialAnimation&&(f=!1),!f||C&&!b||l.push(...y.map((e=>({animation:e,options:{type:d}}))))}if(c.size){const t={};c.forEach((n=>{const a=e.getBaseTarget(n),o=e.getValue(n);o&&(o.liveStyle=!0),t[n]=null!==a&&void 0!==a?a:null})),l.push({animation:t})}let d=Boolean(l.length);return!a||!1!==r.initial&&r.initial!==r.animate||e.manuallyAnimateOnMount||(d=!1),a=!1,d?t(l):Promise.resolve()}return{animateChanges:i,setActive:function(t,a){var o;if(n[t].isActive===a)return Promise.resolve();null===(o=e.variantChildren)||void 0===o||o.forEach((e=>{var n;return null===(n=e.animationState)||void 0===n?void 0:n.setActive(t,a)})),n[t].isActive=a;const r=i(t);for(const e in n)n[e].protectedKeys={};return r},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=yZe(),a=!0}}}(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();WAe(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends SSe{constructor(){super(...arguments),this.id=AZe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const a=this.node.animationState.setActive("exit",!e);t&&!e&&a.then((()=>t(this.id)))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}},SZe=(e,t)=>Math.abs(e-t);class xZe{constructor(e,t){let{transformPagePoint:n,contextWindow:a,dragSnapToOrigin:o=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=wZe(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=SZe(e.x,t.x),a=SZe(e.y,t.y);return Math.sqrt(n**2+a**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!n)return;const{point:a}=e,{timestamp:o}=sSe;this.history.push({...a,timestamp:o});const{onStart:i,onMove:r}=this.handlers;t||(i&&i(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),r&&r(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=GZe(t,this.transformPagePoint),iSe.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:a,resumeAnimation:o}=this.handlers;if(this.dragSnapToOrigin&&o&&o(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const i=wZe("pointercancel"===e.type?this.lastMoveEventInfo:GZe(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,i),a&&a(e,i)},!dSe(e))return;this.dragSnapToOrigin=o,this.handlers=t,this.transformPagePoint=n,this.contextWindow=a||window;const i=GZe(hSe(e),this.transformPagePoint),{point:r}=i,{timestamp:s}=sSe;this.history=[{...r,timestamp:s}];const{onSessionStart:l}=t;l&&l(e,wZe(i,this.history)),this.removeListeners=CSe(mSe(this.contextWindow,"pointermove",this.handlePointerMove),mSe(this.contextWindow,"pointerup",this.handlePointerUp),mSe(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),rSe(this.updatePoint)}}function GZe(e,t){return t?{point:t(e.point)}:e}function ZZe(e,t){return{x:e.x-t.x,y:e.y-t.y}}function wZe(e,t){let{point:n}=e;return{point:n,delta:ZZe(n,BZe(t)),offset:ZZe(n,kZe(t)),velocity:RZe(t,.1)}}function kZe(e){return e[0]}function BZe(e){return e[e.length-1]}function RZe(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,a=null;const o=BZe(e);for(;n>=0&&(a=e[n],!(o.timestamp-a.timestamp>TSe(t)));)n--;if(!a)return{x:0,y:0};const i=ESe(o.timestamp-a.timestamp);if(0===i)return{x:0,y:0};const r={x:(o.x-a.x)/i,y:(o.y-a.y)/i};return r.x===1/0&&(r.x=0),r.y===1/0&&(r.y=0),r}const WZe=.9999,VZe=1.0001,NZe=-.01,XZe=.01;function MZe(e){return e.max-e.min}function TZe(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=a,e.originPoint=GGe(t.min,t.max,e.origin),e.scale=MZe(n)/MZe(t),e.translate=GGe(n.min,n.max,e.origin)-e.originPoint,(e.scale>=WZe&&e.scale<=VZe||isNaN(e.scale))&&(e.scale=1),(e.translate>=NZe&&e.translate<=XZe||isNaN(e.translate))&&(e.translate=0)}function EZe(e,t,n,a){TZe(e.x,t.x,n.x,a?a.originX:void 0),TZe(e.y,t.y,n.y,a?a.originY:void 0)}function FZe(e,t,n){e.min=n.min+t.min,e.max=e.min+MZe(t)}function HZe(e,t,n){e.min=t.min-n.min,e.max=e.min+MZe(t)}function JZe(e,t,n){HZe(e.x,t.x,n.x),HZe(e.y,t.y,n.y)}function YZe(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function LZe(e,t){let n=t.min-e.min,a=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,a]=[a,n]),{min:n,max:a}}const zZe=.35;function KZe(e,t,n){return{min:DZe(e,t),max:DZe(e,n)}}function DZe(e,t){return"number"===typeof e?e:e[t]||0}const UZe=()=>({x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}),PZe=()=>({x:{min:0,max:0},y:{min:0,max:0}});function OZe(e){return[e("x"),e("y")]}function _Ze(e){let{top:t,left:n,right:a,bottom:o}=e;return{x:{min:n,max:a},y:{min:t,max:o}}}function QZe(e){return void 0===e||1===e}function jZe(e){let{scale:t,scaleX:n,scaleY:a}=e;return!QZe(t)||!QZe(n)||!QZe(a)}function qZe(e){return jZe(e)||$Ze(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function $Ze(e){return ewe(e.x)||ewe(e.y)}function ewe(e){return e&&"0%"!==e}function twe(e,t,n){return n+t*(e-n)}function nwe(e,t,n,a,o){return void 0!==o&&(e=twe(e,o,a)),twe(e,n,a)+t}function awe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;e.min=nwe(e.min,t,n,a,o),e.max=nwe(e.max,t,n,a,o)}function owe(e,t){let{x:n,y:a}=t;awe(e.x,n.translate,n.scale,n.originPoint),awe(e.y,a.translate,a.scale,a.originPoint)}const iwe=.999999999999,rwe=1.0000000000001;function swe(e,t){e.min=e.min+t,e.max=e.max+t}function lwe(e,t,n,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;awe(e,t,n,GGe(e.min,e.max,o),a)}function cwe(e,t){lwe(e.x,t.x,t.scaleX,t.scale,t.originX),lwe(e.y,t.y,t.scaleY,t.scale,t.originY)}function gwe(e,t){return _Ze(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),a=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:a.y,right:a.x}}(e.getBoundingClientRect(),t))}const uwe=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null},dwe=new WeakMap;class hwe{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=PZe(),this.visualElement=e}start(e){let{snapToCursor:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:a}=this.getProps();this.panSession=new xZe(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(hSe(e,"page").point)},onStart:(e,t)=>{var n;const{drag:a,dragPropagation:o,onDragStart:i}=this.getProps();if(a&&!o&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=ASe(a),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),OZe((e=>{let t=this.getAxisMotionValue(e).get()||0;if(cve.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const a=n.layout.layoutBox[e];if(a){t=MZe(a)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),i&&iSe.postRender((()=>i(e,t))),null===(n=this.removeWillChange)||void 0===n||n.call(this),this.removeWillChange=gZe(this.visualElement,"transform");const{animationState:r}=this.visualElement;r&&r.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:n,dragDirectionLock:a,onDirectionLock:o,onDrag:i}=this.getProps();if(!n&&!this.openGlobalLock)return;const{offset:r}=t;if(a&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(r),void(null!==this.currentDirection&&o&&o(this.currentDirection));this.updateAxis("x",t.point,r),this.updateAxis("y",t.point,r),this.visualElement.render(),i&&i(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>OZe((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:a,contextWindow:uwe(this.visualElement)})}stop(e,t){var n;null===(n=this.removeWillChange)||void 0===n||n.call(this);const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:o}=t;this.startAnimation(o);const{onDragEnd:i}=this.getProps();i&&iSe.postRender((()=>i(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:a}=this.getProps();if(!n||!pwe(e,a,this.currentDirection))return;const o=this.getAxisMotionValue(e);let i=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(i=function(e,t,n){let{min:a,max:o}=t;return void 0!==a&&e<a?e=n?GGe(a,e,n.min):Math.max(e,a):void 0!==o&&e>o&&(e=n?GGe(o,e,n.max):Math.min(e,o)),e}(i,this.constraints[e],this.elastic[e])),o.set(i)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,o=this.constraints;t&&SAe(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!a)&&function(e,t){let{top:n,left:a,bottom:o,right:i}=t;return{x:YZe(e.x,a,i),y:YZe(e.y,n,o)}}(a.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zZe;return!1===e?e=0:!0===e&&(e=zZe),{x:KZe(e,"left","right"),y:KZe(e,"top","bottom")}}(n),o!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&OZe((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(a.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!SAe(e))return!1;const n=e.current;sAe(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const o=function(e,t,n){const a=gwe(e,n),{scroll:o}=t;return o&&(swe(a.x,o.offset.x),swe(a.y,o.offset.y)),a}(n,a.root,this.visualElement.getTransformPagePoint());let i=function(e,t){return{x:LZe(e.x,t.x),y:LZe(e.y,t.y)}}(a.layout.layoutBox,o);if(t){const e=t(function(e){let{x:t,y:n}=e;return{top:n.min,right:t.max,bottom:n.max,left:t.min}}(i));this.hasMutatedConstraints=!!e,e&&(i=_Ze(e))}return i}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:a,dragTransition:o,dragSnapToOrigin:i,onDragTransitionEnd:r}=this.getProps(),s=this.constraints||{},l=OZe((r=>{if(!pwe(r,t,this.currentDirection))return;let l=s&&s[r]||{};i&&(l={min:0,max:0});const c=a?200:1e6,g=a?40:1e7,u={type:"inertia",velocity:n?e[r]:0,bounceStiffness:c,bounceDamping:g,timeConstant:750,restDelta:1,restSpeed:10,...o,...l};return this.startAxisValueAnimation(r,u)}));return Promise.all(l).then(r)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return n.start(nZe(e,n,0,t,this.visualElement,!1,gZe(this.visualElement,e)))}stopAnimation(){OZe((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){OZe((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag".concat(e.toUpperCase()),n=this.visualElement.getProps(),a=n[t];return a||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){OZe((t=>{const{drag:n}=this.getProps();if(!pwe(t,n,this.currentDirection))return;const{projection:a}=this.visualElement,o=this.getAxisMotionValue(t);if(a&&a.layout){const{min:n,max:i}=a.layout.layoutBox[t];o.set(e[t]-GGe(n,i,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!SAe(t)||!n||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};OZe((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();a[e]=function(e,t){let n=.5;const a=MZe(e),o=MZe(t);return o>a?n=xGe(t.min,t.max-a,e.min):a>o&&(n=xGe(e.min,e.max-o,t.min)),qAe(0,1,n)}({min:n,max:n},this.constraints[e])}}));const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),OZe((t=>{if(!pwe(t,e,null))return;const n=this.getAxisMotionValue(t),{min:o,max:i}=this.constraints[t];n.set(GGe(o,i,a[t]))}))}addListeners(){if(!this.visualElement.current)return;dwe.set(this.visualElement,this);const e=mSe(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();SAe(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,a=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),iSe.read(t);const o=uSe(window,"resize",(()=>this.scalePositionWithinConstraints())),i=n.addEventListener("didUpdate",(e=>{let{delta:t,hasLayoutChanged:n}=e;this.isDragging&&n&&(OZe((e=>{const n=this.getAxisMotionValue(e);n&&(this.originPoint[e]+=t[e].translate,n.set(n.get()+t[e].translate))})),this.visualElement.render())}));return()=>{o(),e(),a(),i&&i()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:a=!1,dragConstraints:o=!1,dragElastic:i=zZe,dragMomentum:r=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:a,dragConstraints:o,dragElastic:i,dragMomentum:r}}}function pwe(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}const mwe=e=>(t,n)=>{e&&iSe.postRender((()=>e(t,n)))};const Iwe={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Cwe(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const fwe={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!gve.test(e))return e;e=parseFloat(e)}const n=Cwe(e,t.target.x),a=Cwe(e,t.target.y);return"".concat(n,"% ").concat(a,"%")}},bwe={correct:(e,t)=>{let{treeScale:n,projectionDelta:a}=t;const o=e,i=Vxe.parse(e);if(i.length>5)return o;const r=Vxe.createTransformer(e),s="number"!==typeof i[0]?1:0,l=a.x.scale*n.x,c=a.y.scale*n.y;i[0+s]/=l,i[1+s]/=c;const g=GGe(l,c,.5);return"number"===typeof i[2+s]&&(i[2+s]/=g),"number"===typeof i[3+s]&&(i[3+s]/=g),r(i)}};class ywe extends a.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:a}=this.props,{projection:o}=e;var i;i=vwe,Object.assign(UAe,i),o&&(t.group&&t.group.add(o),n&&n.register&&a&&n.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",(()=>{this.safeToRemove()})),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),Iwe.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:a,isPresent:o}=this.props,i=n.projection;return i?(i.isPresent=o,a||e.layoutDependency!==t||void 0===t?i.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?i.promote():i.relegate()||iSe.postRender((()=>{const e=i.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),AAe.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:a}=e;a&&(a.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(a),n&&n.deregister&&n.deregister(a))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Awe(e){const[t,n]=function(){const e=(0,a.useContext)(jye);if(null===e)return[!0,null];const{isPresent:t,onExitComplete:n,register:o}=e,i=(0,a.useId)();(0,a.useEffect)((()=>o(i)),[]);const r=(0,a.useCallback)((()=>n&&n(i)),[i,n]);return!t&&n?[!1,r]:[!0]}(),o=(0,a.useContext)(oAe);return(0,Cc.jsx)(ywe,{...e,layoutGroup:o,switchLayoutGroup:(0,a.useContext)(xAe),isPresent:t,safeToRemove:n})}const vwe={borderRadius:{...fwe,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:fwe,borderTopRightRadius:fwe,borderBottomLeftRadius:fwe,borderBottomRightRadius:fwe,boxShadow:bwe},Swe=["TopLeft","TopRight","BottomLeft","BottomRight"],xwe=Swe.length,Gwe=e=>"string"===typeof e?parseFloat(e):e,Zwe=e=>"number"===typeof e||gve.test(e);function wwe(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const kwe=Rwe(0,.5,CGe),Bwe=Rwe(.5,.95,iAe);function Rwe(e,t,n){return a=>a<e?0:a>t?1:n(xGe(e,t,a))}function Wwe(e,t){e.min=t.min,e.max=t.max}function Vwe(e,t){Wwe(e.x,t.x),Wwe(e.y,t.y)}function Nwe(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Xwe(e,t,n,a,o){return e=twe(e-=t,1/n,a),void 0!==o&&(e=twe(e,1/o,a)),e}function Mwe(e,t,n,a,o){let[i,r,s]=n;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;cve.test(t)&&(t=parseFloat(t),t=GGe(r.min,r.max,t/100)-r.min);if("number"!==typeof t)return;let s=GGe(i.min,i.max,a);e===i&&(s-=t),e.min=Xwe(e.min,t,n,s,o),e.max=Xwe(e.max,t,n,s,o)}(e,t[i],t[r],t[s],t.scale,a,o)}const Twe=["x","scaleX","originX"],Ewe=["y","scaleY","originY"];function Fwe(e,t,n,a){Mwe(e.x,t,Twe,n?n.x:void 0,a?a.x:void 0),Mwe(e.y,t,Ewe,n?n.y:void 0,a?a.y:void 0)}function Hwe(e){return 0===e.translate&&1===e.scale}function Jwe(e){return Hwe(e.x)&&Hwe(e.y)}function Ywe(e,t){return e.min===t.min&&e.max===t.max}function Lwe(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function zwe(e,t){return Lwe(e.x,t.x)&&Lwe(e.y,t.y)}function Kwe(e){return MZe(e.x)/MZe(e.y)}function Dwe(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Uwe{constructor(){this.members=[]}add(e){$ve(this.members,e),e.scheduleRender()}remove(e){if(eSe(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let n;for(let a=t;a>=0;a--){const e=this.members[a];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:a}=e.options;!1===a&&n.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Pwe=(e,t)=>e.depth-t.depth;class Owe{constructor(){this.children=[],this.isDirty=!1}add(e){$ve(this.children,e),this.isDirty=!0}remove(e){eSe(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Pwe),this.isDirty=!1,this.children.forEach(e)}}const _we={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Qwe="undefined"!==typeof window&&void 0!==window.MotionDebug,jwe=["","X","Y","Z"],qwe={visibility:"hidden"};let $we=0;function eke(e,t,n,a){const{latestValues:o}=t;o[e]&&(n[e]=o[e],t.setStaticValue(e,0),a&&(a[e]=0))}function tke(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return!1;const{visualElement:t}=e.options;return!!t&&(!!window.MotionHasOptimisedTransformAnimation(lZe(t))||!(!e.parent||e.parent.hasCheckedOptimisedAppear)&&tke(e.parent))}function nke(e){let{attachResizeListener:t,defaultParent:n,measureScroll:a,checkIsScrollRoot:o,resetTransform:i}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===n||void 0===n?void 0:n();this.id=$we++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Qwe&&(_we.totalNodes=_we.resolvedTargetDeltas=_we.recalculatedProjection=0),this.nodes.forEach(ike),this.nodes.forEach(dke),this.nodes.forEach(hke),this.nodes.forEach(rke),Qwe&&window.MotionDebug.record(_we)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new Owe)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new aZe),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];t&&t.notify(...a)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var a;this.isSVG=(a=e)instanceof SVGElement&&"svg"!==a.tagName,this.instance=e;const{layoutId:o,layout:i,visualElement:r}=this.options;if(r&&!r.current&&r.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),n&&(i||o)&&(this.isLayoutDirty=!0),t){let n;const a=()=>this.root.updateBlockedByResize=!1;t(e,(()=>{this.root.updateBlockedByResize=!0,n&&n(),n=function(e,t){const n=OSe.now(),a=o=>{let{timestamp:i}=o;const r=i-n;r>=t&&(rSe(a),e(r-t))};return iSe.read(a,!0),()=>rSe(a)}(a,250),Iwe.hasAnimatedSinceResize&&(Iwe.hasAnimatedSinceResize=!1,this.nodes.forEach(uke))}))}o&&this.root.registerSharedNode(o,this),!1!==this.options.animate&&r&&(o||i)&&this.addEventListener("didUpdate",(e=>{let{delta:t,hasLayoutChanged:n,hasRelativeTargetChanged:a,layout:o}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const i=this.options.transition||r.getDefaultTransition()||bke,{onLayoutAnimationStart:s,onLayoutAnimationComplete:l}=r.getProps(),c=!this.targetLayout||!zwe(this.targetLayout,o)||a,g=!n&&a;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||g||n&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(t,g);const e={...LSe(i,"layout"),onPlay:s,onComplete:l};(r.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e)}else n||uke(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=o}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,rSe(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(pke),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionHandoffCancelAll&&tke(this)&&window.MotionHandoffCancelAll(),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let o=0;o<this.path.length;o++){const e=this.path[o];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const a=this.getTransformTemplate();this.prevTransformTemplateValue=a?a(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(lke);this.isUpdating||this.nodes.forEach(cke),this.isUpdating=!1,this.nodes.forEach(gke),this.nodes.forEach(ake),this.nodes.forEach(oke),this.clearAllSnapshots();const e=OSe.now();sSe.delta=qAe(0,1e3/60,e-sSe.timestamp),sSe.timestamp=e,sSe.isProcessing=!0,lSe.update.process(sSe),lSe.preRender.process(sSe),lSe.render.process(sSe),sSe.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,AAe.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(ske),this.sharedNodes.forEach(mke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,iSe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){iSe.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected=PZe(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=o(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!i)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Jwe(this.projectionDelta),n=this.getTransformTemplate(),a=n?n(this.latestValues,""):void 0,o=a!==this.prevTransformTemplateValue;e&&(t||qZe(this.latestValues)||o)&&(i(this.instance,a),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let n=this.removeElementScroll(t);return e&&(n=this.removeTransform(n)),function(e){vke(e.x),vke(e.y)}(n),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return PZe();const n=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(xke))){const{scroll:e}=this.root;e&&(swe(n.x,e.offset.x),swe(n.y,e.offset.y))}return n}removeElementScroll(e){var t;const n=PZe();if(Vwe(n,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return n;for(let a=0;a<this.path.length;a++){const t=this.path[a],{scroll:o,options:i}=t;t!==this.root&&o&&i.layoutScroll&&(o.wasRoot&&Vwe(n,e),swe(n.x,o.offset.x),swe(n.y,o.offset.y))}return n}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=PZe();Vwe(n,e);for(let a=0;a<this.path.length;a++){const e=this.path[a];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&cwe(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),qZe(e.latestValues)&&cwe(n,e.latestValues)}return qZe(this.latestValues)&&cwe(n,this.latestValues),n}removeTransform(e){const t=PZe();Vwe(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!qZe(e.latestValues))continue;jZe(e.latestValues)&&e.updateSnapshot();const a=PZe();Vwe(a,e.measurePageBox()),Fwe(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,a)}return qZe(this.latestValues)&&Fwe(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==sSe.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const a=Boolean(this.resumingFrom)||this!==n;if(!(e||a&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:o,layoutId:i}=this.options;if(this.layout&&(o||i)){if(this.resolvedRelativeTargetAt=sSe.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=PZe(),this.relativeTargetOrigin=PZe(),JZe(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Vwe(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var r,s,l;if(this.target||(this.target=PZe(),this.targetWithTransforms=PZe()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),r=this.target,s=this.relativeTarget,l=this.relativeParent.target,FZe(r.x,s.x,l.x),FZe(r.y,s.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Vwe(this.target,this.layout.layoutBox),owe(this.target,this.targetDelta)):Vwe(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=PZe(),this.relativeTargetOrigin=PZe(),JZe(this.relativeTargetOrigin,this.target,e.target),Vwe(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Qwe&&_we.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!jZe(this.parent.latestValues)&&!$Ze(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let a=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(a=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(a=!1),this.resolvedRelativeTargetAt===sSe.timestamp&&(a=!1),a)return;const{layout:o,layoutId:i}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!o&&!i)return;Vwe(this.layoutCorrected,this.layout.layoutBox);const r=this.treeScale.x,s=this.treeScale.y;!function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=n.length;if(!o)return;let i,r;t.x=t.y=1;for(let s=0;s<o;s++){i=n[s],r=i.projectionDelta;const{visualElement:o}=i.options;o&&o.props.style&&"contents"===o.props.style.display||(a&&i.options.layoutScroll&&i.scroll&&i!==i.root&&cwe(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),r&&(t.x*=r.x.scale,t.y*=r.y.scale,owe(e,r)),a&&qZe(i.latestValues)&&cwe(e,i.latestValues))}t.x<rwe&&t.x>iwe&&(t.x=1),t.y<rwe&&t.y>iwe&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms=PZe());const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(Nwe(this.prevProjectionDelta.x,this.projectionDelta.x),Nwe(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),EZe(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===r&&this.treeScale.y===s&&Dwe(this.projectionDelta.x,this.prevProjectionDelta.x)&&Dwe(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Qwe&&_we.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=UZe(),this.projectionDelta=UZe(),this.projectionDeltaWithTransform=UZe()}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,a=n?n.latestValues:{},o={...this.latestValues},i=UZe();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const r=PZe(),s=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,g=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(fke));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;Ike(i.x,e.x,n),Ike(i.y,e.y,n),this.setTargetDelta(i),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(JZe(r,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,a){Cke(e.x,t.x,n.x,a),Cke(e.y,t.y,n.y,a)}(this.relativeTarget,this.relativeTargetOrigin,r,n),u&&function(e,t){return Ywe(e.x,t.x)&&Ywe(e.y,t.y)}(this.relativeTarget,u)&&(this.isProjectionDirty=!1),u||(u=PZe()),Vwe(u,this.relativeTarget)),s&&(this.animationValues=o,function(e,t,n,a,o,i){o?(e.opacity=GGe(0,void 0!==n.opacity?n.opacity:1,kwe(a)),e.opacityExit=GGe(void 0!==t.opacity?t.opacity:1,0,Bwe(a))):i&&(e.opacity=GGe(void 0!==t.opacity?t.opacity:1,void 0!==n.opacity?n.opacity:1,a));for(let r=0;r<xwe;r++){const o="border".concat(Swe[r],"Radius");let i=wwe(t,o),s=wwe(n,o);void 0===i&&void 0===s||(i||(i=0),s||(s=0),0===i||0===s||Zwe(i)===Zwe(s)?(e[o]=Math.max(GGe(Gwe(i),Gwe(s),a),0),(cve.test(s)||cve.test(i))&&(e[o]+="%")):e[o]=s)}(t.rotate||n.rotate)&&(e.rotate=GGe(t.rotate||0,n.rotate||0,a))}(o,a,this.latestValues,n,g,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(rSe(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=iSe.update((()=>{Iwe.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,n){const a=QAe(e)?e:rZe(e);return a.start(nZe("",a,t,n)),a.animation}(0,1e3,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:a,latestValues:o}=e;if(t&&n&&a){if(this!==e&&this.layout&&a&&Ske(this.options.animationType,this.layout.layoutBox,a.layoutBox)){n=this.target||PZe();const t=MZe(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const a=MZe(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+a}Vwe(t,n),cwe(t,o),EZe(this.projectionDeltaWithTransform,this.layoutCorrected,t,o)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Uwe);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=this.getStack();a&&a.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const a={};n.z&&eke("z",e,a,this.animationValues);for(let o=0;o<jwe.length;o++)eke("rotate".concat(jwe[o]),e,a,this.animationValues),eke("skew".concat(jwe[o]),e,a,this.animationValues);e.render();for(const o in a)e.setStaticValue(o,a[o]),this.animationValues&&(this.animationValues[o]=a[o]);e.scheduleRender()}getProjectionStyles(e){var t,n;if(!this.instance||this.isSVG)return;if(!this.isVisible)return qwe;const a={visibility:""},o=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,a.opacity="",a.pointerEvents=Qve(null===e||void 0===e?void 0:e.pointerEvents)||"",a.transform=o?o(this.latestValues,""):"none",a;const i=this.getLead();if(!this.projectionDelta||!this.layout||!i.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=Qve(null===e||void 0===e?void 0:e.pointerEvents)||""),this.hasProjected&&!qZe(this.latestValues)&&(t.transform=o?o({},""):"none",this.hasProjected=!1),t}const r=i.animationValues||i.latestValues;this.applyTransformsToTarget(),a.transform=function(e,t,n){let a="";const o=e.x.translate/t.x,i=e.y.translate/t.y,r=(null===n||void 0===n?void 0:n.z)||0;if((o||i||r)&&(a="translate3d(".concat(o,"px, ").concat(i,"px, ").concat(r,"px) ")),1===t.x&&1===t.y||(a+="scale(".concat(1/t.x,", ").concat(1/t.y,") ")),n){const{transformPerspective:e,rotate:t,rotateX:o,rotateY:i,skewX:r,skewY:s}=n;e&&(a="perspective(".concat(e,"px) ").concat(a)),t&&(a+="rotate(".concat(t,"deg) ")),o&&(a+="rotateX(".concat(o,"deg) ")),i&&(a+="rotateY(".concat(i,"deg) ")),r&&(a+="skewX(".concat(r,"deg) ")),s&&(a+="skewY(".concat(s,"deg) "))}const s=e.x.scale*t.x,l=e.y.scale*t.y;return 1===s&&1===l||(a+="scale(".concat(s,", ").concat(l,")")),a||"none"}(this.projectionDeltaWithTransform,this.treeScale,r),o&&(a.transform=o(r,a.transform));const{x:s,y:l}=this.projectionDelta;a.transformOrigin="".concat(100*s.origin,"% ").concat(100*l.origin,"% 0"),i.animationValues?a.opacity=i===this?null!==(n=null!==(t=r.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==n?n:1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:a.opacity=i===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0;for(const c in UAe){if(void 0===r[c])continue;const{correct:e,applyTo:t}=UAe[c],n="none"===a.transform?r[c]:e(r[c],i);if(t){const e=t.length;for(let o=0;o<e;o++)a[t[o]]=n}else a[c]=n}return this.options.layoutId&&(a.pointerEvents=i===this?Qve(null===e||void 0===e?void 0:e.pointerEvents)||"":"none"),a}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(lke),this.root.sharedNodes.clear()}}}function ake(e){e.updateLayout()}function oke(e){var t;const n=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:a}=e.layout,{animationType:o}=e.options,i=n.source!==e.layout.source;"size"===o?OZe((e=>{const a=i?n.measuredBox[e]:n.layoutBox[e],o=MZe(a);a.min=t[e].min,a.max=a.min+o})):Ske(o,n.layoutBox,t)&&OZe((a=>{const o=i?n.measuredBox[a]:n.layoutBox[a],r=MZe(t[a]);o.max=o.min+r,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[a].max=e.relativeTarget[a].min+r)}));const r=UZe();EZe(r,t,n.layoutBox);const s=UZe();i?EZe(s,e.applyTransform(a,!0),n.measuredBox):EZe(s,t,n.layoutBox);const l=!Jwe(r);let c=!1;if(!e.resumeFrom){const a=e.getClosestProjectingParent();if(a&&!a.resumeFrom){const{snapshot:o,layout:i}=a;if(o&&i){const r=PZe();JZe(r,n.layoutBox,o.layoutBox);const s=PZe();JZe(s,t,i.layoutBox),zwe(r,s)||(c=!0),a.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=r,e.relativeParent=a)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:s,layoutDelta:r,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function ike(e){Qwe&&_we.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function rke(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function ske(e){e.clearSnapshot()}function lke(e){e.clearMeasurements()}function cke(e){e.isLayoutDirty=!1}function gke(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function uke(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function dke(e){e.resolveTargetDelta()}function hke(e){e.calcProjection()}function pke(e){e.resetSkewAndRotation()}function mke(e){e.removeLeadSnapshot()}function Ike(e,t,n){e.translate=GGe(t.translate,0,n),e.scale=GGe(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Cke(e,t,n,a){e.min=GGe(t.min,n.min,a),e.max=GGe(t.max,n.max,a)}function fke(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const bke={duration:.45,ease:[.4,0,.1,1]},yke=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Ake=yke("applewebkit/")&&!yke("chrome/")?Math.round:iAe;function vke(e){e.min=Ake(e.min),e.max=Ake(e.max)}function Ske(e,t,n){return"position"===e||"preserve-aspect"===e&&(a=Kwe(t),o=Kwe(n),i=.2,!(Math.abs(a-o)<=i));var a,o,i}function xke(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const Gke=nke({attachResizeListener:(e,t)=>uSe(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Zke={current:void 0},wke=nke({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Zke.current){const e=new Gke({});e.mount(window),e.setOptions({layoutScroll:!0}),Zke.current=e}return Zke.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),kke={pan:{Feature:class extends SSe{constructor(){super(...arguments),this.removePointerDownListener=iAe}onPointerDown(e){this.session=new xZe(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:uwe(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:a}=this.node.getProps();return{onSessionStart:mwe(e),onStart:mwe(t),onMove:n,onEnd:(e,t)=>{delete this.session,a&&iSe.postRender((()=>a(e,t)))}}}mount(){this.removePointerDownListener=mSe(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends SSe{constructor(e){super(e),this.removeGroupControls=iAe,this.removeListeners=iAe,this.controls=new hwe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||iAe}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:wke,MeasureLayout:Awe}},Bke={current:null},Rke={current:!1};const Wke=new WeakMap,Vke=[...sxe,Axe,Vxe],Nke=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Xke=NAe.length;class Mke{scrapeMotionValuesFromProps(e,t,n){return{}}constructor(e){let{parent:t,props:n,presenceContext:a,reducedMotionConfig:o,blockInitialAnimation:i,visualState:r}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.applyWillChange=!1,this.resolveKeyframes=(e,t,n,a)=>new this.KeyframeResolver(e,t,n,a,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=pxe,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.isRenderScheduled=!1,this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.isRenderScheduled=!1,this.scheduleRender=()=>{this.isRenderScheduled||(this.isRenderScheduled=!0,iSe.render(this.render,!1,!0))};const{latestValues:l,renderState:c}=r;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=n,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=o,this.options=s,this.blockInitialAnimation=Boolean(i),this.isControllingVariants=XAe(n),this.isVariantNode=MAe(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const{willChange:g,...u}=this.scrapeMotionValuesFromProps(n,{},this);for(const d in u){const e=u[d];void 0!==l[d]&&QAe(e)&&e.set(l[d],!1)}}mount(e){this.current=e,Wke.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),Rke.current||function(){if(Rke.current=!0,gAe)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Bke.current=e.matches;e.addListener(t),t()}else Bke.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Bke.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Wke.delete(this.current),this.projection&&this.projection.unmount(),rSe(this.notifyUpdate),rSe(this.render),this.valueSubscriptions.forEach((e=>e())),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){const n=OAe.has(e),a=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&iSe.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)})),o=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,(()=>{a(),o(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in HAe){const t=HAe[e];if(!t)continue;const{isEnabled:n,Feature:a}=t;if(!this.features[e]&&a&&n(this.props)&&(this.features[e]=new a(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):PZe()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<Nke.length;n++){const t=Nke[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const a=e["on"+t];a&&(this.propEventSubscriptions[t]=this.on(t,a))}this.prevMotionValues=function(e,t,n){for(const a in t){const o=t[a],i=n[a];if(QAe(o))e.addValue(a,o);else if(QAe(i))e.addValue(a,rZe(o,{owner:e}));else if(i!==o)if(e.hasValue(a)){const t=e.getValue(a);!0===t.liveStyle?t.jump(o):t.hasAnimated||t.set(o)}else{const t=e.getStaticValue(a);e.addValue(a,rZe(void 0!==t?t:o,{owner:e}))}}for(const a in n)void 0===t[a]&&e.removeValue(a);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const e=this.parent&&this.parent.getVariantContext()||{};return void 0!==this.props.initial&&(e.initial=this.props.initial),e}const e={};for(let t=0;t<Xke;t++){const n=NAe[t],a=this.props[n];(RAe(a)||!1===a)&&(e[n]=a)}return e}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=rZe(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){var n;let a=void 0===this.latestValues[e]&&this.current?null!==(n=this.getBaseTargetFromProps(this.props,e))&&void 0!==n?n:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return void 0!==a&&null!==a&&("string"===typeof a&&(QSe(a)||_Se(a))?a=parseFloat(a):!(e=>Vke.find(rxe(e)))(a)&&Vxe.test(t)&&(a=Hxe(e,t)),this.setBaseTarget(e,QAe(a)?a.get():a)),QAe(a)?a.get():a}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props;let a;if("string"===typeof n||"object"===typeof n){const o=Uve(this.props,n,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);o&&(a=o[e])}if(n&&void 0!==a)return a;const o=this.getBaseTargetFromProps(this.props,e);return void 0===o||QAe(o)?void 0!==this.initialValues[e]&&void 0===a?void 0:this.baseTarget[e]:o}on(e,t){return this.events[e]||(this.events[e]=new aZe),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];this.events[e].notify(...n)}}}class Tke extends Mke{constructor(){super(...arguments),this.KeyframeResolver=Yxe}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:n,style:a}=t;delete n[e],delete a[e]}}class Eke extends Tke{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=Jve}readValueFromInstance(e,t){if(OAe.has(t)){const e=Fxe(t);return e&&e.default||0}{const a=(n=e,window.getComputedStyle(n)),o=(bve(t)?a.getPropertyValue(t):a[t])||0;return"string"===typeof o?o.trim():o}var n}measureInstanceViewportBox(e,t){let{transformPagePoint:n}=t;return gwe(e,n)}build(e,t,n){Sve(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return zve(e,t,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;QAe(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent="".concat(e))})))}}class Fke extends Tke{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=PZe}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(OAe.has(t)){const e=Fxe(t);return e&&e.default||0}return t=Yve.has(t)?t:mAe(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return Kve(e,t,n)}build(e,t,n){Mve(e,t,this.isSVGTag,n.transformTemplate)}renderInstance(e,t,n,a){Lve(e,t,0,a)}mount(e){this.isSVGTag=Eve(e.tagName),super.mount(e)}}const Hke=(e,t)=>DAe(e)?new Fke(t):new Eke(t,{allowProjection:e!==a.Fragment}),Jke={...vZe,...NSe,...kke,...{layout:{ProjectionNode:wke,MeasureLayout:Awe}}},Yke=zAe(((e,t)=>function(e,t,n,a){let{forwardMotionProps:o=!1}=t;return{...DAe(e)?cSe:gSe,preloadedFeatures:n,useRender:Hve(o),createVisualElement:a,Component:e}}(e,t,Jke,Hke)));const Lke=n.p+"static/media/\u8fa8\u8b58\u5716-\u90f5\u5dee\u86d9\u86d9.f9e752039e659696b61a.mind",{Content:zke}=lCe,{Text:Kke}=Eye,Dke=()=>{const[e,t]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),i=(0,a.useRef)(null),r=(0,a.useCallback)((()=>{t(!0),pI.success("\u76ee\u6a19\u627e\u5230\u4e86\uff01",2),setTimeout((()=>o(!0)),100)}),[]),s=(0,a.useCallback)((()=>{t(!1),o(!1)}),[]),l=(0,a.useCallback)((()=>{i.current&&i.current.submit()}),[]),c=(0,a.useCallback)((e=>{if(!e)return;const t=new RG(1,.552),n=new Cx({color:255,transparent:!0,opacity:.5}),a=new sG(t,n);e.add(a);const o=()=>{a.rotation.y+=.01,requestAnimationFrame(o)};o()}),[]);return(0,a.useEffect)((()=>{console.log("Current states - targetFound:",e,"showMessage:",n)}),[e,n]),(0,Cc.jsxs)(lCe,{style:{minHeight:"100vh",background:"transparent"},children:[" ",(0,Cc.jsxs)(zke,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[" ",(0,Cc.jsx)(aIe,{imageTargetSrc:Lke,onTargetFound:r,onTargetLost:s,renderARContent:c}),(0,Cc.jsxs)(dAe,{children:[" ",e&&n&&(0,Cc.jsxs)(Yke.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},style:{width:"100%",maxWidth:"500px",textAlign:"center",paddingTop:"2rem",zIndex:1e4},children:[(0,Cc.jsxs)("div",{style:{background:"rgba(0, 0, 0, 0.5)",padding:"16px",borderRadius:"8px",margin:"16px 0"},children:[(0,Cc.jsx)(Kke,{style:{color:"white"},children:"\u627e\u5230\u56c9\uff0c\u8a18\u5f97\u627e\u5c0e\u89bd\u4eba\u54e1\u62ff\u76f8\u7247\u54e6"})," "]}),(0,Cc.jsx)(tc,{type:"primary",onClick:l,size:"large",style:{backgroundColor:"#8b5a2b",borderColor:"#8b5a2b",color:"white"},children:"\u7d50\u675f\u904a\u6232"})," "]})]}),(0,Cc.jsx)(dAe,{children:!e&&(0,Cc.jsx)(Yke.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.5},style:{marginTop:"2rem",textAlign:"center"},children:(0,Cc.jsx)(Qye,{tip:"\u6b63\u5728\u641c\u5c0b\u76ee\u6a19...",size:"large",children:(0,Cc.jsx)("div",{style:{padding:"30px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"4px"},children:(0,Cc.jsx)(Kke,{children:"\u8acb\u5c07\u76f8\u6a5f\u5c0d\u6e96\u76ee\u6a19\u5716\u7247"})})})},"searching-message")}),(0,Cc.jsxs)("form",{ref:i,action:"/",method:"GET",style:{display:"none"},children:[" ",(0,Cc.jsx)("input",{type:"hidden",name:"dialogIndex",value:"68"})]})]})]})},Uke=(0,Cc.jsx)(dfe,{children:(0,Cc.jsxs)(he,{children:[(0,Cc.jsx)(ue,{path:"/",element:(0,Cc.jsx)(zf,{})}),(0,Cc.jsx)(ue,{path:"/game1",element:(0,Cc.jsx)(lIe,{})}),(0,Cc.jsx)(ue,{path:"/game2",element:(0,Cc.jsx)(gIe,{})}),(0,Cc.jsx)(ue,{path:"/game3",element:(0,Cc.jsx)(fIe,{})}),(0,Cc.jsx)(ue,{path:"/game4",element:(0,Cc.jsx)(RIe,{})}),(0,Cc.jsx)(ue,{path:"/game5",element:(0,Cc.jsx)(VIe,{})}),(0,Cc.jsx)(ue,{path:"/game6",element:(0,Cc.jsx)(gfe,{})}),(0,Cc.jsx)(ue,{path:"/game7",element:(0,Cc.jsx)(Dke,{})})]})});i.createRoot(document.getElementById("root")).render((0,Cc.jsxs)(a.StrictMode,{children:[Uke," "]}))})()})();
//# sourceMappingURL=main.23b1751f.js.map